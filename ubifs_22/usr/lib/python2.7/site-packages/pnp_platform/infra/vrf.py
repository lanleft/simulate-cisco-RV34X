################################################################################
# Copyright (c) 2015-17 by Cisco Systems, Inc.
# All rights reserved.
#
# Author: Shaurin Desai <shaurdes@cisco.com>
################################################################################
"""PnP Infra VRF API implementation

This implementation of the VRF API will make calls to the Python socket library
to bind a socket to a specific source-interface. VRF setting is not supported by
the reference platform, so this will result in a no-op.

"""
import socket

from pnp.infra.api.pnp_infra import PnPInfra


class VRF(PnPInfra):
    """PnP Infra API: VRF
    
    Useful methods and attributes inherited from PnPInfra:
        * logger: Logger to be used for logging by PnP Infra API implementation.
        * set_error_info(): Method to be used by PnP Infra API implementation
            for reporting error/warning information.

    """

    @classmethod
    def set_vrf(cls, interface_name="", vrf_name=""):
        """Sets the VRF name for socket operations. If no parameters are
        provided, default vrf should be set.
    
        Args:
            interface_name (str, optional): Name of interface to set VRF.
            vrf_name (str, optional): VRF identifier.
    
        Returns:
            bool: True, if VRF set successfully. False, otherwise.
    
        """
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        # from socket.h
        # define SO_BINDTODEVICE 25
        s.setsockopt(socket.SOL_SOCKET, 25, interface_name)
        return True
