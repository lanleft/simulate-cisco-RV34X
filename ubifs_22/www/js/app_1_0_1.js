var resource_base="./",local_database=!1,emulator=!1,app=window.angular.module("routerApp","ngRoute ngGrid ui.bootstrap ui.grid ui.grid.treeView ui.grid.expandable ui.grid.pagination ui.grid.resizeColumns ui.grid.autoResize ui.grid.selection errorModule ngMessages chart.js ngFileUpload ngCookies ngSanitize ngDialog ngAnimate".split(" ")),DEBUG=0,INFO=1,WARN=2,ERROR=3,FATAL=4,debug=ERROR,Log=function(a,b){a>=debug&&console.log(new Date+":"+JSON.stringify(b))},webOpt={WebHTTPReqestMaxRetryCounter:3,
WebCompileWaitCounter:10,WebCompileWaitDuration:2E3};app.factory("TreeData",function(){var a;return{setTree:function(b){a=b},getTree:function(){return a}}});app.filter("DICT",["multiLanguageService",function(a){return function(b,t){return a.getString(b,t)}}]);app.filter("ngColumns_hideInMenu",function(){return function(a){return a.filter(function(a){return!a.colDef.hideInMenu})}});
app.filter("capitalize",function(){return function(a,b){null!==a&&void 0!==a&&(a=a.toLowerCase());return a.substring(0,1).toUpperCase()+a.substring(1)}});
app.factory("GridRowBasedEditingAdv",["$timeout","$q",function(a,b){var t={init:function(a){this.rowState=a.rowState;this.tbl_ref=a.tbl_ref;this.tbl_orig=a.tbl_orig;this.del_ref=a.del_ref;this.gridopt_ref=a.gridopt_ref;this.Selections=a.Selections},resetState:function(){var a=this.rowState,b=this.gridopt_ref;angular.forEach(a,function(u,p){a[p].state=0;a[p].orig_ref&&delete a[p].orig_ref;b&&b.selectItem&&b.selectItem(p,!1)});b&&b.selectAll&&b.selectAll(!1)},selRow:function(a,b){var u={rowState:this.rowState,
tbl_ref:this.tbl_ref,tbl_orig:this.tbl_orig,del_ref:this.del_ref,gridopt_ref:this.gridopt_ref,Selections:this.Selections};if("array"===$.type(a))for(var p=0;p<a.length;p++)t.internalSelRow(a[p],b,u);else t.internalSelRow(a,b,u)},internalSelRow:function(a,b,u){b=a.entity&&angular.isDefined(a.entity.checked)?a.entity.checked:a.selected;var p;if(angular.isDefined(a.rowIndex))p=a.rowIndex;else for(var q=u.gridopt_ref.ngGrid.filteredRows,e=0;e<q.length;e++)if(angular.equals(q[e].entity,a.entity)){p=e;
break}b?(u.rowState[p]=u.rowState[p]||{},u.rowState[p].orig_ref=a.entity,2!=u.rowState[p].state&&(u.rowState[p].state=1)):(u.rowState[p]=u.rowState[p]||{},u.rowState[p].state=0)},edit:function(){var a=this.rowState;angular.forEach(a,function(b,u){1==b.state&&(a[u].state=2)})},add:function(b,w,u){u=u||{createFormExists:!0,maxEntry:50,focusAddedItem:!0,Default:!0};angular.isDefined(u.focusAddedItem)||(u.focusAddedItem=!0);var p=this.rowState,q=this.tbl_ref,e=this.tbl_orig,x=this.gridopt_ref,n=q.length;
x&&(x.ngGrid&&x.ngGrid.filteredRows&&x.ngGrid.filteredRows.length)&&(n=x.ngGrid.filteredRows.length);if(n>=u.maxEntry)app.TOOLS.criticalAlertBox({msg:"Max entry "+u.maxEntry+" items are exceeded"+(u.Default?" (Default)":""),cbk:function(a){}});else{n=q.length-1;if(u.routuneBypass)b&&b(q,p);else{var l;0<=n&&!0===u.createFormExists?(l=angular.copy(q[n]),q.push(l)):b?(l=b(q),angular.isDefined(l)||Log(ERROR,"Error: add_empty_cb() no return object")):(console.log("Warning: add_empty_cb() not exist"),q.push(angular.copy(e[0])));
p[n+1]={state:2,orig_ref:l};w&&w(q)}x||console.log("Warning: self.gridopt_ref not exist");!0===u.focusAddedItem&&function(){a(function(){var a=q.indexOf(x.ngGrid.filteredRows[x.ngGrid.filteredRows.length-1].entity),v=a;angular.forEach(p,function(a,r){p[r].state=0;x&&angular.forEach(x.ngGrid.filteredRows,function(d,c){if(a.orig_ref==d.entity){var h=q.indexOf(d.entity);x.selectItem(h,!1);v=r}})});x&&x.selectItem&&(x.selectItem(a,!0),p[v].state=2)},40)}()}},remove:function(a,w,u){var p=this.rowState,
q=this.tbl_ref,e=this.del_ref,x=this.Selections,n=b.defer(),l=n.promise;if(u){var r=[];angular.forEach(this.rowState,function(a,s){1<=a.state&&r.push(a.orig_ref)});u=u(r);l=u.promise.then(u.thenFn)}else n.resolve("ok");l.then(function(){var r=[],s;angular.forEach(p,function(d,c){if(1<=d.state){a&&a(d.orig_ref,e);var h;if(x)for(var g=x.length-1;0<=g;g--)x[g]==d.orig_ref&&(x.splice(g,1),s=q.indexOf(d.orig_ref),h=q.splice(s,1));else s=q.indexOf(d.orig_ref),h=q.splice(s,1);h&&(e&&e.push(h[0]),r.push(c),
w&&w(h[0],e,q))}});for(var k=r.length-1;0<=k;k--)p.splice(r[k],1)})},get_del_item:function(a,b,u){var p=this.tbl_orig,q=this.tbl_ref,e=[],x,n,l=0,r,v,s=function(a,d,c){for(var h=0;h<a.length;h++)n=a[h],void 0!==c[n]&&(d[n]=c[n])};angular.forEach(p,function(k,d){x=!1;angular.forEach(q,function(c,d){for(var h=l=0;h<a.length;h++)n=a[h],k[n]===c[n]&&(l+=1);l==a.length&&(x=!0,r=c)});if(x){if(b){v={};var c=b(p,q,k,r);if(void 0!==c){s(a,v,k);for(var h in c)v[h]=c[h];e.push(v)}}}else v={},s(a,v,k),angular.equals(v,
{})||(e.push(v),u&&u(p,q,k,q[d],d))});return e}};return t}]);
app.factory("GridRowBasedEditingOper",["$timeout","$q",function(a,b){var t={init:function(a){return a},resetState:function(a){angular.forEach(a.rowState,function(b,u){a.rowState[u].state=0;a.rowState[u].orig_ref&&delete a.rowState[u].orig_ref;a.gridopt_ref&&a.gridopt_ref.selectItem&&a.gridopt_ref.selectItem(u,!1)});a.gridopt_ref&&a.gridopt_ref.selectAll&&a.gridopt_ref.selectAll(!1)},selRow:function(a,b,u){if("array"===$.type(b))for(var p=0;p<b.length;p++)t.internalSelRow(b[p],u,a);else t.internalSelRow(b,
u,a)},internalSelRow:function(a,b,u){b=a.entity&&angular.isDefined(a.entity.checked)?a.entity.checked:a.selected;var p;if(angular.isDefined(a.rowIndex))p=a.rowIndex;else for(var q=u.gridopt_ref.ngGrid.filteredRows,e=0;e<q.length;e++)if(angular.equals(q[e].entity,a.entity)){p=e;break}b?(u.rowState[p]=u.rowState[p]||{},u.rowState[p].orig_ref=a.entity,2!=u.rowState[p].state&&(u.rowState[p].state=1)):(u.rowState[p]=u.rowState[p]||{},u.rowState[p].state=0)},edit:function(a){angular.forEach(a.rowState,
function(b,u){1==b.state&&(a.rowState[u].state=2)})},add:function(b,w,u,p){p=p||{createFormExists:!0,maxEntry:50,Default:!0};var q=b.tbl_ref.length;b.gridopt_ref&&(b.gridopt_ref.ngGrid&&b.gridopt_ref.ngGrid.filteredRows&&b.gridopt_ref.ngGrid.filteredRows.length)&&(q=b.gridopt_ref.ngGrid.filteredRows.length);if(q>=p.maxEntry)alert("Max entry "+p.maxEntry+" items are exceeded"+(p.Default?" (Default)":""));else{q=b.tbl_ref.length-1;if(p.routuneBypass)w&&w(b.tbl_ref,b.rowState);else{var e;0<=q&&!0===
p.createFormExists?(e=angular.copy(b.tbl_ref[q]),b.tbl_ref.push(e)):w?(e=w(b.tbl_ref),angular.isDefined(e)||console.log("Error: add_empty_cb() no return object")):(console.log("Warning: add_empty_cb() not exist"),b.tbl_ref.push(angular.copy(b.tbl_orig[0])));b.rowState[q+1]={state:2,orig_ref:e};u&&u(b.tbl_ref)}b.gridopt_ref||Log(ERROR,"Warning: self.gridopt_ref not exist");b.gridopt_ref.ngGrid?a(function(){var a=b.tbl_ref.indexOf(b.gridopt_ref.ngGrid.filteredRows[b.gridopt_ref.ngGrid.filteredRows.length-
1].entity),e=a;angular.forEach(b.rowState,function(a,r){b.rowState[r].state=0;b.gridopt_ref&&angular.forEach(b.gridopt_ref.ngGrid.filteredRows,function(v,s){if(a.orig_ref==v.entity){var k=b.tbl_ref.indexOf(v.entity);b.gridopt_ref.selectItem(k,!1);e=r}})});b.gridopt_ref&&b.gridopt_ref.selectItem&&(b.gridopt_ref.selectItem(a,!0),b.rowState[e].state=2)},40):Log(WARN,"Warning: Not use ng-grid")}},remove:function(a,w,u,p){var q=b.defer(),e=q.promise;if(p){var x=[];angular.forEach(this.rowState,function(a,
b){1<=a.state&&x.push(a.orig_ref)});p=p(x);e=p.promise.then(p.thenFn)}else q.resolve("ok");e.then(function(){var b=[],e;angular.forEach(a.rowState,function(r,s){if(1<=r.state){w&&w(r.orig_ref,a.del_ref);var k;if(a.Selections)for(var d=a.Selections.length-1;0<=d;d--)a.Selections[d]==r.orig_ref&&(a.Selections.splice(d,1),e=a.tbl_ref.indexOf(r.orig_ref),k=a.tbl_ref.splice(e,1));else e=a.tbl_ref.indexOf(r.orig_ref),k=a.tbl_ref.splice(e,1);k&&(a.del_ref&&a.del_ref.push(k[0]),b.push(s),u&&u(k[0],a.del_ref,
a.tbl_ref))}});for(var r=b.length-1;0<=r;r--)a.rowState.splice(b[r],1)})},get_del_item:function(a,b,u,p){var q=a.tbl_orig,e=a.tbl_ref,x=[],n,l,r=0,v,s,k=function(a,c,h){for(var g=0;g<a.length;g++)l=a[g],void 0!==h[l]&&(c[l]=h[l])};angular.forEach(q,function(a,c){n=!1;angular.forEach(e,function(c,g){for(var h=r=0;h<b.length;h++)l=b[h],a[l]===c[l]&&(r+=1);r==b.length&&(n=!0,v=c)});if(n){if(u){s={};var h=u(q,e,a,v);if(void 0!==h){k(b,s,a);for(var g in h)s[g]=h[g];x.push(s)}}}else s={},k(b,s,a),angular.equals(s,
{})||(x.push(s),p&&p(q,e,a,e[c],c))});return x}};return t}]);app.service("sessionAPI",[function(){var a,b=function(){a||(a=app.TOOLS.get_scope("sessionCtrl"));return a};this.reset=function(){b()&&"function"===$.type(b().resetTimer)?b().resetTimer():a=void 0};this.init=function(){b()&&_.isFunction(b().getSessionTime)&&b().getSessionTime()}}]);
app.service("UserSession",["$cookies","$http",function(a,b){var t=function(a){var m={};data={jsonrpc:"2.0",method:a.method,params:a.params||""};actm="POST";m.url=local_database||emulator||!a.method?a.url||"jsonrpc":"jsonrpc";m.data=JSON.stringify(data);m.method=actm;return b(m).error(function(b,q,e,x,n){a.error&&a.error({data:b,status:q,headers:e,config:x,statusText:n})})};this.logout=function(){t({method:"logout",params:{sessionid:a.get("sessionid")},error:function(a){console.log("remove cookies fail = "+
a.status);pollingTimeId=0}});a.remove("user");a.remove("sessionid");a.remove("blinking");a.remove("disable-startup");a.remove("redirect-admin");a.remove("config-modified");a.remove("group");a.remove("attributes");a.remove("current-page");a.remove("fwver");a.remove("model_info");a.remove("ru");a.remove("bootfail");var b=document.location;document.location.href=b.protocol+"//"+b.host};var m=a.get("sessionid");this.SessionInit=function(){window.addEventListener("focus",function(b){b=a.get("sessionid");
void 0!==b&&m!==b&&(console.log("another session established"),location.href=location.protocol+"//"+location.host+"?code=multisession")},!1)}}]);
app.service("MyHttp",["$http","$location","UserSession","sessionAPI","$rootScope",function(a,b,t,m,w){var u=resource_base+"cache/",p=function(a){var b={},p;if(b)for(p in a)b[p]=a[p];return b};this.get=function(b){b.procBackground||app.transition.In();var e=p(b.options);e.url=b.url;e.method="GET";b.isPolling||m.reset();return a(e).success(function(a,e,l,r,v){b.success&&b.success({data:a,status:e,headers:l,config:r,statusText:v});b.procBackground||app.transition.Out()}).error(function(a,e,l,r,v){b.error&&
b.error({data:a,status:e,headers:l,config:r,statusText:v});b.procBackground||app.transition.Out()})};this.post=function(b){var e=p(b.options),x="",n="",l="GET",r=!1;b.procBackground||app.transition.In();"action"===b.method&&b.popRPCResonsepAlert&&(r=!0);b.method&&(x={jsonrpc:"2.0",method:b.method,params:b.params||""});(!local_database&&b.method||!0===b.forcedUsingPost)&&!emulator?(l="POST",e.data=JSON.stringify(x)):n=emulator&&b.method?u+b.method+".json":local_database||!b.method?b.url:"jsonrpc";
n||(n="jsonrpc");e.url=n;b.timeout&&(e.timeout=b.timeout||void 0);e.method=l;b.isPolling||m.reset();return a(e).success(function(a,s,k,d,c){var h=function(){_.isFunction(b.success)&&b.success({data:a,status:s,headers:k,config:d,statusText:c})},g;b.procBackground||app.transition.Out();r?(g=a.result&&a.result.output)&&void 0!==g.code?0===g.code?(g=g.errstr||w.DICT("Success"),app.TOOLS.successAlertBox({title:w.DICT("Information"),msg:g,cbk:function(){h()}})):(g=g.errstr||w.DICT("Failure"),app.TOOLS.criticalAlertBox({title:w.DICT("Alert"),
msg:g,cbk:function(){h()}})):h():h()}).error(function(a,s,k,d,c){401===s&&t.logout();var h=function(){_.isFunction(b.error)&&b.error({data:a,status:s,headers:k,config:d,statusText:c})};b.procBackground||app.transition.Out();r?app.TOOLS.criticalAlertBox({title:w.DICT("Alert"),msg:w.DICT("Network_Error"),cbk:function(){h()}}):h()})};this.getScript=function(a,b,p){jQuery.ajax({url:a,type:"get",dataType:"script",data:void 0,success:b,error:p})}}]);
app.service("modelInfo",[function(){var a="";this.get_pid=function(){a||(a=document.getElementById("pid_version").value.toUpperCase());return a};this.get_HWDMZport=function(){var a="";switch(this.get_pid()){case "RV345":case "RV345P":a="LAN16";break;case "RV340":case "RV340W":a="LAN4";break;default:a="LAN4"}return a};this.spec_WifiSupport=function(){var a=!1;switch(this.get_pid()){case "RV340W":a=!0;break;default:a=!1}return a}}]);
app.service("deviceTime",["MyHttp","dt",function(a,b){this.get_time=function(t){var m=function(a){a||(a={});var m="";a=(a["system-state"]||{}).clock||{};a["current-datetime"]&&(a=b.parser(a["current-datetime"]),0===a.err_code&&(m=a.year+"-"+(a.month+1)+"-"+a.day+"_"+a.hour+"-"+a.minute+"-"+a.second));t(m)};a.post({url:resource_base+"data/time.json",method:"get_time",success:function(a){a.data&&a.data.result?m(a.data.result):m()},error:function(a){console.log("deviceTime get_time Error status: "+a.status)}})}}]);
app.service("ngGridCellBuilder",[function(){var a={type:"text",ngCmd:""};this.build=function(b){switch(b.type){case "checkbox":a.ngCmd='ng-model="COL_FIELD" ng-checked="COL_FIELD"';break;default:a.ngCmd='ng-model="COL_FIELD"'}angular.extend(a,b);return'<div class="ngCellText" ng-class="col.colIndex()">'+("<input type="+a.type+" "+a.ngCmd+"/>")+"</div>"}}]);
app.service("passwordComplex",[function(){var a={minLen:8,minClass:3,enable:!0};this.getStrength=function(b){var t=1,m=0,w=!1,u=!1,p=!1,q=!1,e=!1,x,n,l,r,v,s=3;b||(b={});x=b.pwd||"";n=b.customConfig||{};l=isNaN(parseInt(n.minLen,10))?a.minLen:parseInt(n.minLen,10);r=isNaN(parseInt(n.minClass,10))?a.minClass:parseInt(n.minClass,10);if(!x)return 0;n=x.length;if(0===r&&0===l)return b.qualityIndicator&&(b.qualityIndicator.length_ok=!0,b.qualityIndicator.class_ok=!0),console.log(b.qualityIndicator),0;
b.hasOwnProperty("name")&&(e=!0,s=4);a||(a={});for(v=0;v<n;v++)if("A"<=x.charAt(v)&&"Z">=x.charAt(v)&&(w=!0),"a"<=x.charAt(v)&&"z">=x.charAt(v)&&(u=!0),"0"<=x.charAt(v)&&"9">=x.charAt(v)&&(p=!0),"!"<=x.charAt(v)&&"/">=x.charAt(v)||":"<=x.charAt(v)&&"@">=x.charAt(v)||"["<=x.charAt(v)&&"`">=x.charAt(v)||"{"<=x.charAt(v)&&"~">=x.charAt(v))q=!0;w&&m++;u&&m++;p&&m++;q&&m++;m>=r&&t++;n>=l&&t++;e&&username!==x&&t++;b.qualityIndicator&&(b.qualityIndicator.length_ok=n>=l,b.qualityIndicator.class_ok=m>=r);
return t>=s?t+(n-l):0};this.update_config=function(b){b&&(void 0!==b.minimum_length&&(a.minLen=b.minimum_length),void 0!==b.minimum_number_character_classes&&(a.minClass=b.minimum_number_character_classes),void 0!==b.complex_enable&&(a.enable=b.complex_enable))};this.get_complex_enable=function(){return a.enable};this.get_config=function(){return a}}]);
app.service("oneTimeLocker",[function(){var a={};this.put=function(b,t){b||alert("oneTimeLocker error: lockerID value not exist");t||alert("oneTimeLocker error: item value not exist");a[b]=angular.copy(t)};this.get=function(b){if(a[b]){var t=angular.copy(a[b]);delete a[b];return t}}}]);
app.service("gridPrivService",function(){var a=this,b=!1;this.ugRowIsSelected=function(a,b,w){w=!1;(b=b.colDef.field||b.colDef.name||"")&&a.entity[b]&&(w=!0);a.isSelected!==w&&(a.isSelected=w);return w};this.ugInvokeCbk=function(a,b,w,u){if(_.isFunction(a)){var p;_.forEach(u.rows,function(a,e){a.uid===b.uid&&(p=e)});a(p,b,w,u)}else Log(INFO,"ugInvokeCbk is not function")};this.ugRadioInit=function(a,b,w){if(b&&b.colDef){var u=b.colDef.field||b.colDef.name||"",p;u&&_.forEach(w.rows,function(a){a.entity[u]&&
(p&&Log(ERROR,"ui-grid radio selector error, there are two or more radio are choosed, please check data"),p=a.uid)});p&&(b.colDef.radioSelectUid=p);void 0===b.colDef.radioSelectUid&&(b.colDef.radioSelectUid=-1)}};this.ugRadioClick=function(a,b,w){var u=b.colDef.field||b.colDef.name||"",p=b.colDef.disableRadioField,q=w.rows,e=void 0;p&&!0===a.entity[p]||(b.colDef.radioSelectUid=a.uid,_.forEach(q,function(a,q){a.uid===b.colDef.radioSelectUid?(e=q,u&&void 0!==a.entity[u]&&(a.entity[u]=!0)):u&&(a&&a.entity&&
void 0!==a.entity[u])&&(a.entity[u]=!1)}),_.isFunction(b.colDef.changedCbk)&&(-1===b.colDef.radioSelectUid&&(e=-1),void 0!==e?setTimeout(function(){b.colDef.changedCbk(e,a);app.TOOLS.apply(w.appScope)},0):Log(ERROR,"[Err][ugRadioClick] rowSelectIdx is undefined, radioSelectUid:"+b.colDef.radioSelectUid)))};this.ugCheckboxInit=function(a,m,w){m&&m.colDef&&(b=!1)};this.ugCheckboxClick=function(t,m,w,u){var p=m.colDef.field||m.colDef.name||"",q=m.colDef.disableChkBoxField,e=w.rows;if(!q||!(!0===t.entity[q]&&
t.entity[p]))t.entity[p]=!t.entity[p],_.forEach(e,function(a,b){a.uid===t.uid&&(rowSelectIdx=b)}),_.isFunction(m.colDef.changedCbk)&&(void 0!==rowSelectIdx?(m.colDef.changedCbk(rowSelectIdx,t),app.TOOLS.apply(w.appScope)):Log(ERROR,"[Err][ugCheckboxClick] rowSelectIdx is undefined, radioSelectUid:"+m.colDef.radioSelectUid)),a.ugHeaderCheckboxChecker(m,w),u||(b=!0)};this.ugHeaderCheckboxClick=function(a,b){var w=b.rows,u=a.colDef.field||a.colDef.name||"",p=a.colDef.hideField||"",q=a.colDef.disableChkBoxField,
e;a.colDef.allCheckboxSelected=!a.colDef.allCheckboxSelected;e=a.colDef.allCheckboxSelected;_.forEach(w,function(a){if(!(q&&!0===a.entity[q])&&(!p||!a.entity[p]))a.entity[u]=e});_.isFunction(a.colDef.headerChangedCbk)&&a.colDef.headerChangedCbk(e)};this.ugHeaderCheckboxChecker=function(a,b){var w=a.colDef.field||a.colDef.name||"",u=a.colDef.disableChkBoxField,p=0,q=!1;_.forEach(b.rows||[],function(a){u&&!0===a.entity[u]||(!0===a.entity[w]?p+=1:q=!0)});a.colDef.allCheckboxSelected=!q&&0<p?!0:!1};this.ugRowClick=
function(t,m){if(b)b=!1;else{var w=!1,u=m.columns;_.forEach(u,function(a){a.colDef.editRow&&!0===t.entity[a.colDef.editRow]&&(w=!0)});_.forEach(u,function(b){b.colDef&&!w&&(!0===b.colDef.isRadio&&(b.colDef.radioSelectUid=t.uid,m.refreshCanvas(),a.ugRadioClick(t,b,m)),!0===b.colDef.isCheckbox&&a.ugCheckboxClick(t,b,m,!0))})}};this.getSelectDisplayNameFromList=function(a,b){var w="";angular.forEach(b,function(b,p){b.id===a&&(w=b.displayName)});return w};this.headerChkBoxClick=function(a,b){var w=b.colDef.field,
u=b.colDef.allSelected,p=[],q=b.colDef.disableChkBoxField;angular.forEach(a,function(a){if(a.entity&&!(void 0===a.entity[w]||q&&!0===a.entity[q]))a.entity[w]=u,p.push(a)});b.colDef.headerChanged&&"function"===$.type(b.colDef.headerChanged)&&b.colDef.headerChanged(b.colDef.allSelected);b.colDef.changed&&"function"===$.type(b.colDef.changed)&&b.colDef.changed(p)};this.chkHeaderChkBox=function(a,b){var w=b.colDef.field,u=b.colDef.disableChkBoxField,p=!0,q=0;angular.forEach(a,function(a){if(a.entity&&
!(void 0===a.entity[w]||u&&!0===a.entity[u]))a.entity[w]||(p=!1),q+=1});0===q&&(p=!1);b.colDef.allSelected=p};this.getRowIndex=function(a,b,w){var u=-1;angular.forEach(w.rows,function(b,q){a.uid===b.uid&&(u=q)});return u};this.getColumnIndex=function(a,b){var w=-1;angular.forEach(b.columns,function(b,p){b.uid===a.uid&&(w=p)});return w}});
app.service("multiLanguageService",["MyHttp","$route",function(a,b){var t={cur_lang:"en",list:[{lang:"en",displayName:"English",version:"1.0",URL:"i18n/lang_en.js"}]},m,w,u=function(){var a=angular.element("#headerApp"),q;a&&(q=a.scope());q&&q.langOptions&&(q.langOptions.init(),b.reload())};this.getLangList=function(){if(t)return t.list};this.getCurrLang=function(){if(t)return t.cur_lang};this.change_language=function(b){var q="";w=b;t.cur_lang=b;a.post({method:"set_gui",params:{gui:{"default-language":b}},
success:function(a){},error:function(a){}});list=this.getLangList();angular.forEach(list,function(a){if(a.lang===w)return q=a.URL,!0});q&&(a.getScript(q),u())};this.init=function(){var b=this;a.getScript("./i18n/lang_en.js");Language?m=Language:console.log("[Err] languageProvider init() can't get english file");a.post({url:resource_base+"i18n/lang.json",method:"get_gui",success:function(a){a=a&&a.data&&a.data.result&&a.data.result.gui&&a.data.result.gui["default-language"]||"en";t.cur_lang=a;"en"!==
a?b.change_language(a):u()},error:function(a){console.log("[Err] languageProvider init() can't get language data")}})};this.getString=function(a,b){if(a){var e;if(!Language||!Language[a]){if(!m||!m[a])return a;e=m[a]}else e=Language[a];b&&angular.forEach(b,function(a,b){e=e.replace(RegExp(b,"g"),a)});return e}}}]);
app.service("Sets",[function(){var a={},b=null,t,m=!1,w=function(q,e){var p=["","","",""],n,l,r={},v,s,k;if(1==t||3==t){v=void 0!=q.length;s=void 0!=e.length;var d;v&&q[0].__key&&(d=q[0].__key);s&&e[0].__key&&(d=e[0].__key);if(1==t&&(v||s)&&!d)m=!0}if(3==t&&(v||s)){r=[];for(l=q.length-1;0<=l;l--)r[l]={}}for(n in q)if(k=n,1==t&&(k=v?q[n][d]:n),q.hasOwnProperty(n))if("object"!=typeof q[n]||"object"!=typeof e[n])if(n in e&&q[n]!==e[n])r[k+p[3]]=e[n];else{if(!(n in e)||q[n]!==e[n])r[k+p[1]]=e[n]||b}else if(l=
w(q[n],e[n],a))r[k+p[2]]=l;for(n in e)k=n,1==t&&(k=s?e[n][d]:n),e.hasOwnProperty(n)&&!(n in q)&&(r[k+p[0]]=e[n]);for(n in r)if(r.hasOwnProperty(n))return r;return!1},u=function(a){for(var e in a)a[e]==b?a[e]=void 0:a.hasOwnProperty(e)&&"object"==typeof a[e]&&u(a[e]);return a};this.filterNonNull=function(a){b=null;return u(angular.copy(a))};this.getDiff=function(q,e,p){m=!1;b=null;a=angular.copy(p);t=a.mode||3;q=w(q,e);m&&alert("Sets:diffSets (mode="+t+") missing '__key' to identtify Primary Key");
return q};var p=function(a,b){void 0==a&&alert("error: recover_object: target undefined");if("object"==typeof b)for(var x in b)void 0==a[x]?null===b[x]&&"object"===typeof b[x]?a[x]=null:"object"==typeof b[x]&&void 0!=b[x].length?(a[x]=[],a[x]=angular.copy(b[x])):"object"==typeof b[x]?(a[x]={},angular.extend(a[x],b[x])):a[x]=b[x]:p(a[x],b[x])};this.recover_object=function(a,b){var x=angular.copy(b);p(a,x)};this.default_result=function(a,b){a&&a.data&&a.data.result?this.recover_object(a.data.result,
b):a&&a.data?console.log("Error: procResp.data.result not exist"):a?console.log("Error: procResp.data not exist"):console.log("Error: procResp not exist")};this.getResult=function(a,b,p,n){a="";a=n&&n.source?n.source:b&&b.config&&b.data&&b.data.result?"http":"dproxy";if("dproxy"==a)return p?b[p]:b;if("http"==a)return p?b.data.result[p]:b.data.result}}]);app.value("validValueTest",{netmask:"{not_contains:'The netmask not valid.VALUE'}"});
app.config(["errorMessagesProvider",function(a){a.setErrorMessages({required:"Required",email:"Besure input a correct email",url:"Must a url format",minlength:"Too less words",maxlength:"Too many words",parse:"Parse error",not_contains:"Not in valid list"})}]);
app.config(["$controllerProvider","$provide","$compileProvider",function(a,b,t){app._controller=app.controller;app._service=app.service;app._factory=app.factory;app._value=app.value;app._directive=app.directive;app.controller=function(b,w){a.register(b,w);return this};app.service=function(a,w){b.service(a,w);return this};app.factory=function(a,w){b.factory(a,w);return this};app.value=function(a,w){b.value(a,w);return this};app.directive=function(a,b){t.directive(a,b);return this}}]);
app.config(["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";a.defaults.withCredentials=!0;app.RadioList=function(a){void 0===a&&(a={});this.selected=a.selected||"";this.radioList=a.radioList||{data:[],style:""};this.title=a.title||{str:"",style:""}};app.IPv4FormatChk=function(a){if(void 0===a.newValue||null===a.newValue)return"undefined";if(0===a.newValue.length)return"empty";a=a.newValue.split(".");if(4!==a.length)return"error";
angular.forEach(a,function(a,b){if(0===b){if(0>=a||255<a)return"error"}else if(0>a||255<a)return"error"});return"valid"};app.ngGrid={headerHeight:20,rowHeight:22,scrollHeight:13,scrollbars:{NEVER:0,ALWAYS:1},generateGridOptions:function(a){var b={};"object"===$.type(a)&&angular.extend(b,a);return b},computeHeight:function(a,b){var e=1,x=10,n,l=app.ngGrid,r=l.rowHeight,v=l.headerHeight;b&&(e=isNaN(parseInt(b.minRows,10))?1:parseInt(b.minRows,10),x=isNaN(parseInt(b.maxRows,10))?10:parseInt(b.maxRows,
10),r=isNaN(parseInt(b.rowHeight,10))?l.rowHeight:parseInt(b.rowHeight,10),v=isNaN(parseInt(b.headerHeight,10))?l.headerHeight:parseInt(b.headerHeight,10));n=parseInt(a,10);if(isNaN(n)||1>n)n=1;return{"max-height":v+2+r*x+l.scrollHeight,"min-height":v+r*e,height:v+2+r*n}},focusRow:function(a,b){if(!a||"number"!==$.type(b))return!1;var e=a.ngGrid;if(!e)return!1;setTimeout(function(){void 0!==e.rowMap[b]&&e.$viewport.scrollTop(e.rowMap[b]*e.config.rowHeight)},100);return!0},setupGridAct:function(a){var b=
this,e=a.oper;a=a.grid;b.conf={rowState:a.rowEditableState,tbl_ref:a._tbl_ref,tbl_orig:a._tbl_orig,del_ref:a._del_ref,gridopt_ref:a.Options,Selections:a.Selections};b.resetState=function(){e.resetState(b.conf)};b.selRow=function(a,n){e.selRow(b.conf,a,n)};b.edit=function(){e.edit(b.conf)};b.add=function(a,n,l){e.add(b.conf,a,n,l)};b.remove=function(a,n,l){e.remove(b.conf,a,n,l)};b.get_del_item=function(a,n,l){return e.get_del_item(b.conf,a,n,l)};return this},ngGridFlexibleHeightPlugin:function(a){var b=
this;b.grid=null;b.scope=null;b.init=function(e,x,n){b.domUtilityService=n.DomUtilityService;b.grid=x;b.scope=e;var l=function(){var r="."+b.grid.gridId+" .ngFooterPanel",r=b.grid.$topPanel.height()+$(r).height(),v=b.grid.$canvas.height(),r=28,s=app.ngGrid.rowHeight;b.grid.rowCache&&(b.grid.rowCache[0]&&b.grid.rowCache[0].config&&b.grid.rowCache[0].config.rowHeight)&&(s=b.grid.rowCache[0].config.rowHeight);var k=10*s;v>k+13&&(v=k+13);v<s&&(v=s);b.scope.naturalHeight_post_cb&&(v=b.scope.naturalHeight_post_cb(a,
v));a&&(null!=a.minHeight&&v+r<a.minHeight&&(v=a.minHeight-r-2),null!=a.maxHeight&&v+r>a.maxHeight&&(v=a.maxHeight));v+=3;if(!b.scope.baseViewportHeight||b.scope.baseViewportHeight!==v)s=v,b.grid.filteredRows&&10>b.grid.filteredRows.length?b.grid.$viewport.css("overflow-y","hidden"):(b.grid.$viewport.css("overflow-y","auto"),s+=13),b.grid.$viewport.css("height",s+"px"),b.grid.$root.css("height",v+r+"px"),b.scope.baseViewportHeight=v;b.grid.$root.css("width","100%");b.grid.$viewport.css("width","100%");
b.domUtilityService.RebuildGrid(b.scope,b.grid)};b.scope.catHashKeys=function(){var a="",v;for(v in b.scope.renderedRows)a+=b.scope.renderedRows[v].$$hashKey;return a};b.scope.$watch("catHashKeys()",l);b.scope.$watch(b.grid.config.data,function(){setTimeout(l,1)});b.scope.innerRecalcForData=l;a&&a.external_init&&a.external_init(b,a)}},sortFn:{sortString:function(a,b){var e=a.toLowerCase(),x=b.toLowerCase();return e===x?0:e<x?-1:1},sortIPv4:function(a,b){var e=app.TOOLS.ipv4.ipv4ToNum(a),x=app.TOOLS.ipv4.ipv4ToNum(b);
return e===x?0:e<x?-1:1}}};var b=-1,t=0,m=function(){-1!==b&&(clearTimeout(b),t=0);var a=function(){t+=1;4>=t?b=setTimeout(function(){$(window).resize();a()},500):($(window).resize(),b=-1,t=0)};a()},w=function(a){a.grid.appScope.$watch(function(){return a.grid.rows.length},function(b){a.customApi.checkSelectStatus()})},u=function(a){a.grid.renderContainers.body.registerViewportAdjuster(function(b){if(!a.grid||!a.grid.rows)return b;var e=a.grid;e.element.find(".ui-grid-canvas");var x=e.gridHeight-
e.renderContainers.body.headerHeight,n=e.options,l=e.rows,r=0,v=10,e=e.renderContainers.body.renderedRows.length,s=0,k=n.rowHeight,d=0;n.dynamicRowHeight&&angular.forEach(l,function(a){_.isNumber(a.offsetHeight)&&a.offsetHeight>s&&(s=a.offsetHeight);s&&(s=Math.max(s-k,0))});void 0!==n.minRowsToShow&&(_.isNumber(n.minRowsToShow)&&0<n.minRowsToShow)&&(r=n.minRowsToShow);void 0!==n.maxRowsToShow&&(_.isNumber(n.maxRowsToShow)&&0<n.minRowsToShow)&&(v=n.maxRowsToShow);v<r&&(v=r);e<r&&(e=r);e>v&&(e=v);e&&
(d=8);b.height=b.height+(e*k+s+d)-x;return b})};app.uiGrid={headerHeight:40,rowHeight:40,scrollHeight:13,scrollbars:{NEVER:0,ALWAYS:1},sortFun:function(a,b,e){var x=1;"directiondesc"===e&&(x=-1);return void 0===a&&void 0===b?0:void 0===a?x:void 0===b?-x:a===b?0:a<b?-x:x},generateGridOptions:function(a){var b,e,x={headerRowHeight:app.uiGrid.headerHeight,rowHeight:app.uiGrid.rowHeight,minRowsToShow:0,enableSorting:!0,enableColumnMenus:!1},n=function(a,b,s,k,d,c){var h=s.grid,g=h.appScope,A=h.api.pagination;
s=g.gridFuns.getRowIndex(s,c,h);k=g.gridFuns.getRowIndex(k,c,h);c=A.getFirstRowIndex();A=A.getLastRowIndex();h=app.uiGrid.sortFun;return c>s||A<s||c>k||A<k?0:h(a,b,d)},l=function(a){return{scrollTo:function(b,s,k){_.isNumber(k)||(k=50);setTimeout(function(){var d,c,h;h=a.grid;d=h.rows;h=h.columns;if(_.isNumber(b))if(d.length<=b||0>b)Log(ERROR,"[uiGrid][customApi][scrollTo][Err] row length is "+d.length+", focus row index is "+b);else{d=d[b].entity;if(_.isNumber(s)){if(h.length<=s||0>s){Log(ERROR,
"[uiGrid][customApi][scrollTo][Err] column length is "+h.length+", focus column index is "+s);return}c=h[s].colDef}a.core.scrollTo(d,c)}else Log(ERROR,'[uiGrid][customApi][scrollTo][Err] focus row index is not number "'+b+'"')},k)},scrollToLast:function(b,s){_.isNumber(s)||(s=50);setTimeout(function(){var k,d,c,h;c=a.grid;k=c.rows;c=c.columns;h=k.length;if(0<h){k=k[h-1].entity;if(_.isNumber(b)){if(c.length<=b||0>b){Log(ERROR,"[uiGrid][customApi][scrollTo][Err] column length is "+c.length+", focus column index is "+
b);return}d=c[b].colDef}a.core.scrollTo(k,d)}else Log(DEBUG,"[uiGrid][customApi][scrollToLast] data length is "+h)},s)},selectedRowRadio:function(b){var s;setTimeout(function(){var k,d,c,h;c=a.grid;d=c.rows;_.forEach(c.columns,function(a){a.colDef.isRadio&&(k=a.colDef,h=a.colDef.field||a.colDef.name||"")});if(k&&(_.forEach(d,function(a,c){h&&(a.entity[h]=!1);c===b&&(s=a,h&&(a.entity[h]=!0))}),s||-1===b))s?k.radioSelectUid=s.uid:-1===b&&(k.radioSelectUid=b),a.core.notifyDataChange("all")},0)},enableFiltering:function(b){_.isBoolean(b)&&
(a.grid.options.enableFiltering=b,a.core.notifyDataChange("all"))},checkSelectStatus:function(){var b=a.grid,s=b.columns,k=b.rows,d="",c="",h=-1,g=0,A=!0;_.forEach(s,function(a,b){a.colDef.isCheckbox&&(c=a.field||a.name||"",h=b,d=a.colDef&&a.colDef.hideField||"")});c&&(A=k.length?!0:!1,_.forEach(k,function(a){if(!d||!a.entity[d])a.entity[c]||(A=!1),g+=1}),0===g&&(A=!1),s=s[h],s.colDef.allCheckboxSelected=A,_.isFunction(s.colDef.headerChangedCbk)&&s.colDef.headerChangedCbk(A),app.TOOLS.apply(b.appScope))}}};
"object"===$.type(a)&&(_.isFunction(a.onRegisterApi)&&(b=a.onRegisterApi,delete a.onRegisterApi),angular.extend(x,a),x.onRegisterApi=function(a){a.customApi=l(a);x.gridApi=a;_.isFunction(b)&&b(a);a.grid.options.dynamicRowHeight&&(a.grid.renderContainers.body.getVerticalScrollLength=function(){return Math.abs(this.getCanvasHeight()-this.getViewportHeight())+this.grid.scrollbarHeight});m();w(a);u(a)});_.forEach(x.columnDefs,function(a,b){if(a.isRadio)void 0===a.cellTemplate&&(a.cellTemplate="UGRadioSelectTemplate.html"),
void 0===a.width&&(a.width=25),void 0===a.displayName&&(a.displayName=""),a.enableFiltering=!1,a.enableColumnMenu=!1,a.enableSorting=!1,a.enableColumnResizing=!1;else if(a.isCheckbox)void 0===a.cellTemplate&&(a.cellTemplate="UGCheckboxSelectTemplate.html"),void 0===a.headerCellTemplate&&(a.headerCellTemplate="UGHeaderCheckboxTemplate.html"),void 0===a.width&&(a.width=25),a.enableFiltering=!1,a.enableColumnMenu=!1,a.enableSorting=!1,a.enableColumnResizing=!1;else if(a.isEmpty)a.displayName="",a.enableFiltering=
!1,a.enableColumnMenu=!1,a.enableSorting=!1,a.enableColumnResizing=!1,a.cellTemplate="UG_table_empty.html";else{a.headerClass=a.isWrapHeader?"ui-grid-wrap-header":"ui-grid-nowrap-header";if((x.paginationPageSize||x.enablePagination)&&!_.isFunction(a.sortingAlgorithm))a.sortingAlgorithm=n;_.isNumber(a.minWidth)||(e=app.uiGrid.computeHeaderWidth(a.displayName||a.field||"",!1!==a.enableSorting),_.isNumber(e)&&0<e&&(a.minWidth=e),a.fixWidth&&_.isUndefined(a.width)&&(a.width=a.minWidth));if(_.isUndefined(a.cellTooltip)||
!_.isFunction(a.cellTooltip))a.cellTooltip=function(a,b){return a.entity[b.field]}}});return x},computeHeaderWidth:function(a,b){var e=app.TOOLS.computeWidthWithStyle(a,{fontWeight:"bold",fontSize:"14px"}),e=e+16;b&&(e+=20);return e},computeHeight:function(a,b){var e=1,x=10,n=app.uiGrid,l=0,r=!1,v=n.rowHeight,s=n.headerHeight;b&&(e=isNaN(parseInt(b.minRows,10))?1:parseInt(b.minRows,10),x=isNaN(parseInt(b.maxRows,10))?10:parseInt(b.maxRows,10),v=isNaN(parseInt(b.rowHeight,10))?n.rowHeight:parseInt(b.rowHeight,
10),s=isNaN(parseInt(b.headerHeight,10))?n.headerHeight:parseInt(b.headerHeight,10));a&&a.data&&(l=parseInt(a.data.length,10),r=!0===a.enableFiltering);r&&(l+=1);if(isNaN(l)||1>l)l=1;return{"max-height":s+2+v*x+n.scrollHeight,"min-height":s+v*e,height:s+2+v*l}}};app.chart={backgroundColors:"#4BBEC5 #EAA228 #EAC228 #AAA228 #BBBDBF #ED6D79 #98AEAB #3D57B1 #EAA278 #4C4125 #A18F6A #00D08C #898CFF #FFEC16 #B1C2A3 #A3020E".split(" "),colors:{red:"#F6402C",green:"#46AF4A",yellow:"#FFB300"}}}]);
app.transition=function(){var a={},b=0,t=!1,m=void 0;a.In=function(){b+=1;m||(m=document.getElementById("global-loading-container"));m&&!t&&(m.style.display="block",t=!0)};a.Out=function(){b-=1;0>=b&&(b=0,m||(m=document.getElementById("global-loading-container")),m&&t&&(m.style.display="none",t=!1))};a.dump=function(){console.log("Count: "+b);console.log("Opened: "+t)};return a}();
app.config(["$routeProvider",function(a){a.when("/",{templateUrl:resource_base+"htm/empty.html",controller:"PageController"});a.when("/:page",{templateUrl:resource_base+"htm/empty.html",controller:"PageController"})}]).run(["$rootScope","$templateCache","MyHttp","multiLanguageService","$route","gridPrivService","modificationWarning","$location","goToPreviousPage","$q",function(a,b,t,m,w,u,p,q,e,x){a.gridFuns=u;a.languageProvider=m;a.DICT=m.getString;a.modified=p.modified;a.resetModified=p.reset;a.messagesInclUrl=
"htm/template/messages.htm";var n,l;app.TOOLS={apply:function(a){a&&a.$root&&("$apply"!=a.$root.$$phase&&"$digest"!=a.$root.$$phase)&&(a.$apply(),$(window).resize())},getVal:function(a,b){void 0===b&&(b="");return void 0!==a?a:b},getResponse:function(a,b){return a&&a[b]&&a[b].data&&a[b].data.result||{}},int2str2:function(a){return!_.isNumber(a)?"":10>a?"0"+a:""+a},str2int:function(a){if(!a)return 0;a=parseInt(a,10);isNaN(a)&&(a=0);return a},int2BinaryMask:function(a,b,s){var k="",d;if(!_.isNumber(a))return k;
_.isNumber(b)||(b=a);"L"!==s&&"H"!==s&&(s="L");for(d=0;d<a;d++)k+="1";for(d=k.length;d<b;d++)k="L"===s?"0"+k:k+"0";return k},windowResize:function(){$(window).resize()},warningAlertBox:function(a){a.type="warning";app.TOOLS.get_scope("appCtrl").openAlertBox(a)},criticalAlertBox:function(a){a.type="critical";app.TOOLS.get_scope("appCtrl").openAlertBox(a)},informationAlertBox:function(a){a.type="information";app.TOOLS.get_scope("appCtrl").openAlertBox(a)},successAlertBox:function(a){a.type="success";
app.TOOLS.get_scope("appCtrl").openAlertBox(a)},notificationBox:function(a){app.TOOLS.get_scope("appCtrl").openNotificationBox(a)},dialogBox:function(a){app.TOOLS.get_scope("appCtrl").openDialogBox(a)},wizardBox:function(a){app.TOOLS.get_scope("appCtrl").openWizardBox(a)},netmask:{int2Inet:function(a){var b="",s,k;if(!a||""===a||"number"!==typeof a||32<a||0>=a)return"";k="";for(s=0;32>s;s++)k+=0<a?"1":"0",a-=1,8===k.length&&(b=b+""+parseInt(k,2)+(31!==s?".":""),k="");return b},inet2Int:function(a){var b=
0,s=!1,k,d;if(!a||""===a)return"";a=a.split(".");if(4!==a.length)return"";angular.forEach(a,function(a,h){bytes="0000";if(!s)if(k=!1,a=parseInt(a,10),isNaN(a))s=!0;else{a=a.toString(2);for(d=a.length;8>d;d++)a="0"+a;angular.forEach(a,function(a){"1"===a.toString()?(k&&(s=!0),b+=1):k=!0})}});s&&(b="");return b},chk:function(a){}},ipv4:{ipv4ToNum:function(a){if(a&&"string"==typeof a)return a=a.split(".").map(function(a){return parseInt(a,10)}),a[0]*Math.pow(256,3)+a[1]*Math.pow(256,2)+a[2]*Math.pow(256,
1)+a[3]},numToIpv4:function(a){if(a){for(var b=a%256,s=1;3>=s;s++)a=Math.floor(a/256),b=a%256+"."+b;return b}},ipAndMask2IpPrefix:function(a,b){if(a&&b){var s,k,d,c,h="";if(s=app.TOOLS.netmask.inet2Int(b))if(k=b.split("."),d=a.split("."),!(k&&4!==k.length||d&&4!==d.length)){for(c=0;4>c;c++)h=h+(parseInt(d[c],10)&parseInt(k[c],10))+(3===c?"":".");return h+"/"+s}}}},ipv6:{toFullV6Addr:function(a){if(!a)return"";var b=a.split("::"),s,k;if(2<b.length)return"";if(2===b.length){s=b[0].split(":");k=b[1].split(":");
a=""===b[0]?"0":b[0];for(s=s.length+k.length-2;6>s;s++)a+=":0";a+=""===b[1]?":0":":"+b[1]}return a},toFullV6ZPAddr:function(a){a=this.toFullV6Addr(a);if(a){a=a.split(":");for(var b=0,b="",s=0;s<a.length;s++)b=5-a[s].length,b=0<b?b:0,b=Array(b).join("0"),a[s]=b+a[s];a=a.join(":")}else a="";return a},prefixLen2FullAddr:function(a){a=parseInt(a,10);var b="",s,k;if(isNaN(a)||128<a||0>a)return b;k="";for(s=0;s<a;s++)k+="1",0===(s+1)%4&&(b+=parseInt(k,2).toString(16),k="");for(s=a;128>s;s++)k+="0",0===
(s+1)%4&&(b+=parseInt(k,2).toString(16),k="");k=b;b="";for(s=0;s<k.length;s++)b+=k.charAt(s),0===(s+1)%4&&s+1!==k.length&&(b+=":");return b},compress:function(a){if(!a)return"";a=a.split(":");var b=[],s,k=[],d=!1,c;if(8!==a.length)return"";angular.forEach(a,function(a,g){s=parseInt("0x"+a,16).toString(16);"0"===s?!1===d?(k.push({id:g,cnt:1}),c=k.length-1,d=!0):k[c].cnt+=1:d=!1;b.push(s)});var h=-1,g;k.length&&(angular.forEach(k,function(a){h<a.cnt&&(h=a.cnt,g=a.id)}),b[g]=8===g+h||0===g?":":"",b.splice(g+
1,h-1));return b.join(":")},ipAndMask2IpPrefix:function(a,b){if(!a||!b)return"";var s=app.TOOLS.ipv6.toFullV6Addr(a),k=b;if(!s)return"";var d,c=[],h,s=s.split(":");angular.forEach(s,function(a){h="";for(d=16;0<d;d--)0<b?(h+="1",b-=1):h+="0";h="0x"+parseInt(h,2).toString(16);c.push((h&"0x"+a).toString(16))});c=app.TOOLS.ipv6.compress(c.join(":"));return c=c+"/"+k}},ipRangeCompare:function(a,b){var s=!0,k="",d=[],c=[],h=[],g=[],A=[],y=[],z=0,B=0,l=0,E=0,C=0,e=1,n=0,e=C=0,p="";if(a&&b)if(0<=a.indexOf(".")&&
0<=b.indexOf("."))p="ipv4";else if(0<=a.indexOf(":")&&0<=b.indexOf(":"))p="ipv6";else return{ret:!1,errstr:"protocol_error",type:""};if(!a||!b)s=!1,k="data_error";else if("ipv4"===p){d=a.split(".");c=b.split(".");for(C=0;4>C;C++)if(h[C]=parseInt(d[C],10),g[C]=parseInt(c[C],10),g[C]>h[C]){s=!0;break}else if(g[C]<h[C]){s=!1;k="data_incorrect";break}}else if("ipv6"===p){d=a.split(":");c=b.split(":");C=d.length-1;e=c.length-1;""===d[0]&&(d[0]="0");""===c[0]&&(c[0]="0");""===d[C]&&(d[C]="0");""===c[e]&&
(c[e]="0");for(C=0;C<d.length;C++)if(""===d[C]){z=1;l=C;n=8-d.length;break}if(1===z)for(C=0;C<d.length;C++)if(C===l){A[C]="0";for(e=1;e<=n;e++)A[l+e]="0"}else C>l?A[C+n]=d[C]:A[C]=d[C];for(C=n=0;C<c.length;C++)if(""===c[C]){B=1;E=C;n=8-c.length;break}if(1===B)for(C=0;C<c.length;C++)if(C===E){y[C]="0";for(e=1;e<=n;e++)y[E+e]="0"}else C>E?y[C+n]=c[C]:y[C]=c[C];for(C=0;8>C;C++)if(parseInt(y[C],16)>parseInt(A[C],16)){s=!0;break}else if(parseInt(y[C],16)<parseInt(A[C],16)){s=!1;k="data_incorrect";break}}else s=
!1;return{ret:s,errstr:k,type:p}},validation:{ipv4_prefix:function(a){var b=a.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)\/(\d+)$/);if(!a||!b)return!1;a=parseInt(b[5],10);if(0>=a||32<a)return!1;a=app.TOOLS.netmask.int2Inet(a).split(".");b=b.splice(1,4);if(!b||4!==b.length)return!1;var s=!0,k,d,c;for(k=0;4>k;k++)if(d=parseInt(b[k],10),c=parseInt(a[k],10),isNaN(d)||0>d||255<d||(d&c)!==d)s=!1;return s},ipv4_chkIPMask:function(a,b){if(!a||!b)return!1;var s=!0,k=app.TOOLS.validation.ipv4_getNet(a,b),d=a.split("."),
c=Array(4),h;for(h=0;h<d.length;h++)if(255<parseInt(d[h],10))return!1;for(h=0;h<d.length;h++)void 0!==d[h]&&""!==d[h]&&(c[h]=parseInt(d[h],10),c[h]=c[h].toString(10));d=Array(4);for(h=0;h<k.length;h++)void 0===k[h]||""===k[h]?s=!1:(d[h]=c[h]&(255^k[h]),0!==d[h]&&(s=!1)),h===k.length-1&&"0"===c[h]&&"255.255.255.255"===b&&(s=!1);return s},ipv4_getNet:function(a,b){var s=Array(4);if(!a||!b)return s;var k=b.split("."),d=Array(4),c;for(c=0;c<k.length;c++)void 0!==k[c]&&""!==k[c]&&(d[c]=parseInt(k[c],10),
d[c]=d[c].toString(10));var k=a.split("."),h=Array(4);for(c=0;c<k.length;c++)void 0===k[c]||""===k[c]?valid=!1:(h[c]=parseInt(k[c],10),h[c]=h[c].toString(10));for(c=0;4>c;c++)s[c]=d[c]&h[c];return s},ipv4_chkMulticastIP:function(a){if(!a)return!1;var b=function(a){a=a.split(".");for(var c=0,b=0;4>b;b++)c*=256,c+=parseInt(a[b],10);return c},s=b("224.0.0.0"),k=b("239.255.255.255");a=b(a);return 0!==a&&(a<s||a>k)},ipv6_getNet:function(a,b){var s=Array(8);if(!a||!b)return s;var k="",d,c;for(d=0;8>d;d++){for(c=
0;16>c;c++)k+=b>16*d+c?"1":"0";k+=":"}var h=Array(8);c=Array(8);k=k.split(":");for(d=0;8>d;d++)h[d]=parseInt(k[d],2),c[d]=h[d].toString(10);k=app.TOOLS.ipv6.toFullV6Addr(a).split(":");h=Array(8);for(d=0;8>d;d++)void 0!==k[d]&&""!==k[d]&&(h[d]=parseInt(k[d],16),h[d]=h[d].toString(10));for(d=0;8>d;d++)s[d]=c[d]&h[d];return s},ipv6_chkPrefixLength:function(a,b){if(!a||!b)return!1;var s=!0,k=app.TOOLS.ipv6.toFullV6Addr(a),d=k.split(":"),c=Array(8),h;for(h=0;8>h;h++)void 0!==d[h]&&""!==d[h]&&(c[h]=parseInt(d[h],
16),c[h]=c[h].toString(10));k=app.TOOLS.validation.ipv6_getNet(k,b);d=Array(8);for(h=0;h<k.length;h++)void 0===k[h]||""===k[h]?s=!1:(d[h]=c[h]&(65535^k[h]),0!==d[h]&&(s=!1)),h===k.length-1&&0===(c[h]&15)&&128===b&&(s=!1);return s}},is_safari:function(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("safari")&&-1===a.indexOf("chrome")?!0:!1},download_save_to:function(a,b,s){var k="text",d;if(!a||!a.length)return d;b||(b="file.txt");s||(s="text/plain");if("undefined"!==typeof safari)return app.TOOLS.get_scope("appCtrl").openSafariDownPage(a),
d;switch(s){case "text/xml":case "application/xml":d=$.ajax({url:a,dataType:"xml",success:function(){4===d.readyState&&download(d.responseText,b,s)}});break;default:d=$.ajax({url:a,dataType:k,success:download.bind(!0,s,b)})}return d},download_save_to2:function(a,b,s){var k=x.defer(),d=new XMLHttpRequest;d.open("GET",document.location.origin+"/"+a,!0);d.responseType="blob";d.onload=function(a){200===d.status?(download(d.response,b,s),k.resolve({status:this.status,event:a})):k.reject({status:this.status,
event:a})};d.send(null);return k.promise},download_binary:function(a){if(!document.getElementById("download_iframe")){var b=document.createElement("iframe"),s=document.createAttribute("id"),k=document.createAttribute("style");s.value="download_iframe";k.value="display:none;";b.setAttributeNode(s);b.setAttributeNode(k);document.body.appendChild(b)}document.getElementById("download_iframe")&&(document.getElementById("download_iframe").src=a)},get_scope:function(a){if(a)return angular.element("[ng-controller="+
a+"]").scope()},computeWidth:function(a){n||(n=document.getElementById("compute_width"));if(!a)return 0;n.innerHTML=a;return n.clientWidth},computeWidthWithStyle:function(a,b){l||(l=document.getElementById("compute_width_style"));if(!a)return 0;_.forEach(b,function(a,b){_.isUndefined(l.style[b])||(l.style[b]=a)});l.innerHTML=a;return l.clientWidth},sortingInterfaceFn:function(a){var b=function(a){var b=0,d=0;a=a.name.match(/^([A-zA-Z_]+)([0-9]*)/);b="LAN"==a[1]?100:"LAG"==a[1]?200:"WAN_PORT"==a[1]?
300:"WAN"==a[1]?400:"USB"==a[1]?500:"TUN"==a[1]?600:"VLAN"==a[1]?1E4:"DMZ"==a[1]?15E3:900;d=a[2]||0;return b+parseInt(d,10)};a=!a?1:-1;return function(s,k){s.name.match(/^VLAN/)&&k.name.match(/^VLAN/);var d=b(s),c=b(k);return a*((d>c)-(c>d))}},sortingDHCPInterfaceFn:function(a){var b=function(a){var b=0,d=0;a=a["interface"].match(/^([A-zA-Z_]+)([0-9]*)/);b="VLAN"==a[1]?1E4:900;d=a[2]||0;return b+parseInt(d,10)};a=!a?1:-1;return function(s,k){var d=b(s),c=b(k);return a*((d>c)-(c>d))}},get_del_item:function(a,
b,s,k,d){var c=[],h,g,A=0,y,z,B=function(a,b,c){for(var h=0;h<a.length;h++)g=a[h],void 0!==c[g]&&(b[g]=c[g])};angular.forEach(a,function(l,E){h=!1;angular.forEach(b,function(a,b){for(var c=A=0;c<s.length;c++)g=s[c],l[g]===a[g]&&(A+=1);A==s.length&&(h=!0,y=a)});if(h){if(k){z={};var C=k(a,b,l,y);if(void 0!==C){B(s,z,l);for(var e in C)z[e]=C[e];c.push(z)}}}else z={},B(s,z,l),angular.equals(z,{})||(c.push(z),d&&d(a,b,l,b[E],E))});return c},calcValidState2:function(a,b,s,k){s=a.length;for(var d,c=0,h;c<
s;c++){h=a[c];d=!1;for(var g=0,A;g<s;g++)A=a[g],c!==g&&k(A,h)&&(d=!0);h[b]=d}},get2Digits:function(a,b){void 0===b&&(b="");return!_.isNumber(a)?b:Math.floor(100*a)/100},jumpToPage:function(b,l,s){p.check(function(k){_.isFunction(s)&&s(k);k&&setTimeout(function(){l||e.invoke();q.url(b+"/");app.TOOLS.apply(a)},50)})},cert2subject:function(a,b){var l=function(a,b,g){g&&"-"!==g&&(a&&(a+=", "),a=a+b+g);return a},k,d;b||(b="");if(!a)return b;d=a.info&&a.info.subject||{};k=l("","CN=",d["common-name"]);k=
l(k,"C=",d.country);k=l(k,"ST=",d["state-province"]);k=l(k,"L=",d.locality);k=l(k,"O=",d.organization);k=l(k,"OU=",d["organization-unit"]);return(k=l(k,"emailAddress=",d.email))||b},divide:function(a,b,l){void 0===l&&(l=0);return!_.isNumber(a)||!_.isNumber(b)||0===b?l:a/b},divide_floor:function(a,b,l){_.isNumber(l)||(l=0);return!_.isNumber(a)||!_.isNumber(b)||0===b?l:(a-a%b)/b},MBpkt2String:function(a,b){_.isNumber(b)||(b=2);0>b&&(b=2);var l=Math.pow(10,b);return 1048576<=a?Math.floor(a/1048576*l)/
l+" TB":1024<=a?Math.floor(a/1024*l)/l+" GB":a+" MB"},cpuPercentageNum:function(a,b,l,k){_.isNumber(l)||(l=0);_.isBoolean(k)||(k=!1);if(!_.isNumber(a)||!_.isNumber(b)||0===b)return 0;l=Math.pow(10,l);var d=l/2,c=app.TOOLS.divide;k||(d=0);a=(100*c(a,b)+d)*l;return c(Math.floor(a),l)}}}]);app.getLink="";app.skipOnce=!1;
app.controller("PageController",["$scope","$http","$route","$routeParams","$compile","TreeData","$location","MyHttp","$cookies","oneTimeLocker","modificationWarning",function(a,b,t,m,w,u,p,q,e,x,n){var l,r,v=resource_base+"htm/empty.html",s=void 0,k={};b=app.TOOLS.get_scope("menuCtrl");u=u.getTree();var d=function(a,b){var c;for(c=0;c<a.length;c++){if(a[c].link===b)return r=a[c],v=a[c].templateUrl,s=a[c].scripts,!0;if(a[c].children&&0<a[c].children.length&&d(a[c].children,b))return!0}return!1};p=
function(a){if(0<a.length){for(a=a[0];a&&0<a.children.length;)a=a.children[0];r=a;v=a.templateUrl;s=a.scripts}};if(u&&0<u.length){m.page?(l="#/"+m.page,d(u,l)):p(u);l===app.getLink?app.skipOnce=!0:(app.skipOnce=!1,app.getLink=l);e.put("current-page",l.replace(/#\//,""));s&&0<s.length&&angular.forEach(s,function(a){k[a]=0});r&&(r.children&&0<r.children.length)&&(v=r.children[0].templateUrl,s=r.children[0].scripts);b&&"function"===$.type(b.expand)&&app.TOOLS.get_scope("menuCtrl").expand(l);var c=0,
h=function(){q.get({url:v,success:function(b){var c=b.data,h=webOpt.WebCompileWaitCounter;if(!c||""===c)c="<div></div>";(function(){var b=app.TOOLS.get_scope("headerCtrl"),g=app.TOOLS.get_scope("layoutCtrl");0===h?(console.log("Timeout for getScript skip this request"),console.log("downloadCnts: 0 [ "+JSON.stringify(k)+"]"),app.skipOnce=!1,app.getLink=""):app.skipOnce?app.skipOnce=!1:setTimeout(function(){t.current.templateUrl=v;n.resetForm();$("#views").html(w(c)(a));app.transition.Out();app.getLink=
"";b&&b.changeHelpUrlByChangePage&&b.changeHelpUrlByChangePage();n.reset();setTimeout(function(){app.TOOLS.apply(a);g&&_.isFunction(g.check_window_width)&&g.check_window_width()},1E3)},50)})()},error:function(a){c>=webOpt.WebHTTPReqestMaxRetryCounter?console.log("Error for getHTML, retry 3 times but fail"):(h(),c+=1)}})};h()}}]);
app.directive("customDatepicker",["dt",function(a){return{restrict:"A",require:["^?uibDatepicker","^?uibDaypicker"],link:function(b,t,m,w){var u,p=function(a){b.year=a.getFullYear();b.years=[];for(u=b.year-3;u<b.year+4;u++)b.years.push({id:u,displayName:u})};b.weeks=a.dayWeekab;b.months=a.month;b.month=b.datepicker.activeDate.getMonth();b.year;b.years=[];p(b.datepicker.activeDate);b.changeMonth=function(){b.datepicker.activeDate.setMonth(b.month);b.datepicker._refreshView()};b.moveMonth=function(a){b.month+=
a;0>b.month&&(b.month=11,b.year-=1);11<b.month&&(b.month=0,b.year+=1)};b.changeYear=function(){void 0!==b.year&&(b.datepicker.activeDate.setFullYear(b.year),b.datepicker._refreshView())};b.$watch(function(){return b.datepicker.activeDate},function(a){b.month=b.datepicker.activeDate.getMonth();p(b.datepicker.activeDate)})}}}]);
app.directive("confirmsave",["modificationWarning",function(a){var b,t=function(){b||(b=app.TOOLS.get_scope("headerCtrl"));return b};return{restrict:"E",templateUrl:"cc_confirm_save.html",require:"^?ngModel",scope:{ngShow:"="},link:function(b,w,u,p){b.$watch("ngShow",function(b){!0===b&&(a.reset(),"function"===$.type(t().enable_save_warning)&&t().enable_save_warning())})}}}]);
app.directive("ngModification",["modificationWarning",function(a){return{restrict:"A",require:"^?ngModel",link:function(b,t,m,w){var u,p=m.name,q=function(){u&&u();u=b.$watch(function(){return b[p].$dirty},function(b,p){b&&a.modified()})};m.ngModification?b.$watch(m.ngModification,function(a,b){a?q():u&&u()}):q();a.setForm(b[p])}}}]);
app.directive("zeromin",function(){return{restrict:"A",require:"ngModel",link:function(a,b,t,m){b=function(b){var u=a.$eval(t.zeromin)||0;if(!angular.isUndefined(b)&&!(""===b||null===b)&&b<u&&0!==b)m.$setValidity("zeromin",!1);else return m.$setValidity("zeromin",!0),b};m.$parsers.push(b);m.$formatters.push(b)}}});
app.directive("option150",function(){return{restrict:"A",require:"ngModel",link:function(a,b,t,m){a=function(a){var b=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),p=/^(^0.0.0.0|1.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,q=/[^\x00-\u00ff]$/;if(""===a)return m.$setValidity("option150",!0),a;if(!angular.isUndefined(a)&&!(""===a||null===a)){var e=a.split(","),x;for(x in e)if(!e[x].match(b)||e[x].match(p)||e[x].match(q)){m.$setValidity("option150",
!1);return}}m.$setValidity("option150",!0);return a};m.$parsers.push(a);m.$formatters.push(a)}}});app.directive("pgLine1",function(){return{restrict:"E",template:"<hr class='line1' align='center' width='99%' size='1' style='margin-top:5px;margin-button: 5px'></hr>"}});
app.directive("pgListRadio",function(){return{restrict:"EC",scope:{obj:"=obj",ngClass:"=ngClass"},transclude:!0,compile:function(a,b,t,m){return{pre:function(a,b,p,q){a.obj=a.obj||{};a.obj.title=a.obj.title||{str:"",style:""};a.obj.radioList=a.obj.radioList||{data:[],style:""};a.obj.selected=a.obj.selected||""}}},templateUrl:"T_list_radio.html"}});
app.directive("ipv4SubnetPrefix",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,t,m){if(m&&t.ipv4SubnetNetmask){a.$watch(t.ngModel,function(){w()});a.$watch(t.ipv4SubnetNetmask,function(){w()});a.$watch(t.ipv4SubnetPrefix,function(a){a?w():m.$setValidity("ipv4SubnetPrefix",!0)});var w=function(){var b=m.$viewValue,p=a.$eval(t.ipv4SubnetNetmask),b=app.TOOLS.validation.ipv4_chkIPMask(b,p);m.$setValidity("ipv4SubnetPrefix",b)}}}}});
app.directive("compareIpRangeInlandhcp",function(){return{require:"ngModel",scope:{otherModelValue:"=compareIpRangeInlandhcp"},link:function(a,b,t,m){m.$validators.compareIpRangeInlandhcp=function(b){"function"==typeof a.stateRef&&a.stateRef();var u=!0,p=[],q=[],e=[],x=[],n=[],l=[];if(void 0===a.otherModelValue||void 0===b)u=!0;else{p=a.otherModelValue.split(".");q=b.split(".");n=document.location.host.split(".");for(b=0;4>b;b++)e[b]=parseInt(p[b],10),x[b]=parseInt(q[b],10),l[b]=parseInt(n[b],10);
for(b=0;4>b;b++)if(x[b]>e[b]){u=!0;break}else if(x[b]<e[b]){u=!1;break}l[0]===e[0]&&l[0]===x[0]&&l[1]===e[1]&&l[1]===x[1]&&l[2]===e[2]&&l[2]===x[2]&&l[3]>=e[3]&&l[3]<=x[3]&&(u=!1)}return u};a.$watch("otherModelValue",function(){m.$validate()})}}});
app.directive("compareIpRangeBytype",function(){return{require:"ngModel",scope:{otherModelValue:"=compareIpRangeBytype",stateRef:"&validRefTo"},link:function(a,b,t,m){m.$validators.compareIpRangeBytype=function(b){var u=!0,p=[],q=[],e=[],x=[],n=[],l=[],r=0,v=0,s=0,k=0,d=0,c=1,h=0,c=d=0,q=p=q="";a.otherModelValue&&(q=a.otherModelValue.split("#"),p=q[0].toLowerCase(),q=q[1]);if(!a.otherModelValue||!b||!p||!q)u=!0;else if("ipv4"===p){p=q.split(".");q=b.split(".");for(d=0;4>d;d++)if(e[d]=parseInt(p[d],
10),x[d]=parseInt(q[d],10),x[d]>e[d]){u=!0;break}else if(x[d]<e[d]){u=!1;break}}else if("ipv6"===p){p=q.split(":");q=b.split(":");d=p.length-1;c=q.length-1;""===p[0]&&(p[0]="0");""===q[0]&&(q[0]="0");""===p[d]&&(p[d]="0");""===q[c]&&(q[c]="0");for(d=0;d<p.length;d++)if(""===p[d]){r=1;s=d;h=8-p.length;break}if(1===r)for(d=0;d<p.length;d++)if(d===s){n[d]="0";for(c=1;c<=h;c++)n[s+c]="0"}else d>s?n[d+h]=p[d]:n[d]=p[d];for(d=h=0;d<q.length;d++)if(""===q[d]){v=1;k=d;h=8-q.length;break}if(1===v)for(d=0;d<
q.length;d++)if(d===k){l[d]="0";for(c=1;c<=h;c++)l[k+c]="0"}else d>k?l[d+h]=q[d]:l[d]=q[d];for(d=0;8>d;d++)if(parseInt(l[d],16)>parseInt(n[d],16)){u=!0;break}else if(parseInt(l[d],16)<parseInt(n[d],16)){u=!1;break}}else u=!1;return u};a.$watch("otherModelValue",function(){m.$validate()})}}});
app.directive("compareIpRange",function(){return{require:"ngModel",scope:{otherModelValue:"=compareIpRange",stateRef:"&validRefTo"},link:function(a,b,t,m){m.$validators.compareIpRange=function(b){"function"==typeof a.stateRef&&a.stateRef();var u=!0,p=[],q=[],e=[],x=[];if(void 0===a.otherModelValue||void 0===b)u=!0;else{p=a.otherModelValue.split(".");q=b.split(".");for(b=0;4>b;b++)e[b]=parseInt(p[b],10),x[b]=parseInt(q[b],10);for(b=0;4>b;b++)if(x[b]>e[b]){u=!0;break}else if(x[b]<e[b]){u=!1;break}}return u};
a.$watch("otherModelValue",function(){m.$validate()})}}});
app.directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo",stateRef:"&validRefTo",ngCompare:"="},link:function(a,b,t,m){var w=!0;m.$validators.compareTo=function(b){var p=!1,q=!0;if(!w)return!0;"function"==typeof a.stateRef&&(q=a.stateRef(),void 0===q&&(q=!0));if(!1===q||q&&b==a.otherModelValue)p=!0;return p};t.ngCompare&&a.$watch("ngCompare",function(a){w=a?!0:!1;m.$validate()});a.$watch("otherModelValue",function(){m.$validate()})}}});
app.directive("compareIpBymask",function(){return{require:"ngModel",scope:{otherModelValue:"=compareIpBymask",stateRef:"&validRefTo"},link:function(a,b,t,m){m.$validators.compareIpBymask=function(b){var u=!0;"function"==typeof a.stateRef&&(u=a.stateRef()||!0);if(!1===u)return!0;var u=!0,p=a.otherModelValue,q;if(void 0===b||void 0===p||null===p||""===b||""===p)return!0;if("number"==typeof p||"string"==typeof p&&!p.indexOf("."))p=app.TOOLS.netmask.int2Inet(parseInt(p,10));b=b.split(".");if(4>b.length||
""===b[3])return!1;p=p.split(".");if(4>p.length)return!1;var e=Array(4);for(q=0;q<p.length;q++)""!==p[q]&&(e[q]=parseInt(p[q],10).toString(2));q=e.toString();for(p=p=0;35>p&&"0"!=q[p];p++);e=Array(4);for(q=0;q<b.length;q++)if(""!==b[q]){e[q]=parseInt(b[q],10).toString(2);for(var x=e[q].length;8>x;x++)e[q]="0"+e[q]}b=e.toString();for(e=q=0;35>p;p++)"0"==b[p]?e++:"1"==b[p]&&q++;if(0===e||0===q)u=!1;return u};a.$watch("otherModelValue",function(){m.$validate()})}}});
app.directive("checkIpv4Bymask",function(){return{require:"ngModel",scope:{otherModelValue:"=checkIpv4Bymask",stateRef:"&validRefTo"},link:function(a,b,t,m){m.$validators.checkIpv4Bymask=function(b){var u=!0;"function"==typeof a.stateRef&&(u=a.stateRef()||!0);if(!1===u)return!0;u=!0;u=a.otherModelValue;return void 0===b||void 0===u||null===u||""===b||""===u?!0:b===u&&"0.0.0.0"!==b&&"0.0.0.0"!==u?!1:"0.0.0.0"===b&&"0.0.0.0"===u?!0:"0.0.0.0"===b&&"0.0.0.0"!==u||"0.0.0.0"!==b&&"0.0.0.0"===u?!1:u=app.TOOLS.validation.ipv4_chkIPMask(b,
u)};a.$watch("otherModelValue",function(){m.$validate()})}}});
app.directive("checkMaskByipv4",function(){return{require:"ngModel",scope:{otherModelValue:"=checkMaskByipv4",stateRef:"&validRefTo"},link:function(a,b,t,m){m.$validators.checkMaskByipv4=function(b){var u=!0;"function"==typeof a.stateRef&&(u=a.stateRef()||!0);if(!1===u)return!0;u=!0;u=a.otherModelValue;return void 0===u||void 0===b||null===b||""===u||""===b?!0:u===b&&"0.0.0.0"!==u&&"0.0.0.0"!==b?!1:"0.0.0.0"===u&&"0.0.0.0"===b?!0:"0.0.0.0"===u&&"0.0.0.0"!==b||"0.0.0.0"!==u&&"0.0.0.0"===b?!1:u=app.TOOLS.validation.ipv4_chkIPMask(u,
b)};a.$watch("otherModelValue",function(){m.$validate()})}}});app.directive("checkIpv4Multicast",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,t,m){if(m){a.$watch(t.ngModel,function(){w()});t.$observe("checkIpv4Multicast",function(a){w()});var w=function(){var a=m.$viewValue,b=!1,b="0.0.0.0"===a?!0:app.TOOLS.validation.ipv4_chkMulticastIP(a);m.$setValidity("checkIpv4Multicast",b)}}}}});
app.directive("chkIpv6Bylength",function(){return{require:"ngModel",scope:{otherModelValue:"=chkIpv6Bylength",stateRef:"&validRefTo",disabled:"=disalbedIpv6Bylength"},link:function(a,b,t,m){var w,u=!1;m.$validators.chkIpv6Bylength=function(b){var q=!0;"function"==typeof a.stateRef&&(q=a.stateRef()||!0);if(!1===q||u)return!0;var q=!0,q=a.otherModelValue,e="";if(void 0===b||void 0===q||null===q||""===b||""===q)return!0;for(e=app.TOOLS.ipv6.toFullV6Addr(b);0<=e.search(":");)e=e.replace(":","");return q=
0===parseInt(e,16)&&0===parseInt(q,16)?!0:app.TOOLS.validation.ipv6_chkPrefixLength(b,q)};_.isBoolean(a.disabled)&&(w=a.$watch(function(){return a.disabled},function(a){a!==u&&(u=a,m.$validate())}));a.$watch("otherModelValue",function(){m.$validate()});a.$on("$destroy",function(){w&&w()})}}});
app.directive("chkLengthByipv6",function(){return{require:"ngModel",scope:{otherModelValue:"=chkLengthByipv6",stateRef:"&validRefTo"},link:function(a,b,t,m){m.$validators.chkLengthByipv6=function(b){var u=!0;"function"==typeof a.stateRef&&(u=a.stateRef()||!0);if(!1===u)return!0;var u=!0,u=a.otherModelValue,p="";if(void 0===u||void 0===b||null===b||""===u||""===b)return!0;for(p=app.TOOLS.ipv6.toFullV6Addr(u);0<=p.search(":");)p=p.replace(":","");return u=0===parseInt(p,16)&&0===parseInt(b,16)?!0:app.TOOLS.validation.ipv6_chkPrefixLength(u,
b)};a.$watch("otherModelValue",function(){m.$validate()})}}});app.directive("notequal",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,t,m){if(m){a.$watch(t.ngModel,function(){w()});t.$observe("notequal",function(a){w()});var w=function(){var a=m.$viewValue,b=t.notequal;m.$setValidity("notequal",!a||!b||a!=b)}}}}});
app.directive("checkspace",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,t,m){if(m){a.$watch(t.ngModel,function(){w()});t.$observe("checkspace",function(a){w()});var w=function(){var a=m.$viewValue,b=!1,b=/^[^\s]*$/,q=/[^\x00-\u00ff]$/,b=void 0===a?!0:a.match(b)&&!a.match(q)?!0:!1;m.$setValidity("checkspace",b)}}}}});
app.directive("checkpassword",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,t,m){if(m){a.$watch(t.ngModel,function(){w()});t.$observe("checkpassword",function(a){w()});var w=function(){var a=m.$viewValue,b=!1,b=/(^.*$)/,q=/(^[^%&\\"'\s]*$)/,e=/[^\x00-\u00ff]$/,b=void 0===a?!0:a.match(b)&&a.match(q)&&!a.match(e)?!0:!1;m.$setValidity("checkpassword",b)}}}}});
app.directive("checkinterport",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,t,m){if(m){a.$watch(t.ngModel,function(){w()});t.$observe("checkinterport",function(a){"check"===a?w():m.$setValidity("checkinterport",!0)});var w=function(){var a=!1,a="8008"===m.$viewValue?!1:!0;m.$setValidity("checkinterport",a)}}}}});
app.directive("pgToggle",function(){return{restrict:"E",scope:{value:"=ngModel",style:"@style",ngStyle:"=ngStyle",ngClass:"=ngClass","class":"@class"},compile:function(a,b,t,m){var w={"true":"themes/img/icon/on.png","false":"themes/img/icon/off.png"};return{pre:function(a,b,q,e){void 0===a.value&&(a.value="false");a.icon=w}}},templateUrl:"Dir_toggle.html"}});
app.directive("pgPwd",["passwordComplex",function(a){return{restrict:"E",require:"^?ngModel",replace:!0,scope:{model:"=ngModel",required:"=ngRequired",isplain:"=ngIsPlain",complexity:"=ngNeedComplexity",disabled:"=ngDisabled",maxLength:"=ngMaxlength",legalChar:"=ngLegalChar"},link:function(b,t,m,w){b.invalid=!1;b.isplain=void 0!==b.isplain?b.isplain:!1;b.required=void 0!==b.required?b.required:!1;b.complexity=void 0!==b.complexity?b.complexity:!1;b.disabled=void 0!==b.disabled?b.disabled:!1;b.legalChar=
void 0!==b.legalChar?b.legalChar:!1;b.placeholder=m.placeholder?m.placeholder:"";b.pwd=b.model||"";b.id=m.id?"_"+m.id:"";b.name="sub_pwd"+(m.name?"_"+m.name:"");var u=function(a,e){var x=b.name,n=!0,l=!0;switch(a){case "required":n=e;break;case "complexity":l=e;break;case "noinvalid":case "invalid":break;default:return}b.invalid=!1;b[x]&&(b[x].pwd_encry.$setValidity("required",n),b[x].pwd_plain.$setValidity("required",n),b[x].pwd_encry.$setValidity("complexity",l),b[x].pwd_plain.$setValidity("complexity",
l));b.invalid=!e},p=function(){if(b.disabled)return u("noinvalid",!0),!0;if(void 0===b.pwd||null===b.pwd)return u("invalid",!1),!1;if(b.required&&0===b.pwd.length)return u("required",!1),!1;if(b.complexity&&0===a.getStrength({pwd:b.pwd}))return u("complexity",!1),!1;u("noinvalid",!0);return!0};b.change=function(){w&&(w.$setViewValue(b.pwd),w.$commitViewValue());m.ngChange&&b.$eval(m.ngChange);p()};b.$watch(function(){return b.isplain},function(a){p()});b.$watch(function(){return b.required},function(a){p()});
b.$watch(function(){return b.complexity},function(a){p()});b.$watch(function(){return b.disabled},function(a){p()});b.$watch(function(){return b.legalChar},function(a){p()});p()},templateUrl:"T_input_pwd.html"}}]);
app.directive("ngHeaderCheckboxChk",["modificationWarning",function(a){return{restrict:"A",replace:!0,require:"?ngModel",link:function(b,t,m,w){var u=[],p=!1;b.col.clickHeaderChk=!1;b.col.colDef.allSelected=!1;var q=function(){b.$watch(function(){return u.length},function(e,x){x>e&&!0!==b.col.colDef.skipModified&&a.modified();b.gridFuns.chkHeaderChkBox(u,b.col)});b.$watch(function(){return b.col.colDef.allSelected},function(a){var x=[];!0===b.col.clickHeaderChk&&(b.col.clickHeaderChk=!1,angular.forEach(u,
function(a,b){x.push({entity:a,rowIndex:b})}),b.gridFuns.headerChkBoxClick(x,b.col))})};b.$watch(function(){return b.$eval(b.col.colDef.data)},function(a){a&&(u=b.$eval(b.col.colDef.data),p||(q(),p=!0))})}}}]);
app.directive("ngCheckboxChk",[function(){return{restrict:"A",replace:!0,require:"?ngModel",link:function(a,b,t,m){var w=a.$eval("col"),u=a.$eval("row"),p=a.$eval("renderedRows");w.colDef&&w.colDef.data&&(b=a.$eval(w.colDef.data),p=[],angular.forEach(b,function(a,b){p.push({rowIndex:b,entity:a})}));a.$watch(function(){return u.entity[w.field]},function(){a.gridFuns.chkHeaderChkBox(p,w);w&&w.colDef.changed&&w.colDef.changed(u)})}}}]);
app.directive("noDirty",function(){return{require:"ngModel",link:function(a,b,t,m){m.$setDirty=angular.noop}}});
app.controller("mainCtrl",["$scope","MyHttp","$templateCache","ciscoDesign","modelInfo","passwordComplex","userAccessRight","dt",function(a,b,t,m,w,u,p,q){a.languageProvider.init();m.refactory();a.normal_show=!0;a.loading_message=a.DICT("Page_Loading_Msg");a.custom_loading_message="";var e=function(a){webOpt=a||{WebHTTPReqestMaxRetryCounter:3,WebCompileWaitCounter:10,WebCompileWaitDuration:1E3}};b.get({url:resource_base+"config/config.json",success:function(a){e(a&&a.data)},error:function(a){e()}});
b.post({url:resource_base+"data/aaa.json",method:"get_password_complexity",procBackground:!0,success:function(a){a.data&&a.data.result&&(a=(a.data.result["password-complex-setting"]||{})["password-complex"]||void 0)&&u.update_config({minimum_length:a["minimum-length"],minimum_number_character_classes:a["minimum-number-character-classes"],complex_enable:a["complex-enable"]})}});b.post({url:resource_base+"data/time.json",method:"get_time",procBackground:!0,success:function(a){var b="",l={};a.data&&
a.data.result&&(l=a.data.result);l.system&&(l.system.clock&&l.system.clock["timezone-name"])&&(b=l.system.clock["timezone-name"]);q.setTimezoneName(b)},error:function(){}})}]);
app.controller("Controller_USB_list",["$scope","rpcFns",function(a,b){a.usblist_init=function(){a.usb_sel_file_ctx.usb_dev=a.usb_sel_file_ctx.usbDevList[0];a.get_usblist();a.usblist_reset_path()};a.usblist_reset_path=function(){a.usb_sel_file_ctx.path=[]};a.get_usblist=function(){var t=a.usb_sel_file_ctx,m=!1;if(t&&t.selitem&&(t.selitem[0]&&!1==t.selitem[0].directory||1<t.selitem.length))m=!0;if(!m)if(m=a.usb_sel_file_ctx.usb_dev){var w=!1,u="",p="";t&&(t.file&&t.selitem&&t.selitem[0]&&t.selitem[0].directory)&&
(u=t.file["file-name"],"back"===t.file.FN?t.path.pop():t.path.push(u),p=t.path.join("/"),0<t.path.length&&(w=!0));b.RPC_usblist(m,p).then(function(b){(b=b["file-names"])?(w&&b.unshift({"file-name":"(To Upper Directory)",directory:!0,FN:"back"}),a.ctx.USB_list=b):(t.path.pop(),Log(ERROR,"Get USB List error, file path: "+p))})}else a.ctx.USB_list=[]};a.filename_rule=function(a){var b=a["file-name"];return!0===a.directory&&angular.isUndefined(a.FN)?b+"/":b};a.udpate_selected_file=function(a){var b=a.selitem;
1===b.length?b[0].directory?a.file=b[0]:(a.file=b[0],b="",0<a.path.length&&(b=a.path.join("/")+"/"),a.file["full-file-name"]=b+a.file["file-name"]):a.file=void 0}}]);app.controller("safariCtrl",["$scope","$uibModalInstance","url",function(a,b,t){a.url=t;a.close=function(){b.close()}}]);app.controller("delIntfAlertCtrl",["$scope","$uibModalInstance","obj",function(a,b,t){a.model=t;a.ok=function(){b.close()};a.cancel=function(){b.dismiss("cancel")}}]);
app.service("userAccessRight",["$cookies",function(a){var b="",t=!1;this.get=function(){b=a.get("attributes");if(local_database||emulator)b="RW";return b};this.russia=function(){return t="1"===a.get("ru")}}]);app.config([function(){var a=function(a){return"string"===typeof a?a.replace(/-/g,"_"):a},b=function(a){return"string"===typeof a?a.replace(/_/g,"-"):a},t=function(a,b,p,q){b||(b="array"==q?[]:{});p||console.error("obj_key_rename: renameFn not defined");var e,x=void 0,n;for(n in a){var x=q=e=a[n],l=Object.prototype.toString.call(e);"[object Object]"===l?q=t(e,x,p):"[object Array]"===l&&(q=t(e,x,p,"array"));e=p(n)||n;b[e]=q;e!==n&&void 0!==b[n]&&delete b[n]}return b},m=function(b,m){m||(m=a);return t(b,
b,m)};app.modelhelper={};app.modelhelper.obj_rename_inplace=m;app.modelhelper.obj_key_rename=t;app.modelhelper.db2webFn=function(b){b="string"!==typeof b?angular.copy(b):JSON.parse(b);return b=m(b,a)};app.modelhelper.web2dbFn=function(a){return a=m(a,b)};app.modelhelper.add=function(a,b,p,q){q=q||{createFormExists:!0,maxEntry:50,Default:!0};var e=a.length;q.gridopt_ref&&(q.gridopt_ref.ngGrid&&q.gridopt_ref.ngGrid.filteredRows&&q.gridopt_ref.ngGrid.filteredRows.length)&&(e=q.gridopt_ref.ngGrid.filteredRows.length);
if(e>=q.maxEntry)alert("Max entry "+q.maxEntry+" items are exceeded"+(q.Default?" (Default)":""));else{if(b)var x=b(a);else console.log("Warning: add_empty_cb() not exist");p&&p(a,{newItem:x})}};app.modelhelper.del=function(a,b,p,q,e){e=function(){for(var e=[],l=a.length-1,r;0<=l;l--)r=a[l],app.rshelper.rs_get(r).isChecked&&(b&&b(r,a),r=a.splice(l,1),p&&p(r[0],e,a))};if(q){var x=[];angular.forEach(a,function(a,b){app.rshelper.rs_get(a).isChecked&&x.push(a)});q(x,e)}else e()}}]);
app.config([function(){var a=new function(){this.rs_set=function(a,t){var m=a.$$rowstate;t&&(void 0!==t.isChecked&&(m.isChecked=t.isChecked),void 0!==t.isEdit&&(m.isEdit=t.isEdit))};this.rs_get=function(a){a=a.$$rowstate;return!a?{isChecked:!1,isEdit:!1}:{isChecked:a.isChecked,isEdit:a.isEdit}};this.rs_clean=function(a){for(var t=0,m;t<a.length;t++)m=a[t],m.$$rowstate&&delete m.$$rowstate};this.rs_event_trig=function(a,t,m){if("UNCHECK_LIST_EVENT"==t)if(m){t=0;for(var w;t<m.length;t++){w=m[t];if(a=
w.$$rowstate)a.isChecked=!1,a.isEdit=!1;!0===w.checked&&(w.checked=!1)}}else console.error("UNCHECK_LIST_EVENT: missing arrRef");else a||console.error("rs_event_trig: item not exist"),a.$$rowstate=a.$$rowstate||{},a=a.$$rowstate,"ADD_ITEM_EVENT"==t?(a.isChecked=!0,a.isEdit=!0):"SEL_ITEM_EVENT"==t?a.isChecked=!0:"DESEL_ITEM_EVENT"==t?(a.isChecked=!1,a.isEdit=!1):"EDIT_ITEM_EVENT"==t?(a.isChecked=!0,a.isEdit=!0):"VIEW_ITEM_EVENT"==t?a.isEdit=!1:"DEL_ITEM_EVENT"==t?(a.isChecked=!1,a.isEdit=!1):console.error("rs_event_trig: unknown EVENT:"+
t)};return this};app.rshelper=a}]);app.controller("layoutCtrl",["$scope","$window",function(a,b){var t;a.collapsed=!1;a.windowWidth=b.innerWidth;var m=function(){t||(t=app.TOOLS.get_scope("headerCtrl"));return t};a.toggle_nav=function(b){a.collapsed=!a.collapsed;b||m().compute_width_by_zoom()};var w=function(){a.windowWidth!==b.innerWidth&&a.check_window_width()};a.check_window_width=function(){a.windowWidth=b.innerWidth;a.collapsed?1035<a.windowWidth&&a.toggle_nav(!0):934>a.windowWidth&&a.toggle_nav(!0);m().compute_width_by_zoom()};
angular.element(b).on("resize",w);a.$on("$destroy",function(){angular.element(b).off("resize",w)})}]);app.controller("backgroundAppCtrl",["$scope","MyHttp","$q",function(a,b,t){a.firmware_lib=function(){var a={fwAUAvailableVersion:"",fwAULastCheckTime:"",fwsVersion:"",signAUAvailableVersion:"",signAULastCheckTime:"",signVersion:"",ddAUAvailableVersion:"",ddAULastCheckTime:"",ddsBuildinVersion:""},w=!1,u=0,p=function(){return b.post({method:"action",procBackground:!0,params:{rpc:"check-latest-version"},error:function(a){console.log("check latest version error "+a.status);w=!1;l(w,"check latest version error")}})},
q=function(){return b.post({url:resource_base+"data/automatic_updates.json",method:"get_auto_update",procBackground:!0,error:function(a){console.log("get auto update error "+a.status);u=0}})},e=function(a){a||(a={});var b={},k=a["firmware-state"]||{},d=((a.firmware||{})["auto-update"]||{}).notify||!1,c=a["signature-state"]||{},h=((a.signature||{})["auto-update"]||{}).notify||!1,g=a["dongle-driver-state"]||{};a=((a["dongle-driver"]||{})["auto-update"]||{}).notify||!1;b.fwAUAvailableVersion=k["available-version"]||
"";b.fwAULastCheckTime=void 0!==k["last-check-time"]?k["last-check-time"]:"";b.fwsVersion=k.version||"";b.fwNotify=d;b.signAUAvailableVersion=c["available-version"]||"";b.signAULastCheckTime=void 0!==c["last-check-time"]?c["last-check-time"]:"";b.signVersion=c.version||"";b.signNotify=h;b.ddAUAvailableVersion=g["available-version"]||"";b.ddAULastCheckTime=void 0!==g["last-check-time"]?g["last-check-time"]:"";b.ddsBuildinVersion=g["buildin-version"]||"";b.ddNotify=a;return b},x=function(){!0===w&&
t.all([q()]).then(function(b){b=e(b[0]&&b[0].data&&b[0].data.result||{});console.log("edit: "+b.fwAULastCheckTime+" orig: "+a.fwAULastCheckTime);b.fwAULastCheckTime&&b.fwAULastCheckTime!==a.fwAULastCheckTime?b.fwAUAvailableVersion&&b.fwAUAvailableVersion!==a.fwsVersion&&(u=0,n(!0,"Alert"),r()):u=setTimeout(x,1E4)})},n=function(a,b){var k=app.TOOLS.get_scope("headerCtrl");k&&"function"===$.type(k.enable_alert_waring)&&k.enable_alert_waring({tip_info:"New Firmware is available on Cisco.com, click to go to File Management page to upgrade",
jumpto:"#/Admin_File_Management",display_name:b||"Alert",isCurrentInfo:a})},l=function(a,b){var k=app.TOOLS.get_scope("admin_filemanage_main");k||(k=app.TOOLS.get_scope("automaticUpdateCtrl"));k&&(k.invokeCheckingSuccessCbk&&"function"===$.type(k.invokeCheckingSuccessCbk))&&k.invokeCheckingSuccessCbk(a,b)},r=function(a){var b=app.TOOLS.get_scope("automaticUpdateCtrl");b&&"function"===$.type(b.hasNewVersionCbk)&&b.hasNewVersionCbk(a)};return{check_firmware:function(){var b=!1;0!==u&&clearTimeout(u);
t.all([q(),p()]).then(function(s){a=e(s[0]&&s[0].data&&s[0].data.result||{});s=(s=s[1]&&s[1].data&&s[1].data.result||{})&&s.output||{};var k=s.errstr;w=0===s.code?!0:!1;l(w,k);a.fwAUAvailableVersion&&a.fwsVersion&&a.fwAUAvailableVersion!==a.fwsVersion?(r(!0),n(!0,"Alert"),b=!1):b=!0;b&&x()});return"start"},stop_polling:function(){0!==u&&(clearTimeout(u),u=0)}}}()}]);app.controller("appCtrl",["$scope","$uibModal","ngDialog",function(a,b,t){var m;a.openSafariDownPage=function(m){b.open({animation:a.animationsEnabled,templateUrl:"safari_download.html",controller:"safariCtrl",size:"lg",backdrop:"static",resolve:{url:function(){return m}}})};a.openDelInftAlertPage=function(w){w?(m=b.open({animation:a.animationsEnabled,templateUrl:"del_intf_alert.html",controller:"delIntfAlertCtrl",size:"lg",backdrop:"static",resolve:{obj:function(){return w}}}),m.result.then(function(){"function"===
typeof w.cbk&&w.cbk(!0)},function(a){"function"===typeof w.cbk&&w.cbk(!1)})):Log(ERROR,"openDelInftAlertPage is failure obj is "+JSON.stringify(w))};a.openDialogBox=function(a){if(!a||!a.msg)Log(ERROR,"openDialogBox is failure obj is "+JSON.stringify(a));else{var b=void 0;if(_.isNumber(a.width)||_.isString(a.width))b=a.width;t.open({template:"dialogBox.html",closeByDocument:!1,width:b,resolve:{obj:function(){return a}},controller:"dialogBoxCtrl",preCloseCallback:function(b){var q;_.isFunction(a.cbk)&&
("$closeButton"===b&&(q=!1),a.cbk(q,b))}})}};a.openAlertBox=function(a){if(!a||!a.msg&&!a.templateUrl)Log(ERROR,"openAlertBox is failure obj is "+JSON.stringify(a));else{var b=void 0;if(_.isNumber(a.width)||_.isString(a.width))b=a.width;t.open({template:"alertBox.html",closeByDocument:!1,width:b,resolve:{obj:function(){return a}},controller:"alertBoxCtrl",preCloseCallback:function(b){var q=b;_.isFunction(a.cbk)&&("$closeButton"===b&&(q=!1),a.cbk(q,b))}})}};a.openNotificationBox=function(a){if(!a||
!a.msg)Log(ERROR,"openNotificationBox is failure obj is "+JSON.stringify(a));else{var b=void 0;if(_.isNumber(a.width)||_.isString(a.width))b=a.width;t.open({template:"notificationBox.html",closeByDocument:!1,width:b,resolve:{obj:function(){return a}},controller:"notificationBoxCtrl",preCloseCallback:function(b){var q;_.isFunction(a.cbk)&&("$closeButton"===b&&(q=!1),a.cbk(q,b))}})}};a.openWizardBox=function(a){!a||!a.list||!a.title||!a.model?Log(ERROR,"openWizardBox is failure obj is "+JSON.stringify(a)):
t.open({template:"wizard.html",width:"70%",closeByDocument:!1,resolve:{obj:function(){return a}},controller:"wizardCtrl",preCloseCallback:function(b){_.isFunction(a.cbk)&&a.cbk("$closeButton"===b||"close"===b?!1:!0,b)}})}}]);app.controller("sessionCtrl",["$scope","$uibModal","$location","UserSession","MyHttp","userAccessRight","$cookies",function(a,b,t,m,w,u,p){var q,e=0,x=0,n=18E5,l=177E4,r="guest";"RW"===u.get()&&(r="admin");var v=function(b){b||(b={});b=b["web-session-timeout"]||{};var d=18E5;_.isNumber(b[r])&&(d=6E4*b[r]);n=d;l=d-3E4;0>l&&(l=0);a.resetTimer()};a.getSessionTime=function(a){w.post({url:resource_base+"data/aaatrans_web_session_timeout.json",procBackground:a,method:"get_web_session_timeout",success:function(b){a||
v(b&&b.data&&b.data.result)},error:function(b){a||v()}})};var s=function(){m.logout();p.put("session_timeout","true");Log(DEBUG,location.protocol+"//"+location.host);location.href=location.protocol+"//"+location.host};a.dump=function(){Log(ERROR,"[session timeout] active time (ms): "+((new Date).getTime()-q));Log(ERROR,"[session timeout] pop warning dialog time (s): "+l/1E3);Log(ERROR,"[session timeout] timeout time (s): "+n/1E3);Log(ERROR,"[session timeout] sessionTimeoutId : "+e);Log(ERROR,"[session timeout] sessionRemainTimeoutId : "+
x)};a.resetTimer=function(){void 0!==e&&(clearTimeout(e),e=void 0);void 0!==x&&(clearTimeout(x),x=void 0);0===l?Log(DEBUG,"[session timeout] session timeout is zero, keep webpage"):(q=(new Date).getTime(),e=setTimeout(function(){Log(DEBUG,"[session timeout] time(sec) : popWarningbox"+parseInt(((new Date).getTime()-q)/1E3,10));a.openSessionTimeoutWarningBox();e=void 0},l))};a.openSessionTimeoutWarningBox=function(){b.open({templateUrl:"session_timeout.html",controller:"sessionAlertCtrl",size:"550",
backdrop:"static",resolve:{countdownTimeSec:function(){return Math.floor(30)}}}).result.then(function(b){switch(b.action){case "resume":a.getSessionTime(!0);break;case "cancel":x=setTimeout(function(){s()},1E3*b.remainTime);break;default:s()}},function(a){s()})};a.getSessionTime();a.$on("$destroy",function(){void 0!==e&&(clearTimeout(e),e=void 0)})}]);
app.controller("sessionAlertCtrl",["$scope","$uibModalInstance","countdownTimeSec",function(a,b,t){var m=void 0;a.countdownTimeSec=t;a.note=a.DICT("Session_Timeout_Note",{"%s":a.countdownTimeSec});a.reset=function(){m&&clearInterval(m);b.close({action:"resume"})};a.cancel=function(){m&&clearInterval(m);b.close({action:"cancel",remainTime:a.countdownTimeSec})};m=setInterval(function(){a.countdownTimeSec-=1;0===a.countdownTimeSec&&(m&&clearInterval(m),b.close({action:"timeout"}));a.note=a.DICT("Session_Timeout_Note",
{"%s":a.countdownTimeSec});app.TOOLS.apply(a)},1E3)}]);app.controller("headerCtrl",["$scope","$cookies","UserSession","$route","$window","modelInfo","MyHttp","$q","$location","userAccessRight",function(a,b,t,m,w,u,p,q,e,x){var n=app.TOOLS.getVal,l=app.TOOLS.getResponse,r=0,v=x.russia(),s=u.get_pid(),k;a.user_style={"max-width":"315px"};a.title_style={"max-width":"300px"};a.multiLang_style={};a.jumpToPage=app.TOOLS.jumpToPage;a.langOptions={list:[],select:void 0,displayName:"",change:function(){d();a.languageProvider.change_language(this.select)},init:function(){this.list=
a.languageProvider.getLangList();this.select=a.languageProvider.getCurrLang();d()}};var d=function(){a.langOptions.displayName="";angular.forEach(a.langOptions.list,function(b){b.lang===a.langOptions.select&&(a.langOptions.displayName=b.displayName)})},c=function(b){b||(b={});a.hostname=(b.system||{}).hostname||""};b.put("model_info",s);a.langOptions.init();var h=function(a){a||(a={});var c={version:""};a=a["image-state"]&&a["image-state"].firmware||{};a=a.images&&a.images.image||[];for(var g=0;g<
a.length;g++)if("active"===a[g].active){c.version=a[g].version||"";break}b.put("fwver",c.version);return c};u=function(a){a||(a={});this.enable=n(a.enable,!1);this.tip_info=n(a.tip_info,"");this.title=n(a.title,"");this.display=n(a.display,!0);this.jumpto=n(a.jumpto,"");this.blinking=!0;this.width=void 0!==a.width?a.width:"0px";this.focus=!1;this.class_name=n(a.class_name,"")};var g=function(){0!==r&&clearTimeout(r);angular.forEach(a.warnings,function(a){a.enable&&a.blinking&&(a.display=!a.display)});
"$apply"!=a.$root.$$phase&&"$digest"!=a.$root.$$phase&&a.$apply();r=setTimeout(g,1E3)},A=function(){var b=!0;angular.forEach(a.warnings,function(a){a.enable&&a.blinking&&(b=!1)});b?0!==r&&(clearTimeout(r),r=0):0===r&&g()},y=function(b){if(b){var c,g=!1;if(!a.warnings[b]||a.warnings[b].blinking)angular.forEach(a.warnings,function(a,h){h===b&&(c=a);!0===a.enable&&h!==b&&(g=a.display)}),Log(DEBUG,JSON.stringify(c)),c.display=g}};a.title="";a.hostname="";a.title_width=0;var z=function(){var b=a.hostname?
"-"+a.hostname:"";if(v)switch(s){case "RV340W":a.title="RV340W"+b;document.title="RV340W Dual WAN Gigabit Router with Wireless";break;case "RV340":a.title="RV340"+b;document.title="RV340 Dual WAN Gigabit Router";break;case "RV345":a.title="RV345"+b;document.title="RV345 Dual WAN Gigabit Router";break;case "RV345P":a.title="RV345P"+b;document.title="RV345P Dual WAN Gigabit Router with PoE";break;default:a.title="RV340"+b,document.title="RV340 Dual WAN Gigabit Router",Log(ERROR,'PID Error use default title "'+
a.title+'"')}else switch(s){case "RV340W":a.title="RV340W"+b;document.title="RV340W Dual WAN Gigabit VPN Router with Wireless";break;case "RV340":a.title="RV340"+b;document.title="RV340 Dual WAN Gigabit VPN Router";break;case "RV345":a.title="RV345"+b;document.title="RV345 Dual WAN Gigabit VPN Router";break;case "RV345P":a.title="RV345P"+b;document.title="RV345P Dual WAN Gigabit VPN Router with PoE";break;default:a.title="RV340"+b,document.title="RV340 Dual WAN Gigabit VPN Router",Log(ERROR,'PID Error use default title "'+
a.title+'"')}a.title_width=app.TOOLS.computeWidthWithStyle(a.title,{fontSize:"19px"});a.compute_width_by_zoom()};a.warnings={warning:new u({enable:!1,jumpto:"Admin_File_Management",class_name:"header-icon icon-warning",title:a.DICT("Alert"),width:"45px"}),save:new u({enable:!1,jumpto:"Admin_Config_Management",class_name:"header-icon icon-save",title:a.DICT("Header_Save_Note"),width:"45px"})};var B=void 0;a.compute_width_by_zoom=function(){var b=a.collapsed,c=w.innerWidth,g,h=!1;a.warnings.warning.width=
"45px";a.warnings.save.width="45px";g=c;b||(g-=250);1E3<=c?(g-=512,h=!0):g=930<=c?g-320:780<=c?g-238:g-148;_.isUndefined(a.user_style.display)||delete a.user_style.display;h?(b=a.title_width+a.user_width,b<g?(a.title_style["max-width"]=a.title_width+"px",a.user_style["max-width"]=a.user_width+"px"):a.title_width<g?(a.title_style["max-width"]=a.title_width,a.user_style["max-width"]=g-a.title_width,75>a.user_style["max-width"]&&(a.user_style.display="none")):(a.title_style["max-width"]=g,a.user_style.display=
"none")):a.title_style["max-width"]=g;B&&clearTimeout(B);B=setTimeout(function(){app.TOOLS.apply(a);B=void 0},0)};a.enable_alert_waring=function(b){b||(b={});a.warnings.warning.enable=!0;a.warnings.warning.focus=!1;a.warnings.warning.title=a.DICT("Alert");a.warnings.warning.tip_info="";a.warnings.warning.jumpto="Admin_File_Management";b.jumpto&&(a.warnings.warning.jumpto=b.jumpto);b.tip_info&&(a.warnings.warning.tip_info=b.tip_info,a.warnings.warning.title="");y("warning");g()};a.disable_alert_warning=
function(b){!1!==a.warnings.warning.enable&&(a.warnings.warning.enable=!1,A())};a.enable_save_warning=function(){if(!0!==a.warnings.save.enable){var c="0"!==b.get("blinking");a.warnings.save.enable=!0;a.warnings.save.focus=!1;a.warnings.save.blinking=c;y("save");g()}};a.disable_save_warning=function(){!1!==a.warnings.save.enable&&(a.warnings.save.enable=!1,A())};a.check_save_blinking=function(){if(!1!==a.warnings.save.enable){var c="1"===b.get("blinking");c||(a.warnings.save.display=!0);a.warnings.save.blinking=
c;y("warning");g()}};a.disable_header_warning=function(){0!==r&&(clearTimeout(r),r=0);angular.forEach(a.list,function(a){a.enable&&(a.enable=!1)})};a.logout=function(){t.logout()};a.asd_notify={firmware:!1,dongle:!1,signature:!1};a.check_auto_update=function(b,c){b||(b={});var g=b.headers,h=b.data&&b.data.result||{},d=h.image&&h.image.firmware||{},z=0;a.asd_notify={firmware:!1,dongle:!1,signature:!1};d["auto-update"]&&void 0!==d["auto-update"].notify&&(a.asd_notify.firmware=d["auto-update"].notify);
if(a.asd_notify.firmware){if(g&&(g=g("Cookie")))(g=g.match(/\.*(auto-update=(\d+|-\d+))\.*/))&&(z=g[2]);z=parseInt(z,10);isNaN(z)&&(z=0);var g="<div>",B,y,A,k,d=!1;if(a.asd_notify.firmware)switch(B=h["image-state"]&&h["image-state"].firmware||{},y=B["latest-version"]||"",A=B["last-check-time"]||"",k=B["latest-update-time"]||"",B=B["available-version"]||"",z){case 1:B&&(y&&B!==y)&&(g=g+"A new firmware update, version "+B+", was available and detected at "+A+". ",d=!0);break;case 2:g=g+"A new firmware update, version "+
y+", was applied at "+k+". "}if(a.asd_notify.dongle)switch(B=h["dongle-driver-state"]||{},y=B.version||"",A=B["last-check-time"]||"",k=B["latest-update-time"]||"",B=B["available-version"]||"",z){case 1:B&&(y&&B!==y)&&(g=g+"A new dongle driver update, version "+B+", was available and detected at "+A+". ",d=!0);break;case 2:g=g+"A new dongle driver update, version "+y+", was applied at "+k+". "}if(a.asd_notify.signature)switch(B=h["signature-state"]||{},y=B.version||"",A=B["last-check-time"]||"",k=
B["latest-update-time"]||"",B=B["available-version"]||"",z){case 1:B&&(y&&B!==y)&&(g=g+"A new signature update, version "+B+", was available and detected at "+A+". ",d=!0);break;case 2:g=g+"A new signature update, version "+y+", was applied at "+k+". "}Log(DEBUG,"cookies auto-update: "+z);switch(z){case -1:a.enable_alert_waring({tip_info:a.DICT("Header_Download_Firmare_Fail"),jumpto:"Admin_File_Management"});break;case 0:a.disable_alert_warning();break;case 1:c&&(h=function(a){a&&(p.post({method:"action",
procBackground:!0,params:{rpc:"file-copy",input:{fileType:"firmware",source:{"location-url":"http://cisco.com/"},destination:{"firmware-state":"inactive"},"firmware-option":{"reboot-type":"none"}}}}),e.url("Admin_File_Management/"))},d&&app.TOOLS.warningAlertBox({msg:g+"The release note for this version is available for download from <a href='http://www.cisco.com/c/en/us/support/routers/small-business-rv-series-routers/products-release-notes-list.html' target=\"_blank\">here</a>.</div>",title:"Information",
cbk:h,btn_yes_str:"Upgrade Now",btn_no_str:"Cancel"}));a.enable_alert_waring({tip_info:a.DICT("Header_New_Firmware_Is_Available"),jumpto:"Admin_File_Management"});break;case 2:c&&(g+="</div>",app.TOOLS.informationAlertBox({msg:g,cbk:function(a){p.post({method:"action",params:{rpc:"clear_auto_update_notify"}})},btn_no_str:"OK"}))}}else a.disable_alert_warning()};a.update_asd_notify=function(b){a.check_auto_update(b)};a.login={user:b.get("user")||"AAAAAAAAAAAA AB",sessionid:b.get("sessionid")||"",group:b.get("group")||
""};a.user_info=a.login.user+(a.login.group?" ("+a.login.group+")":"");a.user_width=app.TOOLS.computeWidthWithStyle(a.user_info,{fontSize:"19px"})+15+1;""===a.login.sessionid&&(!local_database&&!emulator)&&t.logout();"1"===b.get("config-modified")&&a.enable_save_warning();var D=0;a.remain_session_time=0;a.clean_remain_session_interval=function(){0!==D&&(clearInterval(D),D=0)};t.SessionInit();var E={Status_System_Stats:"c_system_summary.html",Status_TCP_IP:"c_tcp-ip_services.html",Status_Port_Traffic:"c_port_traffic.html",
Status_WAN_QoS:"c_wan_qos_statistics.html",Status_Application_stats:"Status_Application_stats.html",Status_ARP_Table:"c_arp_table.html",Status_Routing_status:"c_routing_table.html",Status_DHCP_binding:"c_dhcp_bindings.html",Status_Mobile_Network:"c_mobile_network.html",Status_VPN:"c_vpn_status.html",Status_View_Logs:"t_view_logs.html",captive_portal_status:"t_captive_portal_status.html",Admin_Reboot:"t_reboot.html",Admin_File_Management:"t_file_management.html",Admin_Diagnostic:"t_diagnostic.html",
Admin_License:"g_license.html",Admin_Certificate:"c_certificate.html",Admin_Config_Management:"c_config_management.html",System_Config_Setup:"t_initial_setup_wizard.html",System_Config_System:"t_system.html",System_Config_Time:"t_time.html",System_Config_Log:"t_log.html",System_Config_Email:"t_email.html",System_Config_User_Accounts:"t_user_accounts.html",System_Config_User_Groups:"t_user_groups.html",System_Config_IP_Address:"t_ip_address_groups.html",System_Config_SNMP:"t_snmp.html",System_Config_Discovery_Bonjour:"t_discovery-bonjour.html",
System_Config_LLDP:"t_lldp.html",System_Config_Automatic_Updates:"t_automatic_updates.html",System_Config_Service_Management:"t_service_management.html",System_Config_Schedules:"t_schedules.html",System_Config_PnP:"t_pnp.html",WAN_Settings:"t_wan_settings.html",WAN_Multi_WAN:"t_multi_wan.html",WAN_Mobile_Network:"t_mobile_network.html",WAN_Dynamic_DNS:"t_dynamic_dns.html",WAN_Hardware_DMZ:"t_hardware_dmz.html",WAN_IPv6_Transition:"t_ipv6_transition.html",QoS_Traffic_Classes:"t_traffic_classes.html",
QoS_WAN_Queuing:"t_wan_queuing.html",QoS_WAN_Policing:"t_wan_policing.html",QoS_WAN_Bandwidth:"t_wan_bandwidth_management.html",QoS_Switch_Classification:"t_switch_classification.html",QoS_Switch_Queuing:"t_switch_queuing.html",LAN_Port_Settings:"t_port_settings.html",LAN_VLAN:"t_vlan_settings.html",LAN_VLAN_Settings:"t_vlan_settings.html",LAN_DHCP_Settings:"t_lan_dhcp_settings.html",LAN_Static_DHCP:"t_static_dhcp.html","LAN_802.1X":"t_802_1x_configuration.html",LAN_DNS:"t_dns_local_database.html",
LAN_Router_Ad:"t_router_advertisement.html",lan_poe_settings:"t_poe_settings.html",wlan_settings:"t_basic_settings.html",wlan_adv:"t_advanced_settings.html",captive_portal:"t_captive_portal.html",wlan_wps:"t_wps.html",Routing_IGMP_Proxy:"t_igmp_proxy.html",Routing_RIP:"t_rip.html",Routing_Static_Routing:"t_static_routing.html",Firewall_Basic_Settings:"t_basic_settings.html",Firewall_Access_Rules:"t_access_rules.html",Firewall_NAT:"t_network_address_translation.html",Firewall_Static_NAT:"t_static_nat.html",
Firewall_port_forwarding:"t_port_forwarding.html",Firewall_Port_triggering:"t_port_triggering.html",Firewall_Session_timeout:"t_session_timeout.html",Firewall_DMZ_host:"t_dmz_host.html",VPN_Setup:"t_vpn_setup_wizard.html",VPN_IPsec_Profiles:"t_ipsec_profiles.html",VPN_Site_to_Site:"t_site-to-site.html",VPN_Client_to_Site:"t_client_to_site.html",VPN_Teleworker:"t_teleworker_vpn_client.html",VPN_Gre_Tunnel:"t_gre_tunnel.html",VPN_PPTP_Server:"t_pptp_server.html",VPN_L2TP_Server:"t_l2tp_server.html",
VPN_SSL:"t_ssl_vpn.html",VPN_Passthrough:"t_vpn_passthrough.html",Security_App_Control_Wizard:"t_settings.html",Security_Application_Controller:"t_settings.html",Security_Web_Filtering:"t_web_filtering.html",Security_Content_Filter:"t_content_filter.html",Security_IP_Source_Guard:"t_ip_source_guard.html",app_statistics:"c_application_statistics.html",client_statistics:"t_client_statistics.html",Security_Umbrella:"t_cisco_umbrella.html",Security_Threat_Ips_Status:"t_status.html",Security_Anti_Threat:"t_antivirus.html",
Ips:"t_ips.html",Configuration_Wizards:"g_configuration_wizards.html"};switch(s){case "RV340W":E.Firewall_Basic_Settings="t_basic_settings_2.html"}a.help_url="./help/help/index.html";a.changeHelpUrlByChangePage=function(){var b="";m&&(m.current&&m.current.params&&m.current.params.page&&E[m.current.params.page])&&(b="?"+E[m.current.params.page]);a.help_url="./help/help/index.html"+b};a.toogle_nav=function(){k||(k=app.TOOLS.get_scope("layoutCtrl"));k.toogle_nav()};(function(){p.post({method:"get_sys_info",
url:resource_base+"data/sys_system.json",success:function(a){c(a.data&&a.data.result||{});z()},error:function(a){c();z();Log(ERROR,"[headerCtrl][getSystemInfo][Err] "+JSON.stringify(a))}})})();q.all([function(){return p.post({url:resource_base+"data/automatic_updates.json",method:"get_auto_update",procBackground:!0,error:function(a){Log(ERROR,"get auto update error "+a.status);pollingTimeId=0}})}()]).then(function(c){if("1"===b.get("bootfail")){var g=l(c,0),d="";angular.forEach(g["image-state"]&&
g["image-state"].firmware&&g["image-state"].firmware.images&&g["image-state"].firmware.images.image||[],function(a){"active"===a.active&&(d=a.version)});app.TOOLS.criticalAlertBox({msg:"Image failover occurred, device booted currently with firmware version: "+d+". Please check and upload the correct firmware if necessary.",title:a.DICT("Warning"),btn_no_str:"OK",cbk:function(b){b&&(a.check_auto_update(c[0],!0),h(c[0]&&c[0].data&&c[0].data.result||{}))}})}else a.check_auto_update(c[0],!0),h(c[0]&&
c[0].data&&c[0].data.result||{})});a.changeHelpUrlByChangePage();z()}]);app.controller("dialogBoxCtrl",["$scope","obj",function(a,b){a.model=b;a.btn_yes_str=a.DICT("Alert_Box_Yes");a.btn_no_str=a.DICT("Alert_Box_No");a.title="";a.msg=b.msg;a.templateUrl=b.templateUrl||"";a.iconClass="";a.type=b.type;a.msg&&(a.templateUrl="");switch(b.type){case "warning":break;case "critical":case "information":case "success":a.btn_yes_str="";a.btn_no_str=a.DICT("Alert_Box_Ok");break;default:a.type="warning"}b.btn_yes_str&&(a.btn_yes_str=b.btn_yes_str);b.btn_no_str&&(a.btn_no_str=b.btn_no_str);
a.title=b.title?b.title:a.DICT("Information");a.iconClass={warning:"icon-warning",critical:"icon-critical",information:"icon-information",success:"icon-success"}[a.type];a.yes=function(){a.closeThisDialog(!0)};a.no=function(){a.closeThisDialog(!1)}}]);
app.controller("alertBoxCtrl",["$scope","obj",function(a,b){a.model=b;a.btn_yes_str="";a.btn_no_str="";a.title="";a.msg=b.msg||"";a.templateUrl=b.templateUrl||"";a.iconClass="";a.type=b.type;switch(b.type){case "critical":a.title=a.DICT("Alert");a.btn_no_str=a.DICT("Alert_Box_Ok");break;case "information":a.title=a.DICT("Information");a.btn_no_str=a.DICT("Alert_Box_Ok");break;case "success":a.title=a.DICT("Information");a.btn_no_str=a.DICT("Alert_Box_Ok");break;default:a.title=a.DICT("Warning"),a.btn_yes_str=
a.DICT("Alert_Box_Yes"),a.btn_no_str=a.DICT("Alert_Box_No"),a.type="warning"}b.btn_yes_str&&(a.btn_yes_str=b.btn_yes_str);b.btn_no_str&&(a.btn_no_str=b.btn_no_str);b.title&&(a.title=b.title);a.iconClass={warning:"icon-warning",critical:"icon-critical",information:"icon-information",success:"icon-success"}[a.type];a.yes=function(){a.closeThisDialog(!0)};a.no=function(){a.closeThisDialog(!1)}}]);
app.controller("notificationBoxCtrl",["$scope","obj",function(a,b){a.model=b;a.btn_yes_str=a.DICT("Alert_Box_Yes");a.btn_no_str=a.DICT("Alert_Box_No");a.title="";a.msg=b.msg;a.iconClass="";a.type=b.type;switch(b.type){case "warning":case "critical":case "information":case "success":break;default:a.type="warning"}b.btn_yes_str&&(a.btn_yes_str=b.btn_yes_str);b.btn_no_str&&(a.btn_no_str=b.btn_no_str);b.title&&(a.title=b.title);a.iconClass={warning:"icon-warning",critical:"icon-critical",information:"icon-information",
success:"icon-success"}[a.type]}]);
app.controller("wizardCtrl",["$scope","obj",function(a,b){var t=function(b){a.show_skip_btn=b.canSkip?!0:!1;a.show_submit_btn=a.current_step===a.step_list.length-1?!0:!1};a.step_list=b.list||[];a.title=b.title||"";a.current_step=0;a.show_skip_btn=!1;a.show_submit_btn=!1;a.model=b.model;a.validation=b.validation;a.next=function(){a.current_step<a.step_list.length&&(a.current_step+=1,t(a.step_list[a.current_step]))};a.back=function(){0<a.current_step&&(a.current_step-=1,t(a.step_list[a.current_step]))};
a.skip=function(){var b=a.step_list[a.current_step];a.current_step<a.step_list.length&&(_.isFunction(b.skipCbk)&&b.skipCbk(a.current_step),a.current_step+=1,t(a.step_list[a.current_step]))};a.submit=function(){a.closeThisDialog(a.model)};a.cancel=function(){a.closeThisDialog("close")};t(a.step_list[0])}]);app.controller("waitRebootCtrl",["$scope","$uibModalInstance",function(a,b){}]);app.controller("menuCtrl",["$scope","MyHttp","TreeData","$route","$location","modelInfo","$cookies","oneTimeLocker","modificationWarning","goToPreviousPage","$q",function(a,b,t,m,w,u,p,q,e,x,n){var l=app.TOOLS.getResponse,r=app.TOOLS.divide_floor,v,s="1"===p.get("disable-startup"),k,d=!1,c=p.get("redirect-admin"),h="1"===c||"2"===c,g={Getting_Started:"icon-getting-start",Status_Statistics:"icon-status",System_Configuration:"icon-system",WAN:"icon-wan",LAN:"icon-lan",Wireless:"icon-wifi",Security:"icon-security",
Routing:"icon-routing",Firewall:"icon-firewall",VPN:"icon-vpn",QoS:"icon-qos",Administration:"icon-admin",Configuration_Wizards:"icon-wizard",License:"icon-license"},A=function(){var b=t.getTree(),z=function(b){var c="fa-cogs",h;angular.forEach(b,function(b){b.displayName=a.DICT(b.name);b.displayNameHeight=-1;b.subMenuHeight=-1;b.displayNameWidth=app.TOOLS.computeWidthWithStyle(b.displayName,{fontSize:"16px",fontWeight:"normal"});h=b.name;g[h]&&(c=g[h]);b.expanded=!1;b.selected=!1;b.iconClass=c;b.children&&
0<b.children.length&&z(b.children)})},B=function(a){var b,c=function(a,b){var g=0,h=188;2<=b&&(h-=10*(b-1));angular.forEach(a,function(a){a.displayNameHeight=20*(r(a.displayNameWidth,h)+1)+21;-1!==g&&(g=a.displayNameHeight+g);a.children.length?(a.subMenuHeight=c(a.children,b+1),g=-1):a.subMenuHeight=0});return g};angular.forEach(a,function(a){a.displayNameHeight=20*(r(a.displayNameWidth,188)+1)+21;b=c(a.children,1);a.subMenuHeight=-1===b?-1:b})};b&&(z(b),B(b,0),a.treedata=b,k=p.get("user"),h&&k?(q.put("USER_ACCOUNT",
{username:k,forceChangePW:!0,redirect_admin:c}),w.url("System_Config_User_Accounts/")):d?(E(),q.put("WIZARDS","setup_wizard"),w.url("Configuration_Wizards/")):s?w.url(b[1].children[0].link.replace("#/","")+"/"):(a.selected=b[0],w.url(b[0].link.replace("#/","")+"/")));x.reset()};a.treedata=[];a.opts={dirSelectable:!1};a.expand=function(b){var c=function(a){var g=!1,h=!1;angular.forEach(a,function(a){a.expanded=!1;a.selected=!1;if(a.children.length){if(g=c(a.children))a.selected=g,a.expanded=g,h=!0}else a.link===
b&&(h=g=a.selected=!0)});return h};c(a.treedata)};a.onNodeToggle=function(b,c){b!==v&&(v=b,a.selected=b.children[0],w.url(b.children[0].link+"/"),x.reset())};a.showSelected=function(b){a.selectedNode===b&&m.reload();a.selectedNode=b};a.reload=function(b){a.click(b,!0)};a.click=function(a,b){var c=a.link.replace("#/","")+"/";e.check(function(a){a&&(app.transition.In(),w.url(c),x.reset())})};var y=function(a){var b=0;a.children.length&&angular.forEach(a.children,function(c){c.children.length&&c.expanded&&
(b+=y(c));b+=a.displayNameHeight});return b};a.genStyle=function(a){return{height:(!a.expanded||!a.children.length?a.displayNameHeight:-1!==a.subMenuHeight?a.subMenuHeight+41:y(a)+41)+"px"}};a.selected="";var z=2,B=function(){var a="data/menu.json";switch(u.get_pid()){case "RV340W":a="data/tree_rv340w.json";break;case "RV345P":a="data/tree_rv345p.json";break;default:a="data/menu.json"}return b.post({url:resource_base+a,method:"get_model_tree"})},D=function(a){""!==a?(t.setTree(a),A()):(z-=1,C())},
E=function(){b.post({forcedUsingPost:!0,method:"set_gui",params:{gui:{"hide-initial-setup":!0}},success:function(){},error:function(){}})},C=function(){0!==z&&n.all([B(),b.post({method:"get_gui",url:resource_base+"data/get_gui.json"})]).then(function(a){var b=l(a,1);b||(b={});if(!1===(b.gui||{})["hide-initial-setup"])d=!0;local_database?D(a[0]&&a[0].data):D(l(a,0))},function(a){(z-=1)?C():(Log(ERROR,"[menuCtrl] init() error"),Log(ERROR,a))})};C()}]);app.controller("admin_filemanage_main",["$scope","$q","$uibModal","$timeout","rpcFns","MyHttp","Upload","UserSession","modelInfo","userAccessRight","factory_to_default","dt","goToPreviousPage",function(a,b,t,m,w,u,p,q,e,x,n,l,r){a.model={};a.ctx={};a.displayDownloadResult=!1;a.dynamic=0;a.showBarMsg=!1;a.checkProgressResult=!0;a.disableUpgradeBn=!1;a.chunkSize=512;a.pcFileInvalid=!1;a.pcFile=void 0;a.config_modified=!1;a.back_btn=!1;var v=void 0,s=app.TOOLS.get_scope("headerCtrl");s&&(s.warnings&&
s.warnings.save.enable)&&(a.config_modified=!0);r.isneed()&&(a.back_btn=!0);var k=app.TOOLS.get_scope("mainCtrl"),d={fileType:"",source:{"location-url":""},"firmware-option":{"reboot-type":"none"},destination:{}};a.model={device_model:e.get_pid()||"",pid:"",vid:"","image-state":{firmware:{"active-version":"","latest-version":"","latest-update-time":"","available-version":"N/A","last-check-time":"N/A"}},"signature-state":{version:"","latest-update-time":"","available-version":"N/A","last-check-time":"N/A"},
"dongle-driver-state":{version:"","latest-update-time":"","available-version":"N/A","last-check-time":"N/A"},"language-state":{version:"","latest-update-time":"","available-version":"N/A","last-check-time":"N/A"},checking_status:"none"};a.ctx={filetype:"firmware",source:"cisco",reset_default:!1,dest_usb_name:"NONE",return_code:void 0,urlX:"",from_usb:{},reboot:{newHost:""}};var c="",h="",g=!1,A="",y="",z="",B=!1,D="",E=[{code:10,errstr:a.DICT("File_Management_Flash_Errcode_10")},{code:11,errstr:a.DICT("File_Management_Flash_Errcode_11")},
{code:12,errstr:a.DICT("File_Management_Flash_Errcode_12")},{code:13,errstr:a.DICT("File_Management_Flash_Errcode_13")},{code:14,errstr:a.DICT("File_Management_Flash_Errcode_14")},{code:15,errstr:a.DICT("File_Management_Flash_Errcode_15")}],C=function(a){for(var b=E.length,c="Unknown message",g=0;g<b;g++)if(a===E[g].code){c=E[g].errstr;break}return c};a.userAccessFlag=x.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&q.logout();var I=function(){var c=u.post({url:resource_base+"data/admin_filemanage.json",
method:"get_file_management",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,function(){return u.post({url:resource_base+"data/downloadstatus.json",method:"get_downloadstatus",procBackground:!0,error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})}()]).then(function(b){G(b[0]);app.TOOLS.get_scope("headerCtrl").update_asd_notify(b[0]);b=b[1];var c={},g=-1,c=0;b&&(b.data&&b.data.result)&&(c=b.data.result,g=c.status,c=c.percentage,
a.dynamic=c,1===g&&100>a.dynamic&&(a.disableUpgradeBn=!0,a.showBarMsg=!0,setTimeout(N,3E3)));a.RPC_check_USB_attached();a.loadReady=!0})},G=function(b){var c={},g=[],h={},d={},z={},B={},y={},A="";b&&(b.data&&b.data.result)&&(c=b.data.result,g=c["image-state"]&&c["image-state"].firmware&&c["image-state"].firmware.images&&c["image-state"].firmware.images.image||[],h=c["system-state"]&&c["system-state"].platform||{},d=c["image-state"]&&c["image-state"].firmware||{},z=c["ciscosb-security:signature-state"],
B=c["dongle-driver-state"]||{},y=c["language-state"]||{},z||(z=c["ciscosb-avc:signature-state"]),z||(z={}),angular.forEach(g,function(a){"active"===a.active&&(A=a.version)}),a.model={device_model:e.get_pid()||"",pid:h.pid||"",vid:h.vid||"","image-state":{firmware:{"active-version":A||"N/A","latest-version":d["latest-version"]||"N/A","latest-update-time":O(d["latest-update-time"]),"available-version":d["available-version"]||"N/A","last-check-time":O(d["last-check-time"])}},"signature-state":{version:z.version||
"N/A","latest-update-time":O(z["latest-update-time"]),"available-version":z["available-version"]||"N/A","last-check-time":O(z["last-check-time"])},"dongle-driver-state":{version:B.version||"N/A","latest-update-time":O(B["latest-update-time"]),"available-version":B["available-version"]||"N/A","last-check-time":O(B["last-check-time"])},"language-state":{version:y.version||"N/A","latest-update-time":O(y["latest-update-time"]),"available-version":y["available-version"]||"N/A","last-check-time":O(y["last-check-time"])}})};
a.go_back=r.goback;a.RPC_check_USB_attached=function(b){"true"===b&&(a.showBarMsg=!1,a.checkProgressResult=!1,a.ctx.return_code=void 0,a.displayDownloadResult=!1);return w.RPC_generic_send("usb-check-attached",void 0,function(b,c,g){g=g||{};b=g.usbs||[];g=a.ctx.from_usb;g.usbDevList=[];for(c=0;c<b.length;c++)b[c].attached&&"mass-storage"===b[c]["usbs-type"]&&g.usbDevList.push(b[c].name);1<=g.usbDevList.length&&(a.ctx.dest_usb_name=g.usbDevList[0]);1>g.usbDevList.length&&"usb"==a.ctx.source&&(a.ctx.source=
"pc")},void 0,{procBackground:!1,forcedUsingPost:!1})};var H=function(b){var c=document.location,c=c.protocol+"//"+c.host+"/";b=b||0;a.ctx.reboot.newHost=c;u.post({url:c+"login.html"+(a.ctx.urlX||""),procBackground:!0,error:function(a){Log(DEBUG,"AJAX loading error: "+a.status+", URL: "+a.config.url);Log(DEBUG,JSON.stringify(a))}}).then(function(a){b+=1})["catch"](function(a){b=0;Log(DEBUG,"get login data failed, retry")});3>b?m(function(){H(b)},5E3):(K(),F(),q.logout())};a.isReadyToUpgrade=function(b){return"pc"==
b.source&&a.pcFile||"usb"==b.source&&b.from_usb&&b.from_usb.file&&void 0!=b.from_usb.file["file-name"]||"cisco"==b.source?!0:!1};a.resetFormatCheck=function(){a.pcFileInvalid=!1;"pc"==a.ctx.source&&"firmware"==a.ctx.filetype&&a.pcFileFormatCheck(a.pcFile)};a.pcFileFormatCheck=function(b){a.pcFileInvalid=!1;void 0!=b&&(a.pcFile=b,"pc"==a.ctx.source&&"firmware"==a.ctx.filetype&&(104857600<parseInt(b.size,10)?a.pcFileInvalid=!0:b.name.toLowerCase().match(/(\.img){1}$/)||(a.pcFileInvalid=!0)))};a.getReqParams=
function(){return a.generateErrorOnServer?"?errorCode="+a.serverErrorCode+"&errorMessage="+a.serverErrorMsg:""};a.waitRebootTimer=void 0;a.waitRebootModalInstance=void 0;a.openWaitRebootModal=function(){a.waitRebootModalInstance=t.open({animation:a.animationsEnabled,templateUrl:"wait_reboot_modal.htm",controller:"waitRebootCtrl",size:"600-radius-20",backdrop:"static"});a.waitRebootModalInstance.result.then(function(){a.waitRebootModalInstance=void 0},function(b){a.waitRebootModalInstance=void 0});
F();a.waitRebootTimer=setTimeout(function(){K()},3E5)};var F=function(){void 0!==a.waitRebootTimer&&(clearTimeout(a.waitRebootTimer),a.waitRebootTimer=void 0)},K=function(){a.waitRebootModalInstance&&(a.waitRebootModalInstance.close(),a.waitRebootTimer=void 0)},M=function(b,c,g){b=g.errstr;switch(g.code){case 0:a.dynamic=100;Log(DEBUG,"rpcCallBackDownToUSB() RPC success.");a.ctx.return_code=!0;app.TOOLS.successAlertBox({msg:b,cbk:function(){}});break;default:Log(ERROR,"rpcCallBackDownToUSB() RPC fail: "+
b),a.ctx.return_code=!1,app.TOOLS.criticalAlertBox({msg:a.DICT("File_Management_Download_Failed"),cbk:function(){}}),a.checkProgressResult=!1}a.displayDownloadResult=!0;a.disableUpgradeBn=!1},N=function(){app.TOOLS.get_scope("admin_filemanage_main")&&void 0===a.ctx.return_code&&u.post({url:resource_base+"data/downloadstatus.json",method:"get_downloadstatus",procBackground:!0,success:function(a){J(a)},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},J=function(b){var c=
{},g=-1,c=0;if(b&&b.data&&b.data.result)switch(c=b.data.result||{},g=void 0!==c.status?c.status:-100,c=void 0!==c.percentage?c.percentage:0,a.dynamic=c,g){case -100:a.showBarMsg=!1;void 0===a.ctx.return_code&&setTimeout(N,3E3);break;case 1:a.showBarMsg=!0;a.checkProgressResult=!0;L("down_in_progress");void 0===a.ctx.return_code&&setTimeout(N,3E3);break;case 0:a.showBarMsg=!0;a.checkProgressResult=!0;a.disableUpgradeBn=!1;L("down_success");"firmware"===h&&(!1!==a.ctx.return_code&&"user_trigger_upgrade"===
D)&&app.transition.In();break;default:switch(g){case -2:b=a.DICT("File_Management_There_Is_No_File");break;case -3:b=a.DICT("File_Management_Network_Issue");break;default:b=a.DICT("File_Management_Download_Failed")}"user_trigger_upgrade"!==D&&app.TOOLS.criticalAlertBox({msg:b,cbk:function(){}});a.showBarMsg=!0;a.checkProgressResult=!1;a.disableUpgradeBn=!1;L("down_fail")}},R=function(){var b=z,c=B;v.upload=p.upload({url:resource_base+"upload"+a.getReqParams(),resumeSizeUrl:c?resource_base+"upload?name22="+
encodeURIComponent(v.name):null,resumeChunkSize:c?a.chunkSize:null,headers:{"optional-header":"header-value"},data:{sessionid:"EU6DJKEIWO",pathparam:b,fileparam:"file001",file:v}});v.upload.then(function(a){m(function(){v.result=a.data;Log(DEBUG,"upload success");L("upload_success")})},function(b){0<b.status&&(a.errorMsg=b.status+": "+b.data);Log(ERROR,"upload fail");L("upload_fail");app.TOOLS.criticalAlertBox({msg:a.DICT("File_Management_Upload_Failed"),cbk:function(){}})},function(a){v.progress=
Math.min(100,parseInt(100*a.loaded/a.total,10))});v.upload.xhr(function(a){})},W=function(){w.RPC_generic_send("file-copy",d,function(b,c,g){b=g.errstr;c=h;switch(g.code){case 0:a.ctx.reset_default&&n.reset();Log(ERROR,"doStateDownloadFromCisco() RPC success.");L("flash_success");a.ctx.return_code=!0;if(!a.rebootFlag){if(!b)switch(c){case "firmware":b=a.DICT("File_Management_Upgrade_Firmware_From_Cisco_Success");break;case "signature":b=a.DICT("File_Management_Upgrade_Signature_From_Cisco_Success");
break;case "3g-4g-driver":b=a.DICT("File_Management_Upgrade_USB_Dongle_From_Cisco_Success");break;case "language-pack":b=a.DICT("File_Management_Upgrade_Language_From_Cisco_Success")}app.TOOLS.successAlertBox({msg:b,cbk:function(){}})}break;default:Log(ERROR,"doStateDownloadFromCisco() RPC fail: "+b);app.transition.Out();a.ctx.return_code=!1;L("flash_fail");if(!b)switch(c){case "firmware":b=a.DICT("File_Management_Upgrade_Firmware_From_Cisco_Failure");break;case "signature":b=a.DICT("File_Management_Upgrade_Signature_From_Cisco_Failure");
break;case "3g-4g-driver":b=a.DICT("File_Management_Upgrade_USB_Dongle_From_Cisco_Failure");break;case "language-pack":b=a.DICT("File_Management_Upgrade_Language_From_Cisco_Failure")}app.TOOLS.criticalAlertBox({msg:b,cbk:function(){}})}},void 0,{forcedUsingPost:!0});setTimeout(N,5E3)},S=function(){"firmware"===h&&(k.normal_show=!1,k.custom_loading_message="<table><tr><td ng-bind=\"DICT('File_Management_Flash_Note1')\"></td></tr><tr><td ng-bind=\"DICT('File_Management_Flash_Note2')\"></td></tr><tr><td ng-bind=\"DICT('File_Management_Flash_Note3')\"></td></tr></table>");
w.RPC_generic_send("file-copy",d,function(b,c,g){b=g.code;g=g.errstr;switch(b){case 0:Log(DEBUG,"doStateFlash() RPC success.");a.ctx.return_code=!0;L("flash_success");a.rebootFlag||app.TOOLS.successAlertBox({msg:g,cbk:function(){}});break;default:""===g&&(g=C(b)),a.ctx.return_code=!1,app.transition.Out(),L("doStateFlash() flash_fail"),Log(DEBUG,"RPC fail: "+g),app.TOOLS.criticalAlertBox({msg:g,cbk:function(){}})}"firmware"===h&&(k.normal_show=!0)},void 0,{forcedUsingPost:a.forcedUsingPost})},X=function(){a.rebootFlag?
function(){app.transition.Out();Log(DEBUG,"Upgrade success, Device rebooting, try url loading..(30000)");a.openWaitRebootModal();m(function(){a.ctx.reboot.userControlPanel=!0;H()},3E4)}():I();a.disableUpgradeBn=!1;v=void 0;L("finish")},T=function(){a.disableUpgradeBn=!1;v=void 0;L("finish")},L=function(a){switch(a){case "trigger_upload":R();break;case "trigger_flash":S();break;case "trigger_download":W();break;case "upload_success":S();break;case "upload_fail":T();break;case "flash_success":X();break;
case "flash_fail":T()}},U=function(){d.source["location-url"]="http://cisco.com/";switch(h){case "firmware":a.rebootFlag=!0;g?(d["firmware-option"]["reboot-type"]="factory-default-config-certificate",app.TOOLS.warningAlertBox({msg:a.DICT("File_Management_Upgrade_and_factory_Note"),cbk:function(b){b?L("trigger_download"):a.disableUpgradeBn=!1}})):L("trigger_download");break;case "signature":case "3g-4g-driver":L("trigger_download");break;case "language-pack":a.disableUpgradeBn=!1}},V=function(){d.destination["firmware-state"]=
"inactive";switch(h){case "firmware":z="Firmware";d.source["location-url"]="FILE://"+z+"/file001";a.rebootFlag=!0;g?(d["firmware-option"]["reboot-type"]="factory-default-config-certificate",app.TOOLS.warningAlertBox({msg:a.DICT("File_Management_Upgrade_and_factory_Note"),cbk:function(b){b?L("trigger_upload"):a.disableUpgradeBn=!1}})):L("trigger_upload");break;case "signature":z="Signature";d.source["location-url"]="FILE://"+z+"/file001";L("trigger_upload");break;case "3g-4g-driver":z="3g-4g-driver";
d.source["location-url"]="FILE://"+z+"/file001";L("trigger_upload");break;case "language-pack":a.disableUpgradeBn=!1}},P=function(){y=a.ctx.from_usb.file["file-name"];d.source["location-url"]="FILE://"+A+"/"+y;d.destination["firmware-state"]="inactive";switch(h){case "firmware":a.rebootFlag=!0;g?(d["firmware-option"]["reboot-type"]="factory-default-config-certificate",app.TOOLS.warningAlertBox({msg:a.DICT("File_Management_Upgrade_and_factory_Note"),cbk:function(b){b?L("trigger_flash"):a.disableUpgradeBn=
!1}})):L("trigger_flash");break;case "signature":case "3g-4g-driver":L("trigger_flash");break;case "language-pack":a.disableUpgradeBn=!1}};a.triggerUpgrade=function(b){var k="",l=!1,E=function(){a.ctx.return_code=void 0;switch(c){case "cisco":U();break;case "pc":V();break;case "usb":P()}};b&&(v=b);c=a.ctx.source;h=a.ctx.filetype;g=a.ctx.reset_default;A=a.ctx.dest_usb_name||"";y=v&&v.name||"";z="";B=!1;D="user_trigger_upgrade";d={fileType:h,source:{"location-url":""},"firmware-option":{"reboot-type":"none"},
destination:{}};a.showBarMsg=!1;a.checkProgressResult=!1;a.disableUpgradeBn=!0;a.rebootFlag=!1;a.displayDownloadResult=!1;b&&b.progress&&(b.progress=-1);"pc"===c&&!b?a.disableUpgradeBn=!1:"firmware"===h?(k=a.DICT("File_Management_Upgrade_Firmware_Note"),a.config_modified&&!g&&(l=!1,k=a.DICT("File_Management_Upgrade_Firmware_With_Modified_Configure_Note")),app.TOOLS.warningAlertBox({title:a.DICT("Confirm"),msg:k,cbk:function(b){b?l?u.post({method:"action",forcedUsingPost:!0,params:{rpc:"file-copy",
input:{fileType:"configuration",source:{"config-type":"config-running"},destination:{"config-type":"config-startup"}}},success:function(a){E()},error:function(b){app.TOOLS.warningAlertBox({msg:a.DICT("File_Management_Save_Configure_Failure"),cbk:function(a){a&&E()}})}}):E():a.disableUpgradeBn=!1}})):E()};a.triggerDownload=function(){"language-pack"!==a.ctx.filetype&&(a.displayDownloadResult=!1,a.checkProgressResult=!1,a.ctx.return_code=void 0,a.disableUpgradeBn=!0,a.showBarMsg=!1,c=a.ctx.source,h=
a.ctx.filetype,g=a.ctx.reset_default,A=a.ctx.dest_usb_name||"",D="usb",B=z=y=void 0,d={fileType:h,source:{"location-url":"http://cisco.com/"},destination:{"location-url":"FILE://"+A+"/"}},w.RPC_generic_send("file-copy",d,M,void 0,{procBackground:!0,forcedUsingPost:!0}),setTimeout(N,5E3))};a.switchRadioBn=function(b){a.showBarMsg=!1;a.displayDownloadResult=!1;b&&b.progress&&(b.progress=-1)};var O=function(a){return l.genTimeStrByTimeStamp(a,"N/A")};a.checkNow=function(){a.disableUpgradeBn=!0;var b=
app.TOOLS.get_scope("backgroundAppCtrl");b&&(b.firmware_lib&&"function"===$.type(b.firmware_lib.check_firmware))&&"start"===b.firmware_lib.check_firmware()&&(a.model.checking_status="checking")};a.invokeCheckingSuccessCbk=function(b,c){a.disableUpgradeBn=!1;a.model.checking_status="finish";a.errstr=c;I()};I()}]);app.controller("smart_license_main",["$scope","$q","$uibModal","$log","MyHttp","$http","$timeout","$templateCache","Sets","userAccessRight","UserSession","goToPreviousPage",function(a,b,t,m,w,u,p,q,e,x,n,l){var r=!1;a.model=a.model||{};a.env=a.env||{};a.ctx=a.ctx||{};a.env.modalList=a.env.modalList||[];a.loadReady=!1;a.env.success=!1;a.backbtn=!1;a.ui_data={note1:a.DICT("License_Login_To_Account",{"%s":'<a target="_blank" href="https://software.cisco.com/#SmartLicensing-Inventory">'+a.DICT("License_Here")+
"</a>"})};a.userAccessFlag=x.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();l.isneed()&&(a.backbtn=!0);a.go_back=l.goback;a.env.supportDB=!0;var v=function(b,h){return w.post({url:resource_base+(b||"data/smart_license.json"),method:"get_smart_license",options:{transformResponse:app.modelhelper.db2webFn},procBackground:!0,success:function(b){angular.extend(a.model,b.data.result);s();a.schema=a.schema||{};a.schema.exportMap={"true":a.DICT("License_Allowed"),"false":a.DICT("License_Not_Allowed")};
a.schema.statusMap={"true":a.DICT("License_Succeed"),"false":a.DICT("License_Failed")};a.schema.RegMap={"license-registration-registrated":a.DICT("License_Registered"),"license-registration-unregistrated":a.DICT("License_Unregistered"),"license-registration-registration-expired":a.DICT("License_Reg_Expired"),"license-registration-failed":a.DICT("License_Unreg_Failed"),"license-registration-inprogress":a.DICT("License_Unreg_Pending"),"license-registration-retry-inprogress":a.DICT("License_Unreg_In_Progress")};
a.schema.AuthMap={"license-authorization-status-authorized":a.DICT("License_Authorized"),"license-authorization-status-evaluation":a.DICT("License_Evaluation_Mode"),"license-authorization-status-evaluation-period-expired":a.DICT("License_Evaluation_Expired"),"license-authorization-status-out-of-compliance":a.DICT("License_Out_Compliance"),"license-authorization-status-authorization-expired":a.DICT("License_Auth_Expired"),"license-authorization-status-invalid":a.DICT("License_Error_Invalid"),"license-authorization-status-init":a.DICT("License_Not_In_Use"),
"license-authorization-status-waiting":a.DICT("License_Pending"),"license-authorization-status-overage":a.DICT("License_Overage"),"license-authorization-status-disabled":a.DICT("License_Disabled"),"license-authorization-status-no-in-use":a.DICT("License_No_License_In_Use"),"license-authorization-status-invalidtag":a.DICT("License_Invalid_Tag")};a.schema.FeatureMap={"license-feature-status-authorized":a.DICT("License_Authorized"),"license-feature-status-evaluation":a.DICT("License_Evaluation_Mode"),
"license-feature-status-evaluation-period-expired":a.DICT("License_Evaluation_Expired"),"license-feature-status-out-of-compliance":a.DICT("License_Out_Compliance"),"license-feature-status-authorization-expired":a.DICT("License_Auth_Expired"),"license-feature-status-invalid":a.DICT("License_Error_Invalid"),"license-feature-status-init":a.DICT("License_Not_In_Use"),"license-feature-status-waiting":a.DICT("License_Pending"),"license-feature-status-overage":a.DICT("License_Overage"),"license-feature-status-disabled":a.DICT("License_Disabled"),
"license-feature-status-invalidtag":a.DICT("License_Invalid_Tag"),"license-feature-status-no-in-use":a.DICT("License_No_License_In_Use")};a.schema.RegState={"license-registration-registrated,renewOK":{template:"T_License_reg_popover_Registrated_renewOK.htm",imgsrc:"themes/img/icon/Status_success_icon.png"},"license-registration-registrated,renewFailed":{template:"T_License_reg_popover_Registrated_renewFailed.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-registration-unregistrated":{template:"T_License_reg_popover_Unregistrated.htm",
imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-registration-registration-expired":{template:"T_License_reg_popover_Registration_Expired.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-registration-failed":{template:"T_License_reg_popover_Registration_Failed.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-registration-inprogress":{template:"T_License_reg_popover_Registration_Inprogress.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},
"license-registration-retry-inprogress":{template:"T_License_reg_popover_Registration_Retry_Inprogress.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"}};a.schema.AuthState={"license-authorization-status-authorized,renewOK":{template:"T_License_auth_popover_Authorized_renewOK.htm",imgsrc:"themes/img/icon/Status_success_icon.png"},"license-authorization-status-authorized,renewFailed":{template:"T_License_auth_popover_Authorized_renewFailed.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},
"license-authorization-status-evaluation":{template:"T_License_auth_popover_Evaluation.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-authorization-status-evaluation-period-expired":{template:"T_License_auth_popover_Evaluation_Period_Expired.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-authorization-status-out-of-compliance":{template:"T_License_auth_popover_Out_of_Compliance.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-authorization-status-expired":{template:"T_License_auth_popover_Authorization_Expired.htm",
imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-authorization-status-authorization-expired":{template:"T_License_auth_popover_Authorization_Expired.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-authorization-status-invalid":{template:"T_License_auth_popover_Authorization_Invalid.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-authorization-status-init":{template:"T_License_auth_popover_Authorization_NotInUse.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},
"license-authorization-status-waiting":{template:"T_License_auth_popover_Authorization_Waiting.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-authorization-status-overage":{template:"T_License_auth_popover_Authorization_Overage.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-authorization-status-disabled":{template:"T_License_auth_popover_Authorization_Disabled.htm",imgsrc:"themes/img/icon/Status_success_icon.png"},"license-authorization-status-no-in-use":{template:"T_License_auth_popover_Authorization_NoInUse.htm",
imgsrc:"themes/img/icon/Status_success_icon.png"},"license-authorization-status-invalidtag":{template:"T_License_auth_popover_Authorization_Invalidtag.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"}};a.schema.FeaState={"license-feature-status-authorized":{template:"T_License_fea_popover_Authorized_renewOK.htm",imgsrc:"themes/img/icon/Status_success_icon.png"},"license-feature-status-evaluation":{template:"T_License_fea_popover_Evaluation.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},
"license-feature-status-evaluation-period-expired":{template:"T_License_fea_popover_Evaluation_Period_Expired.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-out-of-compliance":{template:"T_License_fea_popover_Out_of_Compliance.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-expired":{template:"T_License_fea_popover_Expired.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-authorization-expired":{template:"T_License_fea_popover_Expired.htm",
imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-invalid":{template:"T_License_fea_popover_Invalid.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-init":{template:"T_License_fea_popover_NotInUse.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-feature-status-waiting":{template:"T_License_fea_popover_Waiting.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-feature-status-overage":{template:"T_License_fea_popover_Overage.htm",
imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-feature-status-disabled":{template:"T_License_fea_popover_Disabled.htm",imgsrc:"themes/img/icon/Status_success_icon.png"},"license-feature-status-invalidtag":{template:"T_License_fea_popover_Invalidtag.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-no-in-use":{template:"T_License_auth_popover_Authorization_NoInUse.htm",imgsrc:"themes/img/icon/Status_success_icon.png"}};a.model_orig=angular.copy(a.model);
a.$watch("model.license_state.registration.status",function(b,c){b!=c&&(Log(DEBUG,"watch: "+b),a.Fns.refreshStatusText("registration"))});a.$watch("model.license_state.authorization.authorization_status.status",function(b,c){b!=c&&(Log(DEBUG,"watch: "+b),a.Fns.refreshStatusText("authorization"))});k();angular.forEach(a.model.license.features,function(a){a.display_name=a.name});a.lsref=a.model.license_state;a.lref=a.model.license;a.gridLicense.Options.data=a.model.license.features;a.loadReady=!0},
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);s()}})};v();var s=function(){a.flag_errLicenseModel=!1;a.model.license_state||(a.flag_errLicenseModel=!0);e.recover_object(a.model,{license:{token:"",features:[]}});e.recover_object(a.model,{license_state:{enable:!0,registration:{status:"license-registration-unregistrated"},authorization:{authorization_status:{time:"--",status:"license-authorization-status-no-in-use"}},smart_account:"-",virtual_account:"-",pid:"-",
export_controlled:"-",features:[]}});a.model.license_state.enable=!0;angular.forEach(a.model.license_state.features,function(a,b){void 0==a.status&&!0!==a.enable&&(a.status="license-feature-status-no-in-use")});a.flag_errLicenseModel&&alert("License data request failed, database in No data")},k=function(){angular.forEach(a.model.license.features,function(b,h){angular.forEach(a.model.license_state.features,function(a,h){b.name==a.name&&(b._ref=a)})})};a.gridLicense=a.gridLicense||{};a.gridLicense.Selections=
[];a.gridLicense.OptionsShow=!0;a.gridLicense.filterRowsByEnable=function(a){var b=[];angular.forEach(a,function(a){!0===a.entity.enable&&b.push(a)});return b};a.gridLicense.Options=app.uiGrid.generateGridOptions({onRegisterApi:function(b){a.gridLicense.Options.gridApi.core.registerRowsProcessor(a.gridLicense.filterRowsByEnable,200)},columnDefs:[{field:"display_name",displayName:a.DICT("License_Name"),cellClass:function(a,b,g){if(b&&b.entity&&b.entity._ref&&!1===b.entity._ref.enable)return"_greyout"}},
{field:"description",displayName:a.DICT("License_Desc"),cellClass:function(a,b,g){if(b&&b.entity&&b.entity._ref&&!1===b.entity._ref.enable)return"_greyout"}},{field:"count",displayName:a.DICT("License_Count"),width:80,cellTemplate:q.get("UG_License_feature_count_display.html").replace(/ARGS1/,q.get("UG_CellText_float_left.html"))},{field:"_ref.status",displayName:a.DICT("License_Status"),cellTemplate:q.get("UG_License_feature_status_with_popover.html").replace(/ARGS1/g,q.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,
"grid.appScope.schema.FeatureMap[MODEL_COL_FIELD]"))}]});a.gridLicense.Options2=app.uiGrid.generateGridOptions({columnDefs:[{field:"enable",displayName:a.DICT("License_Enable"),width:80,cellTemplate:q.get("UG_table_checkbox_2.html")},{field:"display_name",displayName:a.DICT("License_Name_V")},{field:"description",displayName:a.DICT("License_Desc")},{field:"count",displayName:a.DICT("License_Count"),width:100,cellTemplate:q.get("UG_License_feature_count.html").replace(/data-ng-expansion/,"required min=\"{{ grid.appScope.Fns.featureSpecRule(row.entity, 'minCount') }}\" max=\"{{ grid.appScope.Fns.featureSpecRule(row.entity, 'maxCount') }}\"")}]});
a.calcRemainTime=function(a){a=a.replace(/\+\d+:\d+/,"");a=Date.parse(a);var b=Date.parse((new Date).toJSON());a-=b;if(0<a){a/=1E3;var b=Math.floor(a/86400),g=Math.floor((a-86400*b)/3600);return[b,g,Math.floor((a-86400*b-3600*g)/60)]}return[]};a.reg_last_attempt_exist=function(a){return void 0==a.registration.last_renewal_attempt?!1:!(void 0==a.registration.last_renewal_attempt.time||""==a.registration.last_renewal_attempt.time)};a.shortTimeFormat=function(a,b){function g(a){return 10>a?"0"+a:a}var d=
a.replace(/:\*\*/,":30").replace(/([-+])(\d+):(\d+)$/,"$1$2$3"),y=/([-+])(\d+)$/;d.match(y);var d=d.replace(y,""),z=new Date(d),d=z.getUTCFullYear(),y="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[z.getUTCMonth()],B=z.getUTCDate();if("datetime"==b){var k=g(z.getUTCHours()),l=g(z.getUTCMinutes()),z=g(z.getUTCSeconds());return y+" "+B+", "+d+" "+k+":"+l+":"+z+""}return y+" "+B+", "+d};a.display_reg_attempt=function(b){var d;b.registration.last_renewal_attempt&&(d=b.registration.last_renewal_attempt.time);
var g="";void 0==d||""==d?b.registration.initial_registration&&b.registration.initial_registration.time&&(b=b.registration.initial_registration.time,g=a.shortTimeFormat(b)):(b=b.registration.last_renewal_attempt.time,g=a.shortTimeFormat(b));return g};a.display_auth_status_msg=function(b,d){var g="";a.display_auth_expired_status(d)?(g=b.authorization.authorization_status.time,g=a.shortTimeFormat(g)):b.authorization.last_communication_attempt&&void 0!==b.authorization.last_communication_attempt.time&&
(g=b.authorization.last_communication_attempt.time,g=a.shortTimeFormat(g));return g};a.display_reg_status=function(a){var b=!1;switch(a.reg_stat){case "license-registration-inprogress":case "license-registration-failed":case "license-registration-retry-inprogress":case "license-registration-registrated":case "license-registration-registrated-expired":b=!0}return b};a.display_reg_init_status=function(a){var b=!1;switch(a.reg_stat){case "license-registration-inprogress":b=!0}return b};a.display_reg_retry_status=
function(a){var b=!1;switch(a.reg_stat){case "license-registration-failed":case "license-registration-retry-inprogress":b=!0}return b};a.display_reg_renew_status=function(a){var b=!1;switch(a.reg_stat){case "license-registration-registrated":b=!0}return b};a.display_auth_renew_status=function(a){var b=!1;switch(a.auth_stat){case "license-authorization-status-authorized":case "license-authorization-status-out-of-compliance":b=!0}return b};a.display_auth_eval_status=function(a){return"license-authorization-status-evaluation"==
a.auth_stat};a.display_auth_expired_status=function(a){var b=!1;switch(a.auth_stat){case "license-authorization-status-evaluation-period-expired":case "license-authorization-status-expired":b=!0}return b};a.testRpc=function(a){alert(a);resource_base=a};a.Fns={featureSpecRule:function(a,b){var g=!1,d=0,y=127;switch(a.name.toLowerCase()){case "anyconnectvpn":g=!0,d=2,y=50}if("mark"==b)return g;if("minCount"==b)return d;if("maxCount"==b)return y;Log(DEBUG,"featureSpecRule: else")},gridRedraw:function(){Log(DEBUG,
"== redraw ==");a.gridLicense.OptionsShow=!1;p(function(){a.gridLicense.OptionsShow=!0},50)},isRegistered:function(){return"license-registration-registrated"==a.model.license_state.registration.status||"license-registration-registration-expired"==a.model.license_state.registration.status},renewReg:function(c,h){d.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",rpcname:"license-renew-registeration-cert"},{error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);
h("errComm")}}).then(function(a){d.ret_code_handler(a,{"0":function(a){g()},"default":function(a,b,c){console.log((b||"default:")+" ret_code_handler: Internal error code="+a);h("LicenseError",a,c)}},"license-renew-registeration-cert")});var g=function(c){c=c||0;var y=b.defer(),z=y.promise;0==c?(Log(DEBUG,"renewRegdo retry(wait 20s), retryCount="+c),p(function(){Log(DEBUG,"renewRegdo retry(20s exceed), retryCount="+c);d.fetchModelResult(y)},2E4)):d.fetchModelResult(y);z.then(function(b){var z=void 0;
b&&(b.license_state&&b.license_state.registration&&b.license_state.registration.last_renewal_attempt)&&(z=b.license_state.registration.last_renewal_attempt);Log(DEBUG,"newValue=> "+JSON.stringify(z));b=a.model.license_state.registration.last_renewal_attempt;!angular.isDefined(z)||z.time==b.time?d.doRetry("renewReg",c,8,g,function(){h("errTimeout")}):!1==z.status?(Log(DEBUG,"newValue Failed"),h("errComm")):(Log(DEBUG,"newValue updated"),h("renewOK"))})}},renewAuth:function(c,h){d.doSyncRPC({url:resource_base+
"data/exec_smart_license_regOK.json",rpcname:"license-renew-authorization"},{error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);h("errComm")}}).then(function(a){d.ret_code_handler(a,{"0":function(a){g()},"default":function(a,b,c){console.log((b||"default:")+" ret_code_handler: Internal error code="+a);h("LicenseError",a,c)}},"license-renew-authorization")});var g=function(c){c=c||0;var y=b.defer(),z=y.promise;0==c?(Log(DEBUG,"renewAuthdo retry(wait 20s), retryCount="+
c),p(function(){Log(DEBUG,"renewAuthdo retry(20s exceed), retryCount="+c);d.fetchModelResult(y)},2E4)):d.fetchModelResult(y);z.then(function(b){b=b.license_state.authorization.last_communication_attempt;Log(DEBUG,"newValue "+JSON.stringify(b));b.time==a.model.license_state.authorization.last_communication_attempt.time?d.doRetry("renewAuth",c,8,g,function(){h("errTimeout")}):!1==b.status?(Log(DEBUG,"newValue Failed"),h("errComm")):(Log(DEBUG,"newValue updated"),h("renewOK"))})}},doAuthorize:function(c,
h,g){var A={name:c.name.split(" ")[0],count:c.count};!1===c.count_based&&delete A.count;d.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",input:A,rpcname:"license-authorize"},{error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);h("errComm")}}).then(function(a){d.ret_code_handler(a,{"0":function(a){B()},"default":function(a,b){console.log((b||"default:")+" ret_code_handler: Internal error code="+a);h("errComm")}},"license-authorize")});var y=function(a,
b){var c;angular.forEach(a,function(a,g){a.name==b.name&&(c=a)});return c},z=function(b){b=b.license_state.features;var g=y(a.model.license_state.features,c);angular.forEach(b,function(b,d){b.name==c.name&&angular.forEach(a.model.license.features,function(a,d){void 0==g&&a.name==c.name&&(a._ref=b)})})},B=function(h){h=h||0;var A=b.defer(),k=A.promise;if(0==h){var l=c.name;Log(DEBUG,l+"do retry(wait 20s), retryCount="+h);p(function(){Log(DEBUG,l+"Refresh(wait 3s)");var c=b.defer();a.Fns.fetchModel().then(function(b){a.Fns.getElemResult(b,
c)});c.promise.then(function(a){Log(DEBUG,l+"Refresh(wait 3s) exceed");z(a)})},3E3);p(function(){Log(DEBUG,l+"do retry(20s exceed), retryCount="+h);d.fetchModelResult(A)},2E4)}else d.fetchModelResult(A);k.then(function(b){var z=a.model.license_state.features,A=!1,k=!1;angular.forEach(b.license_state.features,function(a,b){var d=!1,h=y(z,c);void 0!=h&&(d=!0);void 0==a.count&&Log(DEBUG,"itemNew.count undef");void 0==h&&Log(DEBUG,"matchOrig undef");h&&void 0==h.count&&Log(DEBUG,"matchOrig.count undef");
a.name==c.name&&("license-feature-status-waiting"!=a.status&&h&&(a.count!=h.count||a.status!=h.status)?(g.resolve(c.name),A=!0,k=!1):k=!0);!d&&(a.name==c.name&&"license-feature-status-waiting"!=a.status)&&(g.resolve(c.name),A=!0,k=!1)});(!A||k)&&d.doRetry(c.name,h,20,B,function(){g.reject(c.name)})})}},doDeauthorize:function(a,b,g){d.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",input:{name:a.name},rpcname:"license-deauthorize"},{error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url);b("errComm")}}).then(function(b){d.ret_code_handler(b,{"0":function(b){g.resolve(a.name)},8:function(b){console.log(name+" ret_code_handler: as resolve case, Internal error code="+b);g.resolve(a.name)},"default":function(b,d){console.log((d||"default:")+" ret_code_handler: Internal error code="+b);g.reject(a.name)}},"license-deauthorize")})},doAuthRenewCount:function(a,h,g){var A=b.defer(),y=b.defer();d.doDeauthorize(a,h,A);A.promise.then(function(b){d.doAuthorize(a,
h,y);p(function(){d.refreshModelData().then(function(a){d.gridRedraw()})},4E3)}).catch(function(b){g.reject(a.name)}).finally(function(){console.log(JSON.stringify(a))});y.promise.then(function(b){g.resolve(a.name)}).catch(function(b){g.reject(a.name)}).finally(function(){console.log(JSON.stringify(a))})},chooseLicense:function(){a.gridLicense.Options2Show=!1;d.openModal("ChooseSmartLicenses","lg");p(function(){a.gridLicense.Options2Show=!0},100)},refreshModelData:function(a){return v(a)},getRPCResult:function(a,
b){if(a.data.result&&a.data.result.output){var g=a.data.result.output;return b?g[b]:g}console.log("Error: getRPCResult, data.result not exist")},doSyncRPC:function(a,b){var g={};a.input&&(g.input=a.input);g.rpc=a.rpcname||"";return w.post({url:a.url||"",method:"action",params:g,procBackground:!0,success:function(a){b&&b.success&&b.success(a)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);b&&b.error&&b.error(a)}})},ret_code_handler:function(a,b,g){var A=d.getRPCResult(a,
"code");a=d.getRPCResult(a,"errstr");a={code:A,errstr:a};A=parseInt(A);b&&!b["default"]&&(g=g||"default:",b["default"]=function(a,b){console.log(b+" ret_code_handler: Default, unknown code="+a)});if(b[A])b[A](A,g,a);else b["default"](A,g,a)},fetchModel:function(){return w.post({url:resource_base+"data/smart_license.json",method:"get_smart_license",options:{transformResponse:app.modelhelper.db2webFn},procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},
getElemResult:function(a,b){var g;a.data&&a.data.result?(g=a.data.result,b.resolve(g)):b.reject("AJAX result expected JSON element not exist")},doRetry:function(a,b,g,d,y){a=a+":"||"unnamed:";b++;b<=g?p(function(){Log(DEBUG,a+"do retry(5s exceed), retryCount="+b);d(b)},5E3):(Log(DEBUG,a+"retry Timout"),y&&y())},fetchModelResult:function(b){a.Fns.fetchModel().then(function(d){a.Fns.getElemResult(d,b);k()})},refreshStatusText:function(b){a.lsref[b].recent_state=a.lsref[b].recent_state||0;a.ctx=a.ctx||
{};var d="";switch(a.lsref[b].recent_state){case 1:d="renewFailed";a.lsref[b].recent_state_msg="Failed";break;default:d="renewOK",a.lsref[b].recent_state_msg="Succeeded"}"registration"==b?(a.ctx.reg_stat=a.lsref[b].status,a.ctx.reg_sobj="license-registration-registrated"==a.ctx.reg_stat?a.schema.RegState[a.ctx.reg_stat+","+d]:a.schema.RegState[a.ctx.reg_stat]):"authorization"==b&&(a.ctx.auth_stat=a.lsref[b].authorization_status.status,a.ctx.auth_sobj="license-authorization-status-authorized"==a.ctx.auth_stat?
a.schema.AuthState[a.ctx.auth_stat+","+d]:a.schema.AuthState[a.ctx.auth_stat])},refreshFeatureStatusText:function(b){return{fea_sobj:a.schema.FeaState[b]}},openModal:function(b,d){r||t.open({animation:a.animationsEnabled,templateUrl:"smart_license_modal.htm",controller:"smart_license_sl_modal_ctrl",size:d,backdrop:"static",resolve:{model:function(){return a.model},modalID:function(){return b},gridLicense:function(){return a.gridLicense},Fns:function(){return a.Fns},env:function(){return a.env}}}).result.then(function(a){},
function(a){})}};var d=a.Fns;a.env.timer_license_state_polling=void 0;a.$on("$destroy",function(){a.env.timer_license_state_polling&&p.cancel(a.env.timer_license_state_polling);r=!0})}]);
app.controller("smart_license_sl_modal_ctrl",["$scope","$uibModalInstance","$q","model","modalID","gridLicense","Fns","env","MyHttp","$timeout",function(a,b,t,m,w,u,p,q,e,x){a.model=m;a.env=q;a.gridLicense=u;a.Fns=p;a.ctx=a.ctx||{};a.env.modalList.push({id:w,inst:b});var n={save:function(){b.close(a.model)},cancel:function(){var l=a.env.modalList.length-1;0<=l&&(a.env.modalList&&a.env.modalList[l]&&a.env.modalList[l].inst&&a.env.modalList[l].id==w)&&a.env.modalList.pop();b.dismiss("cancel")},enabledLic:function(){a.model.license_state.enable=
!0},disabledLic:function(){n.deregister();a.model.license_state.enable=!1},register:function(){a.model.license_state.registration.status="license-registration-registrated"},deregister:function(){a.model.license_state.registration.status="license-registration-unregistrated"},isRegistered:function(){return p.isRegistered()},showCommBox:function(b){a.uiref.commCtx.show=b},setCommBoxAndClose:function(b,e,v){a.uiref.commCtx.state=b;x(function(){v?v():n.showCommBox(!1)},e)},openModal:function(b,e,v){if(v&&
v.closePrevDialog){var s=a.env.modalList.length-1;0<=s&&(a.env.modalList&&a.env.modalList[s]&&a.env.modalList[s].inst&&a.env.modalList[s].id==v.closePrevDialog)&&a.env.modalList[s].inst.dismiss("cancel")}p.openModal(b,e)}};a.UIEvents={runRenewReg:function(b){p.renewReg("RenewReg",function(e,v,s){v="errComm"==e;var k="errTimeout"==e,d="LicenseError"==e;"renewOK"==e?(a.env.supportDB&&p.refreshModelData(),n.setCommBoxAndClose("success",2E3,function(){b?b():n.cancel()})):v?(a.uiref=a.modal_db.RegistrationRenewalFailed,
a.tref=a.modal_db.RegistrationRenewalFailed):k?(a.uiref=a.modal_db.RegistrationRenewalTimeout,a.tref=a.modal_db.RegistrationRenewalTimeout):d?(a.uiref=a.modal_db.LicenseError,a.tref=a.modal_db.LicenseError,a.uiref.resp_obj=s||{code:"code Not Found"},a.uiref.action_str="renewal license registration"):alert("Unknown UI statue: "+e)})},runRenewAuth:function(b){p.renewAuth("RenewAuth",function(e,v,s){v="errComm"==e;var k="errTimeout"==e,d="LicenseError"==e;"renewOK"==e?(a.env.supportDB&&p.refreshModelData(),
n.setCommBoxAndClose("success",2E3,function(){b?b():n.cancel()})):v?(a.uiref=a.modal_db.LicenseAuthorizationRenewalFailed,a.tref=a.modal_db.LicenseAuthorizationRenewalFailed):k?(a.uiref=a.modal_db.LicenseAuthorizationRenewalTimeout,a.tref=a.modal_db.LicenseAuthorizationRenewalTimeout):d?(a.uiref=a.modal_db.LicenseError,a.tref=a.modal_db.LicenseError,a.uiref.resp_obj=s||{code:"code Not Found"},a.uiref.action_str="renewal license authorization"):alert("Unknown UI statue: "+e)})}};a.modal_db={ConfigureLicense:{template:"ConfigureLicense.htm",
funs:{cancel:n.cancel,init:function(){a.uiref.commCtx={show:!1,state:"ongoing",msg:"Configure product for Smart Licensing",success:"Update successfully"};a.ctx.call_home=angular.copy(a.model.call_home)},save:function(){var b=function(b,l,e){l="saveFailed"==b;var k="errComm"==b,d="errTimeout"==b,c="LicenseError"==b;a.uiref.errToken=!1;a.uiref.errComm=!1;"saveOK"==b?(n.showCommBox(!0),n.setCommBoxAndClose("success",2E3,function(){n.cancel()})):l?(a.uiref.errToken=!0,n.showCommBox(!1)):k?(a.uiref.errComm=
!0,n.showCommBox(!1)):d?(a.uiref.errTimeout=!0,n.showCommBox(!1)):c?(a.uiref=a.modal_db.LicenseError,a.tref=a.modal_db.LicenseError,a.uiref.resp_obj=e||{code:"code Not Found"},a.uiref.action_str="configure license"):alert("Unknown UI statue: "+b)};(function(){a.model.call_home=angular.copy(a.ctx.call_home);var n=app.modelhelper.web2dbFn({call_home:a.model.call_home});e.post({url:resource_base+"data/smart_license.json",method:"set_smart_license",params:n,procBackground:!0,success:function(e){b("saveOK");
a.env.success=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);b("saveFailed")}})})()}}},ProductRegistration:{template:"ProductRegistration.htm",funs:{cancel:n.cancel,init:function(){a.uiref.commCtx={show:!1,state:"ongoing",msg:"Registering product for Smart Licensing",success:"Registeration completed successfully"};this.register()},register:function(){n.showCommBox(!0);var b=function(b,d,c){!a.env.supportDB&&a.env.flag_tokenOK&&(b="regOK");d="regFailed"==
b;var h="errComm"==b,g="errTimeout"==b,A="LicenseError"==b;a.uiref.errToken=!1;a.uiref.errComm=!1;"regOK"==b?(n.setCommBoxAndClose("success",2E3,function(){n.cancel()}),a.env.supportDB?p.refreshModelData():n.register()):d?(n.showCommBox(!1),a.uiref=a.modal_db.ProductRegistrationFail,a.tref=a.modal_db.ProductRegistrationFail):h?(n.showCommBox(!1),a.uiref=a.modal_db.ProductRegistrationErrComm,a.tref=a.modal_db.ProductRegistrationErrComm):g?(n.showCommBox(!1),a.uiref=a.modal_db.ProductRegistrationTimeout,
a.tref=a.modal_db.ProductRegistrationTimeout):A?(a.uiref=a.modal_db.LicenseError,a.tref=a.modal_db.LicenseError,a.uiref.resp_obj=c||{code:"code Not Found"},a.uiref.action_str="finish registration"):alert("Unknown UI statue: "+b)},e=function(b,d,c){void 0===d&&(d=0);void 0===c&&(c="");a.env.timer_license_state_polling=x(function(){var h=t.defer();h.promise.then(function(g){angular.extend(a.model.license_state,g.license_state);b--;0<b&&e(b,d,c)});p.fetchModelResult(h)},5E3)},v=t.defer();v.promise.then(function(b){angular.extend(a.model.license_state,
b.license_state)});p.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",rpcname:"license-register",input:{token:a.model.license.token}},{error:function(a){Log(DEBUG,"Stage comm error");b("errComm")}}).then(function(a){p.ret_code_handler(a,{"0":function(a){s()},"default":function(a,c){console.log((c||"default:")+" ret_code_handler: Internal error code="+a);x(function(){p.fetchModelResult(v)},2E3);b("errComm")}},"license-register")});var s=function(a){a=a||0;var d=t.defer(),c=d.promise;
0==a?(Log(DEBUG,"registerdo retry(wait 20s), retryCount="+a),x(function(){Log(DEBUG,"registerdo retry(20s exceed), retryCount="+a);p.fetchModelResult(d)},2E4)):p.fetchModelResult(d);c.then(function(c){c=c.license_state.registration.status;switch(c){case "license-registration-inprogress":case "license-registration-retry-inprogress":case "license-registration-unregistrated":p.doRetry("register",a,20,s,function(){b("errTimeout")});break;case "license-registration-failed":Log(DEBUG,"registering Failed");
b("regFailed");break;case "license-registration-registrated":case "license-registration-registration-expired":Log(DEBUG,"regOK");x(function(){p.fetchModelResult(v);x(function(){p.gridRedraw();e(24)},1E3);b("regOK")},4E3);break;default:alert("Unknown status id: "+c),b("errComm")}x(function(){p.fetchModelResult(v);x(function(){p.gridRedraw()},1E3)},4E3)})}}}},ProductRegistrationFail:{template:"ProductRegistrationFail.htm",funs:{ok:function(){n.cancel()}}},ProductRegistrationErrComm:{template:"ProductRegistrationErrComm.htm",
funs:{ok:function(){n.cancel()}}},ProductRegistrationTimeout:{template:"ProductRegistrationTimeout.htm",funs:{ok:function(){n.cancel()}}},ProductDeregister:{template:"ProductDeregister.htm",funs:{cancel:n.cancel,init:function(){a.uiref.commCtx={show:!1,state:"ongoing",msg:"Deregistering product from Smart Software Licensing",success:"Deregisteration completed successfully"}},deregister:function(){n.showCommBox(!0);e.post({url:resource_base+"data/exec_smart_license_regOK.json",method:"action",params:{rpc:"license-deregister"},
procBackground:!0,success:function(a){},error:function(b){console.log("AJAX loading error: "+b.status+", URL: "+b.config.url);a.uiref=a.modal_db["ManualRemovalRequired-2"];a.tref=a.modal_db["ManualRemovalRequired-2"]}}).then(function(b){p.ret_code_handler(b,{"0":function(b){a.env.supportDB?p.refreshModelData():n.deregister();n.setCommBoxAndClose("success",2E3,function(){n.cancel()})},"default":function(b,l,e){console.log(l+" ret_code_handler: Default, unknown code="+b);a.uiref=a.modal_db.LicenseError;
a.tref=a.modal_db.LicenseError;a.uiref.resp_obj=e||{code:"code Not Found"};a.uiref.action_str="finish deregistration"}},"license-deregister")})}}},EnableLicense:{template:"MiniModalBoxOverride.htm",funs:{cancel:n.cancel,init:function(){a.uiref.commCtx={show:!1,state:"ongoing",msg:"Enabling Smart Software Licensing",success:"Enabling Smart Software Licensing complete"};n.showCommBox(!0);p.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",rpcname:"license-enable"},{success:function(b){p.ret_code_handler(b,
{"0":function(b){n.setCommBoxAndClose("success",1E3,function(){n.cancel()});a.env.supportDB?p.refreshModelData():n.enabledLic()},"default":function(b,l,e){console.log(l+" ret_code_handler: Default, unknown code="+b);a.uiref=a.modal_db.LicenseError;a.tref=a.modal_db.LicenseError;a.uiref.resp_obj=e||{code:"code Not Found"}}},"license-enable")},error:function(b){a.uiref=a.modal_db.EnableLicenseFailed;a.tref=a.modal_db.EnableLicenseFailed}})}}},DisableLicense:{template:"DisableLicense.htm",funs:{cancel:n.cancel,
init:function(){a.uiref.commCtx={show:!1,state:"ongoing",msg:"Deregistering product from Smart Software Licensing",success:"Smart Software Licensing disabled"}},disableLicense:function(){a.model.license_state.enable?(n.showCommBox(!0),p.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",rpcname:"license-disable"},{success:function(b){p.ret_code_handler(b,{"0":function(b){a.env.supportDB?p.refreshModelData():n.disabledLic();n.setCommBoxAndClose("success",2E3,function(){n.cancel()})},
"default":function(b,l){a.uiref=a.modal_db.ManualRemovalRequired;a.tref=a.modal_db.ManualRemovalRequired}},"license-disable")},error:function(b){console.log("AJAX loading error: "+b.status+", URL: "+b.config.url);a.uiref=a.modal_db.LicenseError;a.tref=a.modal_db.LicenseError}})):(a.env.supportDB?p.refreshModelData():n.disabledLic(),n.cancel())}}},RenewAuth:{template:"MiniModalBoxOverride.htm",funs:{init:function(){a.uiref.commCtx={show:!1,state:"ongoing",hideMiniBackdrop:!0,msg:"Renewing Smart Software Licensing Authorization",
success:"Authorization Renewal complete"};n.showCommBox(!0);a.UIEvents.runRenewAuth()}}},RenewReg:{template:"MiniModalBoxOverride.htm",funs:{init:function(){a.uiref.commCtx={show:!1,state:"ongoing",hideMiniBackdrop:!0,msg:"Renewing Smart Software Licensing Registration",success:"Registration Renewal complete"};n.showCommBox(!0);a.UIEvents.runRenewReg()}}},RenewRegAuth:{template:"MiniModalBoxOverride.htm",funs:{init:function(){var b=t.defer(),e=t.defer();b.resolve("p1_done");b.promise.then(function(){a.uiref.commCtx=
{show:!1,state:"ongoing",hideMiniBackdrop:!0,msg:"Renewing Smart Software Licensing Registration",success:"Registration Renewal complete"};n.showCommBox(!0);a.UIEvents.runRenewReg(function(){e.resolve("p2_done")})});e.promise.then(function(){a.uiref.commCtx={show:!1,state:"ongoing",hideMiniBackdrop:!0,msg:"Renewing Smart Software Licensing Authorization",success:"Authorization Renewal complete"};n.showCommBox(!0);a.UIEvents.runRenewAuth(function(){n.cancel()})})}}},EnableLicenseFailed:{template:"EnableLicenseFailed.htm",
funs:{ok:function(){n.cancel()}}},LicenseError:{template:"LicenseError.htm",funs:{ok:function(){n.cancel()}}},ManualRemovalRequired:{template:"ManualRemovalRequired.htm",funs:{ok:function(){a.env.supportDB?p.refreshModelData():n.disabledLic();n.cancel()}}},"ManualRemovalRequired-2":{template:"ManualRemovalRequired.htm",funs:{ok:function(){a.env.supportDB?p.refreshModelData():n.deregister();n.cancel()}}},RegistrationRenewalFailed:{template:"RegistrationRenewalFailed.htm",funs:{ok:function(){n.cancel()}}},
RegistrationRenewalTimeout:{template:"RegistrationRenewalTimeout.htm",funs:{ok:function(){n.cancel()}}},LicenseAuthorizationNoticeAuthOnPending:{template:"LicenseAuthorizationNoticeAuthOnPending.htm",funs:{init:function(){Log(DEBUG,"pend init");(function(){a.ctx=a.ctx||{};var b=a.ctx;b.countDownStop=!1;b.countDownSec=10;var e=function(){b.countDownStop||x(function(){1<b.countDownSec?(b.countDownSec-=1,e()):1>=b.countDownSec&&n.cancel()},1E3)};e()})()},countDownReset:function(){var b=a.ctx;b.countDownStop=
!1;b.countDownSec=5},ok:function(){n.cancel()}}},LicenseAuthorizationRenewalOK:{template:"LicenseAuthorizationRenewalOK.htm",funs:{ok:function(){n.cancel()}}},LicenseAuthorizationRenewalFailed:{template:"LicenseAuthorizationRenewalFailed.htm",funs:{ok:function(){n.cancel()}}},LicenseAuthorizationRenewalTimeout:{template:"LicenseAuthorizationRenewalTimeout.htm",funs:{ok:function(){n.cancel()}}},ChooseSmartLicenses:{template:"ChooseSmartLicenses.htm",funs:{cancel:n.cancel,isRegistered:n.isRegistered,
init:function(){a.features_copy=angular.copy(a.model.license.features);a.gridLicense.Options2.data=a.features_copy;a.uiref.commCtx={show:!1,state:"ongoing",msg:"Renewing Smart Software Licensing Authorization",success:"Authorization Renewal complete"}},save:function(){var b=function(){var b=angular.copy(a.features_copy);angular.forEach(b,function(a,b){for(var g in a)"name"==g||("enable"==g||"count"==g)||delete a[g]});b=app.modelhelper.web2dbFn({license:{features:b}});e.post({url:resource_base+"data/smart_license.json",
method:"set_smart_license",forcedUsingPost:!0,params:b,procBackground:!0,success:function(a){},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},r=function(){var d=angular.copy(a.model.license.features);a.model.license.features=angular.copy(a.features_copy);a.gridLicense.Options.data=a.model.license.features;angular.forEach(d,function(b,d){var g=!1;angular.forEach(a.model.license.features,function(a,d){b.name==a.name&&(g=!0,a.count=b.count)});!g&&itemB.count&&
(itemB.count=void 0)});b()},v=function(){a.state_features_copy=angular.copy(a.model.license_state.features);a.model.license.features=angular.copy(a.features_copy);a.gridLicense.Options.data=a.model.license.features;angular.forEach(a.model.license_state.features,function(b,c){angular.forEach(a.state_features_copy,function(a,c){b.name==a.name&&(b.status=a.status)})})},s=function(a){"renewOK"==a?x(function(){p.refreshModelData();p.gridRedraw();n.openModal("LicenseAuthorizationRenewalOK","",{closePrevDialog:"LicenseAuthorizationNoticeAuthOnPending"})},
2E3):"gridRedraw"==a?p.gridRedraw():"dialogClose"==a?(n.cancel(),p.openModal("LicenseAuthorizationNoticeAuthOnPending","")):"dialogAuthOnPending"!=a&&("errComm"==a?n.openModal("LicenseAuthorizationRenewalFailed",""):"errTimeout"==a?n.openModal("LicenseAuthorizationRenewalTimeout",""):alert("unknown UI state: "+a))},k=function(b){var c,h=[],g=[],A={success:[],fail:[]},y=function(a,c,z){var y=t.defer();c=y.promise;h.push(c);g.push(y);y.ctx={name:a.name};a.enable&&z&&"renewCount"==z.mode?(y.ctx.action=
"AuthRenewCount",p.doAuthRenewCount(a,b,y)):a.enable?(y.ctx.action="Request",p.doAuthorize(a,b,y)):a.enable||(y.ctx.action="Release",p.doDeauthorize(a,b,y));c.then(function(a){A.success.push({name:a,action:y.ctx.action})}).catch(function(a){A.fail.push({name:a,action:y.ctx.action})}).finally(function(){console.log(JSON.stringify(A))})};angular.forEach(a.features_copy,function(b,c){var g=!1,d=void 0;angular.forEach(a.model.license.features,function(a,c){a.name==b.name&&a.enable!==b.enable&&(g=!0);
a.name==b.name&&(a.count!==b.count&&!0==b.enable)&&(g=!0,d={mode:"renewCount"})});g?y(b,c,d):Log(DEBUG,"skip item:"+b.name)});var z=function(a){c||(c=!0,x(function(){console.log("Some of features update Timeout, detail as follows: "+JSON.stringify(A));b("errTimeout");p.refreshModelData()},50))};t.all(h).then(function(a){b("renewOK");c=!0},z);x(function(){c||(Log(DEBUG,"Hard Limit, time exceed"),angular.forEach(g,function(a,b){a.reject(a.ctx.name)}),z())},125E3)};a.env.supportDB?(k(s),r()):v();s("dialogClose")}}}};
a.uiref=a.modal_db[w];a.tref=a.modal_db[w]}]);app.controller("configManagementCtrl",["$scope","MyHttp","usb_lib","Upload","userAccessRight","$q","UserSession","$cookies","modelInfo","deviceTime","dt",function(a,b,t,m,w,u,p,q,e,x,n){a.success=!1;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&p.logout();var l=function(){return b.post({url:resource_base+"data/config_state.json",method:"get_config_state",error:function(a){console.log("configManagementCtrl getConfigMgtData Error status: "+a.status)}})},r=function(b){b||
(b={});b=b["config-state"]||{};a.model.running_upt=n.genTimeStrByTimeStamp(b["running-update-time"],"N/A");a.model.startup_upt=n.genTimeStrByTimeStamp(b["startup-update-time"],"N/A");a.model.mirror_upt=n.genTimeStrByTimeStamp(b["mirror-update-time"],"N/A");a.model.backup_upt=n.genTimeStrByTimeStamp(b["backup-update-time"],"N/A")},v=function(b){b||(b={});a.model.usbs={};a.schema.srcOps=angular.copy(c);angular.forEach(b,function(b,c){b&&(a.model.usbs[c]=!0,a.schema.srcOps.push({id:c,displayName:"Upload File from "+
c}))})},s=function(){var c="FILE://"+a.model.source+"/";angular.forEach(a.model.usb_file_path,function(a){c=c+a+"/"});b.post({method:"action",params:{rpc:"file-list",input:{source:{"location-url":c}}},success:function(b){k(b&&b.data&&b.data.result||{});a.model.sel_usb_file=a.model.usb_file_list[0]&&a.model.usb_file_list[0].id||"";a.chk_usbfile();a.srcIsUsb=!0},error:function(a){k()}})},k=function(b){b||(b={});b=(b.output||{})["file-names"]||[];a.model.usb_file_list=[];a.model.usb_file_path.length&&
a.model.usb_file_list.push({id:"/BackKey",displayName:a.DICT("Config_Management_Up_One_Level"),isBack:!0});angular.forEach(b,function(b){b["file-name"]&&a.model.usb_file_list.push({id:b["file-name"],displayName:b["file-name"]+(b.directory?"/":""),isDirectroy:!0===b.directory})})},d=function(a,c,g){b.post({method:"action",popRPCResonsepAlert:!0,params:a,success:function(a){"function"===$.type(c)&&c(a);g&&y()},error:function(a){"function"===$.type(c)&&c(a);g&&y()}})},c=[{id:"config-running",displayName:a.DICT("Config_Management_Running_Configuration_N")},
{id:"config-startup",displayName:a.DICT("Config_Management_Startup_Configuration_N")},{id:"config-backup",displayName:a.DICT("Config_Management_Backup_Configuration_N")},{id:"config-mirror",displayName:a.DICT("Config_Management_Mirror_Configuration_N")},{id:"pc-upload",displayName:a.DICT("Config_Management_Upload_File_From_PC")}],h=[{id:"config-running",displayName:a.DICT("Config_Management_Running_Configuration_N")},{id:"config-startup",displayName:a.DICT("Config_Management_Startup_Configuration_N")},
{id:"config-backup",displayName:a.DICT("Config_Management_Backup_Configuration_N")}],g=function(){var b=!0,c,g=angular.copy(h);for(c=g.length-1;0<=c;c--)a.model.source===g[c].id&&g.splice(c,1);a.schema.destOps=g;switch(a.model.source){case "config-running":case "config-startup":case "config-backup":case "config-mirror":a.schema.destOps.push({id:"download_to_pc",displayName:a.DICT("Config_Management_Download_To_PC")});angular.forEach(a.model.usbs,function(b,c){a.schema.destOps.push({id:c,displayName:a.DICT("Config_Management_Save_To")+
c})});break;default:a.model.source.match(/(^pc-upload$|^USB\d+$)/)&&(a.schema.destOps=[{id:"config-running",displayName:a.DICT("Config_Management_Running_Configuration_N")}],a.model.destOps="config-running")}angular.forEach(a.schema.destOps,function(c){a.model.dest===c.id&&(b=!1)});b&&(a.model.dest=a.schema.destOps[0].id)},A=function(){a.dataReady=!1;u.all([l(),t.usbs_avaiable()]).then(function(b){a.model.save_icon_blinking="1"===q.get("blinking");r(b[0]&&b[0].data&&b[0].data.result||{});v(b[1]||
{});a.model.source=a.schema.srcOps[0].id;g();a.model.dest=a.schema.destOps[0].id;a.check_ops(!0);a.dataReady=!0})},y=function(){u.all([l(),t.usbs_avaiable()]).then(function(b){a.model.save_icon_blinking="1"===q.get("blinking");r(b[0]&&b[0].data&&b[0].data.result||{});v(b[1]||{})})};a.schema={srcOps:angular.copy(c),destOps:angular.copy(h),StatusMap:{"true":a.DICT("Config_Management_Enable"),"false":a.DICT("Config_Management_Disable")}};a.dataReady=!1;a.save_disable=!1;a.sel_file_is_invalid=!1;a.srcIsUsb=
!1;a.pcFile=void 0;a.displayRPCInfo=!1;a.rpcResult=!0;a.rpcStr="";a.file_format_note=a.DICT("Config_Management_File_Format",{"%s":5});a.model={running_upt:"",startup_upt:"",mirror_upt:"",backup_upt:"",usbs:[],usb_file_list:[],usb_file_path:[],source:"",dest:"",save_icon_blinking:!1,sel_usb_file:"",uploadId:void 0};a.check_ops=function(b){b&&(g(),a.srcIsUsb=!1,a.sel_file_is_invalid=!1,a.model.source.match(/^USB\d+$/)&&(a.model.usb_file_path=[],s()));a.displayRPCInfo=!1;a.save_disable=a.model.source===
a.model.dest||a.sel_file_is_invalid;"pc-upload"===a.model.source&&!a.pcFile&&(a.save_disable=!0);a.srcIsInvalid=!1;switch(a.model.source){case "config-running":"N/A"===a.model.running_upt&&(a.srcIsInvalid=!0);break;case "config-startup":"N/A"===a.model.startup_upt&&(a.srcIsInvalid=!0);break;case "config-backup":"N/A"===a.model.backup_upt&&(a.srcIsInvalid=!0);break;case "config-mirror":"N/A"===a.model.mirror_upt&&(a.srcIsInvalid=!0)}};a.pcFileInvalid=!1;a.resetFormatCheck=function(b){a.pcFileInvalid=
!1;"pc-upload"===a.model.source&&a.pcFileFormatCheck(a.pcfile);a.check_ops(!0)};a.pcFileFormatCheck=function(b){a.pcFileInvalid=!1;if(void 0!=b){a.pcfile=b;if("pc-upload"===a.model.source){if(5242880<parseInt(b.size,10)){a.pcFileInvalid=!0;return}if(!b.name.toLowerCase().match(/(\.xml){1}$/)){a.pcFileInvalid=!0;return}}a.pcFile=b;a.check_ops()}};a.sync_file_sel=function(b){a.pcFile=b;a.check_ops()};a.chk_usbfile=function(){a.sel_file_is_invalid=!1;a.model.sel_usb_file||(a.sel_file_is_invalid=!0);
angular.forEach(a.model.usb_file_list,function(b){a.model.sel_usb_file===b.id&&(b.isDirectroy&&(a.sel_file_is_invalid=!0),b.isBack&&(a.sel_file_is_invalid=!0))});a.check_ops()};a.click_usbfile=function(){var b={};angular.forEach(a.model.usb_file_list,function(c){a.model.sel_usb_file===c.id&&(b=c)});b.isBack?(a.model.usb_file_path.splice(a.model.usb_file_path.length-1,1),s()):(Log(DEBUG,"---"+JSON.stringify(b)),b.isDirectroy&&(a.model.usb_file_path.push(b.id),s()))};a.funs={save:function(){var c=a.model.source,
g=a.model.dest,y="file-copy",h={fileType:"configuration"},A=function(a){a=a.data&&a.data.result&&a.data.result.output||{};switch(void 0!==a.code?a.code:void 0){case 0:("config-running"===c&&"config-startup"===g||"config-startup"===c&&"config-running"===g)&&app.TOOLS.get_scope("headerCtrl").disable_save_warning()}};switch(c){case "config-running":case "config-startup":case "config-backup":case "config-mirror":switch(g){case "config-running":case "config-startup":case "config-backup":y="file-copy";
angular.extend(h,{source:{"config-type":c},destination:{"config-type":g}});d({rpc:y,input:h},A,!0);return;case "download_to_pc":var k,y="file-download";angular.extend(h,{"config-type":c});b.post({method:"action",params:{rpc:y,input:h},success:function(b){var c=b&&b.data&&b.data.result||{};b=c.output&&c.output.errstr||"";var g=c.output&&c.output["download-url"]||"";0===(c.output&&void 0!==c.output.code?c.output.code:void 0)&&g?(b||(b=a.DICT("Config_Management_Configure_Download_Success")),k=g.split("/"),
c=k[k.length-1],app.TOOLS.download_save_to(g,c,"text/xml"),app.TOOLS.successAlertBox({title:a.DICT("Information"),msg:b,cbk:function(){}})):(b||(b=a.DICT("Config_Management_Configure_Has_Error")),app.TOOLS.criticalAlertBox({titile:a.DICT("Alert"),msg:b,cbk:function(){}}))},error:function(a){console.log("Error for file download status: "+a.status)}});break;default:x.get_time(function(a){a=(e.get_pid()||"nullFileName")+"_configuration_"+a+".xml";y="file-copy";angular.extend(h,{source:{"config-type":c},
destination:{"location-url":"FILE://"+g+"/"+a}});d({rpc:y,input:h},A)})}break;case "pc-upload":a.model.errconfig=!1;a.model.validconfig=!1;y="file-upload";app.transition.In();a.model.uploadId=m.upload({url:resource_base+"upload",headers:{"optional-header":"header-value"},data:{sessionid:q.get("sessionid"),pathparam:"Configuration",fileparam:"Configuration",file:a.pcFile}}).then(function(a){y="file-copy";angular.extend(h,{source:{"location-url":"FILE://Configuration/Configuration"},destination:{"config-type":g}});
d({rpc:y,input:h},void 0,!0);app.transition.Out()},function(b){app.transition.Out();app.TOOLS.criticalAlertBox({title:a.DICT("Alert"),msg:a.DICT("Config_Management_Upload_Failure"),cbk:function(){}});Log(DEBUG,"err for upload "+b.status)});break;default:if(c.match(/^USB\d+$/)){a.model.errconfig=!1;a.model.validconfig=!1;var l="FILE://"+c+"/",y="file-copy";angular.forEach(a.model.usb_file_path,function(a){l=l+a+"/"});l+=a.model.sel_usb_file;angular.extend(h,{source:{"location-url":l},destination:{"config-type":g}});
d({rpc:y,input:h},void 0,!0)}else console.log("Error source "+c)}},cancel:function(){A()},blinking:function(){a.model.save_icon_blinking=!0===a.model.save_icon_blinking?!1:!0;(function(){b.post({url:resource_base+"data/config_management.json",method:"set_gui",params:{gui:{"save-icon-blinking":a.model.save_icon_blinking}},success:function(b){a.success=!0;!1===a.model.save_icon_blinking?q.put("blinking","0"):q.put("blinking","1");app.TOOLS.get_scope("headerCtrl").check_save_blinking()},error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}})})()}};A()}]);var app_cert_data={counrtylist:[{id:"AD",displayName:"Andorra"},{id:"AE",displayName:"United Arab Emirates"},{id:"AF",displayName:"Afghanistan"},{id:"AG",displayName:"Antiqua And Barb"},{id:"AI",displayName:"Anguilla"},{id:"AL",displayName:"Albania"},{id:"AM",displayName:"Armenia"},{id:"AN",displayName:"Netherlands Antilles"},{id:"AO",displayName:"Angola"},{id:"AQ",displayName:"Antarctica"},{id:"AR",displayName:"Argentina"},{id:"AS",displayName:"American Samoa"},{id:"AT",displayName:"Austria"},{id:"AU",
displayName:"Australia"},{id:"AW",displayName:"Aruba"},{id:"AZ",displayName:"Azerbaijan"},{id:"BA",displayName:"Bosnia and Herzegovina"},{id:"BB",displayName:"Barbados"},{id:"BD",displayName:"Bangladesh"},{id:"BE",displayName:"Belgium"},{id:"BF",displayName:"Burkina Faso"},{id:"BG",displayName:"Bulgaria"},{id:"BH",displayName:"Bahrain"},{id:"BI",displayName:"Burundi"},{id:"BJ",displayName:"Benin"},{id:"BM",displayName:"Bermuda"},{id:"BN",displayName:"Brunei Darussalam"},{id:"BO",displayName:"Bolivia"},
{id:"BR",displayName:"Brazil"},{id:"BS",displayName:"Bahamas"},{id:"BT",displayName:"Bhutan"},{id:"BV",displayName:"Bouvet Islands"},{id:"BW",displayName:"Botswana"},{id:"BZ",displayName:"Belize"},{id:"CA",displayName:"Canada"},{id:"CC",displayName:"Cocos (Keeling) Islands"},{id:"CF",displayName:"Central African Republic"},{id:"CH",displayName:"Switzerland"},{id:"CI",displayName:"Cote D'Ivoire (Ivory Coast)"},{id:"CK",displayName:"Cook Islands"},{id:"CL",displayName:"Chile"},{id:"CM",displayName:"Cameroon"},
{id:"CN",displayName:"China"},{id:"CO",displayName:"Colombia"},{id:"CR",displayName:"Costa Rica"},{id:"CU",displayName:"Cuba"},{id:"CV",displayName:"Cape Verde"},{id:"CX",displayName:"Chrismas Island"},{id:"CY",displayName:"Cyprus"},{id:"CZ",displayName:"Czech Republic"},{id:"DE",displayName:"Germany"},{id:"DE",displayName:"Djibouti"},{id:"DK",displayName:"Denmark"},{id:"DM",displayName:"Dominica"},{id:"DO",displayName:"Dominican Republic"},{id:"DZ",displayName:"Algeria"},{id:"EC",displayName:"Ecuador"},
{id:"EE",displayName:"Estonia"},{id:"EG",displayName:"Egypt"},{id:"EH",displayName:"Western Sahara"},{id:"ER",displayName:"Eritrea"},{id:"ES",displayName:"Spain"},{id:"ET",displayName:"Ethiopia"},{id:"FI",displayName:"Finland"},{id:"FJ",displayName:"Fiji"},{id:"FK",displayName:"Falkland Islands (Malvinas)"},{id:"FM",displayName:"Micronesia"},{id:"FO",displayName:"Faroe Islands"},{id:"FR",displayName:"France"},{id:"FX",displayName:"France, Metropolitan"},{id:"GA",displayName:"Gabon"},{id:"GB",displayName:"Great Britain (UK)"},
{id:"GD",displayName:"Grenada"},{id:"GE",displayName:"Georgia"},{id:"GF",displayName:"French Guiana"},{id:"GG",displayName:"Guernsey"},{id:"GH",displayName:"Ghana"},{id:"GI",displayName:"Gibraltar"},{id:"GL",displayName:"Greenland"},{id:"GM",displayName:"Gambia"},{id:"GN",displayName:"Guinea"},{id:"GP",displayName:"Guadeloupe"},{id:"GQ",displayName:"Equatorial Guinea"},{id:"GR",displayName:"Greece"},{id:"GS",displayName:"S. Georgia and S. Sandwich Isls."},{id:"GT",displayName:"Guatemala"},{id:"GU",
displayName:"Guam"},{id:"GW",displayName:"Guinea-Bissau"},{id:"GY",displayName:"Guyana"},{id:"HK",displayName:"Hong Kong"},{id:"HM",displayName:"Heard and McDonald Islands"},{id:"HN",displayName:"Honduras"},{id:"HR",displayName:"Croatia (Hrvatska)"},{id:"HT",displayName:"Haiti"},{id:"HU",displayName:"Hungary"},{id:"ID",displayName:"Indonesia"},{id:"IE",displayName:"Ireland"},{id:"IL",displayName:"Israel"},{id:"IM",displayName:"Isle of Man"},{id:"IN",displayName:"India"},{id:"IO",displayName:"British Indian Ocean Territory"},
{id:"IS",displayName:"Iceland"},{id:"IT",displayName:"Italy"},{id:"JE",displayName:"Jersey"},{id:"JM",displayName:"Jamaica"},{id:"JM",displayName:"Jordan"},{id:"JP",displayName:"Japan"},{id:"KE",displayName:"Kenya"},{id:"KG",displayName:"Kyrgyzstan"},{id:"KG",displayName:"Cambodia"},{id:"KI",displayName:"Kiribati"},{id:"KM",displayName:"Comoros"},{id:"KN",displayName:"Saint Kitts and Nevis"},{id:"KR",displayName:"Korea (South)"},{id:"KW",displayName:"Kuwait"},{id:"KY",displayName:"Cayman Islands"},
{id:"KZ",displayName:"Kazakhstan"},{id:"LA",displayName:"Laos"},{id:"LB",displayName:"Lebanon"},{id:"LC",displayName:"Saint Lucia"},{id:"LI",displayName:"Liechtenstein"},{id:"LK",displayName:"Sri Lanka"},{id:"LS",displayName:"Lesotho"},{id:"LT",displayName:"Lithuania"},{id:"LU",displayName:"Luxembourg"},{id:"LV",displayName:"Latvia"},{id:"LY",displayName:"Libya"},{id:"MA",displayName:"Morocco"},{id:"MC",displayName:"Monaco"},{id:"MD",displayName:"Moldova"},{id:"ME",displayName:"Montenegro"},{id:"MG",
displayName:"Madagascar"},{id:"MH",displayName:"Marshall Islands"},{id:"MK",displayName:"Macedonia"},{id:"ML",displayName:"Mali"},{id:"MM",displayName:"Myanmar"},{id:"MN",displayName:"Mongolia"},{id:"MO",displayName:"Macau"},{id:"MP",displayName:"Northern Mariana Islands"},{id:"MQ",displayName:"Martinique"},{id:"MR",displayName:"Mauritania"},{id:"MS",displayName:"Montserrat"},{id:"MT",displayName:"Malta"},{id:"MU",displayName:"Mauritius"},{id:"MV",displayName:"Maldives"},{id:"MW",displayName:"Malawi"},
{id:"MX",displayName:"Mexico"},{id:"MY",displayName:"Malaysia"},{id:"MZ",displayName:"Mozambique"},{id:"NA",displayName:"Namibia"},{id:"NC",displayName:"New Caledonia"},{id:"NE",displayName:"Niger"},{id:"NF",displayName:"Norfolk Island"},{id:"NG",displayName:"Nigeria"},{id:"NI",displayName:"Nicaragua"},{id:"NL",displayName:"Netherlands"},{id:"NO",displayName:"Norway"},{id:"NP",displayName:"Nepal"},{id:"NR",displayName:"Nauru"},{id:"NT",displayName:"Neutral Zone"},{id:"NU",displayName:"Niue"},{id:"NZ",
displayName:"New Zealand (Aotearoa)"},{id:"OM",displayName:"Oman"},{id:"PA",displayName:"Panama"},{id:"PE",displayName:"Peru"},{id:"PF",displayName:"French Polynesia"},{id:"PG",displayName:"Papua New Guinea"},{id:"PH",displayName:"Philippines"},{id:"PK",displayName:"Pakistan"},{id:"PL",displayName:"Poland"},{id:"PM",displayName:"St. Pierre and Miquelon"},{id:"PN",displayName:"Pitcairn"},{id:"PR",displayName:"Puerto Rico"},{id:"PT",displayName:"Portugal"},{id:"PW",displayName:"Palau"},{id:"PY",displayName:"Paraguay"},
{id:"QA",displayName:"Qatar"},{id:"RE",displayName:"Reunion"},{id:"RO",displayName:"Romania"},{id:"RS",displayName:"Serbia"},{id:"RU",displayName:"Russian Federation"},{id:"RW",displayName:"Rwanda"},{id:"SA",displayName:"Saudi Arabia"},{id:"SB",displayName:"Solomon Islands"},{id:"SC",displayName:"Seychelles"},{id:"SD",displayName:"Sudan"},{id:"SE",displayName:"Sweden"},{id:"SG",displayName:"Singapore"},{id:"SH",displayName:"St. Helena"},{id:"SI",displayName:"Slovenia"},{id:"SJ",displayName:"Svalbard and Jan Mayen Islands"},
{id:"SK",displayName:"Slovak Republic"},{id:"SL",displayName:"Sierra Leone"},{id:"SM",displayName:"San Marino"},{id:"SN",displayName:"Senegal"},{id:"SR",displayName:"Suriname"},{id:"ST",displayName:"Sao Tome and Principe"},{id:"SV",displayName:"El Salvador"},{id:"SY",displayName:"Syria"},{id:"SZ",displayName:"Swaziland"},{id:"TC",displayName:"Turks And Caicos Island"},{id:"TD",displayName:"Chad"},{id:"TF",displayName:"French Southern Territories"},{id:"TG",displayName:"Togo"},{id:"TH",displayName:"Thailand"},
{id:"TJ",displayName:"Tajikistan"},{id:"TK",displayName:"Tokelau"},{id:"TM",displayName:"Turkmenistan"},{id:"TN",displayName:"Tunisia"},{id:"TO",displayName:"Tonga"},{id:"TP",displayName:"East Timor"},{id:"TR",displayName:"Turkey"},{id:"TT",displayName:"Trinidad and Tobago"},{id:"TV",displayName:"Tuvalu"},{id:"TW",displayName:"Taiwan"},{id:"TZ",displayName:"Tanzania"},{id:"UA",displayName:"Ukraine"},{id:"UG",displayName:"Uganda"},{id:"UM",displayName:"US Minor Outlying Islands"},{id:"US",displayName:"United States"},
{id:"UY",displayName:"Uruguay"},{id:"UZ",displayName:"Uzbekistan"},{id:"VA",displayName:"Vatican City State (Holy See)"},{id:"VC",displayName:"Saint Vincent and the Grenadines"},{id:"VE",displayName:"Venezuela"},{id:"VG",displayName:"Virgin Islands (British)"},{id:"VI",displayName:"Virgin Islands (U.S.)"},{id:"VN",displayName:"Viet Nam"},{id:"VU",displayName:"Vanuatu"},{id:"WF",displayName:"Wallis and Futura Islands"},{id:"WS",displayName:"Samoa"},{id:"YE",displayName:"Yemen"},{id:"YT",displayName:"Mayotte"},
{id:"ZA",displayName:"South Africa"},{id:"ZM",displayName:"Zambia"}]};app.controller("diagnostic_main",["$scope","$q","MyHttp","$templateCache","UserSession","usb_lib","$uibModal","userAccessRight","Sets","rpcFns","$timeout","modificationWarning","$cookies",function(a,b,t,m,w,u,p,q,e,x,n,l,r){a.model=a.model||{};a.usbs_avaiable=void 0;a.success=!1;a.loadReady=!1;a.animationsEnabled=!0;a.forcedUsingPost=!1;var v={procBackground:!0,forcedUsingPost:a.forcedUsingPost},s={procBackground:!1,forcedUsingPost:a.forcedUsingPost};a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&
"RO"!==a.userAccessFlag&&w.logout();var k=function(){a.loadReady=!1;a.rpc_ping={active_id:0,err_str:"",dest_ip:"",src:"auto",size:32,echo_count:4};a.rpc_traceroute={active_id:0,err_str:"",max_ttl:30,target:""};a.rpc_dnslookup={active_id:0,err_str:"",target:""};a.rpc_export_to_pc={};a.rpc_export_to_usb={dest:""};a.rpc_email_to={email:""};a.rpc_usb_state={usbDevList:[]};r.remove("ping_focused_id");r.remove("traceroute_focused_id");r.remove("dnslookup_focused_id");b.all({}).then(function(b){a.model=
{};a.schema={};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.loadReady=!0})["catch"](function(a){Log(DEBUG,"=="+a)})},d=function(b,c){c=c||0;var A=function(){n(function(){var y=parseInt(r.get("ping_focused_id")||0);b===a.rpc_ping.active_id&&b===y&&(20>c?d(b,c):Log(DEBUG,"------------------------------------------------------------\r\n(No more response text, retry count: "+c+" times, aborted)"))},2E3)};a.rpc_ping.errstr=
"";return x.RPC_generic_send("utility_ping_status",{},function(b,d,h){h&&(b=h.code,0===b||"0"===b?(h.text?(c=0,a.rpc_ping.console_text=h.text):c++,!1===h.is_final?A():r.remove("ping_focused_id")):(Log(DEBUG,"Error: utility_ping_status, RPC = "+JSON.stringify(h)),a.rpc_ping.errstr=h.errstr))},function(b){a.rpc_ping.errstr="RPC utility_ping_status request failed"},v)};a.RPC_ping_start=function(){var b=a.rpc_ping,b={echo_count:b.echo_count,size:b.size,"interface":"auto"!==b.src?b.src:void 0,target:a.model.ping_traceroute_target};
a.rpc_ping.console_text="";a.rpc_ping.active_id+=1;a.rpc_ping.errstr="";r.put("ping_focused_id",a.rpc_ping.active_id);a.rpc_traceroute.console_text=void 0;a.rpc_traceroute.errstr="";a.rpc_traceroute.active_id+=1;return x.RPC_generic_send("utility_ping_start",b,function(b,c,y){if(y)if(b=y.code,0===b||"0"===b){var h=a.rpc_ping.active_id;n(function(){d(h)},1E3)}else Log(ERROR,"Error: utility_ping_start, RPC = "+JSON.stringify(y)),a.rpc_ping.console_text=y.errstr,a.rpc_ping.errstr=y.errstr},function(b){a.rpc_ping.errstr=
"RPC utility_ping_start request failed"},v)};a.RPC_ping_stop=function(){a.rpc_ping.active_id+=1;a.rpc_ping.errstr="";r.remove("ping_focused_id");return x.RPC_generic_send("utility_ping_stop",{},function(b,c,d){d&&(b=d.code,0===b||"0"===b||(Log(DEBUG,"Error: utility_ping_stop, RPC = "+JSON.stringify(d)),a.rpc_ping.errstr=d.errstr))},function(b){a.rpc_ping.errstr="RPC utility_ping_stop request failed"},v)};var c=function(b,g){g=g||0;var d=function(){n(function(){var d=parseInt(r.get("traceroute_focused_id")||
0);b===a.rpc_traceroute.active_id&&b===d&&(20>g?c(b,g):Log(DEBUG,"------------------------------------------------------------\r\n(No more response text, retry count: "+g+" times, aborted)"))},2E3)};a.rpc_traceroute.errstr="";return x.RPC_generic_send("utility_traceroute_status",{},function(b,c,h){h&&(b=h.code,0===b||"0"===b?(h.text?(g=0,a.rpc_traceroute.console_text=h.text):g++,!1===h.is_final?d():r.remove("traceroute_focused_id")):(Log(DEBUG,"Error: utility_traceroute_status, RPC = "+JSON.stringify(h)),
a.rpc_traceroute.errstr=h.errstr))},function(b){a.rpc_traceroute.errstr="RPC utility_traceroute_status request failed"},v)};a.RPC_traceroute_start=function(){var b=a.rpc_traceroute,b={target:a.model.ping_traceroute_target,initial_ttl:b.initial_ttl,max_ttl:b.max_ttl};a.rpc_traceroute.console_text="";a.rpc_traceroute.active_id+=1;a.rpc_traceroute.errstr="";r.put("traceroute_focused_id",a.rpc_traceroute.active_id);a.rpc_ping.console_text=void 0;a.rpc_ping.errstr="";a.rpc_ping.active_id+=1;return x.RPC_generic_send("utility_traceroute_start",
b,function(b,d,y){if(y)if(b=y.code,0===b||"0"===b){var h=a.rpc_traceroute.active_id;n(function(){c(h)},1E3)}else Log(DEBUG,"Error: utility_traceroute_start, RPC = "+JSON.stringify(y)),a.rpc_traceroute.errstr=y.errstr},function(b){a.rpc_traceroute.errstr="RPC utility_traceroute_start request failed"},v)};a.RPC_traceroute_stop=function(){a.rpc_traceroute.active_id+=1;a.rpc_traceroute.errstr="";r.remove("traceroute_focused_id");return x.RPC_generic_send("utility_traceroute_stop",{},function(b,c,d){d&&
(b=d.code,0===b||"0"===b||(Log(DEBUG,"Error: utility_traceroute_stop, RPC = "+JSON.stringify(d)),a.rpc_traceroute.errstr=d.errstr))},function(b){a.rpc_traceroute.errstr="RPC utility_traceroute_stop request failed"},v)};a.RPC_dnslookup_start=function(){var b={target:a.model.lookup_target};a.rpc_dnslookup.console_text="";a.rpc_dnslookup.active_id+=1;a.rpc_dnslookup.errstr="";r.put("dnslookup_focused_id",a.rpc_dnslookup.active_id);return x.RPC_generic_send("utility-dnslookup",b,function(b,c,d){c=(b.data.result||
{}).output||{};if(-1===c.code)a.rpc_dnslookup.console_text=c.errstr;else if(b=c.responses,c="Server:"+c.server+"\nAddress: "+c.target+"\n\n",b){for(d=0;d<b.length;d++)c+="Name:  "+b[d].name+"\nAddress: "+b[d].value+"\n";a.rpc_dnslookup.console_text=c}},function(b){a.rpc_dnslookup.errstr="RPC utility_dnslookup_start request failed"},{procBackground:!0,forcedUsingPost:a.forcedUsingPost})};a.RPC_dnslookup_stop=function(){a.rpc_dnslookup.active_id+=1;a.rpc_dnslookup.errstr="";r.remove("dnslookup_focused_id");
return x.RPC_generic_send("utility_dnslookup_stop",{},function(b,c,d){d&&(b=d.code,0===b||"0"===b||(Log(DEBUG,"Error: utility_dnslookup_stop, RPC = "+JSON.stringify(d)),a.rpc_dnslookup.errstr=d.errstr))},function(b){a.rpc_dnslookup.errstr="RPC utility_dnslookup_stop request failed"},v)};a.RPC_export_to_pc=function(){var b=0,c=function(y){if(y){var z=y.split("/");app.TOOLS.download_save_to2(y,z[z.length-1],"application/octet-stream").then(function(a){},function(z){2<=b?d(a.DICT("Diagnostic_Download_File_Failure_By_Retry")):
n(function(){b++;c(y)},1E3)})}else d($scon.DICT("Diagnostic_Download_Url_Is_Unknow"))},d=function(a){app.TOOLS.criticalAlertBox({msg:a,cbk:function(a){}})};x.RPC_generic_send("file-download",{fileType:"tech-report"},function(b,h,B){b=B.code;var k=B.errstr;switch(b){case 0:var l=B["download-url"]||void 0;n(function(){c(l)},1E3);break;default:k||(k=a.DICT("Diagnostic_Download_Failure")),d(k),Log(DEBUG,h+": RPC done. got unknown code: "+b+" errstr= "+k)}},function(b){a.rpc_export_to_pc.errstr="RPC export_to_pc request failed"},
s)};a.RPC_check_USB_attached=function(){var b=a.rpc_usb_state;return x.RPC_generic_send("usb-check-attached",void 0,function(c,d,y){c=y.usbs||[];b.usbDevList=[];for(d=0;d<c.length;d++)y=c[d],!0===y.attached&&b.usbDevList.push(y.name);a.rpc_export_to_usb.dest=b.usbDevList[0]},void 0,s)};a.RPC_export_to_usb=function(){x.RPC_generic_send("file-copy",{fileType:"tech-report",destination:{"location-url":"FILE://"+a.rpc_export_to_usb.dest+"/"+a.rpc_export_to_usb.filename}},function(b,c,d){if(d){b=d.code;
c=d.errstr;var y="";0===b||"0"===b?(a.console_text="Success",y=a.DICT("Diagnostic_Export_Technical_Support_Report_Success"),app.TOOLS.successAlertBox({msg:y,cbk:function(a){}})):(c||(c=a.DICT("Diagnostic_Export_To_Usb_Failure")),app.TOOLS.criticalAlertBox({msg:c,cbk:function(a){}}),Log(DEBUG,"Error: export_to_usb, RPC = "+JSON.stringify(d)),a.rpc_export_to_usb.errstr=d.errstr)}},function(b){a.rpc_export_to_usb.errstr="RPC export_to_usb request failed"},s)};a.report_to_usb=function(){var c=function(){p.open({animation:a.animationsEnabled,
templateUrl:"tech_report_export_to_usb.html",controller:"report_to_usb_ctrl",size:"sm",resolve:{usbs_avaiable:function(){return a.usbs_avaiable},usb_name:function(){return""}}}).result.then(function(b){var c=function(a){return 10>parseInt(a,10)?"0"+a:a.toString()},d=new Date;d.getYear();c(d.getMonth()+1);c(d.getDate());c(d.getHours());c(d.getMinutes());c(d.getSeconds());a.rpc_export_to_usb.dest=b;a.rpc_export_to_usb.filename="";a.RPC_export_to_usb()},function(){Log(DEBUG,"do nothing")})};b.all([u.usbs_avaiable()]).then(function(b){a.usbs_avaiable=
b[0];c()})};a.RPC_email_to=function(){x.RPC_generic_send("file-copy",{fileType:"tech-report",destination:{"location-url":a.rpc_email_to.email}},function(b,c,d){d&&(b=d.code,c="",0===b||"0"===b?(a.console_text="Success",c=a.DICT("Diagnostic_Mail_Sended"),app.TOOLS.successAlertBox({msg:c,cbk:function(a){}})):(Log(ERROR,"Error: email_to, RPC = "+JSON.stringify(d)),a.rpc_email_to.errstr=d.errstr,c="Abnormal:"+d.errstr))},function(b){a.rpc_email_to.errstr="RPC email_to request failed"},s)};a.report_to_email=
function(){(function(){p.open({animation:a.animationsEnabled,templateUrl:"tech_report_export_to_email.html",controller:"report_to_email_ctrl",size:"",resolve:{}}).result.then(function(b){a.rpc_email_to.email=b.email;a.RPC_email_to()},function(){Log(DEBUG,"do nothing")})})()};a.export_toggle=function(b){a[b]=!a[b];"fg_email_to"===b?a.fg_export_usb=!1:("fg_export_usb"!==b&&(a.fg_export_usb=!1),a.fg_email_to=!1);a.console_text=""};a.cancel=function(){k();a.resetModified()};k()}]);
app.controller("report_to_usb_ctrl",["$scope","$uibModalInstance","usbs_avaiable",function(a,b,t,m){a.usbs_avaiable=t;a.usb_name=m;a.save=function(){b.close(a.usb_name)};a.cancel=function(){b.dismiss()}}]);app.controller("report_to_email_ctrl",["$scope","$uibModalInstance",function(a,b){a.param={email:""};a.save=function(){b.close(a.param)};a.cancel=function(){b.dismiss()}}]);app.controller("rebootCtrl",["$scope","MyHttp","$uibModal","$timeout","UserSession","userAccessRight","factory_to_default","$cookies",function(a,b,t,m,w,u,p,q){q=app.TOOLS.get_scope("headerCtrl");a.msg="";a.config_modified=!1;q&&(q.warnings&&q.warnings.save.enable)&&(a.config_modified=!0);var e=["1.0.00","1.0.01"];a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var x=function(){b.post({url:resource_base+"data/automatic_updates.json",method:"get_image",success:function(a){a.data&&
a.data.result?n(a.data.result):n()},error:function(a){Log(ERROR,"rebootCtrl getFirmwareData error: "+a.status);n()}})},n=function(b){b||(b={});var l=[];b=b["image-state"]&&b["image-state"].firmware||{};b.images&&b.images.image&&(l=b.images.image);a.model.images=[];a.sel_image="";a.orig_sel_image="";l.length?angular.forEach(l,function(b,d){"active"===b.active?(a.sel_image=b.name,a.model.images.push({id:b.name,active:!0,version:b.version||"",displayName:a.DICT("Reboot_Active_Image")+" - "+b.version})):
a.model.images.push({id:b.name,version:b.version||"",active:!1,displayName:a.DICT("Reboot_Inactive_Image")+" - "+b.version})}):(a.model.images.push({id:"@noListFirmware",version:"",active:!0,displayName:a.DICT("Reboot_Active_Image")}),a.sel_image=a.model.images[0].id);!a.sel_image&&a.model.images.length&&(a.sel_image=a.model.images[0].id);a.orig_sel_image=a.sel_image};a.reboot_opt="none";a.sel_image="";a.model={images:[]};a.ctx=a.ctx||{};a.funs={rebootConfirm:function(b){var l=!1;angular.forEach(a.model.images,
function(b){b.id===a.sel_image&&angular.forEach(e,function(a){b.version.match(a)&&(l=!0)})});if(l)a.msg=a.DICT("Reboot_Downgraded_Note");else switch(a.reboot_opt){case "none":a.msg=a.config_modified?a.DICT("Reboot_Reboot_With_Modified_Configure_Note"):a.DICT("Reboot_Reboot_Note");break;case "factory-default-config":a.msg=a.DICT("Reboot_Reboot_Factory_To_Default_Note");break;case "factory-default-config-certificate":a.msg=a.DICT("Reboot_Reboot_Factory_To_Default_Certificate_Note");break;default:return}app.TOOLS.warningAlertBox({msg:a.msg,
cbk:function(b){b&&a.funs.reboot()}})},tryIsDeviceReady:function(e){e=e||0;var s=document.location;a.ctx.reboot.newHost=s.protocol+"//"+s.host+"/";b.post({url:a.ctx.reboot.newHost+"login.html",procBackground:!0,error:function(a){Log(DEBUG,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(a){e+=1;Log(DEBUG,"get login resp. (successCount="+e+")")})["catch"](function(a){e=0;Log(DEBUG,"get login data failed, retry")});3>e?m(function(){a.funs.tryIsDeviceReady(e)},5E3):(l(),r(),w.logout())},
reboot:function(l){var e=function(b,c,h){switch(b){case 0:switch(a.reboot_opt){case "factory-default-config":case "factory-default-config-certificate":p.reset()}Log(DEBUG,"Device rebooting, try url loading..(3000)");a.ctx.reboot=a.ctx.reboot||{};a.openWaitRebootModal();m(function(){a.ctx.reboot.userControlPanel=!0;a.funs.tryIsDeviceReady()},3E3);break;default:Log(DEBUG,"Upgradeing process return failed")}},k=function(){var d="active";"@noListFirmware"!==a.sel_image&&angular.forEach(a.model.images,
function(b){a.sel_image===b.id&&(d=b.active?"active":"inactive")});b.post({method:"action",params:{rpc:"system-reboot",input:{"firmware-state":d,option:a.reboot_opt}},procBackground:!0,success:function(a){if(a.data&&a.data.result&&a.data.result.output){a=a.data.result.output;Log(DEBUG,a);var b=a.code;(0===b||"0"===b)&&e(b,"rebooting",a.errstr)}},error:function(a){Log(ERROR,"Reboot request failed");x()}})};l?b.post({method:"action",forcedUsingPost:!0,params:{rpc:"file-copy",input:{fileType:"configuration",
source:{"config-type":"config-running"},destination:{"config-type":"config-startup"}}},success:function(a){k()},error:function(b){app.TOOLS.warningAlertBox({msg:a.DICT("Reboot_Save_Configure_Failure"),cbk:function(a){a&&k()}})}}):k()}};a.waitRebootTimer=void 0;a.waitRebootModalInstance=void 0;a.openWaitRebootModal=function(){a.waitRebootModalInstance=t.open({animation:a.animationsEnabled,templateUrl:"wait_reboot_modal.htm",controller:"waitRebootCtrl",size:"600-radius-20",backdrop:"static"});a.waitRebootModalInstance.result.then(function(){a.waitRebootModalInstance=
void 0},function(b){a.waitRebootModalInstance=void 0});l();a.waitRebootTimer=setTimeout(function(){r()},3E5)};var l=function(){void 0!==a.waitRebootTimer&&(clearTimeout(a.waitRebootTimer),a.waitRebootTimer=void 0)},r=function(){a.waitRebootModalInstance&&(a.waitRebootModalInstance.close(),a.waitRebootTimer=void 0)};x()}]);app.service("certService",["$rootScope","Sets","dt",function(a,b,t){var m=a.DICT,w=function(a){a=a||{};var b=[],e="",e=function(a,e){angular.isDefined(e)&&b.push(a+"="+e)};e("C",a.country);e("ST",a["state-province"]);e("L",a.locality);e("O",a.organization);e("OU",a["organization-unit"]);e("CN",a["common-name"]);e("E",a.email);return e=b.join(", ")},u=function(a,b){var e="",e=w(a),x=w(b);return e=!b||!b["common-name"]||"-"===b["common-name"]?"-":e===x?m("Certificate_Self_Signed"):angular.isDefined(b["common-name"])?
b["common-name"]:"-"};this.combind_DN=w;this.genSignedbyStr=u;this.genCertType=function(){return{local:m("Certificate_Local_Certificate"),"ca-certification":m("Certificate_CA_Certificate"),"certification-sign-request":m("Certificate_Certificate_Signing_Request"),ambiguous:m("Certificate_Type_Is_Ambiguous")}};this.prepareCertCtx=function(a){if(a.info&&a.info.duration){var b=a.info.duration,e=b.end;b.start_str=t.genTimeStrByTimeStamp(b.start,"");b.end_str=t.genTimeStrByTimeStamp(e,"")}a["signed-by"]=
a.info&&a.info.subject&&a.info.issuer?u(a.info.subject,a.info.issuer):"-";a.info&&(!a.info.issuer||!a.info.duration)?a.type="certification-sign-request":a.info&&!0===a.info["is-ca-enabled"]?a.type="ca-certification":a.info&&!1===a.info["is-ca-enabled"]?a.type="local":a.type?Log(DEBUG,"By Pass, use RPC response of 'type'"):a.type="ambiguous"}}]);
app.controller("cert_main",["$scope","$uibModal","$log","$timeout","$q","rpcFns","MyHttp","certService","DSService","Upload","$templateCache","Sets","userAccessRight","UserSession",function(a,b,t,m,w,u,p,q,e,x,n,l,r,v){var s={source:"http",getResult:function(a,b,c){return l.getResult(this,a,b,c)},genProxy:e.genProxy};a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.rpc_genCert={};a.ctx.rpc_importCert={};a.loadReady=!1;a.pcFile=void 0;a.success=!1;a.forcedUsingPost=!0;var k={popRPCResonsepAlert:!0,procBackground:!1,
forcedUsingPost:a.forcedUsingPost};a.userAccessFlag=r.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var d=function(){var a=w.defer();p.post({url:resource_base+"data/cert2.json",method:"get_cert",success:function(b){a.resolve(b)},error:function(b){Log(ERROR,"AJAX loading error: "+b.status+", URL: "+b.config.url);a.reject(b)}});return a.promise},c=function(){var a=w.defer();p.post({url:resource_base+"data/cert_preinstaled.json",method:"get_ca_cert",params:{filter:{source:["pre-installed"]}},
success:function(b){a.resolve(b)},error:function(b){Log(ERROR,"AJAX loading error: "+b.status+", URL: "+b.config.url);a.reject(b)}});return a.promise},h=function(){w.all({cert:d()}).then(function(b){a.model={};a.model["certs-state"]=s.getResult(b.cert,"certs-state")||{};l.recover_object(a.model,{"certs-state":{cert:[]}});l.recover_object(a.ctx,{rpc_export:{password:"",format:"pkcs12",dest:"pc"}});g();A();angular.forEach(a.model["certs-state"].cert,function(a,b){a.gui_idx=b+1});a.gridCERT.Options.data=
a.model["certs-state"].cert;a.loadReady=!0;a.ctx.currPage="main_cert.htm";a.ctx.rpc_importCert={};angular.extend(a.ctx.rpc_importCert,{type:"local",name:"",password:void 0});a.ctx.importFrom="pc";setTimeout(function(){a.gridCERT.Options&&(a.gridCERT.Options.gridApi&&a.gridCERT.Options.gridApi.customApi&&a.gridCERT.Options.gridApi.customApi.checkSelectStatus)&&a.gridCERT.Options.gridApi.customApi.checkSelectStatus()},50)});a.resetModified();a.gridCERT.Selections.splice(0);a.gridCERT.notPrimaryCert=
!0},g=function(){angular.forEach(a.model["certs-state"].cert,function(b,c){q.prepareCertCtx(b);b.checked=!1;b.detail=[{cbk:a.gridCERT.detail,displayName:a.DICT("Certificate_Detail"),className:"icon-detail"}];b.actions=[{cbk:a.gridCERT.exportCert,disabled:!a.isExportable(b),displayName:a.DICT("Certificate_Export"),className:"grid-btn-export-s"}];a.isImportCSR(b)&&b.actions.push({cbk:a.importCertCSR,displayName:a.DICT("Certificate_Import"),className:"grid-btn-import-s"})})},A=function(){a.schema=a.schema||
{};a.schema.certType=q.genCertType();a.schema.genCertType=[{id:"local",displayName:a.DICT("Certificate_Self_Signing_Certificate")},{id:"certification-sign-request",displayName:a.DICT("Certificate_Certificate_Signing_Request")}];a.schema.importCertType=[{id:"local",displayName:a.DICT("Certificate_Local_Certificate")},{id:"ca-certification",displayName:a.DICT("Certificate_CA_Certificate")},{id:"pkcs12",displayName:a.DICT("Certificate_PKCS_Encoded")}];a.schema.genCertSubjectAltType=[{id:"ip",displayName:a.DICT("Certificate_IP_Addr")},
{id:"fqdn",displayName:a.DICT("Certificate_DNS")},{id:"email",displayName:a.DICT("Certificate_Email")}];a.schema.genCertKeyLenType=[{id:"512",displayName:"512"},{id:"1024",displayName:"1024"},{id:"2048",displayName:"2048"}];a.schema.genCertCA=[];(function(){angular.forEach(a.model["certs-state"].cert,function(b,c){b["has-private-key"]&&a.schema.genCertCA.push({id:b.name,displayName:b.name})})})();a.schema.genCertCountryName=app_cert_data.counrtylist;a.ctx.rpc_genCert={};angular.extend(a.ctx.rpc_genCert,
{type:"local","subject-alternative-type":"ip-type",country:a.schema.genCertCountryName[0].id,"key-encryption-length":"2048","valid-duration":360})};a.T_cellEdit=n.get("T_editWithNoFoucs_by_rowEditableState_objs.html");n.get("T_table_input_text.html");n.get("T_CellText.html");a.selected=a.selected||{};a.gridCERT=a.gridCERT||{};a.gridCERT.rowEditableState=[];a.gridCERT.Selections=[];a.gridCERT.notPrimaryCert=!0;t=function(){a.gridCERT.Selections=[];a.gridCERT.notPrimaryCert=!0;angular.forEach(a.model["certs-state"].cert,
function(b){b.checked&&a.gridCERT.Selections.push(b)});1===a.gridCERT.Selections.length&&(a.gridCERT.Selections[0]&&!0===a.gridCERT.Selections[0]["has-private-key"])&&(a.gridCERT.notPrimaryCert=!1)};a.gridCERT.Options=app.uiGrid.generateGridOptions({IDPreifx:"certificate",rowHeight:1.5*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t},{field:"gui_idx",displayName:a.DICT("Certificate_Index"),width:70},{field:"name",displayName:a.DICT("Certificate")},{field:"used-by",
displayName:a.DICT("Certificate_Used_By"),cellTemplate:n.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"MODEL_COL_FIELD.join(', ')")},{field:"type",displayName:a.DICT("Certificate_Type"),cellTemplate:n.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.certType[MODEL_COL_FIELD]")},{field:"signed-by",displayName:a.DICT("Certificate_Signed_By")},{field:"info.duration",displayName:a.DICT("Certificate_Duration"),width:230,cellTemplate:n.get("T_cert_duration.html")},{field:"detail",
displayName:a.DICT("Certificate_Details"),cellTemplate:"UG_table_icons.html",enableSorting:!1,width:80},{field:"actions",displayName:a.DICT("Certificate_Actions"),cellTemplate:"UG_table_icons.html",enableSorting:!1,width:80}]});var y=function(b){var c=w.defer();b=a.DICT("Certificate_Delete_Certificate",{"%d":b.length});app.TOOLS.criticalAlertBox({title:a.DICT("Certificate_Alert"),msg:b,btn_yes_str:a.DICT("Certificate_Yes"),btn_no_str:a.DICT("Certificate_No"),cbk:function(a){a?c.resolve():c.reject()}});
return c.promise};a.gridCERT.deleteCert=function(){var b=a.gridCERT.Selections,c=b.length-1;if(b&&b[0]){var d=function(b,g){var y=b[g],z=y.info||{},B=z.issuer||{},y={name:y.name,type:y.type};if(!z["is-ca-enabled"]&&(!B["common-name"]||"-"===B["common-name"]))y.isCsr=!0;a.ctx.RPC_delete(y,c===g)["finally"](function(a){b[g+1]?d(b,g+1):h()})};y(b).then(function(){d(b,0)})}};a.selectCertFile=function(b){a.pcFile=b};a.gridCERT.exportCert=function(b,c){a.open(["",c.entity,"exportCert"])};a.gridCERT.selectAsPrimaryCert=
function(){var b="",c=[];a.gridCERT.Selections[0]&&a.gridCERT.Selections[0].name&&(b=a.gridCERT.Selections[0].name);b&&(c.push({method:"set_restconf",params:{"ciscosb-restconf":{transport:{https:{cert:b}}}}}),c.push({method:"set_netconf",params:{"ciscosb-netconf":{transport:{ssh:{cert:b}}}}}),c.push({method:"set_firewall_basic_settings",params:{firewall:{"remote-web-management":{cert:b}}}}),p.post({forcedUsingPost:!0,method:"set_bulk",params:c,success:function(c){result=c&&c.data&&c.data.result||
{};0===result.code?app.TOOLS.successAlertBox({templateUrl:"set_cert_as_primary_success.html",cert:b,cbk:function(a){h()}}):app.TOOLS.criticalAlertBox({title:a.DICT("Certificate_Alert"),templateUrl:"set_cert_as_primary_failure.html",cert:b,cbk:function(a){h()}})},error:function(){app.TOOLS.criticalAlertBox({title:a.DICT("Certificate_Alert"),templateUrl:"set_cert_as_primary_failure.html",cert:b})}}))};a.gridCERT.detail=function(b,c){a.open(["lg",c.entity,"detail"])};a.isExportable=function(a){var b=
!1;a["allow-export"]&&(b=!0);return b};a.isImportCSR=function(a){var b=!1;"certification-sign-request"===a.type&&(b=!0);return b};a.isDeleteable=function(){for(var b=a.gridCERT.Selections,c=!1,g=0,d;g<b.length;g++)d=b[g],"Default"===d.name?c=!0:d["used-by"]&&0<d["used-by"].length&&(d=d["used-by"][0],""!==d&&"-"!==d&&(c=!0));return c};a.save=function(){};a.RPC_check_USB_attached=function(){var b=a.ctx.rpc_importCert;return u.RPC_generic_send("usb-check-attached",void 0,function(c,d,g){c=g.usbs||[];
b.usbDevList=[];for(d=0;d<c.length;d++)!0===c[d].attached&&b.usbDevList.push(c[d].name);1>b.usbDevList.length&&"usb"==a.ctx.importFrom&&(a.ctx.importFrom="pc")},void 0,{procBackground:!1,forcedUsingPost:a.forcedUsingPost})};a.openGenCert=function(){a.warningCheck()||(a.ctx.currPage="gen_cert.htm",a.modified())};a.updCertTypeState=function(){var b="";switch(a.ctx.rpc_genCert.type){case "local":b="SSC";break;case "ca-certification":b="CA";break;case "certification-sign-request":b="CSR";break;case "certification-signed-by-ca":b=
a.ctx.rpc_genCert.ext_csr?"CSByCA,EXT":"CSByCA,LOCAL"}a.ctx.gen_cert_state=b};a.isCertTypeState=function(b){a.ctx.gen_cert_state||a.updCertTypeState();return"CSByCA"===b?0<=a.ctx.gen_cert_state.search("^"+b):a.ctx.gen_cert_state===b};a.generateCertCsr=function(){a.updCertTypeState();var b=angular.copy(a.ctx.rpc_genCert),c=a.ctx.gen_cert_state,d=function(){return{request:{name:b.name,format:"pem","valid-duration":b["valid-duration"],info:{subject:{country:b.country,"state-province":b["state-province"],
locality:b.locality,organization:b.organization,"organization-unit":b["organization-unit"],"common-name":b["common-name"],email:b.email},"subject-alternative-name":b["subject-alternative-name"],"subject-alternative-type":b["subject-alternative-type"],"key-encryption-length":b["key-encryption-length"],"is-self-signed":"SSC"===c||"CA"===c,"is-ca-enabled":0<=c.search(/(^CA$|^CSByCA)/),"ca-file":b["ca-file"]}}}},g=function(){u.RPC_generic_send("generate-csr",{request:{name:b.name,format:"pem",info:{subject:{country:b.country,
"state-province":b["state-province"],locality:b.locality,organization:b.organization,"organization-unit":b["organization-unit"],"common-name":b["common-name"],email:b.email},"subject-alternative-name":b["subject-alternative-name"],"subject-alternative-type":b["subject-alternative-type"],"key-encryption-length":b["key-encryption-length"]}}},function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");h();a.ctx.currPage="main_cert.htm";break;default:Log(DEBUG,c+": RPC done. got unknown code: "+
b)}},void 0,k)},y=function(b){u.RPC_generic_send("generate-cert",b,function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");h();a.ctx.currPage="main_cert.htm";break;default:Log(DEBUG,c+": RPC done. got unknown code: "+b)}},void 0,k)},z=function(){var a=d();delete a.request.info;a.request.file={csr:{"csr-name":"EXT_CSR_001"},"ca-file":b["ca-file"]};y(a)};"CSByCA,EXT"===c?(Log(DEBUG,"Upload case"),z()):"CSR"===c?g():(g=d(),y(g))};a.ctx.RPC_delete=function(b,c){return u.RPC_generic_send("file-delete",
b.isCsr?{fileType:"csr",source:{csr:{"csr-name":b.name}}}:{fileType:"certificate",source:{"certificate-name":b.name}},function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");a.ctx.currPage="main_cert.htm";break;default:Log(DEBUG,c+": RPC done. got unknown code: "+b)}},void 0,{popRPCResonsepAlert:c})};a.ctx.RPC_export2WEB=function(b,c){var d;d=c.isCsr?{fileType:"csr",csr:{"csr-name":b}}:{fileType:"certificate","certificate-name":b,format:c.format};"pkcs12"==c.format&&
(d.password=c.password);return u.RPC_generic_send("file-download",d,function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");a.ctx.currPage="main_cert.htm";break;default:Log(DEBUG,c+": RPC done. got unknown code: "+b)}},void 0,k)};a.ctx.RPC_cert_export2USB=function(b){var c={fileType:"certificate",source:{"certificate-name":b.name,format:a.ctx.rpc_export.format},destination:{"location-url":"FILE://"+b.dest+"/"+b.filename}};"pkcs12"==c.source.format&&(c.source.password=
b.password);return u.RPC_generic_send("file-copy",c,function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");m(function(){a.cancel()},1E3);break;default:Log(DEBUG,c+": RPC done. got unknown code: "+b)}},void 0,k)};a.RPC_upload=function(b){var c;switch(a.ctx.rpc_importCert.type){case "pkcs12":c="pkcs12";break;default:c="pem"}return u.RPC_generic_send("file-copy",{fileType:"certificate",source:{"location-url":"FILE://"+b.source+"/"+b.fileparam},destination:{"certificate-name":b.name,
format:c,password:a.ctx.rpc_importCert.password}},function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");a.ctx.currPage="main_cert.htm";h();break;default:Log(DEBUG,c+": RPC done. got unknown code: "+b)}},void 0,k)};a.warningCheck=function(){var b=a.model["certs-state"].cert;return 100<=b.length?(a.msg=a.DICT("Certificate_Only_Allow_Maximum",{"%d0":100,"%d1":b.length}),app.TOOLS.criticalAlertBox({title:a.DICT("Certificate_Alert"),msg:a.msg,cbk:function(a){}}),!0):
!1};a.importCert=function(){a.warningCheck()||(a.ctx.certType="cert",a.ctx.currPage="import_cert.htm",a.RPC_check_USB_attached())};a.importCertCSR=function(b,c){a.ctx.certType="CSR";a.ctx.currPage="import_cert.htm";a.ctx.forceCert=c.entity};a.chunkSize=512;var z=function(b,c){var d=B(a.ctx.importFrom);d.fileparam="cert001";b.upload=x.upload({url:resource_base+"upload"+a.getReqParams(),resumeSizeUrl:c?resource_base+"upload?name22="+encodeURIComponent(b.name):null,resumeChunkSize:c?a.chunkSize:null,
headers:{"optional-header":"header-value"},data:{sessionid:"EU6DJKEIWO",pathparam:"Certificate",fileparam:"cert001",file:b}});b.upload.then(function(c){m(function(){b.result=c.data;Log(DEBUG,"do rpc Upload");a.RPC_upload(d)})},function(b){0<b.status&&(a.errorMsg=b.status+": "+b.data);Log(DEBUG,"do rpc Upload");a.RPC_upload(d);Log(ERROR,"do upload error")},function(a){b.progress=Math.min(100,parseInt(100*a.loaded/a.total,10))});b.upload.xhr(function(a){})},B=function(b){var c={},d=a.gridCERT.Selections;
"pc"===b?c.source="Certificate":"usb"===b&&(c.source=a.ctx.rpc_importCert.usb_dev,c.fileparam=a.ctx.rpc_importCert.file["full-file-name"]);c.name=a.ctx.rpc_importCert.name;d&&d[0]&&(c.type=d[0].type);return c};a.uploadCert=function(b){"pc"==a.ctx.importFrom?(a.formUpload=!0,b&&a.upload(b)):"usb"==a.ctx.importFrom&&(b=B(a.ctx.importFrom),a.RPC_upload(b))};a.upload=function(b){a.errorMsg=null;z(b,!1)};a.getReqParams=function(){return a.generateErrorOnServer?"?errorCode="+a.serverErrorCode+"&errorMessage="+
a.serverErrorMsg:""};var D=a.pic={showPreinstalledCerts:function(){var b=function(){return s.genProxy({ref_arr:a.model.pi_cert,data_typical_path_fn:c,data_cache_path_fn:function(a){return{"certs-state":{cert:a}}}})};a.model.pi_cert?D.openModal():w.all({pi_cert:b()}).then(function(b){b=s.getResult(b.pi_cert,"certs-state")||{};a.model.pi_cert=b.cert||[];D.prepareCertCtx(a.model.pi_cert);D.openModal()})},prepareCertCtx:function(a){angular.forEach(a,function(a,b){q.prepareCertCtx(a);a.checked=!1})},openModal:function(){a.open(["dynamic",
null,"show_preinstalled"])}};a.cancel=function(){h()};a.open=function(c){var d,g,y=c[2];"exportCert"==y?(d="modal_export_cert.htm",g="exportCert_ModalInstanceCtrl"):"detail"==y?(d="modal_cert_detail.htm",g="certDetail_ModalInstanceCtrl"):"show_preinstalled"==y&&(d="modal_cert_preinstalled.htm",g="certPreinstalled_ModalInstanceCtrl");b.open({templateUrl:d,controller:g,size:c[0],backdrop:"static",resolve:{model:function(){return a.model},ctx:function(){return a.ctx},cert:function(){return c[1]}}}).result.then(function(a){},
function(){Log(DEBUG,"Modal dismissed at: "+new Date)})};h()}]);
app.controller("certPreinstalled_ModalInstanceCtrl",["$scope","$uibModalInstance","$templateCache","model","$uibModal","certService",function(a,b,t,m,w,u){a.model=m||{};a.schema={};a.schema.certType=u.genCertType();a.gridPIC={};a.gridPIC.Selections=[];a.gridPIC.Options=app.uiGrid.generateGridOptions({IDPreifx:"pi_certificate",rowHeight:1.5*app.uiGrid.rowHeight,columnDefs:[{field:"gui_idx",displayName:a.DICT("Certificate_Index"),width:70},{field:"name",displayName:a.DICT("Certificate")},{field:"used-by",
displayName:a.DICT("Certificate_Used_By"),cellTemplate:t.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"MODEL_COL_FIELD.join(', ')")},{field:"type",displayName:a.DICT("Certificate_Type"),cellTemplate:t.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.certType[MODEL_COL_FIELD]")},{field:"signed-by",displayName:a.DICT("Certificate_Signed_By")},{field:"info.duration",displayName:a.DICT("Certificate_Duration"),width:230,cellTemplate:t.get("T_cert_duration.html")},{field:"detail",
displayName:a.DICT("Certificate_Details"),cellTemplate:"UG_table_icons.html",enableSorting:!1,width:80}]});a.gridPIC.detail=function(b,q){a.open(["lg",q.entity,"detail"])};a.open=function(b){var q,e;"detail"==b[2]&&(q="modal_cert_detail.htm",e="certDetail_ModalInstanceCtrl");w.open({templateUrl:q,controller:e,size:b[0],backdrop:"static",resolve:{model:function(){return a.model},ctx:function(){return a.ctx},cert:function(){return b[1]}}}).result.then(function(a){},function(){Log(DEBUG,"Modal dismissed at: "+
new Date)})};a.cancel=function(){b.dismiss("cancel")};angular.forEach(a.model.pi_cert,function(b,q){b.gui_idx=q+1;b.detail=[{cbk:a.gridPIC.detail,displayName:a.DICT("Certificate_Detail"),className:"icon-detail"}]});a.gridPIC.Options.data=a.model.pi_cert}]);
app.controller("certDetail_ModalInstanceCtrl",["$scope","$uibModalInstance","model","cert","certService",function(a,b,t,m,w){a.selected=a.selected||{};a.cert=m||{};a.cert.subject_str=w.combind_DN(m.info.subject);a.cert.issuer_str=w.combind_DN(m.info.issuer);a.combind_DN=w.combind_DN;a.cancel=function(){b.dismiss("cancel")}}]);
app.controller("exportCert_ModalInstanceCtrl",["$scope","$window","$timeout","$uibModalInstance","model","ctx","cert","rpcFns",function(a,b,t,m,w,u,p,q){a.selected=a.selected||{};a.cert=p||{};a.ctx=u;a.ctx.usbDev=a.ctx.usbDev||{};a.forcedUsingPost=!1;var e={procBackground:!1,forcedUsingPost:a.forcedUsingPost};angular.extend(a.ctx.rpc_export,{password:"",password_confirm:"",dest:"pc",rpc_msg_text:void 0});p.type&&("certification-sign-request"==p.type?(a.ctx.rpc_export.format="pem",a.ctx.rpc_export.pkcs12_support=
!1):a.ctx.rpc_export.pkcs12_support=!0);a.download=function(){var b={},e;a.ctx.rpc_export.rpc_msg_text=void 0;var l=function(b){Log(DEBUG,"download invoked");var e=a.ctx.RPC_export2WEB(p.name,b),k=p.name+b.ext;e.then(function(b){var c=b.data.result,h=c.output;h||(h=c);a.ctx.rpc_export.url=h&&h["download-url"]?h["download-url"]:location.protocol+"//"+location.host+"/download/certificate/"+k;app.TOOLS.download_binary(a.ctx.rpc_export.url);a.ctx.rpc_export.rpc_msg_text="OK"==b.statusText?"Success":b.statusText;
a.ctx.rpc_export.rpc_msg_type="OK"==b.statusText?"success":"fail";"OK"==b.statusText&&t(function(){a.cancel()},2E3)})},r=function(b){b.filename=p.name+b.ext;a.ctx.RPC_cert_export2USB(b)};if(p.name){e=p.info&&p.info.issuer||{};b.ext="pkcs12"==a.ctx.rpc_export.format?".p12":".pem";b.type=p.type;b.name=p.name;b.isCsr=!1;b.dest=a.ctx.rpc_export.dest||"pc";b.format=a.ctx.rpc_export.format;b.password=a.ctx.rpc_export.password;if(!e["common-name"]||"-"===e["common-name"])b.isCsr=!0;"pc"==b.dest?l(b):r(b);
a.ctx.export_btn_cancel="Close"}};a.downloadable=function(){var b=a.ctx.rpc_export.format,e="pkcs12"==b&&a.form.$valid;return!("pem"==b||e)};a.RPC_check_USB_attached=function(){var b=a.ctx.usbDev;b.stateReady=!1;var n=a.ctx.rpc_export;return q.RPC_generic_send("usb-check-attached",void 0,function(a,e,v){a=v.usbs||[];e=!1;b.usbDevList=[];for(v=0;v<a.length;v++)!0===a[v].attached&&a[v]["usbs-type"].match(/mass-storage/)&&(n.dest==a[v].name&&(e=!0),b.usbDevList.push(a[v].name));e||(n.dest="pc");b.stateReady=
!0},void 0,e)};a.cancel=function(){m.dismiss("cancel")}}]);(function(a,b){var t=angular.module("errorModule",[]);t.directive("validationErrors",function(a){return{restrict:"A",scope:{errors:"=",errorClass:"@",validationErrors:"@"},template:'<div ng-class="buildErrorClass()" ng-repeat="(errorKey, isError) in errors track by $index" ng-show="isError">{{errorFor(errorKey)}}</div>',controller:function(b,u,p){var q=a.getError();b.validationErrors&&angular.extend(q,b.$eval(b.validationErrors));b.errorFor=function(a){return q[a]};b.buildErrorClass=function(){return this.errorClass||
'inline-help text-error"'}}}});t.provider("errorMessages",function(){this.errorMessages={};this.$get=function(){var a=this.errorMessages;return{getError:function(){return a}}};this.setErrorMessages=function(a){this.errorMessages=a}})})(window,jQuery);app.controller("sessionTimeoutCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,t,m){a.success=!1;a.dataReady=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var w=function(){b.post({url:resource_base+"data/firewall_session_timeout.json",method:"get_session_timeout",success:function(b){b=b.data.result;var p=b["session-timeout-entry"]||{};a.model.sessions={tcp_session_timeout:p["tcp-session-timeout"]||"",udp_session_timeout:p["udp-session-timeout"]||
"",icmp_session_timeout:p["icmp-session-timeout"]||"",current_connections:(b["sessions-state"]||{})["current-connections"]||"",max_concurrent_connections:p["max-concurrent-connections"]||""};a.dataReady=!0},error:function(b){console.log("sessionTimeoutCtrl Error get data status: "+b.status);a.dataReady=!0}})};a.model={sessions:{}};a.funs={save:function(){var m=a.model.sessions;b.post({method:"set_session_timeout",params:{"session-timeout-entry":{"tcp-session-timeout":m.tcp_session_timeout,"udp-session-timeout":m.udp_session_timeout,
"icmp-session-timeout":m.icmp_session_timeout,"current-connections":m.current_connections,"max-concurrent-connections":m.max_concurrent_connections}},success:function(b){a.success=!0;w();a.resetModified()},error:function(a){}})},cancel:function(){w();a.resetModified()},clear:function(){b.post({method:"action",params:{rpc:"clear-connections"},success:function(b){w();a.resetModified()},error:function(a){}})}};w()}]);app.controller("policyNatCtrl",["$scope","MyHttp","wan_service","$q","UserSession","userAccessRight",function(a,b,t,m,w,u){var p="";a.success=!1;a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var q=function(){return b.post({url:resource_base+"data/services.json",method:"get_services",error:function(a){Log(ERROR,"policyNatCtrl getServices error: "+a.status)}})},e=function(){return b.post({url:resource_base+"data/firewall_policy_nat.json",method:"get_policy_nat",
error:function(a){Log(ERROR,"policyNatCtrl getData error: "+JSON.stringify(a))}})},x=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",error:function(a){Log(ERROR,"policyNatCtrl getInterface error: "+a.status)}})},n=function(){var b={};a.model.display=[];angular.forEach(a.model.nat,function(c){b={checked:!1,name:c.name,enabled:c.enabled?a.DICT("Policy_Nat_Enabled"):a.DICT("Policy_Nat_Disabled"),interface_from:c.interface_from,interface_to:c.interface_to,src_enabled:c.src.enabled,
osa:c.src["original-ip"],ota:c.src["interface"]?c.src["interface"]:c.src.ipgroup,dst_enabled:c.dst.enabled,dsa:c.dst["original-ip"],dta:c.dst["interface"]?c.dst["interface"]:c.dst.ipgroup,sve_enabled:c.service.enabled,original_service:c.service.original_service,translated_service:c.service.translated_service};a.model.display.push(b)})},l=function(b){a.model.nat=[];b["policy-nat-rules"]&&(angular.forEach((b["policy-nat-rules"]||{})["policy-nat-rule"]||[],function(b){a.model.nat.push(b)}),a.model.nat_ori=
angular.copy(a.model.nat),n())},r=function(b){a.model.services=[];var c=[];b.services&&b.services.service&&(c=b.services.service);angular.forEach(c,function(b,c){a.model.services.push({id:b.name,displayName:b.name})})},v=function(b){a.model.ifs=[];var c=[],d=[],g,h,k,e={},l=t.filter(b.interfaces["interface"],{usb:!0,physical:!0,dmz:!0,ipv6transition:!0,subinterface:!0});angular.forEach(b.interfaces["interface"],function(a){if(g=a.name.match(/^(WAN\d+)-(BRIDGE)($|.\d+$)/))e[g[1]+g[3]]=!0,a.ipv4&&(a.ipv4.setting&&
a.ipv4.setting["trasparent-bridge"])&&(h=a.ipv4.setting["trasparent-bridge"],k=h.ifnames&&h.ifnames[0]&&h.ifnames[0].split(" ")||[],angular.forEach(k,function(a){e[a]=!0}))});angular.forEach(l,function(a,b){!e[a.name]&&!(a.name.match(/^USB\d+$/)&&!1===a.enabled||a.name.match(/^DMZ$/)&&!1===a.enabled||a.name.match(/^TUN\d+$/)&&!1===a.enabled)&&c.push({id:a.name,displayName:a.name})});angular.forEach(b.interfaces["interface"],function(a,b){a.name.match(/^VLAN/)&&!e[a.name]&&d.push({id:a.name,displayName:a.name})});
a.model.scheme.addrListTra=c.concat(d);d.push({id:"any",displayName:a.DICT("Policy_Nat_Any")});a.model.ifs=c.concat(d)},s=function(){a.model.scheme={addrListOri:[{id:"any",displayName:a.DICT("Policy_Nat_Any")}],addrListTra:[]}},k=function(){return b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup",error:function(a){console.log("ipGroupCtrl getIPGroupData error "+a.status)}})},d=function(b){b||(b={});a.model.ipgroups=[];b["ip-groups"]&&b["ip-groups"]["ip-group"]&&(a.model.ipgroups=
b["ip-groups"]["ip-group"]);angular.forEach(a.model.ipgroups,function(b){a.model.scheme.addrListOri.push({id:b.name,displayName:b.name});a.model.scheme.addrListTra.push({id:b.name,displayName:b.name})})},c={main:"policy_nat.html",edit:"edit_policy_nat.html"},h=function(){m.all([q(),x(),e(),k()]).then(function(b){r(b[0].data.result||{});v(b[1].data.result||{});l(b[2].data.result||{});d(b[3].data.result||{});a.dataReady=!0});a.model.nat_select=[];a.model.nat_del=[];a.currPage=c.main};a.dataReady=!1;
a.currPage=c.main;a.model={ifs:[],services:[],nat:[],nat_select:[],nat_ori:[],nat_del:[],ipgroups:[],edit:{},scheme:{}};a.gridPolicyNat={IDPreifx:"policy_nat_table",data:"model.display",enableColumnResize:!0,multiSelect:!0,enableRowSelection:!1,enableSorting:!1,keepLastSelected:!1,selectWithCheckboxOnly:!0,plugins:[new app.ngGrid.ngGridFlexibleHeightPlugin],columnDefs:[{field:"checked",displayName:"",width:25,changed:function(){return function(b){a.model.nat_select=[];angular.forEach(a.model.display,
function(b,c){b.checked&&a.model.nat_select.push(b)})}}(),cellTemplate:"ngCheckboxTemplate.html",headerCellTemplate:"ngHeaderCheckboxTemplate.html",data:"model.display"},{field:"name",displayName:a.DICT("Policy_Nat_Name")},{field:"enabled",displayName:a.DICT("Policy_Nat_Status")},{field:"interface_from",displayName:a.DICT("Policy_Nat_From")},{field:"interface_to",displayName:a.DICT("Policy_Nat_To")},{field:"osa",displayName:a.DICT("Policy_Nat_Original_Source_Addr")},{field:"ota",displayName:a.DICT("Policy_Nat_Original_Destination_Addr")},
{field:"original_service",displayName:a.DICT("Policy_Nat_Original_Service")},{field:"dsa",displayName:a.DICT("Policy_Nat_Translated_Source_Addr")},{field:"dta",displayName:a.DICT("Policy_Nat_Translated_Destination_Addr")},{field:"translated_service",displayName:a.DICT("Policy_Nat_Translated_Service")}]};var g=function(b){b=a.model.nat.length;return 200<=b?(a.msg=a.DICT("Policy_Nat_Max_Entries",{"%d":b}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.funs={save:function(c){var d=
{},g=function(){b.post({method:"set_policy_nat",params:{"policy-nat-rules":{"policy-nat-rule":a.model.nat}},success:function(b){a.success=!0;s();h();a.resetModified()},error:function(b){s();h();a.resetModified()}})};if("main"!==c&&"edit"===c)if("add"===p)d={name:a.model.edit.name,enabled:a.model.edit.enabled,interface_from:a.model.edit.interface_from,interface_to:a.model.edit.interface_to,src:{enabled:a.model.edit.src_enabled,"original-ip":a.model.edit.osa,"interface":"any"},dst:{enabled:a.model.edit.dst_enabled,
"original-ip":a.model.edit.dsa,"interface":"any"},service:{enabled:a.model.edit.sve_enabled,original_service:a.model.edit.original_service,translated_service:a.model.edit.translated_service}},a.model.nat.push(d);else if("edit"===p){c="";for(var B=0;B<a.model.nat.length;B++)if(a.model.edit.name===a.model.nat[B].name){for(var d={name:a.model.edit.name,enabled:a.model.edit.enabled,interface_from:a.model.edit.interface_from,interface_to:a.model.edit.interface_to,src:{enabled:a.model.edit.src_enabled,
"original-ip":a.model.edit.osa},dst:{enabled:a.model.edit.dst_enabled,"original-ip":a.model.edit.dsa},service:{enabled:a.model.edit.sve_enabled,original_service:a.model.edit.original_service,translated_service:a.model.edit.translated_service}},k=0;k<a.model.ipgroups.length;k++)if(a.model.edit.ota===a.model.ipgroups[k].name){c="ipgroup";break}""===c?d.src["interface"]=a.model.edit.ota:"ipgroup"===c&&(d.src.ipgroup=a.model.edit.ota);c="";for(k=0;B<a.model.ipgroups.length;k++)if(a.model.edit.dta===a.model.ipgroups[k].name){c=
"ipgroup";break}""===c?d.dst["interface"]=a.model.edit.dta:"ipgroup"===c&&(d.dst.ipgroup=a.model.edit.dta);a.model.nat[B]=angular.copy(d);break}}0<a.model.nat_del.length?b.post({method:"del_policy_nat",params:{"policy-nat-rules":{"policy-nat-rule":a.model.nat_del}},success:function(a){g()},error:function(a){g()}}):g()},add:function(){g()||(p="add",a.model.edit={checked:!1,name:"",enabled:!1,interface_from:"any",interface_to:"any",src_enabled:!1,osa:"any",ota:"WAN1",dst_enabled:!1,dsa:"any",dta:"WAN1",
sve_enabled:!1,original_service:"All Traffic",translated_service:"All Traffic"},a.currPage=c.edit,a.modified())},edit:function(b){if(1===a.model.nat_select.length){p="edit";for(b=0;b<a.model.nat.length;b++)if(a.model.nat[b].name===a.model.nat_select[0].name){a.model.edit={checked:a.model.nat[b].checked,name:a.model.nat[b].name,enabled:a.model.nat[b].enabled,interface_from:a.model.nat[b].interface_from,interface_to:a.model.nat[b].interface_to,src_enabled:a.model.nat[b].src.enabled,osa:a.model.nat[b].src["original-ip"],
ota:a.model.nat[b].src["interface"]?a.model.nat[b].src["interface"]:a.model.nat[b].src.ipgroup,dst_enabled:a.model.nat[b].dst.enabled,dsa:a.model.nat[b].dst["original-ip"],dta:a.model.nat[b].dst["interface"]?a.model.nat[b].dst["interface"]:a.model.nat[b].dst.ipgroup,sve_enabled:a.model.nat[b].service.enabled,original_service:a.model.nat[b].service.original_service,translated_service:a.model.nat[b].service.translated_service};break}a.currPage=c.edit}},del:function(){for(var b=0,c=0,b=a.model.nat.length-
1;0<=b;b--)for(c=0;c<a.model.nat_select.length;c++)if(a.model.nat[b].name===a.model.nat_select[c].name){a.model.nat_del.push({name:a.model.nat[b].name});a.model.nat.splice(b,1);break}n();a.modified()},cancel:function(){a.currPage=c.main;s();h();a.resetModified()},enable:function(){for(var b=0;b<a.model.nat_select.length;b++){a.model.nat_select[b].enabled=!0;for(var c=0;c<a.model.nat.length;c++)if(a.model.nat_select[b].name===a.model.nat[c].name){a.model.nat[c].enabled=!0;break}for(c=0;c<a.model.nat.length;c++)if(a.model.nat_select[b].name===
a.model.display[c].name){a.model.display[c].enabled=!0;break}}},disable:function(){for(var b=0;b<a.model.nat_select.length;b++){a.model.nat_select[b].enabled=!1;for(var c=0;c<a.model.nat.length;c++)if(a.model.nat_select[b].name===a.model.nat[c].name){a.model.nat[c].enabled=!1;break}for(c=0;c<a.model.nat.length;c++)if(a.model.nat_select[b].name===a.model.display[c].name){a.model.display[c].enabled=!1;break}}}};s();h()}]);app.controller("port_triggering_main",["$scope","$q","$location","MyHttp","$filter","GridRowBasedEditingAdv","$templateCache","Sets","wan_service","UserSession","userAccessRight",function(a,b,t,m,w,u,p,q,e,x,n){a.model=a.model||{};a.success=!1;a.dataReady=!1;a.services=[];a.interfaces=[];a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&x.logout();var l=function(){var e=m.post({url:resource_base+"data/port_triggering.json",method:"get_port_triggering",error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}}),k=m.post({url:resource_base+"data/service_management.json",method:"get_services",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,k]).then(function(b){a.model={};angular.extend(a.model,b[0].data.result);angular.extend(a.model,b[1].data.result);r();a.schema=a.schema||{};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};a.model_orig=angular.copy(a.model);a.services=[];a.interfaces=[];angular.forEach(a.model.interfaces["interface"],
function(b){a.interfaces.push({id:b.name,displayName:b.name})});angular.forEach(a.getTCPUDPService(),function(b){a.services.push({id:b.name,displayName:b.name})});angular.forEach(a.model["port-triggering-rules"]["port-triggering-entry"],function(b){b.trigger_service={select:b["trigger-service"],list:a.services};b.incoming_service={select:b["incoming-service"],list:a.services};b.interface_t={select:b["interface"],list:a.interfaces}});a.gridPortTrig.Selections=[];a.gridPortTrig.Options.data=a.model["port-triggering-rules"]["port-triggering-entry"];
a.dataReady=!0})};l();var r=function(){a.model["port-triggering-rules"]||angular.extend(a.model,{"port-triggering-rules":{"port-triggering-entry":[]}});a.triggering_sample={checked:!1,invalid:!1,edit:!1};angular.forEach(a.model["port-triggering-rules"]["port-triggering-entry"],function(b){q.recover_object(b,a.triggering_sample)});a.filterWAN_WANsub={physical:!0,subinterface:!0,usb:!0};a.model.interfaces["interface"]=e.filter(a.model.interfaces["interface"],a.filterWAN_WANsub)},v=function(a,b,d){return a.protocol.match(/^(TCP|UDP|TCP_UDP|ALL)$/)?
!0:!1};a.getTCPUDPService=function(){return w("filter")(a.model.services.service,v)};a.jumpToServcieManagement=function(a){app.TOOLS.jumpToPage("System_Config_Service_Management")};a.T_cellEdit=p.get("T_editWithNoFoucs_by_rowEditableState_objs.html");a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridPortTrig=a.gridPortTrig||{};a.gridPortTrig.totalServerItems=0;a.gridPortTrig.Selections=[];a.gridPortTrig.procNgClick=function(b){a.gridPortTrig.Selections=[];angular.forEach(a.model["port-triggering-rules"]["port-triggering-entry"],
function(b,d){b.checked?a.gridPortTrig.Selections.push(b):b.edit=!1})};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridCheckName=function(){var b=a.gridPortTrig.Options.data,k=b.length,d,c;angular.forEach(b,function(a){a.invalid=!1});for(d=0;d<k;d++)for(c=d+1;c<k;c++)b[d].name===b[c].name&&(b[d].invalid=!0,b[c].invalid=!0)};a.gridPortTrig.Options=app.uiGrid.generateGridOptions({IDPreifx:"porttriggering_table",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridPortTrig.procNgClick,
disableChkBoxField:"disableChk",headerChangedCbk:a.gridPortTrig.procNgClick},{field:"status",displayName:a.DICT("Port_Triggering_Enable"),width:70,editRow:"edit",cellTemplate:p.get("UG_table_checkbox_with_inline_edit.html")},{field:"name",displayName:a.DICT("Port_Triggering_Application_Name"),validationCbk:"gridInvalidCbk",editRow:"edit",customVldCbk:"gridCheckName",invalidField:"invalid",cellTemplate:p.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"required legal-char maxlength='63' "),
id:"porttriggering_table_name"},{field:"trigger_service",displayName:a.DICT("Port_Triggering_Trigger_Service"),editRow:"edit",cellTemplate:p.get("UG_table_text_with_inline_select_edit.html"),id:"porttriggering_table_service"},{field:"incoming_service",displayName:a.DICT("Port_Triggering_Incoming_Service"),editRow:"edit",cellTemplate:p.get("UG_table_text_with_inline_select_edit.html"),id:"porttriggering_table_incoming"},{field:"interface_t",displayName:a.DICT("Port_Triggering_Interfaces"),editRow:"edit",
cellTemplate:p.get("UG_table_text_with_inline_select_edit.html"),id:"porttriggering_table_interface"}]});a.ifNamed=function(a){return function(b,d,c){return b.name.match(a)?!0:!1}};a.add=function(){100<=a.gridPortTrig.Options.data.length?(a.msg=a.DICT("Port_Triggering_Reach_Max_Entry",{"%d":100}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}})):(a.gridPortTrig.Options.data.push({checked:!0,invalid:!0,edit:!0,name:"","trigger-service":"All Traffic","incoming-service":"FTP","interface":"WAN1",
status:!0,trigger_service:{select:"All Traffic",list:a.services},incoming_service:{select:"FTP",list:a.services},interface_t:{select:"WAN1",list:a.interfaces}}),a.gridPortTrig.Options.gridApi.customApi.scrollTo(a.gridPortTrig.Options.data.length-1,1),a.gridCheckName(),a.modified())};a.del=function(){var b,e;void 0===a.model["port-triggering-rules"]||void 0===a.model["port-triggering-rules"]["port-triggering-entry"]?(b=[],e=0):(b=a.model["port-triggering-rules"]["port-triggering-entry"],e=b.length);
for(e-=1;0<=e;e--)b[e].checked&&b.splice(e,1);a.modified()};a.edit=function(){angular.forEach(a.gridPortTrig.Options.data,function(a){a.checked&&(a.edit=!0)})};a.save=function(){var b=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.invalid)&&delete a.invalid;angular.isDefined(a.disableChk)&&delete a.disableChk;angular.isDefined(a.edit)&&delete a.edit;angular.isDefined(a.interface_t)&&(a["interface"]=a.interface_t.select,
delete a.interface_t);angular.isDefined(a.trigger_service)&&(a["trigger-service"]=a.trigger_service.select,delete a.trigger_service);angular.isDefined(a.incoming_service)&&(a["incoming-service"]=a.incoming_service.select,delete a.incoming_service)});return a}(a.model["port-triggering-rules"]["port-triggering-entry"]),e=function(){m.post({url:resource_base+"data/port_triggering.json",method:"set_port_triggering",params:{"port-triggering-rules":{"port-triggering-entry":b}},success:function(b){a.success=
!0;l();a.config_saved=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);l()}})};(function(){var b=a.model["port-triggering-rules"]["port-triggering-entry"],c=[],h;angular.forEach(a.model_orig["port-triggering-rules"]["port-triggering-entry"],function(a){h=!1;angular.forEach(b,function(b){a.name===b.name&&(h=!0)});h||c.push({name:a.name})});c.length?m.post({url:resource_base+"data/port_triggering.json",method:"del_port_triggering",params:{"port-triggering-rules":{"port-triggering-entry":c}},
success:function(a){e()},error:function(a){e();console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}):e()})();a.resetModified()};a.cancel=function(){l();a.resetModified()}}]);app.controller("dmzHostCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,t,m){a.success=!1;a.dataReady=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var w=function(){b.post({url:resource_base+"data/firewall_dmz_host.json",method:"get_dmz_host",success:function(b){b=b.data.result["dmz-host-entry"]||{};a.model={enable:b.enable||!1,dmz_host_ip_address:b["dmz-host-ip-address"]||""};a.dataReady=!0},error:function(b){console.log("dmzHostCtrl getData error, status: "+
b.status);a.dataReady=!0}})};a.model={enable:"false",dmz_host_ip_address:""};a.funs={save:function(){var m={"dmz-host-entry":{enable:a.model.enable}};a.model.enable&&(m["dmz-host-entry"]["dmz-host-ip-address"]=a.model.dmz_host_ip_address);b.post({method:"set_dmz_host",forcedUsingPost:!0,params:m,success:function(b){a.success=!0;w();a.resetModified()},error:function(a){}})},cancel:function(){w();a.resetModified()}};w()}]);app.controller("static_nat_main",["$scope","$rootScope","$q","$location","MyHttp","$filter","GridRowBasedEditingAdv","$templateCache","wan_service","UserSession","userAccessRight","addressPoolValidate","Sets",function(a,b,t,m,w,u,p,q,e,x,n,l,r){a.model=a.model||{};a.ctx=a.ctx||{};a.success=!1;a.dataReady=!1;a.servicesList=[];a.interfaceList=[];a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&x.logout();var v=function(){var b=w.post({url:resource_base+"data/static_nat.json",
method:"get_static_nat",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),B=w.post({url:resource_base+"data/service_management.json",method:"get_services",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),y=w.post({url:resource_base+"data/get_subnet.json",method:"get_subnet",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});t.all([b,B,y,function(){return w.post({url:resource_base+"data/system_summary.json",
method:"get_interface_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})}()]).then(function(b){a.model={};var z=[],B=[];d(b[0]);d(b[1]);c(b[2]);a.servicesList=[];a.interfaceList=[];angular.forEach(a.model.services.service,function(b){a.servicesList.push({id:b.name,displayName:b.name})});angular.forEach(a.model.interfaces["interface"],function(a){a.name.match(/^WAN\d+($|\.\d+$)/)&&z.push({id:a.name,displayName:a.name});a.name.match(/^USB\d+$/)&&B.push({id:a.name,
displayName:a.name})});a.interfaceList=z.concat(B);h();a.schema=a.schema||{};a.schema.StatusMap={"true":a.DICT("Static_NAT_Enabled"),"false":a.DICT("Static_NAT_Disabled")};g(b[3]);a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.gridSNAT.operations||(a.gridSNAT.operations=p);a.gridSNAT.operations.init({rowState:a.selected.rowEditableState,tbl_ref:a.gridSNAT._tbl_ref,tbl_orig:a.gridSNAT._tbl_orig,del_ref:a.gridSNAT._del_ref,gridopt_ref:a.gridSNAT.Options,Selections:a.gridSNAT.Selections});
a.gridSNAT.operations.resetState();a.gridSNAT.Options.data=a.model["static-nat-rules"]["static-nat-entry"];a.gridSNAT.Options.gridApi&&setTimeout(function(){a.gridSNAT.Options.gridApi.customApi.checkSelectStatus()},50);a.dataReady=!0})},s={},k=function(a,b,c){for(var d in a)if(0<=d.indexOf(":")){var g=d.split(":");a=g[1];g=g[0];b[a]=g;c&&c(a,g,d)}},d=function(b){var c=b.data.result;k(c,s,function(a,b,d){c[a]=c[d];c[d]=void 0});angular.extend(a.model,c)},c=function(b){b.data&&(b.data.result&&b.data.result.subnets&&
b.data.result.subnets.ipv4&&b.data.result.subnets.ipv6)&&(a.subnetObj=angular.copy(b.data.result.subnets))},h=function(){a.model["static-nat-rules"]||angular.extend(a.model,{"static-nat-rules":{"static-nat-entry":[]}});a.sample={checked:!1,edit:!1};angular.forEach(a.model["static-nat-rules"]["static-nat-entry"],function(b){r.recover_object(b,a.sample);b.service_t={select:b.service,list:angular.copy(a.servicesList)};b.interface_t={select:b["interface"],list:angular.copy(a.interfaceList)}});a.filterWAN_WANsub=
{physical:!0,subinterface:!0,usb:!0};a.model.interfaces["interface"]=e.filter(a.model.interfaces["interface"],a.filterWAN_WANsub)},g=function(b){a.ctx=a.ctx||{};a.ctx.wanip_inuse=[];b&&(b.data&&b.data.result&&b.data.result["interfaces-state"]&&b.data.result["interfaces-state"]["interface"])&&(a.model["interfaces-state"]=b.data.result["interfaces-state"],angular.forEach(a.model["interfaces-state"]["interface"],function(b,c){b.name&&(b.name.match(/^WAN/)&&b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&
b.ipv4.address[0].ip)&&a.ctx.wanip_inuse.push({name:b.name,ip:b.ipv4.address[0].ip})}))};a.getTCPUDPService=function(){return a.model.services.service};a.jumpToServcieManagement=function(){app.TOOLS.jumpToPage("System_Config_Service_Management")};a.T_cellEdit=q.get("T_editWithNoFoucs_by_rowEditableState_objs.html");a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridSNAT=a.gridSNAT||{};a.gridSNAT.totalServerItems=0;a.gridSNAT.Selections=[];a.gridInvalidCbk=function(a){a.row.entity.disableChk=
a.rowInvalid};a.gridSNAT.Options=app.uiGrid.generateGridOptions({IDPreifx:"staticnat_table",plugins:[new app.ngGrid.ngGridFlexibleHeightPlugin],columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:function(b){a.gridSNAT.Selections=[];angular.forEach(a.model["static-nat-rules"]["static-nat-entry"],function(b,c){b.checked?a.gridSNAT.Selections.push(b):b.edit=!1})},disableChkBoxField:"disableChk"},{field:"status",displayName:a.DICT("Static_NAT_Enable"),width:70,editRow:"edit",cellTemplate:"UG_table_checkbox_with_inline_edit.html",
id:"staticnat_table_status"},{field:"private-ip",displayName:a.DICT("Static_NAT_Private_IP_Range_Begin"),validationCbk:"gridInvalidCbk",width:183,cellTemplate:q.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv4-ip custom-vld custom-vld-cbk="grid.appScope.gridSNAT.keyValidCbk"'),customVldGroup:"KEY",editRow:"edit",id:"staticnat_table_privateip",required:!0},{field:"public-ip",displayName:a.DICT("Static_NAT_Public_IP_Range_Begin"),validationCbk:"gridInvalidCbk",width:178,
cellTemplate:q.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv4-ip custom-vld custom-vld-cbk="grid.appScope.gridSNAT.keyValidCbk"'),customVldGroup:"KEY",editRow:"edit",id:"staticnat_table_publicip",required:!0},{field:"range-length",displayName:a.DICT("Static_NAT_Range_Length"),validationCbk:"gridInvalidCbk",width:127,cellTemplate:q.get("UG_table_text_with_inline_number_edit.html").replace(/data-ng-expansion/,'custom-vld custom-vld-cbk="grid.appScope.gridSNAT.keyValidCbk"'),
customVldGroup:"KEY",editRow:"edit",id:"staticnat_table_range",required:!0,min:1,max:50},{field:"service_t",displayName:a.DICT("Static_NAT_Services"),cellTemplate:q.get("UG_table_text_with_inline_select_edit.html").replace(/data-ng-expansion/,'custom-vld custom-vld-cbk="grid.appScope.gridSNAT.keyValidCbk"'),customVldGroup:"KEY",editRow:"edit",id:"staticnat_table_service"},{field:"interface_t",displayName:a.DICT("Static_NAT_Interfaces"),width:135,cellTemplate:q.get("UG_table_text_with_inline_select_edit.html").replace(/data-ng-expansion/,
'custom-vld custom-vld-cbk="grid.appScope.gridSNAT.keyValidCbk"'),customVldGroup:"KEY",editRow:"edit",id:"staticnat_table_interface"}]});a.gridSNAT.selRow=function(b,c){if("array"===$.type(b))for(var d=0;d<b.length;d++)a.gridSNAT.operations.selRow(b[d],c);else a.gridSNAT.operations.selRow(b,c)};var A=[],y={};a.gridSNAT.keyValidCbk=function(b){if(!b)return!0;var c=!0,d=[],g=[],h=a.model["static-nat-rules"]["static-nat-entry"],e=h.length,k,n,s=!0,v=!0,r,x,J={msg:"",overlapPubIp:!1,pubIpInuse:[]};"delete_row"===
b.type&&(s=!1);var q=function(a,b){var c=a.split("."),d=32-b,c=(c[0]<<24|c[1]<<16|c[2]<<8|c[3])>>>0>>d<<d>>>0;return{beg:c,end:(c|(1<<d)-1)>>>0}},p=function(a,b,c){return a.name.match(/^VLAN/)?!0:!1},m=function(a){var b=!1,c=!1,d=!1,g=a.itemIP,h=a.itemRange||1,y=a.userIP,B=a.userRange||1,z=q(g,32);a=z.beg;var h=z.beg-1+parseInt(h,10),e=q(y,32),z=e.beg,B=e.beg-1+parseInt(B,10);g==y&&(c=!0);z<=a&&B>=h?d=!0:z<=a&&B>=a?d=!0:z<=h&&B>=h?d=!0:z>=a&&B<=h&&(d=!0);d&&(b=!0);return{invalid:b,exactmatch:c}},
w=function(b){var c=!1,d="";b&&b["public-ip"]&&(angular.forEach(a.ctx.wanip_inuse,function(g,h){var y=m({itemIP:g.ip,itemRange:1,userIP:b["public-ip"],userRange:b["range-length"]});y.invalid&&(c=!0,y&&!y.exactmatch&&(d+=a.DICT("Static_NAT_Public_IP_Range_Overlaps_WAN_IP")),d+=a.DICT("Static_NAT_WAN_IP_Of",{"%s0":g.ip,"%s1":g.name}))}),0<d.length&&app.TOOLS.criticalAlertBox({msg:d,cbk:function(a){}}));return c},t=function(b,z,s){if(!(0>z||z>e))if(!(0>s||s>e)){v=!0;x=void 0;r=b.network+"_"+b.mask+"_"+
s;var F;a:{var O=!1;F={ipv4:u("filter")(a.subnetObj.ipv4,p)||[]};var Q;if(b&&b["private-ip"]&&b["public-ip"])if(b["private-ip"]==b["public-ip"]){F=!0;break a}else if(b["range-length"]){Q=b["public-ip"];for(var Y=q(b["public-ip"],32).beg-1+parseInt(b["range-length"],10),aa=Y%256,t=1;3>=t;t++)Y=Math.floor(Y/256),aa=Y%256+"."+aa;Q=l.poolValidate("static-nat-rules",Q,"ipv4",F,Q,aa);if(!1===Q){F=!0;break a}}b&&b["private-ip"]&&(O=b["private-ip"],Q=l.poolValidate("static-nat-rules",O,"ipv4",F,O,O),O=!1===
Q?!1:!0);F=O}F&&(v=c=!1);w(b)&&(v=c=!1);A[s]&&(x=A[s].id,y[x]&&x!==r&&(y[x].cnts--,delete A[s]));for(k=z;k<e;k++)if((n=h[k])&&k!==s)z=n,Q=b,F=(F=J)||{},O=!1,z["private-ip"]===Q["private-ip"]&&z.service_t.select===Q.service_t.select&&z.interface_t.select===Q.interface_t.select?O=!0:z.service_t.select===Q.service_t.select&&(angular.isDefined(z["public-ip"])&&angular.isDefined(z["range-length"])&&angular.isDefined(Q["public-ip"])&&angular.isDefined(Q["range-length"]))&&(Q=m({itemIP:z["public-ip"],itemRange:z["range-length"],
userIP:Q["public-ip"],userRange:Q["range-length"]}),Q.invalid&&(O=!0,Q&&!Q.exactmatch&&(F.overlapPubIp=!0),F.pubIpInuse.push(z["public-ip"]))),O?(r=n["private-ip"]+"_"+n["public-ip"]+"_"+n.service_t.select+"_"+n.interface_t.select+"_"+k,A[k]||(A[k]={id:r},void 0===y[r]&&(y[r]={cnts:0}),y[r].cnts++,d.push(k)),v=c=!1):A[k]&&(A[k].id===x&&y[x]&&1>=y[x].cnts)&&(g.push(k),delete A[k],delete y[x]);b&&(v?A[s]&&(g.push(s),delete A[s]):A[s]||(A[s]={id:r},void 0===y[r]&&(y[r]={cnts:0}),y[r].cnts++,d.push(s)))}};
if(s){if(!b.row)return!0;t(b.row.entity,0,b.row.rowIndex)}else{b=angular.copy(A);angular.copy(y);A=[];y={};for(s=0;s<e;s++)h[s]&&t(h[s],s+1,s);d=[];g=[];for(s=0;s<e;s++)b[s]&&!A[s]&&g.push(s),!b[s]&&A[s]&&d.push(s)}J&&(J.overlapPubIp&&(J.msg+=a.DICT("Static_NAT_Public_IP_Range_Overlaps_The_Others"),J.msg+=",\n"),0<J.pubIpInuse.length&&(J.msg+=J.pubIpInuse.join(", ")+a.DICT("Static_NAT_Public_IP_In_Use")));return{result:c,invalidRows:d,validRows:g}};a.ifNamed=function(a){return function(b,c,d){return b.name.match(a)?
!0:!1}};a.del=function(){var b=a.model["static-nat-rules"]["static-nat-entry"],c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);a.gridSNAT.Selections=[];a.modified()};a.add=function(){if(50<=a.gridSNAT.Options.data.length){var b=a.DICT("Static_NAT_Reach_Max_Entry",{"%d":50});app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})}else b={service:"HTTP","interface":"WAN1","private-ip":"","public-ip":"","range-length":1,status:!0,edit:!0,checked:!0,service_t:{select:a.servicesList[0].id,list:angular.copy(a.servicesList)},
interface_t:{select:a.interfaceList[0].id,list:angular.copy(a.interfaceList)}},a.gridSNAT.Options.data.push(b),a.gridSNAT.Options.gridApi.customApi.scrollTo(a.gridSNAT.Options.data.length-1),a.gridSNAT.Selections.push(b),a.modified()};a.edit=function(){angular.forEach(a.model["static-nat-rules"]["static-nat-entry"],function(a){a.checked&&(a.edit=!0)})};a.save=function(){var b=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){angular.isDefined(a.$$customVldIsInvalid)&&delete a.$$customVldIsInvalid;
angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableChk)&&delete a.disableChk;angular.isDefined(a.edit)&&delete a.edit;angular.isDefined(a.service_t)&&(a.service=a.service_t.select,delete a.service_t);angular.isDefined(a.interface_t)&&(a["interface"]=a.interface_t.select,delete a.interface_t)});return a},c=b(a.model["static-nat-rules"]["static-nat-entry"]),d=function(){var b={};b["static-nat-rules"]={"static-nat-entry":c};w.post({url:resource_base+"data/static_nat.json",method:"set_static_nat",
params:b,success:function(b){a.success=!0;v();a.config_saved=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);v()}})};(function(){var c=b(a.model_orig["static-nat-rules"]["static-nat-entry"]),g=b(a.model["static-nat-rules"]["static-nat-entry"]),h=[],y;angular.forEach(c,function(a){y=!1;angular.forEach(g,function(b){a.service===b.service&&(a["interface"]===b["interface"]&&a["private-ip"]===b["private-ip"]&&a["public-ip"]===b["public-ip"])&&(y=!0)});y||h.push({service:a.service,
"interface":a["interface"],"private-ip":a["private-ip"],"public-ip":a["public-ip"]})});c={};c["static-nat-rules"]={"static-nat-entry":h};h.length?w.post({url:resource_base+"data/static_nat.json",method:"del_static_nat",params:c,success:function(a){d()},error:function(a){d();console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}):d()})();a.resetModified()};a.cancel=function(){v();a.resetModified()};v()}]);app.controller("firewallBasicSettingsCtrl",["$scope","MyHttp","$templateCache","UserSession","userAccessRight","$q","sslvpn_port_vld",function(a,b,t,m,w,u,p){var q=app.TOOLS.getVal;a.success=!1;a.dataReady=!1;a.disable_exception=!1;a.ruFlag=w.russia();a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var e=a.DICT("Basic_Settings_Remote_Web_Management_Name"),x=a.ruFlag?a.DICT("Basic_Settings_LAN_Web_Management_HTTP_Name"):a.DICT("Basic_Settings_LAN_VPN_Web_Management_HTTP_Name"),
n=a.ruFlag?a.DICT("Basic_Settings_LAN_Web_Management_HTTPS_Name"):a.DICT("Basic_Settings_LAN_VPN_Web_Management_HTTPS_Name"),l=a.DICT("Basic_Settings_Restconf_Port_Name"),r=a.DICT("Basic_Settings_Netconf_Port_Name"),v=function(){return b.post({url:resource_base+"data/firewall_basic_settings.json",method:"get_firewall_basic_settings",error:function(b){console.log("dynamic_dns error: "+status);a.dataReady=!0}})},s=function(b){b=(b.result||{}).firewall||{};var c=b["remote-web-management"]||{},d=b["lan-vpn-web-management"]||
{},g=b["allowed-remote-ip-addresses"]||{},h=b.block||{},e=(b["trusted-domains"]||{})["trusted-domain-entry"]||[];a.model.firewall={enable:q(b.enable,!1),dos_attack:q(b["dos-attack"],!1),block_wan_request:q(b["block-wan-request"],!1),remote_management:{enable:void 0!==c.enable?c.enable:!1,port:c.port,http_port:c.http?c.port:80,https_port:c.https?c.port:443,selected:c.http?"http":"https"},sip_alg:q(b["sip-alg"],!1),upnp:q(b.upnp,!1),lan_vpn_web_management:{http:q(d.http,!1),http_port:q(d["http-port"],
80),https:!0,https_port:q(d["https-port"],443)},allowed_remote_ip_addresses:{selected:g["start-address"]||g["end-address"]?"range":"any",start_address:g["start-address"]||"",end_address:g["end-address"]||""},ftp_alg_port:b["ftp-alg-port"]||21,block:{java:q(h.java,!1),cookies:q(h.cookies,!1),activex:q(h.activex,!1),access_http_proxy_servers:q(h["access-http-proxy-servers"],!1)},exception:q(b.exception,!1),trusted_domains:[]};angular.forEach(e,function(b,c){a.model.firewall.trusted_domains.push({checked:!1,
disableChk:!1,domainName:b["domain-name"],empty:"",id:c,edit:!1})});a.selects=[];a.model.firewall.orig_trusted_domains=angular.copy(a.model.firewall.trusted_domains);a.gridTrustedDomainOptions.data=a.model.firewall.trusted_domains;a.chk_exception()};m=function(){a.selects=[];angular.forEach(a.model.firewall.trusted_domains,function(b,c){b.checked?a.selects.push(b):b.edit=!1})};var k=function(){return 50<=a.model.firewall.trusted_domains.length?(a.msg=a.DICT("Basic_Settings_Max_Domains",{"%d":a.model.firewall.trusted_domains.length}),
app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},d=function(){return b.post({url:resource_base+"data/restconf.json",method:"get_restconf",error:function(a){Log(ERROR,"[Firewall Basic Setting] getRestconf Error "+JSON.stringify(a));c()}})},c=function(b){b||(b={});b=b["ciscosb-restconf"]||{};var c=b["restconf-zone"]||[],d=b.transport&&b.transport.https||{};a.model.restconf.enabled=q(b.enabled,!1);a.model.restconf.rootResource=q(b.rootResource,"");a.model.restconf.https.enabled=q(d.enabled,
!1);a.model.restconf.https.port=q(d.port,443);angular.forEach(a.model.restconf.restconf_zone,function(b,c){a.model.restconf.restconf_zone[c]=!1});angular.forEach(c,function(b){switch(b){case "wan":a.model.restconf.restconf_zone.wan=!0}});a.model.restconf.restconf_zone["lan-vpn"]=!0},h=function(){return b.post({url:resource_base+"data/netconf.json",method:"get_netconf",error:function(a){Log(ERROR,"[Firewall Basic Setting] getNetconf Error "+JSON.stringify(a));g()}})},g=function(b){b||(b={});b=b["ciscosb-netconf"]||
{};var c=b["netconf-zone"]||[],d=b.transport&&b.transport.ssh||{};a.model.netconf.enabled=q(b.enabled,!1);a.model.netconf.ssh.enabled=q(d.enabled,!1);a.model.netconf.ssh.ip=q(d.ip,"0.0.0.0");a.model.netconf.ssh.port=q(d.port,830);angular.forEach(a.model.restconf.restconf_zone,function(b,c){a.model.netconf.netconf_zone[c]=!1});angular.forEach(c,function(b){switch(b){case "wan":a.model.netconf.netconf_zone.wan=!0}});a.model.netconf.netconf_zone["lan-vpn"]=!0},A=function(){u.all([v(),d(),h(),p.init()]).then(function(b){s(b[0]&&
b[0].data&&b[0].data);c(b[1]&&b[1].data&&b[1].data.result);g(b[2]&&b[2].data&&b[2].data.result);a.dataReady=!0;setTimeout(function(){a.gridTrustedDomainOptions.gridApi&&a.gridTrustedDomainOptions.gridApi.customApi.checkSelectStatus()},50)})};a.errstr={lvwm_http:"",lvwm_https:"",rmt:"",netconf:"",restconf:""};a.model={firewall:{trusted_domains:[]},restconf:{enabled:!1,rootResource:"",restconf_zone:{wan:!1,"lan-vpn":!0},https:{enabled:!1,port:443}},netconf:{enabled:!1,netconf_zone:{wan:!1,"lan-vpn":!0},
ssh:{enabled:!1,ip:"",port:830}}};a.selects=[];a.model.httpPortPattern="^(80|102[5-9]|10[3-9][0-9]|1[1-9][0-9][0-9]|[2-9][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9]|6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9])$";a.model.httpsPortPattern="^(443|102[5-9]|10[3-9][0-9]|1[1-9][0-9][0-9]|[2-9][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9]|6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9])$";a.model.netconfPortPattern="^(830|102[5-9]|10[3-9][0-9]|1[1-9][0-9][0-9]|[2-9][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9]|6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9])$";
a.funs={save:function(){var c=a.model.firewall,d=[],d=[];(function(){var b=!0,c=[];angular.forEach(a.model.firewall.orig_trusted_domains,function(d){b=!0;angular.forEach(a.model.firewall.trusted_domains,function(a){d.domainName===a.domainName&&(b=!1)});b&&c.push({"domain-name":d.domainName})});c.length&&d.push({method:"del_firewall_basic_settings",params:{firewall:{"trusted-domains":{"trusted-domain-entry":c}}}})})();(function(){var a=c.remote_management.http_port&&""!==c.remote_management.http_port?
c.remote_management.http_port:80,b=c.remote_management.https_port&&""!==c.remote_management.https_port?c.remote_management.https_port:443,g={firewall:{enable:c.enable,"dos-attack":c.dos_attack,"block-wan-request":c.block_wan_request,"remote-web-management":{enable:c.remote_management.enable,port:"http"===c.remote_management.selected?a:b},"sip-alg":c.sip_alg,upnp:c.upnp,"lan-vpn-web-management":{http:c.lan_vpn_web_management.http,https:c.lan_vpn_web_management.https,"http-port":c.lan_vpn_web_management.http_port,
"https-port":c.lan_vpn_web_management.https_port},"ftp-alg-port":c.ftp_alg_port,block:{java:c.block.java,cookies:c.block.cookies,activex:c.block.activex,"access-http-proxy-servers":c.block.access_http_proxy_servers},exception:c.exception,"trusted-domains":{"trusted-domain-entry":[]}}};"http"===c.remote_management.selected?angular.extend(g.firewall["remote-web-management"],{http:!0,https:!1}):angular.extend(g.firewall["remote-web-management"],{http:!1,https:!0});g.firewall["allowed-remote-ip-addresses"]=
"any"===c.allowed_remote_ip_addresses.selected?{any:null}:{"start-address":c.allowed_remote_ip_addresses.start_address,"end-address":c.allowed_remote_ip_addresses.end_address};angular.forEach(c.trusted_domains,function(a){g.firewall["trusted-domains"]["trusted-domain-entry"].push({"domain-name":a.domainName})});d.push({method:"set_firewall_basic_settings",params:g})})();(function(){var b=a.model.netconf,c=_.isNumber(b.ssh.port)?b.ssh.port:830,g;g={enabled:b.enabled,"netconf-zone":[],transport:{ssh:{enabled:b.ssh.enabled,
ip:b.ssh.ip,port:c}}};angular.forEach(b.netconf_zone,function(a,b){a&&g["netconf-zone"].push(b)});d.push({method:"set_netconf",params:{"ciscosb-netconf":g}})})();(function(){var b=a.model.restconf,c=_.isNumber(b.https.port)?b.https.port:443,g;g={enabled:b.enabled,"restconf-zone":[],transport:{https:{enabled:b.https.enabled,port:c}}};angular.forEach(b.restconf_zone,function(a,b){a&&g["restconf-zone"].push(b)});d.push({method:"set_restconf",params:{"ciscosb-restconf":g}})})();b.post({method:"set_bulk",
forcedUsingPost:!0,params:d,success:function(b){a.success=!0;A();a.resetModified()},error:function(b){A();a.resetModified()}})},cancel:function(){A();a.resetModified()},add:function(){k()||(a.model.firewall.trusted_domains.push({checked:!0,disableChk:!0,domainName:"",idx:a.model.firewall.trusted_domains.length,edit:!0}),a.gridTrustedDomainOptions.gridApi.customApi.scrollTo(a.model.firewall.trusted_domains.length-1,1),a.modified())},edit:function(){angular.forEach(a.model.firewall.trusted_domains,
function(a,b){a.checked&&(a.edit=!0)})},del:function(){for(var b=a.model.firewall.trusted_domains,c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);a.selects=[];a.modified()},changeHttpHttps:function(){a.model.firewall.remote_management.http_port=80;a.model.firewall.remote_management.https_port=443;a.check_firewall_port()},cleanInterPort:function(){var b=a.model.firewall.remote_management;!1===b.enable&&"http"===b.selected&&8008===b.http_port&&(b.http_port=80);!1===b.enable&&"https"===b.selected&&
8008===b.https_port&&(b.https_port=443);a.check_firewall_port()}};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridTrustedDomainOptions=app.uiGrid.generateGridOptions({IDPreifx:"trusted_domains_table",data:a.model.firewall.trusted_domains,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:m,headerChangedCbk:m,disableChkBoxField:"disableChk"},{field:"domainName",displayName:a.DICT("Basic_Settings_Domain_Name"),editRow:"edit",required:!0,width:400,validationCbk:"gridInvalidCbk",
cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"legal-char domain-name maxlength=253"),id:"trusted_domains_table"},{field:"empty",displayName:"",isEmpty:!0}]});a.chk_exception=function(){var b=a.model.firewall.block;!b.java&&!b.cookies&&!b.activex&&!b.access_http_proxy_servers?(a.model.firewall.exception=!1,a.disable_exception=!0):a.disable_exception=!1};a.chk_range=function(){var b=function(b){a.form&&(a.form.start_ip&&a.form.end_ip)&&(a.form.start_ip.$setValidity("rangeInvalid",
b),a.form.end_ip.$setValidity("rangeInvalid",b))};if(!a.model.firewall.enable||"range"!==a.model.firewall.allowed_remote_ip_addresses.selected)b(!0);else{var c=a.model.firewall.allowed_remote_ip_addresses.start_address,d=a.model.firewall.allowed_remote_ip_addresses.end_address;!c||!d?b(!0):(c=app.TOOLS.ipRangeCompare(c,d),b(c.ret))}};a.check_firewall_ports_overlap=function(){var b=function(b,c){a.form[b]&&a.form[b].$setValidity&&a.form[b].$setValidity("duplicate",c)},c=a.model.firewall,d=a.errstr,
g=c.remote_management,h=-1,k=-2,c=c.lan_vpn_web_management,A=-3,s=-4,v=a.model.restconf,F=-5,q=-6,p=a.model.netconf,m=-7,J=-8;g.enable&&("http"===g.selected&&_.isNumber(g.http_port)?h=g.http_port:"https"===g.selected&&_.isNumber(g.https_port)&&(k=g.https_port));c.http&&c.http_port&&(A=c.http_port);s=c.https_port;v.enabled&&v.https.port&&(v.restconf_zone.wan&&(F=v.https.port),q=v.https.port);p.enabled&&p.ssh.port&&(p.netconf_zone.wan&&(m=p.ssh.port),J=p.ssh.port);a.errstr.lvwm_http=[];a.errstr.lvwm_https=
[];a.errstr.rmt=[];a.errstr.netconf=[];a.errstr.restconf=[];b("lvwm_http_port",!0);b("lvwm_https_port",!0);b("rmt_http_port",!0);b("rmt_https_port",!0);b("netconf_port",!0);b("restconf_port",!0);A===s&&(d.lvwm_http.push(n),d.lvwm_https.push(x),b("lvwm_http_port",!1),b("lvwm_https_port",!1));F===h&&(d.rmt.push(l),d.restconf.push(e),b("restconf_port",!1),b("rmt_http_port",!1));F===k&&(d.rmt.push(l),d.restconf.push(e),b("restconf_port",!1),b("rmt_https_port",!1));q===A&&(d.restconf.push(x),d.lvwm_http.push(l),
b("lvwm_http_port",!1),b("restconf_port",!1));m===h&&(d.netconf.push(e),d.rmt.push(r),b("netconf_port",!1),b("rmt_http_port",!1));m===k&&(d.netconf.push(e),d.rmt.push(r),b("netconf_port",!1),b("rmt_https_port",!1));J===A&&(d.netconf.push(x),d.lvwm_https.push(r),b("netconf_port",!1),b("lvwm_http_port",!1));J===s&&(d.netconf.push(n),d.lvwm_https.push(r),b("netconf_port",!1),b("lvwm_https_port",!1));if(F===m||q===J)d.restconf.push(r),d.netconf.push(l),b("restconf_port",!1),b("netconf_port",!1);d.lvwm_http=
a.DICT("Basic_Settings_Duplicate",{"%s":d.lvwm_http.join(", ")});d.lvwm_https=a.DICT("Basic_Settings_Duplicate",{"%s":d.lvwm_https.join(", ")});d.rmt=a.DICT("Basic_Settings_Duplicate",{"%s":d.rmt.join(", ")});d.netconf=a.DICT("Basic_Settings_Duplicate",{"%s":d.netconf.join(", ")});d.restconf=a.DICT("Basic_Settings_Duplicate",{"%s":d.restconf.join(", ")})};a.check_firewall_port=function(){var b=function(b,c){a.form[b]&&a.form[b].$setValidity&&a.form[b].$setValidity("overlap",c)},c=function(b){app.TOOLS.criticalAlertBox({title:a.DICT("Error"),
msg:b})},d=a.model.firewall,g=a.model.restconf,h=a.model.netconf,e=d.remote_management,d=d.lan_vpn_web_management,k=[],l;b("rmt_http_port",!0);b("rmt_https_port",!0);b("lvwm_https_port",!0);b("lvwm_http_port",!0);b("netconf_port",!0);b("restconf_port",!0);if(d.http)l=p.check_firewall_port_lan(d.http_port),l.valid||(k=k.concat(l.err),b("lvwm_http_port",!1));else if(!d.http_port||!_.isNumber(d.http_port))d.http_port=80;g.enabled?_.isNumber(g.https.port)&&(l=g.restconf_zone.wan?p.check_firewall_port_wan(g.https.port):
p.check_firewall_port_lan(g.https.port),l.valid||(k=k.concat(l.err),b("restconf_port",!1))):_.isNumber(g.https.port)||(g.https.port=443);h.enabled?_.isNumber(h.ssh.port)&&(l=h.netconf_zone.wan?p.check_firewall_port_wan(h.ssh.port):p.check_firewall_port_lan(h.ssh.port),l.valid||(k=k.concat(l.err),b("netconf_port",!1))):_.isNumber(h.ssh.port)||(h.ssh.port=830);if(d.https)l=p.check_firewall_port_lan(d.https_port),l.valid||(k=k.concat(l.err),b("lvwm_https_port",!1));else if(!d.https_port||!_.isNumber(d.https_port))d.https_port=
443;e.enable?("http"===e.selected&&(l=p.check_firewall_port_wan(e.http_port),l.valid||(k=k.concat(l.err),b("rmt_http_port",!1))),"https"===e.selected&&(l=p.check_firewall_port_wan(e.https_port),l.valid||(k=k.concat(l.err),b("rmt_https_port",!1)))):(_.isNumber(e.http_port)||(e.http_port=80),_.isNumber(e.https_port)||(e.https_port=443));k.length&&c(p.get_err_html(k));a.check_firewall_ports_overlap()};A()}]);app.controller("accessRulesCtrl",["$scope","MyHttp","$uibModal","$location","wan_service","$q","ciscosb","pgWindow","UserSession","userAccessRight","oneTimeLocker",function(a,b,t,m,w,u,p,q,e,x,n){var l=0,r=0;a.success=!1;a.userAccessFlag=x.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();var v=function(){return b.post({url:resource_base+"data/services.json",method:"get_services",error:function(a){Log(ERROR,"accessRulesCtrl getServices error: "+a.status)}})},s=function(){return b.post({url:resource_base+
"data/schedule.json",method:"get_schedule",error:function(a){Log(ERROR,"accessRulesCtrl getSchedule error: "+a.status)}})},k=function(){return b.post({url:resource_base+"data/firewall_access_rules.json",method:"get_acl",error:function(a){Log(ERROR,"accessRulesCtrl getData error: "+JSON.stringify(a))}})},d=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",error:function(a){Log(ERROR,"accessRulesCtrl getInterface error: "+a.status)}})},c=function(b,c){var d=
b["interface"]||{},g=b["source-ip"]||{},h=b.action||{},z=b["destination-ip"]||{},e={checked:!0,rule_id:b["rule-id"],priority:b.priority,enable:void 0!==b.enable?b.enable:!0,action:!0,service:b.service||a.model.services[0].id,ip_type:c||"IPv4",log:void 0!==b.log?b.log:!0,"interface":{},source_ip:{type:"any",single_ip:"",start:"",end:"",subnet_ip:"",subnet_prefix:""},destination_ip:{type:"any",single_ip:"",start:"",end:"",subnet_ip:"",subnet_prefix:""},schedule:b.schedule||a.model.schedules[0].id,default_value:void 0===
b["default"]?!1:b["default"]};(function(){var a=function(a,b){angular.forEach(a,function(a,c){switch(c){case "source-any":b.type="any";break;case "ipv4":case "ipv6":angular.forEach(a,function(a,c){b.type=c;switch(c){case "single":b.single_ip=a;break;case "range":b.start=a.start;b.end=a.end;break;case "subnet":b.subnet_ip=a.ip||"";b.subnet_prefix=a["prefix-length"]||"";break;default:Log(ERROR,"ACL procData error, source_ip type is undefined: '"+c+"'")}})}})};angular.forEach(h,function(a,b){switch(b){case "allow":e.action=
!0;break;case "deny":e.action=!1}});a(g,e.source_ip);a(z,e.destination_ip)})();!0===b["default"]?(e["interface"].source=d["source-name"]?d["source-name"]:d["source-interface"]||a.model.ifs[0].id,e["interface"].destination=d["destination-name"]?d["destination-name"]:d["destination-interface"]||a.model.ifs[0].id):(d["source-name"]&&d["source-name"].match(/^any$/i)?e["interface"].source="any":e["interface"].source=d["source-interface"]||a.model.ifs[0].id,d["destination-name"]&&d["destination-name"].match(/^any$/i)?
e["interface"].destination="any":e["interface"].destination=d["destination-interface"]||a.model.ifs[0].id);return e},h=function(){var b=[],c,d,g=!1,h=!1;a.model.ipv4_display=[];a.model.ipv6_display=[];var e=function(b){switch(b){case "any":return a.DICT("Any")}return b},z=function(b,c){switch(b.type){case "any":return a.DICT("Any");case "single":return b.single_ip;case "range":return c?g=!0:h=!0,b.start+" - "+b.end;case "subnet":return b.subnet_ip+"/"+b.subnet_prefix}return""},k=function(g,h){var k=
1;b=[];angular.forEach(g,function(c,d){if(c){var g={checked:!1,rule_id:c.rule_id,orig_idx:d,priority:c.priority,gui_priority:{priority:k,info:""},enable:c.enable,action:c.action?a.DICT("Access_Rules_Allowed"):a.DICT("Access_Rules_Denied"),service:c.ip_type+": "+c.service,source_intf:e(c["interface"].source),destination_intf:e(c["interface"].destination),schedule:c.schedule,source:z(c.source_ip,"IPv4"===c.ip_type),destination:z(c.destination_ip,"IPv4"===c.ip_type),default_value:void 0===c.default_value?
!1:c.default_value},h;h=g.default_value;var B=c.ip_type;h=h?[]:[{cbk:a.funs.table.up(B),displayName:a.DICT("Access_Rules_Up"),disabled:h,className:"grid-btn-caret-up"},{cbk:a.funs.table.down(B),displayName:a.DICT("Access_Rules_Down"),disabled:h,className:"grid-btn-caret-down"},{cbk:a.funs.table.jumpto(B),displayName:a.DICT("Access_Rules_Jump"),disabled:h,className:"grid-btn-sort"}];g.configure=h;g.default_value?(g.gui_priority.priority=g.rule_id,g.gui_priority.info=1E3<=g.rule_id&&2E3>g.rule_id?a.DICT("Access_Rules_Port_Forward_Hint"):
2E3<=g.rule_id&&3E3>g.rule_id?a.DICT("Access_Rules_Static_NAT_Hint"):a.DICT("Access_Rules_System_Hint")):k++;b[c.priority]&&(b[c.priority],Log(ERROR,"There are two priority at Confd database, priority is "+b[c.priority].priority),Log(INFO,b[c.priority]),Log(INFO,g));b[c.priority]=g}});c=b.length;for(d=0;d<c;d++)b[d]&&h.push(b[d])};k(a.model.ipv4_acls,a.model.ipv4_display);k(a.model.ipv6_acls,a.model.ipv6_display);a.gridIPv4ACLOptions.rowHeight=g?1.5*app.uiGrid.rowHeight:app.uiGrid.rowHeight;a.gridIPv6ACLOptions.rowHeight=
h?1.5*app.uiGrid.rowHeight:app.uiGrid.rowHeight;a.gridIPv4ACLOptions.data=a.model.ipv4_display;a.gridIPv6ACLOptions.data=a.model.ipv6_display;a.gridIPv4ACLOptions.gridApi&&a.gridIPv4ACLOptions.gridApi.core.notifyDataChange("all");a.gridIPv6ACLOptions.gridApi&&a.gridIPv6ACLOptions.gridApi.core.notifyDataChange("all")},g=function(b){var d=b["firewall-acl-rules"]||{};b=d.ipv4||{};var d=d.ipv6||{},g;a.model.ipv4_acls=[];a.model.ipv6_acls=[];a.model.ipv4_defaults=[];a.model.ipv6_defaults=[];r=l=0;b=b["firewall-acl-rule"]||
[];angular.forEach(b,function(b,d){!0===b["default"]?a.model.ipv4_defaults.push(c(b,"IPv4")):(g=c(b,"IPv4"),g.priority>l&&(l=g.priority),a.model.ipv4_acls.push(g))});b=d["firewall-acl-rule"]||[];angular.forEach(b,function(b,d){!0===b["default"]?a.model.ipv6_defaults.push(c(b,"IPv6")):(g=c(b,"IPv6"),g.priority>r&&(r=g.priority),a.model.ipv6_acls.push(g))});a.model.ipv4_acls.sort(function(a,b){return a.priority-b.priority});a.model.ipv6_acls.sort(function(a,b){return a.priority-b.priority});a.model.ipv4_acls=
a.model.ipv4_acls.concat(a.model.ipv4_defaults);a.model.ipv6_acls=a.model.ipv6_acls.concat(a.model.ipv6_defaults);a.model.origIPv4Acls=angular.copy(a.model.ipv4_acls);a.model.origIPv6Acls=angular.copy(a.model.ipv6_acls);h()},A=function(b){a.model.services=[];var c=[];b.services&&b.services.service&&(c=b.services.service);angular.forEach(c,function(b,c){a.model.services.push({id:b.name,displayName:b.name})})},y=function(b){a.model.schedules=[];var c=[];b.schedules&&b.schedules.schedule&&(c=b.schedules.schedule);
angular.forEach(c,function(b){a.model.schedules.push({id:b.name,displayName:a.DICT(b.name)})})},z=function(b){a.model.ifs=[];var c=[],d=[],g=[],h,e,z,k={},B=w.filter(b.interfaces["interface"],{gre:!0,usb:!0,physical:!0,dmz:!0,ipv6transition:!0,subinterface:!0});angular.forEach(b.interfaces["interface"],function(a){if(h=a.name.match(/^(WAN\d+)-(BRIDGE)($|.\d+$)/))k[h[1]+h[3]]=!0,a.ipv4&&(a.ipv4.setting&&a.ipv4.setting["trasparent-bridge"])&&(e=a.ipv4.setting["trasparent-bridge"],z=e.ifnames&&e.ifnames[0]&&
e.ifnames[0].split(" ")||[],angular.forEach(z,function(a){k[a]=!0}))});angular.forEach(B,function(a,b){a.name.match(/^GRE\d+$/)?!1!==a.enabled&&g.push({id:a.name,displayName:a.name}):!k[a.name]&&!(a.name.match(/^USB\d+$/)&&!1===a.enabled||a.name.match(/^DMZ$/)&&!1===a.enabled||a.name.match(/^TUN\d+$/)&&!1===a.enabled)&&c.push({id:a.name,displayName:a.name})});angular.forEach(b.interfaces["interface"],function(a,b){a.name.match(/^VLAN/)&&!k[a.name]&&d.push({id:a.name,displayName:a.name})});d.push({id:"any",
displayName:"Any"});a.model.ifs=c.concat(g).concat(d)},B=function(b){a.model.addEditItem={};a.model.addEditItem=angular.copy(b)};e=function(b){return function(c){"IPv4"===b?(a.model.ipv4_selects=[],angular.forEach(a.model.ipv4_display,function(b,c){b.checked&&a.model.ipv4_selects.push(b)})):(a.model.ipv6_selects=[],angular.forEach(a.model.ipv6_display,function(b,c){b.checked&&a.model.ipv6_selects.push(b)}))}};var D={main:"access_rules.html",edit:"edit_access_rule.html"},E=-1,C=function(){u.all([v(),
d(),s(),k()]).then(function(b){A(b[0].data.result||{});z(b[1].data.result||{});y(b[2].data.result||{});g(b[3].data.result||{});b=n.get("backFromSchedule");var c=n.get("prevACLCache"),d,h,e=!1;b&&c&&(d=c.addEditItem,h=c.addEditIdx,-1===h?(b="IPv4"===d.ip_type?(a.model.ipv4_acls.length-a.model.ipv4_defaults.length||0)+1:(a.model.ipv6_acls.length-a.model.ipv6_defaults.length||0)+1,d.rule_id=b,a.model.addEditItem=d,E=-1,e=!0):(angular.forEach("IPv4"===d.ip_type?a.model.ipv4_acls:a.model.ipv6_acls,function(a,
b){a.rule_id===d.rule_id&&h===b&&(e=!0)}),e&&(a.model.addEditItem=d,E=h)),e&&(a.currPage=D.edit));a.dataReady=!0;setTimeout(function(){a.gridIPv4ACLOptions.gridApi&&a.gridIPv4ACLOptions.gridApi.customApi.checkSelectStatus();a.gridIPv6ACLOptions.gridApi&&a.gridIPv6ACLOptions.gridApi.customApi.checkSelectStatus()},50)});a.currPage=D.main};a.dataReady=!1;a.currPage=D.main;a.model={ifs:[],services:[],schedules:[],ipv4_acls:[],ipv6_acls:[],ipv4_selects:[],ipv6_selects:[],origIPv4Acls:[],origIPv6Acls:[],
addEditItem:{},scheme:{},defaults:[]};a.gridIPv4ACLOptions=app.uiGrid.generateGridOptions({IDPreifx:"ipv4_accessrule_table",data:a.model.ipv4_display,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:e("IPv4"),headerChangedCbk:e("IPv4"),hideField:"default_value"},{field:"gui_priority",displayName:a.DICT("Access_Rules_Priority"),width:80,cellTemplate:"access_priority.html"},{field:"enable",displayName:a.DICT("Access_Rules_Enable"),width:80,cellTemplate:"UG_table_checkbox_with_inline_edit.html"},
{field:"action",displayName:a.DICT("Access_Rules_Action"),width:80},{field:"service",displayName:a.DICT("Access_Rules_Services")},{field:"source_intf",displayName:a.DICT("Access_Rules_Source_Interface")},{field:"source",displayName:a.DICT("Access_Rules_Source"),minWidth:160,cellTemplate:"UG_table_text_with_wrap.html"},{field:"destination_intf",displayName:a.DICT("Access_Rules_Destination_Interface"),minWidth:160},{field:"destination",displayName:a.DICT("Access_Rules_Destination"),minWidth:160,cellTemplate:"UG_table_text_with_wrap.html"},
{field:"schedule",displayName:a.DICT("Access_Rules_Schedule")},{field:"configure",displayName:a.DICT("Access_Rules_Configure"),cellTemplate:"UG_table_icons.html",id:"accessrule_table"}]});a.gridIPv6ACLOptions=app.uiGrid.generateGridOptions({IDPreifx:"ipv6_accessrule_table",data:a.model.ipv6_display,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:e("IPv6"),headerChangedCbk:e("IPv6"),hideField:"default_value"},{field:"gui_priority",displayName:a.DICT("Access_Rules_Priority"),width:80,cellTemplate:"access_priority.html"},
{field:"enable",displayName:a.DICT("Access_Rules_Enable"),width:80,cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"action",displayName:a.DICT("Access_Rules_Action"),width:80},{field:"service",displayName:a.DICT("Access_Rules_Services")},{field:"source_intf",displayName:a.DICT("Access_Rules_Source_Interface")},{field:"source",displayName:a.DICT("Access_Rules_Source"),minWidth:160},{field:"destination_intf",displayName:a.DICT("Access_Rules_Destination_Interface"),minWidth:160},{field:"destination",
displayName:a.DICT("Access_Rules_Destination")},{field:"schedule",displayName:a.DICT("Access_Rules_Schedule"),minWidth:160},{field:"configure",displayName:a.DICT("Access_Rules_Configure"),cellTemplate:"UG_table_icons.html",id:"accessrule_table"}]});var I=function(b,c){var d,g,h=1,e;if("IPv4"===b){if(65532>l&&!c)return;e=a.model.ipv4_acls}else if("IPv6"===b){if(65532>r&&!c)return;e=a.model.ipv6_acls}else return;h=1;d=e.length;for(g=0;g<d;g++)e[g]&&!e[g].default_value&&("IPv4"===b?l=h:r=h,e[g].priority=
h,h++)},G=function(b){b=a.model.ipv4_acls.length+a.model.ipv6_acls.length;return 200<=b?(a.msg=a.DICT("Access_Rules_Max_Entries",{"%d":b}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.funs={save:function(c){var d,g,h=!1,e,z,k=function(a,b,c){b=b?"ipv4":"ipv6";var d={};d[b]={};switch(a.type){case "any":d=c?p.empty_type("destination-any"):p.empty_type("source-any");break;case "single":d[b].single=a.single_ip;break;case "range":d[b].range={start:a.start,end:a.end};break;case "subnet":d[b].subnet=
{},d[b].subnet.ip=a.subnet_ip,d[b].subnet["prefix-length"]=a.subnet_prefix}return d},B=function(a){var b={"rule-id":a.rule_id,priority:a.priority,enable:a.enable,service:a.service,log:a.log,"interface":{},"source-ip":k(a.source_ip,"IPv4"===a.ip_type,!1),"destination-ip":k(a.destination_ip,"IPv4"===a.ip_type,!0),schedule:a.schedule,"default":void 0===a.default_value?!1:a.default_value};"any"==a["interface"].source?b["interface"]["source-name"]="any":b["interface"]["source-interface"]=a["interface"].source;
"any"==a["interface"].destination?b["interface"]["destination-name"]="any":b["interface"]["destination-interface"]=a["interface"].destination;b.action=a.action?p.empty_type("allow"):p.empty_type("deny");return b},l=function(){d={};e=[];z=[];angular.forEach(a.model.ipv4_acls,function(a){!1===a.default_value&&e.push(B(a))});angular.forEach(a.model.ipv6_acls,function(a){!1===a.default_value&&z.push(B(a))});e.length&&(d.ipv4={"firewall-acl-rule":e});z.length&&(d.ipv6={"firewall-acl-rule":z});b.post({method:"set_access_rules",
params:{"firewall-acl-rules":d},success:function(b){a.success=!0;C();a.resetModified()},error:function(b){C();a.resetModified()}})};"addEdit"===c&&(c=a.model.addEditItem,-1===E?"IPv4"===c.ip_type?a.model.ipv4_acls.push(c):a.model.ipv6_acls.push(c):"IPv4"===c.ip_type?a.model.ipv4_acls[E]=angular.extend(c):a.model.ipv6_acls[E]=angular.extend(c));d={};e=[];z=[];angular.forEach(a.model.origIPv4Acls,function(b){!1===b.default_value&&(g=!0,angular.forEach(a.model.ipv4_acls,function(a){b.rule_id===a.rule_id&&
(g=!1)}),g&&e.push({"rule-id":b.rule_id}))});angular.forEach(a.model.origIPv6Acls,function(b){!1===b.default_value&&(g=!0,angular.forEach(a.model.ipv6_acls,function(a){b.rule_id===a.rule_id&&(g=!1)}),g&&z.push({"rule-id":b.rule_id}))});e.length&&(h=!0,d.ipv4={"firewall-acl-rule":e});z.length&&(h=!0,d.ipv6={"firewall-acl-rule":z});h?b.post({method:"del_access_rules",params:{"firewall-acl-rules":d},success:function(a){l()},error:function(a){l()}}):l()},add:function(b){if(!G(b)){var d={},g,h,e;I(b);
"IPv4"===b?(g=a.model.ipv4_acls,l++,e=l):(g=a.model.ipv6_acls,r++,e=r);angular.forEach(g,function(a){d[a.rule_id]=!0});for(g=1;200>=g;g++)if(!d[g]){h=g;break}B(c({"rule-id":h,priority:e},b));E=-1;a.currPage=D.edit;a.modified()}},edit:function(b){var c,d;"IPv4"===b?(b=a.model.ipv4_acls,c=a.model.ipv4_selects):(b=a.model.ipv6_acls,c=a.model.ipv6_selects);1===c.length&&(d=c[0].rule_id,angular.forEach(b,function(a,b){a.rule_id===d&&(E=b,B(a))}),a.currPage=D.edit)},del:function(b){var c,d={};"IPv4"===
b?(b=a.model.ipv4_acls,c=a.model.ipv4_selects):(b=a.model.ipv6_acls,c=a.model.ipv6_selects);angular.forEach(c,function(a){d[a.rule_id]=!0});for(c=b.length-1;0<=c;c--)d[b[c].rule_id]&&b.splice(c,1);h();a.modified()},restoreToDefault:function(){var c={},d=[],g=[],h=a.DICT("Access_Rules_Confirm");q.confirm(h)&&(angular.forEach(a.model.origIPv4Acls,function(a){!1===a.default_value&&d.push({"rule-id":a.rule_id})}),angular.forEach(a.model.origIPv6Acls,function(a){!1===a.default_value&&g.push({"rule-id":a.rule_id})}),
d.length&&(c.ipv4={"firewall-acl-rule":d}),g.length&&(c.ipv6={"firewall-acl-rule":g}),b.post({method:"del_access_rules",params:{"firewall-acl-rules":c},success:function(b){a.success=!0;C();a.resetModified()},error:function(b){C();a.resetModified()}}))},serviceManagement:function(){Log(INFO,"serviceManagement");app.TOOLS.jumpToPage("System_Config_Service_Management")},cancel:function(b){a.currPage=D.main;a.resetModified()},table:{up:function(b){return function(c){var d,g;d="IPv4"===b?a.model.ipv4_acls:
a.model.ipv6_acls;0!==c&&(g=d[c-1].priority,d[c-1].priority=d[c].priority,d[c].priority=g,g=d[c-1],d[c-1]=d[c],d[c]=g,h())}},down:function(b){return function(c){var d,g;d="IPv4"===b?a.model.ipv4_acls:a.model.ipv6_acls;!(c+1>=d.length)&&!0!==d[c+1].default_value&&(g=d[c+1].priority,d[c+1].priority=d[c].priority,d[c].priority=g,g=d[c+1],d[c+1]=d[c],d[c]=g,h())}},edit:function(b){return function(c){var d;d="IPv4"===b?a.model.ipv4_acls:a.model.ipv6_acls;E=c;B(d[c]);a.currPage=D.edit}},del:function(b){return function(c){("IPv4"===
b?a.model.ipv4_acls:a.model.ipv6_acls).splice(c,1);h()}},jumpto:function(b){return function(c){var d,g,e;"IPv4"===b?(d=a.model.ipv4_acls,g=a.model.ipv4_defaults):(d=a.model.ipv6_acls,g=a.model.ipv6_defaults);t.open({animation:a.animationsEnabled,templateUrl:"access_rule_jump.htm",controller:"jumpCtrl",size:"sm",backdrop:"static",resolve:{max:function(){return d.length-g.length},type:function(){return b},id:function(){return c}}}).result.then(function(a){e=d[c].priority;d[c].priority=d[a-1].priority;
d[a-1].priority=e;e=d[c];d.splice(c,1);d.splice(a-1,0,e);I(b,!0);h()},function(a){})}}}};a.jumpToSchedule=function(){n.put("prevACLCache",{addEditItem:angular.copy(a.model.addEditItem),addEditIdx:E});n.put("jumpFromACL",{});m.url("System_Config_Schedules/")};a.model.scheme={actionList:[{id:!0,displayName:a.DICT("Access_Rules_Allow")},{id:!1,displayName:a.DICT("Access_Rules_Deny")}],logList:[{id:!1,displayName:a.DICT("Access_Rules_Never")},{id:!0,displayName:a.DICT("Access_Rules_True")}],addrTypeList:[{id:"any",
displayName:a.DICT("Access_Rules_Any")},{id:"single",displayName:a.DICT("Access_Rules_Single_IP")},{id:"range",displayName:a.DICT("Access_Rules_IP_Range")},{id:"subnet",displayName:a.DICT("Access_Rules_Subnet")}]};C()}]);
app.controller("jumpCtrl",["$scope","$uibModalInstance","UserSession","userAccessRight","max","type","id",function(a,b,t,m,w,u,p){a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();a.jump="";a.max=w;a.id=p;a.funs={save:function(){b.close(a.jump)},cancel:function(){b.dismiss("cancel")}}}]);app.controller("port_forwarding_main",["$scope","$q","$location","rpcFns","MyHttp","$timeout","$filter","GridRowBasedEditingOper","$templateCache","Sets","wan_service","UserSession","userAccessRight","sslvpn_port_vld",function(a,b,t,m,w,u,p,q,e,x,n,l,r,v){a.model=a.model||{};a.ctx=a.ctx||{};a.success=!1;a.dataReady=!1;a.services=[];a.interfaces=[];a.origRules=[];a.forcedUsingPost=!0;var s={procBackground:!1,forcedUsingPost:a.forcedUsingPost};a.userAccessFlag=r.get();"RW"!==a.userAccessFlag&&"RO"!==
a.userAccessFlag&&l.logout();var k=function(){var c=w.post({url:resource_base+"data/port_forwarding.json",method:"get_port_forwarding",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),h=w.post({url:resource_base+"data/service_management.json",method:"get_services",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,h,v.init()]).then(function(b){a.model={};a.interfaces=[];a.services=[];angular.extend(a.model,b[0].data.result);
angular.extend(a.model,b[1].data.result);d();a.schema=a.schema||{};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};angular.forEach(a.model.interfaces["interface"],function(b){a.interfaces.push({id:b.name,displayName:b.name})});angular.forEach(a.getTCPUDPService(),function(b){a.services.push({id:b.name,displayName:b.name})});angular.forEach(a.model["port-forwarding-rules"]["port-forwarding-entry"],function(b){b.external_service={select:b["external-service"],list:angular.copy(a.services)};
b.internal_service={select:b["internal-service"],list:angular.copy(a.services)};b.interface_t={select:b["interface"],list:angular.copy(a.interfaces)}});a.gridPortFW.Options.data=a.model["port-forwarding-rules"]["port-forwarding-entry"];a.gridUpnpPortFW.Options.data=a.model["upnp-port-forwarding-rules"]["upnp-port-forwarding-entry"];a.origRules=angular.copy(a.model["port-forwarding-rules"]["port-forwarding-entry"]);a.gridPortFW.Selections=[];a.gridUpnpPortFW.Selections=[];setTimeout(function(){a.gridPortFW.Options.gridApi&&
a.gridPortFW.Options.gridApi.customApi&&a.gridPortFW.Options.gridApi.customApi.checkSelectStatus()},10);a.dataReady=!0;a.resetModified()})};k();var d=function(){a.model["port-forwarding-rules"]||angular.extend(a.model,{"port-forwarding-rules":{"port-forwarding-entry":[]}});a.model["upnp-port-forwarding-rules"]||angular.extend(a.model,{"upnp-port-forwarding-rules":{"upnp-port-forwarding-entry":[]}});a.port_sample={invalid:!1,service_invalid_d:!1,service_invalid:!1,checked:!1,edit:!1};angular.forEach(a.model["port-forwarding-rules"]["port-forwarding-entry"],
function(b){x.recover_object(b,a.port_sample)});a.upnp_sample={checked:!1};angular.forEach(a.model["upnp-port-forwarding-rules"]["upnp-port-forwarding-entry"],function(b){x.recover_object(b,a.upnp_sample)});a.filterWAN_WANsub={physical:!0,subinterface:!0,usb:!0};a.model.interfaces["interface"]=n.filter(a.model.interfaces["interface"],a.filterWAN_WANsub);a.model.interfaces["interface"].unshift({name:"Any"})};a.jumpToServcieManagement=function(){app.TOOLS.jumpToPage("System_Config_Service_Management")};
var c=function(a,b,c){return a.protocol.match(/^(TCP|UDP|TCP_UDP|ALL)$/)?!0:!1};a.getTCPUDPService=function(){return p("filter")(a.model.services.service,c)};a.T_cellEdit=e.get("T_editWithNoFoucs_by_rowEditableState_objs.html");a.selected=a.selected||{};a.gridPortFW=a.gridPortFW||{};a.gridPortFW.Selections=[];a.gridPortFW.refresh=!0;a.gridUpnpPortFW=a.gridUpnpPortFW||{};a.gridUpnpPortFW.Selections=[];a.idTrue=!0;a.idFalse=!1;a.gridPortFW.procNgClick=function(b){a.gridPortFW.Selections=[];a.model["port-forwarding-rules"]&&
angular.forEach(a.model["port-forwarding-rules"]["port-forwarding-entry"],function(b,c){b.checked?a.gridPortFW.Selections.push(b):b.edit=!1})};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};var h=function(b){b=b.entity;var c;b.service_invalid_d=!1;b.invalid||(b.service_invalid=!1);b.status&&(c=v.check_port_forwarding_service(b.external_service.select),c.valid||(b.service_invalid_d=!0,b.service_invalid=!0,b=v.get_err_html(c.err),app.TOOLS.criticalAlertBox({title:a.DICT("Error"),
msg:b})))};a.gridPortFW.Options=app.uiGrid.generateGridOptions({IDPreifx:"portforwarding_table",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridPortFW.procNgClick,disableChkBoxField:"disableChk",headerChangedCbk:a.gridPortFW.procNgClick},{field:"status",displayName:a.DICT("Port_Forwarding_Enable"),width:70,editRow:"edit",cellTemplate:e.get("UG_table_checkbox_with_inline_edit.html"),changedCbk:function(a,b){h(b)}},{field:"external_service",displayName:a.DICT("Port_Forwarding_External_Service"),
editRow:"edit",invalidField:"service_invalid",customVldCbk:"gridPortFW.keyValidCbk",validationCbk:"gridInvalidCbk",cellTemplate:e.get("UG_table_text_with_inline_select_edit.html"),change:h,id:"portforwarding_table_exts",customVldGroup:"1"},{field:"internal_service",displayName:a.DICT("Port_Forwarding_Internal_Service"),editRow:"edit",cellTemplate:e.get("UG_table_text_with_inline_select_edit.html"),id:"portforwarding_table_ins"},{field:"ipaddress",displayName:a.DICT("Port_Forwarding_Internal_IP_Addr"),
validationCbk:"gridInvalidCbk",editRow:"edit",cellTemplate:e.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"required ipv4-ip"),required:!0,id:"portforwarding_table_ipaddr"},{field:"interface_t",displayName:a.DICT("Port_Forwarding_Interfaces"),editRow:"edit",invalidField:"invalid",customVldCbk:"gridPortFW.keyValidCbk",validationCbk:"gridInvalidCbk",cellTemplate:e.get("UG_table_text_with_inline_select_edit.html"),id:"portforwarding_table_infs"}]});a.gridUpnpPortFW.procNgClick=
function(b){a.gridUpnpPortFW.Selections=[];angular.forEach(a.model["upnp-port-forwarding-rules"]["upnp-port-forwarding-entry"],function(b,c){b.checked?a.gridUpnpPortFW.Selections.push(b):b.edit=!1})};a.gridUpnpPortFW.Options=app.uiGrid.generateGridOptions({IDPreifx:"upnpforwarding_table",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridUpnpPortFW.procNgClick},{field:"external-service",displayName:a.DICT("Port_Forwarding_External_Service")},{field:"internal-service",displayName:a.DICT("Port_Forwarding_Internal_Service")},
{field:"ipaddress",displayName:a.DICT("Port_Forwarding_Internal_IP_Addr")},{field:"interface",displayName:a.DICT("Port_Forwarding_Interfaces")},{field:"status",displayName:a.DICT("Port_Forwarding_Status"),cellTemplate:e.get("UG_table_checkbox_with_inline_edit.html")}]});a.gridUpnpPortFW.selRow=function(b,c){a.gridUpnpPortFW.operations.selRow(b,c)};a.gridPortFW.selRow=function(b,c){a.gridPortFW.operations.selRow(b,c)};a.gridPortFW.keyValidCbk=function(b,c,d){var h=a.gridPortFW.Options.data,e=h.length,
k,l;c=function(a,b,c){if(!(0>b||b>e))if(!(0>c||c>e))for(k=b;k<e;k++)if((l=h[k])&&l!==a&&l.external_service.select===a.external_service.select&&l.interface_t.select===a.interface_t.select)l.invalid=!0,a.invalid=!0,l.service_invalid=!0};angular.forEach(h,function(a){a.invalid=!1;a.service_invalid_d||(a.service_invalid=!1)});for(b=0;b<e;b++)h[b]&&c(h[b],b+1,b)};a.ifNamed=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};a.add=function(){if(100<=a.gridPortFW.Options.data.length)a.msg=
a.DICT("Port_Forwarding_Reach_Max_Entry",{"%d":100}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}});else{var b={checked:!0,invalid:!1,service_invalid_d:!1,service_invalid:!1,"external-service":"All Traffic","interface":"WAN1",ipaddress:"","internal-service":"All Traffic",edit:!0,status:!0,interface_t:{select:"WAN1",list:angular.copy(a.interfaces)},internal_service:{select:"All Traffic",list:angular.copy(a.services)},external_service:{select:"All Traffic",list:angular.copy(a.services)}};
a.gridPortFW.Options.data.push(b);a.gridPortFW.Options.gridApi.customApi.scrollTo(a.gridPortFW.Options.data.length-1);a.gridPortFW.keyValidCbk();a.modified()}};a.gridPortFW.post_remove_cb=function(b,c,d){u(function(){a.gridPortFW.refresh=!0},0)};a.gridPortFW.remove=function(){var b,c;a.gridPortFW.refresh=!1;void 0===a.model["port-forwarding-rules"]||void 0===a.model["port-forwarding-rules"]["port-forwarding-entry"]?(b=[],c=0):(b=a.model["port-forwarding-rules"]["port-forwarding-entry"],c=b.length);
for(c-=1;0<=c;c--)b[c].checked&&b.splice(c,1);u(function(){a.gridPortFW.refresh=!0},0);a.gridPortFW.keyValidCbk();a.modified()};a.gridPortFW.edit=function(){angular.forEach(a.gridPortFW.Options.data,function(a){a.checked&&(a.edit=!0)})};a.RPC_delete_upnp=function(){var b=function(a,b,c){a=c.code;switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");break;default:console.log(b+": RPC done. got unknown code: "+a)}},c,d=a.gridUpnpPortFW.Selections?a.gridUpnpPortFW.Selections.length:0,h={};
for(c=0;c<d;c++)h=a.gridUpnpPortFW.Selections[c]||{},m.RPC_generic_send("delete-upnp-rule",{"external-service":h["external-service"],"internal-service":h["internal-service"],ipaddress:h.ipaddress},b,void 0,s)};a.save=function(){var b=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){angular.isDefined(a.internal_service)&&(a["internal-service"]=a.internal_service.select,delete a.internal_service);angular.isDefined(a.external_service)&&(a["external-service"]=a.external_service.select,delete a.external_service);
angular.isDefined(a.interface_t)&&(a["interface"]=a.interface_t.select,delete a.interface_t);angular.isDefined(a.invalid)&&delete a.invalid;angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.edit)&&delete a.edit;angular.isDefined(a.disableChk)&&delete a.disableChk});return a}(a.model["port-forwarding-rules"]["port-forwarding-entry"]),c=function(){w.post({url:resource_base+"data/port_forwarding.json",method:"set_port_forwarding",params:{"port-forwarding-rules":{"port-forwarding-entry":b}},
success:function(b){a.success=!0;k();a.config_saved=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);k()}})};(function(){var b=a.model["port-forwarding-rules"]["port-forwarding-entry"],d=[],g;angular.forEach(a.origRules,function(a){g=!1;angular.forEach(b,function(b){a.external_service.select===b.external_service.select&&a.interface_t.select===b.interface_t.select&&(g=!0)});g||d.push({"external-service":a.external_service.select,"interface":a.interface_t.select})});
d.length?w.post({url:resource_base+"data/port_forwarding.json",method:"del_port_forwarding",params:{"port-forwarding-rules":{"port-forwarding-entry":d}},success:function(a){c()},error:function(a){c();console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}):c()})()};a.cancel=function(){k()}}]);app.controller("networkAddressTranslationCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,t,m){a.success=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var w=function(){b.post({url:resource_base+"data/wan_setting1.json",method:"get_nat",success:function(a){u(a.data.result)},error:function(a){u();console.log("networkAddressTranslationCtrl Error Status: "+a.status)}})},u=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var q=
[],e=[];a.model.ifs=[];angular.forEach(b,function(a,b){void 0===a.name||(void 0===a.nat||void 0===a.nat.enable)||(a.name.match(/^WAN\d+($|\.\d+$)/)&&q.push({edit:!0,name:a.name,nat:a.nat.enable,orig_nat:a.nat.enable}),a.name.match(/^USB\d+/)&&e.push({edit:!0,name:a.name,nat:a.nat.enable,orig_nat:a.nat.enable}))});a.model.ifs=q.concat(e);a.gridNATOptions.data=a.model.ifs;a.dataReady=!0};a.dataReady=!1;a.model={ifs:[]};a.fun={save:function(){var p={interfaces:{"interface":[]}},q=[];angular.forEach(a.model.ifs,
function(a,b){p.interfaces["interface"].push({name:a.name,nat:{enable:a.nat}});a.nat&&!a.orig_nat&&q.push({name:a.name,enabled:!1,passive:!0})});q.length&&b.post({method:"set_rip",params:{routing:{"routing-instance":[{name:"local","routing-protocols":{"routing-protocol":[{type:"ripv1",name:"rip",rip:{ripv1:{interfaces:{"interface":q}}}},{type:"ripv2",name:"rip",rip:{ripv2:{interfaces:{"interface":q}}}}]}}]}}});b.post({method:"set_nat",params:p,success:function(b){a.success=!0;w();a.resetModified()},
error:function(b){w();a.resetModified()}})},cancel:function(){w();a.resetModified()}};a.gridNATOptions=app.uiGrid.generateGridOptions({data:a.model.ifs,columnDefs:[{field:"name",displayName:a.DICT("Network_Address_Translation_Interface")},{field:"nat",displayName:a.DICT("Network_Address_Translation_Enable_NAT"),id:"nattable",cellTemplate:"UG_table_checkbox_with_inline_edit.html",editRow:"edit"}]});w()}]);app.controller("poeCtrl",["$scope","MyHttp","$q","$uibModal","UserSession","userAccessRight","modelInfo",function(a,b,t,m,w,u,p){a.success=!1;var q="";0<=p.get_pid().search("RV345P")&&(q="POE");a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var e=function(){return b.post({url:resource_base+"data/poe.json",method:"get_poe",error:function(a){Log(ERROR,"poeCtrl getPoESettingData error status: "+a.status);x()}})},x=function(b){var c=/^LAN(\d+)$/;b||(b={});var d=
[],g=b["global-poe-setting"]||{},h=[],e;a.model.poe_setting={legacy:void 0!==g.legacy?g.legacy:!1,snmp_trap_enable:void 0!==g["snmp-trap-enable"]?g["snmp-trap-enable"]:!1,power_mode:g["power-mode"]||"port-limit",power_trap_thread:g["power-trap-thread"]||95};a.model.ori_poe_setting=angular.copy(a.model.poe_setting);b.interfaces&&b.interfaces["interface"]&&(d=b.interfaces["interface"]);a.model.lans=[];angular.forEach(d,function(a,b){if(a.name&&a["poe-setting"]&&(e=c.exec(a.name)))b=parseInt(e[1],10),
isNaN(b)||(h[b]=n(a))});a.model.ori=[];angular.forEach(h,function(b,c){a.model.ori.push(b)});"POE"===q?angular.forEach(h,function(b,c){switch(c){case 1:case 2:case 3:case 4:case 9:case 10:case 11:case 12:a.model.lans.push(b)}}):angular.forEach(h,function(b,c){a.model.lans.push(b)});a.gridPortLimitOptions.data=a.model.lans;a.gridClassLimitOptions.data=a.model.lans},n=function(a){a||(a={});var b=a["poe-setting"]||{},c={name:a.name||"",enable:!1,type:"port-limit",priority:"low",administration_power_allocation:3E4,
state:v()};angular.forEach(b,function(a,b){switch(b){case "enable":c.enable=!0===a;break;case "class-limit":c.type="class-limit";break;case "administration-power-allocation":c.type="port-limit";c.administration_power_allocation=isNaN(parseInt(a,10))?3E4:parseInt(a,10);break;case "priority-level":c.priority=a;break;default:Log(INFO,"poeCtrl genPoEIntfSetting, no process leaf: "+b+" , value: "+a)}});c.state.enable=c.enable?"Enable":"Disable";return c},l=function(){return b.post({url:resource_base+"data/poe_state.json",
method:"get_poe_state",error:function(a){Log(ERROR,"poeCtrl getPoEStateData Error Status "+a.status);r()}})},r=function(b){b||(b={});var c=[],d=b["poe-state"]||{},g="";d.microsemi&&"vop"===d.microsemi["error-code"]&&(g="*");a.model.poe_state=[{operation_status:function(a){var b="";"normal"===a?b="Normal":"fault"===a&&(b="Fault");return b}(d["operation-status"])+g,nominal_power:(d["nominal-power"]||0)+"w",consumed_power:(d["consumed-power"]||0)+"w",allocated_power:(d["allocated-power"]||0)+"w",available_power:(d["available-power"]||
0)+"w"}];a.gridProperiesOptions.data=a.model.poe_state;b["interfaces-state"]&&b["interfaces-state"]["interface"]&&(c=b["interfaces-state"]["interface"]);a.model.poe_lan_state={};angular.forEach(c,function(b){b.name&&(a.model.poe_lan_state[b.name]=v(b))})},v=function(a){a||(a={});a=a["poe-state"]||{};return{administration_power_allocation:void 0!==a["administration-power-allocation"]?a["administration-power-allocation"]:0,"class":void 0!==a["class"]?a["class"]:0,max_power:void 0!==a["max-power"]?a["max-power"]:
0,consumed_power:void 0!==a["consumed-power"]?a["consumed-power"]:0,overload_counter:void 0!==a["overload-counter"]?a["overload-counter"]:0,absent_counter:void 0!==a["absent-counter"]?a["absent-counter"]:0,short_counter:void 0!==a["short-counter"]?a["short-counter"]:0,denied_counter:void 0!==a["denied-counter"]?a["denied-counter"]:0,invalid_signature_counter:void 0!==a["invalid-signature-counter"]?a["invalid-signature-counter"]:0,poe_standard:a["poe-standard"]||"802.3AT"}},s=function(){angular.forEach(a.model.lans,
function(b){a.model.poe_lan_state[b.name]&&angular.extend(b.state,a.model.poe_lan_state[b.name])})},k=function(){t.all([e(),l()]).then(function(b){x(b[0]&&b[0].data&&b[0].data.result);r(b[1]&&b[1].data&&b[1].data.result);s();a.dataReady=!0})},d={main:"main","class":"class",port:"port"},c=function(){m.open({animation:a.animationsEnabled,templateUrl:"edit_port_limit.htm",controller:"editPortClassCtrl",backdrop:"static",resolve:{model:function(){return a.model},edit:function(){return a.edit}}}).result.then(function(b){a.edit=
b;a.funs.apply("edit_port")},function(a){})},h=function(){m.open({animation:a.animationsEnabled,templateUrl:"edit_class_limit.htm",controller:"editPortClassCtrl",backdrop:"static",resolve:{model:function(){return a.model},edit:function(){return a.edit}}}).result.then(function(b){a.edit=b;a.funs.apply("edit_class")},function(a){})},g=function(){a.edit=angular.copy(a.model.lans[a.model.selectIdx]);a.edit.state.enable="Enable"===a.edit.state.enable?!0:!1;var b=a.edit;angular.forEach(a.model.lans[a.model.selectIdx],
function(a,c){b[c]=a})};w=function(b){a.model.selectIdx=b};a.dataReady=!1;a.currPage=d.main;a.schema={};a.model={selectIdx:-1,lans:[],poe_setting:{},poe_state:[],poe_lan_state:{},ori:[],ori_poe_setting:[]};a.gridApi={port_limit:null,class_limit:null,main:null};a.success=!1;a.edit={};a.gridProperiesOptions=app.uiGrid.generateGridOptions({minRowsToShow:1,enableSorting:!1,enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,onRegisterApi:function(b){a.gridApi.main=b},columnDefs:[{field:"operation_status",
displayName:a.DICT("PoE_Settings_Operational_Status")},{field:"nominal_power",displayName:a.DICT("PoE_Settings_Nominal_Power")},{field:"consumed_power",displayName:a.DICT("PoE_Settings_Consumed_Power")},{field:"allocated_power",displayName:a.DICT("PoE_Settings_Allocated_Power")},{field:"available_power",displayName:a.DICT("PoE_Settings_Available_Power")}]});a.gridPortLimitOptions=app.uiGrid.generateGridOptions({enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,onRegisterApi:function(b){a.gridApi.port_limit=
b},columnDefs:[{name:"radio",isRadio:!0,cellTemplate:"UGRadioSelectTemplate.html",width:25,changedCbk:w},{field:"name",displayName:a.DICT("PoE_Settings_Port_N")},{field:"enable",displayName:a.DICT("PoE_Settings_Enable"),editable:!0,cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"priority",displayName:a.DICT("PoE_Settings_Power_Priority_Level_N")},{field:"state.administration_power_allocation",displayName:a.DICT("PoE_Settings_Administrative_Power_Allocation_MW")},{field:"state.max_power",
displayName:a.DICT("PoE_Settings_Max_Power_Allocation_MW")},{field:"state.consumed_power",displayName:a.DICT("PoE_Settings_Power_Consumption_MW")},{field:"state.class",displayName:a.DICT("PoE_Settings_Class_N")}]});a.gridClassLimitOptions=app.uiGrid.generateGridOptions({enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,onRegisterApi:function(b){a.gridApi.class_limit=b},columnDefs:[{name:"radio",isRadio:!0,cellTemplate:"UGRadioSelectTemplate.html",width:25,changedCbk:w},{field:"name",displayName:a.DICT("PoE_Settings_Port_N")},
{field:"enable",displayName:a.DICT("PoE_Settings_Enable"),editable:!0,cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"priority",displayName:a.DICT("PoE_Settings_Power_Priority_Level_N")},{field:"state.max_power",displayName:a.DICT("PoE_Settings_Max_Power_Allocation_MW")},{field:"state.consumed_power",displayName:a.DICT("PoE_Settings_Power_Consumption_MW")},{field:"state.class",displayName:a.DICT("PoE_Settings_Class_N")}]});a.funs={goTo:function(b){d[b]?(a.success=!1,a.currPage=d[b]):
a.currPage=d.main},apply:function(c){var d,g,h,e,l=a.DICT("PoE_Settings_Confirm"),s=function(){switch(c){case "main":d=[];h={};angular.forEach(a.model.lans,function(a){h[a.name]=a});"class-limit"===a.model.poe_setting.power_mode?angular.forEach(a.model.ori,function(a){e={name:a.name,"poe-setting":{"class-limit":null}};h[a.name]&&(e["poe-setting"].enable=h[a.name].enable);d.push(e)}):angular.forEach(a.model.ori,function(a){e={name:a.name,"poe-setting":{"administration-power-allocation":a.administration_power_allocation}};
h[a.name]&&(e["poe-setting"].enable=h[a.name].enable);d.push(e)});g={"global-poe-setting":{legacy:a.model.poe_setting.legacy,"snmp-trap-enable":a.model.poe_setting.snmp_trap_enable,"power-mode":a.model.poe_setting.power_mode,"power-trap-thread":a.model.poe_setting.power_trap_thread},interfaces:{"interface":d}};break;case "edit_port":"class-limit"===a.model.ori_poe_setting.power_mode?(d=[],angular.forEach(a.model.ori,function(b){b.name===a.edit.name?d.push({name:a.edit.name,"poe-setting":{enable:a.edit.enable,
"administration-power-allocation":a.edit.administration_power_allocation,"priority-level":a.edit.priority}}):d.push({name:b.name,"poe-setting":{enable:b.enable,"administration-power-allocation":b.administration_power_allocation}})}),g={"global-poe-setting":{"power-mode":"port-limit"},interfaces:{"interface":d}}):(d=[],angular.forEach(a.model.lans,function(b){b.name===a.edit.name?d.push({name:a.edit.name,"poe-setting":{enable:a.edit.enable,"administration-power-allocation":a.edit.administration_power_allocation,
"priority-level":a.edit.priority}}):d.push({name:b.name,"poe-setting":{enable:b.enable}})}),g={interfaces:{"interface":d}});break;case "edit_class":"port-limit"===a.model.ori_poe_setting.power_mode?(d=[],angular.forEach(a.model.ori,function(b){b.name===a.edit.name?d.push({name:a.edit.name,"poe-setting":{enable:a.edit.enable,"class-limit":null,"priority-level":a.edit.priority}}):d.push({name:b.name,"poe-setting":{"class-limit":null,enable:b.enable}})}),g={"global-poe-setting":{"power-mode":"class-limit"},
interfaces:{"interface":d}}):(d=[],angular.forEach(a.model.lans,function(b){b.name===a.edit.name?d.push({name:a.edit.name,"poe-setting":{enable:a.edit.enable,"class-limit":null,"priority-level":a.edit.priority}}):d.push({name:b.name,"poe-setting":{enable:b.enable}})}),g={interfaces:{"interface":d}})}g&&b.post({url:resource_base+"data/poe.json",method:"set_poe",params:g,success:function(b){a.success=!0;k();a.resetModified()},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url);
k()}})};a.model.poe_setting.power_mode!==a.model.ori_poe_setting.power_mode?app.TOOLS.warningAlertBox({msg:l,cbk:function(b){b?s():a.model.poe_setting.power_mode=a.model.ori_poe_setting.power_mode}}):s()},cancel:function(b){a.currPage=d.main;k();a.resetModified()},edit:function(b){a.success=!1;"port"==b?(g(),c()):"class"==b&&(g(),h())}};a.switchRadio=function(){a.model.selectIdx=-1};a.schema={power_mode:[{id:"port-limit",displayName:a.DICT("PoE_Settings_Port_Limit")},{id:"class-limit",displayName:a.DICT("PoE_Settings_Class_Limit")}]};
k()}]);app.controller("editPortClassCtrl",["$scope","$uibModalInstance","model","edit",function(a,b,t,m){a.model=t;a.edit=m;a.funs={save:function(){b.close(a.edit)},cancel:function(){b.dismiss("cancel")}}}]);app.controller("lan_dns_db_main",["$scope","$rootScope","$log","MyHttp","$http","ngGridCellBuilder","GridRowBasedEditingAdv","$templateCache","UserSession","userAccessRight","Sets",function(a,b,t,m,w,u,p,q,e,x,n){a.model={dns:{dns:[]}};a.success=!1;a.loadReady=!1;a.userAccessFlag=x.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();var l=function(){m.post({url:resource_base+"data/lan_dns_db.json",method:"get_dns_db",success:function(b){r(b);a.loadReady=!0},error:function(b){console.log("AJAX loading error: "+
b.status+", URL: "+b.config.url);a.loadReady=!0}});a.resetModified()};l();var r=function(b){angular.extend(a.model,b.data.result);a.model.dns||angular.extend(a.model,{dns:{enable:!1,dns:[]}});a.model.dns&&!a.model.dns.dns&&angular.extend(a.model.dns,{dns:[]});a.use_dns_sample={edit:!1,invalid:!1,host:"",ip:"",checked:!1};angular.forEach(a.model.dns.dns,function(b){n.recover_object(b,a.use_dns_sample)});a.gridDNSDB.Options.data=a.model.dns.dns;a.model_orig=angular.copy(a.model)};a.gridDNSDB=a.gridDNSDB||
{};a.gridDNSDB.Selections=[];a.gridDNSDB.procNgClick=function(b){a.gridDNSDB.Selections=[];angular.forEach(a.model.dns.dns,function(b,e){b.checked?a.gridDNSDB.Selections.push({rowIndex:e,entity:b}):b.edit=!1})};a.checkHostNameIsRepeat=function(){var b=a.model.dns.dns,e=b.length,k,d;angular.forEach(b,function(a){a.invalid=!1});for(k=0;k<e;k++)for(d=k+1;d<e;d++)b[k].host===b[d].host&&(b[k].invalid=!0,b[d].invalid=!0)};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridDNSDB.Options=
app.uiGrid.generateGridOptions({IDPreifx:"DNSLocalDB",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridDNSDB.procNgClick,disableChkBoxField:"disableChk",headerChangedCbk:a.gridDNSDB.procNgClick},{field:"host",displayName:a.DICT("DNS_Local_Database_Host_Name"),id:"DNSLocalDBHostName",validationCbk:"gridInvalidCbk",customVldCbk:"checkHostNameIsRepeat",editRow:"edit",invalidField:"invalid",required:!0,cellTemplate:q.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/g,'required host-name-num maxlength="63"')},
{field:"ip",displayName:a.DICT("DNS_Local_Database_Addr"),id:"DNSLocalDBIP",validationCbk:"gridInvalidCbk",cellTemplate:q.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/g,"required ip "),editRow:"edit",required:!0}]});a.gridDNSDB.add=function(){var b=a.model.dns.dns,e;100<=b.length?(b=a.DICT("DNS_Local_Reach_Max_Entry",{"%d":100}),app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})):(e={checked:!1,edit:!1,invalid:!1,host:"",ip:"",checked:!0,edit:!0},b.push(e),a.gridDNSDB.Options.gridApi.customApi.scrollToLast(),
a.modified())};a.gridDNSDB.edit=function(){angular.forEach(a.model.dns.dns,function(a){a.checked&&(a.edit=!0)})};a.gridDNSDB.del=function(){var b=a.model.dns.dns,e;if(b){e=b.length;for(e-=1;0<=e;e--)b[e].checked&&b.splice(e,1);a.checkHostNameIsRepeat();a.modified()}};a.save=function(){var b=[],e=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableChk)&&delete a.disableChk;delete a.edit;delete a.invalid});return a};
(function(){var e=a.model.dns.dns,d=!1,c=[];angular.forEach(a.model_orig.dns.dns,function(a){d=!1;angular.forEach(e,function(b){b.host===a.host&&(d=!0)});d||c.push({host:a.host})});c.length&&b.push({method:"del_dns_db",params:{dns:{dns:c}}})})();(function(){var k=e(a.model.dns.dns);b.push({method:"set_dns_db",params:{dns:{dns:k}}})})();m.post({url:resource_base+"data/lan_dhcp_static.json",method:"set_bulk",params:b,success:function(b){a.success=!0;l()},error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url);l()}})};a.cancel=function(){l()}}]);app.controller("lan_dhcp_settings_main",["$scope","$rootScope","$uibModal","$log","$q","MyHttp","GridRowBasedEditingAdv","$templateCache","$filter","Sets","$timeout","UserSession","userAccessRight",function(a,b,t,m,w,u,p,q,e,x,n,l,r){var v={source:"http",getResult:function(a,b,c){return x.getResult(this,a,b,c)}};a.model=a.model||{};a.ctx=a.ctx||{};a.fns=a.fns||{};a.success=!1;a.loadReady=!1;a.subnetObj={};a.spec=a.spec||{OPENDNS_SUPPORT:!0};a.userAccessFlag=r.get();"RW"!==a.userAccessFlag&&"RO"!==
a.userAccessFlag&&l.logout();var s=function(){var a=w.defer(),b={interfaces:{"interface":[]},"dhcp-pool":{"dhcp-interfaces":[],"dhcp-option82":[]},"dhcp-pools":{pool:[]}};u.post({url:resource_base+"data/lan_dhcp_settings.json",method:"get_dhcp_settings",success:function(c){x.default_result(c,b);a.resolve(c)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});return a.promise},k=function(){var a=w.defer(),b={"dns-servers":{ipv4:[]}};u.post({url:resource_base+"data/dns_from_isp.json",
method:"get_dns_from_isp",success:function(c){x.default_result(c,b);a.resolve(c)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});return a.promise},d=function(){var a=w.defer(),b={subnets:{ipv4:[],ipv6:[]}};u.post({url:resource_base+"data/get_subnet.json",method:"get_subnet",success:function(c){x.default_result(c,b);a.resolve(c)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});return a.promise},c=function(){var b=w.defer(),
c={opendns:{enabled:!1,v4dnsip:["208.67.222.222","208.67.220.220"]}};if(!0!==a.spec.OPENDNS_SUPPORT)return b.resolve(c),b.promise;u.post({url:resource_base+"data/opendns.json",method:"get_opendns",success:function(a){x.default_result(a,c);b.resolve(a)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});return b.promise},h=function(){w.all({DHCPSettings:s(),StateDns:k(),StateSubnet:d(),OpenDNS:c()}).then(function(b){var c=v.getResult(b.DHCPSettings,"interfaces");
a.model.interfaces={"interface":c["interface"]};c=v.getResult(b.DHCPSettings,"dhcp-pool");a.model["dhcp-pool"]={"dhcp-interfaces":c["dhcp-interfaces"],"dhcp-option82":c["dhcp-option82"]};c=v.getResult(b.DHCPSettings,"dhcp-pools");a.model["dhcp-pools"]={pool:c.pool};c=v.getResult(b.StateDns,"dns-servers");a.model["dns-servers"]={ipv4:c.ipv4,ipv6:c.ipv6};c=v.getResult(b.StateSubnet,"subnets");c&&(c.ipv4&&c.ipv6)&&(a.subnetObj=angular.copy(c));b=v.getResult(b.OpenDNS,"opendns");a.model.opendns={enabled:b.enabled,
v4dnsip:b.v4dnsip};g();a.schema=a.schema||{};A();a.model_del["dhcp-pool"]["dhcp-interfaces"].splice(0);a.model_del["dhcp-pool"]["dhcp-option82"].splice(0);a.model_del["dhcp-pools"].pool.splice(0);delete a.model_del.interfaces;delete a.model_del.dhcp_ref;a.gridDHCP.Selections=[];a.gridDHCP.Options.data=a.model.dhcp_ref;a.loadReady=!0})["catch"](function(a){console.log("=="+a)})},g=function(){a.use_dhcp_pool_sample={"dhcp-pool":{"dhcp-interfaces":[],"dhcp-option82":[]}};x.recover_object(a.model,a.use_dhcp_pool_sample);
a.use_dhcp_pools_sample={"dhcp-pools":{pool:[]}};x.recover_object(a.model,a.use_dhcp_pools_sample);if(a.model["dhcp-pools"]){var b=function(b){angular.forEach(a.model["dhcp-pools"].pool,function(a,c){a[b].dns&&!a[b].dns["static-dns-servers"]?angular.extend(a[b].dns,{"static-dns-servers":[]}):a[b].dns||(a[b].dns={"static-dns-servers":[]});a[b]["dhcp-mode"]||(a[b]["dhcp-mode"]="disable");a[b]["dns-server-type"]||(a[b]["dns-server-type"]="dns-server-proxy");"ipv4"===b&&!a[b]["network-boot"]&&(a[b]["network-boot"]=
{enabled:!1,"next-server":"","boot-file":""})})};b("ipv4");b("ipv6")}a.use_dns_from_isp_sample={"dns-servers":{ipv4:[]}};x.recover_object(a.model,a.use_dns_from_isp_sample);a.ctx.dnsFromIspRef=a.model["dns-servers"]},A=function(){var b=function(a){if(a["subnet-mask"]){var b=a["subnet-mask"].split("/")[1],b=app.TOOLS.netmask.int2Inet(parseInt(b,10));a._ctx_netmask=b}},c=app.TOOLS.sortingDHCPInterfaceFn(!1),d=a.model["dhcp-pool"]["dhcp-interfaces"],d=d.sort(c);a.model.dhcp_ref=[];angular.forEach(d,
function(b,c){angular.forEach(a.model["dhcp-pools"].pool,function(c,d){b["server-mode"]["dhcp-pool"]==c["pool-id"]&&(b._poolref=a.model["dhcp-pools"].pool[d])});b.iftype=6;b.checked=!1;a.model.dhcp_ref.push(b)});angular.forEach(a.model["dhcp-pool"]["dhcp-option82"],function(c,d){angular.forEach(a.model["dhcp-pools"].pool,function(b,d){c["dhcp-pool"]==b["pool-id"]&&(c._poolref=a.model["dhcp-pools"].pool[d])});b(c);c.iftype=7;c.checked=!1;a.model.dhcp_ref.push(c)});a.model_orig=angular.copy(a.model);
a.model_del=angular.copy(a.model)},y=function(a,b,c){return a.name.match(/^(VLAN)/)?!0:!1};a.fns.collect_VLAN_list=function(){return e("filter")(a.model.interfaces["interface"],y)};a.fns.refreshInuseVLANList=function(){a.ctx.inuseVLANList=[];angular.forEach(a.model["dhcp-pool"]["dhcp-interfaces"],function(b,c){a.ctx.inuseVLANList.push(b["interface"])})};a.fns.collect_unused_VLAN_list=function(b){var c;b&&b.sel_if&&(c=b.sel_if);var d=a.fns.collect_VLAN_list()||[];b=d;b=e("filter")(d,function(b,d,g){a.ctx.inuseVLANList||
a.fns.refreshInuseVLANList();return!(c&&b.name==c)&&a.ctx.inuseVLANList&&-1<a.ctx.inuseVLANList.indexOf(b.name)?!1:!0});d=app.TOOLS.sortingInterfaceFn(!1);return b=b.sort(d)};a.getVLANref=function(b){var c=a.fns.collect_VLAN_list(),d;angular.forEach(c,function(a,c){a.name==b&&(d=a)});return d};a.displayPrefixLen=function(b,c){var d="";if(6==b.iftype){var g=a.getVLANref(b["interface"]);g&&(g[c]&&g[c].address&&g[c].address[0]&&g[c].address[0]["prefix-length"])&&(d=g[c].address[0]["prefix-length"])}else b["subnet-mask"]&&
(d=b["subnet-mask"].split("/")[1]);return d};a.displayDNS=function(b,c){var d="",g=b.iftype,h=b._poolref[c]["dns-server-type"];if("dns-server-proxy"==h)if(6==g){if((g=a.getVLANref(b["interface"]))&&g[c]&&g[c].address&&g[c].address[0]&&g[c].address[0].ip)d=g[c].address[0].ip}else d=b["ip-address"];else"dns-server-provided-isp"==h?a.ctx.dnsFromIspRef&&(a.ctx.dnsFromIspRef[c]&&"function"==typeof a.ctx.dnsFromIspRef[c].join)&&(d=a.ctx.dnsFromIspRef[c].join(" ")):d=b._poolref[c].dns["static-dns-servers"].join(" ");
return d};a.fns.reachDHCPmaxcount=function(){var b=0,b=a.model["dhcp-pool"]["dhcp-interfaces"].length;return 32<=b?!0:!1};a.fns.reachOpt82maxcount=function(){var b=0,b=a.model["dhcp-pool"]["dhcp-option82"].length;return 50<=b?!0:!1};var z=function(){return a.fns.reachDHCPmaxcount()&&a.fns.reachOpt82maxcount()?(a.msg="Only allow maximum of Option82(50 entries) and DHCP(32 entries) for LAN/DHCP Settings.",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.selected=a.selected||{};a.gridDHCP=
a.gridDHCP||{};a.gridDHCP.Selections=[];a.gridDHCP.add=function(){z()||a.open(["",""])};a.gridDHCP.edit=function(){var b;angular.forEach(a.model.dhcp_ref,function(a,c){a.checked&&(b=c)});_.isNumber(b)?a.open(["",b]):Log(ERROR,"[LAN][DHCP Settings] edit item get error for checked index")};a.gridDHCP.procNgClick=function(b){a.gridDHCP.Selections=[];angular.forEach(a.model.dhcp_ref,function(b,c){b.checked&&a.gridDHCP.Selections.push(b)})};a.gridDHCP.Options=app.uiGrid.generateGridOptions({IDPreifx:"lanDHCP",
rowHeight:2*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridDHCP.procNgClick,headerChangedCbk:a.gridDHCP.procNgClick},{field:"interface",displayName:a.DICT("LAN_DHCP_Settings_Interface_Circuit_ID"),minWidth:320,cellTemplate:q.get("UG_Interface_CircuitID.htm")},{field:"_poolref",displayName:a.DICT("LAN_DHCP_Settings_DHCP_Mode"),minWidth:220,cellTemplate:q.get("UG_DHCP_mode.htm")},{field:"_poolref",displayName:a.DICT("LAN_DHCP_Settings_Range_Relay_Server"),cellTemplate:q.get("UG_IP_Range.htm")}]});
a.gridDHCP.remove=function(){var b=a.model.dhcp_ref,c=a.model["dhcp-pool"]["dhcp-interfaces"],d=a.model["dhcp-pool"]["dhcp-option82"],g=a.model["dhcp-pools"].pool,h=b.length,e;a.gridDHCP.Selections=[];for(h-=1;0<=h;h--)if(b[h].checked){if(void 0!==b[h]["interface"]){for(e=c.length-1;0<=e;e--)b[h]["interface"]===c[e]["interface"]&&c.splice(e,1);for(e=g.length-1;0<=e;e--)b[h]._poolref["pool-id"]===g[e]["pool-id"]&&g.splice(e,1)}if(void 0!==b[h]["circuit-id"]){for(e=d.length-1;0<=e;e--)b[h]["circuit-id"]===
d[e]["circuit-id"]&&d.splice(e,1);for(e=g.length-1;0<=e;e--)b[h]._poolref["pool-id"]===g[e]["pool-id"]&&g.splice(e,1)}b.splice(h,1)}a.fns.refreshInuseVLANList();a.modified()};a.showIPRange=function(a,b,c){c=["ipv4","ipv6"][c];if(!a)return"err";if("server"==a[c]["dhcp-mode"])return(a[c]["range-start"]||"")+"-"+(a[c]["range-end"]||"");if("relay"==a[c]["dhcp-mode"]){var d;b.entity&&(b.entity["relay-mode"]&&b.entity["relay-mode"]["relay-ipv4-address"])&&(d=b.entity["relay-mode"]["relay-ipv4-address"]);
return d||"(Relay IP undefined)"}return""};a.save=function(){function b(a){a=angular.copy(a);var c,d,g;angular.forEach(a,function(a,b){if(6==a.iftype){c="description circuit-id bitmask ip-address subnet-mask dhcp-pool".split(" ");for(d=0;d<c.length;d++)for(g in a)g==c[d]&&delete a[g]}else if(7==a.iftype){c=["interface","server-mode","relay-mode"];for(d=0;d<c.length;d++)for(g in a)g==c[d]&&delete a[g];angular.isDefined(a.bitmask)||(a.bitmask="")}a._poolref&&(a._poolref=void 0);a.iftype&&(a.iftype=
void 0);a._ctx_netmask&&(a._ctx_netmask=void 0);angular.isDefined(a.checked)&&delete a.checked});return a}var c=b(a.model["dhcp-pool"]["dhcp-interfaces"]),d=b(a.model["dhcp-pool"]["dhcp-option82"]),g=angular.copy(a.model["dhcp-pools"].pool);angular.forEach(g,function(a){a.ipv4["network-boot"].enabled||(a.ipv4["network-boot"]["boot-file"]="",a.ipv4["network-boot"]["next-server"]="")});var e=function(){u.post({url:resource_base+"data/lan_dhcp_settings.json",method:"set_dhcp_settings",params:{"dhcp-pool":{"dhcp-interfaces":c,
"dhcp-option82":d},"dhcp-pools":{pool:g}},success:function(b){a.success=!0;Log(DEBUG,"set_data() is ok, then getting up-to-date model data");a.config_saved=!0;h()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);console.log("Commnucation error: action set aborted");alert("Commnucation error: Action set aborted")}})};(function(){var b=a.model["dhcp-pool"]["dhcp-interfaces"],c=a.model["dhcp-pool"]["dhcp-option82"],d=a.model_orig["dhcp-pool"]["dhcp-option82"],g=
a.model["dhcp-pools"].pool,h=a.model_orig["dhcp-pools"].pool,k,l=!1,z={},y=[],s=[],B=[];angular.forEach(a.model_orig["dhcp-pool"]["dhcp-interfaces"],function(a){k=!1;angular.forEach(b,function(b){a["interface"]===b["interface"]&&(k=!0)});k||y.push({"interface":a["interface"]})});angular.forEach(d,function(a){k=!1;angular.forEach(c,function(b){console.log(a["circuit-id"]+" "+b["circuit-id"]);a["circuit-id"]===b["circuit-id"]&&(k=!0)});k||(console.log("---"),s.push({"circuit-id":a["circuit-id"]}))});
angular.forEach(h,function(a){k=!1;angular.forEach(g,function(b){a["pool-id"]===b["pool-id"]&&(k=!0)});k||B.push({"pool-id":a["pool-id"]})});if(y.length||s.length)z["dhcp-pool"]={},y.length&&(z["dhcp-pool"]["dhcp-interfaces"]=y),s.length&&(z["dhcp-pool"]["dhcp-option82"]=s),l=!0;B.length&&(z["dhcp-pools"]={pool:B},l=!0);l?u.post({url:resource_base+"data/lan_dhcp_settings.json",method:"del_dhcp_settings",params:z,success:function(a){n(function(){e()},50)},error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url);console.log("Commnucation error: action del aborted");alert("Commnucation error: Action del aborted")}}):e()})();a.resetModified()};a.cancel=function(){h();a.resetModified()};a.open=function(b){t.open({templateUrl:"modal_dhcp_edit.htm",controller:"DHCP_ModalInstanceCtrl",size:b[0],windowClass:"large-Modal",backdrop:"static",resolve:{model:function(){return a.model},index:function(){return b[1]},subnetObj:function(){return a.subnetObj},fns:function(){return a.fns}}}).result.then(function(b){a.model=
b[0];a.modified()},function(){m.info("Modal dismissed at: "+new Date)})};h()}]);
app.controller("DHCP_ModalInstanceCtrl",["$scope","$uibModalInstance","model","index","dhcpEditService","UserSession","userAccessRight","addressPoolValidate","subnetObj","fns","$timeout",function(a,b,t,m,w,u,p,q,e,x,n){a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();a.selected=a.selected||{};a.selected.tabid=0;a.selected.show_ok_btn=!1;a.selected.show_back_btn=!1;a.selected.is_edit=!1;a.data_ready=!1;a.subnetObj=e||{};a.fns=x||{};a.foucs_tab=function(b){a.selected.tabid=
b;a.selected.save=a.tabs[b].savecb;a.selected.chk_page_operator_btn()};a.selected.ok=function(){if(!a.selected.save())return 0;b.close([a.model]);return!0};a.selected.chk_page_operator_btn=function(){a.selected.show_ok_btn=!1;a.selected.show_back_btn=!0;var b=a.selected.dhcp.iftype;switch(a.selected.tabid){case 0:a.selected.show_back_btn=!1;break;case 1:a.selected.is_edit&&(a.selected.show_back_btn=!1);break;case 2:7===b&&(a.selected.show_ok_btn=!0);break;case 3:6===b&&"server"!=a.selected.dhcp._poolref.ipv6["dhcp-mode"]&&
(a.selected.show_ok_btn=!0);break;case 4:a.selected.show_ok_btn=!0}};a.selected.next=function(){var b=a.selected.tabid,e=a.selected.dhcp.iftype,n;n=b+1;switch(b){case 1:6===e&&"server"!==a.selected.dhcp._poolref.ipv4["dhcp-mode"]&&(n=b+2)}a.tabs[n].active=!0;a.foucs_tab(n)};a.selected.back=function(){var b=a.selected.tabid,e=a.selected.dhcp.iftype,n;n=b-1;switch(b){case 3:6===e&&"server"!==a.selected.dhcp._poolref.ipv4["dhcp-mode"]&&(n=b-2)}a.tabs[n].active=!0;a.foucs_tab(n)};a.selected.post_save=
function(){b.close([a.model])};a.update_subnet_mask=function(){var b=app.TOOLS.netmask.inet2Int(a.selected.dhcp._ctx_netmask);a.selected.dhcp["subnet-mask"]="0.0.0.0/"+b};a.hideByDNSType=function(a,b){return a.dhcp._poolref&&a.dhcp._poolref[b]&&("dns-server-provided-isp"==a.dhcp._poolref[b]["dns-server-type"]||"dns-server-proxy"==a.dhcp._poolref[b]["dns-server-type"])?!0:!1};a.fns.checkIfVLANExistFn=function(b){if(!arguments.length){var e=void 0,n=a.fns.collect_unused_VLAN_list({sel_if:a.selected.dhcp["interface"]})||
[];angular.forEach(n,function(b,k){b.name==a.selected.dhcp["interface"]&&(e="VLAN name exist")});return e}};a.cancel=function(){b.dismiss("cancel")};a.poolValidation=function(){var b=!0;a.tabs[2].form["range-start"].$setValidity("range",!0);a.tabs[2].form["range-end"].$setValidity("range",!0);a.tabs[2].form["range-start"].$setValidity("subnet",!0);a.tabs[2].form["range-end"].$setValidity("subnet",!0);Log(DEBUG," $scope.selected.dhcp.iftype   "+a.selected.dhcp.iftype);if(6===a.selected.dhcp.iftype){if(void 0===
a.selected.dhcp["interface"]||""===a.selected.dhcp["interface"]||void 0===a.selected.dhcp._poolref.ipv4["range-start"]||void 0===a.selected.dhcp._poolref.ipv4["range-end"]||""===a.selected.dhcp._poolref.ipv4["range-start"]||""===a.selected.dhcp._poolref.ipv4["range-end"])return!0;b=q.compareIpRange(a.selected.dhcp._poolref.ipv4["range-start"],a.selected.dhcp._poolref.ipv4["range-end"]);!1===b?(a.tabs[2].form["range-start"].$setValidity("range",!1),a.tabs[2].form["range-end"].$setValidity("range",
!1)):(b=q.poolValidateInRange("interfaces",a.selected.dhcp["interface"],"ipv4",a.subnetObj,a.selected.dhcp._poolref.ipv4["range-start"],a.selected.dhcp._poolref.ipv4["range-end"]),!1===b&&(a.tabs[2].form["range-start"].$setValidity("subnet",!1),a.tabs[2].form["range-end"].$setValidity("subnet",!1)))}else{if(void 0===a.selected.dhcp._poolref.ipv4["range-start"]||void 0===a.selected.dhcp._poolref.ipv4["range-end"]||""===a.selected.dhcp._poolref.ipv4["range-start"]||""===a.selected.dhcp._poolref.ipv4["range-end"])return!0;
b=q.compareIpRange(a.selected.dhcp._poolref.ipv4["range-start"],a.selected.dhcp._poolref.ipv4["range-end"]);!1===b&&(a.tabs[2].form["range-start"].$setValidity("range",!1),a.tabs[2].form["range-end"].$setValidity("range",!1))}return b};a.poolValidationV6=function(){var b=!0;a.tabs[4].form["range-start"].$setValidity("range",!0);a.tabs[4].form["range-end"].$setValidity("range",!0);a.tabs[4].form["range-start"].$setValidity("subnet",!0);a.tabs[4].form["range-end"].$setValidity("subnet",!0);if(void 0===
a.selected.dhcp._poolref.ipv6["range-start"]||void 0===a.selected.dhcp._poolref.ipv6["range-end"]||""===a.selected.dhcp._poolref.ipv6["range-start"]||""===a.selected.dhcp._poolref.ipv6["range-end"])return!0;b=q.compareIpRangeV6(a.selected.dhcp._poolref.ipv6["range-start"],a.selected.dhcp._poolref.ipv6["range-end"]);!1===b?(a.tabs[4].form["range-start"].$setValidity("range",!1),a.tabs[4].form["range-end"].$setValidity("range",!1)):(b=q.poolValidateInRangeV6("interfaces",a.selected.dhcp["interface"],
"ipv6",a.subnetObj,a.selected.dhcp._poolref.ipv6["range-start"],a.selected.dhcp._poolref.ipv6["range-end"]),!1===b&&(a.tabs[4].form["range-start"].$setValidity("subnet",!1),a.tabs[4].form["range-end"].$setValidity("subnet",!1)));return b};null!==m&&(a.model=t,m=parseInt(m));n(function(){var b=0;isNaN(m)||(a.selected.is_edit=!0,b=1);a.tabs[b].active=!0;a.foucs_tab(b);a.data_ready=!0},10);w.setModelSource(t);w.setSelectedSource(a,a.selected);w.run(m)}]);
app.controller("lan_dhcp_settings_dialog",["$scope",function(a){Log(DEBUG,"== Dialog");a.bitmask_len=0;a.bitmask_invalid=!1;a.selected.t_cid_mode=[{id:"ASCII"},{id:"HEX"}];a.selected.cid_mode=a.selected.t_cid_mode[0].id;a.fill_up_bitmask=function(b,t){b=b||"";var m=0;"HEX"===a.selected.cid_mode&&(t?(a.selected.dhcp["circuit-id"]="0x",m=0):(m=b&&b.length?b.length-2:0,0>m&&(m=0)),a.bitmask_len=m);a.selected.dhcp.bitmask=Array(m+1).join("F");a.chk_bitmask_len()};a.chk_bitmask_len=function(){if(a.tabs||
a.tabs[0])a.bitmask_invalid=!1,a.tabs[0].invalid=!1,"HEX"===a.selected.cid_mode&&(a.selected.dhcp.bitmask&&a.selected.dhcp.bitmask.length!==a.bitmask_len)&&(a.bitmask_invalid=!0,a.tabs[0].invalid=!0)};a.selected.t_dns_server_type=[{id:"dns-server-static",displayName:"dns-server-static"},{id:"dns-server-provided-isp",displayName:"dns-server-provided-isp"},{id:"dns-server-proxy",displayName:"dns-server-proxy"}];a.selected.t_dns_mode=[{id:"manual"},{id:"auto"}]}]);
app.service("dhcpEditService",function(){var a,b={};this.setModelSource=function(b){a=b};this.setSelectedSource=function(a,m){b=a;b.selected=m||{}};this.run=function(t){if(isNaN(t)){var m=function(){for(var b=1,e=1,x=0,n;x<a.dhcp_ref.length;x++)n=a.dhcp_ref[x],6==n.iftype?e=parseInt(n["server-mode"]&&n["server-mode"]["dhcp-pool"])||1:7==n.iftype&&(e=parseInt(n["dhcp-pool"])||1),b<e&&(b=e);for(x=0;x<a["dhcp-pools"].pool.length;x++)n=a["dhcp-pools"].pool[x],e=parseInt(n["pool-id"])||1,b<e&&(b=e);return parseInt(b)+
1}();console.assert(m,"newpoolid undefined");var w=void 0,u=b.fns.collect_unused_VLAN_list();u&&(u[0]&&u[0].name)&&(w=u[0].name);u=b.fns.reachDHCPmaxcount()?7:6;b.selected.dhcp=angular.extend({},{"interface":w,"circuit-id":"","server-mode":{"dhcp-pool":m},"relay-mode":{"relay-ipv4-address":"","relay-ipv6-address":""},"dhcp-pool":m,checked:!0,iftype:u,_poolref:{"pool-id":m,ipv4:{"lease-time":1440,"dns-server-type":"dns-server-proxy",dns:{"static-dns-servers":[]},"dhcp-mode":"server","range-start":"",
"range-end":"","wins-server":"","network-boot":{enabled:!1,"next-server":"","boot-file":""},"dhcp-options":{option43:"",option66:"",option67:"",option150:""}},ipv6:{"lease-time":1440,"dns-server-type":"dns-server-proxy","dhcp-mode":"disable",dns:{"static-dns-servers":[]},"range-start":"","range-end":""}}})}else b.selected.dhcp=angular.copy(a.dhcp_ref[t]);b.selected.index=t;b.selected.iftype_desc_t={6:"IPv4",7:"Option 82"};b.selected.iftype_desc=function(){return b.selected.iftype_desc_t[b.selected.dhcp.iftype]};
var p=function(a,e){var x=b.selected.dhcp["dhcp-pool"]||b.selected.dhcp["server-mode"]["dhcp-pool"],n=b.selected.dhcp.iftype,l=-1;void 0==x&&console.log("error: dhcp_poolid="+x);angular.forEach(a,function(a,b){6==n&&x&&x==a["dhcp-pool"]?l=b:7==n&&(x&&x==a["server-mode"]["dhcp-pool"])&&(l=b)});if(-1<l){var r=a.splice(l,1);e.push(r[0])}};b.selected.step1_next=function(){Log(DEBUG,"== step1_next");var q=b.selected.dhcp["dhcp-pool"];void 0==q&&b.selected.dhcp["server-mode"]&&(q=b.selected.dhcp["server-mode"]["dhcp-pool"]);
b.selected.dhcp["dhcp-pool"]=q;switch(b.selected.dhcp.iftype){case 6:b.selected.dhcp["circuit-id"]="";b.selected.dhcp["server-mode"]=b.selected.dhcp["server-mode"]||{};b.selected.dhcp["server-mode"]["dhcp-pool"]=q;break;case 7:b.selected.dhcp["interface"]=""}if(isNaN(t)){q=angular.copy(b.selected.dhcp);a.dhcp_ref.push(q);var e=a;e["dhcp-pools"].pool.push(q._poolref);6==q.iftype?e["dhcp-pool"]["dhcp-interfaces"].push(q):7==q.iftype&&e["dhcp-pool"]["dhcp-option82"].push(q);b.fns.refreshInuseVLANList()}else angular.extend(a.dhcp_ref[t]._poolref,
b.selected.dhcp._poolref),delete b.selected.dhcp._poolref,angular.extend(a.dhcp_ref[t],b.selected.dhcp),6==b.selected.dhcp.iftype?p(a["dhcp-pool"]["dhcp-option82"],a["dhcp-pool"]["dhcp-interfaces"]):7==b.selected.dhcp.iftype&&p(a["dhcp-pool"]["dhcp-interfaces"],a["dhcp-pool"]["dhcp-option82"]);return!0};b.displayTabTitle=function(a,e){var x="",n="vlan";6==b.selected.dhcp.iftype&&(n="vlan");7==b.selected.dhcp.iftype&&(n="opt82");switch(a){case 0:x="1. Role";break;case 1:"vlan"==n&&(x="2. Configure");
"opt82"==n&&(x="2. Configure");break;case 2:"vlan"==n&&(x="2.1 Detail");"opt82"==n&&(x="2.1 Detail");break;case 3:"vlan"==n&&(x="3. Configure (IPv6)");"opt82"==n&&(x="");break;case 4:"vlan"==n&&(x="3.1 Detail (IPv6)");"opt82"==n&&(x="");break;default:x=""+a+" "+e}return x};b.tabs=[{title:"Step1",tmpl:"dhcp_edit_step1.htm",disabled:!0,form:null,active:!0,savecb:b.selected.step1_next},{title:"Step2",tmpl:"dhcp_edit_step2.htm",disabled:!0,form:null,active:!1,savecb:b.selected.step1_next},{title:"Step2_1",
tmpl:"dhcp_edit_step2_1.htm",disabled:!0,form:null,active:!1,savecb:b.selected.step1_next},{title:"Step3",tmpl:"dhcp_edit_step3.htm",disabled:!0,form:null,active:!1,savecb:b.selected.step1_next},{title:"Step3_1",tmpl:"dhcp_edit_step3_1.htm",disabled:!0,form:null,active:!1,savecb:b.selected.step1_next}];b.check_ok=function(a){var e,x=b.selected.tabid;a[0].form&&(e=a[x].form.$valid,0===b.selected.tabid&&a[x].invalid&&(e=!1));return e}}});app.controller("lan_vlan_membership_main",["$scope","$location","$timeout","$q","MyHttp","$templateCache","$filter","wan_service","Sets","UserSession","userAccessRight","DHCP_PD","addressPoolValidate","modelInfo",function(a,b,t,m,w,u,p,q,e,x,n,l,r,v){var s={source:"dproxy",getResult:function(a,b,c){return e.getResult(this,a,b,c)}};a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.flagPortEditable=!1;a.func_flag=a.func_flag||{ipv6_pd_with_6rd:!1,ipv6_layout:"DESIGN_0",ipv6_min_prefixlen:16,ipv6_addr1:!1,ipv6_ip_prefer_isp:!1};
a.success=!1;a.loadReady=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&x.logout();var k={"ethernetCsmacd,lan":"LAN","ethernetCsmacd,wan":"WAN","svi,vlan":"VLAN","l2vlan,vlan":"VLAN"},d=a.fop={get_ip:function(a){return a.ip},set_ip:function(a,b){a.ip=b},get_prefixlen:function(a){return a.prefix_length},set_prefixlen:function(a,b){a.prefix_length=b},get_origin_mode:function(a){var b;a&&null===a["static"]?b="STATIC":a&&a.isp&&(b="ISP");return b},set_origin_mode:function(a,
b,c){"STATIC"===b?(a["static"]=null,a.isp=void 0):angular.isDefined(c.wan_ifname)?"ISP"===b&&(a["static"]=void 0,a.isp={"interface":c.wan_ifname,prefix_name:c.prefix_name}):(a["static"]=null,a.isp=void 0)},get_identifier:function(a){var b;a&&null===a.eui_64?b="EUI_64":a&&a.user_define&&(b="USER_DEFINE");return b},set_identifier:function(b){var c=b._type_if_ident,d=a.func_flag.ipv6_min_prefixlen||16,g=function(a,b){angular.isDefined(a)||(a="");a.match(/::/)||(a="::"+a);var c=app.TOOLS.validation.ipv6_getNet("ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff",
b),d="",d=z.parseIpaddr(a);if(!1===d)d="";else{for(var g=angular.copy(d),h=0,e;7>=h;h++)e=d.parts[h],g.parts[h]=e&~c[h];d=g.toString();d="::"===d.substr(0,2)?d.substr(2):d}return d};"ISP"===b._type?(c=b&&b._ip_pd_prx2,d=b&&b._ip_pd_prx.split("/")[1]||d,g=g(c,d),b.eui_64=void 0,b.user_define=g):"EUI_64"===c?(b.eui_64=null,b.user_define=void 0):"USER_DEFINE"===c&&(c=b&&b._if_ident,d=b&&b.prefix_length||d,g=g(c,d),b.eui_64=void 0,b.user_define=g)},get_inter_vlan_routing:function(a){return a.vlan_inter_vlan_routing},
set_inter_vlan_routing:function(a,b){a.vlan_inter_vlan_routing=b},get_vlan_id:function(a){return a.vlan_id},set_vlan_id:function(a,b){a.vlan_id=b},get_vlan_untagged_vlan_id:function(a){return a.vlan_untagged_vlan_id},set_vlan_untagged_vlan_id:function(a,b){a.vlan_untagged_vlan_id=b},get_vlan_tagged_vlan_id:function(a){return a.vlan_tagged_vlan_id},set_vlan_tagged_vlan_id:function(a,b){a.vlan_tagged_vlan_id=b},clean_vlan_tagged_vlan_id:function(a){a.vlan_tagged_vlan_id.splice(0)},push_vlan_tagged_vlan_id:function(a,
b){return a.vlan_tagged_vlan_id.push(b)},pop_vlan_tagged_vlan_id:function(a){return a.vlan_tagged_vlan_id.pop()},dhcp_dp:{get_dhcp_pd_prefix:function(a){if(a&&a.ipv6&&a.ipv6.dhcp_pd_prefix)return a.ipv6.dhcp_pd_prefix},get_dhcp_pd_prefix_full:function(a){if(a&&a.ipv6&&a.ipv6.dhcp_pd_prefix_full)return a.ipv6.dhcp_pd_prefix_full},get_dhcp_pd_wanname:function(a){if(a&&a._WANname)return a._WANname}}},c=function(){a.loadReady=!1;m.defer();m.defer();m.defer();var b=function(a){var b=app.TOOLS.sortingInterfaceFn(!1);
a.sort(b)};m.all({INTF:function(){return w.post({url:resource_base+"data/lan_vlan_membership.json",method:"get_vlan_membership",success:function(b){b&&(b.data&&""===b.data.result)&&(b.data.result={});var c={};O.vlan_t_db_to_cfg(b.data.result,c);c=c.interfaces;b.data.result={vlan:p("filter")(c,a.ifNamed("^VLAN")),lan:p("filter")(c,a.ifNamed("^LAN")),lag:p("filter")(c,a.ifNamed("^LAG")),wan:p("filter")(c,a.ifNamed("^WAN[0-9]($|.[0-9]+$)"))}},error:function(a){console.log("AJAX loading error: "+a.status+
", URL: "+a.config.url+" method: "+this.method)}})}(),INTF_state:function(){return w.post({url:resource_base+"data/system_summary.json",method:"get_interface_state",params:{filter:"VLAN"},options:{transformResponse:app.modelhelper.db2webFn},success:function(a){a&&(a.data&&""===a.data.result)&&(a.data.result={});e.default_result(a,{"interfaces-state":{"interface":[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),WAN_IPv6:function(){return w.post({url:resource_base+
"data/get_wan_ipv6_prefix.json",method:"get_wan_ipv6_prefix",options:{transformResponse:app.modelhelper.db2webFn},success:function(a){a&&(a.data&&""===a.data.result)&&(a.data.result={});e.default_result(a,{interfaces_state:{"interface":[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),StateSubnet:function(){return w.post({url:resource_base+"data/get_subnet.json",method:"get_subnet",success:function(a){a&&(a.data&&""===a.data.result)&&
(a.data.result={});e.default_result(a,{subnets:{ipv4:[],ipv6:[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}()}).then(function(c){a.model={};a.model.vlan_interfaces=s.getResult(c.INTF,"vlan");a.model.lan_interfaces=s.getResult(c.INTF,"lan");a.model.lag_interfaces=s.getResult(c.INTF,"lag");a.model.wan_interfaces=s.getResult(c.INTF,"wan");a.model.vlan_ifstate=s.getResult(c.INTF_state,"interfaces_state");g();a.model.wan_ifstate=
s.getResult(c.WAN_IPv6,"interfaces_state");a.func_flag.ipv6_pd_with_6rd&&h(c.cdb_IP6RD);b(a.model.vlan_interfaces);b(a.model.lan_interfaces);b(a.model.lag_interfaces);a.collect_wan_dhcp_pd();c=c.StateSubnet;c.data&&(c.data.result&&c.data.result.subnets&&c.data.result.subnets.ipv4&&c.data.result.subnets.ipv6)&&(a.subnetObj=angular.copy(c.data.result.subnets));a.gridVLAN.Options.data=a.model.vlan_interfaces;a.schema=a.schema||{};a.schema.StatusMap={"true":a.DICT("VLAN_membership_Enabled"),"false":a.DICT("VLAN_membership_Disabled")};
a.schema.portmodes=[{id:"U",displayName:a.DICT("VLAN_membership_Untagged")},{id:"T",displayName:a.DICT("VLAN_membership_Tagged")},{id:"X",displayName:a.DICT("VLAN_membership_Excluded")}];a.schema.portmodesHash={U:a.DICT("VLAN_membership_Untagged"),T:a.DICT("VLAN_membership_Tagged"),X:a.DICT("VLAN_membership_Excluded")};a.schema.ipv6_addr_sample={ip:"fec0:0001:0000:0000::",prefix_length:64};a.schema.TYPE_STATIC="STATIC";a.schema.TYPE_ISP="ISP";a.ctx.HWDMZport=v.get_HWDMZport()||"LAN4";a.ctx.HWDMZenableCount=
0;c=a.model.vlan_interfaces.concat(a.model.lan_interfaces).concat(a.model.lag_interfaces);for(var e=c.length-1,k;0<e;e--)if(k=c[e],k.name.match(/^LAN|^LAG/)){k.role="lan";null==d.get_vlan_tagged_vlan_id(k)&&d.set_vlan_tagged_vlan_id(k,[]);var z=k,l=d.get_vlan_tagged_vlan_id(z);if(l&&(l=angular.copy(l[0]))&&l.split){d.clean_vlan_tagged_vlan_id(z);for(var l=l.split(" "),n=l.length;n--;)void 0!=l[n]&&d.push_vlan_tagged_vlan_id(z,parseInt(l[n]))}k.name.match("^"+a.ctx.HWDMZport+"$")&&(k.dmz&&!0==k.dmz.enabled)&&
(a.ctx.HWDMZenable=!0,a.ctx.HWDMZenableCount=1)}else"VLAN"==k.name.substr(0,4)?(k.role="vlan",k.vlan_tagged_vlan_id&&delete k.vlan_tagged_vlan_id,k.vlan_untagged_vlan_id&&delete k.vlan_untagged_vlan_id):k.name.match(/^WAN\d+$|^WAN\d+\.\d+$/)?k.role="wan":k.name.match(/^DMZ/)&&c.splice(e,1);y();a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.loadReady=!0})["catch"](function(a){console.log("=="+a)})},h=function(b){b=b.data.result.interfaces||[];b.length&&(a.model.ip6rd=[],angular.forEach(b,
function(b,c){b.name.match(/^TUN/)&&("ip6rd"==b.type&&!0==b.enabled)&&a.model.ip6rd.push(b)}))},g=function(){a.use_interfaces_sample={interfaces:[]};e.recover_object(a.model,a.use_interfaces_sample);a.use_wan_interfaces_state_sample={wan_ifstate:{"interface":[]}};e.recover_object(a.model,a.use_wan_interfaces_state_sample);a.use_ipv6ra_prefix_list_sample={ipv6_ra:{prefixes:[]}};angular.forEach(a.model.vlan_interfaces,function(a,b){"VLAN"==a.name.substr(0,4)&&e.recover_object(a,{"vlan-interface-settings":{"inter-vlan-routing":!1,
"enable-management":!1}});if("VLAN"==a.name.substr(0,4)){var c={editVlanId:!1,edit:!1,editEnableManagement:!1,invalid:!1,checked:!1,ipv4:{enabled:!0,mtu:1400,address:[{ip:"",prefix_length:null}]},ipv6:{enabled:!0,mtu:1400,address:[{ip:"",prefix_length:null}]}};c.info=!1==a.vlan_enable_management?C:"";e.recover_object(a,c)}});angular.forEach(a.model.lan_interfaces,function(a,b){("LAN"==a.name.substr(0,3)||"LAG"==a.name.substr(0,3))&&e.recover_object(a,{vlan_tagged_vlan_id:[],vlan_untagged_vlan_id:""})})},
A=function(a,b){var c=a[b].address[0];a[b].enabled=""!=c.ip&&void 0!=c.ip&&null!=c.prefix_length&&0!=c.prefix_length?!0:!1},y=function(b){b=p("filter")(a.model.vlan_interfaces,D);angular.forEach(b,function(b,c){if(b.ipv6&&b.ipv6.address){var d=b.ipv6.address;d[0]&&(a.refreshIPv6Ctx(b,0),a.init_origin_type(d[0],b,!0));d[1]&&(a.refreshIPv6Ctx(b,1),a.init_origin_type(d[1],b,!0),d[1].enabled=!0)}})},z={ipaddr:createIpAddr(),parseIpaddr:function(a){return!z.ipaddr.IPv6.isValid(a)?!1:z.ipaddr.parse(a)}},
B=function(a,b){var c=z.parseIpaddr(a);if(!(!1===c||0<!parseInt(b,10))){for(var d=angular.copy(c),g=angular.copy(c),h=0,e=128,k,l;0<e;)k=16<b?16:b,b-=k,0>b&&(b=0),l=65535^(1<<16-k)-1,k=(1<<16-k)-1,d.parts[h]=c.parts[h]&l,g.parts[h]=c.parts[h]&k,e-=16,h++;return{prefix_obj:d,prefix_str:d.toString(),prefix_norm_str:d.toNormalizedString(),suffix_obj:g,suffix_str:g.toString(),suffix_norm_str:g.toNormalizedString()}}};a.refreshIPv6Ctx=function(b,c){if(b.ipv6&&b.ipv6.address&&b.ipv6.address[c]&&b.ipv6.address[c].ip){var g=
b.ipv6.address[c],h=g.ip,e=parseInt(g.prefix_length);if(e=B(h,e))g._ip_prefix=app.TOOLS.ipv6.compress(e.prefix_norm_str),g._if_ident=e.suffix_str.replace(/^::/,""),g._ip_pd_prx=e.prefix_norm_str.toLowerCase()+"/"+g.prefix_length;a.func_flag.ipv6_ip_prefer_isp?g._ip_pd_prx2=g.user_define:"ISP"===d.get_origin_mode(g)&&(g._ip_pd_prx2=g._if_ident);a.PD_source?angular.forEach(a.PD_source,function(a,b){var c=d.dhcp_dp.get_dhcp_pd_prefix(a);if(c&&"function"===typeof c.split){var e=c.split("/"),c=e[0],e=
e[1]&&parseInt(e[1],10)||0,e=B(h,e),k=e.prefix_norm_str.toLowerCase();app.TOOLS.ipv6.toFullV6Addr(c).toLowerCase()===k&&(g.isp&&g.isp["interface"]===d.dhcp_dp.get_dhcp_pd_wanname(a))&&(g._ip_pd_obj=a,c=e.suffix_str.toLowerCase().replace(/^::/,""),g._ip_pd_prx2=c)}}):Log(ERROR,"Error: PD_source not exist")}};a.update_ip_enable_status=function(a,b){A(a.entity,b)};a.collect_port_list=function(){var b=p("filter")(a.model.lan_interfaces,function(a,b,c){return a.name.match(/^LAN/)?!0:!1}),c=p("filter")(a.model.lag_interfaces,
function(a,b,c){return a.name.match(/^LAG/)?!0:!1});return b.concat(c)};a.sync_vlanid=function(b,c){var g=d.get_vlan_id(c.entity)||"??",h="",e=!1,l;angular.forEach(a.model.vlan_interfaces,function(a,c){b===c?l=a:a.vlan_id===g&&(e=!0)});"??"===g||e?(h="(Invalid)",l.invalid=!0):(h=k["l2vlan,vlan"]+g,l.invalid=!1);c.entity.name=h;a.update_v6_local_pd_ip(c.entity.ipv6.address[0],c.entity,!0);var h=c.rowIndex,z=c.entity,n,y,s=a.collect_port_list();if(null!=d.get_vlan_id(z))for(var B=s.length;B--;)n=s[B],
y=B,a.update_port_vlan_model(h,y,z,n)};a.ifNamed=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};var D=function(a,b,c){return a.name.match(/^(VLAN)/)?!0:!1};a.collect_svi_ref_list=function(){return p("filter")(a.model.vlan_interfaces,D)};a.update_v6_prefix_disabled=function(b){var c=!1;b._type!=a.schema.TYPE_STATIC&&(c=!1);b=b._type==a.schema.TYPE_STATIC&&"EUI_64"==b._type_if_ident;return c||b};a.get_min_v6_prefixlen=function(b){var c=a.func_flag.ipv6_min_prefixlen,d=c;b._type==
a.schema.TYPE_ISP&&b._ip_pd_prx&&(b=b._ip_pd_prx.split("/")[1]||c,d=parseInt(b));return Math.max(c,d)};a.update_v6_pd_obj=function(b,c){for(var g=d.get_vlan_id(c)||1,h=a.model.vlan_interfaces,e=0,k;e<h.length;e++)if(k=h[e],(k=k.ipv6&&k.ipv6.address&&k.ipv6.address[0])&&k._ip_pd_prx2)(k=k._ip_pd_prx2.split(":").reverse()[4])&&g===parseInt(k,16)&&(g+=1);g=g.toString(16).toUpperCase();b._ip_pd_prx2=b._ip_pd_prx2||g+":0:0:0:1";g=d.dhcp_dp.get_dhcp_pd_prefix_full(b._ip_pd_obj);b._ip_pd_prx=g?g:void 0;
a.update_v6_local_pd_ip(b,c,!1)};a.update_v6_local_pd_ip=function(b,c,g,h){var e=d.get_vlan_id(c);if(e){if(!g||!b._ip_pd_prx_local)b._ip_pd_prx_local=!1;if(b._ip_pd_prx_local){e=d.get_vlan_id(c);g=new G;var k=g.ipv6ToNumber("fec0:0000::"),l="";k.parts[1]=parseInt(e);l=g.numToIpv6Normal(k);b._ip_pd_prx=l+"/64"}}h?a.update_v6ip(b,c,void 0,{userDefPrefix:!0}):a.update_v6ip(b,c)};a.update_v6ip=function(b,c,g,h){var e=!1;h&&angular.isDefined(h.userDefPrefix)&&(e=h.userDefPrefix);var k=!0,l=!1,n=function(){y.parts.length!==
s.parts.length&&console.log("Error: preview_v6ip, IPv6 part not correct");var c=angular.copy(s),g;if(b._type==a.schema.TYPE_ISP){var h=d.dhcp_dp.get_dhcp_pd_prefix(b._ip_pd_obj);h?(h=h.split("/"),g=64,0<h.length&&(g=h[1]),g=parseInt(g)):g=64}else g=b.prefix_length;for(h=0;h<c.parts.length;h++)16<=g?(c.parts[h]=0,g-=16):(c.parts[h]&=(1<<16-g)-1>>>0,g=0);g=angular.copy(y);for(h=0;h<y.parts.length;h++)g.parts[h]=y.parts[h]|c.parts[h];return g.toString()};g=function(b){b._ip_pd_prx2="";if("USER_DEFINE"==
b._type_if_ident){y=z.parseIpaddr(b._ip_prefix);s=z.parseIpaddr("::"+b._if_ident);if(!1==y||!1==s)k=!1;k&&(b.ip=n())}else if("EUI_64"==b._type_if_ident){b.prefix_length=64;for(var c=p("filter")(a.model.vlan_ifstate["interface"],a.ifNamed("^VLAN")),d=0;d<c.length;d++){var g=c[d];if(g.name.match(/^VLAN/)&&void 0!=g.phys_address){var h=b,g=g.phys_address.replace(/:/g,""),g=g.substr(0,4)+":"+g.substr(4,2)+"FF:FE"+g.substr(6,2)+":"+g.substr(8,4),e=parseInt(g.substr(0,2),16),e=0==(e&2)?e|2:e&253,g=e.toString(16)+
g.substr(2),g=ipaddr.parse("::"+g).toString().toLowerCase();h._suffix_eui64=g}}b._if_ident="";b._ip_pd_prx="";y=z.parseIpaddr(b._ip_prefix);s=z.parseIpaddr(b._suffix_eui64);if(!1==y||!1==s)k=!1;k&&(b.ip=n().toLowerCase())}};h=function(){b._ip_pd_prx=b._ip_pd_prx||"";b._suffix_eui64="";var a=b._ip_pd_prx.split("/")[0];e||(b._ip_pd_prx.split("/"),b.prefix_length=64);y=z.parseIpaddr(a);s=z.parseIpaddr("::"+b._ip_pd_prx2);if(!1==y||!1==s)k=!1;k&&(b.ip=n().toLowerCase());""===b._ip_pd_prx&&b.orig_ip&&
(b.ip=b.orig_ip,l=!0);if(a=B(b.ip,b.prefix_length))b._ip_prefix=app.TOOLS.ipv6.compress(a.prefix_norm_str),"EUI_64"===d.get_identifier(b)?b._if_ident="":b._if_ident=a.suffix_str.replace(/^::/,"")};var y,s;b._type==a.schema.TYPE_STATIC?(g(b),d.set_origin_mode(b,"STATIC")):b._type==a.schema.TYPE_ISP&&(h(b),d.set_origin_mode(b,"ISP",{wan_ifname:b._ip_pd_obj&&b._ip_pd_obj._WANname||void 0}));d.set_identifier(b);if(k||l){var r=angular.copy(b.ip);b.ip="";t(function(){b.ip=r;A(c,"ipv6");a.gridVLAN.chkIpv6Ip()},
0)}else b.ip="",A(c,"ipv6"),a.gridVLAN.chkIpv6Ip()};a.ipv6_addr_create_elem=function(b,c,d,g){if(g=!0===g?!0:!1){var h=b[c]=angular.copy(a.schema.ipv6_addr_sample);h.ip="";h.isp={"interface":"WAN1"};h._type=a.schema.TYPE_ISP;h._ip_pd_obj=a.collect_wan_dhcp_pd()[0];a.update_v6_pd_obj(h,d)}else b[c]=void 0;b[c]&&(b[c].enabled=g)};a.init_origin_type=function(b,c,g){angular.isDefined(b._type)||("ISP"===d.get_origin_mode(b)?b._type=a.schema.TYPE_ISP:b._type=a.schema.TYPE_STATIC,!0!==g&&t(function(){a.update_v6ip(b,
c)},0));a.init_type_if_ident(b)};a.init_type_if_ident=function(a){angular.isDefined(a._type_if_ident)||(a._type_if_ident="USER_DEFINE")};a.intf_key_handler=function(a,b){b=parseInt(b);var c=!1,g=d.get_vlan_id(a);a&&("l2vlan"==a.type&&g==b)&&(c=!0);return c};a.isExistUnnamedVLANID=function(a){var b=function(a,b,c){a=d.get_vlan_id(a.entity);return angular.isDefined(a)?!1:!0},c=[];a&&(a.Options&&a.Options.ngGrid&&a.Options.ngGrid.filteredRows)&&(c=p("filter")(a.Options.ngGrid.filteredRows,b));return 0<
c.length};(function(){var b=a.func_flag.ipv6_layout,c={editRowH:6*(app.uiGrid.headerRowHeight||32),width:750,editableCellTemplate:u.get("T_vlan_membership_ipv6_address_edit.html")};"DESIGN_2"===b&&(c={editRowH:7*(app.uiGrid.headerRowHeight||32),width:800,editableCellTemplate:u.get("T_vlan_membership_ipv6_address_edit_DESIGN_2.html")});return c})();a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridVLAN=a.gridVLAN||{};a.gridVLAN.Selections=[];a.gridVLAN.stateObj={editCount:0,editList:[]};
a.gridVLAN.procNgClick=function(b){var c=0,d=[];a.gridVLAN.Selections.splice(0);angular.forEach(a.model.vlan_interfaces,function(b,g){b.checked?a.gridVLAN.Selections.push(b):(b.edit=!1,b.editVlanId=!1,b.editEnableManagement=!1);b.edit&&(c++,d.push(g))});a.gridVLAN.stateObj.editCount=c;a.gridVLAN.stateObj.editList=d;a.gridVLAN.check_remove_condition()};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};var E=function(a,b,c,d,g){for(var h=a.length,e,k=0,l;k<h;k++){l=a[k];e=!1;for(var z=
0,y;z<h;z++)y=a[z],k!==z&&d&&d(y,l,g)&&(e=!0);!e&&c&&(e=c(l));l[b]=e}};a.gridVLAN.chkIpv6Ip=function(){var b=X,c=T,d=a.collect_svi_ref_list();E(d,"isDupIpv6a0",b,c,{v6_addrx:0});E(d,"isDupIpv6a1",b,c,{v6_addrx:1})};a.gridVLAN.chkIpv4Ip=function(){var b=J,c=R,d=a.collect_svi_ref_list();E(d,"isDupIpv4",b,c)};var C=v.spec_WifiSupport()?a.DICT("VLAN_membership_Device_Management_Note_1"):a.DICT("VLAN_membership_Device_Management_Note_2");a.gridVLAN.Options=app.uiGrid.generateGridOptions({IDPreifx:"VLANMembership",
rowHeight:a.func_flag.ipv6_addr1?2*app.uiGrid.rowHeight:3*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridVLAN.procNgClick,headerChangedCbk:a.gridVLAN.procNgClick,disableChkBoxField:"disableChk"},{field:"vlan_id",displayName:a.DICT("VLAN_membership_VLAN_ID"),id:"VLANMembershipID",validationCbk:"gridInvalidCbk",min:1,max:4093,required:!0,changedCbk:a.sync_vlanid,editRow:"editVlanId",width:90,invalidField:"invalid",cellTemplate:u.get("UG_table_text_with_inline_number_edit.html")},
{field:"name",displayName:a.DICT("VLAN_membership_Name"),width:90},{field:"vlan_inter_vlan_routing",displayName:a.DICT("VLAN_membership_Inter_VLAN_Routing"),id:"VLANMembershipRouting",cellTemplate:u.get("UG_table_checkbox_with_inline_edit.html"),editRow:"edit",width:155},{field:"vlan_enable_management",displayName:a.DICT("VLAN_membership_Device_Managemenet"),id:"VLANMembershipEnableManagement",cellTemplate:u.get("UG_table_checkbox_with_inline_edit.html"),editRow:"editEnableManagement",width:160,infoField:"info"},
{field:"ipv4.address",displayName:a.DICT("VLAN_membership_IPv4_Addr_Mask"),id:"VLANMembershipIPv4",validationCbk:"gridInvalidCbk",cellTemplate:u.get("T_vlan_membership_ipv4_address_edit.html"),editRow:"edit",minWidth:250,width:250},{field:"ipv6.address",displayName:a.DICT("VLAN_membership_IPv6_Addr_Mask"),id:"VLANMembershipIPv6",validationCbk:"gridInvalidCbk",cellTemplate:u.get("T_vlan_membership_ipv6_address_edit.html"),editRow:"edit",minWidth:600}]});var I=function(b,c){var g=p("filter")(a.model.lan_interfaces,
a.ifNamed("^LAN|^LAG"));angular.forEach(g,function(a,g){var h=d.get_vlan_tagged_vlan_id(a);if(h){var e=d.get_vlan_id(b),e=void 0!==e||null!==e?e:"",k=h.indexOf(e);-1==k?"add"==c&&h.push(e):"remove"==c&&h.splice(k,1)}})},G=function(){var a=this,b=createIpAddr();a.ipaddr=b;a.addrObj=void 0;a.parseIpv6addr=function(a){return!b.IPv6.isValid(a)?!1:b.parse(a)};a.ipv6ToNumber=function(b){b=a.parseIpv6addr(b);return a.addrObj=b};a.numToIpv6=function(b){if(b)return b.toString().toLowerCase();if(a.addrObj)return a.addrObj.toString().toLowerCase()};
a.numToIpv6Normal=function(b){if(b)return b.toNormalizedString().toLowerCase();if(a.addrObj)return a.addrObj.toNormalizedString().toLowerCase()};return a},H=function(){var b=32-a.ctx.HWDMZenableCount,c=a.collect_svi_ref_list().length||0,d=a.DICT("VLAN_membership_Vlan_Intf");return c>=b?(a.msg=a.DICT("VLAN_membership_DMZ_Max",{"%s0":a.ctx.HWDMZenableCount?a.DICT("VLAN_membership_DMZ_Enabled"):"","%s1":b,"%s2":d}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.gridVLAN.add=function(){if(!H()){var b=
a.model.vlan_interfaces;a.collect_svi_ref_list();var c;c={name:"VLAN0",type:"l2vlan",enabled:!0,vlan_id:0,editVlanId:!0,edit:!0,editEnableManagement:!0,vlan_inter_vlan_routing:!0,vlan_enable_management:!1,ipv4:{enabled:!0,mtu:1400,address:[{ip:"",subnet:"",prefix_length:null}]},ipv6:{enabled:!0,forwarding:!1,address:[angular.copy(a.schema.ipv6_addr_sample)],setting:{dhcp_pd_enable:!0}},ipv6_ra:{max_rtr_adv_interval:30},dot1x:{enable:!0,authorized_mode:"auto"},checked:!0,info:C};var g=new G;if(c.ipv6&&
c.ipv6.address&&c.ipv6.address[0]&&c.ipv6.address[0].ip){var h=c.ipv6.address[0],e=g.ipv6ToNumber(h.ip);V(c.ipv6.address[0],["^_"],!0);e.parts[1]+=b.length%65535;h._ip_prefix=g.numToIpv6(e);h._if_ident="1"}c._db_exist&&delete c._db_exist;c.vlan_ref&&delete c.vlan_ref;d.set_vlan_id(c,"");c.name=k["l2vlan,vlan"]+"";b.push(c);I(c,"add");a.init_origin_type(c.ipv6.address[0],c);a.gridVLAN.Options.gridApi.customApi.scrollToLast();a.modified()}};a.gridVLAN.edit=function(){for(var b=a.gridVLAN.Options.data,
c=0,d=[],g=b.length-1,h;0<=g;g--)h=b[g],h.checked&&(h.edit=!0,h.info=C,"VLAN1"!==h.name&&(h.editEnableManagement=!0),c++,d.push(g));a.gridVLAN.stateObj.editList=d;t(function(){a.gridVLAN.stateObj.editCount=c},0)};a.gridVLAN.VLAN1Exsit=!1;a.gridVLAN.check_remove_condition=function(){var b=!1,c=a.gridVLAN.Selections;a.gridVLAN.VLAN1Exsit=!1;angular.forEach(c,function(c,d){"VLAN1"==c.name&&(b=!0,a.gridVLAN.VLAN1Exsit=!0)});return b};a.gridVLAN.remove=function(){var b=[];angular.forEach(a.model.vlan_interfaces,
function(a){a.checked&&b.push(a)});a.gridVLAN.checking_before_remove(b,function(){var b=a.model.vlan_interfaces,c;for(c=b.length-1;0<=c;c--)b[c].checked&&(I(b[c],"remove"),b.splice(c,1),F());a.modified()})};var F=function(){var b=function(b){angular.forEach(b,function(a,b){var c=a[".ctx"].port_vlan_map,d;for(d in c)"U"!==c[d]&&(c[d]="U")});var c,g,h=a.collect_port_list();angular.forEach(b,function(b,e){if(null!=d.get_vlan_id(b))for(var k=h.length;k--;)c=h[k],g=k,a.update_port_vlan_model(e,g,b,c)})},
c=a.collect_svi_ref_list();1>=c.length&&b(c);a.gridVLAN.chkIpv4Ip();a.gridVLAN.chkIpv6Ip();a.gridVLAN.procNgClick()};a.gridVLAN.checking_before_remove=function(b,c){a.ctx_delref=a.ctx_delref||{};a.ctx_teleworker=a.ctx_teleworker||{};a.ctx_accessrules=a.ctx_accessrules||{};var d=function(d){var g=!0;d="";for(var h=[{dispStr:"DHCP Settings",refctx:a.ctx_delref["dhcp-pool"]["dhcp-interfaces"],chk_cb:function(a,b){return a.name==b["interface"]}},{dispStr:"Teleworker VPN Client",refctx:a.ctx_teleworker["teleworker-vpn-clients"]["teleworker-vpn-client"],
chk_cb:function(a,b){return a.name=="VLAN"+b.vlan}},{dispStr:"Firewall ACL Rules",refctx:a.ctx_accessrules["firewall-acl-rules"].ipv4["firewall-acl-rule"],chk_cb:function(a,b){return b["interface"]&&b["interface"]["source-interface"]&&a.name==b["interface"]["source-interface"]}}],e=function(a,b,c){angular.forEach(a.refctx,function(d,h){b&&(b.checked&&a.chk_cb(b,d))&&(c.push(a.dispStr),g=!1)})},k=b.length;k--;){var l=[];e(h[0],b[k],l);e(h[1],b[k],l);e(h[2],b[k],l);0<l.length&&(d+="<div>"+a.DICT("VLAN_membership_VLAN_In_Use",
{"%s1":b[k].name,"%s2":"</br>"+l.join("\n")})+"</div></br>")}""!==d&&app.TOOLS.criticalAlertBox({title:a.DICT("Error"),msg:d});g&&c()};if(a.ctx_delref["dhcp-pool"])d();else{var g=function(a,b){a&&(a.data&&a.data.result)&&e.recover_object(a.data.result,b)};m.all({dhcp:function(){return w.post({url:resource_base+"data/lan_dhcp_settings.json",method:"get_dhcp_settings",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),teleworker:function(){return w.post({url:resource_base+
"data/telework_vpn_clients.json",method:"get_teleworker_vpn",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),accessrules:function(){return w.post({url:resource_base+"data/firewall_access_rules.json",method:"get_access_rules",error:function(a){Log(ERROR,"accessRulesCtrl getData error: "+JSON.stringify(a))}})}()}).then(function(b){g(b.dhcp,{"dhcp-pool":{"dhcp-interfaces":[],"dhcp-option82":[]}});g(b.teleworker,{"teleworker-vpn-clients":{"teleworker-vpn-client":[]}});
g(b.accessrules,{"firewall-acl-rules":{ipv4:{"firewall-acl-rule":[]}}});angular.extend(a.ctx_delref,b.dhcp.data.result);angular.extend(a.ctx_teleworker,b.teleworker.data.result);angular.extend(a.ctx_accessrules,b.accessrules.data.result)}).then(function(){d()})}};a.tag_status=function(a,b,c,g){var h=d.get_vlan_id(a),e="?";if(d.get_vlan_untagged_vlan_id(b)==h)e="U";else{var k=!1,e="X";(a=d.get_vlan_tagged_vlan_id(b))&&angular.forEach(a,function(a,b){a==h?(e="T",k=!0):k||(e="X")})}return e};a.filter_LAN=
function(b,c,d){return b.name.match(/^LAN/)?(void 0!==b.lag_ref&&(a.ctx.inused_lag.push(b.lag_ref),b._greyout=!0),!0):!1};a.filter_LAG=function(b,c,d){return b.name.match(/^LAG/)&&!1!=b.enabled?(0<=a.ctx.inused_lag.indexOf(b.name)||(b._greyout=!0),!0):!1};a.collect_vlan_port_ref_list=function(){a.ctx.inused_lag=[];var b=p("filter")(a.model.lan_interfaces,a.filter_LAN),c=p("filter")(a.model.lag_interfaces,a.filter_LAG);return b.concat(c)};a.collect_wan=function(){a.filterWANphy={physical:!0,subinterface:!0};
return q.filter(a.model.wan_ifstate["interface"],a.filterWANphy)};a.collect_wan_dhcp_pd=function(){var b=a.model.wan_interfaces,c=a.model.wan_ifstate["interface"];a.PD_source||(a.PD_source=l.get_pd_interfaces(b,c));return a.PD_source};a.pd_dispStr=function(a){var b="unavailable",c=d.dhcp_dp.get_dhcp_pd_prefix(a);c&&(b=c);return b+" - ("+a._WANname+")"};a.pd_disableCond=function(a){return void 0==d.dhcp_dp.get_dhcp_pd_prefix(a)};a.showLagOwnerStatus=function(b,c){if(c[".ctx"]&&c[".ctx"].port_vlan_map){for(var d=
b.lag_ref,g=4,h=a.collect_vlan_port_ref_list(),e=0,k;e<h.length;e++)k=h[e]&&h[e].name,k==d&&(g=e);return a.schema.portmodesHash[c[".ctx"].port_vlan_map[g]]||"(Member of "+d+", but LAG not found)"}};a.update_port_vlan_model=function(b,c,g,h){var e=a.collect_svi_ref_list();"U"==g[".ctx"].port_vlan_map[c]&&(angular.forEach(e,function(a,b){a.name!=g.name&&"U"==a[".ctx"].port_vlan_map[c]&&(a[".ctx"].port_vlan_map[c]="T")}),d.set_vlan_untagged_vlan_id(h,d.get_vlan_id(g)));var k=!1;d.set_vlan_tagged_vlan_id(h,
[]);angular.forEach(e,function(a,b){var g=a[".ctx"].port_vlan_map[c];"T"==g?d.push_vlan_tagged_vlan_id(h,d.get_vlan_id(a)):"U"==g&&(k=!0)});!1==k&&d.set_vlan_untagged_vlan_id(h,"");"ieee8023adLag"==h.type&&K(b,c,g,h)};var K=function(b,c,d,g){for(var h=a.collect_vlan_port_ref_list(),e=d[".ctx"].port_vlan_map[c],k=0;k<h.length;k++)c=h[k],"ethernetCsmacd"==c.type&&c.lag_ref==g.name&&(d[".ctx"].port_vlan_map[k]=e,a.update_port_vlan_model(b,k,d,c))},M=function(a){for(var b=a%256,c=1;3>=c;c++)a=Math.floor(a/
256),b=a%256+"."+b;return b},N=function(a,b){var c=a.split("."),d=32-b,c=(c[0]<<24|c[1]<<16|c[2]<<8|c[3])>>>0>>d<<d>>>0;return{beg:c,end:(c|(1<<d)-1)>>>0}},J=function(b){var c=!1;if(b&&b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].ip&&b.ipv4.address[0].prefix_length){var d=b.ipv4.address[0],g=N(d.ip,d.prefix_length),d=M(g.beg),g=M(g.end);!1===r.poolValidate("interfaces",b.name,"ipv4",a.subnetObj,d,g,{skipCond:[{type:"interfaces",name:/^VLAN/}]})&&(c=!0)}return c},R=function(a,b){var c=
!1;if(a&&b&&a.ipv4&&b.ipv4&&a.ipv4.address&&b.ipv4.address&&a.ipv4.address[0]&&b.ipv4.address[0]&&a.ipv4.address[0].ip&&b.ipv4.address[0].ip&&a.ipv4.address[0].prefix_length&&b.ipv4.address[0].prefix_length){var d=b.ipv4.address[0],g=a.ipv4.address[0],h=N(d.ip,d.prefix_length),d=h.beg,h=h.end,e=N(g.ip,g.prefix_length),g=e.beg,e=e.end,k=!0;d<=g&&h>=e?k=!1:d<=g&&h>=g?k=!1:d<=e&&h>=e?k=!1:d>=g&&h<=e&&(k=!1);!1==k&&(c=!0)}return c},W=function(a){if(8!==a.length)console.log("error: ip6part.length = "+
a.length);else{for(var b,c=[],d=0;7>=d;d++)b=a[d]||0,c.push(b.toString(16));return c.join(":")}},S=function(a,b){for(var c=app.TOOLS.validation.ipv6_getNet(a,b),d=angular.copy(c),g=[0,0,0,0,0,0,0,0],h=128-b,e=7;0<h;)16<=h?(g[e]=65535,h-=16):(g[e]|=(1<<h)-1>>>0,h=0),e--;for(e=0;e<d.length;e++)d[e]|=g[e];return{beg:c,end:d}},X=function(b){var c=!1;if(b&&b.ipv6&&b.ipv6.address&&b.ipv6.address[0]&&b.ipv6.address[0].ip&&b.ipv6.address[0].prefix_length){var d=b.ipv6.address[0],g=S(d.ip,d.prefix_length),
h=W(g.beg).toLowerCase(),g=W(g.end).toLowerCase();b=r.poolValidateV6("interfaces",b.name,"ipv6",a.subnetObj,h,g,{skipCond:[{type:"interfaces",name:/^VLAN/}]});var e=!1,d=app.TOOLS.ipv6.toFullV6Addr(d.ip).toLowerCase();if(h==d||g==d)e=!0;if(!1===b||!0===e)c=!0}return c},T=function(a,b,c){var d=!1,g=!1,h=!1,e=function(a,b){if(a&&b&&a.ip&&b.ip&&a.prefix_length&&b.prefix_length){var c=S(a.ip,a.prefix_length),d=W(c.beg).toLowerCase(),c=W(c.end).toLowerCase(),d=app.TOOLS.ipv6.toFullV6ZPAddr(d).toLowerCase(),
c=app.TOOLS.ipv6.toFullV6ZPAddr(c).toLowerCase(),g=S(b.ip,b.prefix_length),h=W(g.beg).toLowerCase(),g=W(g.end).toLowerCase(),h=app.TOOLS.ipv6.toFullV6ZPAddr(h).toLowerCase(),g=app.TOOLS.ipv6.toFullV6ZPAddr(g).toLowerCase(),e=!1;d<=h&&c>=g?e=!0:d<=h&&c>=h?e=!0:d<=g&&c>=g?e=!0:d>=h&&c<=g&&(e=!0);return e}return!1};a&&(b&&a.ipv6&&b.ipv6&&a.ipv6.address&&b.ipv6.address)&&(h=!0);b&&(b.ipv6&&b.ipv6.address&&1<b.ipv6.address.length)&&(g=!0);!d&&g&&(rowE_addrs=b.ipv6.address,!0===e(rowE_addrs[0],rowE_addrs[1])&&
(d=!0));if(!d&&h&&(rowE_addrs=b.ipv6.address,item_addrs=a.ipv6.address,b=c&&c.v6_addrx||0,a=e(rowE_addrs[b],item_addrs[0]),e=e(rowE_addrs[b],item_addrs[1]),!0===a||!0===e))d=!0;return d},L=function(b,c){return function(b){if(!b)return!0;a.collect_svi_ref_list();return{result:!0,invalidRows:[],validRows:[]}}};a.poolValidation=function(a){var b;"ipv6"==a?(a=X,b=T):(a=J,b=R);return L(a,b)};var U=function(a,b,c,d){var g=[],h;angular.forEach(a,function(a,e){h=!1;angular.forEach(b,function(b,g){d?d(a[c],
b[c])&&(h=!0):a[c]===b[c]&&(h=!0)});if(!h){var k={};k[c]=a[c];g.push(k)}});return g},V=function(a,b,c){for(var d=0;d<b.length;d++)if(c)for(var g in a)g.match(b[d])&&delete a[g];else for(g in a)g==b[d]&&delete a[g]},P=function(a,b){if(a[b]&&a[b].address&&a[b].address[0]){var c=a[b].address[0];V(c,["^_"],!0);null==c.prefix_length&&(c.prefix_length="")}};a.save=function(){var g=a.model.vlan_interfaces.concat(a.model.lan_interfaces).concat(a.model.lag_interfaces),h=angular.copy(g);angular.forEach(h,function(b,
c){V(b,["vlan_ref",".ctx","role"]);if(b.ipv6&&b.ipv6.address)for(var g=b.ipv6.address,h=0;h<g.length;h++){var k=g[h];if(k){var l="",y="",n=k._type;if("ISP"===n){for(var l=z.parseIpaddr(k.ip),y=k.prefix_length,B=0;B<l.parts.length;B++)16<=y?y-=16:1<y&&16>y?(l.parts[B]&=65535-((1<<16-y)-1)>>>0,y=0):l.parts[B]=0;l=l.toString();y=k.prefix_length}else"STATIC"===n&&(l=k._ip_prefix,y=k.prefix_length);n&&l&&(e.recover_object(b,a.use_ipv6ra_prefix_list_sample),l=b.ipv6_ra.prefixes.push({prefix_ip:l,prefix_length:y,
preferred_lifetime:3600,valid_lifetime:7200}),d.set_origin_mode(b.ipv6_ra.prefixes[l-1],n,{wan_ifname:k.isp&&k.isp["interface"]||void 0}))}}P(b,"ipv4");P(b,"ipv6");void 0!=b._greyout&&delete b._greyout;void 0!=b.dmz&&delete b.dmz;angular.isDefined(b.checked)&&delete b.checked;angular.isDefined(b.disableChk)&&delete b.disableChk;angular.isDefined(b.info)&&delete b.info;if("http"===s.source){if(g=d.get_vlan_tagged_vlan_id(b))g=angular.copy(g),d.set_vlan_tagged_vlan_id(b,[g.join(" ")])}else(g=d.get_vlan_tagged_vlan_id(b))&&
0===g.length&&d.set_vlan_tagged_vlan_id(b,[""])});var k=U(a.model_orig.vlan_interfaces,a.model.vlan_interfaces,"name"),l=function(a,b){var c=z.parseIpaddr(a),d=z.parseIpaddr(b);return angular.equals(c,d)},g=function(b,c){angular.forEach(a.model.vlan_interfaces,function(d,g){angular.forEach(a.model_orig.vlan_interfaces,function(a,g){if(d.name==a.name&&d[b]&&d[b].address&&0<d[b].address.length&&a[b]&&a[b].address&&0<a[b].address.length){var h=void 0,e=[];"ipv6"==b&&(h=l);e=U(a[b].address,d[b].address,
"ip",h);0<e.length&&(e[0]&&""!=e[0].ip)&&(h={name:d.name},h[b]={address:e},c.push(h))}})})},y=[];g("ipv4",y);g("ipv6",y);var n=function(a,b){var c;angular.forEach(a,function(a,d){b==a.name&&(c=a)});return c},B=function(c,d){var g=n(h,c).ipv4.address[0].ip,e=b.absUrl().replace(d,g),k=function(){t(function(){window.location=e},1E3)};app.TOOLS.criticalAlertBox({msg:"Attempting to redirect to the URL: "+e,btn_yes_str:a.DICT("Click_to_Redirecting"),btn_no_str:a.DICT("Cancel"),cbk:function(a){k();app.transition.In()}});
app.transition.Out()},r=!1,A,v,F=function(){var a={redir_flag:!1};v=b.host();if(y[0]&&y[0].ipv4&&y[0].ipv4.address&&y[0].ipv4.address[0]&&y[0].ipv4.address[0].ip){var c=y[0].ipv4.address[0].ip;A=y[0].name;v==c&&(r=!0,c=n(h,A).ipv4.address[0].ip,a.redir_flag=!0,a.admin_if_name=A,a.currIp=v,a.newIp=c)}return a},x=[],J=function(){var a={};O.vlan_t_cfg_to_db({interfaces:h},a);a.interfaces["interface"].concat([]);x.push({method:"set_vlan_membership",params:a})},q=function(){var b=function(){!0==r?B(A,
v):(c(),a.reset_state());a.resetModified()},d=function(){var a=2,b=p("filter")(h,D).length||0,a=a+(1*(k.length||0)+(3*b+0*((h.length||0)-b)));return 1E3*a};0<k.length&&x.push({method:"del_interface",params:{interfaces:{"interface":k}}});J();(function(){w.post({url:resource_base+"data/rpc_result.json",method:"set_bulk",params:x,timeout:r?d():void 0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method);0===a.status&&b()}}).then(function(c){c.data.result&&
c.data.result.code&&0!==c.data.result.code?(r=!1,c="Can not delete, following Tables is in use:<br/>"+c.data.result.errstr+"<br/><br/>",app.TOOLS.criticalAlertBox({msg:c+"Apply failed, and reloading settings from device",cbk:function(a){b()}})):(a.success=!0,b())})})()};(function(){var b=F();if(b.redir_flag){var c="Notice: This device's management IP address "+b.admin_if_name+"("+b.currIp+") is requested to change.<br/><br/>",c=c+"Please update Browser's location bar with new IP address "+(" <em>"+
b.newIp+"</em> "),c=c+" when your networking environment is ready.<br/>",c=c+" Continue?";app.TOOLS.warningAlertBox({msg:c,cbk:function(a){a&&q()},btn_yes_str:a.DICT("VLAN_membership_Click_to_Redirect"),btn_no_str:a.DICT("Cancel")})}else q()})()};a.reset_state=function(){a.ctx_delref={};a.ctx.flagPortEditable=!1};a.cancel=function(){c();a.reset_state();a.resetModified()};var O=new data_transform_vlan_MR05({Sets:e});c()}]);
var data_transform_vlan_MR05=function(a){if(!b||!b.VERSION)var b={each:angular.forEach,assign:$.extend,defaults:function(b,m){a.Sets.recover_object(b,m);return b}};this.vlan_t_db_to_cfg=function(a,m){var w=(a.interfaces||{})["interface"]||[];m=m||{};var u=m.interfaces=[],p=!1,q=function(a,b){void 0!==a["static"]&&(b["static"]=a["static"]);a.isp&&(b["static"]={})},e=function(a,e){if(a["ipv6-router-advertisements"]){var l=a["ipv6-router-advertisements"],r=e.ipv6_ra={enabled:l["send-advertisements"],
mode:l.mode,max_rtr_adv_interval:l["max-rtr-adv-interval"],managed_flag:l["managed-flag"],other_config_flag:l["other-config-flag"],router_preference:l["router-preference"],link_mtu:l["link-mtu"],default_lifetime:l["default-lifetime"]};if(l["prefix-list"]&&l["prefix-list"].prefix){var l=l["prefix-list"].prefix,v=r.prefixes=[];b.each(l,function(a){var b=a["prefix-spec"].split("/"),b=v.push({prefix_ip:b[0],prefix_length:b[1],preferred_lifetime:a["preferred-lifetime"],valid_lifetime:a["valid-lifetime"]||
7200});q(a,v[b-1])})}}};(function(){for(var a=0,n;a<w.length;a++){n=w[a];var l={name:n.name,type:n.type,enabled:n.enabled};p="VLAN1"===n.name?!0:!1;if(n["vlan-interface-settings"]){var r=n["vlan-interface-settings"];l.vlan_id=r["vlan-id"];l.vlan_inter_vlan_routing=r["inter-vlan-routing"];l.vlan_enable_management=void 0!==r["enable-management"]?r["enable-management"]:p}n["vlan-settings"]&&(r=n["vlan-settings"],l.vlan_untagged_vlan_id=r["untagged-vlan-id"]||"",r["tagged-vlans"]&&(l.vlan_tagged_vlan_id=
r["tagged-vlans"]["vlan-id"]||[]));if(n.ipv4){var r=n.ipv4,v=l.ipv4={enabled:r.enabled};if(r.address){var s=r.address,k=v.address=[];b.each(s,function(a){k.push({ip:a.ip,prefix_length:a["prefix-length"]})})}}n.ipv6&&(r=n.ipv6,v=l.ipv6={enabled:r.enabled},r.address&&(s=r.address,k=v.address=[],b.each(s,function(a){var b=k.push({ip:a.ip,orig_ip:a.ip,prefix_length:a["prefix-length"]});q(a,k[b-1]);b=k[b-1];void 0!==a["eui-64"]&&(b.eui_64=a["eui-64"]);a["user-define"]&&(b.user_define=a["user-define"])})),
r.setting&&(s=r.setting,v.setting={dhcp_pd_enable:s["dhcp-pd-enable"],prefix_name:s["prefix-name"]}),e(r,l));n["lag-ref"]&&(l.lag_ref=n["lag-ref"]);n.dmz&&(r=n.dmz,v=l.dmz={enabled:r.enable});u.push(l)}})()};this.vlan_t_cfg_to_db=function(a,m){var w=a.interfaces||[];b.assign(m,{interfaces:{"interface":[]}});var u=m.interfaces.interface,p=function(a,b){void 0!==a["static"]&&(b["static"]=a["static"]);a.isp&&(b.isp={"interface":a.isp["interface"]})},q=function(a,b){void 0!==a.eui_64&&(b["eui-64"]=a.eui_64);
a.user_define&&(b["user-define"]=a.user_define)},e=function(a,e){if(a.ipv6_ra){var l=a.ipv6_ra;e=b.defaults(e,{ipv6:{}});var r=e.ipv6["ipv6-router-advertisements"]={"send-advertisements":l.enabled,mode:l.mode,"max-rtr-adv-interval":l.max_rtr_adv_interval,"managed-flag":l.managed_flag,"other-config-flag":l.other_config_flag,"router-preference":l.router_preference,"link-mtu":l.link_mtu,"default-lifetime":l.default_lifetime};if(l.prefixes){var l=l.prefixes,r=r["prefix-list"]={prefix:[]},v=r.prefix;b.each(l,
function(a){var b=v.push({"prefix-spec":a.prefix_ip+"/"+a.prefix_length,"preferred-lifetime":a.preferred_lifetime,"valid-lifetime":a.valid_lifetime});p(a,v[b-1])})}}};(function(){b.each(w,function(a){var n={name:a.name};a.type&&b.assign(n,{type:a.type,enabled:a.enabled});void 0!==a.vlan_id&&(n["vlan-interface-settings"]={"vlan-id":a.vlan_id,"inter-vlan-routing":a.vlan_inter_vlan_routing,"enable-management":a.vlan_enable_management});b.defaults(n,{"vlan-settings":{}});var l=n["vlan-settings"];l["untagged-vlan-id"]=
void 0!==a.vlan_untagged_vlan_id?a.vlan_untagged_vlan_id:"";if(a.vlan_tagged_vlan_id){b.defaults(n,{"vlan-settings":{"tagged-vlans":{}}});for(l=0;l<a.vlan_tagged_vlan_id.length;l++)a.vlan_tagged_vlan_id[l]+="";l=n["vlan-settings"];l["tagged-vlans"]["vlan-id"]=a.vlan_tagged_vlan_id}if(a.ipv4){var r=a.ipv4,l=n.ipv4={enabled:r.enabled};if(r.address){var r=r.address,v=l.address=[];b.each(r,function(a){v.push({ip:a.ip,"prefix-length":a.prefix_length})})}}if(a.ipv6&&(r=a.ipv6,l=n.ipv6={enabled:r.enabled},
r.address))for(var r=r.address,v=l.address=[],l=0,s;l<r.length;l++)if(s=r[l]){var k=v.push({ip:s.ip,"prefix-length":s.prefix_length});p(s,v[k-1]);q(s,v[k-1])}e(a,n);a.lag_ref&&(n["lag-ref"]=a.lag_ref);u.push(n)})})()};return this};app.controller("LanVlanSettingsCtrl",["$scope","$location","$timeout","$q","MyHttp","$templateCache","$filter","wan_service","Sets","UserSession","userAccessRight","DHCP_PD","addressPoolValidate","modelInfo",function(a,b,t,m,w,u,p,q,e,x,n,l,r,v){var s={source:"dproxy",getResult:function(a,b,c){return e.getResult(this,a,b,c)}};a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.flagPortEditable=!1;a.func_flag=a.func_flag||{ipv6_pd_with_6rd:!1,ipv6_layout:"DESIGN_0",ipv6_min_prefixlen:16,ipv6_addr1:!1,ipv6_ip_prefer_isp:!1,
ipv6_pd_undetermined_allow:!0};a.success=!1;a.loadReady=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&x.logout();var k={"ethernetCsmacd,lan":"LAN","ethernetCsmacd,wan":"WAN","svi,vlan":"VLAN","l2vlan,vlan":"VLAN"},d=a.fop={get_ip:function(a){return a.ip},set_ip:function(a,b){a.ip=b},get_prefixlen:function(a){return a.prefix_length},set_prefixlen:function(a,b){a.prefix_length=b},get_origin_mode:function(a){var b;a&&a["static"]?b="STATIC":a&&a.isp&&(a._ip_pd_subnetid=
a.isp.suffix,b="ISP");return b},set_origin_mode:function(a,b,c){"STATIC"===b?(a["static"]=null,a.isp=void 0):angular.isDefined(c.wan_ifname)?"ISP"===b&&(a["static"]=void 0,a.isp={"interface":c.wan_ifname,prefix_name:c.wan_username,suffix:c.subnetid}):(a["static"]=null,a.isp=void 0)},get_identifier:function(a){var b;a&&a.eui_64?b="EUI_64":a&&a.user_define&&(b="USER_DEFINE");return b},set_identifier:function(b){var c=b._type_if_ident,d=a.func_flag.ipv6_min_prefixlen||16,g=function(a,b){angular.isDefined(a)||
(a="");a.match(/::/)||(a="::"+a);var c=app.TOOLS.validation.ipv6_getNet("ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff",b),d="",d=z.parseIpaddr(a);if(!1===d)d="";else{for(var g=angular.copy(d),h=0,e;7>=h;h++)e=d.parts[h],g.parts[h]=e&~c[h];d=g.toString();d="::"===d.substr(0,2)?d.substr(2):d}return d};"ISP"===b._type?(c=b&&b._ip_pd_prx2,d=b&&b._ip_pd_prx.split("/")[1]||d,g=g(c,d),b.eui_64=void 0,b.user_define=g):"EUI_64"===c?(b.eui_64=null,b.user_define=void 0):"USER_DEFINE"===c&&(c=b&&b._if_ident,d=b&&
b.prefix_length||d,g=g(c,d),b.eui_64=void 0,b.user_define=g)},get_inter_vlan_routing:function(a){return a.vlan_inter_vlan_routing},set_inter_vlan_routing:function(a,b){a.vlan_inter_vlan_routing=b},get_vlan_id:function(a){return a.vlan_id},set_vlan_id:function(a,b){a.vlan_id=b},get_vlan_untagged_vlan_id:function(a){return a.vlan_untagged_vlan_id},set_vlan_untagged_vlan_id:function(a,b){a.vlan_untagged_vlan_id=b},get_vlan_tagged_vlan_id:function(a){return a.vlan_tagged_vlan_id},set_vlan_tagged_vlan_id:function(a,
b){a.vlan_tagged_vlan_id=b},clean_vlan_tagged_vlan_id:function(a){a.vlan_tagged_vlan_id.splice(0)},push_vlan_tagged_vlan_id:function(a,b){return a.vlan_tagged_vlan_id.push(b)},pop_vlan_tagged_vlan_id:function(a){return a.vlan_tagged_vlan_id.pop()},dhcp_dp:{get_dhcp_pd_prefix:function(a){if(a&&a.ipv6&&a.ipv6.dhcp_pd_prefix)return a.ipv6.dhcp_pd_prefix},get_dhcp_pd_prefix_full:function(a){if(a&&a.ipv6&&a.ipv6.dhcp_pd_prefix_full)return a.ipv6.dhcp_pd_prefix_full}}},c=function(){a.loadReady=!1;m.defer();
m.defer();m.defer();var b=function(a){var b=app.TOOLS.sortingInterfaceFn(!1);a.sort(b)};m.all({INTF:function(){return w.post({url:resource_base+"data/lan_vlan_membership.json",method:"get_vlan_membership",success:function(b){b&&(b.data&&""===b.data.result)&&(b.data.result={});var c={};P.vlan_t_db_to_cfg(b.data.result,c);c=c.interfaces;b.data.result={vlan:p("filter")(c,a.ifNamed("^VLAN")),lan:p("filter")(c,a.ifNamed("^LAN")),lag:p("filter")(c,a.ifNamed("^LAG")),wan:p("filter")(c,a.ifNamed("^WAN[0-9]($|.[0-9]+$)"))}},
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),INTF_state:function(){return w.post({url:resource_base+"data/system_summary.json",method:"get_interface_state",params:{filter:"VLAN"},options:{transformResponse:app.modelhelper.db2webFn},success:function(a){a&&(a.data&&""===a.data.result)&&(a.data.result={});e.default_result(a,{"interfaces-state":{"interface":[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+
a.config.url+" method: "+this.method)}})}(),WAN_IPv6:function(){return w.post({url:resource_base+"data/get_wan_ipv6_prefix.json",method:"get_wan_ipv6_prefix",options:{transformResponse:app.modelhelper.db2webFn},success:function(a){a&&(a.data&&""===a.data.result)&&(a.data.result={});e.default_result(a,{interfaces_state:{"interface":[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),StateSubnet:function(){return w.post({url:resource_base+
"data/get_subnet.json",method:"get_subnet",success:function(a){a&&(a.data&&""===a.data.result)&&(a.data.result={});e.default_result(a,{subnets:{ipv4:[],ipv6:[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}()}).then(function(c){a.model={};a.model.vlan_interfaces=s.getResult(c.INTF,"vlan");a.model.lan_interfaces=s.getResult(c.INTF,"lan");a.model.lag_interfaces=s.getResult(c.INTF,"lag");a.model.wan_interfaces=s.getResult(c.INTF,
"wan");a.model.vlan_ifstate=s.getResult(c.INTF_state,"interfaces_state");g();a.model.wan_ifstate=s.getResult(c.WAN_IPv6,"interfaces_state");a.func_flag.ipv6_pd_with_6rd&&h(c.cdb_IP6RD);b(a.model.vlan_interfaces);b(a.model.lan_interfaces);b(a.model.lag_interfaces);a.collect_wan_dhcp_pd();c=c.StateSubnet;c.data&&(c.data.result&&c.data.result.subnets&&c.data.result.subnets.ipv4&&c.data.result.subnets.ipv6)&&(a.subnetObj=angular.copy(c.data.result.subnets));a.gridVLAN.Options.data=a.model.vlan_interfaces;
a.schema=a.schema||{};a.schema.StatusMap={"true":a.DICT("VLAN_membership_Enabled"),"false":a.DICT("VLAN_membership_Disabled")};a.schema.portmodes=[{id:"U",displayName:a.DICT("VLAN_membership_Untagged")},{id:"T",displayName:a.DICT("VLAN_membership_Tagged")},{id:"X",displayName:a.DICT("VLAN_membership_Excluded")}];a.schema.portmodesHash={U:a.DICT("VLAN_membership_Untagged"),T:a.DICT("VLAN_membership_Tagged"),X:a.DICT("VLAN_membership_Excluded")};a.schema.ipv6_addr_sample={ip:"fec0:0001:0000:0000::",
prefix_length:64};a.schema.TYPE_STATIC="STATIC";a.schema.TYPE_ISP="ISP";a.ctx.HWDMZport=v.get_HWDMZport()||"LAN4";a.ctx.HWDMZenableCount=0;c=a.model.vlan_interfaces.concat(a.model.lan_interfaces).concat(a.model.lag_interfaces);for(var e=c.length-1,k;0<e;e--)if(k=c[e],k.name.match(/^LAN|^LAG/)){k.role="lan";null==d.get_vlan_tagged_vlan_id(k)&&d.set_vlan_tagged_vlan_id(k,[]);var l=k,z=d.get_vlan_tagged_vlan_id(l);if(z&&(z=angular.copy(z[0]))&&z.split){d.clean_vlan_tagged_vlan_id(l);for(var z=z.split(" "),
n=z.length;n--;)void 0!=z[n]&&d.push_vlan_tagged_vlan_id(l,parseInt(z[n]))}k.name.match("^"+a.ctx.HWDMZport+"$")&&(k.dmz&&!0==k.dmz.enabled)&&(a.ctx.HWDMZenable=!0,a.ctx.HWDMZenableCount=1)}else"VLAN"==k.name.substr(0,4)?(k.role="vlan",k.vlan_tagged_vlan_id&&delete k.vlan_tagged_vlan_id,k.vlan_untagged_vlan_id&&delete k.vlan_untagged_vlan_id):k.name.match(/^WAN\d+$|^WAN\d+\.\d+$/)?k.role="wan":k.name.match(/^DMZ/)&&c.splice(e,1);y();a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);
a.loadReady=!0})["catch"](function(a){console.log("=="+a)})},h=function(b){b=b.data.result.interfaces||[];b.length&&(a.model.ip6rd=[],angular.forEach(b,function(b,c){b.name.match(/^TUN/)&&("ip6rd"==b.type&&!0==b.enabled)&&a.model.ip6rd.push(b)}))},g=function(){a.use_interfaces_sample={interfaces:[]};e.recover_object(a.model,a.use_interfaces_sample);a.use_wan_interfaces_state_sample={wan_ifstate:{"interface":[]}};e.recover_object(a.model,a.use_wan_interfaces_state_sample);a.use_ipv6ra_prefix_list_sample=
{ipv6_ra:{prefixes:[]}};angular.forEach(a.model.vlan_interfaces,function(a,b){"VLAN"==a.name.substr(0,4)&&e.recover_object(a,{"vlan-interface-settings":{"inter-vlan-routing":!1,"enable-management":!1}});"VLAN"==a.name.substr(0,4)&&e.recover_object(a,{editVlanId:!1,info:E,edit:!1,editEnableManagement:!1,invalid:!1,checked:!1,ipv4:{enabled:!0,mtu:1400,address:[{ip:"",prefix_length:null}]},ipv6:{enabled:!0,mtu:1400,address:[{ip:"",prefix_length:null}]}})});angular.forEach(a.model.lan_interfaces,function(a,
b){("LAN"==a.name.substr(0,3)||"LAG"==a.name.substr(0,3))&&e.recover_object(a,{vlan_tagged_vlan_id:[],vlan_untagged_vlan_id:""})})},A=function(a,b){var c=a[b].address[0];a[b].enabled=""!=c.ip&&void 0!=c.ip&&null!=c.prefix_length&&0!=c.prefix_length?!0:!1},y=function(b){b=p("filter")(a.model.vlan_interfaces,B);angular.forEach(b,function(b,c){if(b.ipv6&&b.ipv6.address){var d=b.ipv6.address;d[0]&&(a.refreshIPv6Ctx(b,0),a.init_origin_type(d[0],b,!0));d[1]&&(a.refreshIPv6Ctx(b,1),a.init_origin_type(d[1],
b,!0),d[1].enabled=!0)}})},z={ipaddr:createIpAddr(),parseIpaddr:function(a){return!z.ipaddr.IPv6.isValid(a)?!1:z.ipaddr.parse(a)}};a.refreshIPv6Ctx=function(b,c){if(b.ipv6&&b.ipv6.address&&b.ipv6.address[c]&&b.ipv6.address[c].ip){for(var g=b.ipv6.address[c],h=g.ip,e=parseInt(g.prefix_length),h=z.parseIpaddr(h),k=angular.copy(h),l=angular.copy(h),y=0,n=128,B,s;0<n;)B=16<e?16:e,e-=B,0>e&&(e=0),s=65535^(1<<16-B)-1,B=(1<<16-B)-1,k.parts[y]=h.parts[y]&s,l.parts[y]=h.parts[y]&B,n-=16,y++;g._ip_prefix=k.toString();
g._if_ident=l.toString().substr(2);var h=z.parseIpaddr(g._ip_prefix),r=h.toNormalizedString().toLowerCase();g._ip_pd_prx=h.toNormalizedString().toLowerCase()+"/"+g.prefix_length;g._ip_pd_prx2=g._if_ident;a.PD_source?angular.forEach(a.PD_source,function(b,c){if(a.func_flag.ipv6_pd_undetermined_allow)b._WANname&&(g.isp&&g.isp["interface"]&&g.isp["interface"]===b._WANname)&&(g._ip_pd_obj=b);else{var h=d.dhcp_dp.get_dhcp_pd_prefix(b);h&&"function"===typeof h.split&&(h=h.split("/")[0],app.TOOLS.ipv6.toFullV6Addr(h).toLowerCase()==
r&&(g._ip_pd_obj=b))}}):Log(ERROR,"Error: PD_source not exist")}};a.update_ip_enable_status=function(a,b){A(a.entity,b)};a.collect_port_list=function(){var b=p("filter")(a.model.lan_interfaces,function(a,b,c){return a.name.match(/^LAN/)?!0:!1}),c=p("filter")(a.model.lag_interfaces,function(a,b,c){return a.name.match(/^LAG/)?!0:!1});return b.concat(c)};a.sync_vlanid=function(b,c){var g=d.get_vlan_id(c.entity)||"??",h="",e=!1,l;angular.forEach(a.model.vlan_interfaces,function(a,c){b===c?l=a:a.vlan_id===
g&&(e=!0)});"??"===g||e?(h="(Invalid)",l.invalid=!0):(h=k["l2vlan,vlan"]+g,l.invalid=!1);c.entity.name=h;a.update_v6_local_pd_ip(c.entity.ipv6.address[0],c.entity,!0);var h=c.rowIndex,z=c.entity,y,n,B=a.collect_port_list();if(null!=d.get_vlan_id(z))for(var s=B.length;s--;)y=B[s],n=s,a.update_port_vlan_model(h,n,z,y)};a.ifNamed=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};var B=function(a,b,c){return a.name.match(/^(VLAN)/)?!0:!1};a.collect_svi_ref_list=function(){return p("filter")(a.model.vlan_interfaces,
B)};a.update_v6_prefix_disabled=function(b){var c=!1;b._type!=a.schema.TYPE_STATIC&&(c=!1);b=b._type==a.schema.TYPE_STATIC&&"EUI_64"==b._type_if_ident;return c||b};a.pd_uallow=function(){return a.func_flag.ipv6_pd_undetermined_allow?!0:!1};a.pd_select_state=function(b){return b._type===a.schema.TYPE_STATIC?"static":"isp"};a.if_ident_disabled=function(b){return b._type==a.schema.TYPE_STATIC&&"EUI_64"==b._type_if_ident||!a.func_flag.ipv6_pd_undetermined_allow&&b._type!=a.schema.TYPE_STATIC?!0:!1};a.get_min_v6_prefixlen=
function(b){var c=a.func_flag.ipv6_min_prefixlen;if(a.func_flag.ipv6_pd_undetermined_allow)return c;var d=c;b._type==a.schema.TYPE_ISP&&b._ip_pd_prx&&(b=b._ip_pd_prx.split("/")[1]||c,d=parseInt(b));return Math.max(c,d)};a.update_v6_pd_obj=function(b,c){var g=d.dhcp_dp.get_dhcp_pd_prefix_full(b._ip_pd_obj);b._ip_pd_prx=g?g:void 0;a.update_v6_local_pd_ip(b,c,!1)};a.update_v6_local_pd_ip=function(b,c,g,h){var e=!1;if(a.func_flag.ipv6_pd_undetermined_allow)e=!1;else if(void 0==b._ip_pd_prx||""==b._ip_pd_prx)e=
!0;var k=d.get_vlan_id(c);if(k){if(!g||!b._ip_pd_prx_local)e?b._ip_pd_prx_local=!0:e||(b._ip_pd_prx_local=!1);if(b._ip_pd_prx_local){k=d.get_vlan_id(c);g=new I;var e=g.ipv6ToNumber("fec0:0000::"),l="";e.parts[1]=parseInt(k);l=g.numToIpv6Normal(e);b._ip_pd_prx=l+"/64"}}h?a.update_v6ip(b,c,void 0,{userDefPrefix:!0}):a.update_v6ip(b,c)};a.update_v6ip=function(b,c,g,h){var e=!1;h&&angular.isDefined(h.userDefPrefix)&&(e=h.userDefPrefix);var k=!0,l=function(c){c.parts.length!==n.parts.length&&console.log("Error: preview_v6ip, IPv6 part not correct");
var g=angular.copy(n),h;if(b._type==a.schema.TYPE_ISP){var e=d.dhcp_dp.get_dhcp_pd_prefix(b._ip_pd_obj);e?(e=e.split("/"),h=64,0<e.length&&(h=e[1]),h=parseInt(h)):h=64}else h=b.prefix_length;for(e=0;e<g.parts.length;e++)16<=h?(g.parts[e]=0,h-=16):(g.parts[e]&=(1<<16-h)-1>>>0,h=0);h=angular.copy(c);for(e=0;e<c.parts.length;e++)h.parts[e]=c.parts[e]|g.parts[e];return h.toString()};g=function(b){b._ip_pd_prx2="";if("USER_DEFINE"==b._type_if_ident){y=z.parseIpaddr(b._ip_prefix);n=z.parseIpaddr("::"+b._if_ident);
if(!1==y||!1==n)k=!1;k&&(b.ip=l(y),b.preview_ip=angular.copy(b.ip))}else if("EUI_64"==b._type_if_ident){b.prefix_length=64;for(var c=p("filter")(a.model.vlan_ifstate["interface"],a.ifNamed("^VLAN")),d=0;d<c.length;d++){var g=c[d];if(g.name.match(/^VLAN/)&&void 0!=g.phys_address){var h=b,g=g.phys_address.replace(/:/g,""),g=g.substr(0,4)+":"+g.substr(4,2)+"FF:FE"+g.substr(6,2)+":"+g.substr(8,4),e=parseInt(g.substr(0,2),16),e=0==(e&2)?e|2:e&253,g=e.toString(16)+g.substr(2),g=ipaddr.parse("::"+g).toString().toLowerCase();
h._suffix_eui64=g}}b._if_ident="";b._ip_pd_prx="";y=z.parseIpaddr(b._ip_prefix);n=z.parseIpaddr(b._suffix_eui64);if(!1==y||!1==n)k=!1;k&&(b.ip=l(y).toLowerCase(),b.preview_ip=angular.copy(b.ip))}};h=function(){b._ip_pd_prx=b._ip_pd_prx||"";b._suffix_eui64="";var c=0;a.func_flag.ipv6_pd_undetermined_allow?c=a.func_flag.ipv6_min_prefixlen:b._if_ident="";var d=b._ip_pd_prx.split("/")[0],g=b._ip_pd_prx.split("/")[1]||c;if(a.func_flag.ipv6_pd_undetermined_allow){var h=b._ip_pd_subnetid,B=b.prefix_length-
1,c=z.parseIpaddr("::"),s=B>>4,h=parseInt(h,16)<<15-B%16>>>0;c.parts[s]=h;s=0;for(h=7;0<=h;h--)c.parts[h]+=s,s=Math.floor(c.parts[h]>>>16),c.parts[h]=0===h&&65536<=c.parts[h]?65535:c.parts[h]%65536;d=z.parseIpaddr(d)||c;s=angular.copy(c);h=z.parseIpaddr(app.TOOLS.ipv6.prefixLen2FullAddr(parseInt(g)));g=z.parseIpaddr(app.TOOLS.ipv6.prefixLen2FullAddr(b.prefix_length));n=z.parseIpaddr("::"+b._if_ident);if(!1==c||!1==g||!1==d||!1==n)k=!1;if(k){for(B=0;B<g.parts.length;B++)g.parts[B]^=h.parts[B];for(h=
0;h<s.parts.length;h++)s.parts[h]&=g.parts[h];for(g=0;g<d.parts.length;g++)d.parts[g]|=s.parts[g];b.ip=l(c).toLowerCase();b.preview_ip=l(d).toLowerCase()}}else{e||(b.prefix_length=64);n=z.parseIpaddr("::"+b._ip_pd_prx2);if(!1==y||!1==n)k=!1;k&&(b.ip=l(y).toLowerCase(),b.preview_ip=l(y).toLowerCase())}};var y,n;b._type==a.schema.TYPE_STATIC?(g(b),d.set_origin_mode(b,"STATIC")):b._type==a.schema.TYPE_ISP&&(h(b),d.set_origin_mode(b,"ISP",{wan_ifname:b._ip_pd_obj&&b._ip_pd_obj._WANname||void 0,wan_username:b._ip_pd_obj&&
b._ip_pd_obj.name||void 0,subnetid:b._ip_pd_subnetid}));d.set_identifier(b);if(k){var B=angular.copy(b.ip);b.ip="";t(function(){b.ip=B;A(c,"ipv6");a.gridVLAN.chkIpv6Ip()},0)}else b.ip="",A(c,"ipv6"),a.gridVLAN.chkIpv6Ip()};a.ipv6_addr_create_elem=function(b,c,d,g){if(g=!0===g?!0:!1){var h=b[c]=angular.copy(a.schema.ipv6_addr_sample);h.ip="";h.isp={"interface":"WAN1"};h._type=a.schema.TYPE_ISP;h._ip_pd_obj=a.collect_wan_dhcp_pd()[0];a.update_v6_pd_obj(h,d)}else b[c]=void 0;b[c]&&(b[c].enabled=g)};
a.init_origin_type=function(b,c,g){angular.isDefined(b._type)||("ISP"===d.get_origin_mode(b)?b._type=a.schema.TYPE_ISP:b._type=a.schema.TYPE_STATIC,!0!==g&&t(function(){a.update_v6ip(b,c)},0));a.init_type_if_ident(b)};a.init_type_if_ident=function(a){null===a.eui_64&&(a._type_if_ident="EUI_64");angular.isDefined(a._type_if_ident)||(a._type_if_ident="USER_DEFINE")};a.intf_key_handler=function(a,b){b=parseInt(b);var c=!1,g=d.get_vlan_id(a);a&&("l2vlan"==a.type&&g==b)&&(c=!0);return c};a.isExistUnnamedVLANID=
function(a){var b=function(a,b,c){a=d.get_vlan_id(a.entity);return angular.isDefined(a)?!1:!0},c=[];a&&(a.Options&&a.Options.ngGrid&&a.Options.ngGrid.filteredRows)&&(c=p("filter")(a.Options.ngGrid.filteredRows,b));return 0<c.length};(function(){var b=a.func_flag.ipv6_layout,c={editRowH:6*(app.uiGrid.headerRowHeight||32),width:750,editableCellTemplate:u.get("T_vlan_membership_ipv6_address_edit.html")};"DESIGN_2"===b&&(c={editRowH:7*(app.uiGrid.headerRowHeight||32),width:800,editableCellTemplate:u.get("T_vlan_membership_ipv6_address_edit_DESIGN_2.html")});
return c})();a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridVLAN=a.gridVLAN||{};a.gridVLAN.Selections=[];a.gridVLAN.stateObj={editCount:0,editList:[]};a.gridVLAN.procNgClick=function(b){var c=0,d=[];a.gridVLAN.Selections.splice(0);angular.forEach(a.model.vlan_interfaces,function(b,g){b.checked?a.gridVLAN.Selections.push(b):(b.edit=!1,b.editVlanId=!1,b.editEnableManagement=!1);b.edit&&(c++,d.push(g))});a.gridVLAN.stateObj.editCount=c;a.gridVLAN.stateObj.editList=d;a.gridVLAN.check_remove_condition()};
a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};var D=function(a,b,c,d,g){for(var h=a.length,e,k=0,l;k<h;k++){l=a[k];e=!1;for(var z=0,y;z<h;z++)y=a[z],k!==z&&d&&d(y,l,g)&&(e=!0);!e&&c&&(e=c(l));l[b]=e}};a.gridVLAN.chkIpv6Ip=function(){var b=S,c=X,d=a.collect_svi_ref_list();D(d,"isDupIpv6a0",b,c,{v6_addrx:0});D(d,"isDupIpv6a1",b,c,{v6_addrx:1})};a.gridVLAN.chkIpv4Ip=function(){var b=N,c=J,d=a.collect_svi_ref_list();D(d,"isDupIpv4",b,c)};var E=v.spec_WifiSupport()?a.DICT("VLAN_membership_Device_Management_Note_1"):
a.DICT("VLAN_membership_Device_Management_Note_2");a.gridVLAN.Options=app.uiGrid.generateGridOptions({IDPreifx:"VLANMembership",rowHeight:a.func_flag.ipv6_addr1?2*app.uiGrid.rowHeight:3*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridVLAN.procNgClick,headerChangedCbk:a.gridVLAN.procNgClick,disableChkBoxField:"disableChk"},{field:"vlan_id",displayName:a.DICT("VLAN_membership_VLAN_ID"),id:"VLANMembershipID",validationCbk:"gridInvalidCbk",min:1,max:4093,required:!0,changedCbk:a.sync_vlanid,
editRow:"editVlanId",width:90,invalidField:"invalid",cellTemplate:u.get("UG_table_text_with_inline_number_edit.html")},{field:"name",displayName:a.DICT("VLAN_membership_Name"),width:90},{field:"vlan_inter_vlan_routing",displayName:a.DICT("VLAN_membership_Inter_VLAN_Routing"),id:"VLANMembershipRouting",cellTemplate:u.get("UG_table_checkbox_with_inline_edit.html"),editRow:"edit",width:155},{field:"vlan_enable_management",displayName:a.DICT("VLAN_membership_Device_Managemenet"),id:"VLANMembershipEnableManagement",
cellTemplate:u.get("UG_table_checkbox_with_inline_edit.html"),editRow:"editEnableManagement",width:160,infoField:"info"},{field:"ipv4.address",displayName:a.DICT("VLAN_membership_IPv4_Addr_Mask"),id:"VLANMembershipIPv4",validationCbk:"gridInvalidCbk",cellTemplate:u.get("T_vlan_membership_ipv4_address_edit.html"),editRow:"edit",minWidth:250,width:250},{field:"ipv6.address",displayName:a.DICT("VLAN_membership_IPv6_Addr_Mask"),id:"VLANMembershipIPv6",validationCbk:"gridInvalidCbk",cellTemplate:u.get("T_vlan_membership_ipv6_address_edit.html"),
editRow:"edit",minWidth:600}]});var C=function(b,c){var g=p("filter")(a.model.lan_interfaces,a.ifNamed("^LAN|^LAG"));angular.forEach(g,function(a,g){var h=d.get_vlan_tagged_vlan_id(a);if(h){var e=d.get_vlan_id(b),e=void 0!==e||null!==e?e:"",k=h.indexOf(e);-1==k?"add"==c&&h.push(e):"remove"==c&&h.splice(k,1)}})},I=function(){var a=this,b=createIpAddr();a.ipaddr=b;a.addrObj=void 0;a.parseIpv6addr=function(a){return!b.IPv6.isValid(a)?!1:b.parse(a)};a.ipv6ToNumber=function(b){b=a.parseIpv6addr(b);return a.addrObj=
b};a.numToIpv6=function(b){if(b)return b.toString().toLowerCase();if(a.addrObj)return a.addrObj.toString().toLowerCase()};a.numToIpv6Normal=function(b){if(b)return b.toNormalizedString().toLowerCase();if(a.addrObj)return a.addrObj.toNormalizedString().toLowerCase()};return a},G=function(){var b=32-a.ctx.HWDMZenableCount,c=a.collect_svi_ref_list().length||0,d=a.DICT("VLAN_membership_Vlan_Intf");return c>=b?(a.msg=a.DICT("VLAN_membership_DMZ_Max",{"%s0":a.ctx.HWDMZenableCount?a.DICT("VLAN_membership_DMZ_Enabled"):
"","%s1":b,"%s2":d}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.gridVLAN.add=function(){if(!G()){var b=a.model.vlan_interfaces;a.collect_svi_ref_list();var c;c={name:"VLAN0",type:"l2vlan",enabled:!0,vlan_id:0,editVlanId:!0,edit:!0,editEnableManagement:!0,vlan_inter_vlan_routing:!1,vlan_enable_management:!1,ipv4:{enabled:!0,mtu:1400,address:[{ip:"",subnet:"",prefix_length:null}]},ipv6:{enabled:!0,forwarding:!1,address:[angular.copy(a.schema.ipv6_addr_sample)],setting:{dhcp_pd_enable:!0}},
ipv6_ra:{max_rtr_adv_interval:30},dot1x:{enable:!0,authorized_mode:"auto"},checked:!0,info:E};var g=new I;if(c.ipv6&&c.ipv6.address&&c.ipv6.address[0]&&c.ipv6.address[0].ip){var h=c.ipv6.address[0],e=g.ipv6ToNumber(h.ip);U(c.ipv6.address[0],["^_"],!0);e.parts[1]+=b.length%65535;h._ip_prefix=g.numToIpv6(e);h._if_ident="1"}c._db_exist&&delete c._db_exist;c.vlan_ref&&delete c.vlan_ref;d.set_vlan_id(c,"");c.name=k["l2vlan,vlan"]+"";b.push(c);C(c,"add");a.init_origin_type(c.ipv6.address[0],c);a.gridVLAN.Options.gridApi.customApi.scrollToLast();
a.modified()}};a.gridVLAN.edit=function(){for(var b=a.gridVLAN.Options.data,c=0,d=[],g=b.length-1,h;0<=g;g--)h=b[g],h.checked&&(h.edit=!0,"VLAN1"!==h.name&&(h.editEnableManagement=!0),c++,d.push(g));a.gridVLAN.stateObj.editList=d;t(function(){a.gridVLAN.stateObj.editCount=c},0)};a.gridVLAN.VLAN1Exsit=!1;a.gridVLAN.check_remove_condition=function(){var b=!1,c=a.gridVLAN.Selections;a.gridVLAN.VLAN1Exsit=!1;angular.forEach(c,function(c,d){"VLAN1"==c.name&&(b=!0,a.gridVLAN.VLAN1Exsit=!0)});return b};
a.gridVLAN.remove=function(){var b=[];angular.forEach(a.model.vlan_interfaces,function(a){a.checked&&b.push(a)});a.gridVLAN.checking_before_remove(b,function(){var b=a.model.vlan_interfaces,c;for(c=b.length-1;0<=c;c--)b[c].checked&&(C(b[c],"remove"),b.splice(c,1),H());a.modified()})};var H=function(){var b=function(b){angular.forEach(b,function(a,b){var c=a[".ctx"].port_vlan_map,d;for(d in c)"U"!==c[d]&&(c[d]="U")});var c,g,h=a.collect_port_list();angular.forEach(b,function(b,e){if(null!=d.get_vlan_id(b))for(var k=
h.length;k--;)c=h[k],g=k,a.update_port_vlan_model(e,g,b,c)})},c=a.collect_svi_ref_list();1>=c.length&&b(c);a.gridVLAN.chkIpv4Ip();a.gridVLAN.chkIpv6Ip();a.gridVLAN.procNgClick()};a.gridVLAN.checking_before_remove=function(b,c){a.ctx_delref=a.ctx_delref||{};a.ctx_teleworker=a.ctx_teleworker||{};a.ctx_accessrules=a.ctx_accessrules||{};var d=function(d){var g=!0;d="";for(var h=[{dispStr:"DHCP Settings",refctx:a.ctx_delref["dhcp-pool"]["dhcp-interfaces"],chk_cb:function(a,b){return a.name==b["interface"]}},
{dispStr:"Teleworker VPN Client",refctx:a.ctx_teleworker["teleworker-vpn-clients"]["teleworker-vpn-client"],chk_cb:function(a,b){return a.name=="VLAN"+b.vlan}},{dispStr:"Firewall ACL Rules",refctx:a.ctx_accessrules["firewall-acl-rules"].ipv4["firewall-acl-rule"],chk_cb:function(a,b){return b["interface"]&&b["interface"]["source-interface"]&&a.name==b["interface"]["source-interface"]}}],e=function(a,b,c){angular.forEach(a.refctx,function(d,h){b&&(b.checked&&a.chk_cb(b,d))&&(c.push(a.dispStr),g=!1)})},
k=b.length;k--;){var l=[];e(h[0],b[k],l);e(h[1],b[k],l);e(h[2],b[k],l);0<l.length&&(d+="<div>"+a.DICT("VLAN_membership_VLAN_In_Use",{"%s1":b[k].name,"%s2":"</br>"+l.join("\n")})+"</div></br>")}""!==d&&app.TOOLS.criticalAlertBox({title:a.DICT("Error"),msg:d});g&&c()};if(a.ctx_delref["dhcp-pool"])d();else{var g=function(a,b){a&&(a.data&&a.data.result)&&e.recover_object(a.data.result,b)};m.all({dhcp:function(){return w.post({url:resource_base+"data/lan_dhcp_settings.json",method:"get_dhcp_settings",
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),teleworker:function(){return w.post({url:resource_base+"data/telework_vpn_clients.json",method:"get_teleworker_vpn",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),accessrules:function(){return w.post({url:resource_base+"data/firewall_access_rules.json",method:"get_access_rules",error:function(a){Log(ERROR,"accessRulesCtrl getData error: "+
JSON.stringify(a))}})}()}).then(function(b){g(b.dhcp,{"dhcp-pool":{"dhcp-interfaces":[],"dhcp-option82":[]}});g(b.teleworker,{"teleworker-vpn-clients":{"teleworker-vpn-client":[]}});g(b.accessrules,{"firewall-acl-rules":{ipv4:{"firewall-acl-rule":[]}}});angular.extend(a.ctx_delref,b.dhcp.data.result);angular.extend(a.ctx_teleworker,b.teleworker.data.result);angular.extend(a.ctx_accessrules,b.accessrules.data.result)}).then(function(){d()})}};a.tag_status=function(a,b,c,g){var h=d.get_vlan_id(a),e=
"?";if(d.get_vlan_untagged_vlan_id(b)==h)e="U";else{var k=!1,e="X";(a=d.get_vlan_tagged_vlan_id(b))&&angular.forEach(a,function(a,b){a==h?(e="T",k=!0):k||(e="X")})}return e};a.filter_LAN=function(b,c,d){return b.name.match(/^LAN/)?(void 0!==b.lag_ref&&(a.ctx.inused_lag.push(b.lag_ref),b._greyout=!0),!0):!1};a.filter_LAG=function(b,c,d){return b.name.match(/^LAG/)&&!1!=b.enabled?(0<=a.ctx.inused_lag.indexOf(b.name)||(b._greyout=!0),!0):!1};a.collect_vlan_port_ref_list=function(){a.ctx.inused_lag=[];
var b=p("filter")(a.model.lan_interfaces,a.filter_LAN),c=p("filter")(a.model.lag_interfaces,a.filter_LAG);return b.concat(c)};a.collect_wan=function(){a.filterWANphy={physical:!0,subinterface:!0};return q.filter(a.model.wan_ifstate["interface"],a.filterWANphy)};a.collect_wan_dhcp_pd=function(){var b=a.model.wan_interfaces,c=a.model.wan_ifstate["interface"];a.PD_source||(a.PD_source=l.get_pd_interfaces(b,c));return a.PD_source};a.pd_dispStr=function(a){var b="unavailable",c=d.dhcp_dp.get_dhcp_pd_prefix(a);
c&&(b=c);return a._WANPrefixName+" ("+a._WANname+") - "+b};a.pd_disableCond=function(b){if(a.func_flag.ipv6_pd_undetermined_allow)return!1;d.dhcp_dp.get_dhcp_pd_prefix(b);return!0};a.showLagOwnerStatus=function(b,c){if(c[".ctx"]&&c[".ctx"].port_vlan_map){for(var d=b.lag_ref,g=4,h=a.collect_vlan_port_ref_list(),e=0,k;e<h.length;e++)k=h[e]&&h[e].name,k==d&&(g=e);return a.schema.portmodesHash[c[".ctx"].port_vlan_map[g]]||"(Member of "+d+", but LAG not found)"}};a.update_port_vlan_model=function(b,c,
g,h){var e=a.collect_svi_ref_list();"U"==g[".ctx"].port_vlan_map[c]&&(angular.forEach(e,function(a,b){a.name!=g.name&&"U"==a[".ctx"].port_vlan_map[c]&&(a[".ctx"].port_vlan_map[c]="T")}),d.set_vlan_untagged_vlan_id(h,d.get_vlan_id(g)));var k=!1;d.set_vlan_tagged_vlan_id(h,[]);angular.forEach(e,function(a,b){var g=a[".ctx"].port_vlan_map[c];"T"==g?d.push_vlan_tagged_vlan_id(h,d.get_vlan_id(a)):"U"==g&&(k=!0)});!1==k&&d.set_vlan_untagged_vlan_id(h,"");"ieee8023adLag"==h.type&&F(b,c,g,h)};var F=function(b,
c,d,g){for(var h=a.collect_vlan_port_ref_list(),e=d[".ctx"].port_vlan_map[c],k=0;k<h.length;k++)c=h[k],"ethernetCsmacd"==c.type&&c.lag_ref==g.name&&(d[".ctx"].port_vlan_map[k]=e,a.update_port_vlan_model(b,k,d,c))},K=function(a){for(var b=a%256,c=1;3>=c;c++)a=Math.floor(a/256),b=a%256+"."+b;return b},M=function(a,b){var c=a.split("."),d=32-b,c=(c[0]<<24|c[1]<<16|c[2]<<8|c[3])>>>0>>d<<d>>>0;return{beg:c,end:(c|(1<<d)-1)>>>0}},N=function(b){var c=!1;if(b&&b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].ip&&
b.ipv4.address[0].prefix_length){var d=b.ipv4.address[0],g=M(d.ip,d.prefix_length),d=K(g.beg),g=K(g.end);!1===r.poolValidate("interfaces",b.name,"ipv4",a.subnetObj,d,g,{skipCond:[{type:"interfaces",name:/^VLAN/}]})&&(c=!0)}return c},J=function(a,b){var c=!1;if(a&&b&&a.ipv4&&b.ipv4&&a.ipv4.address&&b.ipv4.address&&a.ipv4.address[0]&&b.ipv4.address[0]&&a.ipv4.address[0].ip&&b.ipv4.address[0].ip&&a.ipv4.address[0].prefix_length&&b.ipv4.address[0].prefix_length){var d=b.ipv4.address[0],g=a.ipv4.address[0],
h=M(d.ip,d.prefix_length),d=h.beg,h=h.end,e=M(g.ip,g.prefix_length),g=e.beg,e=e.end,k=!0;d<=g&&h>=e?k=!1:d<=g&&h>=g?k=!1:d<=e&&h>=e?k=!1:d>=g&&h<=e&&(k=!1);!1==k&&(c=!0)}return c},R=function(a){if(8!==a.length)console.log("error: ip6part.length = "+a.length);else{for(var b,c=[],d=0;7>=d;d++)b=a[d]||0,c.push(b.toString(16));return c.join(":")}},W=function(a,b){for(var c=app.TOOLS.validation.ipv6_getNet(a,b),d=angular.copy(c),g=[0,0,0,0,0,0,0,0],h=128-b,e=7;0<h;)16<=h?(g[e]=65535,h-=16):(g[e]|=(1<<
h)-1>>>0,h=0),e--;for(e=0;e<d.length;e++)d[e]|=g[e];return{beg:c,end:d}},S=function(b){var c=!1;if(b&&b.ipv6&&b.ipv6.address&&b.ipv6.address[0]&&b.ipv6.address[0].ip&&b.ipv6.address[0].prefix_length){var d=b.ipv6.address[0],g=W(d.ip,d.prefix_length),h=R(g.beg).toLowerCase(),g=R(g.end).toLowerCase();b=r.poolValidateV6("interfaces",b.name,"ipv6",a.subnetObj,h,g,{skipCond:[{type:"interfaces",name:/^VLAN/}]});var e=!1,d=app.TOOLS.ipv6.toFullV6Addr(d.ip).toLowerCase();if(h==d||g==d)e=!0;if(!1===b||!0===
e)c=!0}return c},X=function(a,b,c){var d=!1,g=!1,h=!1,e=function(a,b){if(a&&b&&a.ip&&b.ip&&a.prefix_length&&b.prefix_length){var c=W(a.ip,a.prefix_length),d=R(c.beg).toLowerCase(),c=R(c.end).toLowerCase(),d=app.TOOLS.ipv6.toFullV6ZPAddr(d).toLowerCase(),c=app.TOOLS.ipv6.toFullV6ZPAddr(c).toLowerCase(),g=W(b.ip,b.prefix_length),h=R(g.beg).toLowerCase(),g=R(g.end).toLowerCase(),h=app.TOOLS.ipv6.toFullV6ZPAddr(h).toLowerCase(),g=app.TOOLS.ipv6.toFullV6ZPAddr(g).toLowerCase(),e=!1;d<=h&&c>=g?e=!0:d<=
h&&c>=h?e=!0:d<=g&&c>=g?e=!0:d>=h&&c<=g&&(e=!0);return e}return!1};a&&(b&&a.ipv6&&b.ipv6&&a.ipv6.address&&b.ipv6.address)&&(h=!0);b&&(b.ipv6&&b.ipv6.address&&1<b.ipv6.address.length)&&(g=!0);!d&&g&&(rowE_addrs=b.ipv6.address,!0===e(rowE_addrs[0],rowE_addrs[1])&&(d=!0));if(!d&&h&&(rowE_addrs=b.ipv6.address,item_addrs=a.ipv6.address,b=c&&c.v6_addrx||0,a=e(rowE_addrs[b],item_addrs[0]),e=e(rowE_addrs[b],item_addrs[1]),!0===a||!0===e))d=!0;return d},T=function(b,c){return function(b){if(!b)return!0;a.collect_svi_ref_list();
return{result:!0,invalidRows:[],validRows:[]}}};a.poolValidation=function(a){var b;"ipv6"==a?(a=S,b=X):(a=N,b=J);return T(a,b)};var L=function(a,b,c,d){var g=[],h;angular.forEach(a,function(a,e){h=!1;angular.forEach(b,function(b,g){d?d(a[c],b[c])&&(h=!0):a[c]===b[c]&&(h=!0)});if(!h){var k={};k[c]=a[c];g.push(k)}});return g},U=function(a,b,c){for(var d=0;d<b.length;d++)if(c)for(var g in a)g.match(b[d])&&delete a[g];else for(g in a)g==b[d]&&delete a[g]},V=function(a,b){if(a[b]&&a[b].address&&a[b].address[0]){var c=
a[b].address[0];U(c,["^_"],!0);null==c.prefix_length&&(c.prefix_length="")}};a.save=function(){var g=a.model.vlan_interfaces.concat(a.model.lan_interfaces).concat(a.model.lag_interfaces),h=angular.copy(g);angular.forEach(h,function(b,c){U(b,["vlan_ref",".ctx","role"]);if(b.ipv6&&b.ipv6.address)for(var g=b.ipv6.address,h=0;h<g.length;h++){var k=g[h];if(k){var l="",y="",n=k._type;if("ISP"===n){for(var l=z.parseIpaddr(k.ip),y=k.prefix_length,B=0;B<l.parts.length;B++)16<=y?y-=16:1<y&&16>y?(l.parts[B]&=
65535-((1<<16-y)-1)>>>0,y=0):l.parts[B]=0;l=l.toString();y=k.prefix_length}else"STATIC"===n&&(l=k._ip_prefix,y=k.prefix_length);n&&l&&(e.recover_object(b,a.use_ipv6ra_prefix_list_sample),l=b.ipv6_ra.prefixes.push({prefix_ip:l,prefix_length:y,preferred_lifetime:3600}),d.set_origin_mode(b.ipv6_ra.prefixes[l-1],n,{wan_ifname:k.isp&&k.isp["interface"]||void 0,wan_username:k._ip_pd_obj&&k._ip_pd_obj.name||void 0,subnetid:k._ip_pd_subnetid}))}}V(b,"ipv4");V(b,"ipv6");void 0!=b._greyout&&delete b._greyout;
void 0!=b.dmz&&delete b.dmz;angular.isDefined(b.checked)&&delete b.checked;angular.isDefined(b.disableChk)&&delete b.disableChk;angular.isDefined(b.info)&&delete b.info;if("http"===s.source){if(g=d.get_vlan_tagged_vlan_id(b))g=angular.copy(g),d.set_vlan_tagged_vlan_id(b,[g.join(" ")])}else(g=d.get_vlan_tagged_vlan_id(b))&&0===g.length&&d.set_vlan_tagged_vlan_id(b,[""])});var k=L(a.model_orig.vlan_interfaces,a.model.vlan_interfaces,"name"),l=function(a,b){var c=z.parseIpaddr(a),d=z.parseIpaddr(b);
return angular.equals(c,d)},g=function(b,c){angular.forEach(a.model.vlan_interfaces,function(d,g){angular.forEach(a.model_orig.vlan_interfaces,function(a,g){if(d.name==a.name&&d[b]&&d[b].address&&0<d[b].address.length&&a[b]&&a[b].address&&0<a[b].address.length){var h=void 0,e=[];"ipv6"==b&&(h=l);e=L(a[b].address,d[b].address,"ip",h);0<e.length&&(e[0]&&""!=e[0].ip)&&(h={name:d.name},h[b]={address:e},c.push(h))}})})},y=[];g("ipv4",y);g("ipv6",y);var n=function(a,b){var c;angular.forEach(a,function(a,
d){b==a.name&&(c=a)});return c},r=function(c,d){var g=n(h,c).ipv4.address[0].ip,e=b.absUrl().replace(d,g),k=function(){t(function(){window.location=e},1E3)};app.TOOLS.criticalAlertBox({msg:"Attempting to redirect to the URL: "+e,btn_yes_str:a.DICT("Click_to_Redirecting"),btn_no_str:a.DICT("Cancel"),cbk:function(a){k();app.transition.In()}});app.transition.Out()},A=!1,v,F,J=function(){var a={redir_flag:!1};F=b.host();if(y[0]&&y[0].ipv4&&y[0].ipv4.address&&y[0].ipv4.address[0]&&y[0].ipv4.address[0].ip){var c=
y[0].ipv4.address[0].ip;v=y[0].name;F==c&&(A=!0,c=n(h,v).ipv4.address[0].ip,a.redir_flag=!0,a.admin_if_name=v,a.currIp=F,a.newIp=c)}return a},q=[],x=function(){var a={};P.vlan_t_cfg_to_db({interfaces:h},a);a.interfaces["interface"].concat([]);q.push({method:"set_vlan_membership",params:a})},E=function(){var b=function(){!0==A?r(v,F):(c(),a.reset_state());a.resetModified()},d=function(){var a=2,b=p("filter")(h,B).length||0,a=a+(1*(k.length||0)+(3*b+0*((h.length||0)-b)));return 1E3*a};0<k.length&&q.push({method:"del_interface",
params:{interfaces:{"interface":k}}});x();(function(){w.post({forcedUsingPost:!0,url:resource_base+"data/rpc_result.json",method:"set_bulk",params:q,timeout:A?d():void 0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method);0===a.status&&b()}}).then(function(c){c.data.result&&c.data.result.code&&0!==c.data.result.code?(A=!1,c="Can not delete, following Tables is in use:<br/>"+c.data.result.errstr+"<br/><br/>",app.TOOLS.criticalAlertBox({msg:c+
"Apply failed, and reloading settings from device",cbk:function(a){b()}})):(a.success=!0,b())})})()};(function(){var b=J();if(b.redir_flag){var c="Notice: This device's management IP address "+b.admin_if_name+"("+b.currIp+") is requested to change.<br/><br/>",c=c+"Please update Browser's location bar with new IP address "+(" <em>"+b.newIp+"</em> "),c=c+" when your networking environment is ready.<br/>",c=c+" Continue?";app.TOOLS.warningAlertBox({msg:c,cbk:function(a){a&&E()},btn_yes_str:a.DICT("VLAN_membership_Click_to_Redirect"),
btn_no_str:a.DICT("Cancel")})}else E()})()};a.reset_state=function(){a.ctx_delref={};a.ctx.flagPortEditable=!1};a.cancel=function(){c();a.reset_state();a.resetModified()};var P=new data_transform_vlan({Sets:e});c()}]);
var data_transform_vlan=function(a){if(!b||!b.VERSION)var b={each:angular.forEach,assign:$.extend,defaults:function(b,m){a.Sets.recover_object(b,m);return b}};this.vlan_t_db_to_cfg=function(a,m){var w=(a.interfaces||{})["interface"]||[];m=m||{};var u=m.interfaces=[],p=!1,q=function(a,b){void 0!==a["static"]&&(b["static"]=a["static"]);if(a.isp){var e=a.isp,r=e.suffix&&e.suffix.toString(16).toUpperCase();b.isp={"interface":e["interface"],prefix_name:e["prefix-name"],suffix:r||"0"}}},e=function(a,e){if(a["ipv6-router-advertisements"]){var l=
a["ipv6-router-advertisements"],r=e.ipv6_ra={enabled:l["send-advertisements"],mode:l.mode,max_rtr_adv_interval:l["max-rtr-adv-interval"],managed_flag:l["managed-flag"],other_config_flag:l["other-config-flag"],router_preference:l["router-preference"],link_mtu:l["link-mtu"],default_lifetime:l["default-lifetime"]};if(l["prefix-list"]&&l["prefix-list"].prefix){var l=l["prefix-list"].prefix,v=r.prefixes=[];b.each(l,function(a){var b=a["prefix-spec"].split("/"),b=v.push({prefix_ip:b[0],prefix_length:b[1],
preferred_lifetime:a["preferred-lifetime"]});q(a,v[b-1])})}}};(function(){for(var a=0,n;a<w.length;a++){n=w[a];var l={name:n.name,type:n.type,enabled:n.enabled};p="VLAN1"===n.name?!0:!1;if(n["vlan-interface-settings"]){var r=n["vlan-interface-settings"];l.vlan_id=r["vlan-id"];l.vlan_inter_vlan_routing=r["inter-vlan-routing"];l.vlan_enable_management=void 0!==r["enable-management"]?r["enable-management"]:p}n["vlan-settings"]&&(r=n["vlan-settings"],l.vlan_untagged_vlan_id=r["untagged-vlan-id"]||"",
r["tagged-vlans"]&&(l.vlan_tagged_vlan_id=r["tagged-vlans"]["vlan-id"]||[]));if(n.ipv4){var r=n.ipv4,v=l.ipv4={enabled:r.enabled};if(r.address){var s=r.address,k=v.address=[];b.each(s,function(a){k.push({ip:a.ip,prefix_length:a["prefix-length"]})})}}n.ipv6&&(r=n.ipv6,v=l.ipv6={enabled:r.enabled},r.address&&(s=r.address,k=v.address=[],b.each(s,function(a){var b=k.push({ip:a.ip,preview_ip:a.ip,prefix_length:a["prefix-length"]});q(a,k[b-1]);b=k[b-1];void 0!==a["eui-64"]&&(b.eui_64=a["eui-64"]);a["user-define"]&&
(b.user_define=a["user-define"])})),r.setting&&(s=r.setting,v.setting={dhcp_pd_enable:s["dhcp-pd-enable"],prefix_name:s["prefix-name"]}),e(r,l));n["lag-ref"]&&(l.lag_ref=n["lag-ref"]);n.dmz&&(r=n.dmz,v=l.dmz={enabled:r.enable});u.push(l)}})()};this.vlan_t_cfg_to_db=function(a,m){var w=a.interfaces||[];b.assign(m,{interfaces:{"interface":[]}});var u=m.interfaces.interface,p=function(a,b){void 0!==a["static"]&&(b["static"]=a["static"]);if(a.isp){var e=a.isp,r=e.suffix&&parseInt(e.suffix,16);b.isp={"interface":e["interface"],
suffix:r}}},q=function(a,b){void 0!==a.eui_64&&(b["eui-64"]=a.eui_64);a.user_define&&(b["user-define"]=a.user_define)},e=function(a,e){if(a.ipv6_ra){var l=a.ipv6_ra;e=b.defaults(e,{ipv6:{}});var r=e.ipv6["ipv6-router-advertisements"]={"send-advertisements":l.enabled,mode:l.mode,"max-rtr-adv-interval":l.max_rtr_adv_interval,"managed-flag":l.managed_flag,"other-config-flag":l.other_config_flag,"router-preference":l.router_preference,"link-mtu":l.link_mtu,"default-lifetime":l.default_lifetime};if(l.prefixes){var l=
l.prefixes,r=r["prefix-list"]={prefix:[]},v=r.prefix;b.each(l,function(a){var b=v.push({"prefix-spec":a.prefix_ip+"/"+a.prefix_length,"preferred-lifetime":a.preferred_lifetime});p(a,v[b-1])})}}};(function(){b.each(w,function(a){var n={name:a.name};a.type&&b.assign(n,{type:a.type,enabled:a.enabled});void 0!==a.vlan_id&&(n["vlan-interface-settings"]={"vlan-id":a.vlan_id,"inter-vlan-routing":a.vlan_inter_vlan_routing,"enable-management":a.vlan_enable_management});b.defaults(n,{"vlan-settings":{}});var l=
n["vlan-settings"];l["untagged-vlan-id"]=void 0!==a.vlan_untagged_vlan_id?a.vlan_untagged_vlan_id:"";if(a.vlan_tagged_vlan_id){b.defaults(n,{"vlan-settings":{"tagged-vlans":{}}});for(l=0;l<a.vlan_tagged_vlan_id.length;l++)a.vlan_tagged_vlan_id[l]+="";l=n["vlan-settings"];l["tagged-vlans"]["vlan-id"]=a.vlan_tagged_vlan_id}if(a.ipv4){var r=a.ipv4,l=n.ipv4={enabled:r.enabled};if(r.address){var r=r.address,v=l.address=[];b.each(r,function(a){v.push({ip:a.ip,"prefix-length":a.prefix_length})})}}if(a.ipv6&&
(r=a.ipv6,l=n.ipv6={enabled:r.enabled},r.address))for(var r=r.address,v=l.address=[],l=0,s;l<r.length;l++)if(s=r[l]){var k=v.push({ip:s.ip,"prefix-length":s.prefix_length});p(s,v[k-1]);q(s,v[k-1])}e(a,n);a.lag_ref&&(n["lag-ref"]=a.lag_ref);u.push(n)})})()};return this};app.controller("VLANSettingsCtrl",["$scope","MyHttp","DHCP_PD","ipv6_lib","ipv4_lib","subnet_lib","$q","UserSession","userAccessRight","modelInfo","$templateCache",function(a,b,t,m,w,u,p,q,e,x,n){var l=app.TOOLS.getResponse,r=app.TOOLS.getVal,v=app.TOOLS.str2int,s=app.TOOLS.netmask.int2Inet,k=app.TOOLS.netmask.inet2Int,d=createIpAddr(),c=app.TOOLS.int2BinaryMask,h=x.spec_WifiSupport()?a.DICT("VLAN_membership_Device_Management_Note_1"):a.DICT("VLAN_membership_Device_Management_Note_2"),g,A=function(){g&&
clearTimeout(g);g=setTimeout(function(){app.TOOLS.apply(a);g=void 0},50)};a.userAccessFlag=e.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&q.logout();var y=function(){return b.post({url:resource_base+"data/lan_vlan_membership.json",method:"get_vlan_membership",error:function(a){Log(ERROR,"[VLANSettingsCtrl] getVLANMembership() error:"+JSON.stringify(a))}})},z=function(b){b||(b={});var c=J(),d=!1,g=b["vlan-interface-settings"]||{},d="VLAN1"===b.name?!0:!1,d={checked:!1,edit:!1,edit_mgnt:!1,
edit_new:!1,is_new:!1,vld:{invalid:!1,id:!1,v4RANSubS:!1,v4RANSubE:!1,v4RANIP:!1,v6RANSubS:!1,v6RANSubE:!1,v6RANIP:!1,v4OverlapWithOtherVlans:!1,v6OverlapWithOtherVlans:!1,v4OverlapWithOtherFeatrues:!1,v6OverlapWithOtherFeatrues:!1},tags:E(),name:r(b.name,""),description:r(b.description,""),enabled:r(b.enabled,!0),info:h,if_setting:{vlan_id:r(g["vlan-id"],""),inter_vlan_routing:r(g["inter-vlan-routing"],!0),enable_management:r(g["enable-management"],d)},pool_id:"",ipv4:{},ipv6:{},empty:""};(function(a,
b){var d=b.ipv4||{},d=d.address&&d.address[0]||{},d={enabled:!0,ip:r(d.ip,""),prefix_len:v(r(d["prefix-length"],24)),netmask:"",last_ip:"",first_ip:"",display:[],dhcp:c.ipv4};0===d.prefix_len&&(d.prefix_len=24);d.ip&&_.isNumber(d.prefix_len)&&(d.last_ip=w.get_last_ip(d.ip,d.prefix_len).toString(),d.first_ip=w.get_first_ip(d.ip,d.prefix_len).toString());d.netmask=s(d.prefix_len);a.ipv4=d})(d,b);(function(a,b){var d=b.ipv6||{},g=d.address&&d.address[0]||{},h=d["ipv6-router-advertisements"]||{},d={enabled:r(d.enabled,
!0),preview:"",max_rtr_adv_interval:r(h["max-rtr-adv-interval"],30),type:"static",prefix:"",prefix_len:v(r(g["prefix-length"],64)),sub_prefix:"",wan_pd:"",suffix_type:"static",suffix:r(g["user-define"],"1"),last_ip:"",first_ip:"",display:[],dhcp:c.ipv6};if(g.isp)(h=r(g.isp.suffix,""))&&(h=v(h).toString(16)),d.type="isp",d.sub_prefix=h+"",d.wan_pd=r(g.isp["interface"],"");else if(h=r(g.ip,""))if(h=m.parse(h))d.prefix=m.get_prefix(h,d.prefix_len).toString();g.hasOwnProperty("eui-64")&&(d.suffix_type=
"eui64");if("static"===d.suffix_type&&(void 0===g["user-define"]&&g.ip)&&(g=m.parse(g.ip)))g=m.get_suffix(g,d.prefix_len),g=g.toString().replace("::",""),d.suffix=g;a.ipv6=d})(d,b);a.ipv6.updatePreview(d);d.ipv6.preview&&ba(d);return d},B=function(b){b||(b={});b=b.interfaces&&b.interfaces["interface"]||[];a.model.vlans=[];angular.forEach(b,function(b){b.name.match(/^VLAN\d+$/)&&a.model.vlans.push(z(b))});angular.forEach(a.model.vlans,function(a){"isp"===a.ipv6.type&&O(a)});a.model.vlans.sort(function(a,
b){return a.if_setting.vlan_id-b.if_setting.vlan_id})},D=function(b){b||(b={});b=b.interfaces&&b.interfaces["interface"]||[];var c,d,g=[],h=[],e;a.model.tag_lan_list=[];a.model.utagged_vlanid2Lan={};a.model.tagged_vlanid2Lan={};a.model.dmz_port="";a.model.lagname_2_lans={};a.model.vlanname_to_lag={};angular.forEach(b,function(b){if(b.name.match(/^(LAN\d+|LAG\d+)$/)){if(b.name.match(/^LAN\d+$/)){if(b["lag-ref"]){a.model.lagname_2_lans[b["lag-ref"]]||(a.model.lagname_2_lans[b["lag-ref"]]=[]);a.model.lagname_2_lans[b["lag-ref"]].push(b.name);
a.model.vlanname_to_lag[b.name]=b["lag-ref"];return}g.push(b.name)}else if(b.enabled)h.push(b.name);else return;c=b["vlan-settings"]||{};void 0!==c["untagged-vlan-id"]&&(a.model.utagged_vlanid2Lan[c["untagged-vlan-id"]]||(a.model.utagged_vlanid2Lan[c["untagged-vlan-id"]]={}),a.model.utagged_vlanid2Lan[c["untagged-vlan-id"]][b.name]=!0);c["tagged-vlans"]&&(d=c["tagged-vlans"]["vlan-id"]||[],angular.forEach(d,function(c){e=parseInt(c,10);a.model.tagged_vlanid2Lan[e]||(a.model.tagged_vlanid2Lan[e]={});
a.model.tagged_vlanid2Lan[e][b.name]=!0}));b.dmz&&b.dmz.enable&&(a.model.dmz_port=b.name)}});g=g.sort(function(a,b){var c=a.match(/^(LAN)(\d+)$/),d=b.match(/^(LAN)(\d+)$/);if(!c||!d)return 0;c=v(c[2]);d=v(d[2]);return c>d?1:-1});h=h.sort(function(a,b){var c=a.match(/^(LAG)(\d+)$/),d=b.match(/^(LAG)(\d+)$/);if(!c||!d)return 0;c=v(c[2]);d=v(d[2]);return c>d?1:-1});a.model.tag_lan_list=g.concat(h)},E=function(){var b={},c=a.model.dmz_port;angular.forEach(a.model.tag_lan_list,function(a){b[a]={value:a===
c?"E":"T",is_dmz:a===c}});return b},C=function(){return b.post({url:resource_base+"data/system_summary.json",method:"get_interface_state",params:{filter:"VLAN"},error:function(a){Log(ERROR,"[VLANSettingsCtrl] getInterfaceState() error:"+JSON.stringify(a))}})},I=function(b){b||(b={});b=b["interfaces-state"]&&b["interfaces-state"]["interface"]||[];a.model.ifs_state={};angular.forEach(b,function(b){"VLAN1"===b.name&&(a.model.mac=r(b["phys-address"],""));a.model.ifs_state[b.name]={name:r(b.name,""),phys_addr:r(b["phys-address"],
"")}})},G=function(b){b||(b={});var c=b.subnets||{};b=c.ipv4||[];var c=c.ipv6||[],d;for(d=b.length-1;0<=d;d--)b[d].name.match(/^VLAN\d+/)&&b.splice(d,1);for(d=c.length-1;0<=d;d--)c[d].name.match(/^VLAN\d+/)&&c.splice(d,1);a.model.remain_subnets={ipv4:b,ipv6:c}},H=function(b,c){b||(b=[]);c||(c=[]);var d=t.get_pd_list(b.interfaces&&b.interfaces["interface"]||[],c["interfaces-state"]&&c["interfaces-state"]["interface"]||[]);a.model.pd_list=[{id:"",prefix_name:"",display_name:a.DICT("VLAN_membership_Prefix_From_DHCP_PD"),
pd_prefix:"",prefix_len:"",prefix:""}];a.model.pd_list=a.model.pd_list.concat(d)},F=function(){return b.post({url:resource_base+"data/get_wan_ipv6_prefix.json",method:"get_wan_ipv6_prefix",error:function(b){Log(ERROR,"[VLANSettingsCtrl] getWANIPv6Prefix() error:"+JSON.stringify(b));b={};a.model.pd_list=t.update_pd_state(a.model.pd_list,b["interfaces-state"]&&b["interfaces-state"]["interface"]||[])}})},K=function(){return b.post({url:resource_base+"data/opendns.json",method:"get_opendns",error:function(a){Log(ERROR,
"[VLANSettingsCtrl] getOpendns() error:"+JSON.stringify(a));M({})}})},M=function(b){b||(b={});a.model.opendns=r((b.opendns||{}).enabled,!1)},N=function(){return b.post({url:resource_base+"data/lan_dhcp_settings.json",method:"get_dhcp_settings",error:function(a){Log(ERROR,"[VLANSettingsCtrl] getDHCPPools() error:"+JSON.stringify(a))}})},J=function(b){b||(b={});var c=b.ipv4||{},d=b.ipv6||{},g=c["dhcp-options"]||{},h=c["network-boot"]||{},e=function(a){var b;if(2>a.length)for(b=a.length;2>b;b++)a.push("")};
b={pool_id:r(b["pool-id"],""),ipv4:{lease_time:r(c["lease-time"],1440),dns_type:r(c["dns-server-type"],"dns-server-proxy"),dns:[],dhcp_mode:r(c["dhcp-mode"],"disable"),range_start:r(c["range-start"],""),range_end:r(c["range-end"],""),wins_server:r(c["wins-server"],""),relay_ip:"",enable_network_boot:r(h.enabled,!1),next_server:r(h["next-server"],""),boot_file:r(h["boot-file"],""),option43:r(g.option43,""),option66:r(g.option66,""),option67:r(g.option67,""),option150:r(g.option150,"")},ipv6:{lease_time:r(d["lease-time"],
1440),dns_type:r(d["dns-server-type"],"dns-server-proxy"),dns:[],dhcp_mode:r(d["dhcp-mode"],"disable"),relay_ip:"",range_start:r(d["range-start"],""),range_start_prefix:"",range_start_suffix:"",range_end:r(d["range-end"],""),range_end_prefix:"",range_end_suffix:"",prefix:r(d.prefix,"")}};a.model.opendns?(b.ipv4.dns_type="opendns",b.ipv4.dns=["208.67.222.222","208.67.220.220"]):(c=c.dns&&c.dns["static-dns-servers"]||[],e(c),b.ipv4.dns=c);c=d.dns&&d.dns["static-dns-servers"]||[];e(c);b.ipv6.dns=c;return b},
R=function(b){b||(b={});var c=b["dhcp-pool"]&&b["dhcp-pool"]["dhcp-interfaces"]||[],d=b["dhcp-pools"]&&b["dhcp-pools"].pool||[];b=b["dhcp-pool"]&&b["dhcp-pool"]["dhcp-option82"]||[];var g,h,e;a.model.dhcp_pools={};a.model.vlan_to_pool={};a.model.dhcp_option82={};a.model.dhcp_opt82_pools={};a.model.resetOption82=!1;angular.forEach(c,function(b){g=r(b["server-mode"]["dhcp-pool"],"");e=h="";b["relay-mode"]&&b["relay-mode"]["relay-ipv4-address"]&&(h=b["relay-mode"]["relay-ipv4-address"]);b["relay-mode"]&&
b["relay-mode"]["relay-ipv6-address"]&&(e=b["relay-mode"]["relay-ipv6-address"]);a.model.vlan_to_pool[b["interface"]]={pool_id:g,relay_ipv4_address:h,relay_ipv6_address:e}});angular.forEach(b,function(b){g=b["dhcp-pool"];5E3>g&&(a.model.resetOption82=!0);a.model.dhcp_option82[g]=angular.copy(b)});angular.forEach(d,function(b){g=b["pool-id"];a.model.dhcp_option82[g]?a.model.dhcp_opt82_pools[g]=angular.copy(b):a.model.dhcp_pools[g]=J(b)})},W=function(){var b=document.location.hostname,c=d.IPv4.isValid(b),
g=d.IPv6.isValid(b.replace("[","").replace("]","")),h;a.model.used_vlan_link={vlan_name:"",isIPv4:!0};g?(a.model.used_vlan_link.isIPv4=!1,h=m.parse(b.replace("[","").replace("]",""))):h=w.parse(b);angular.forEach(a.model.vlans,function(d){S(d);h&&(c?d.ipv4.ip===b&&(a.model.used_vlan_link.vlan_name=d.name):h.toNormalizedString()===d.ipv6.preview&&(a.model.used_vlan_link.vlan_name=d.name))})},S=function(b){var c=b.ipv4,d=b.ipv6,g,h,e,k,l;c.display=[];d.display=[];a.ipv6.updatePreview(b);c.ip&&(c.display.push(c.ip+
"/"+c.prefix_len),c.display.push(c.netmask));g="-";switch(c.dhcp.dhcp_mode){case "server":g=a.DICT("LAN_DHCP_Settings_DHCP_Server")+" "+c.dhcp.range_start+"-"+c.dhcp.range_end;break;case "disable":g=a.DICT("LAN_DHCP_Settings_DHCP_Disabled");break;case "relay":g=a.DICT("LAN_DHCP_Settings_DHCP_Relay")+" "+c.dhcp.relay_ip}c.display.push(g);g="-";c="";h=void 0;d.preview&&(l=m.parse(d.preview));k=e="N/A";switch(d.type){case "static":l&&(g=l.toString(),g=g+"/"+d.prefix_len);(tmp=m.parse(d.dhcp.range_start))&&
(e=m.combined_two_ip(l,tmp,d.prefix_len));(tmp=m.parse(d.dhcp.range_end))&&(k=m.combined_two_ip(l,tmp,d.prefix_len));d.display.push(g);break;case "isp":angular.forEach(a.model.pd_list,function(a){a.id===d.wan_pd&&(h=a)});if(!h||!l){Log(ERROR,"[VLANSettingsCtrl] VLAN "+b.description+" PD is not existed at PD List");Log(ERROR,"[VLANSettingsCtrl] IPv6 Preview "+l);break}h.prefix?(c=l.toString()+"/"+d.prefix_len,(tmp=m.parse(d.dhcp.range_start))&&(e=m.combined_two_ip(l,tmp,d.prefix_len)),(tmp=m.parse(d.dhcp.range_end))&&
(k=m.combined_two_ip(l,tmp,d.prefix_len))):(c=h.prefix_name+"("+h.id+") + "+d.sub_prefix+" + ::"+d.suffix+"/"+d.prefix_len,e=h.prefix_name+"("+h.id+") + "+d.sub_prefix+" + ::"+d.dhcp.range_start_suffix,k=h.prefix_name+"("+h.id+") + "+d.sub_prefix+" + ::"+d.dhcp.range_end_suffix);d.display.push(c)}g="-";switch(d.dhcp.dhcp_mode){case "server":g=a.DICT("LAN_DHCP_Settings_DHCP_Server")+" "+e+" - "+k;break;case "disable":g=a.DICT("LAN_DHCP_Settings_DHCP_Disabled");break;case "relay":g=a.DICT("LAN_DHCP_Settings_DHCP_Relay")+
" "+d.dhcp.relay_ip}d.display.push(g)},X=function(){var b=a.model.utagged_vlanid2Lan,c=a.model.tagged_vlanid2Lan,d=a.model.dmz_port,g;angular.forEach(a.model.vlans,function(h){g=h.if_setting.vlan_id;angular.forEach(h.tags,function(a,b){h.tags[b].is_dmz=d===b?!0:!1;h.tags[b].value="E"});b[g]&&angular.forEach(b[g],function(a,b){a&&b!==d&&(h.tags[b].value="U")});c[g]&&angular.forEach(c[g],function(b,c){c!==a.model.dmz_port&&(h.tags[c].value="T")})})},T=function(){angular.forEach(a.model.vlans,function(a){L(a)})},
L=function(b){var c,d,g,h,e=b.ipv6;d=a.model.vlan_to_pool[b.name];void 0!==d?(c=a.model.dhcp_pools[d.pool_id]?a.model.dhcp_pools[d.pool_id]:J(),c.ipv4.relay_ip=d.relay_ipv4_address,c.ipv6.relay_ip=d.relay_ipv6_address):c=J();"isp"===e.type?(h="N/A",angular.forEach(a.model.pd_list,function(a){a.id===e.wan_pd&&(h=a.prefix_name)}),d=h+" + "+e.sub_prefix,g=h+" + "+e.sub_prefix):g=d=e.prefix;c.ipv6.range_start_prefix=d;c.ipv6.range_end_prefix=g;c.ipv6.range_start&&(h=m.parse(c.ipv6.range_start))&&(d=m.get_suffix(h,
e.prefix_len).toString().replace("::",""));c.ipv6.range_end&&(h=m.parse(c.ipv6.range_end))&&(g=m.get_suffix(h,e.prefix_len).toString().replace("::",""));c.ipv6.range_start_suffix=d;c.ipv6.range_end_suffix=g;b.pool_id=c.pool_id;b.ipv4.dhcp=angular.copy(c.ipv4);b.ipv6.dhcp=angular.copy(c.ipv6)},U=function(){p.all([y(),F(),N(),K(),C(),b.post({url:resource_base+"data/aaa.json",method:"get_subnet"})]).then(function(b){H(l(b,0),l(b,1));R(l(b,2));M(l(b,3));I(l(b,4));D(l(b,0));B(l(b,2));G(l(b,5));V();T();
W();X();P();a.checkUntaggedPort();a.model.edit_tag=!1;a.model.orig_vlans=angular.copy(a.model.vlans);a.gridVLANSettingOptions.data=a.model.vlans;a.gridTagsOptions.data=a.model.vlans;a.ui_data.data_ready=!0;a.resetModified();setTimeout(function(){a.gridVLANSettingOptions.gridApi&&a.gridVLANSettingOptions.gridApi.core.notifyDataChange("all");app.TOOLS.apply(a)},50)})},V=function(){if(!a.gridTagsOptions){var b=[{field:"if_setting.vlan_id",width:65,displayName:a.DICT("VLAN_membership_VLAN_ID"),enableSorting:!1}],
c="",d,g=a.model.lagname_2_lans;angular.forEach(a.model.tag_lan_list,function(a){c="";d=app.uiGrid.computeHeaderWidth(a,!1);g[a]&&(c=g[a].join(", "),d+=25);b.push({field:"tags."+a,width:d,enableSorting:!1,lagLanGroup:c,displayName:a,headerCellTemplate:"UG_vlan_setting_tags_header.html",cellTemplate:"UG_vlan_setting_tags.html"})});b.push({field:"empty",isEmpty:!0});a.gridTagsOptions=app.uiGrid.generateGridOptions({columnDefs:b})}},P=function(){a.ui_data.vlan_selected_cnt=0;a.ui_data.vlan1_is_selected=
!1;angular.forEach(a.model.vlans,function(b){b.checked?(a.ui_data.vlan_selected_cnt+=1,"VLAN1"===b.name&&(a.ui_data.vlan1_is_selected=!0)):(S(b),b.edit=!1,b.edit_new=!1,b.edit_mgnt=!1)});A()};a.ui_data={data_ready:!1,success:!1,vlan_selected_cnt:0,vlan1_is_selected:!1,untagged_is_invalid:!1};a.schema={dns_server:[{id:"dns-server-proxy",display_name:a.DICT("VLAN_membership_DNS_Server_Proxy")},{id:"dns-server-provided-isp",display_name:a.DICT("VLAN_membership_DNS_Server_Provided_ISP")},{id:"dns-server-static",
display_name:a.DICT("VLAN_membership_DNS_Server_Static")}],opendns_dns_server:[{id:"opendns",display_name:a.DICT("VLAN_membership_DNS_Server_Provided_Opendns")}],tags_list:[{id:"U",display_name:"U",popover:a.DICT("VLAN_membership_Untagged")},{id:"T",display_name:"T",popover:a.DICT("VLAN_membership_Tagged")},{id:"E",display_name:"E",popover:a.DICT("VLAN_membership_Excluded")}]};a.model={pd_list:[],vlans:[],used_vlan_link:{},dmz_port:"",edit_tag:!1,tag_lan_list:[],utagged_vlanid2Lan:{},tagged_vlanid2Lan:{},
vlanname_to_lag:{},lagname_2_lans:{},isp_dns:{ipv4:[],ipv6:[]},ifs_state:{},mac:"",dhcp_pools:{},vlan_to_pool:{},dhcp_option82:{},dhcp_opt82_pools:{},orig_vlans:[],opendns:!1,remain_subnets:{ipv4:[],ipv6:[]}};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridVLANSettingOptions=app.uiGrid.generateGridOptions({dynamicRowHeight:!0,rowHeight:76,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:P,headerChangedCbk:P,disableChkBoxField:"disableChk"},{field:"if_setting.vlan_id",
displayName:a.DICT("VLAN_membership_VLAN_ID"),editRow:"edit_new",invalidField:"vld.id",validationCbk:"gridInvalidCbk",id:"VLANMembershipID",min:1,max:4093,required:!0,changedCbk:function(b,c,d,g){var h=c.entity;angular.forEach(a.model.vlans,function(a){a.vld.id=!1});angular.forEach(a.model.vlans,function(a,c){b!==c&&h.if_setting.vlan_id===a.if_setting.vlan_id&&(h.vld.id=!0,a.vld.id=!0)});h.vld.id||!_.isNumber(h.if_setting.vlan_id)?h.description="VLAN":h.description="VLAN"+h.if_setting.vlan_id},width:90,
cellTemplate:n.get("UG_table_text_with_inline_number_edit.html").replace(/data-ng-expansion/,'size="4" maxlength="4" minlength="1"')},{field:"description",displayName:a.DICT("VLAN_membership_Name"),width:90,enableSorting:!1,cellTemplate:"UG_table_text_with_inline_edit.html"},{field:"if_setting.inter_vlan_routing",displayName:a.DICT("VLAN_membership_Inter_VLAN_Routing"),id:"VLANMembershipRouting",enableSorting:!1,cellTemplate:n.get("UG_table_checkbox_with_inline_edit.html"),editRow:"edit",width:65,
minWidth:65,isWrapHeader:!0},{field:"if_setting.enable_management",displayName:a.DICT("VLAN_membership_Device_Managemenet"),id:"VLANMembershipEnableManagement",cellTemplate:n.get("UG_table_checkbox_with_inline_edit.html"),editRow:"edit_mgnt",infoField:"info",enableSorting:!1,isWrapHeader:!0,width:105,minWidth:105},{field:"ipv4",displayName:a.DICT("VLAN_membership_IPv4_Addr_Mask"),id:"VLANMembershipIPv4",validationCbk:"gridInvalidCbk",invalidField:{"vld.v4_range_subnet":"dnValidSubnet","vld.v4_ip_range":"dnIpRange"},
enableSorting:!1,editRow:"edit",cellTemplate:"UG_vlan_setting_ipv4_settings.html",width:350,minWidth:350},{field:"ipv6",displayName:a.DICT("VLAN_membership_IPv6_Addr_Mask"),id:"VLANMembershipIPv6",validationCbk:"gridInvalidCbk",editRow:"edit",cellTemplate:"UG_vlan_setting_ipv6_settings.html",minWidth:500,enableSorting:!1}]});a.gridTagsOptions=void 0;var O=function(b){var c="",d=1,g=a.model.vlans,h=b.ipv6.prefix_len,e=!1;_.isNumber(h)||(h=64);for(_.isNumber(b.if_setting.vlan_id)&&(c="fec0:"+b.if_setting.vlan_id+
"::");!e&&!(angular.forEach(g,function(a){!e&&a.ipv6.preview&&_.isNumber(a.ipv6.prefix_len)&&m.vld.is_overlap_between_prefixs(c+"/"+h,a.ipv6.preview+"/"+a.ipv6.prefix_len)&&(c="")}),c?e=!0:c="fec0:"+d+"::",d+=1,4093<d););b.ipv6.prefix=c},Q=function(b){for(var c=2,d=a.model.vlans,g=!1;4093>=c;){g=!0;angular.forEach(d,function(a){c===a.if_setting.vlan_id&&(g=!1)});if(g)break;c+=1}b.description="VLAN"+c;b.if_setting.vlan_id=c},Y=function(b){var c="",d=a.model.vlans,g=1,h=b.ipv4.prefix_len,e=a.model.remain_subnets,
k,l=!1;_.isNumber(h)||(h=24);_.isNumber(b.if_setting.vlan_id)&&(c="192.168."+b.if_setting.vlan_id+".1",k={start:w.get_first_ip(c,h).toString(),end:w.get_last_ip(c,h).toString()});for(;!l&&!(u.check_ipv4_range_is_overlap_with_entity(k,e.ipv4).is_overlap?c="":angular.forEach(d,function(a){!l&&a.ipv4.ip&&_.isNumber(a.ipv4.prefix_len)&&w.vld.is_overlap_between_subnets(c+"/"+h,a.ipv4.ip+"/"+a.ipv4.prefix_len)&&(c="")}),c?l=!0:(c="192.168."+g+".1",k={start:w.get_first_ip(c,h).toString(),end:w.get_last_ip(c,
h).toString()}),g+=1,4093<g););b.ipv4.ip=c},aa=function(a){Q(a);Y(a);O(a);return a};a.funs={add:function(){var b=32;a.model.dmz_port&&(b-=1);a.model.vlans.length>=b?(b=a.DICT("VLAN_membership_DMZ_Max",{"%s0":a.model.dmz_port?a.DICT("VLAN_membership_DMZ_Enabled"):"","%s1":b,"%s2":a.DICT("VLAN_membership_Vlan_Intf")}),app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})):(b=z(),b.checked=!0,b.edit=!0,b.is_new=!0,b.edit_new=!0,b.edit_mgnt=!0,b=aa(b),S(b),a.modified(),a.model.vlans.push(b))},edit:function(){angular.forEach(a.model.vlans,
function(b){b.checked&&(b.edit=!0,b.is_new&&(b.edit_new=!0),"VLAN1"!==b.name&&(b.edit_mgnt=!0),a.ipv6.updatePreview(b))});A()},edit_tag:function(){a.model.edit_tag=!0},del:function(){if(!a.ui_data.vlan1_is_selected){var b=a.model.vlans;for(i=b.length-1;0<=i;i--)b[i].checked&&b.splice(i,1);a.checkTags();a.modified()}},checkAndSave:function(){var b=a.model.used_vlan_link.isIPv4,c=a.model.used_vlan_link.vlan_name,d=a.model.vlans,g,h=!1,e,k;angular.forEach(a.model.orig_vlans,function(a){a.name===c&&(g=
a)});g?(angular.forEach(d,function(d){d.name="VLAN"+d.if_setting.vlan_id;d.name===c&&(b?g.ipv4.ip!==d.ipv4.ip&&(e='<ul class="vlan-redirect"><li>'+a.DICT("VLAN_membership_Change_Address_Warning_1",{"%s1":c,"%s2":g.ipv4.ip})+"</li>",e=e+"<li>"+a.DICT("VLAN_membership_Change_Address_Warning_2")+"</li>",h=!0):g.ipv6.preview!==d.ipv6.preview&&((k=m.parse(g.ipv6.preview))||(k="-"),e="<ul><li>"+a.DICT("VLAN_membership_Change_Address_Warning_1",{"%s1":c,"%s2":k.toString()})+"</li>",k=m.parse(d.ipv6.preview),
e=e+"<li>"+a.DICT("VLAN_membership_Change_Address_Warning_2")+"</li>",h=!0))}),h?(e=e+"<li>"+a.DICT("VLAN_membership_Change_Address_Warning_3")+"</li></ul>",e=e+"<div></div><div>"+a.DICT("VLAN_membership_Change_Address_Warning_4")+"</div>",app.TOOLS.warningAlertBox({msg:e,width:720,cbk:function(b){b&&a.funs.save()}})):a.funs.save()):a.funs.save()},save:function(){var c=[],d=a.model.vlans,g=a.model.orig_vlans,h=a.model.dhcp_option82,e={},k,l=function(){var b={},c={},g=[],h,e,k=a.model.lagname_2_lans;
angular.forEach(a.model.tag_lan_list,function(a){b[a]="";c[a]=[]});angular.forEach(d,function(a){angular.forEach(a.tags,function(d,g){switch(d.value){case "U":b[g]=a.if_setting.vlan_id;break;case "T":c[g].push(a.if_setting.vlan_id)}})});angular.forEach(b,function(b,d){d!==a.model.dmz_port&&(h={name:d,"vlan-settings":{"untagged-vlan-id":b,"tagged-vlans":{"vlan-id":c[d]||[]}}},g.push(h),k[d]&&angular.forEach(k[d],function(a){e=angular.copy(h);e.name=a;g.push(e)}))});return g};angular.forEach(d,function(a){a.name=
"VLAN"+a.if_setting.vlan_id;_.isNumber(a.pool_id)&&(e[a.pool_id]=!0);a.pool_id=a.if_setting.vlan_id;e[a.if_setting.vlan_id]=!1});a.model.resetOption82&&(k=5E3,angular.forEach(h,function(b,c){e[c]=!0;a.model.dhcp_opt82_pools[c]["pool-id"]=k;b["dhcp-pool"]=k;k+=1;e[k]=!1}));(function(){var a,b=[],h=[];angular.forEach(g,function(c){a=!1;angular.forEach(d,function(b){c.name===b.name&&(a=!0)});a||(_.isNumber(c.pool_id)&&(e[c.pool_id]=!0),h.push({"interface":c.name}),b.push({name:c.name}))});b.length&&
(c.push({method:"del_dhcp_settings",params:{"dhcp-pool":{"dhcp-interfaces":h}}}),c.push({method:"del_interface",params:{interfaces:{"interface":b}}}))})();(function(){var b,g,h,e,k,z,y,B=[],n=l();angular.forEach(d,function(c){g={enabled:!0,address:[{ip:c.ipv4.ip,"prefix-length":c.ipv4.prefix_len}]};z="static"===c.ipv6.suffix_type?t.parse_user_identifier(c.ipv6.suffix):t.gen_eui64_ip(a.model.mac);switch(c.ipv6.type){case "isp":y=t.get_pd_preview(void 0,c.ipv6.sub_prefix,z.toString().replace("::",""),
c.ipv6.prefix_len);e={ip:y.toString(),isp:{"interface":c.ipv6.wan_pd,suffix:parseInt(c.ipv6.sub_prefix,16)}};y=t.get_pd_preview(void 0,c.ipv6.sub_prefix,"0",c.ipv6.prefix_len);k={"prefix-spec":y.toString()+"/"+c.ipv6.prefix_len,isp:{"interface":c.ipv6.wan_pd,suffix:parseInt(c.ipv6.sub_prefix,16)}};break;default:y=t.get_pd_preview(c.ipv6.prefix+"/"+c.ipv6.prefix_len,"0",z.toString().replace("::",""),c.ipv6.prefix_len),e={ip:y.toString(),"static":null},k={"prefix-spec":c.ipv6.prefix+"/"+c.ipv6.prefix_len,
"static":null}}angular.extend(e,{"prefix-length":c.ipv6.prefix_len});angular.extend(k,{"preferred-lifetime":3600});"static"===c.ipv6.suffix_type?angular.extend(e,{"user-define":c.ipv6.suffix}):angular.extend(e,{"eui-64":null});h={enabled:!0,address:[e],"ipv6-router-advertisements":{"max-rtr-adv-interval":c.ipv6.max_rtr_adv_interval,"prefix-list":{prefix:[k]}}};b={name:c.name,description:c.description,type:"l2vlan",enabled:!0,ipv4:g,ipv6:h,"vlan-interface-settings":{"vlan-id":c.if_setting.vlan_id,
"inter-vlan-routing":c.if_setting.inter_vlan_routing,"enable-management":c.if_setting.enable_management}};B.push(b)});c.push({method:"set_vlan_membership",params:{interfaces:{"interface":B.concat(n)}}})})();(function(){var a=[];angular.forEach(e,function(b,c){b&&a.push({"pool-id":c})});a.length&&c.push({method:"del_dhcp_settings",params:{"dhcp-pools":{pool:a}}})})();(function(){var b=[],g=[],l=[],z,y,B,n,s,r,A,v,F;a.model.resetOption82&&(k=5E3,angular.forEach(h,function(b,c){e[c]=!0;e[k]=!1;z=a.model.dhcp_opt82_pools[c];
z["pool-id"]=k;b["dhcp-pool"]=k;k+=1;g.push(b)}));angular.forEach(a.model.dhcp_opt82_pools,function(a){l.push(a)});angular.forEach(d,function(a){_.isNumber(a.pool_id)&&(e[a.pool_id]=!0);a.pool_id=a.if_setting.vlan_id;k=a.pool_id;e[a.pool_id]=!1;B={"interface":a.name,"server-mode":{"dhcp-pool":k}};r=a.ipv4.dhcp;A=a.ipv6.dhcp;if("relay"===r.dhcp_mode||"relay"===A.dhcp_mode)B["relay-mode"]={},"relay"===r.dhcp_mode&&(B["relay-mode"]["relay-ipv4-address"]=r.relay_ip),"relay"===A.dhcp_mode&&(B["relay-mode"]["relay-ipv6-address"]=
A.relay_ip);b.push(B);if(5>r.lease_time||43200<r.lease_time)r.lease_time=1440;if(5>A.lease_time||43200<A.lease_time)A.lease_time=1440;n={"lease-time":r.lease_time,"dns-server-type":r.dns_type,"dhcp-mode":r.dhcp_mode};switch(r.dhcp_mode){case "server":"dns-server-static"===r.dns_type&&(n.dns={"static-dns-servers":[]},r.dns[0]&&n.dns["static-dns-servers"].push(r.dns[0]),r.dns[1]&&n.dns["static-dns-servers"].push(r.dns[1])),v=r.next_server,F=r.boot_file,r.enable_network_boot||(F=v=""),angular.extend(n,
{"range-start":r.range_start,"range-end":r.range_end,"wins-server":r.wins_server,"network-boot":{enabled:r.enable_network_boot,"next-server":v,"boot-file":F},"dhcp-options":{option43:r.option43,option66:r.option66,option67:r.option67,option150:r.option150}})}s={"lease-time":A.lease_time,"dns-server-type":A.dns_type,"dhcp-mode":A.dhcp_mode};switch(A.dhcp_mode){case "server":"dns-server-static"===A.dns_type&&(s.dns={"static-dns-servers":[]},A.dns[0]&&s.dns["static-dns-servers"].push(A.dns[0]),A.dns[1]&&
s.dns["static-dns-servers"].push(A.dns[1])),"static"===a.ipv6.type?angular.extend(s,{"range-start":A.range_start,"range-end":A.range_end}):angular.extend(s,{"range-start":"::"+A.range_start_suffix,"range-end":"::"+A.range_end_suffix})}B={"pool-id":k,ipv4:n,ipv6:s};l.push(B)});y={"dhcp-pool":{"dhcp-interfaces":b},"dhcp-pools":{pool:l}};g.length&&(y["dhcp-pool"]["dhcp-option82"]=g);c.push({method:"set_dhcp_settings",params:y})})();b.post({forcedUsingPost:!0,method:"set_bulk",params:c,success:function(){U();
a.ui_data.success=!0},error:function(a){U()}})},cancel:function(){U()}};a.ipv4={int2Inet:function(b,c){var d=b.entity.ipv4;_.isNumber(d.prefix_len)?d.netmask=s(d.prefix_len):d.netmask="";a.ipv4.changeDHCPRange(b);a.ipv4.checkSubnetVld(b,c);A()},inet2Int:function(b,c){var d=b.entity.ipv4;d.prefix_len=void 0!==d.netmask?k(d.netmask):"";a.ipv4.changeDHCPRange(b);a.ipv4.checkSubnetVld(b,c);A()},changeIP:function(b,c){a.ipv4.changeDHCPRange(b);a.ipv4.checkSubnetVld(b,c);A()},changeDHCPMode:function(b){a.ipv4.changeDHCPRange(b);
A()},changeDHCPRange:function(a){a=a.entity.ipv4;var b=a.ip,d=a.prefix_len,g,h;if(b&&(_.isNumber(d)&&"server"===a.dhcp.dhcp_mode)&&(b=w.parse(b)))h=32-d,24>=d&&b?(g=w.get_prefix(b,24),b=w.get_prefix(b,24),g.octets[3]=100,b.octets[3]=149):(g=w.get_prefix(b,d),b=w.get_prefix(b,d),g.octets[3]|=1,b.octets[3]=27>d?b.octets[3]|50:b.octets[3]|parseInt(c(h-1,h,"H"),2)),a.dhcp.range_start=g.toString(),a.dhcp.range_end=b.toString(),A()},checkDHCPRange:function(a){var b=a.entity;a=b.vld;var c=b.ipv4,d=c.prefix_len,
g=c.ip,b=c.dhcp.range_start,c=c.dhcp.range_end,h=!1,e;a.v4RANSubS=!1;a.v4RANSubE=!1;a.v4RANIP=!1;b&&(c&&g&&_.isNumber(d))&&(g=w.parse(g),b=w.parse(b),c=w.parse(c),g&&(b&&c)&&(g=w.get_prefix(g,d),e=w.get_prefix(b,d),d=w.get_prefix(c,d),g&&(e&&d)&&(g.toString()!==e.toString()&&(h=a.v4RANSubS=!0),g.toString()!==d.toString()&&(h=a.v4RANSubE=!0),!h&&w.to_int(b)>w.to_int(c)&&(a.v4RANIP=!0))))},checkSubnetVld:function(b){b=b.entity;var c=b.ipv4,d=b.vld;b=a.model.vlans;var g=b.length;d.v4OverlapWithOtherVlans=
!1;d.v4OverlapWithOtherFeatrues=!1;c.first_ip="";c.last_ip="";c.ip&&c.netmask&&(c.first_ip=w.get_first_ip(c.ip,c.prefix_len).toString(),c.last_ip=w.get_last_ip(c.ip,c.prefix_len).toString(),is_overlap=u.check_ipv4_range_is_overlap_with_entity({start:c.first_ip,end:c.last_ip},a.model.remain_subnets.ipv4).is_overlap,d.v4OverlapWithOtherFeatrues=is_overlap,Log(DEBUG,"ipv4.checkSubnetVld() "+is_overlap+" ## "+JSON.stringify(c)+" ## "+JSON.stringify(a.model.remain_subnets.ipv4)));angular.forEach(b,function(a){a.vld.v4OverlapWithOtherVlans=
!1});for(c=0;c<g;c++)if(b[c].ipv4.first_ip&&b[c].ipv4.last_ip)for(d=c+1;d<g;d++)if(b[d].ipv4.first_ip&&b[d].ipv4.last_ip){if(is_overlap=w.vld.is_overlap_between_ranges({start:b[c].ipv4.first_ip,end:b[c].ipv4.last_ip},{start:b[d].ipv4.first_ip,end:b[d].ipv4.last_ip}))b[c].vld.v4OverlapWithOtherVlans=is_overlap,b[d].vld.v4OverlapWithOtherVlans=is_overlap;Log(DEBUG,"ipv4.checkSubnetVld() "+c+" "+d+": "+is_overlap+" ## "+JSON.stringify(b[c])+" ## "+JSON.stringify(b[d]))}}};a.ipv6={changeType:function(b){a.ipv6.updatePreview(b.entity);
a.ipv6.checkSubnetVld(b);a.ipv6.changeDHCPRange(b);A()},changeSuffixType:function(b,c){a.ipv6.updatePreview(b.entity);a.ipv6.changeDHCPRange(b);A()},changeDHCPMode:function(b){a.ipv6.updatePreview(b.entity);a.ipv6.changeDHCPRange(b);A()},changeDHCPRange:function(b){var d=b.entity.ipv6,g=d.preview;b=d.prefix_len;var h,e,k;if(g&&(_.isNumber(b)&&"server"===d.dhcp.dhcp_mode)&&(g=m.parse(g)))"isp"===d.type?(k="-",angular.forEach(a.model.pd_list,function(a){a.id===d.wan_pd&&(k=a.prefix_name)}),d.dhcp.range_start_prefix=
k+" + "+d.sub_prefix,d.dhcp.range_end_prefix=k+" + "+d.sub_prefix):(d.dhcp.range_start_prefix=d.prefix,d.dhcp.range_end_prefix=d.prefix),e=128-b,120>b?(h=m.get_prefix(g,120),g=m.get_prefix(g,120),h.parts[7]|=1,g.parts[7]|=254):(h=m.get_prefix(g,b),g=m.get_prefix(g,b),h.parts[7]|=1,g.parts[7]|=parseInt(c(e-1,e,"H"),2)),d.dhcp.range_start=h.toString(),d.dhcp.range_end=g.toString(),k=m.parse("0::0"),h=m.combined_two_ip(k,h,b),d.dhcp.range_start_suffix=h.toString().replace("::",""),h=m.combined_two_ip(k,
g,b),d.dhcp.range_end_suffix=h.toString().replace("::","")},updateDHCPServer:function(b){a.ipv6.updatePreview(b.entity);a.ipv6.checkSubnetVld(b);a.ipv6.changeDHCPRange(b)},updatePreview:function(b){var c=b.ipv6,d,g,h;c.preview="";if(_.isNumber(c.prefix_len)){b=c.prefix_len;switch(c.type){case "static":if(!c.prefix)return;g="0";d=c.prefix+"/"+b;break;case "isp":d="0::/0";angular.forEach(a.model.pd_list,function(a){a.id===c.wan_pd&&(d=a.pd_prefix)});g=c.sub_prefix.toString();if(!g)return;break;default:return}switch(c.suffix_type){case "static":h=
c.suffix;if(!h)return;break;case "eui64":h=a.model.ifs_state.VLAN1&&a.model.ifs_state.VLAN1.phys_addr||"";if(!h){Log(ERROR,"[VLANSettingsCtrl] updatePreview() eui64, there is not mac at VLAN1 interface state");return}h=t.gen_eui64_ip(h).replace("::","");break;default:return}c.preview=t.get_pd_preview(d,g,h,b).toNormalizedString()}},checkDHCPRange:function(a){var b=a.entity;a=b.vld;var c=b.ipv6,d=c.prefix_len,g=c.preview,b="::"+c.dhcp.range_start_suffix,h="::"+c.dhcp.range_end_suffix,e=!1;a.v6RANSubS=
!1;a.v6RANSubE=!1;a.v6RANIP=!1;b&&(h&&g&&_.isNumber(d))&&(g=m.parse(g),b=m.parse(b),h=m.parse(h),g&&(b&&h)&&(b=m.combined_two_ip(g,b,d),h=m.combined_two_ip(g,h,d),c.dhcp.range_start=b.toString(),c.dhcp.range_end=h.toString(),c=m.get_prefix(g,d),g=m.get_prefix(b,d),d=m.get_prefix(h,d),c&&(g&&d)&&(c.toString()!==g.toString()&&(e=a.v6RANSubS=!0),c.toString()!==d.toString()&&(e=a.v6RANSubE=!0),!e&&!m.vld.ip_range_is_valid(b,h)&&(a.v6RANIP=!0))))},checkSubnetVld:function(b){var c=a.model.vlans,d=c.length;
b=b.entity;var g=b.vld,h=b.ipv6,e,k;g.v6OverlapWithOtherVlans=!1;g.v6OverlapWithOtherFeatrues=!1;ba(b);h.preview&&"static"===h.type&&(b=u.check_ipv6_range_is_overlap_with_entity({start:h.first_ip,end:h.last_ip},a.model.remain_subnets.ipv6).is_overlap,g.v6OverlapWithOtherFeatrues=b,Log(DEBUG,"ipv6.checkSubnetVld() "+b+" "+JSON.stringify(h)));angular.forEach(c,function(a){a.vld.v6OverlapWithOtherVlans=!1});for(g=0;g<d;g++)if(e=c[g].ipv6,e.first_ip&&e.last_ip)for(h=g+1;h<d;h++)if(k=c[h].ipv6,k.first_ip&&
k.last_ip&&e.type===k.type&&!("isp"===e.type&&e.wan_pd!==k.wan_pd)){if(b=m.vld.is_overlap_between_ranges({start:e.first_ip,end:e.last_ip},{start:k.first_ip,end:k.last_ip}))c[g].vld.v6OverlapWithOtherVlans=b,c[h].vld.v6OverlapWithOtherVlans=b;Log(DEBUG,"ipv6.checkSubnetVld() "+b+" "+JSON.stringify(e)+" "+JSON.stringify(k))}}};var ba=function(a){a=a.ipv6;var b=a.preview;a.first_ip="";a.last_ip="";b&&"isp"===a.type&&(b=t.get_pd_preview(void 0,a.sub_prefix,"0",a.prefix_len).toNormalizedString());b&&(a.first_ip=
m.get_first_ip(b,a.prefix_len).toString(),a.last_ip=m.get_last_ip(b,a.prefix_len).toString())};a.checkTags=function(b,c,d){var g=a.model.vlans,h={};angular.forEach(a.model.tag_lan_list,function(a){h[a]=""});angular.forEach(g,function(a){angular.forEach(a.tags,function(b,c){"U"===b.value&&(h[c]=a.if_setting.vlan_id)})});angular.forEach(h,function(a,b){""===a&&!g[0].tags[b].is_dmz&&(g[0].tags[b].value="U")});a.checkUntaggedPort()};a.checkForEditTags=function(b,c,d){var g=c.entity,h=a.model.vlans,e=
d.colDef.field.replace("tags.","");c=[e];d=a.model.lagname_2_lans;var k=a.model.vlanname_to_lag;e.match(/^LAG\d+$/)?d[e]&&(c=c.concat(d[e])):(lagname=k[e]||"",d[lagname]&&(c=[lagname],c=c.concat(d[lagname])));"U"===g.tags[e].value?angular.forEach(c,function(a){g.tags[a]&&(g.tags[a].value="U");angular.forEach(h,function(c,d){d!==b&&(c.tags[a]&&"U"===c.tags[a].value)&&(c.tags[a].value="T")})}):angular.forEach(c,function(a){g.tags[a]&&(g.tags[a].value=g.tags[e].value)});a.checkUntaggedPort()};a.checkUntaggedPort=
function(){var b=a.model.vlans,c,d=!1;angular.forEach(a.model.tag_lan_list,function(a){c=!1;angular.forEach(b,function(b){"U"===b.tags[a].value&&(c=!0);b.tags[a].is_dmz&&(c=!0)});c||(d=!0)});a.ui_data.untagged_is_invalid=d};U()}]);app.controller("lan_8021x_main",["$scope","$q","MyHttp","$templateCache","$filter","Sets","UserSession","userAccessRight","modelInfo",function(a,b,t,m,w,u,p,q,e){a.LAGUNASSIGN="unassign";a.jumpToPage=app.TOOLS.jumpToPage;a.model=a.model||{};a.ctx=a.ctx||{};a.success=!1;a.loadReady=!1;a.lags=[];a.lans=[];a.ctx.HWDMZport=e.get_HWDMZport()||"LAN4";a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&p.logout();var x=function(){b.all([function(){return t.post({url:resource_base+
"data/lan_8021x.json",method:"get_8021x",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})}()]).then(function(b){a.model={};for(var e=0;e<b.length;e++)angular.extend(a.model,b[e].data.result);l();angular.forEach(a.model.interfaces["interface"],function(b,d){a.model["interfaces-state"]&&angular.forEach(a.model["interfaces-state"]["interface"],function(a,d){b.name==a.name&&angular.extend(b,{s_ref:a})})});a.collects_dot1x_avail_if();a.grid8021X.Options.data=a.lans;
a.loadReady=!0})},n=function(){angular.forEach(a.model.interfaces["interface"],function(b,e){b.name.match(/^LAN/)&&(u.recover_object(b,a.use_portset_sample),void 0==b["lag-ref"]&&(b["lag-ref"]="unassign"));b.name.match("^"+a.ctx.HWDMZport+"$")&&b.dmz&&!0===b.dmz.enable&&(b["lag-ref"]="unassign")})},l=function(){a.use_8021x_sample={dot1x:{enable:!1}};u.recover_object(a.model,a.use_8021x_sample);a.use_if_8021x_sample={dot1x:{enable:!1,"authorized-mode":"auto"}};angular.forEach(a.model.interfaces["interface"],
function(b,e){b.name.match(/^LAN|^LAG/)&&(void 0==b.dot1x&&u.recover_object(b,a.use_if_8021x_sample),b.edit=!0,b.dot1x_auth={select:b.dot1x["authorized-mode"],list:a.schema.auth_modes})});n()},r=function(a,b){1<a.length&&(a=a.sort(function(a,d){var c="",h="",c=0<=a.name.search(b)?a.name.replace(b,""):"0",h=0<=d.name.search(b)?d.name.replace(b,""):"0",c=parseInt(c,10),h=parseInt(h,10);return c>h?1:-1}));return a};a.filter_LAN=function(a,b,e){return a.name.match(/^LAN/)?!0:!1};a.filter_LAG=function(a,
b,e){return a.name.match(/^LAG/)?!0:!1};a.collects_dot1x_avail_if=function(){a.ctx.inused_lag=[];var b=w("filter")(a.model.interfaces["interface"],a.filter_LAN),e=w("filter")(a.model.interfaces["interface"],a.filter_LAG);angular.forEach(b,function(b){b.name===a.ctx.HWDMZport&&(b.dmz&&!0===b.dmz.enable)&&(b.edit=!1);void 0!==b["lag-ref"]&&a.ctx.inused_lag.push(b["lag-ref"])});b=r(b,"LAN");a.lags=e;a.lans=b};a.authmode_change=function(b,e,k,d){b=e.entity;e=b["lag-ref"];k=a.lans;d=a.lags;var c;if("unassign"!==
e){for(c=0;c<k.length;c++)"unassign"!=k[c]["lag-ref"]&&k[c]["lag-ref"]==e&&(k[c].dot1x_auth.select=b.dot1x_auth.select);for(c=0;c<d.length;c++)d[c].name==e&&(d[c].dot1x=d[c].dot1x||{},d[c].dot1x_auth.select=b.dot1x_auth.select)}};a.selected=a.selected||{};a.grid8021X=a.grid8021X||{};a.link_str={"false":"Link Down","true":"Link Up"};a.grid8021X.Options=app.uiGrid.generateGridOptions({columnDefs:[{field:"name",displayName:a.DICT("802.1X_Configuration_Port_Name"),width:150},{field:"dot1x_auth",displayName:a.DICT("802.1X_Configuration_Administrative_Status"),
id:"8021XStatus",cellTemplate:m.get("UG_table_select_with_inline_edit.html"),changedCbk:a.authmode_change,editRow:"edit"},{field:"s_ref.dot1x",displayName:a.DICT("802.1X_Configuration_Port_Status"),cellTemplate:m.get("T_8021x_PortStatus.html")}]});a.selRow=function(b,e){a.selected.index=b.rowIndex};a.save=function(){for(var b=a.lans.concat(a.lags),b=angular.copy(b),e=a.model.dot1x.enable,k=b.length;k--;){delete b[k].s_ref;delete b[k].edit;void 0!==b[k].dot1x_auth&&(b[k].dot1x["authorized-mode"]=b[k].dot1x_auth.select,
delete b[k].dot1x_auth);if(angular.isUndefined(b[k]["lag-ref"])||"unassign"==b[k]["lag-ref"])b[k]["lag-ref"]="";for(var d in b[k])switch(d){case "name":case "lag-ref":break;case "dot1x":b[k].name===a.ctx.HWDMZport&&(angular.isDefined(b[k][d]["authorized-mode"])&&b[k].dmz&&!0===b[k].dmz.enable)&&delete b[k][d]["authorized-mode"];b[k][d].enable=e;break;default:delete b[k][d]}}t.post({url:resource_base+"data/lan_8021x.json",method:"set_8021x",params:{dot1x:a.model.dot1x,interfaces:{"interface":b}},success:function(b){a.success=
!0;x();a.resetModified()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})};a.cancel=function(){x();a.resetModified()};a.template_note=a.DICT("802.1X_Configuration_Note_8021X",{"%s":"<a ng-click=\"jumpToPage('System_Config_User_Accounts')\">"+a.DICT("802.1X_Configuration_User_Account")+"</a>"});(function(){a.schema={};a.schema.auth_modes=[{id:"force",displayName:a.DICT("802.1X_Configuration_Force_Authorized")},{id:"auto",displayName:a.DICT("802.1X_Configuration_Auto")}];
a.schema.auth_str={"force-authorized":"Force Authorized","force-unauthorized":"Force Unauthorized",authFailed:"Authenticating Failed",authenticating:"Authenticating",authorized:"Authorized"};a.schema.link_status=function(b){var e="";switch(b){case "down":case "NotConnected":e=a.DICT("802.1X_Configuration_Link_Down");break;case "up":case "Connected":e=a.DICT("802.1X_Configuration_Link_Up");break;case "Disabled":e=a.DICT("802.1X_Configuration_Disabled");break;default:e=b}return e}})();x()}]);app.controller("port_settings_main",["$scope","$rootScope","$log","MyHttp","$http","ngGridCellBuilder","$filter","$timeout","$templateCache","Sets","UserSession","userAccessRight","modelInfo",function(a,b,t,m,w,u,p,q,e,x,n,l,r){a.LAGUNASSIGN="unassign";a.flags=a.flags||{};a.flags.LAG_PMMonPort_MutualExclusive=!1;a.flags.LAG_AutoMode_spcific_dealwith=!1;a.flags.showWANPortSetting=!0;r.get_pid().match("^RV340")?a.flags.LAN1notSupportLAG=!0:a.flags.LAN1notSupportLAG=!1;var v;v=a.flags.showWANPortSetting?
/^LAN|^LAG|^WAN\d+$/:/^LAN|^LAG/;a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.HWDMZport=r.get_HWDMZport()||"LAN4";a.success=!1;a.loadReady=!1;a.PMdestRefresh=!1;a.userAccessFlag=l.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var s=function(a){a=a.sort(function(a){var b=function(a){var b=0,c=0;a=a.name.match(/^([A-zA-Z_]+)([0-9]*)/);b="LAN"==a[1]?100:"LAG"==a[1]?200:"WAN_PORT"==a[1]?300:"WAN"==a[1]?400:"USB"==a[1]?500:"TUN"==a[1]?600:"VLAN"==a[1]||"DMZ"==a[1]?1E4:900;c=a[2]||0;return b+
parseInt(c,10)};a=!a?1:-1;return function(c,d){var h=b(c),e=b(d);return a*((h>e)-(e>h))}}(!1))},k=function(){m.post({url:resource_base+"data/lan_port_settings.json",method:"get_port_settings",success:function(b){a.model={};angular.extend(a.model,b.data.result);s(a.model.interfaces["interface"]);d();for(var c=a.model.interfaces["interface"].length-1;0<=c;c--)b=a.model.interfaces["interface"][c],b.name.match(v)||a.model.interfaces["interface"].splice(c,1);a.schema=a.schema||{};a.schema.ethmodes=[{id:"mode-auto",
desc:a.DICT("Port_Settings_Auto_Negotiation")},{id:"mode-10m-half",desc:a.DICT("Port_Settings_Half_10")},{id:"mode-10m-full",desc:a.DICT("Port_Settings_Full_10")},{id:"mode-100m-half",desc:a.DICT("Port_Settings_Half_100")},{id:"mode-100m-full",desc:a.DICT("Port_Settings_Full_100")}];b=a.schema;for(var c=a.schema.ethmodes,e=["desc"],k={},l,n,r,q,p=0;p<c.length;p++){l=c[p];n=l.id;for(var x=0;x<e.length;x++)r=e[x],q=l[r],k[n]={},k[n][r]=q}b.ethmodesHash=k;a.schema.linkstatus=[{id:0,displayName:a.DICT("Port_Settings_Down")},
{id:1,displayName:a.DICT("Port_Settings_Up")},{id:2,displayName:"-"}];a.schema.alwaysTrue=!0;a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);b=a.model_del["port-mirror"];for(var m in b)switch(m){case "tx-monitors-ports":case "rx-monitors-ports":break;default:delete b[m]}a.model_del["port-mirror"]["tx-monitors-ports"].splice(0);a.model_del["port-mirror"]["rx-monitors-ports"].splice(0);m=a.model.interfaces["interface"];b=a.model_orig.interfaces["interface"];for(c=0;c<m.length;c++)m[c]._old=
b[c];a.init_if_mirror_status("tx");a.init_if_mirror_status("rx");a.gridPort.Options.data=a.model.interfaces["interface"];a.loadReady=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})};k();var d=function(){a.use_portmirror_sample={"port-mirror":{enable:!1,"tx-dst-port":"LAN4","tx-monitors-ports":[],"rx-dst-port":"LAN4","rx-monitors-ports":[]}};x.recover_object(a.model,a.use_portmirror_sample);a.use_portset_sample={edit:!0,editEEE:!0,eee:!0,"flow-control":!0,
"port-mode":"mode-100m-full"};angular.forEach(a.model.interfaces["interface"],function(b,c){b.name.match(/^LAN|^WAN\d+$/)&&(x.recover_object(b,a.use_portset_sample),void 0==b["lag-ref"]&&(b["lag-ref"]="unassign"));a.flags.showWANPortSetting&&b.name.match(/^WAN\d+$/)&&(b.editEEE=!1,b.eee=!0);b.name.match(/^LAN4/)&&b.dmz&&!0===b.dmz.enable&&(b["lag-ref"]="unassign")});angular.forEach(a.model.interfaces["interface"],function(a,b){if(a.name.match(/^VLAN/))for(var c in a)switch(c){case "name":case "type":case "vlan-interface-settings":break;
default:delete a[c]}})};a.filter_LAN_only=function(a,b,c){return a.name.match(/^LAN/)?!0:!1};a.collect_port_list=function(){return p("filter")(a.model.interfaces["interface"],a.filter_LAN_only)};a.LAN_exclude_lagref_HWDMZ=function(a,b,c){b="unassign"==a["lag-ref"];return a.name.match(/^LAN/)&&b?a.dmz&&!0===a.dmz.enable?!1:!0:!1};a.collect_destport_list=function(b){var c=p("filter")(a.model.interfaces["interface"],a.LAN_exclude_lagref_HWDMZ);if(!a.PMdestRefresh){!0===a.flags.LAG_PMMonPort_MutualExclusive&&
1>=c.length&&(a.model["port-mirror"].enable=!1);for(var d=!1,e=0;e<c.length;e++)a.model["port-mirror"]["tx-dst-port"]==c[e].name&&(d=!0);d||(a.model["port-mirror"]["tx-dst-port"]=c[0].name,b&&!0===b.destChangeNotice&&app.TOOLS.criticalAlertBox({msg:"The Destination Port of Port Mirror will change to '"+c[0].name+"'",cbk:function(a){}}));a.PMdestRefresh=!0}return c};a.filter_LAN_specific_rule=function(b,c,d){return a.flags.LAN1notSupportLAG&&b.name.match(/^LAN1$/)?!1:b.name.match(/^LAN/)?!0:!1};a.collect_lag_port_list=
function(){return p("filter")(a.model.interfaces["interface"],a.filter_LAN_specific_rule)};a.save=function(){var b=function(a,b,c){return a.name.match(/^VLAN/)?!0:!1},c=p("filter")(a.model.interfaces["interface"],function(a,b,c){return a.name.match(v)?!0:!1});(function(c){var d=p("filter")(a.model.interfaces["interface"],b),g=[];angular.forEach(d,function(a,b){if(a["vlan-interface-settings"]&&a["vlan-interface-settings"]["vlan-id"]){var c=a["vlan-interface-settings"]["vlan-id"];1!=c&&g.push(c)}});
var e=function(a){a["vlan-settings"]={"untagged-vlan-id":1,"tagged-vlans":{"vlan-id":g.join(" ")}}},k={};angular.forEach(c,function(b,c){var d=a.model.interfaces["interface"].indexOf(b),d=a.model_orig.interfaces["interface"][d],g={};b.name.match(/^LAG/)&&(g={intf:b,flag_lag_updated:!1},d&&d.enabled!=b.enabled?(e(b),g.flag_lag_updated=!0):d||cLog(DEBUG,"Error: not found origItem named "+b.name));k[b.name]=g});angular.forEach(c,function(b,c){var d=a.model.interfaces["interface"].indexOf(b),d=a.model_orig.interfaces["interface"][d];
b.name.match(/^LAN/)&&"unassign"!=d["lag-ref"]&&"unassign"==b["lag-ref"]?e(b):b.name.match(/^LAN/)&&"unassign"!=b["lag-ref"]&&(d=k[b["lag-ref"]].intf,angular.isDefined(d)&&(b["vlan-settings"]=angular.copy(d["vlan-settings"])))})})(c);var d=function(b){var c=angular.copy(b);(function(){for(var b=p("filter")(c,a.ifNamed("^LAG")),d=0;d<b.length;d++){b[d]._old.enabled!==b[d].enabled&&(b[d].dot1x=b[d].dot1x||{},b[d].dot1x["authorized-mode"]="force",Log(DEBUG,"set authorized-mode "+b[d].dot1x["authorized-mode"]));
var g=b[d].name;angular.forEach(c,function(a,c){a.name.match(/^LAN/)&&a["lag-ref"]==g?(a.dot1x=a.dot1x||{},a.dot1x["authorized-mode"]=b[d].dot1x["authorized-mode"]):a.name.match(/^LAN/)&&("unassign"!==a._old["lag-ref"]&&"unassign"==a["lag-ref"])&&(a.dot1x=a.dot1x||{},a.dot1x["authorized-mode"]="force")})}})();angular.forEach(c,function(b,c){a.flags.showWANPortSetting&&b.name.match(/^WAN\d+$/)&&delete b.eee;if(b._monitorVal||!1===b._monitorVal)b._monitorVal=void 0;"unassign"==b["lag-ref"]&&(b["lag-ref"]=
"");void 0!==b.dmz&&delete b.dmz;void 0!==b._old&&delete b._old;delete b.edit;delete b.editEEE});return c}(c);(function(){m.post({url:resource_base+"data/lan_port_settings.json",method:"set_port_settings",params:{interfaces:{"interface":d},"port-mirror":a.model["port-mirror"]},success:function(b){a.success=!0;a.config_saved=!0;k()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);k()}})})();a.resetModified()};a.cancel=function(){k();a.resetModified()};var c=function(a,
b){var c={};"tx"==a?(c.keypath1="tx-dst-port",c.keypath2="tx-monitors-ports",c.keyname2="tx-monitors-port",c.fname=b||"_monitorVal"):"rx"==a&&(c.keypath1="rx-dst-port",c.keypath2="rx-monitors-ports",c.keyname2="rx-monitors-port",c.fname=b||"_monitorVal");return c};a.init_if_mirror_status=function(b,d){var e=a.model["port-mirror"],k=c(b,d),l=k.keypath2,n=k.keyname2;d=k.fname;k=p("filter")(a.model.interfaces["interface"],{type:"ethernetCsmacd"});angular.forEach(k,function(a,b){angular.forEach(e[l],
function(b,c){a.name==b[n]&&(a[d]=!0)})})};a.update_port_mirror_status=function(b,d){var e=a.model["port-mirror"],k=a.model_del["port-mirror"],l=c(b,d),n=l.keypath2,r=l.keyname2;d=l.fname;l=p("filter")(a.model.interfaces["interface"],{type:"ethernetCsmacd"});angular.forEach(l,function(a,b){if(!0===a[d]){var c,h;for(h=e[n].length-1;0<=h;h--)e[n][h][r]==a.name&&(c=!0);c||(h={},h[r]=a.name,e[n].push(h));for(h=k[n].length-1;0<=h;h--)k[n][h][r]==a.name&&k[n].splice(h,1)}else{c=-1;for(h=e[n].length-1;0<=
h;h--)e[n][h][r]==a.name&&(c=h);-1!=c&&(h=e[n].splice(c,1),k[n].push(h[0]))}})};a.update_txrx_port_routine=function(b){a.model["port-mirror"]["tx-dst-port"]=b;a.model["port-mirror"]["rx-dst-port"]=b};a.update_monitorDestTx=function(b){var c=a.model["port-mirror"]["tx-dst-port"];b=p("filter")(a.model.interfaces["interface"],{type:"ethernetCsmacd"});angular.forEach(b,function(b,d){c==b.name&&(b._monitorVal=!1,q(function(){a.update_port_mirror_status("tx")},100))})};a.update_monitorDestRx=function(b){var c=
a.model["port-mirror"]["rx-dst-port"];b=p("filter")(a.model.interfaces["interface"],{type:"ethernetCsmacd"});angular.forEach(b,function(b,d){c==b.name&&(b._monitorVal=!1,q(function(){a.update_port_mirror_status("rx")},100))})};a.showPortName=function(a){return a.name};a.disablePort=function(b){var c;if(b.name==a.model["port-mirror"]["tx-dst-port"]||!a.model["port-mirror"].enable||a.ctx.HWDMZport==b.name&&b.dmz&&b.dmz.enable)c=!0;return c};a.gridPort=a.gridPort||{};a.gridPort.Options=app.uiGrid.generateGridOptions({onRegisterApi:function(a){a.core.registerRowsProcessor(function(a){var b=
[];angular.forEach(a,function(a){a.entity.name.match(/^[LW]AN/)&&b.push(a)});return b},10)},columnDefs:[{field:"name",displayName:a.DICT("Port_Settings_Port")},{field:"description",displayName:a.DICT("Port_Settings_Port_Label"),id:"portLabel",cellTemplate:e.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"legal-char maxlength='32'"),editRow:"edit"},{field:"enabled",displayName:a.DICT("Port_Settings_Enabled"),id:"portEnabled",cellTemplate:e.get("UG_table_checkbox_with_inline_edit.html"),
editRow:"edit"},{field:"eee",displayName:a.DICT("Port_Settings_EEE"),id:"portEEE",editRow:"editEEE",cellTemplate:e.get("UG_table_checkbox_with_inline_edit.html")},{field:"flow-control",displayName:a.DICT("Port_Settings_Flow_Control"),id:"portFlowCtrl",cellTemplate:e.get("UG_table_checkbox_with_inline_edit.html"),editRow:"edit"},{field:"port-mode",displayName:a.DICT("Port_Settings_Mode"),minWidth:210,cellTemplate:e.get("UG_genericSelect.html").replace(/NGOPTIONS/,"mode.id as mode.desc for mode in grid.appScope.get_availPortMode(row.entity) ").replace(/data-ng-expansion/,
"id=\"{{'slct_portMode_'+row.rowIndex}}\" ng-change=\"grid.appScope.portmode_change(row.entity, '{{MODEL_COL_FIELD}}')\"").replace(/ng-style="[^\"]+"/,"")}]});a.get_availPortMode=function(b){var c="unassign"==b["lag-ref"];return p("filter")(a.schema.ethmodes,function(a,b,d){return!c&&a.id.match(/-half/)?!1:!0})};a.ifNamed=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};a.portmode_change=function(b,c){for(var d=b["lag-ref"],e=p("filter")(a.model.interfaces["interface"],a.ifNamed("^LAN")),
k=0;k<e.length;k++)"unassign"!=e[k]["lag-ref"]&&(e[k]["lag-ref"]==d&&null!=b["port-mode"])&&(!1==a.flags.LAG_AutoMode_spcific_dealwith?e[k]["port-mode"]=b["port-mode"]:!0==a.flags.LAG_AutoMode_spcific_dealwith&&("mode-auto"!=e[k]["port-mode"]&&"mode-auto"!=b["port-mode"])&&(e[k]["port-mode"]=b["port-mode"]))};a.disableLagSelection=function(b,c){for(var d=!1,e=a.collect_lag_port_list(),k=b.name,l=0,n=0;n<e.length;n++)e[n]["lag-ref"]==k&&(e[n].dmz&&!0!=e[n].dmz.enable||!angular.isDefined(e[n].dmz))&&
l++;8<=l&&c["lag-ref"]!=b.name&&(d=!0);return d};a.update_lag_enable=function(b,c,d){for(var e=p("filter")(a.model.interfaces["interface"],a.ifNamed("^LAG")),k=p("filter")(a.model.interfaces["interface"],a.ifNamed("^LAN")),l=function(b,c,d){var g=!1;b["lag-ref"]==d&&b["port-mode"].match(/-half$/)&&(g=a.schema.ethmodesHash[b["port-mode"]].desc,alert("Mode '"+g+"' on '"+b.name+"' are not allow, change to 'Full-Duplex' mode to be a LAG member"),g=!0);c&&b["lag-ref"]==d&&(b["port-mode"]!=c?(g=a.schema.ethmodesHash[b["port-mode"]].desc,
alert("Mode '"+g+"' on '"+b.name+"' are not consistency with LAG member"),g=!0):b["port-mode"]!=c&&Log(DEBUG,"DEFAULT"));return g},n,r,s=0;s<e.length;s++){var v=e[s].name,x=!1;n=void 0;for(var m=0;m<k.length;m++)if(k[m]["lag-ref"]==v){k[m]!=b&&(x=!0);!0===a.flags.LAG_PMMonPort_MutualExclusive&&(k[m]._monitorVal=!1);if(k[m]!=b&&!n&&(!1==a.flags.LAG_AutoMode_spcific_dealwith||!0==a.flags.LAG_AutoMode_spcific_dealwith&&"mode-auto"!=k[m]["port-mode"]))n=k[m]["port-mode"];k[m].dot1x&&k[m].dot1x["authorized-mode"]&&
(k[m]!=b&&!r)&&(r=k[m].dot1x["authorized-mode"])}l(b,n,v)?(""==c&&(c="unassign"),q(function(){b["lag-ref"]=c;b["port-mode"]=d},40)):b["lag-ref"]==v&&(x=!0);a.update_port_mirror_status("tx");a.update_port_mirror_status("rx");a.PMdestRefresh=!1;a.collect_destport_list({destChangeNotice:!0});e[s].enabled=x?!0:!1;e[s].dot1x=e[s].dot1x||{}}}}]);app.controller("p_lan_dhcp_static_main",["$scope","$q","MyHttp","$templateCache","UserSession","userAccessRight","Sets",function(a,b,t,m,w,u,p){var q={source:"http",getResult:function(a,b,d){return p.getResult(this,a,b,d)}},e=app.rshelper;a.model=a.model||{};a.success=!1;a.loadReady=!1;a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var x=function(){a.loadReady=!1;var e={DHCPStatic:b.defer()};b.all({DHCPStatic:function(){var a={static_dhcp:{entry:[]}};return"dproxy"==
q.source?(proxy.DHCPStatic.init(function(){var a=proxy.DHCPStatic.get_config();p.recover_object(a,{static_dhcp:{entry:[]}});e.DHCPStatic.resolve(a)}),e.DHCPStatic.promise):t.post({url:resource_base+"data/lan_dhcp_static.json",method:"get_dhcp_static",options:{transformResponse:app.modelhelper.db2webFn},success:function(b){p.default_result(b,a)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})}()}).then(function(b){a.model={};a.model.static_dhcp=q.getResult(b.DHCPStatic,
"static_dhcp");n();a.model_orig=angular.copy(a.model);a.gridDHCPStatic.Options.data=a.model.static_dhcp.entry;a.loadReady=!0})};x();var n=function(){a.use_static_dhcp_sample={name:"",edit:!1,ip_address:"",mac:"",enable:!0,checked:!1};angular.forEach(a.model.static_dhcp.entry,function(b){p.recover_object(b,a.use_static_dhcp_sample)});a.model.StatusMap={"true":"Enabled","false":"Disabled"}};a.T_cellEdit=m.get("T_editWithNoFoucs_by_inner_rs_objs.html").replace(/RSNAME/g,"$$$$rowstate");a.selected=a.selected||
{};a.gridDHCPStatic=a.gridDHCPStatic||{};a.gridDHCPStatic.rowEditableState=[];var l=function(a,b,d,c){if(!a)return!0;var h=!0,g=[],e=[],l=b.length,z,n,r=[],v=!0;"delete_row"===a.type&&(v=!1);var q=function(a,g,e){var s;e=!0;var A;if(!(0>g||g>l)){d&&d(a)&&(h=e=!1);for(z=g;z<l;z++)if(n=b[z])n===a?(s=n,A=z):c(n,a)?(r[z]="x",e=h=!1):r[z]="v";s&&(r[A]=e?"v":"x")}};if(v){if(!a.row)return!0;q(a.row.entity,0,a.row.rowIndex)}else for(a=0;a<l;a++)b[a]&&q(b[a],a,a);(function(a){e=[];g=[];for(var b=0,c;b<a.length;b++)c=
a[b],"v"==c?e.push(b):"x"==c&&g.push(b)})(r);return{result:h,invalidRows:g,validRows:e}};a.gridDHCPStatic.nameCbk=function(b){return l(b,a.model.static_dhcp.entry,void 0,function(a,b){var c=!1;a.name==b.name&&(c=!0);return c})};a.gridDHCPStatic.ipv4Cbk=function(b){return l(b,a.model.static_dhcp.entry,void 0,function(a,b){var c=!1;if(b.enable&&a.enable&&(a.ip_address===b.ip_address||a.mac===b.mac)||a.ip_address===b.ip_address&&a.mac===b.mac)c=!0;return c})};var r=function(a,b,d){var c,h,g;g=a.length;
angular.forEach(a,function(a){a[d]=!1});for(c=0;c<g;c++)for(h=c+1;h<g;h++)a[c][b]===a[h][b]&&(a[c][d]=!0,a[h][d]=!0)};a.gridDHCPStatic.chkName=function(){a.model.static_dhcp&&r(a.model.static_dhcp.entry,"name","isDupName")};a.gridDHCPStatic.chkIPv4=function(b){a.model.static_dhcp&&r(a.model.static_dhcp.entry,"ip_address","isDupIpv4")};a.gridDHCPStatic.chkMac=function(){a.model.static_dhcp&&r(a.model.static_dhcp.entry,"mac","isDupMac")};a.gridDHCPStatic.Selections=[];a.gridDHCPStatic.procNgClick=function(b){a.gridDHCPStatic.Selections=
[];angular.forEach(a.model.static_dhcp.entry,function(b,d){b.checked?a.gridDHCPStatic.Selections.push(b):b.edit=!1})};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridDHCPStatic.Options=app.uiGrid.generateGridOptions({IDPreifx:"lanDHCPStatic",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridDHCPStatic.procNgClick,headerChangedCbk:a.gridDHCPStatic.procNgClick,disableChkBoxField:"disableChk"},{field:"name",displayName:a.DICT("Static_DHCP_Name"),id:"lanDHCPStaticName",
validationCbk:"gridInvalidCbk",invalidField:"isDupName",invalidName:"isDupName",editRow:"edit",required:!0,cellTemplate:m.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/g,'static-dhcp-name maxlength="64"'),change:a.gridDHCPStatic.chkName},{field:"ip_address",displayName:a.DICT("Static_DHCP_IPv4_Addr"),id:"lanDHCPStaticIP",validationCbk:"gridInvalidCbk",invalidField:"isDupIpv4",invalidName:"isDupIpv4",editRow:"edit",required:!0,cellTemplate:m.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/g,
"ipv4-ip"),change:a.gridDHCPStatic.chkIPv4},{field:"mac",displayName:a.DICT("Static_DHCP_MAC_Addr"),id:"lanDHCPStaticMAC",validationCbk:"gridInvalidCbk",invalidField:"isDupMac",invalidName:"isDupMac",editRow:"edit",required:!0,cellTemplate:m.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/g,'mac-address maxlength="17"'),change:a.gridDHCPStatic.chkMac},{field:"enable",displayName:a.DICT("Static_DHCP_Enabled"),id:"lanDHCPStaticEnable",cellTemplate:m.get("UG_table_checkbox_with_inline_edit.html"),
editRow:"edit",changedCbk:a.gridDHCPStatic.chkIPv4}]});a.gridDHCPStatic.selRow=function(a,b){};a.gridDHCPStatic.add=function(){100<=a.model.static_dhcp.entry.length?app.TOOLS.criticalAlertBox({msg:a.DICT("Static_DHCP_Reach_Max_Entry",{"%d":100}),ckb:function(){}}):(a.gridDHCPStatic.Options.data.push({name:"",ip_address:"",mac:"",enable:!0,edit:!1,checked:!0,edit:!0}),a.gridDHCPStatic.Options.gridApi.customApi.scrollToLast(),a.modified())};a.gridDHCPStatic.edit=function(){angular.forEach(a.gridDHCPStatic.Options.data,
function(a){a.checked&&(a.edit=!0)})};a.gridDHCPStatic.del=function(){var b=a.model.static_dhcp.entry,e;if(b){e=b.length;for(e-=1;0<=e;e--)b[e].checked&&b.splice(e,1);a.modified();a.gridDHCPStatic.chkIPv4();a.gridDHCPStatic.chkName()}};var v=function(a,b,d){var c=[],h;angular.forEach(a,function(a,e){h=!1;angular.forEach(b,function(b,c){a[d]===b[d]&&(h=!0)});if(!h){var l={};l[d]=a[d];c.push(l)}});return c};a.save=function(){var b=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){angular.isDefined(a.checked)&&
delete a.checked;angular.isDefined(a.edit)&&delete a.edit;angular.isDefined(a.disableChk)&&delete a.disableChk;angular.isDefined(a.isDupName)&&delete a.isDupName;angular.isDefined(a.isDupIpv4)&&delete a.isDupIpv4;angular.isDefined(a.isDupMac)&&delete a.isDupMac});e.rs_clean(a);return a}(a.model.static_dhcp.entry),k=function(){var c=app.modelhelper.web2dbFn({static_dhcp:{entry:b}});t.post({url:resource_base+"p_data/rpc_result.json",method:"set_dhcp_static",params:c,success:function(b){a.success=!0;
a.config_saved=!0;x()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);x()}})},d=v(a.model_orig.static_dhcp.entry,a.model.static_dhcp.entry,"name"),c=app.modelhelper.web2dbFn({static_dhcp:{entry:d}}),h=function(){t.post({url:resource_base+"p_data/rpc_result.json",method:"del_dhcp_static",params:c,success:function(b){k();a.resetModified()},error:function(b){k();a.resetModified();console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}})};"dproxy"==
q.source?(d={},d.static_dhcp=b,proxy.DHCPStatic.set_config(d),a.result=proxy.DHCPStatic.commit({cbk:function(){a.success=!0;x()}})):0<d.length?h():k();a.resetModified()};a.cancel=function(){x();a.resetModified()}}]);app.controller("lan_ra_main",["$scope","$q","MyHttp","Sets","$templateCache","$filter","GridRowBasedEditingAdv","$timeout","UserSession","userAccessRight","DHCP_PD","ipv6_lib",function(a,b,t,m,w,u,p,q,e,x,n,l){a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.pd_list=[];a.func_flag=a.func_flag||{ipv6_addr1:!1,ipv6ra_prefix_spec_type_prefer_isp:!0};a.selected=a.selected||{};a.selected.vlan_index=0;a.success=!1;a.loadReady=!1;a.userAccessFlag=x.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();
var r=a.fop={get_origin_mode:function(a){var b="STATIC";a&&a.isp&&(b="ISP");return b},set_origin_mode:function(a,b,c){"STATIC"===b?(a["static"]=null,a.isp=void 0):angular.isDefined(c.wan_ifname)?"ISP"===b&&(b=parseInt(c.sub_prefix,16),a["static"]=void 0,a.isp={"interface":c.wan_ifname,suffix:b}):(a["static"]=null,a.isp=void 0)}};createIpAddr();var v=function(){var e=t.post({url:resource_base+"data/lan_ra.json",method:"get_interface",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+
a.config.url)}}),l=t.post({url:resource_base+"data/system_summary.json",method:"get_interface_state",params:{filter:"VLAN"},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),r=t.post({url:resource_base+"data/get_wan_ipv6_prefix.json",method:"get_wan_ipv6_prefix",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,l,r]).then(function(b){angular.extend(a.model,b[0].data.result.interfaces);angular.extend(a.model,b[1].data.result);
a.model["interface"]=a.sort_vlan_interface(a.model["interface"]);c();k(b[2]);d(b[0]);h();a.ctx.pd_list=n.get_pd_list(a.model.interfaces["interface"],a.model["interfaces-state"]["interface"]);a.model_orig=angular.copy(a.model);g();a.arrVLANv6=a.collect_vlan_v6_valid_ref();0<a.arrVLANv6.length?(a.arrVLANv6[a.selected.vlan_index]||(a.selected.vlan_index=0),a.selected.vlanif=a.arrVLANv6[a.selected.vlan_index],a.update_ra_ref(),a.gridShow=!0,a.noIpv6Vlan=!1):(a.selected.vlanif={},a.noIpv6Vlan=!0);a.selected.vlanif_ra["prefix-list"].prefix.sort(function(a,
b){return b.ref.auto_gen&&!a.ref.auto_gen?1:a.ref.auto_gen&&!b.ref.auto_gen?-1:0});a.gridRA.Options.data=a.selected.vlanif_ra["prefix-list"].prefix;a.loadReady=!0;setTimeout(function(){a.resetModified()},50)})},s=function(a,b,c){return a.name.match(/^VLAN/)&&a.ipv6&&!0===a.ipv6.enabled?!0:!1};v();var k=function(b){(b=b.data.result)&&(b["interfaces-state"]&&b["interfaces-state"]["interface"])&&angular.forEach(b["interfaces-state"]["interface"],function(b,c){a.model["interfaces-state"]["interface"].push(b)})},
d=function(b){(b=b.data.result)&&(b.interfaces&&b.interfaces["interface"])&&angular.forEach(b.interfaces["interface"],function(b,c){a.model.interfaces["interface"].push(b)})},c=function(){a.use_interfaces_state_sample={"interfaces-state":{"interface":[]}};m.recover_object(a.model,a.use_interfaces_state_sample);a.model.interfaces=a.model.interfaces||{};a.model.interfaces["interface"]=angular.copy(a.model["interface"]);var b=[],c;angular.forEach(a.model["interface"],function(a,c){a.name.match(/^VLAN/)||
(b.push(c),Log(DEBUG,a.name),Log(DEBUG,"=="+a.type+" = "+c))});for(c=b.length-1;0<=c;c--)Log(DEBUG,"DEL=="+b[c]),a.model["interface"].splice(b[c],1);angular.forEach(a.model["interface"],function(a,b){a.name.match(/^VLAN/)&&(a.ipv6||(a.ipv6={}),m.recover_object(a.ipv6,{"ipv6-router-advertisements":{mode:"unsolicited-multicast","max-rtr-adv-interval":30,"router-preference":"high","link-mtu":1500,"default-lifetime":3600,"prefix-list":{prefix:[]}}}),a.ipv6&&(a.ipv6["ipv6-router-advertisements"]&&1280>
a.ipv6["ipv6-router-advertisements"]["link-mtu"])&&(a.ipv6["ipv6-router-advertisements"]["link-mtu"]=1500))})},h=function(){var b=[{id:"unicast",displayName:a.DICT("Router_Advertisement_Unicast")},{id:"unsolicited-multicast",displayName:a.DICT("Router_Advertisement_Unsolicited_Multicast")}],c=[{id:"high",displayName:a.DICT("Router_Advertisement_High")},{id:"medium",displayName:a.DICT("Router_Advertisement_Medium")},{id:"low",displayName:a.DICT("Router_Advertisement_Low")}];a.schema=a.schema||{};a.schema.ra_modes=
b;a.schema.router_pref=c},g=function(b){var c=function(a,b){if(!a.ipv6||!a.ipv6.address)return!1;for(var c=!1,d=a.ipv6.address,g=0;g<d.length;g++){var h=d[g];if(h){var c=!1,e=h["prefix-length"],h=app.TOOLS.validation.ipv6_getNet(h.ip,e),k=b.split("/"),l=k[1],k=app.TOOLS.validation.ipv6_getNet(k[0],l);e==l&&angular.equals(h,k)&&(c=!0);c=c?!0:!1}else c=!1;if(c)break}return c},d=function(b,d){var g=d["prefix-spec"],h=g.indexOf("/");d.checked=!1;d.ref={};var e=c(b,g);angular.extend(d.ref,{prx:g.substring(0,
h),len:parseInt(g.substring(h+1),10),type:!0===a.func_flag.ipv6ra_prefix_spec_type_prefer_isp?r.get_origin_mode(d)||"STATIC":"STATIC",pd:"WAN1",pd_prx:g.substring(0,h),pd_prx2:"",userdef_prx:g.substring(0,h),auto_gen:e});!0===a.func_flag.ipv6ra_prefix_spec_type_prefer_isp&&(g=function(b){var c;angular.forEach(a.ctx.pd_list,function(a,c){b["interface"]===a.id&&(d.ref.pd_prx1=a.id,d.ref._ip_pd_obj=a)});c=parseInt(b.suffix,10);isNaN(c)?(Log(ERROR,'[LAN RA] renew_pd_setting_by_isp_interface() got error, sub prefix is not number "'+
b.suffix+'"'),Log(ERROR,"[LAN RA] ERR: "+JSON.stringify(d))):d.ref.pd_prx2=c.toString(16);a.update_pdprx(d.ref,{entity:d})},d.isp&&d.isp["interface"]&&g(d.isp));"ISP"===d.ref.type&&d.ref._ip_pd_obj&&(g=d.ref._ip_pd_obj,g.pd_prefix||(d.ref.prx=g.prefix_name+"("+g.id+") + "+d.ref.pd_prx2))};b=a.collect_vlan_v6_valid_ref();angular.forEach(b,function(a,b){angular.forEach(a.ipv6["ipv6-router-advertisements"]["prefix-list"].prefix,function(b,c){b.isDupIpv6raps=!1;d(a,b)})})};a.update_ra_ref=function(){a.selected.vlanif_ra=
a.selected.vlanif.ipv6["ipv6-router-advertisements"];a.selected.vlan_index=a.model["interface"].indexOf(a.selected.vlanif);a.selected.vlanif_ra["prefix-list"].prefix.sort(function(a,b){return b.ref.auto_gen&&!a.ref.auto_gen?1:a.ref.auto_gen&&!b.ref.auto_gen?-1:0});a.gridRA.Options.data=a.selected.vlanif_ra["prefix-list"].prefix};a.collect_wan_dhcp_pd=function(){return a.ctx.pd_list};a.update_ipv6_prx=function(a,b,c){var d=createIpAddr();c=!0;var g;a=!d.IPv6.isValid(a)?!1:d.parse(a);!1===a&&(c=!1);
b=!d.IPv6.isValid(b)?!1:d.parse(b);!1===b&&(c=!1);if(c){a.parts.length!==b.parts.length&&console.log("Error: preview_v6ip, IPv6 part not correct");g=angular.copy(a);for(c=0;c<a.parts.length;c++)g.parts[c]=a.parts[c]|b.parts[c];g=g.toString()}return g};a.update_userdef_prx=function(b,c){var d=c.entity.ref.len;b.prx=a.update_ipv6_prx(b.userdef_prx,"::",d);b.prx&&(c.entity["prefix-spec"]=b.prx+"/"+d);r.set_origin_mode(c.entity,"STATIC");a.gridRA.chkIpv6Ip()};a.update_pdprx=function(b,c){var d=c.entity.ref.len,
g,h=b._ip_pd_obj,e;h&&(b.pd_prx1=h.pd_prefix);if(!_.isNumber(d)||!b.pd_prx2||!h)Log(DEBUG,"[LAN RA] update_pdprx() prxlen: "+d+", prx1: "+b.pd_prx1+", prx2: "+b.pd_prx2);else{g=n.get_pd_preview(b.pd_prx1,b.pd_prx2,"0",d);g=g.toNormalizedString();b.prx=g;if(b.prxPreview=g){if((h=h.id.match(/^(WAN|TUN)(\d+)($|\.\d+$)/))&&!b.auto_gen)e=parseInt(h[2],10),"TUN"===h[1]&&(e+=2),e<<=12,h[3]&&(e|=parseInt(h[3].replace(".",""),10)),e=e.toString(16)+"::/16";c.entity["prefix-spec"]=n.get_pd_preview(e,b.pd_prx2,
"0",d).toString()+"/"+d}b._ip_pd_obj&&!b._ip_pd_obj.pd_prefix&&(b.prx=b._ip_pd_obj.prefix_name+"("+b._ip_pd_obj.id+") + "+b.pd_prx2);r.set_origin_mode(c.entity,"ISP",{wan_ifname:b._ip_pd_obj&&b._ip_pd_obj.id,sub_prefix:b.pd_prx2});a.gridRA.chkIpv6Ip()}};a.update_prx_len=function(b,c){"STATIC"===c.entity.ref.type?a.update_userdef_prx(c.entity.ref,c):a.update_pdprx(c.entity.ref,c)};a.sort_vlan_interface=function(a){a=u("filter")(a,s)||[];if(0<a.length){var b=app.TOOLS.sortingInterfaceFn(!1);a=a.sort(b)}return a};
a.collect_vlan_v6_valid_ref=function(){return u("filter")(a.model["interface"],s)||[]};a.T_cellEdit=w.get("T_editWithNoFoucs_by_rowEditableState_objs.html");a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridRA=a.gridRA||{};a.gridRA.Selections=[];a.gridRA.warningCheck=function(){return 10<=a.selected.vlanif_ra["prefix-list"].prefix.length?(a.msg="Only allow maximum of 10 entries for Prefix. (Current Entry Number: "+a.selected.vlanif_ra["prefix-list"].prefix.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,
cbk:function(a){}}),!0):!1};a.gridRA.checkProtectCondition=function(){var b=!1;angular.forEach(a.selected.vlanif_ra["prefix-list"].prefix,function(a,c){!0===a.checked&&(a.ref&&!0===a.ref.auto_gen)&&(b=!0)});return b};a.gridRA.add=function(){if(!a.gridRA.warningCheck()){var b=a.selected.vlanif_ra["prefix-list"].prefix,c;c={checked:!0,edit:!1,"prefix-spec":"","preferred-lifetime":3600,ref:{prx:"",len:64,type:"STATIC",pd:"WAN1",pd_prx:""}};var d=a.ctx.pd_list;c.edit=!0;c.ref._ip_pd_obj=d[0];b.push(c);
a.gridRA.Options.gridApi.customApi.scrollToLast()}};a.gridRA.procNgClick=function(b){a.gridRA.Selections=[];angular.forEach(a.selected.vlanif_ra["prefix-list"].prefix,function(b,c){b.checked?a.gridRA.Selections.push(b):b.edit=!1})};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridRA.Options=app.uiGrid.generateGridOptions({IDPreifx:"PrefixTable",rowHeight:2*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridRA.procNgClick,disableChkBoxField:"disableChk",
headerChangedCbk:a.gridRA.procNgClick},{field:"ref",displayName:a.DICT("Router_Advertisement_IPv6_Prefix"),validationCbk:"gridInvalidCbk",minWidth:800,cellTemplate:w.get("UG_prefix_ref.html").replace(/data-ng-expansion/,'placeholder="IPv6 Prefix(e.g. fc01::0)"'),editRow:"edit"},{field:"ref.len",displayName:a.DICT("Router_Advertisement_Prefix_Length"),id:"txt_PrefixTablePrefixlen",validationCbk:"gridInvalidCbk",min:32,max:128,changedCbk:a.update_prx_len,editRow:"edit",invalidField:"isDupIpv6raps",
cellTemplate:"UG_table_text_with_inline_number_edit.html"},{field:"preferred-lifetime",displayName:a.DICT("Router_Advertisement_Lifetime"),id:"slct_PrefixTableLifetime",validationCbk:"gridInvalidCbk",cellTemplate:w.get("UG_table_text_with_inline_number_edit.html"),min:10,max:9E3,editRow:"edit"}]});var A=function(a,b){var c=!1,d=!1,g=function(a){var b=a["prefix-spec"];a=a.ref;var c=a._ip_pd_obj,d;if("ISP"!==a.type||!a.auto_gen||!c||!b)return b;if(a=c.id.match(/^(WAN|TUN)(\d+)($|\.\d+$)/))d=parseInt(a[2],
10),"TUN"===a[1]&&(d+=2),d<<=12,a[3]&&(d|=parseInt(a[3].replace(".",""),10)),d=d.toString(16)+"::",d=l.parse(d);d&&(a=l.CIDR(b))&&(b=l.combined_two_ip(d,a[0],16).toString()+"/"+a[1]);return b},h=function(a,b){var c=!1,d=g(b),h=g(a);d&&h&&(c=l.vld.is_overlap_between_prefixs(d,h));return c};a&&(b&&a["prefix-spec"]&&b["prefix-spec"])&&(d=!0);!c&&d&&(rowE_addrs=b,item_addrs=a,!0===h(rowE_addrs,item_addrs)&&(c=!0));return c};a.gridRA.chkIpv6Ip=function(){if(a.selected&&a.selected.vlanif_ra&&a.selected.vlanif_ra["prefix-list"]&&
a.selected.vlanif_ra["prefix-list"].prefix){var b=a.selected.vlanif_ra["prefix-list"].prefix,c={},d=b.length,g=!1,h,e;for(h=0;h<d;h++)e=b[h],e.isDupIpv6raps=!1;for(h=0;h<d;h++)if(e=b[h],!0!==e.isDupIpv6raps){for(var g=!1,k=h+1,l;k<d;k++)l=b[k],A&&A(l,e,c)&&(g=!0,l.isDupIpv6raps=g);g&&(e.isDupIpv6raps=!0)}}};a.gridRA.edit=function(){angular.forEach(a.selected.vlanif_ra["prefix-list"].prefix,function(a){a.checked&&(a.edit=!0)})};a.gridRA.remove=function(){var b=a.selected.vlanif_ra["prefix-list"].prefix,
c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1)};a.save=function(){var b=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){a.ipv6&&angular.forEach(a.ipv6["ipv6-router-advertisements"]["prefix-list"].prefix,function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableChk)&&delete a.disableChk;a.ref=void 0;delete a.edit;delete a.isDupIpv6raps})});return a}(a.collect_vlan_v6_valid_ref());u("filter")(a.model_orig["interface"],s);(function(){t.post({url:resource_base+
"data/lan_ra.json",forcedUsingPost:!0,method:"set_ra",params:{interfaces:{"interface":b}},success:function(b){a.success=!0;a.config_saved=!0;v()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})();a.resetModified()};a.cancel=function(){v();a.resetModified()}}]);app.factory("ciscosb",function(){return{empty_type:function(a,b){var t={};t[a]=null;return t}}});app.service("meta_data_service",[function(){this.generate=function(a,b){var t=a.groups&&a.groups.group||[],m=a.categories&&a.categories.category||[],w=a.applications&&a.applications.application||[],u={},p,q={},e={},x={},n;angular.forEach(a.behaviours&&a.behaviours.behaviour||[],function(a){x[a.id]={name:a.name||"",id:a.id||"",description:a.description||"",checked:!1,action:"log"}});angular.forEach(w,function(a){p=a.behaviors&&a.behaviors[0]&&a.behaviors[0].split(" ")||[];q[a.id]={name:a.name,id:a.id,
previous:a.parent,action:"null",checked:!1,expanded:!1,child:"behaviors",behaviors:{}};n=!1;angular.forEach(p,function(b){"-1"!==b&&x[b]&&(q[a.id].behaviors[b]=angular.copy(x[b]),n=!0)});!n&&b&&delete q[a.id]});angular.forEach(m,function(a){p=a.applications&&a.applications.application&&a.applications.application[0]&&a.applications.application[0].split(" ")||[];e[a.id]={name:a.name,id:a.id,checked:!1,action:"null",expanded:!1,child:"applications",description:a.description,applications:{}};n=!1;angular.forEach(p,
function(b){"-1"!==p&&q[b]&&(e[a.id].applications[b]=angular.copy(q[b]),n=!0)});!n&&b&&delete e[a.id]});angular.forEach(t,function(a){p=a.categories&&a.categories.categores&&a.categories.categores[0]&&a.categories.categores[0].split(" ")||[];u[a.id]={name:a.name,id:a.id,checked:!1,expanded:!1,action:"null",child:"categories",categories:{}};n=!1;angular.forEach(p,function(b){"-1"!==b&&e[b]&&(u[a.id].categories[b]=angular.copy(e[b]),n=!0)});!n&&b&&delete u[a.id]});return u}}]);app.factory("customUIGrid",["$templateCache",function(a){return{refactory:function(){a.put("ui-grid/expandableRowHeader",'<div class="ui-grid-row-header-cell ui-grid-expandable-buttons-cell"><div class="ui-grid-cell-contents"> <i ng-class="{ \'ui-grid-icon-plus-squared\' : !row.isExpanded, \'ui-grid-icon-minus-squared\' : row.isExpanded }" id="icon_plus_{{rowRenderIndex}}" ng-click="grid.api.expandable.toggleRowExpansion(row.entity)"></i></div></div>');a.put("ui-grid/expandableTopRowHeader",'<div class="ui-grid-row-header-cell ui-grid-expandable-buttons-cell"><div class="ui-grid-cell-contents"> <i ng-class="{ \'ui-grid-icon-plus-squared\' : !grid.expandable.expandedAll, \'ui-grid-icon-minus-squared\' : grid.expandable.expandedAll }" id="icon_top_plus" ng-click="grid.api.expandable.toggleAllRows()"></i></div></div>');
a.put("ui-grid/selectionRowHeaderButtons",'<input type="checkbox" ng-checked="row.isSelected" style="margin: 3px 0px" ng-click="selectButtonClick(row, $event)"></input>');a.put("ui-grid/selectionSelectAllButtons",'<input type="checkbox" ng-checked="grid.selection.selectAll" ng-click="headerButtonClick($event)"></input>');a.put("ui-grid/uiGridViewport",'<div role="rowgroup" class="ui-grid-viewport" ng-style="colContainer.getViewportStyle()">\x3c!-- tbody --\x3e<div class="ui-grid-canvas"><div ng-repeat="(rowRenderIndex, row) in rowContainer.renderedRows track by $index"class="ui-grid-row" ng-style="Viewport.rowStyle(rowRenderIndex)" pg-row><div role="row" ui-grid-row="row" row-render-index="rowRenderIndex" ></div></div></div></div>');
a.put("ui-grid/ui-grid-header",'<div role="rowgroup" class="ui-grid-header">\x3c!-- theader --\x3e<div class="ui-grid-top-panel"><div class="ui-grid-header-viewport"><div class="ui-grid-header-canvas"><div class="ui-grid-header-cell-wrapper" ng-style="colContainer.headerCellWrapperStyle()"><div role="row" class="ui-grid-header-cell-row"><div class="ui-grid-header-cell ui-grid-clearfix" ng-repeat="col in colContainer.renderedColumns track by col.uid" ui-grid-header-cell col="col" render-index="$index"></div></div></div><div class="ui-grid-header-seperator"></div></div></div></div></div>');
a.put("ui-grid/uiGridHeaderCell",'<div role="columnheader" ng-class="[col.colDef.headerClass, { \'sortable\': sortable }]" ui-grid-one-bind-aria-labelledby-grid="col.uid + \'-header-text \' + col.uid + \'-sortdir-text\'"aria-sort="{{col.sort.direction == asc ? \'ascending\' : ( col.sort.direction == desc ? \'descending\' : (!col.sort.direction ? \'none\' : \'other\'))}}"><div role="button" tabindex="0" class="ui-grid-cell-contents ui-grid-header-cell-primary-focus" col-index="renderIndex" title="TOOLTIP"><table class="ui-grid-header-custom-cell"><tr><td style="width: auto"><span class="ui-grid-header-cell-label" ui-grid-one-bind-id-grid="col.uid + \'-header-text\'">{{ col.displayName CUSTOM_FILTERS }}</span></td><td><span ui-grid-one-bind-id-grid="col.uid + \'-sortdir-text\'" ui-grid-visible="col.sort.direction || sortable" aria-label="{{getSortDirectionAriaLabel()}}"><i ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction && !sortable, \'ui-grid-icon-sort-dir\': !col.sort.direction && sortable }" title="{{isSortPriorityVisible() ? i18n.headerCell.priority + \' \' + ( col.sort.priority + 1 )  : null}}" aria-hidden="true"></i> <sub ui-grid-visible="isSortPriorityVisible()" class="ui-grid-sort-priority-number">{{col.sort.priority + 1}}</sub></span></td></tr></table></div><div role="button" tabindex="0" ui-grid-one-bind-id-grid="col.uid + \'-menu-button\'" class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" ng-click="toggleMenu($event)" ng-class="{\'ui-grid-column-menu-button-last-col\': isLastCol}" ui-grid-one-bind-aria-label="i18n.headerCell.aria.columnMenuButtonLabel" aria-haspopup="true"><i class="ui-grid-icon-angle-down" aria-hidden="true">&nbsp;</i></div><div ui-grid-filter></div></div>')}}}]);
app.factory("customNgGrid",["$templateCache",function(a){return{refactory:function(){a.put("rowTemplate.html",'<div ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}">\r\n\t<div ng-cell></div>\r\n</div>')}}}]);
app.factory("customUIBootstrapTpls",["$templateCache",function(a){return{refactory:function(){a.put("uib/template/datepicker/day.html",'<table role="grid" class="cisco-datepicker"aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}" custom-datepicker>\n  <thead>\n    <tr>\n      <th><img src="themes/img/icon/drawerTriangleCollapsedLeft.png" ng-click="move(-1); moveMonth(-1)" tabindex="-1"></img></th>\n      <th colspan="7" style="text-align:center">           <select ng-model="month" ng-options="m.id as m.displayName for m in months" ng-change="changeMonth()"></select>           <input type="number" style="width: 65px;" max="2037" min="1970" ng-model="year" ng-maxlength="4" ng-minlength="4" ng-change="changeYear()"></select>      </th>\n      <th><img src="themes/img/icon/drawerTriangleCollapsed.gif" ng-click="move(1); moveMonth(1)" tabindex="-1"></img></th>\n    </tr>\n    <tr>\n      <th></th>\n      <th ng-repeat="m in weeks track by $index" class="text-center"><small aria-label="{{::label.full}}" ng-bind="m.displayName"></small></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td></td>\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{::dt.uid}}" ng-class="::dt.customClass">\n        <button type="button" style="min-width:100%;" class="cisco-datepicker-day" ng-class="{\'cisco-btn-day-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="::{\'text-muted\': dt.secondary, \'text-info\': dt.current}">{{::dt.label}}</span></button>\n      </td>\n      <td></td>\n    </tr>\n  </tbody>\n</table>\n');a.put("uib/template/datepicker/popup.html",
'<ul class="dropdown-menu" dropdown-nested ng-if="isOpen" style="display: block; padding: 0px;"        ng-style="{top: position.top+\'px\', left: position.left+\'px\'}" ng-keydown="keydown($event)" ng-click="$event.stopPropagation()">\n\t<li ng-transclude></li>\n</ul>\n');a.put("uib/template/modal/window.html",'<div modal-render="{{$isRendered}}" tabindex="-1" role="dialog" class="modal"\n    uib-modal-animation-class="fade"\n    modal-in-class="in"\n    ng-style="{\'z-index\': 1050 + index*10, display: \'block\'}">\n    <div class="modal-dialog" ng-class="size ? \'modal-\' + size : \'\'"><div class="modal-content" uib-modal-transclude></div></div>\n</div>\n')}}}]);
app.factory("ciscoDesign",["customUIBootstrapTpls","customUIGrid","customNgGrid",function(a,b,t){return{refactory:function(){a.refactory();b.refactory();t.refactory()}}}]);app.directive("pgRow",[function(){return{restrict:"A",link:function(a,b,t){var m;m=a.$watch(function(){var m=b.height();a.row.offsetHeight=m});a.$on("$destroy",function(){m&&m()})}}}]);app.service("DHCP_PD",["MyHttp","wan_service","$filter","ipv6_lib","$rootScope",function(a,b,t,m,w){var u=function(a,b,n){return a.ipv6&&a.ipv6.setting&&a.ipv6.setting.prefix_name?!0:!1},p={physical:!0,subinterface:!0,ipv6transition:!0},q={get_pd_list:function(a,x){a||(a=[]);x||(x=[]);var n=[],l,r;a=b.filter(a,p);angular.forEach(a,function(a){l=a.ipv6&&a.ipv6.setting||{};r=a.name.match(/^TUN\d+/)?!0:!1;l["dhcp-pd-enable"]&&n.push({id:a.name,prefix_name:l["prefix-name"]||"",display_name:"",is_tun:r,
prefix:"",prefix_len:0,pd_prefix:""})});return n=q.update_pd_state(n,x)},update_pd_state:function(a,b){a||(a=[]);b||(b=[]);var n={},l,r=createIpAddr(),v;angular.forEach(b,function(a){n[a.name]=a});angular.forEach(a,function(a){a.is_tun?(l=a.prefix_name.toUpperCase(),l=l.replace("_","-")):l=a.prefix_name+"_PD";n[l]&&n[l].ipv6&&n[l].ipv6["dhcp-pd-prefix"]?(v=r.parseCIDR(n[l].ipv6["dhcp-pd-prefix"]),a.prefix_len=v[1],a.prefix=v[0].toNormalizedString(),a.pd_prefix=n[l].ipv6["dhcp-pd-prefix"],a.display_name=
a.prefix_name+"("+a.id+") - "+a.pd_prefix):(a.prefix_len=0,a.prefix="",a.pd_prefix="",a.display_name=a.prefix_name+"("+a.id+") - "+w.DICT("Unavailable"))});return a},get_pd_interfaces:function(a,q,n){a=b.filter(a,p);var l=t("filter")(a,u),r=createIpAddr(),v;q=t("filter")(q,function(a,b,d){var c=!1;return!a||!a.name?c:(b=a.name.match(/_PD$/))?(angular.forEach(l,function(b,d){var e=b.ipv6.setting.prefix_name;a.name==e+"_PD"&&(c=!0,a._WANname=b.name,a._WANPrefixName=e,a.ipv6&&a.ipv6.dhcp_pd_prefix&&
(e=a.ipv6.dhcp_pd_prefix.split("/"),v=r.parse(e[0]),a.ipv6.dhcp_pd_prefix_full=v.toNormalizedString().toLowerCase()+"/"+e[1]))}),c):(b=a.name.match(/^(WAN\d+)-(TUN\d+)/))?(c=!0,a._WANname=b[2],a._WANPrefixName=b[1].toLowerCase()+"_"+b[2].toLowerCase(),a.ipv6&&a.ipv6.dhcp_pd_prefix&&(b=a.ipv6.dhcp_pd_prefix.split("/"),v=r.parse(b[0]),a.ipv6.dhcp_pd_prefix_full=v.toNormalizedString().toLowerCase()+"/"+b[1]),c):!1});n&&(n=t("filter")(n,function(a,b,d){b=!1;a.name.match(/^TUN/)&&("ip6rd"==a.type&&!0===
a.enabled&&a.ipv6rd&&a.ipv6rd.ip6prefix&&"auto"==a.ipv6rd.config_mode)&&(b=!0);return b?(a.ipv6=a.ipv6||{},b=a.ipv6rd.ip6prefix.split("/"),v=r.parse(b[0]),a.ipv6.dhcp_pd_prefix=a.ipv6rd.ip6prefix,a.ipv6.dhcp_pd_prefix_full=v.toNormalizedString().toLowerCase()+"/"+b[1],a._WANname="Tunnel for IPv6 6RD",!0):!1}),q=q.concat(n));return q},get_pd_preview:function(a,b,n,l){var r=createIpAddr(),v,s,k;if((n=q.parse_user_identifier(n))&&_.isString(b)){a&&(v=r.IPv6.parseCIDR(a));v?(a=v[1],v=m.get_prefix(v[0],
a)):(a=0,v=r.IPv6.parse("0::0"));r=parseInt(b,16).toString(2);k=l-a;if(k>r.length)for(i=r.length;i<k;i++)r="0"+r;Log(DEBUG,"[DHCP_PD] get_pd_preview() pd-prefix-length: "+a+", pd-prefix-ip: "+v.toNormalizedString());Log(DEBUG,"[DHCP_PD] get_pd_preview() sub-prefix: "+b+", pd-prefix-ip: "+v.toNormalizedString()+", subPrefixBinary: "+r);b=Math.floor(a/16);k=Math.floor(l/16)+(l%16?1:0);Log(DEBUG,"[DHCP_PD] get_pd_preview() start: "+b+", end: "+k);for(i=k-1;i>=b;i--)k=s=0,base=16*i,tmp=a-base,0<tmp&&
(s=tmp),tmp=l-base,16<tmp?k=16:0<tmp&&(k=tmp),v.parts[i]&=(1<<s)-1<<16-s,0<k&&(s=k-s,tmp=r.substr(r.length-s,r.len),tmp=parseInt(tmp,2),r=r.substr(0,r.length-s),v.parts[i]|=tmp<<16-k);Log(DEBUG,"[DHCP_PD] get_pd_preview() response ip: "+v.toNormalizedString()+", identifierIpaddr: "+n.toNormalizedString());return m.combined_two_ip(v,n,l)}},parse_user_identifier:function(a){var b=void 0,n=createIpAddr();if(!a||!_.isString(a)||a.match("::")||39<a.length)return b;a=34>=a.length?"::"+a:a;return!n.IPv6.isValid(a)?
b:b=n.IPv6.parse(a)},gen_eui64_ip:function(a){var b=createIpAddr();a=a.replace(/:/g,"");a=a.substr(0,4)+":"+a.substr(4,2)+"FF:FE"+a.substr(6,2)+":"+a.substr(8,4);var n=parseInt(a.substr(0,2),16);a=(0===(n&2)?n|2:n&253).toString(16)+a.substr(2);return b.IPv6.parse("::"+a).toString().toLowerCase()}};this.get_pd_list=q.get_pd_list;this.get_pd_preview=q.get_pd_preview;this.get_pd_interfaces=q.get_pd_interfaces;this.parse_user_identifier=q.parse_user_identifier;this.gen_eui64_ip=q.gen_eui64_ip;this.update_pd_state=
q.update_pd_state}]);app.service("wan_lib",["MyHttp","$q","wan_service",function(a,b,t){var m=!1,w="upstream",u="percentage",p="auto",q=[],e={},x=[],n=[],l=[],r=[],v=[],s="",k=!1,d=this,c=function(c){b.defer();return a.post({url:resource_base+"data/pc_mac.json",method:"get_pc_mac",error:function(a){h();Log(ERROR,"WANSettingCtrl error: getPCMac"+a.status)}})},h=function(a){a||(a={});s=a.mac||"";k=a["interface-name"]&&a["interface-name"].match(/^VLAN\d+/)?!0:!1},g=function(b){return a.post({url:resource_base+"data/wan_setting1.json",
method:"get_interface",procBackground:b&&b.procBackground||void 0,error:function(a){y();Log(ERROR,"WANSettingCtrl error: "+a.status)}})},A=function(a){var b=function(a,b,c){a[b]&&(a[c]=a[b],delete a[b]);return a};a||(a={});var c,d=a.nat||{},g=a.ipv4||{},h=a.ipv6||{},e=g.address||[],k=h.address||[],l="WAN1";a.name&&a.name.match(/^WAN2/)&&(l="WAN2");var n={intf:l,isCreateSubInterface:!1,name:a.name||"",description:a.description||"",nat:{enable:void 0!==d.enable?d.enable:!0},vlan_interface_settings:{vlan_id:a["vlan-interface-settings"]&&
a["vlan-interface-settings"]["vlan-id"]||""},mac_address_clone:a["mac-address-clone"]||!1,mac_address:a["mac-address"]||"",mtuType:"auto",mtu:1500,ipv4:{connectType:"dynamic",enabled:void 0!==g.enabled?g.enabled:!0,address:{ip:e[0]&&e[0].ip||"",netmask:e[0]&&e[0].netmask||"",prefix_length:e[0]&&e[0]["prefix-length"]||""},physical:"dhcp",setting:{ifname:"WAN1",ifnames:r&&r[0]&&r[0].id||"",selectDemand:!1,demand:5,keepalive:30,username:"",password:"",orig_password:"",changed_password:!1,gateway:"",
server:"",authentication_type:"auto",service:"",wan_connection:"",mppe:!1,peerdns:!0,naming_server:{servers:["",""]}}},ipv6:{connectType:"slaac",enabled:void 0!==h.enabled?h.enabled:!1,address:{ip:k[0]&&k[0].ip||"",netmask:k[0]&&k[0].netmask||"",prefix_length:k[0]&&k[0]["prefix-length"]||""},setting:{selectDemand:!1,ifname:"WAN1",demand:5,server:"",keepalive:30,gateway:"",username:"",password:"",orig_password:"",changed_password:!1,authentication_type:"auto",dhcp_pd_enable:!1,prefix_name:"",peerdns:!0,
stp:!1,ifnames:r&&r[0]&&r[0].id||"",naming_server:{servers:["",""]},share_ipv4_pppoe_session:!1}}};a.ipv4&&a.ipv4.mtu&&(n.mtuType="manual",n.mtu=a.ipv4.mtu);a.ipv4&&a.ipv4.setting&&angular.forEach(a.ipv4.setting,function(a,d){void 0!==a.demand&&(a.selectDemand=!0);switch(d){case "static":case "dynamic":break;case "pptp":case "l2tp":n.ipv4.physical=a.origin;break;case "pppoe":break;case "trasparent-bridge":a.ifnames&&a.ifnames[0]&&(n.ipv4.setting.ifnames=a.ifnames[0].split(" ")[0],delete a.ifnames);
break;default:return}a=b(a,"authentication-type","authentication_type");a=b(a,"wan-connection","wan_connection");a["naming-server"]&&(a["naming-server"].servers&&a["naming-server"].servers[0]&&(c=a["naming-server"].servers[0].split(" "),a.naming_server={servers:["",""]},c&&c[0]&&(a.naming_server.servers[0]=c[0]),c&&c[1]&&(a.naming_server.servers[1]=c[1])),delete a["naming-server"]);n.ipv4.connectType=d;$.extend(n.ipv4.setting,a);if(n.ipv4.setting.orig_password=n.ipv4.setting.password)n.ipv4.setting.password=
"00000000";n.ipv4.setting.changed_password=!1});a.ipv6&&a.ipv6.setting&&angular.forEach(a.ipv6.setting,function(a,d){void 0!==a.demand&&(a.selectDemand=!0);switch(d){case "slaac":case "dynamic":case "static":break;case "pppoe":break;case "dhcp-pd-enable":n.ipv6.setting.dhcp_pd_enable=a;return;case "prefix-name":n.ipv6.setting.prefix_name=a;return;default:return}a=b(a,"authentication-type","authentication_type");a=b(a,"share-ipv4-pppoe-session","share_ipv4_pppoe_session");a["naming-server"]&&(a["naming-server"].servers&&
a["naming-server"].servers[0]&&(c=a["naming-server"].servers[0].split(" "),a.naming_server={servers:["",""]},c&&c[0]&&(a.naming_server.servers[0]=c[0]),c&&c[1]&&(a.naming_server.servers[1]=c[1])),delete a["naming-server"]);n.ipv6.connectType=d;$.extend(n.ipv6.setting,a);if(n.ipv6.setting.orig_password=n.ipv6.setting.password)n.ipv6.setting.password="00000000";n.ipv6.setting.changed_password=!1});n.ipv4&&(n.ipv4.address.netmask&&!n.ipv4.address.prefix_length)&&(n.ipv4.address.prefix_length=app.TOOLS.netmask.inet2Int(n.ipv4.address.netmask));
n.ipv4&&(n.ipv4.address.prefix_length&&!n.ipv4.address.netmask)&&(n.ipv4.address.netmask=app.TOOLS.netmask.int2Inet(parseInt(n.ipv4.address.prefix_length,10)));return n},y=function(a){var b=[],c,d=[],g,h,e;n=[];v=[];a&&(a.interfaces&&a.interfaces["interface"])&&(b=a.interfaces["interface"]);angular.forEach(b,function(a,b){c=a.name;"WAN1"===c&&a["igmp-proxy"]&&(void 0!==a["igmp-proxy"].enable&&(m=a["igmp-proxy"].enable),void 0!==a["igmp-proxy"].type&&(w=a["igmp-proxy"].type));if(g=c.match(/^WAN(\d+)(?:$|\.(\d+)$)/))h=
parseInt(g[1],10),e=parseInt(g[2],10)||0,h&&(d[h]||(d[h]=[]),d[h][e]=A(a))});a=d.length;for(h=0;h<a;h++)if(d[h]){b=d[h].length;for(e=0;e<b;e++)d[h][e]&&n.push(d[h][e])}angular.copy(n)},z=function(a){a||(a=[]);var b=[];a.interfaces&&a.interfaces["interface"]&&(b=a.interfaces["interface"]);r=[];angular.forEach(b,function(a){a.name.match(/^VLAN/)&&r.push({id:a.name,displayName:a.name})})},B=function(b){return a.post({url:resource_base+"data/wan_setting1.json",procBackground:b&&b.procBackground||void 0,
method:"get_dual_wan",error:function(a){D()}})},D=function(a){a||(a={});var b=[],c,g,h,k=[],l=[],n=[],z;a.interfaces&&a.interfaces["interface"]&&(b=d.filter_available_interfaces(a.interfaces["interface"]));u="percentage";q=[];e={};a=b.length+1;for(h=0;h<a;h++)e[h]=[];angular.forEach(b,function(a){c=a["redundant-wan"]||{};"WAN1"===a.name&&void 0!==c.bandwidth&&(u="bandwidth");c.enable&&(g=E(a,c),z=parseInt(g.precedence,10),n[z]||(n[z]={wans:[],usbs:[]}),a.name.match(/^WAN\d+/)&&(k.push(g),n[z].wans.push(a.name)),
a.name.match(/^USB\d+/)&&(l.push(g),n[z].usbs.push(a.name)))});angular.forEach(n,function(a,b){a&&(e[b]=n[b].wans.concat(n[b].usbs))});q=k.concat(l);x=angular.copy(q)},E=function(a,b){a||(a={});b||(b={});return{name:a.name||"",precedence:b.precedence||"",weight:b.weight||"",bandwidth:b.bandwidth||""}},C=function(a){var b,c,d;angular.forEach(a,function(a){for(b=q.length-1;0<=b;b--)if(q[b].name===a){c=e[q[b].precedence];for(d=c.length-1;0<=d;d--)c[d]===a&&c.splice(d,1);q.splice(b,1)}})},I=function(){var a=
[],b,c;if(x.length===q.length)return a;x.length<q.length&&angular.forEach(q,function(d){b=!0;angular.forEach(x,function(a){a.name===d.name&&(b=!1)});b&&(c={name:d.name,"redundant-wan":{enable:!0,precedence:d.precedence}},"percentage"===u?c["redundant-wan"].weight=100:c["redundant-wan"].bandwidth=100,a.push(c))});var d={},g=1,h,k={};x.length>q.length&&(angular.forEach(q,function(a){d[a.name]=a}),angular.forEach(v,function(a){k[a]=!0}),angular.forEach(x,function(b){d[b.name]||k[b.name]||a.push({name:b.name,
"redundant-wan":{enable:!1}})}),angular.forEach(e,function(b,e){if(h=b.length)angular.forEach(b,function(b,e){d[b].precedence=g;c={name:b};"percentage"===u?(d[b].weight=(100-100%h)/h,0===e&&(d[b].weight+=100%h),c["redundant-wan"]={precedence:g,weight:d[b].weight}):c["redundant-wan"]={precedence:g,bandwidth:d[b].bandwidth};a.push(c)}),g++}));return a},G=function(b){return a.post({url:resource_base+"data/igmp_proxy.json",procBackground:b&&b.procBackground||void 0,isPolling:b&&b.isPolling||void 0,method:"get_igmp",
error:function(a){Log(ERROR,"WANSettingEditCtrl getIGMPData error : "+a.status);H()}})},H=function(a){a||(a={});p=(a["igmp-proxy"]||{})["upstream-interface"]||"auto"},F=function(b){return a.post({url:resource_base+"data/wan_setting_state.json",params:{filter:"WAN"},procBackground:b&&b.background||void 0,isPolling:b&&b.isPolling||void 0,method:"get_interface_state",error:function(a){Log(ERROR,"WANSettingEditCtrl getWanStateData error : "+a.status);K()}})},K=function(a){a||(a={});a=(a["interfaces-state"]||
{})["interface"]||[];var b,c=RegExp(d.regexpStr.wanIntef),g={};l=[];angular.forEach(a,function(a){if(a.name){var b=a.name.match(c),d=a.name;b&&(d=b[1]+b[3]);g[d]||(g[d]={physical:{},logical:[]});b&&b[2]?g[d].logical.push(a):g[d].physical=a}});angular.forEach(g,function(a,c){var d=a.physical||{},g=d.ipv4||{},h=g.address||[],e=d.ipv6||{},k=e.address||[],n;angular.forEach(a.logical,function(a){if(a.ipv4||"l2tp"===a.type||"pptp"===a.type)g=a.ipv4||{};a.ipv6&&(e=a.ipv6||{})});h=g.address||[];k=e.address||
[];b={name:c,link_status:d["link-status"]||"",phys_address:d["phys-address"]||"",admin_status:d["admin-status"]||"down",oper_status:d["oper-status"]||"down",ipv4_ip:[],ipv6_ip:[]};angular.forEach(h,function(a){a.ip&&(n={ip:a.ip||"",prefix:void 0!==a["prefix-length"]?a["prefix-length"]:"",netmask:a.netmask||""},""===n.prefix&&""!==n.netmask&&(n.prefix=app.TOOLS.netmask.inet2Int(n.netmask)),b.ipv4_ip.push(n))});angular.forEach(k,function(a){a.ip&&"::"!==a.ip&&b.ipv6_ip.push({ip:a.ip||"",prefix:a["prefix-length"]||
"",netmask:a.netmask||""})});l.push(b)})},M=function(b,c){var d=I(),g=[];d.length&&g.push({method:"set_dual_wan",params:{interfaces:{"interface":d}}});g.push({method:"del_interface",params:b});a.post({method:"set_bulk",params:g,success:function(a){c.resolve(a)},error:function(a){c.resolve("falure")}})},N=function(a,b){var c=a&&a.intfs||[],d={};0!==c.length&&(d={interfaces:{"interface":[]}},angular.forEach(c,function(a,b){d.interfaces["interface"].push({name:a.name});v.push(a.name);C([a.name])}),M(d,
b))},J=function(a,b,c){var d=a.vlan_interface_settings,g=a.ipv4&&a.ipv4.setting||{},h=a.ipv6&&a.ipv6.setting||{},e="",k=a.ipv4.connectType,l=a.ipv6.connectType,n,z,r=e=a.mtu,B={},y="WAN1",s=!1,A=!1;z=w;n="WAN1"===b?m:"downstream"===z?!0:"auto"===p?m:!1;b.match(/^WAN2/)&&(y="WAN2");"pppoe"===k||"pppoe"===l?s=!0:c&&(c.ipv4&&"pppoe"===c.ipv4.connectType&&(A=!0),c.ipv6&&"pppoe"===c.ipv6.connectType&&(A=!0));b={name:b,nat:{enable:a.nat.enable},"igmp-proxy":{enable:n,type:z},type:"ethernetCsmacd",ipv4:{enabled:a.ipv4.enabled,
address:[],mtu:"",setting:{}},ipv6:{enabled:a.ipv6.enabled,address:[],mtu:"",setting:{}}};!0===a.isCreateSubInterface&&(B.target=[{host:"gateway"}]);s?B.enable=!1:A&&(B.enable=!0);if(!0===a.isCreateSubInterface||s||A)b["redundant-wan"]={"net-tracker":B};a.needToModifyMultiWan&&!a.isCreateSubInterface&&"trasparent-bridge"===a.ipv4.connectType&&$.extend(b["redundant-wan"],{enable:!1});_.isNumber(d.vlan_id)&&(b["vlan-interface-settings"]={"vlan-id":d.vlan_id,"base-interface":y},b.type="l2vlan");k&&(b.ipv4.setting[k]=
{ifname:g.ifname});l&&(b.ipv6.setting[l]={ifname:g.ifname});if((b["mac-address-clone"]=a.mac_address_clone)&&a.mac_address)b["mac-address"]=a.mac_address;"manual"===a.mtuType&&(b.ipv4.mtu=e);a.ipv4.address.ip&&a.ipv4.address.prefix_length&&(b.ipv4.address=[{ip:a.ipv4.address.ip,"prefix-length":a.ipv4.address.prefix_length}]);e=c="";g.naming_server.servers[0]&&g.naming_server.servers[0].length&&(e=g.naming_server.servers[0],c=" ");g.naming_server.servers[1]&&g.naming_server.servers[1].length&&(e=e+
c+g.naming_server.servers[1]);$.extend(b.ipv4.setting[k],{peerdns:g.peerdns});g.peerdns||$.extend(b.ipv4.setting[k],{"naming-server":{servers:[e]}});switch(k){case "static":delete b.ipv4.setting[k].peerdns;$.extend(b.ipv4.setting[k],{"naming-server":{servers:[e]}});b.ipv4.setting[k].gateway=g.gateway;break;case "dynamic":b.ipv4.address=[];break;case "pppoe":$.extend(b.ipv4.setting[k],{username:g.username,demand:g.selectDemand?g.demand:"",keepalive:!g.selectDemand?g.keepalive:"","authentication-type":g.authentication_type,
service:g.service});b.ipv4.address=[];break;case "pptp":$.extend(b.ipv4.setting[k],{username:g.username,gateway:"",demand:g.selectDemand?g.demand:"",origin:a.ipv4.physical,keepalive:!g.selectDemand?g.keepalive:"","authentication-type":g.authentication_type,server:g.server,mppe:g.mppe});"dhcp"===a.ipv4.physical?b.ipv4.address=[]:b.ipv4.setting[k].gateway=g.gateway;delete b.ipv4.setting[k].ifname;break;case "l2tp":$.extend(b.ipv4.setting[k],{username:g.username,demand:g.selectDemand?g.demand:"",origin:a.ipv4.physical,
keepalive:!g.selectDemand?g.keepalive:"","authentication-type":g.authentication_type,server:g.server});"dhcp"===a.ipv4.physical?b.ipv4.address=[]:b.ipv4.setting[k].gateway=g.gateway;delete b.ipv4.setting[k].ifname;break;case "trasparent-bridge":$.extend(b.ipv4.setting[k],{ifnames:[g.ifnames,a.intf+(d.vlan_id?"."+d.vlan_id:"")]}),b.ipv4.setting[k].gateway=g.gateway,delete b.ipv4.setting[k].peerdns,delete b.ipv4.setting[k].ifname,$.extend(b.ipv4.setting[k],{"naming-server":{servers:[e]}})}switch(k){case "pptp":case "l2tp":case "pppoe":b.ipv4.setting[k].password=
g.changed_password?g.password:g.orig_password}"manual"===a.mtuType&&(b.ipv6.mtu=""!==r&&1280>r?1280:r);$.extend(b.ipv6.setting,{"dhcp-pd-enable":h.dhcp_pd_enable,"prefix-name":h.prefix_name});e=c="";h.naming_server.servers[0]&&h.naming_server.servers[0].length&&(e=h.naming_server.servers[0],c=" ");h.naming_server.servers[1]&&h.naming_server.servers[1].length&&(e=e+c+h.naming_server.servers[1]);$.extend(b.ipv6.setting[l],{peerdns:h.peerdns});h.peerdns||$.extend(b.ipv6.setting[l],{"naming-server":{servers:[e]}});
switch(l){case "slaac":b.ipv6.setting[l].peerdns=!1;$.extend(b.ipv6.setting[l],{"naming-server":{servers:[e]}});break;case "static":delete b.ipv6.setting[l].peerdns;$.extend(b.ipv6.setting[l],{"naming-server":{servers:[e]}});a.ipv6.address.ip&&a.ipv6.address.prefix_length&&(b.ipv6.address=[{ip:a.ipv6.address.ip,"prefix-length":a.ipv6.address.prefix_length}]);b.ipv6.setting[l].gateway=h.gateway;break;case "pppoe":$.extend(b.ipv6.setting[l],{username:h.username,demand:h.selectDemand?h.demand:"",keepalive:!h.selectDemand?
h.keepalive:"","authentication-type":h.authentication_type,service:h.service,"share-ipv4-pppoe-session":h.share_ipv4_pppoe_session})}switch(l){case "pppoe":b.ipv6.setting[l].password=h.changed_password?h.password:h.orig_password}return b},R=function(b,c){var d=[],g,h,k,l=b&&b.edit||void 0,n=b&&b.orig||void 0;if(void 0===l)c.resolve("falure");else{g=l.vlan_interface_settings;g=l.intf+(g.vlan_id?"."+g.vlan_id:"");l.ipv4.address.netmask&&(l.ipv4.address.prefix_length=app.TOOLS.netmask.inet2Int(l.ipv4.address.netmask));
if(n&&(n.ipv4&&"trasparent-bridge"===n.ipv4.connectType)&&"trasparent-bridge"!==l.ipv4.connectType&&g.match(/^WAN\d+$/)){k=q.length+1;for(h=0;h<k;h++)if(e[h+1]||(e[h+1]=[]),!e[h+1].length){e[h+1].push(g);h=E({name:g},{precedence:h+1});q.push(h);break}}"trasparent-bridge"===l.ipv4.connectType&&(l.needToModifyMultiWan=!0,n&&(n.ipv4&&"trasparent-bridge"!==n.ipv4.connectType)&&C([g]));d.push(J(l,g,n));l=I();d={interfaces:{"interface":d}};l.length&&(d.Multi_WAN=l);a.post({method:"set_wan_interface",forcedUsingPost:!0,
params:d,procBackground:b&&b.background||void 0,success:function(a){c.resolve("success")},error:function(a){c.resolve("falure")}})}};this.delete_wan_interfaces=function(a){var c=b.defer();N(a,c);return c.promise};this.filter_available_interfaces=function(a){if(!a)return[];var b={},c=a.length,d=[],g,h,e=RegExp(this.regexpStr.bridgeIntf),k=RegExp(this.regexpStr.usbIntf);for(g=0;g<c;g++)h=a[g],(h=h.name.match(e))&&(b[h[1]+h[3]]=!0);e=RegExp(this.regexpStr.physicalIntf);for(g=0;g<c;g++)h=a[g],h.name.match(e)&&
!b[h.name]&&d.push(h),h.name.match(k)&&d.push(h);return d};this.regexpStr={logicalIntf:"^(WAN\\d+)-(PPTP|L2TP|PPPOE|BRIDGE)($|.\\d+$)",defaultIntf:"^(WAN\\d+)$",physicalIntf:"^(WAN\\d+)($|.\\d+$)",bridgeIntf:"^(WAN\\d+)-(BRIDGE)($|.\\d+$)",usbIntf:"^USB\\d+$",wanIntef:"^(WAN\\d+)(?:-(PPTP|BRIDGE|L2TP|PPPOE))?($|.\\d+$)"};this.init=function(a){var d=b.defer(),e=!1;promises=[];a&&(e=!0===a.full_configure);promises=e?[g(a),B(a),G(a),c()]:[g(a)];b.all(promises).then(function(a){e?(H(a[2].data&&a[2].data.result||
{}),z(a[0].data&&a[0].data.result||{}),y(a[0].data&&a[0].data.result||{}),D(a[1].data&&a[1].data.result||{}),h(a[3]&&a[3].data&&a[3].data.result||{}),d.resolve([n,r,{pc_mac:s,is_from_lan:k}])):(y(a[0].data&&a[0].data.result||{}),d.resolve([n]))});return d.promise};this.get_wan_state=function(a){var c=b.defer(),d=a&&a.cbk;b.all([F(a)]).then(function(a){K(a[0].data&&a[0].data.result||{});_.isFunction(d)&&d(l);c.resolve(l)});return c.promise};this.gen_wan_settings=function(a){return A(a)};this.set_wan_interface=
function(a){var c=b.defer();R(a,c);return c.promise}}]);
app.service("wan_service",["MyHttp",function(a){this.filter=function(a,t){if(!a||"array"!==$.type(a))return[];var m=!1,w=!1,u=!1,p=!1,q=!1,e=!1,x=!1,n=!1,l=[],r=[],v=[],s=[],k=[],d=[];t?(t.physical&&(m=!0),t.logical&&(w=!0),t.usb&&(p=!0),t.subinterface&&(u=!0),t.wan_port&&(q=!0),t.ipv6transition&&(e=!0),t.dmz&&(x=!0),t.gre&&(n=!0)):(x=e=q=u=p=w=m=!0,n);angular.forEach(a,function(a){a.name&&(m&&a.name.match(/^WAN\d+$/)?l.push(a):w&&a.name.match(/^WAN\d+(-PPTP($|\.\d+$)|-L2TP($|\.\d+$)|-PPPoE($|\.\d+$)|-PPPOE($|\.\d+$)|-BRIDGE($|\.\d+$))/)?l.push(a):
p&&a.name.match(/^USB\d+$/)?r.push(a):u&&a.name.match(/^WAN\d+\.\d+$/)?l.push(a):(q&&a.name.match(/^WAN_PORT\d+$/)&&d.push(a),e&&a.name.match(/^TUN\d+$/)&&v.push(a),x&&a.name.match(/^DMZ$/)&&s.push(a),n&&a.name.match(/^GRE\d+$/)&&k.push(a)))});return l.concat(r).concat(d).concat(v).concat(s).concat(k)};this.get_ifs_status=function(a){var t={};if(!a)return t;var m=function(a){var b={ipv4:[],ipv6:[]},n=a.ipv6&&a.ipv6.address||[];angular.forEach(a.ipv4&&a.ipv4.address||[],function(a){a.ip&&b.ipv4.push(a.ip)});
angular.forEach(n,function(a){a.ip&&b.ipv6.push(a.ip)});return b},w=[],u={},p={},q;a["interfaces-state"]&&a["interfaces-state"]["interface"]&&(w=a["interfaces-state"]["interface"]);angular.forEach(w,function(a){a.name&&(a.name.match(/^WAN\d+($|\.\d+$)/)&&(u[a.name]=m(a)),a.name.match(/^USB\d+$/)&&(u[a.name]=m(a)))});angular.forEach(w,function(a){a.name&&(q=a.name.match(/^(WAN\d+)-(PPTP|L2TP|PPPOE|BRIDGE)($|.\d+$)/))&&(p[q[1]+q[3]]=m(a))});angular.forEach(u,function(a,b){t[b]=p[b]?p[b]:a});return t};
this.order_ifs=function(a){a||(a=[]);var t=[],m=[],w=[],u=[],p=function(a,b,e){a=parseInt(a,10);isNaN(a)||(m[a]||(m[a]=[]),b=parseInt(b,10),isNaN(b)?(m[a][0]||(m[a][0]=[]),m[a][0].push(e)):(m[a][b]||(m[a][b]=[]),m[a][b].push(e)))};a.interfaces&&a.interfaces["interface"]&&(u=a.interfaces["interface"]);angular.forEach(u,function(a){(regRes=a.name.match(/^WAN(\d+)($|.\d+$)/))?p(regRes[1],regRes[2].replace(".",""),a):(regRes=a.name.match(/^WAN(\d+)-(?:PPTP|L2TP|PPPOE|BRIDGE)($|.\d+$)/))?p(regRes[1],regRes[2],
a):w.push(a)});var q,e=m.length;for(a=0;a<e;a++)if(m[a]){q=m[a].length;for(u=0;u<q;u++)m[a][u]&&(t=t.concat(m[a][u]))}return t=t.concat(w)}}]);app.service("modificationWarning",["$rootScope",function(a){var b=!1,t=[];this.modified=function(){b=!0};this.get=function(){return b};this.reset=function(){b=!1;angular.forEach(t,function(a){a&&a.$setPristine&&a.$setPristine()})};this.setForm=function(a){t.push(a)};this.resetForm=function(){t=[]};this.check=function(m){b?app.TOOLS.warningAlertBox({msg:a.DICT("Navigate_Msg"),title:a.DICT("Confirm"),btn_yes_str:a.DICT("Exit"),btn_no_str:a.DICT("Cancel"),cbk:function(a){_.isFunction(m)&&m(a)}}):m(!0)}}]);
app.service("goToPreviousPage",["modificationWarning",function(a){var b=!1,t=this;t.reset=function(){b=!1};t.invoke=function(){b=!0};t.isneed=function(){return b};t.goback=function(b){a.check(function(a){_.isFunction(b)&&b(a);a&&(t.reset(),history.back())})}}]);
app.service("addressPoolValidate",function(){var a=function(a){if(8!==a.length)console.log("error: ip6part.length = "+a.length);else{for(var t,m=[],w=0;7>=w;w++)t=a[w]||0,m.push(t.toString(16));return m.join(":")}};this.poolValidate=function(a,t,m,w,u,p,q){var e=!0,x=[],n=[],x=[],n=[],l=[],r=[],r=l=0,v=[],l=[],n=x="",n=!1;"ipv4"===m?v=angular.copy(w.ipv4):"ipv6"===m&&(l=angular.copy(w.ipv6));if(void 0===v||void 0===l)return!0;l=u.split(".");r=p.split(".");l=(parseInt(l[0],10)<<24|parseInt(l[1],10)<<
16|parseInt(l[2],10)<<8|parseInt(l[3],10))>>>0;r=(parseInt(r[0],10)<<24|parseInt(r[1],10)<<16|parseInt(r[2],10)<<8|parseInt(r[3],10))>>>0;for(m=0;m<v.length;m++){n=!1;if(q&&q.skipCond&&0<q.skipCond.length)for(w=0;w<q.skipCond.length;w++)v[m].type==q.skipCond[w].type&&v[m].name.match(q.skipCond[w].name)&&(n=!0);if(!n){if(v[m].type===a&&v[m].name!==t||v[m].type!==a&&v[m].name!==t){x=v[m]["range-start"]||"";n=v[m]["range-end"]||"";w=!1;t.match(/^VLAN/)&&(w=!0);if(w)if(w=void 0,v[m]["bridge-interfaces"]&&
0<v[m]["bridge-interfaces"].length&&(w=v[m]["bridge-interfaces"][0].split(" ")),w&&-1<w.indexOf(t))continue;else if(v[m].bridge)continue;if(!1===e)break;else""===x||""===n?e=!0:(x=x.split("."),n=n.split("."),x=(parseInt(x[0],10)<<24|parseInt(x[1],10)<<16|parseInt(x[2],10)<<8|parseInt(x[3],10))>>>0,n=(parseInt(n[0],10)<<24|parseInt(n[1],10)<<16|parseInt(n[2],10)<<8|parseInt(n[3],10))>>>0,l<=x&&r>=n?e=!1:l<=x&&r>=x?e=!1:l<=n&&r>=n?e=!1:l>=x&&r<=n&&(e=!1))}if(!1===e)break}}return e};this.compareIpRange=
function(a,t){var m=[],w=[],u=[],p=[],q,e=!0,m=a.split("."),w=t.split(".");for(q=0;4>q;q++)u[q]=parseInt(m[q],10),p[q]=parseInt(w[q],10);for(q=0;4>q;q++)if(p[q]>u[q]){e=!0;break}else if(p[q]<u[q]){e=!1;break}return e};this.poolMaskValidate=function(a,t,m,w,u,p){var q=!0,e=[],x=[],n=0,l=0,r=[],n=[],v=e=x=e="",x=[],l=[],s="",e="";if(void 0===u||void 0===p||""===u||""===p)return!0;e=u.split(".");v=p.split(".");for(u=0;4>u;u++)x[u]=e[u]&v[u];s=x[0]+"."+x[1]+"."+x[2]+"."+x[3];for(u=0;4>u;u++)l[u]=v[u]^
255|e[u];e=l[0]+"."+l[1]+"."+l[2]+"."+l[3];if(void 0===s||void 0===e||""===s||""===e)return!0;"ipv4"===m?r=angular.copy(w.ipv4):"ipv6"===m&&(n=angular.copy(w.ipv6));if(void 0===r||void 0===n)return!0;n=(parseInt(x[0],10)<<24|parseInt(x[1],10)<<16|parseInt(x[2],10)<<8|parseInt(x[3],10))>>>0;l=(parseInt(l[0],10)<<24|parseInt(l[1],10)<<16|parseInt(l[2],10)<<8|parseInt(l[3],10))>>>0;for(m=0;m<r.length;m++){if(r[m].type!==a&&r[m].name!==t)if(e=r[m]["range-start"]||"",x=r[m]["range-end"]||"",!1===q)break;
else""===e||""===x?q=!0:(e=e.split("."),x=x.split("."),range_startnum=(parseInt(e[0],10)<<24|parseInt(e[1],10)<<16|parseInt(e[2],10)<<8|parseInt(e[3],10))>>>0,range_endnum=(parseInt(x[0],10)<<24|parseInt(x[1],10)<<16|parseInt(x[2],10)<<8|parseInt(x[3],10))>>>0,n<=range_startnum&&l>=range_endnum?q=!1:n<=range_startnum&&l>=range_startnum?q=!1:n<=range_endnum&&l>=range_endnum?q=!1:n>=range_startnum&&l<=range_endnum&&(q=!1));if(!1===q)break}return q};this.poolValidateInRange=function(a,t,m,w,u,p){var q=
!0,e=[],x=[],n=[],l=[],q=[],r=[],v=[],q=[],x=e="";"ipv4"===m?v=angular.copy(w.ipv4):"ipv6"===m&&(q=angular.copy(w.ipv6));if(void 0===v||void 0===q)return!0;q=!0;for(m=0;2>m;m++){0===m?html_ip=u:1===m&&(html_ip=p);for(w=0;w<v.length;w++)if(v[w].type===a&&v[w].name===t)if(e=v[w]["range-start"]||"",x=v[w]["range-end"]||"",!1===q)break;else if(""===e||""===x)q=!0;else{for(var e=e.split("."),x=x.split("."),q=html_ip.split("."),s=0;4>s;s++)n[s]=parseInt(e[s],10),l[s]=parseInt(x[s],10),r[s]=parseInt(q[s],
10);if(r[0]>=n[0]&&r[0]<=l[0]&&r[1]>=n[1]&&r[1]<=l[1]&&r[2]>=n[2]&&r[2]<=l[2]&&r[3]>=n[3]&&r[3]<=l[3])q=!0;else{q=!1;break}}if(!1===q)break}return q};this.poolValidateV6=function(a,t,m,w,u,p,q){var e=!0,x="",n="",x=[],l=[],r="",v="",r=!1;"ipv4"===m?x=angular.copy(w.ipv4):"ipv6"===m&&(l=angular.copy(w.ipv6));if(void 0===x||void 0===l)return!0;x=app.TOOLS.ipv6.toFullV6Addr(u).toLowerCase();n=app.TOOLS.ipv6.toFullV6Addr(p).toLowerCase();for(m=0;m<l.length;m++){r=!1;if(q&&q.skipCond&&0<q.skipCond.length)for(w=
0;w<q.skipCond.length;w++)l[m].type==q.skipCond[w].type&&l[m].name.match(q.skipCond[w].name)&&(r=!0);if(!r){if(l[m].type===a&&l[m].name!==t||l[m].type!==a&&l[m].name!==t)if(r=l[m]["range-start"]||"",r=app.TOOLS.ipv6.toFullV6Addr(r).toLowerCase(),v=l[m]["range-end"]||"",v=app.TOOLS.ipv6.toFullV6Addr(v).toLowerCase(),!1===e)break;else""===r||""===v?e=!0:x<=r&&n>=v?e=!1:x<=r&&n>=r?e=!1:x<=v&&n>=v?e=!1:x>=r&&n<=v&&(e=!1);if(!1===e)break}}return e};this.poolValidateV6ByAddrAndPrefix=function(b,t,m,w,u,
p){m=!0;var q="",e="",x=[],n="",l="",x=angular.copy(w.ipv6);if(void 0===x)return!0;q=app.TOOLS.validation.ipv6_getNet(u,p);w=angular.copy(q);u=[0,0,0,0,0,0,0,0];p=128-p;for(e=7;0<p;)16<=p?(u[e]=65535,p-=16):(u[e]|=(1<<p)-1>>>0,p=0),e--;for(e=0;e<w.length;e++)w[e]|=u[e];q=a(q).toLowerCase();e=a(w).toLowerCase();for(p=0;p<x.length;p++){if(x[p].type===b&&x[p].name!==t||x[p].type!==b&&x[p].name!==t)if(n=x[p]["range-start"]||"",n=app.TOOLS.ipv6.toFullV6Addr(n).toLowerCase(),l=x[p]["range-end"]||"",l=app.TOOLS.ipv6.toFullV6Addr(l).toLowerCase(),
!1===m)break;else""===n||""===l?m=!0:q<=n&&e>=l?m=!1:q<=n&&e>=n?m=!1:q<=l&&e>=l?m=!1:q>=n&&e<=l&&(m=!1);if(!1===m)break}return m};this.bindBridgeModeInRangeWithMask=function(a,t,m,w,u,p,q,e){var x=!0,n=[],l=[],r=0,v=0,s=[],r=[],k=n=l=n="",l=[],v=[],d="",n="";if(void 0===q||void 0===e||""===q||""===e)return!0;n=q.split(".");k=e.split(".");for(q=0;4>q;q++)l[q]=n[q]&k[q];d=l[0]+"."+l[1]+"."+l[2]+"."+l[3];for(q=0;4>q;q++)v[q]=k[q]^255|n[q];n=v[0]+"."+v[1]+"."+v[2]+"."+v[3];if(void 0===d||void 0===n||
""===d||""===n)return!0;"ipv4"===u?s=angular.copy(p.ipv4):"ipv6"===u&&(r=angular.copy(p.ipv6));if(void 0===s||void 0===r)return!0;r=(parseInt(l[0],10)<<24|parseInt(l[1],10)<<16|parseInt(l[2],10)<<8|parseInt(l[3],10))>>>0;v=(parseInt(v[0],10)<<24|parseInt(v[1],10)<<16|parseInt(v[2],10)<<8|parseInt(v[3],10))>>>0;for(u=0;u<s.length;u++){if(s[u].type!==a&&s[u].name!==t&&s[u].name!==m&&void 0!==w&&""!==w&&s[u].name!==w)if(n=s[u]["range-start"]||"",l=s[u]["range-end"]||"",!1===x)break;else""===n||""===
l?x=!0:(n=n.split("."),l=l.split("."),range_startnum=(parseInt(n[0],10)<<24|parseInt(n[1],10)<<16|parseInt(n[2],10)<<8|parseInt(n[3],10))>>>0,range_endnum=(parseInt(l[0],10)<<24|parseInt(l[1],10)<<16|parseInt(l[2],10)<<8|parseInt(l[3],10))>>>0,r<=range_startnum&&v>=range_endnum?x=!1:r<=range_startnum&&v>=range_startnum?x=!1:r<=range_endnum&&v>=range_endnum?x=!1:r>=range_startnum&&v<=range_endnum&&(x=!1));if(!1===x)break}return x};this.compareIpRangeV6=function(a,t){var m=!0,w="",u="",w=app.TOOLS.ipv6.toFullV6ZPAddr(a).toLowerCase(),
u=app.TOOLS.ipv6.toFullV6ZPAddr(t).toLowerCase();w>u&&(m=!1);return m};this.poolValidateInRangeV6=function(a,t,m,w,u,p){m=!0;var q="",e="",x=[],n="",l="",x=angular.copy(w.ipv6);if(void 0===x)return!0;q=app.TOOLS.ipv6.toFullV6ZPAddr(u).toLowerCase();e=app.TOOLS.ipv6.toFullV6ZPAddr(p).toLowerCase();for(w=0;w<x.length;w++){if(x[w].type===a&&x[w].name===t)if(n=x[w]["range-start"]||"",n=app.TOOLS.ipv6.toFullV6ZPAddr(n).toLowerCase(),l=x[w]["range-end"]||"",l=app.TOOLS.ipv6.toFullV6ZPAddr(l).toLowerCase(),
!1===m)break;else""===n||""===l?m=!0:q<n&&e>l?m=!1:q<n&&e>n?m=!1:q<l&&e>l?m=!1:q<n&&e<n?m=!1:q>l&&e>l&&(m=!1);if(!1===m)break}return m}});app.service("DSService",["$q",function(a){this.genProxy=function(b){b||Log(ERROR,"genProxy: required: ref_arr, data_cache_path_fn, data_typical_path_fn");var t=b.ref_arr||[];if(t&&0<t.length){var m=a.defer();b=b.data_cache_path_fn(t);m.resolve(b);return m.promise}return b.data_typical_path_fn()}}]);
app.service("factory_to_default",["$cookies",function(a){this.reset=function(){a.remove("vpn_status")}}]);app.service("pgWindow",["$window",function(a){this.confirm=function(b){return a.confirm(b)};this.alert=function(b){return a.alert(b)}}]);
app.service("usb_lib",["MyHttp","$q",function(a,b){var t=function(a){a||(a={});var b={USB1:!1,USB2:!1},u=[];a.output&&a.output.usbs&&(u=a.output.usbs);angular.forEach(u,function(a){var q=a.name;q&&(void 0===b[q]&&(b[q]=!1),!0===a.attached&&"mass-storage"===a["usbs-type"]&&(b[q]=!0))});return b};this.usbs_avaiable=function(m){var w=b.defer(),u;b.all([a.post({method:"action",background:m&&void 0!==m.background?m.background:!1,params:{rpc:"usb-check-attached"}})]).then(function(a){u=t(a[0]&&a[0].data&&
a[0].data.result||{});w.resolve(u)});return w.promise}}]);
app.service("intf_service",["MyHttp","$q",function(a,b){var t={},m=function(){return a.post({url:resource_base+"data/firewall_access_rules.json",method:"get_access_rules",procBackground:!0,error:function(a){console.log("accessRulesCtrl getData error: "+JSON.stringify(a))}})},w=function(){return a.post({url:resource_base+"data/port_forwarding.json",method:"get_port_forwarding_rule",procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},u=function(){return a.post({url:resource_base+
"data/port_triggering.json",method:"get_port_triggering",procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},p="none",q=!1,e={},x;this.init=function(){t={};p="getting";var a=this;b.all([m(),w(),u()]).then(function(b){for(var r=((b&&b[0]&&b[0].data&&b[0].data.result||{})["firewall-acl-rules"]||{})["firewall-acl-rule-entry"]||[],v=r.length,v=v-1;0<=v;v--)r[v]["default"]&&r.splice(v,1);t.acls=angular.copy(r);r=b&&b[1]&&b[1].data&&b[1].data.result||
{};t.port_forward=angular.copy(r["port-forwarding-rules"]&&r["port-forwarding-rules"]["port-forwarding-entry"]||[]);b=b&&b[2]&&b[2].data&&b[2].data.result||{};t.port_trigger=angular.copy(b["port-triggering-rules"]&&b["port-triggering-rules"]["port-triggering-entry"]||[]);p="done";q&&(app.transition.Out(),q=!1,a.checkBeforeDel(e,x))})};this.checkBeforeDel=function(b,l){if(b&&b.length){switch(p){case "none":app.transition.In();this.init();q=!0;e=b;x=l;return;case "getting":app.transition.In();q=!0;
e=b;x=l;return}var r=!1,v=!1,s=!1,k=angular.copy(t.acls),d=t.port_trigger,c=t.port_forward,h=[],g=[],A=[],y=b.length,z,B=t.port_trigger.length,m=t.port_forward.length,E,u,w,G=function(a){"function"===typeof l&&l(a)},H=function(b){if(b){b={};var c={};r&&(b["firewall-acl-rules"]={"firewall-acl-rule-entry":h},c["firewall-acl-rules"]={"firewall-acl-rule-entry":k});v&&(b["port-triggering-rules"]={"port-triggering-entry":g});s&&(b["port-forwarding-rules"]={"port-forwarding-entry":A});a.post({method:"del_port_forwarding",
params:b,success:function(){G(!0);r&&a.post({method:"set_access_rules",procBackground:!0,params:c})},error:function(){G(!1)}})}else G(!1)};for(E=0;E<y;E++){w=b[E];z=k.length;for(u=z-1;0<=u;u--)k[u]["interface"]&&(k[u]["interface"]["source-interface"]===w||k[u]["interface"]["destination-interface"]===w)&&k.splice(u,1);for(z=m-1;0<=z;z--)c[z]["interface"]===w&&A.push({"external-service":c[z]["external-service"],"interface":c[z]["interface"]});for(z=B-1;0<=z;z--)d[z]["interface"]===w&&g.push({name:d[z].name})}if(k.length!==
t.acls.length){r=!0;z=k.length;for(u=0;u<z;u++)k[u]["rule-id"]=u+1;for(u=k.length+1;u<=t.acls.length;u++)h.push({"rule-id":u})}g.length&&(v=!0);A.length&&(s=!0);r||v||s?app.TOOLS.get_scope("appCtrl").openDelInftAlertPage({needToDelACL:r,needToDelPT:v,needToDelPF:s,cbk:H}):G(!0);p="none"}}}]);
app.service("device_os_type",["MyHttp","$q",function(a,b){var t=[],m={},w=function(b,q){return a.post({url:resource_base+"data/device_os_type.json",method:"get_deviceostype",procBackground:b&&b.procBackground||!1,error:function(a){console.log("get_deviceostype error status: "+a.status);u();q.resolve({device:t,os:m})}})},u=function(a){a||(a={});t=[];m={};var b=[],e,x,n,l;a["device-os-types"]&&a["device-os-types"]["device-os-type"]&&(b=a["device-os-types"]["device-os-type"]);angular.forEach(b,function(a){if(l=
a["device-type"])n=a["os-type"]&&a["os-type"][0]||"",e=n.split(" ")||[],x=[],angular.forEach(e,function(a){x.push({id:a,displayName:a})}),t.push({id:l,displayName:l}),m[l]=x})};this.get=function(a){var q=b.defer();b.all([w(a,q)]).then(function(a){u(a&&a[0]&&a[0].data&&a[0].data.result||{});q.resolve({device:t,os:m})});return q.promise};this.get_default_device_type=function(a,b){var e="";a||(a=[]);b||(b="ANY");angular.forEach(a,function(a){a.id===b&&(e=b)});e||(e=a[0]&&a[0].id||"");return e};this.get_default_os_type=
function(a,b,e){var x="";a||(a=[]);e||(e="ANY");angular.forEach(a,function(a){a.id===e&&(x=e)});x||(x=a[0]&&a[0].id||"");return x}}]);app.service("dt",["$rootScope",function(a){var b=this;a=a.DICT;var t=app.TOOLS.int2str2,m=[a("Time_Jan"),a("Time_Feb"),a("Time_Mar"),a("Time_Apr"),a("Time_May"),a("Time_Jun"),a("Time_Jul"),a("Time_Aug"),a("Time_Sep"),a("Time_Oct"),a("Time_Nov"),a("Time_Dec")],w=[a("Time_January"),a("Time_February"),a("Time_March"),a("Time_April"),a("Time_May"),a("Time_June"),a("Time_July"),a("Time_August"),a("Time_September"),a("Time_October"),a("Time_November"),a("Time_December")],u=[],p=[a("Time_Sunday"),a("Time_Monday"),
a("Time_Tuesday"),a("Time_Wednesday"),a("Time_Thursday"),a("Time_Friday"),a("Time_Saturday")],q=[a("Time_Sun"),a("Time_Mon"),a("Time_Tue"),a("Time_Wed"),a("Time_Thu"),a("Time_Fri"),a("Time_Sat")],e=[],x=void 0;b.setTimezoneName=function(a,b){x=void 0;a&&angular.forEach(Timezone,function(e){e.tz===a&&(x=angular.copy(e),x.isdst=b)})};b.parser=function(a){var b=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/,e={err_code:1,orig_str:a,year:0,month:0,day:0,day_week:0,hour:0,minute:0,second:0,tz:0};if(!a)return e;
var v=a.match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\.\d+)?(Z|[\+\-]\d{2}:\d{2})/);v||(v=a.match(b));if(!v)return e;b=new Date(v[1]+"/"+v[2]+"/"+v[3]);e={err_code:0,date:void 0,orig_str:a,year:parseInt(v[1],10),month:parseInt(v[2],10)-1,day:parseInt(v[3],10),day_week:b.getDay(),hour:parseInt(v[4],10),minute:parseInt(v[5],10),second:parseInt(v[6],10),tz:parseInt(v[8],10)};v=a.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})([\+\-]\d{2}:\d{2})$/);e.date=v?new Date(v[1].replace(/-/g,"/").replace("T",
" ")):new Date;return e};b.new_date=function(a){var b;_.isString(a)&&(a=Date.parse(a),isNaN(a)&&(a=void 0));_.isNumber(a)&&(b=new Date(a));void 0===b&&(b=new Date);return{err_code:0,date:b,orig_str:"",year:b.getYear()+1900,month:b.getMonth(),day:b.getDate(),day_week:b.getDay(),hour:b.getHours(),minute:b.getMinutes(),second:b.getSeconds(),tz:""}};b.get_time=function(a){return a.date.getTime()+0};b.generate=function(a){var b=function(a){return 10>a?"0"+a:a.toString()};if(!a)return"";var e="";return"number"!==
$.type(a.year)||"number"!==$.type(a.month)||"number"!==$.type(a.day)||"number"!==$.type(a.hour)||"number"!==$.type(a.minute)||"number"!==$.type(a.second)||"string"!==$.type(a.tz)?"":e=a.year+"-"+b(a.month+1)+"-"+b(a.day)+"T"+b(a.hour)+":"+b(a.minute)+":"+b(a.second)+a.tz};b.mon2Str=function(a,b){return"number"!==$.type(a)||12<a||1>a?"":b?w[a-1]:m[a-1]};b.dw2Str=function(a,b){return"number"!==$.type(a)||6<a||0>a?"":b?p[a]:q[a]};b.genTimeStrByTimeStamp=function(a,e,r){a=b.parser(a);e||(e="");return 1===
a.err_code?e:(r=b.timeStr(a,r))?r:e};b.timeStr=function(a,b){b||(b="YYYY-mMM-DD, hh:mm:ss ZZZ");var e=function(a,b){a||(a="");var c=a.length,d=0,h;for(h=0;h<c;h++)if(a[h]===b)d+=1;else break;return d},v="",s=b.length,k="",d,c,h;for(c=0;c<s&&!k;c++)switch(b[c]){case "Y":d=e(b.substr(c,s),"Y");2===d||4===d?v+=a.year.toString().substr(4-d,4):k="Year is not corrent ["+d+"]";c=c+d-1;break;case "M":d=e(b.substr(c,s),"M");2===d?v+=t(a.month+1):k="Month is not corrent ["+d+"]";c=c+d-1;break;case "D":d=e(b.substr(c,
s),"D");2===d?v+=t(a.day):k="Day is not corrent ["+d+"]";c=c+d-1;break;case "h":d=e(b.substr(c,s),"h");2===d?v+=t(a.hour):k="Hour is not corrent ["+d+"]";c=c+d-1;break;case "m":d=e(b.substr(c,s),"m");2===d?v+=t(a.minute):(d=e(b.substr(c+1,s),"M")+1,3===d?v+=m[a.month]:k="Miniute is not corrent ["+d+"]");c=c+d-1;break;case "s":d=e(b.substr(c,s),"s");2===d?v+=t(a.second):k="Second is not corrent ["+d+"]";c=c+d-1;break;case "Z":d=e(b.substr(c,s),"Z");3===d?x&&(h=x.abbr,h||(h="UTC"+(0>x.offset?"-":"+"),
h=h+t(Math.abs((x.offset-x.offset%60)/60))+":"+t(Math.abs(x.offset%60))),v+=h):k="Second is not corrent ["+d+"]";c=c+d-1;break;case "-":case "/":case ":":case ",":case " ":v+=b[c];break;default:k="No Defined"}return k?(Log(ERROR,"[TOOLS][dt.timeStr] "+k),""):v};u=[];angular.forEach(w,function(a,b){u.push({id:b,displayName:a})});b.monthStr=angular.copy(w);b.monthabStr=angular.copy(m);b.month=angular.copy(u);u=[];angular.forEach(m,function(a,b){u.push({id:b,displayName:a})});b.monthab=angular.copy(u);
e=[];angular.forEach(p,function(a,b){e.push({id:b,displayName:a})});b.dayWeekStr=angular.copy(p);b.dayWeekabStr=angular.copy(q);b.dayWeek=angular.copy(e);e=[];angular.forEach(q,function(a,b){e.push({id:b,displayName:a})});b.dayWeekab=angular.copy(e)}]);app.directive("ploption",function(){return{restrict:"A",replace:!0,transclude:!0,scope:{title:"@",tipinfo:"@",unit:"@",texthint:"@",forname:"@",data:"=ngModel",data2:"="},templateUrl:"pl-option.htm",link:function(a,b,t){}}});
app.directive("tree",function(a){return{restrict:"EA",transclude:!0,scope:{family:"="},template:'<ul><li ng-transclude></li><p>{{ family.name }}</p><li ng-repeat="child in family.children"><tree family="child"></tree></li></ul>',compile:function(b,t,m){var w=b.contents().remove(),u;return function(b,q,e){u||(u=a(w,m));u(b,function(a,b){q.append(a)})}}}});
app.directive("float",function(){return{require:"ngModel",link:function(a,b,t,m){a=function(a){if(/^\-?\d+(\.\d+)?$/.test(a))return m.$setValidity("float",!0),parseFloat(a);m.$setValidity("float",!1)};m.$parsers.unshift(a);m.$formatters.unshift(a)}}});app.filter("getById",function(){return function(a,b,t){for(var m=0,w=a.length;m<w;m++)if(+a[m][b]==+t)return m;return null}});
app.directive("contains",function(){return{require:"ngModel",scope:{contains:"=",itemOwner:"=?",containsOpt:"=?"},link:function(a,b,t,m){b=function(b){a.containsOpt||(a.containsOpt={});if(void 0===a.containsOpt.errorIfContains||null===a.containsOpt.errorIfContains)a.containsOpt.errorIfContains=!0;var u;a:{u=a.contains.array;var p=a.contains.name,q=!1,e;"function"==typeof p&&(q=!0,e=p);for(var x=0,n=u.length;x<n;x++)if(q&&e(u[x],b)){u=x;break a}else if(u[x][p]==b){u=x;break a}u=null}p=!1;"object"==
typeof a.itemOwner?(q=a.contains.array.indexOf(a.itemOwner),-1<q&&q==u&&(p=!0)):a.itemOwner==u&&(p=!0);if(null===u||p)if(a.containsOpt.errorIfContains)m.$setValidity("contains",!0);else{m.$setValidity("not_contains",!1);return}else{if(a.containsOpt.errorIfContains){m.$setValidity("contains",!1);return}m.$setValidity("not_contains",!0)}return b};m.$parsers.push(b);m.$formatters.push(b)}}});
app.directive("input",function(){return{require:"?ngModel",link:function(a,b,t,m){function w(){var a=/^((?:http)s?:\/\/)(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+)$/i;m.$parsers.unshift(function(b){if(""===b||void 0==b)return"";if(a.test(b))return b});m.$validators.url=function(b){return m.$isEmpty(b)||a.test(b)}}m&&"url"===t.type&&w()}}});
app.directive("indeterminateCheckbox",[function(){return{scope:!0,require:"?ngModel",link:function(a,b,t,m){var w=t.childList,u=t.property,p=function(a,b){angular.forEach(a,function(a){a[u]=b;a.child&&a[a.child]&&p(a[a.child],b)})};b.bind("change",function(){a.$apply(function(){var q=b.prop("checked");angular.forEach(a.$eval(w),function(a){a[u]=q;a.child&&a[a.child]&&p(a[a.child],q)})})});a.$watch(w,function(a){var e=!1,p=!1,n=function(a){angular.forEach(a,function(a){a[u]&&(e=!0);a.child&&a[a.child]&&
n(a[a.child])})};angular.forEach(a,function(a){a[u]?e=!0:(p=!0,a.child&&a[a.child]&&n(a[a.child]))});e&&p?(b.prop("checked",!1),b.prop("indeterminate",!0),m&&m.$setViewValue(!1)):(b.prop("checked",e),b.prop("indeterminate",!1),m&&m.$setViewValue(e))},!0)}}}]);app.directive("selectWhenFocus",[function(){return{require:"?ngModel",link:function(a,b,t,m){b&&(b[0]&&b[0].addEventListener)&&b[0].addEventListener("focus",function(){b.select()})}}}]);
app.directive("passwordStrengthMeter",["passwordComplex",function(a){var b=function(a,b,w){a*=w;return(a-a%b)/b+"%"};return{restrict:"E",replace:!0,scope:{pwd:"=ngModel",name:"=username",strengthConfig:"="},link:function(t,m,w,u){var p={pwd:t.pwd,strengthConfig:t.strengthConfig||{}};m=!1;var q=3,e=function(){t.strength=a.getStrength(p);t.strength<q?(t.layer[1].width="0%",t.layer[1].enable=!1,t.layer[2].width="0%",t.layer[2].enable=!1,t.layer[3].width="",t.layer[3].bg=""):t.strength>=q&&9>t.strength?
(t.layer[1].width=b(t.strength-q+1,9-q+1,33),t.layer[1].enable=!0,t.layer[2].width="0%",t.layer[2].enable=!1,t.layer[3].width="",t.layer[3].bg=""):9<=t.strength&&17>t.strength?(t.layer[1].width="33%",t.layer[1].enable=!0,t.layer[2].width=b(t.strength-9+1,9,34),t.layer[2].enable=!0,t.layer[3].width="",t.layer[3].bg=""):(t.layer[1].enable=!0,t.layer[1].width="33%",t.layer[2].width="34%",t.layer[2].enable=!0,t.layer[3].width="0%",t.layer[3].bg="rgb(34, 139, 34)")};void 0!==t.name&&(p.name=t.name,q=4,
m=!0);t.layer=[{bg:"red",width:"34%",enable:!0},{bg:"rgb(255, 215, 0)",width:"0%",enable:!1},{bg:"rgb(34, 139, 34)",width:"0%",enable:!1},{bg:"",width:"0%",enable:!0}];e();t.$watch("pwd",function(a){p.pwd=a;e()});m&&t.$watch("name",function(a){p.name=a;e()})},templateUrl:"pwd_strength.html"}}]);app.directive("messageBox",[function(){return{restrict:"E",templateUrl:"messageBox.html",transclude:!0}}]);
app.directive("pgBindHtml",["$compile",function(a){return function(b,t,m){b.$watch(function(a){return a.$eval(m.pgBindHtml)},function(m){t.html(m);a(t.contents())(b)})}}]);app.directive("pgtitle",[function(){return{restrict:"A",link:function(a,b,t){t.ngBind&&a.$watch(t.ngBind,function(a){b.context.title=a});t.ngModel&&a.$watch(t.ngModel,function(a){b.context.title=a})}}}]);
app.directive("pgUpload",["$rootScope",function(a){return{restrict:"E",templateUrl:"pg_upload.html",scope:{ngchange:"=",ngRequired:"=",ngDisabled:"=",isInvalid:"=",pId:"@?"},compile:function(b,t,m){return{pre:function(b,m,p,q){b.DICT=a.DICT;b.file="";b.file_name=b.DICT("No_File_Is_Selected");b.change=function(a){b.file_name=b.DICT("No_File_Is_Selected");a&&a.name?b.file_name=a.name:a=void 0;b.file=a;_.isFunction(b.ngchange)&&b.ngchange(a)};b.id=b.pId?"_"+pId:"_file_upload"+Math.floor(1E4*Math.random())}}}}}]);
app.directive("gridCntr",["$compile",function(a){return{restrict:"C",scope:{isOpened:"="},link:function(b,t,m){var w=!1,u,p=function(){b.op.isopen?t.removeClass("hidden-content"):t.addClass("hidden-content")};b.op={isopen:!0};b.toggle=function(){b.op.isopen=!b.op.isopen;w&&(b.isOpened=b.op.isopen);p()};_.isBoolean(b.isOpened)&&(b.op.isopen=b.isOpened,w=!0);t.addClass("grid-cntr-s");(m=t[0].querySelector(".grid-title-cntr"))||(m=t[0].querySelector(".grid-tb-title-cntr"));m?(m=angular.element(m),m.append(a('<div class="grid-btn-collapse" ng-class="{\'is-open\': op.isopen}" ng-click="toggle()"></div>')(b)),
p(),w&&(u=b.$watch(function(){return b.isOpened},function(a){b.isOpened!==b.op.isopen&&b.toggle()})),b.$on("$destroy",function(){w&&u()})):Log(ERROR,"[gridCntr] got error, no 'grid-title-cntr' or 'grid-tb-title-cntr' class")}}}]);app.service("subnet_lib",["ipv4_lib","ipv6_lib",function(a,b){createIpAddr();var t=function(b){if(!_.isArray(b))return b;var m,p,q=b.length,e={},x;angular.forEach(b,function(a){a.is_overlap=!1;a["bridge-interfaces"]&&angular.forEach(a["bridge-interfaces"],function(a){a.match(/^VLAN\d+/)&&(e[a]=!0)})});for(m=0;m<q;m++)if(x=!1,!e[b[m].name]){b[m].name.match(/^WAN/)&&(x=!0);for(p=m+1;p<q;p++)if(!e[b[p].name]&&(!b[p].name.match(/^WAN/)||!x)&&a.vld.is_overlap_between_ranges({start:b[m]["range-start"],
end:b[m]["range-end"]},{start:b[p]["range-start"],end:b[p]["range-end"]}))b[m].is_overlap=!0,b[p].is_overlap=!0}return b},m=function(a){if(!_.isArray(a))return a;var m,p,q=a.length,e;angular.forEach(a,function(a){a.is_overlap=!1});for(m=0;m<q;m++){e=!1;a[m].name.match(/^WAN/)&&(e=!0);for(p=m+1;p<q;p++)if((!a[p].name.match(/^WAN/)||!e)&&b.vld.is_overlap_between_ranges({start:a[m]["range-start"],end:a[m]["range-end"]},{start:a[p]["range-start"],end:a[p]["range-end"]}))a[m].is_overlap=!0,a[p].is_overlap=
!0}return a};this.check_ipv4_ranges=t;this.check_ipv6_ranges=m;this.check_ranges=function(a){if(!_.isObject(a))return a;a.ipv4&&t(a.ipv4);a.ipv6&&m(a.ipv6);return a};this.check_ipv4_range_is_overlap_with_entity=function(b,m){var p=!1,q,e={},x={is_overlap:void 0,overlap_subnet:[]};if(!b||!b.start||!b.end||!m)return x;b.name&&(q=b.name,q.match(/^WAN\d+/)&&(p=!0));angular.forEach(m,function(a){q&&a.name===q||a["bridge-interfaces"]&&angular.forEach(a["bridge-interfaces"],function(a){a.match(/^VLAN\d+/)&&
(e[a]=!0)})});x.is_overlap=!1;angular.forEach(m,function(n){if(!(q&&sub.name===q)&&(!p||!n.name.match(/^WAN\d+/))&&!e[n.name]&&a.vld.is_overlap_between_ranges({start:n["range-start"],end:n["range-end"]},b))x.is_overlap=!0,x.overlap_subnet.push({name:n.name||"",type:n.type||"",start:n["range-start"]||"",end:n["range-end"]||"",ip:n.ip||""})});return x};this.check_ipv6_range_is_overlap_with_entity=function(a,m){var p={is_overlap:void 0,overlap_subnet:[]},q=!1,e;if(!a||!a.start||!a.end||!m)return p;a.name&&
(e=a.name);a.name&&a.name.match(/^WAN\d+/)&&(q=!0);p.is_overlap=!1;angular.forEach(m,function(m){if(!(e&&m.name===e)&&(!q||!m.name.match(/^WAN\d+/))&&b.vld.is_overlap_between_ranges({start:m["range-start"],end:m["range-end"]},a))p.is_overlap=!0,p.overlap_subnet.push({name:m.name||"",type:m.type||"",start:m["range-start"]||"",end:m["range-end"]||"",ip:m.ip||""})});return p}}]);app.service("rpcFns",["MyHttp","$q",function(a,b){var t=function(a,b){if(a.data.result&&a.data.result){var p={};a.data.result.output&&(p=a.data.result.output);return b?p[b]:p}console.log("Error: CSC_get_rpc_output, data.result not exist")},m=function(b,m,p){var q={};b.input&&(q.input=b.input);q.rpc=b.rpcname||"";p=p||{};return a.post({url:b.url||"",method:"action",params:q,procBackground:p.procBackground||!1,forcedUsingPost:p.forcedUsingPost,popRPCResonsepAlert:p.popRPCResonsepAlert,success:function(a){m&&
m.success&&m.success(a)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);m&&m.error&&m.error(a)}})};this.RPC_usblist=function(a,m){var p=b.defer();this.RPC_generic_send("file-list",{source:{"location-url":"FILE://"+a+"/"+(m||"")}},function(a,b,m){p.resolve(m)},function(a,b,p){});return p.promise};this.RPC_generic=function(a,b,p,q){console.warn("RPC_generic is now deprecated. Use RPC_generic_send instead.");b=m({url:resource_base+"data/rpc_result.json",rpcname:a,
input:b},void 0,q);b.then(function(b){var q=t(b);b=q.code;q=q.errstr;b=parseInt(b,10);p&&p(b,a,q)});return b};this.RPC_custom_output=function(a,b,p,q){console.warn("RPC_custom_output is now deprecated. Use RPC_generic_send instead.");b=m({url:resource_base+"data/rpc_custom_result.json",rpcname:a,input:b},void 0,q);b.then(function(b){p(b,a)});return b};this.RPC_generic_send=function(a,b,p,q,e){return this.csc_RPC_generic_send(a,b,p,q,e)};this.csc_RPC_generic_send=function(a,b,p,q,e){b=m({url:resource_base+
"data/rpc_custom_result.json",rpcname:a,input:b},void 0,e);b.then(function(b){var e=t(b,void 0);p(b,a,e)}).catch(function(b){q&&q(b,a)});return b};this.getRPCResult=t}]);app.service("ipv4_lib",[function(){var a=createIpAddr(),b=app.TOOLS.int2BinaryMask,t=function(b){var q=!1;return!b||!a.IPv4.isValid(b)?q:q=a.IPv4.parse(b)},m=function(a,q){var e=b(q,32,"H"),m=angular.copy(a),n,l;for(n=0;4>n;n++)l=e.substr(8*n,8),m.octets[n]&=parseInt(l,2);return m},w=function(b){var q=!1;b=angular.copy(b);if(!b)return q;b=angular.copy(b);b=b.split("/");if(!b||!a.IPv4.isValid(b[0]))return q;b[0]=a.IPv4.parse(b[0]);b[1]=parseInt(b[1],10);return!_.isNumber(b[1])||0>b[1]||32<b[1]?q:b},
u=function(a){var b=-1;if(!a||!a.octets)return b;b=0;angular.forEach(a.octets,function(a,p){b+=a<<8*(3-p)>>>0});return b};this.vld={is_overlap_between_subnets:function(a,b){var e=w(a),m=w(b),n=!1,l,r,v;if(e&&m)return r=e[0],v=m[0],n=e[1],l=m[1],n=n>l?r.match(m):n<l?v.match(e):r.match(m)},is_overlap_between_ranges:function(a,b){if(a&&b){var e=t(a.start),m=t(a.end),n=t(b.start),l=t(b.end),r=!1;if(e&&(n&&m&&l)&&(e=u(e),m=u(m),n=u(n),l=u(l),!(e>m||n>l)))return e<=n&&n<=m&&(r=!0),e<=l&&l<=m&&(r=!0),n<=
e&&e<=l&&(r=!0),n<=m&&m<=l&&(r=!0),r}},range_is_valid:function(a,b){var e=t(a),m=t(b);if(e&&m)return e=u(e),m=u(m),e>m?!1:!0}};this.parse=t;this.CIDR=w;this.to_int=u;this.get_prefix=m;this.get_prefix_by_str=function(b,q){var e=!1;if(!b||(!_.isNumber(q)||0>q||32<q)||!a.IPv4.isValid(b))return e;b=a.IPv4.parse(b);return e=m(b,q)};this.get_last_ip=function(a,b){var e=t(a),x,n,l;if(e&&_.isNumber(b)&&!(0>b||32<b)){e=m(e,b);x=app.TOOLS.int2BinaryMask(32-b,32);for(n=0;4>n;n++)l=x.substr(8*n,8),e.octets[n]|=
parseInt(l,2);return e}};this.get_first_ip=function(a,b){var e=t(a);if(e&&_.isNumber(b)&&!(0>b||32<b)){if(32===b)return e;e=m(e,b);e.octets[3]|=1;return e}}}]);app.config([function(){var a=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([1-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),h=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,e=/(^[\x00-\xff]*$)/,k;c.extansionOrReg&&(k=RegExp(c.extansionOrReg));c.ngIpv4IpNonzero?a.$watch(c.ngIpv4IpNonzero,function(a,b){c.ipv4IpNonzero=a;d.$validate()}):c.ipv4IpNonzero=!0;c.ipv4IpNonzero=c.ngIpv4IpNonzero?
a.$eval(c.ngIpv4IpNonzero):!0;d.$validators.ipv4IpNonzero=function(a,b){return!c.ipv4IpNonzero||d.$isEmpty(b)?!0:b.match(g)&&!b.match(h)&&b.match(e)||k&&b.match(k)?!0:!1};c.$observe("ipv4IpNonzero",function(){d.$validate()})}}}},b=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),h=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,e=/(^[\x00-\xff]*$)/,
k;c.extansionOrReg&&(k=RegExp(c.extansionOrReg));c.ngIpv4Ip?(a.$watch(c.ngIpv4Ip,function(a,b){c.ipv4Ip=a;d.$validate()}),c.ipv4Ip=a.$eval(c.ngIpv4Ip)):c.ipv4Ip=!0;d.$validators.ipv4Ip=function(a,b){if(!c.ipv4Ip||d.$isEmpty(b)||b.match(g)&&!b.match(h)&&b.match(e)||k&&b.match(k))return delete d.$error.ipv4Ip,!0;d.$error.ipv4Ip=!0;return!1};c.$observe("ipv4Ip",function(){d.$validate()})}}}},t=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$"),
h=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,e=/(^[\x00-\xff]*$)/,k;c.extansionOrReg&&(k=RegExp(c.extansionOrReg));c.ngIpv4Ip?(a.$watch(c.ngIpv4Ip,function(a,b){c.ipv4Ip=a;d.$validate()}),c.ipv4Ip=a.$eval(c.ngIpv4Ip)):c.ipv4Ip=!0;d.$validators.ipv4Ip=function(a,b){if(!c.ipv4Ip||d.$isEmpty(b)||b.match(g)&&!b.match(h)&&b.match(e)||k&&b.match(k))return delete d.$error.ipv4Ip,!0;d.$error.ipv4Ip=!0;return!1};c.$observe("ipv4Ip",function(){d.$validate()})}}}},m=function(){return{restrict:"A",require:"?ngModel",
link:function(a,b,c,d){if(d){var g=RegExp("^(((128|192|224|240|248|252|254).0.0.0)|(255.(0|128|192|224|240|248|252|254).0.0)|(255.255.(0|128|192|224|240|248|252|254).0)|(255.255.255.(0|128|192|224|240|248|252|254))|(255.255.255.255))$"),h=/(^[\x00-\xff]*$)/,e;c.extansionOrReg&&(e=RegExp(c.extansionOrReg));c.ngIpv4Netmask?a.$watch(c.ngIpv4Netmask,function(a,b){c.ipv4Netmask=a;d.$validate()}):c.ipv4Netmask=!0;c.ipv4Netmask=c.ngIpv4Netmask?a.$eval(c.ngIpv4Netmask):!0;d.$validators.ipv4Netmask=function(a,
b){return!c.ipv4Netmask||d.$isEmpty(b)?!0:app.TOOLS.netmask.inet2Int(b)&&b.match(g)&&b.match(h)||e&&b.match(e)?!0:!1};c.$observe("ipv4Netmask",function(){d.$validate()})}}}},w=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^(((128|192|224|240|248|252|254).0.0.0)|(255.(0|128|192|224|240|248|252|254).0.0)|(255.255.(0|128|192|224|240|248|252|254).0)|(255.255.255.(0|128|192|224|240|248|252|254))|(255.255.255.255))$"),h=/(^[\x00-\xff]*$)/;c.ngIpv4NetmaskAll?
a.$watch(c.ngIpv4NetmaskAll,function(a,b){c.ipv4NetmaskAll=a;d.$validate()}):c.ipv4NetmaskAll=!0;c.ipv4NetmaskAll=c.ngIpv4NetmaskAll?a.$eval(c.ngIpv4NetmaskAll):!0;d.$validators.ipv4NetmaskAll=function(a,b){return!c.ipv4NetmaskAll||d.$isEmpty(b)?!0:app.TOOLS.netmask.inet2Int(b)&&b.match(g)&&b.match(h)?!0:!1};c.$observe("ipv4NetmaskAll",function(){d.$validate()})}}}},u=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=app.TOOLS.validation.ipv4_prefix;b=c.extansionOrReg;
var h;c.ngIpv4Prefix?a.$watch(c.ngIpv4Prefix,function(a,b){c.ipv4Prefix=a;d.$validate()}):c.ipv4Prefix=!0;b&&(h=RegExp(b));c.ipv4Prefix=c.ngIpv4Prefix?a.$eval(c.ngIpv4Prefix):!0;d.$validators.ipv4Prefix=function(a,b){return!c.ipv4Prefix||d.$isEmpty(b)?!0:g(b)||h&&b.match(h)?!0:!1};c.$observe("ipv4Prefix",function(){d.$validate()})}}}},p=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),
h=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,e=/(^[\x00-\xff]*$)/;c.ngIpv6Ip?a.$watch(c.ngIpv6Ip,function(a,b){c.ipv6Ip=a;d.$validate()}):c.ipv6Ip=!0;c.ipv6Ip=c.ngIpv6Ip?a.$eval(c.ngIpv6Ip):!0;d.$validators.ipv6Ip=function(a,b){return!c.ipv6Ip||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)&&b.match(e)?!0:!1};c.$observe("ipv6Ip",function(){d.$validate()})}}}},q=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^(([0-9a-fA-F]{0,4}))(:[0-9a-fA-F]{1,4}){0,7}(::)?(%[\p{N}\p{L}]+)?$/,
h=/(^[\x00-\xff]*$)/;c.ngIpv6IpPrefix?a.$watch(c.ngIpv6IpPrefix,function(a,b){c.ipv6IpPrefix=a;d.$validate()}):c.ipv6IpPrefix=!0;c.ipv6IpPrefix=c.ngIpv6IpPrefix?a.$eval(c.ngIpv6IpPrefix):!0;d.$validators.ipv6IpPrefix=function(a,b){return!c.ipv6IpPrefix||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("ipv6IpPrefix",function(){d.$validate()})}}}},e=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^((:|[0-9a-fA-F]{0,4}))([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),
h=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),e=/(^[\x00-\xff]*$)/;c.ngIpv6IpSuffix?a.$watch(c.ngIpv6IpSuffix,function(a,b){c.ipv6IpSuffix=a;d.$validate()}):c.ipv6IpSuffix=!0;c.ipv6IpSuffix=c.ngIpv6IpSuffix?a.$eval(c.ngIpv6IpSuffix):!0;d.$validators.ipv6IpSuffix=function(a,b){return!c.ipv6IpSuffix||d.$isEmpty(b)?!0:(b.match(g)||b.match(h))&&b.match(e)?!0:!1};c.$observe("ipv6IpSuffix",function(){d.$validate()})}}}},x=function(){return{restrict:"A",
require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),h=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,e=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),k=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,
l=/(^[\x00-\xff]*$)/;c.ngIp?a.$watch(c.ngIp,function(a,b){c.ip=a;d.$validate()}):c.ip=!0;c.ip=c.ngIp?a.$eval(c.ngIp):!0;d.$validators.ip=function(a,b){return!c.ip||d.$isEmpty(b)?!0:(b.match(g)&&!b.match(h)||b.match(e)&&b.match(k))&&b.match(l)?!0:!1};c.$observe("ip",function(){d.$validate()})}}}},n=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^((([a-zA-Z0-9]([a-zA-Z0-9\\-]){0,61})?[a-zA-Z0-9]\\.)*([a-zA-Z0-9]([a-zA-Z0-9\\-]){0,61})?[a-zA-Z0-9])$"),h=
/(^[\x00-\xff]*$)/;c.hostName=c.ngHostName?a.$eval(c.ngHostName):!0;c.ngHostName?a.$watch(c.ngHostName,function(a,b){c.hostName=a;d.$validate()}):c.hostName=!0;d.$validators.hostName=function(a,b){return!c.hostName||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("hostName",function(){d.$validate()})}}}},l=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^((([a-zA-Z0-9]([a-zA-Z0-9\\-]){0,61})?[a-zA-Z0-9]\\.)*([a-zA-Z0-9]([a-zA-Z0-9\\-]){0,61})?[a-zA-Z0-9])$"),
h=/(^[\x00-\xff]*$)/;c.hostNameNum=c.ngHostNameNum?a.$eval(c.ngHostNameNum):!0;c.ngHostNameNum?a.$watch(c.ngHostNameNum,function(a,b){c.hostNameNum=a;d.$validate()}):c.hostNameNum=!0;d.$validators.hostNameNum=function(a,b){return!c.hostNameNum||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("hostNameNum",function(){d.$validate()})}}}},r=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^(((?!-)[a-zA-Z0-9-_]{1,63}(?!-)\.)+[a-zA-Z_]{2,63})$)/,h=/(^[\x00-\xff]*$)/;
c.domainName=c.ngDomainName?a.$eval(c.ngDomainName):!0;c.ngDomainName?a.$watch(c.ngDomainName,function(a,b){c.domainName=a;d.$validate()}):c.domainName=!0;d.$validators.domainName=function(a,b){return!c.domainName||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("domainName",function(){d.$validate()})}}}},v=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^(0[0-9]|1[0-9]|2[0-3]){1}(:[0-5][0-9]){2}$/,h=/(^[\x00-\xff]*$)/;c.time24hmsForm=c.ngTime24hmsForm?
a.$eval(c.ngTime24hmsForm):!0;c.ngTime24hmsForm?a.$watch(c.ngTime24hmsForm,function(a,b){c.time24hmsForm=a;d.$validate()}):c.time24hmsForm=!0;d.$validators.time24hmsForm=function(a,b){return!c.time24hmsForm||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("time24hmsForm",function(){d.$validate()})}}}},s=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^(0[0-9]|1[0-9]|2[0-3]){1}(:[0-5][0-9]){1}$/,h=/(^[\x00-\xff]*$)/;c.time24hmForm=c.ngTime24hmForm?a.$eval(c.ngTime24hmForm):
!0;c.ngTime24hmForm?a.$watch(c.ngTime24hmForm,function(a,b){c.time24hmForm=a;d.$validate()}):c.time24hmForm=!0;d.$validators.time24hmForm=function(a,b){return!c.time24hmForm||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("time24hmForm",function(){d.$validate()})}}}},k=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[0-9a-fA-F]{2}(:[0-9a-fA-F]{2}){5}$/,h=/(^[\x00-\xff]*$)/;c.macAddress=c.ngMacAddress?a.$eval(c.ngMacAddress):!0;c.ngMacAddress?a.$watch(c.ngMacAddress,
function(a,b){c.macAddress=a;d.$validate()}):c.macAddress=!0;d.$validators.macAddress=function(a,b){return!c.macAddress||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("macAddress",function(){d.$validate()})}}}},d=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|((?!-)[a-zA-Z0-9-]{1,63}(?!-)\.)+[a-zA-Z-]{2,63})$)/,h=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),
e=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,k=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),l=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,n=/(^[\x00-\xff]*$)/;c.fqdnIp=c.ngFqdnIp?a.$eval(c.ngFqdnIp):!0;c.ngFqdnIp?a.$watch(c.ngFqdnIp,function(a,b){c.fqdnIp=a;d.$validate()}):c.fqdnIp=!0;
d.$validators.fqdnIp=function(a,b){return!c.fqdnIp||d.$isEmpty(b)?!0:(b.match(g)||b.match(h)&&!b.match(e)||b.match(k)&&b.match(l))&&b.match(n)?!0:!1};c.$observe("fqdnIp",function(){d.$validate()})}}}},c=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^(((?!-)[a-zA-Z0-9-_]{1,63}(?!-)\.)+[a-zA-Z_]{2,63})$)/,h=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),e=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,
k=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),l=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,n=/(^[\x00-\xff]*$)/;c.domainIp=c.ngDomainIp?a.$eval(c.ngDomainIp):!0;c.ngDomainIp?a.$watch(c.ngDomainIp,function(a,b){c.domainIp=a;d.$validate()}):c.domainIp=!0;d.$validators.domainIp=function(a,b){return!c.domainIp||
d.$isEmpty(b)?!0:(b.match(g)||b.match(h)&&!b.match(e)||b.match(k)&&b.match(l))&&b.match(n)?!0:!1};c.$observe("domainIp",function(){d.$validate()})}}}},h=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|((?!-)[a-zA-Z0-9-]{1,63}(?!-)\.)+[a-zA-Z-]{2,63})$)/,h=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),e=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,
k=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),l=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,n=/^\w+([\-+\.]\w+)*@\w+([\-\.]\w+)*\.\w+([\-\.]\w+)*$/,z=/(^[\x00-\xff]*$)/;c.fqdnIpEmail=c.ngFqdnIpEmail?a.$eval(c.ngFqdnIpEmail):!0;c.ngFqdnIpEmail?a.$watch(c.ngFqdnIpEmail,function(a,b){c.fqdnIpEmail=
a;d.$validate()}):c.fqdnIpEmail=!0;d.$validators.fqdnIpEmail=function(a,b){return!c.fqdnIpEmail||d.$isEmpty(b)?!0:(b.match(g)||b.match(h)&&!b.match(e)||b.match(k)&&b.match(l)||b.match(n))&&b.match(z)?!0:!1};c.$observe("fqdnIpEmail",function(){d.$validate()})}}}},g=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("(?=.*[\\.])(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|((?!-)[a-zA-Z0-9-]{1,63}(?!-)\\.)+[a-zA-Z]{2,63})$)"),h=/(^[0-9-])/,e=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),
k=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,l=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),n=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,z=/(^[\x00-\xff]*$)/;c.fqdnNoHostIp=c.ngFqdnNoHostIp?a.$eval(c.ngFqdnNoHostIp):!0;c.ngFqdnNoHostIp?a.$watch(c.ngFqdnNoHostIp,function(a,b){c.fqdnNoHostIp=
a;d.$validate()}):c.fqdnNoHostIp=!0;d.$validators.fqdnNoHostIp=function(a,b){return!c.fqdnNoHostIp||d.$isEmpty(b)?!0:(b.match(g)&&!b.match(h)||b.match(e)&&!b.match(k)||b.match(l)&&b.match(n))&&b.match(z)?!0:!1};c.$observe("fqdnNoHostIp",function(){d.$validate()})}}}},A=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|((?!-)[a-zA-Z0-9-]{1,63}(?!-)\.)+[a-zA-Z-]{2,63})$)/,h=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),
e=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,k=/(^[\x00-\xff]*$)/;c.fqdnIpv4=c.ngFqdnIpv4?a.$eval(c.ngFqdnIpv4):!0;c.ngFqdnIpv4?a.$watch(c.ngFqdnIpv4,function(a,b){c.fqdnIpv4=a;d.$validate()}):c.fqdnIpv4=!0;d.$validators.fqdnIpv4=function(a,b){return!c.fqdnIpv4||d.$isEmpty(b)?!0:(b.match(g)||b.match(h)&&!b.match(e))&&b.match(k)?!0:!1};c.$observe("fqdnIpv4",function(){d.$validate()})}}}},y=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|((?!-)[a-zA-Z0-9-]{1,63}(?!-)\.)+[a-zA-Z-]{2,63})$)/,
h=/(^[\x00-\xff]*$)/;c.fqdn=c.ngFqdn?a.$eval(c.ngFqdn):!0;c.ngFqdn?a.$watch(c.ngFqdn,function(a,b){c.fqdn=a;d.$validate()}):c.fqdn=!0;d.$validators.fqdn=function(a,b){return!c.fqdn||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("fqdn",function(){d.$validate()})}}}},z=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|(((?!-)[a-zA-Z0-9-]{1,63}(?!-)\\.){2,})+[a-zA-Z-]{2,63})$)"),h=/(^[0-9-])/,e=/(^[\x00-\xff]*$)/;
c.strickFqdn=c.ngStrickFqdn?a.$eval(c.ngStrickFqdn):!0;c.ngStrickFqdn?a.$watch(c.ngStrickFqdn,function(a,b){c.strickFqdn=a;d.$validate()}):c.strickFqdn=!0;d.$validators.strickFqdn=function(a,b){return!c.strickFqdn||d.$isEmpty(b)?!0:b.match(g)&&!b.match(h)&&b.match(e)?!0:!1};c.$observe("strickFqdn",function(){d.$validate()})}}}},B=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^\w+([\-+\.]\w+)*@\w+([\-\.]\w+)*\.\w+([\-\.]\w+)*$/,h=/(^[\x00-\xff]*$)/;c.email=c.ngEmail?
a.$eval(c.ngEmail):!0;c.ngEmail?a.$watch(c.ngEmail,function(a,b){c.email=a;d.$validate()}):c.email=!0;d.$validators.email=function(a,b){return!c.email||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("email",function(){d.$validate()})}}}},D=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[0-9A-Fa-f]*$/,h=/(^[\x00-\xff]*$)/;c.bitMask=c.ngBitMask?a.$eval(c.ngBitMask):!0;c.ngBitMask?a.$watch(c.ngBitMask,function(a,b){c.bitMask=a;d.$validate()}):c.bitMask=
!0;d.$validators.bitMask=function(a,b){return!c.bitMask||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("bitMask",function(){d.$validate()})}}}},E=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[a-zA-Z0-9][#\-\d\w\s]*$/,h=/(^[\x00-\xff]*$)/;c.strName=c.ngStrName?a.$eval(c.ngStrName):!0;c.ngStrName?a.$watch(c.ngStrName,function(a,b){c.strName=a;d.$validate()}):c.strName=!0;d.$validators.strName=function(a,b){return!c.strName||d.$isEmpty(b)?!0:b.match(g)&&
b.match(h)?!0:!1};c.$observe("strName",function(){d.$validate()})}}}},C=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[a-zA-Z0-9_\-\.]*\.[a-zA-Z0-9]+$/,h=/(^[\x00-\xff]*$)/;c.fileName=c.ngFileName?a.$eval(c.ngFileName):!0;c.ngFileName?a.$watch(c.ngFileName,function(a,b){c.fileName=a;d.$validate()}):c.fileName=!0;d.$validators.fileName=function(a,b){return!c.fileName||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("fileName",function(){d.$validate()})}}}},
I=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[a-zA-Z0-9][#\-\d\w\s]*$/,h=/^\w+([\-+\.]\w+)*@\w+([\-\.]\w+)*\.\w+([\-\.]\w+)*$/,e=/(^[\x00-\xff]*$)/;c.ddnsName=c.ngDdnsName?a.$eval(c.ngDdnsName):!0;c.ngDdnsName?a.$watch(c.ngDdnsrName,function(a,b){c.ddnsName=a;d.$validate()}):c.ddnsName=!0;d.$validators.ddnsName=function(a,b){return!c.ddnsName||d.$isEmpty(b)?!0:(b.match(g)||b.match(h))&&b.match(e)?!0:!1};c.$observe("ddnsName",function(){d.$validate()})}}}},
G=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[^\s]*$/,h=/(^[\x00-\xff]*$)/;c.noSpace=c.ngNoSpace?a.$eval(c.ngNoSpace):!0;c.ngNoSpace?a.$watch(c.ngNoSpace,function(a,b){c.noSpace=a;d.$validate()}):c.noSpace=!0;d.$validators.noSpace=function(a,b){return!c.noSpace||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("noSpace",function(){d.$validate()})}}}},H=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^.*$)/,
h=/(^[^%&\\"'\s]*$)/,e=/(^[\x00-\xff]*$)/;c.password=c.ngPassword?a.$eval(c.ngPassword):!0;c.ngPassword?a.$watch(c.ngPassword,function(a,b){c.password=a;d.$validate()}):c.password=!0;d.$validators.password=function(a,b){return!c.password||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)&&b.match(e)?!0:!1};c.$observe("password",function(){d.$validate()})}}}},F=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^[^%&\\"']*$)/,h=/(^[\x00-\xff]*$)/;c.keyword=c.ngKeyword?a.$eval(c.ngKeyword):
!0;c.ngKeyword?a.$watch(c.ngKeyword,function(a,b){c.keyword=a;d.$validate()}):c.keyword=!0;d.$validators.keyword=function(a,b){return!c.keyword||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("keyword",function(){d.$validate()})}}}},K=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^[\x00-\xff]*$)/;c.legalChar=c.ngLegalChar?a.$eval(c.ngLegalChar):!0;c.ngLegalChar?a.$watch(c.ngLegalChar,function(a,b){c.legalChar=a;d.$validate()}):c.legalChar=!0;d.$validators.legalChar=
function(a,b){return!c.legalChar||d.$isEmpty(b)?!0:b.match(g)?!0:!1};c.$observe("legalChar",function(){d.$validate()})}}}},M=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[a-zA-Z0-9@\.!%^\-_=+\[\]\s]*$/,h=/(^[\x00-\xff]*$)/;c.certCommonName=c.ngCertCommonName?a.$eval(c.ngCertCommonName):!0;c.ngCertCommonName?a.$watch(c.ngCertCommonName,function(a,b){c.certCommonName=a;d.$validate()}):c.certCommonName=!0;d.$validators.certCommonName=function(a,b){return!c.certCommonName||
d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("certCommonName",function(){d.$validate()})}}}},N=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^[0-9#*+]*$)/,h=/(^[\x00-\xff]*$)/;c.dialNum=c.ngDialNumber?a.$eval(c.ngDialNumber):!0;c.ngDialNumber?a.$watch(c.ngDialNumber,function(a,b){c.dialNum=a;d.$validate()}):c.dialNum=!0;d.$validators.dialNum=function(a,b){return!c.dialNum||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("dialNum",function(){d.$validate()})}}}},
J=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^[0-9]*$)/,h=/(^[\x00-\xff]*$)/;c.number=c.ngNumber?a.$eval(c.ngNumber):!0;c.ngNumber?a.$watch(c.ngNumber,function(a,b){c.number=a;d.$validate()}):c.number=!0;d.$validators.number=function(a,b){return!c.number||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("number",function(){d.$validate()})}}}},R=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&(c.maxlength=c.ngMaxLength?
a.$eval(c.ngMaxLength):c.maxLength,c.ngMaxLength&&a.$watch(c.ngMaxLength,function(a,b){c.maxlength=a;d.$validate()}),d.$validators.maxLength=function(a,b){return 0>=c.maxlength||d.$isEmpty(b)?!0:b.length<=c.maxlength?!0:!1},c.$observe("maxLength",function(){d.$validate()}))}}},W=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&(c.minlength=c.ngMinLength?a.$eval(c.ngMinLength):c.minLength,c.ngMinLength&&a.$watch(c.ngMinLength,function(a,b){c.minlength=a;d.$validate()}),d.$validators.minLength=
function(a,b){return 0>=c.minlength||d.$isEmpty(b)?!0:b.length>=c.minlength?!0:!1},c.$observe("minLength",function(){d.$validate()}))}}},S=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&(c.lengthequal=c.ngLengthEqual?a.$eval(c.ngLengthEqual):c.lengthEqual,c.ngLengthEqual&&a.$watch(c.ngLengthEqual,function(a,b){c.lengthequal=a;setTimeout(function(){d.$validate()},0)}),d.$validators.lengthEqual=function(a,b){return 0>c.lengthequal||d.$isEmpty(b)?!0:b.length===c.lengthequal?
!0:!1},c.$observe("lengthEqual",function(){d.$validate()}))}}},X=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^[a-zA-Z0-9_]*$)/,h=/(^[\x00-\xff]*$)/;c.uciName=c.ngUciName?a.$eval(c.ngUciName):!0;c.ngUciName?a.$watch(c.ngUciName,function(a,b){c.uciNmae=a;d.$validate()}):c.uciName=!0;d.$validators.uciName=function(a,b){return!c.uciName||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("uciName",function(){d.$validate()})}}}},T=function(){return{restrict:"A",
require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^([1-9]|[1-9][0-9]|[1][0-2][0-8])$)/,h=/(^[\x00-\xff]*$)/;c.ipv6PrefixLen=c.ngIpv6PrefixLen?a.$eval(c.ngIpv6PrefixLen):!0;c.ngIpv6PrefixLen?a.$watch(c.ngIpv6PrefixLen,function(a,b){c.ipv6PrefixLen=a;d.$validate()}):c.ipv6PrefixLen=!0;d.$validators.ipv6PrefixLen=function(a,b){return!c.ipv6PrefixLen||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("ipv6PrefixLen",function(){d.$validate()})}}}},L=function(){return{restrict:"A",require:"?ngModel",
link:function(a,b,c,d){if(d){var g=/^[0-9A-Fa-f]*$/,h=/(^[\x00-\xff]*$)/;c.psk=c.ngPsk?a.$eval(c.ngPsk):!0;c.ngPsk?a.$watch(c.ngPsk,function(a,b){c.psk=a;d.$validate()}):c.psk=!0;d.$validators.psk=function(a,b){return!c.psk||d.$isEmpty(b)?!0:64===b.length?b.match(g)&&b.match(h)?!0:!1:b.match(h)?!0:!1};c.$observe("psk",function(){d.$validate()})}}}},U=["passwordComplex",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,g){g&&(d.ngComplexity?(b.$watch(d.ngComplexity,function(a,
b){d.complexity=a;g.$validate()}),d.complexity=b.$eval(d.ngComplexity)):d.complexity=!0,b.$watch(function(){return a.get_config()},function(a){g.$validate()}),g.$validators.complexity=function(b,c){var h,e={},k;if(!d.complexity||g.$isEmpty(c))return delete g.$error.complexity,delete g.$error.complexity_length,delete g.$error.complexity_class,!0;h=a.getStrength({pwd:c,qualityIndicator:e});k="complexity_length";!0===e.length_ok&&angular.isDefined(g.$error[k])?delete g.$error[k]:!1===e.length_ok&&(g.$error[k]=
!0);k="complexity_class";!0===e.class_ok&&angular.isDefined(g.$error[k])?delete g.$error[k]:!1===e.class_ok&&(g.$error[k]=!0);if(0<h)return delete g.$error.complexity,!0;g.$error.complexity=!0;return!1},d.$observe("complexity",function(){g.$validate()}))}}}],V=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("(\\btype\\b|\\bvalid-duration\\b|\\bsubject-alternative-type\\b|\\bcountry\\b|\\bkey-encryption-length\\b|\\bname\\b|\\bsubject-alternative-name\\b|\\blocality\\b|\\borganization\\b|\\borganization-unit\\b|\\bcommon\\b|\\bemail\\b|\\bstate-province\\b)");
c.certStr=c.ngCertStr?a.$eval(c.ngCertStr):!0;c.ngCertStr?a.$watch(c.ngCertStr,function(a,b){c.certStr=a;d.$validate()}):c.certStr=!0;d.$validators.certStr=function(a,b){return c.certStr&&!d.$isEmpty(b)&&b.match(g)?!1:!0};c.$observe("certStr",function(){d.$validate()})}}}},P=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^([0-9]{4}[\-\s][0-9]{4}$|[0-9]*$)/;c.wpsPin=c.ngWpsPin?a.$eval(c.ngWpsPin):!0;c.ngWpsPin?a.$watch(c.ngWpsPin,function(a,b){c.wpsPin=a;d.$validate()}):
c.wpsPin=!0;d.$validators.wpsPin=function(a,b){return!c.wpsPin||d.$isEmpty(b)?!0:b.match(g)?!0:!1};c.$observe("wpsPin",function(){d.$validate()})}}}},O=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[a-zA-Z0-9][a-zA-Z0-9_\-\s,']*$/,h=/(^[\x00-\xff]*$)/;c.staticDhcpName=c.ngStaticDhcpName?a.$eval(c.ngStaticDhcpName):!0;c.ngStaticDhcpName?a.$watch(c.ngStaticDhcpName,function(a,b){c.staticDhcpName=a;d.$validate()}):c.staticDhcpName=!0;d.$validators.staticDhcpName=
function(a,b){return!c.staticDhcpName||d.$isEmpty(b)?!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("staticDhcpName",function(){d.$validate()})}}}},Q=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[^&<]*$/,h=/(^[\x00-\xff]*$)/;c.loginBanner=c.ngLoginBanner?a.$eval(c.ngLoginBanner):!0;c.ngLoginBanner?a.$watch(c.ngLoginBanner,function(a,b){c.loginBanner=a;d.$validate()}):c.loginBanner=!0;d.$validators.loginBanner=function(a,b){return!c.loginBanner||d.$isEmpty(b)?
!0:b.match(g)&&b.match(h)?!0:!1};c.$observe("loginBanner",function(){d.$validate()})}}}},Y=function(){return{restrict:"A",require:["?ngModel","^form"],link:function(a,b,c,d){if(d&&d[0]){var g="customVld",h,e,k=d[0],l=d[1],n=!1,z,r=[],B={},y,s=function(){return!0};if(c.customVldRelationship&&(b=a.$eval(c.customVldRelationship),"array"===$.type(b))){for(y=b.length-1;0<=y;y--)b[y]===k.$name&&b.splice(y,1);r=b}c.customVldOps&&(b=a.$eval(c.customVldOps),"object"===$.type(b)&&(B=b));a.grid?(d=a.col,h=a.row,
e=a.colContainer.renderedColumns,b=a.grid.rows,angular.forEach(b,function(a,b){h.uid===a.uid&&(h.rowIndex=b)})):(d=a.$eval("col"),h=a.$eval("row"),e=a.$eval("renderedColumns"),b=a.$eval("renderedRows"));if(d&&d.colDef&&d.colDef.customVldGroup){z=d.colDef.customVldGroup;n=!0;for(y=e.length-1;0<=y;y--)e[y].field!==d.field&&e[y].colDef.customVldGroup===z&&r.push(e[y].field+"_"+e[y].index+"_"+h.rowIndex)}c.customVldName&&(g=c.customVldName);c.customVldCbk&&(d=a.$eval(c.customVldCbk),"function"===typeof d&&
(s=d));c.ngCustomVld?(c[g]=a.$eval(c.ngCustomVld),a.$watch(c.ngCustomVld,function(b,d){c[g]=b;!1===b&&(k&&(k.$error&&k.$error[g])&&!0===B.modifyEmptyStr)&&(k.$viewValue="",k.$commitViewValue(),k.$render());v(a.$eval(c.ngModel))})):c[g]=!0;var A=function(b,d){var h=b.invalidRows,k=b.validRows,r=!1,B=!1,s=!1,A;"array"===$.type(h)&&h.length&&(r=!0);"array"===$.type(k)&&k.length&&(B=!0);void 0===d&&(d={},s=!0);if(n&&(r||B)){var v=function(a){a=a||"";r&&angular.forEach(h,function(b){b!==d.rowIndex&&(A=
a+e[y].field+"_"+e[y].index+"_"+b,l[A]&&l[A].$setValidity(g,!1))});B&&angular.forEach(k,function(b){b!==d.rowIndex&&(A=a+e[y].field+"_"+e[y].index+"_"+b,l[A]&&l[A].$setValidity(g,!0))})},J=[""];c.customVldAffectPreifxList&&(J=a.$eval(c.customVldAffectPreifxList));for(y=e.length-1;0<=y;y--)if(e[y].colDef.customVldGroup===z||void 0!==e[y].colDef.customVldGroup&&s)for(var F=0,q;F<J.length;F++)q=J[F],v(q)}},v=function(a){if(!c[g]||""===$.type(a)||"boolean"!==$.type(a)&&k.$isEmpty(a))k.$setValidity(g,
!0);else{var b={type:"edit_row"};a=!0;var d=angular.copy(r);h&&(b.row=h);b=s(b);"object"===$.type(b)?(a=!0===b.result,A(b,h)):a="boolean"===$.type(b)?b:!0;if(l&&d.length)for(y=d.length-1;0<=y;y--)b=d[y],l[b]&&l[b].$setValidity(g,a);k.$setValidity(g,a)}};a.$watch(c.ngModel,function(a,b){v(a)});a.currRows=[];l&&(!l.nggridchklenvld&&b&&void 0!==b.length)&&(l.nggridchklenvld=a.$watch(function(){return a.grid?a.grid.rows.length:a.renderedRows.length},function(a,b){if(!(b<=a)){var c=s({type:"delete_row"});
"object"===$.type(c)&&A(c,void 0)}}))}}}};angular.forEach({ipv4Ip:b,ngIpv4Ip:b,ipv4IpFormat:t,ngIpv4IpFormat:t,ipv4Netmask:m,ngIpv4Netmask:m,ipv4NetmaskAll:w,ngIpv4NetmaskAll:w,ipv4Prefix:u,ngIpv4Prefix:u,ipv6Ip:p,ngIpv6Ip:p,ipv6IpPrefix:q,ngIpv6IpPrefix:q,ipv6IpSuffix:e,ngIpv6IpSuffix:e,ip:x,ngIp:x,hostName:n,ngHostName:n,hostNameNum:l,ngHostNameNum:l,domainName:r,ngDomainName:r,time24hmsForm:v,ngTime24hmsForm:v,time24hmForm:s,ngTime24hmForm:s,macAddress:k,ngMacAddress:k,fqdnIp:d,ngFqdnIp:d,domainIp:c,
ngDomainIp:c,fqdnIpEmail:h,ngFqdnIpEmail:h,fqdnNoHostIp:g,ngFqdnNoHostIp:g,fqdnIpv4:A,ngFqdnIpv4:A,fqdn:y,ngFqdn:y,strickFqdn:z,ngStrickFqdn:z,email:B,ngEmail:B,bitMask:D,ngBitMask:D,strName:E,ngStrName:E,ddnsName:I,ngDdnsName:I,noSpace:G,ngNoSpace:G,password:H,ngPassword:H,keyword:F,ngKeyword:F,legalChar:K,ngLegalChar:K,certCommonName:M,ngCertCommonName:M,dialNumber:N,ngDialNumber:N,ngMaxLength:R,maxLength:R,ngMinLength:W,minLength:W,lengthEqual:S,ngLengthEqual:S,number:J,ngNumber:J,uciName:X,ngUciName:X,
ipv6PrefixLen:T,ngIpv6PrefixLen:T,psk:L,ngPsk:L,fileName:C,ngFileName:C,ipv4IpNonzero:a,ngIpv4IpNonzero:a,complexity:U,ngComplexity:U,customVld:Y,ngCustomVld:Y,gridCustomVld:function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){b=a;var g,h,e=function(){return!0};a.grid&&(b=a.grid.appScope);c.gridCustomVld&&(h=a.$eval(c.gridCustomVld));h&&(h=b.$eval(h),_.isFunction(h)&&(e=h,g=a.$watch(c.ngModel,function(b,c){e(a.row,a.col,a.grid,d)}),a.$on("$destroy",function(){g&&g()})))}}}},
certStr:V,ngCertStr:V,wpsPin:P,ngWpsPin:P,staticDhcpName:O,ngStaticDhcpName:O,loginBanner:Q,ngLoginBanner:Q},function(a,b){app.directive(b,a)})}]);
app.directive("gridInvalidField",[function(){return{restrict:"A",require:"?ngModel",link:function(a,b,t,m){b={};var w=[];if(t.gridInvalidField&&a.row){o=a.$eval(t.gridInvalidField);if(_.isString(o))b[o]="gridInvalid";else if(_.isObject(o))b=o;else return;angular.forEach(b,function(b,p){w.push(a.$watch(function(){return _.get(a.row.entity,p)},function(a){m.$setValidity(b,!a)}))});a.$on("$destroy",function(){w&&w.length&&angular.forEach(w,function(a){a()})})}}}}]);
app.directive("gridValidationResultCbk",[function(){return{restrict:"A",require:"?ngModel",link:function(a,b,t,m){if(m&&t.gridValidationResultCbk){var w,u=a.$eval("grid"),p;p=u?u.appScope.$eval(t.gridValidationResultCbk):a.$eval(t.gridValidationResultCbk);if("function"===$.type(p)){var q=function(b,q,n){var l=0,r=a.$eval("row"),v=a.$eval("col");q=u?v.uid:v.index;void 0===r.invalidCols&&(r.invalidCols={});r.invalidCols[q]=b?!0:!1;angular.forEach(r.invalidCols,function(a){a&&l++});p({row:r,col:v,colInvalid:b,
rowInvalid:0<l,reason:n})};w=a.$watch(function(){return m.$invalid},function(a,b){q(a,b,"invalid_changed")});a.$on("$destroy",function(){w&&w();q(!1,void 0,"destroy")})}}}}}]);app.directive("ignoreDirty",[function(){return{restrict:"A",require:"?ngModel",link:function(a,b,t,m){m&&(m.$setPristine=function(){},m.$pristine=!1)}}}]);
app.service("sslvpn_port_vld",["MyHttp","$q","userAccessRight",function(a,b,t){var m=t.russia(),w=function(a,b){return a&&a[b]&&a[b].data&&a[b].data.result||{}},u=function(a,b){b||(b="");return void 0===a?b:a},p={enable:!1,ifname:"",gateway_port:""},q=!1,e=830,x=!1,n=443,l={enable:!1,remote:{enable:!1,port:""},lan_vpn:{https_enable:!1,https_port:"",http_enable:!1,http_port:""}},r={},v=[],s=function(a){a=a["port-forwarding-rules"]&&a["port-forwarding-rules"]["port-forwarding-entry"]||[];var b;v=[];
angular.forEach(a,function(a){b={enable:u(a.status,!1),ifname:u(a["interface"]),external_service:u(a["external-service"])};v.push(b)})},k=function(a){a=a.services&&a.services.service||[];var b;r={};angular.forEach(a,function(a){a["port-range"]&&(b={name:a.name,proto:a.protocol||"",start:u(a["port-range"].start,""),end:u(a["port-range"].end,"")},""===b.start||""===b.end||(r[b.name]=b))})},d=function(a){a||(a={});a=a["ciscosb-netconf"]||{};var b=a["netconf-zone"]||[],c=!1,d=u((a.transport&&a.transport.ssh||
{}).port,830);a.enabled&&angular.forEach(b,function(a){"wan"===a&&(c=!0)});q=c;e=d},c=function(a){a||(a={});a=a["ciscosb-restconf"]||{};var b=a["restconf-zone"]||[],c=!1,d=u((a.transport&&a.transport.https||{}).port,443);a.enabled&&angular.forEach(b,function(a){"wan"===a&&(c=!0)});x=c;n=d},h=function(a,b){var c=p,d=[];c.enable&&"number"===typeof c.gateway_port&&!m&&c.gateway_port>=a&&c.gateway_port<=b&&d.push({id:"sslvpn",service:"SSL VPN",start:c.gateway_port,end:c.gateway_port});return d},g=function(a,
b){var c=l,d=[];c.remote.enable&&"number"===typeof c.remote.port&&c.remote.port>=a&&c.remote.port<=b&&d.push({id:"firewall",service:"Remote Web Management",start:c.remote.port,end:c.remote.port});q&&_.isNumber(e)&&e>=a&&e<=b&&d.push({id:"firewall",service:"NETCONF Port",start:e,end:e});x&&_.isNumber(n)&&n>=a&&n<=b&&d.push({id:"firewall",service:"RESTCONF Port",start:n,end:n});return d},A=function(a,b){var c=r,d,g=[];angular.forEach(v,function(h){if(h.enable&&(d=c[h.external_service])){switch(d.proto){case "TCP":case "TCP_UDP":break;
default:return}(d.start<=a&&d.end>=a||d.start<=b&&d.end>=b)&&g.push({id:"portforward",service:h.external_service,start:d.start,end:d.end})}});return g};this.init=function(){var g=b.defer();b.all([a.post({url:resource_base+"data/sslvpn.json",method:"get_sslvpn"}),a.post({url:resource_base+"data/firewall_basic_settings.json",method:"get_firewall_basic_settings"}),a.post({url:resource_base+"data/port_forwarding.json",method:"get_port_forwarding"}),a.post({url:resource_base+"data/service_management.json",
method:"get_services"}),a.post({url:resource_base+"data/netconf.json",method:"get_netconf"}),a.post({url:resource_base+"data/restconf.json",method:"get_restconf"})]).then(function(a){var b=w(a,0).sslvpn||{};p={enable:u(b.enable,!1),ifname:u(b["interface"],""),gateway_port:u(b["gateway-port"],"")};var b=w(a,1).firewall||{},h=b["remote-web-management"]||{},e=b["lan-vpn-web-management"]||{};l={enable:u(b.enable,!1),remote:{enable:u(h.enable,!1),port:u(h.port||"")},lan_vpn:{https_enable:u(e.https,!1),
https_port:u(e["https-port"],443),http_enable:u(e.http,!1),http_port:u(e["http-port"],80)}};s(w(a,2));k(w(a,3));d(w(a,4));c(w(a,5));g.resolve("ok")});return g.promise};this.check_ssl_port=function(a){var b={valid:!0,err:[]},c;c=g(a,a);c.length&&(b.valid=!1,b.err=b.err.concat(c));c=l;var d=[];c.lan_vpn.https_enable&&"number"===typeof c.lan_vpn.https_port&&c.lan_vpn.https_port>=a&&c.lan_vpn.https_port<=a&&d.push({id:"firewall",service:m?"LAN Web Management (HTTPS)":"LAN/VPN Web Management (HTTPS)",
start:c.lan_vpn.https_port,end:c.lan_vpn.https_port});c.lan_vpn.http_enable&&"number"===typeof c.lan_vpn.http_port&&c.lan_vpn.http_port>=a&&c.lan_vpn.http_port<=a&&d.push({id:"firewall",service:m?"LAN Web Management (HTTP)":"LAN/VPN Web Management (HTTP)",start:c.lan_vpn.http_port,end:c.lan_vpn.http_port});c=d;c.length&&(b.valid=!1,b.err=b.err.concat(c));c=A(a,a);c.length&&(b.valid=!1,b.err=b.err.concat(c));return b};this.check_firewall_port_wan=function(a){var b={valid:!0,err:[]},c;c=h(a,a);c.length&&
(b.valid=!1,b.err=b.err.concat(c));c=A(a,a);c.length&&(b.valid=!1,b.err=b.err.concat(c));return b};this.check_firewall_port_lan=function(a){var b={valid:!0,err:[]};a=h(a,a);a.length&&(b.valid=!1,b.err=b.err.concat(a));return b};this.check_port_forwarding_service=function(a){a=r[a];var b={valid:!0,err:[]},c;if(!a)return b;switch(a.proto){case "TCP":case "TCP_UDP":break;default:return b}c=h(a.start,a.end);c.length&&(b.valid=!1,b.err=b.err.concat(c));c=g(a.start,a.end);c.length&&(b.valid=!1,b.err=b.err.concat(c));
return b};this.check_service_port=function(a,b,c){var d=!1,e={valid:!0,err:[]},k;angular.forEach(v,function(b){b.external_service===a&&(d=!0)});if(!d)return e;k=h(b,c);k.length&&(e.valid=!1,e.err=e.err.concat(k));k=g(b,c);k.length&&(e.valid=!1,e.err=e.err.concat(k));return e};this.get_err_html=function(a){var b="",c={sslvpn:"",firewall:"",portforward:""},d,g=[];angular.forEach(a,function(a){d=a.start===a.end?a.start:a.start+"-"+a.end;var b=a.service+" ("+d+")";0>g.indexOf(b)&&(g.push(b),c[a.id]=c[a.id]+
"<div>"+b+"</div>")});delete g;c.sslvpn&&(b+=c.sslvpn);c.firewall&&(b+=c.firewall);c.portforward&&(b=b+"<div>Port Forwarding:</div>"+c.portforward);b&&(b="<div>Port conflict with other services</div><br/>"+b);return b}}]);app.service("ipv6_lib",[function(){var a=createIpAddr(),b=function(a,b){var p=angular.copy(a);return 128===b?p:p=m(p,b)},t=function(a,b){var p=angular.copy(a);if(128===b)return p;var n,l,r,p=m(p,b);for(n=7;0<=n;n--){l="";for(r=0;16>r&&b;r++)0<b&&(l="1"+l,b-=1);l=parseInt(l,2);p.parts[n]|=l}return p},m=function(a,b){var m=angular.copy(a),n,l,r;for(n=0;n<m.parts.length;n++){l="";for(r=0;16>r;r++)0<b?(l+="1",b-=1):l+="0";l=parseInt(l,2);m.parts[n]&=l}return m},w=function(b){var e=!1;return!b||!a.IPv6.isValid(b)?
e:e=a.IPv6.parse(b)},u=function(b){var e;e=angular.copy(b);b=!1;if(!e)return b;e=e.split("/");if(!e||!a.IPv6.isValid(e[0]))return b;e[0]=a.IPv6.parse(e[0]);e[1]=parseInt(e[1],10);return!_.isNumber(e[1])||0>e[1]||128<e[1]?b:e},p=function(a,b){var m,n;if(!a||!b||!a.parts||!b.parts||!a.parts.length||!b.parts.length)return!1;m=!0;for(n=0;8>n;n++)if(a.parts[n]>b.parts[n]){m=!1;break}return m};this.vld={is_overlap_between_prefixs:function(a,e){var p,n,l,r,v,s,k,d=!1;p=u(a);r=u(e);if(!p||!r)return d;l=p[0];
n=p[1];s=r[0];v=r[1];if(n>v){if(k=t(l,n),v=b(l,n),k.match(r)||v.match(r))d=!0}else if(v>n){if(k=t(s,v),v=b(s,v),k.match(p)||v.match(p))d=!0}else p=m(l,n),r=m(s,v),p.toNormalizedString()===r.toNormalizedString()&&(d=!0);return d},is_overlap_between_ranges:function(a,b){if(a&&b){var m=w(a.start),n=w(a.end),l=w(b.start),r=w(b.end),v=!1;if(m&&n&&l&&r&&p(m,n)&&p(l,r))return p(m,l)&&p(l,n)&&(v=!0),p(m,r)&&p(r,n)&&(v=!0),p(l,m)&&p(m,r)&&(v=!0),p(l,n)&&p(n,r)&&(v=!0),v}},ip_range_is_valid:p};this.parse=w;
this.CIDR=u;this.combined_two_ip=function(a,b,m){a=angular.copy(a);var n=angular.copy(b);for(b=0;8>b;b++)16<m?m-=16:0<m?(n.parts[b]&=65535>>>m,a.parts[b]|=n.parts[b],m=0):a.parts[b]=n.parts[b];return a};this.get_prefix=m;this.get_suffix=function(a,b){var m=angular.copy(a),n,l,r;for(n=0;n<m.parts.length;n++){l="";for(r=0;16>r;r++)0<b?(l+="0",b-=1):l+="1";l=parseInt(l,2);m.parts[n]&=l}return m};this.get_first_ip=function(a,e){var m=w(a);return!m||!_.isNumber(e)||0>e||128<e?void 0:b(m,e)};this.get_last_ip=
function(a,b){var m=w(a);return!m||!_.isNumber(b)||0>b||128<b?void 0:t(m,b)}}]);(function(){var a=function(a){return{restrict:"E",templateUrl:a,transclude:!0,scope:{placement:"=placement",closedelay:"=closeDelay",trigger:"=trigger",context:"=context",isopen:"=isopen",openAndClose:"=openAndClose",ngIf:"=ngIf",ngShow:"=ngShow"},link:function(a,b,w){Log(DEBUG,a.context)},compile:function(){return{pre:function(a,b,w){var u,p,q,e,x=function(){u&&(clearTimeout(u),u=void 0)},n=function(){a.isopen&&(u=setTimeout(function(){u=void 0;a.isopen&&(a.isopen=!1)},a.openAndClose))};a.context||
(a.context="");_.isNumber(a.openAndClose)||(a.openAndClose=0);switch(a.placement){case "top":case "top-left":case "top-right":case "bottom":case "bottom-left":case "bottom-right":case "left":case "left-top":case "left-bottom":case "right":case "right-top":case "right-bottom":break;default:a.placement="top"}switch(a.trigger){case "mouseenter":case "click":case "outsideClick":case "focus":case "none":break;default:a.trigger="mouseenter"}_.isNumber(a.closedelay)?0>a.closedelay&&(a.closedelay=0):a.closedelay=
0;0<a.openAndClose&&(w.ngIf&&(p=a.$watch("ngIf",function(a){a?n():x()})),w.ngShow&&(q=a.$watch("ngShow",function(a){a?n():x()})),e=a.$watch("isopen",function(a){a?n():x()}));a.$on("$destroy",function(){p&&p();q&&q();e&&e()})}}}}};app.directive("helpIcon",[function(){return a("helpIcon.html")}]);app.directive("infoIcon",[function(){return a("infoIcon.html")}])})();
app.directive("gridBtnTableaction",["multiLanguageService",function(a){return{restrict:"C",templateUrl:"grid_tableaction_btn.html",replace:!0,scope:{uiGridOption:"=",ngDisabled:"=",uiGridActionCbk:"="},link:function(b,t,m){var w;b.columns=[];b.isopen=!1;b.disabled=!1;b.title=a.getString("Column_Display_Selection");b.clickaction=function(){var a=b.uiGridOption&&b.uiGridOption.columnDefs||[];b.columns=[];angular.forEach(a,function(a){!a.isChecked&&!a.isRadio&&b.columns.push({displayName:a.displayName,
field:a.field,visible:_.isBoolean(a.visible)?a.visible:!0})});b.isopen=!0};b.clickvisiable=function(a){angular.forEach(b.uiGridOption&&b.uiGridOption.columnDefs||[],function(b){a.field===b.field&&(a.visible=!a.visible,b.visible=a.visible)});b.uiGridOption&&(b.uiGridOption.gridApi&&b.uiGridOption.gridApi.core&&b.uiGridOption.gridApi.core.notifyDataChange)&&b.uiGridOption.gridApi.core.notifyDataChange("all")};w=b.$watch(function(){return b.isopen},function(a){_.isFunction(b.uiGridActionCbk)&&b.uiGridActionCbk(a,
b.uiGridOption&&b.uiGridOption.columnDefs||[])});b.$on("$destroy",function(){w()})}}}]);
app.directive("uiGridPaginationOp",["$rootScope",function(a){return{restrict:"E",templateUrl:"ui_grid_pagination_op.htm",scope:{pPageIdx:"=pageIdx",uiGridOption:"=",pagingOptions:"="},link:function(b,t,m){b.DICT=a.DICT;var w,u,p=function(){var a="";0<b.m.total?(a=(b.m.pageIdx-1)*b.m.pagingSize+1+" - "+(b.m.lastPageNum===b.m.pageIdx?b.m.total:b.m.pageIdx*b.m.pagingSize),b.m.pageStr=b.DICT("Paging_Info",{"%s1":a,"%s2":b.m.total})):b.m.pageStr=""},q=function(){b.m.pp=[];1<b.m.pageIdx&&b.m.pp.push({id:1,
isEllipsis:!1,cbk:function(){}});5<b.m.pageIdx?b.m.pp.push({id:"...",isEllipsis:!0,cbk:function(){b.goTo(b.m.pageIdx-3)}}):1<b.m.pageIdx-3&&b.m.pp.push({id:b.m.pageIdx-3,isEllipsis:!1});1<b.m.pageIdx-2&&b.m.pp.push({id:b.m.pageIdx-2,isEllipsis:!1});1<b.m.pageIdx-1&&b.m.pp.push({id:b.m.pageIdx-1,isEllipsis:!1});b.m.pp.push({id:b.m.pageIdx,isEllipsis:!1});b.m.pageIdx+1<b.m.lastPageNum&&b.m.pp.push({id:b.m.pageIdx+1,isEllipsis:!1});b.m.pageIdx+2<b.m.lastPageNum&&b.m.pp.push({id:b.m.pageIdx+2,isEllipsis:!1});
b.m.pageIdx+4<b.m.lastPageNum?b.m.pp.push({id:"...",isEllipsis:!0,cbk:function(){b.goTo(b.m.pageIdx+3)}}):b.m.pageIdx+3<b.m.lastPageNum&&b.m.pp.push({id:b.m.pageIdx+3,isEllipsis:!1});b.m.pageIdx<b.m.lastPageNum&&b.m.pp.push({id:b.m.lastPageNum,isEllipsis:!1})},e=function(){var a=b.pagingOptions;b.m.pp=[];b.m.pages=a.pages;b.m.total=a.total;b.m.pageStr="";b.m.pageIdx=angular.copy(b.pPageIdx);b.m.pagingSize=angular.copy(a.pageSize);b.m.lastPageNum=Math.floor(app.TOOLS.divide(b.m.total,b.m.pagingSize))+
(b.m.total%b.m.pagingSize?1:0);w=a.changePageSizeCbk;u=a.changePageIdxCbk;p();q();b.m.show=0<b.m.total?!0:!1};b.m={show:!1,pp:[],pages:[],total:0,pageStr:"",pageSize:0,lastPageNum:0};b.goToFirst=function(){b.goTo(1)};b.goToLast=function(){b.goTo(b.m.lastPageNum)};b.goToNext=function(){b.m.pageIdx<b.m.lastPageNum&&b.goTo(b.m.pageIdx+1)};b.goToPrevious=function(){1<b.m.pageIdx&&b.goTo(b.m.pageIdx-1)};b.goTo=function(a){u?(void 0===a&&(a=b.m.pageIdx),_.isFunction(u.pre)&&u.pre(a,function(){}),_.isFunction(u.post)&&
u.post(a,function(){b.m.pageIdx=a;Log(DEBUG,"doChangePageIdxCbk, pageIdx: "+b.m.pageIdx);b.uiGridOption&&b.uiGridOption.gridApi&&(b.uiGridOption.gridApi.pagination.seek(b.m.pageIdx),b.uiGridOption.gridApi.grid.refresh());p();q()})):Log(ERROR,"[uiGridPaginationOp] error, changePageIdxCbk is not defined")};b.changePageSize=function(){w(b.m.pagingSize,function(){b.goToFirst();b.uiGridOption.paginationPageSize=b.m.pagingSize;b.uiGridOption&&b.uiGridOption.gridApi&&b.uiGridOption.gridApi.grid.refresh();
e();p();q()})};var x;x=b.$watch(function(){return b.pPageIdx},function(a){a!==b.m.pageIdx&&b.goTo(a)});b.pagingOptions.updateOpts=function(){e()};b.pagingOptions.goTo=function(a){b.goTo(a)};e();b.$on("$destroy",function(){x()})}}}]);
(function(){var a={};angular.forEach({"grid-btn-add":["gridBtnAdd","grid-btn-add-s","Add"],"grid-btn-add-dhcp":["gridBtnAddDhcp","grid-btn-add-s","Add to Static DHCP"],"grid-btn-delete":["gridBtnDelete","grid-btn-delete-s","Delete"],"grid-btn-edit":["gridBtnEdit","grid-btn-edit-s","Edit"],"grid-btn-refresh":["gridBtnRefresh","grid-btn-refresh-s","Refresh"],"icon-btn-refresh":["iconBtnRefresh","grid-btn-refresh-s","Refresh"],"grid-btn-copy":["gridBtnCopy","grid-btn-copy-s","Copy"],"grid-btn-filter":["gridBtnFilter",
"grid-btn-filter-s","Filter"],"grid-btn-detail":["gridBtnDetail","grid-btn-detail-s","Detail"],"grid-btn-eye":["gridBtnEye","grid-btn-eye-s","Detail"],"grid-btn-look":["gridBtnLook","grid-btn-look-s","Look"],"grid-btn-connect":["gridBtnConnect","grid-btn-connect-s","Connect"],"icon-btn-connect":["iconBtnConnect","grid-btn-connect-s","Connect"],"grid-btn-connected":["gridBtnConnected","grid-btn-connect-s","Connected"],"icon-btn-connected":["iconBtnConnected","grid-btn-connect-s","Connected"],"grid-btn-disconnect":["gridBtnDisconnect",
"grid-btn-disconnect-s","Disconnect"],"icon-btn-disconnect":["iconBtnDisconnect","grid-btn-disconnect-s","Disconnect"],"grid-btn-disconnected":["gridBtnDisconnected","grid-btn-disconnect-s","Disconnected"],"icon-btn-disconnected":["iconBtnDisconnected","grid-btn-disconnect-s","Disconnected"],"grid-btn-reset":["gridBtnReset","grid-btn-reset-s","Reset"],"grid-btn-reset-counter":["gridBtnResetCounter","grid-btn-reset-s","Reset_Counter"],"icon-btn-reset":["iconBtnReset","grid-btn-reset-s","Reset"],"grid-btn-import":["gridBtnImport",
"grid-btn-import-s","Import"],"icon-btn-export":["iconBtnExport","grid-btn-reset-s","Export"],"icon-btn-show-children":["iconBtnShowChildren","icon-plus-s","Show_Children"],"icon-btn-hide-children":["iconBtnHideChildren","icon-minus-s","Hide_Children"]},function(b){b[0]&&b[1]&&(a[b[0]]&&Log(ERROR,'icon_directive.js _init_icons get error, directive name "'+b[0]+'"is repeated, please check it'),app.directive(b[0],[function(){return{restrict:"C",link:function(a,m,w){m.addClass(b[1]);b[2]&&(m.context.title=
a.DICT(b[2]))}}}]),a[b[0]]=!0)})})();app.controller("qos_wan_policing_main",["$scope","$q","$timeout","MyHttp","$templateCache","$filter","UserSession","userAccessRight","goToPreviousPage","oneTimeLocker",function(a,b,t,m,w,u,p,q,e,x){a.model=a.model||{};a.success=!1;a.dataReady=!1;a.backbtn=!1;a.comefromWanQueuing=!1;a.goback=function(){e.goback(function(b){b&&a.comefromWanQueuing&&x.put("needbackbtnbywanpolicy",!0)})};a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&p.logout();x.get("comefromWanQueuing")&&
(a.comefromWanQueuing=!0);e.isneed()&&(a.backbtn=!0);var n=function(){var e=m.post({url:resource_base+"data/qos_policing.json",method:"get_qos_policing",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),n=m.post({url:resource_base+"data/interfaces_qos.json",method:"get_qos_wan_bandwidth",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),k=m.post({url:resource_base+"data/qos_class.json",method:"get_qos_class",error:function(a){Log(ERROR,
"AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,n,k]).then(function(b){for(var c=0;c<b.length;c++)angular.extend(a.model,b[c].data.result);l();a.schema=a.schema||{};a.schema.qos_queuing_type_choice=["priority","rate-control","low-latency"];a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.gridQOS_WAN2LAN._tbl_ref=a.$eval(a.gridQOS_WAN2LAN.Options.data);a.gridQOS_WAN2LAN._tbl_orig=a.$eval(a.gridQOS_WAN2LAN.Options.data.replace("model[","model_orig["));a.gridQOS_WAN2LAN._del_ref=
a.$eval(a.gridQOS_WAN2LAN.Options.data.replace("model[","model_del["));a.gridQOS_WAN2LAN._del_ref.splice(0);delete a.model_del.interfaces;delete a.model_del.classifiers;a.gridQOS_WAN2LAN.edit=!1;a.gridQOS_WAN2LAN.Selections.splice(0);a.gridQOS_WAN2LAN.edit=!0;a.dataReady=!0;t(function(){a.gridQOS_WAN2LAN.Options.selectItem(0,!0)},50)})["catch"](function(a){Log(ERROR,"=="+a)})};n();var l=function(){a.model["ciscosb-qos"]||angular.extend(a.model,{"ciscosb-qos":{"queue-model":"priority","policer-enable":!1,
"policer-policies":{"policer-policy":[]}}});a.model["ciscosb-qos"]&&!a.model["ciscosb-qos"]["policer-policies"]&&angular.extend(a.model["ciscosb-qos"],{"policer-policies":{"policer-policy":[]}});angular.forEach(a.model["ciscosb-qos"]["policer-policies"]["policer-policy"],function(a,b){a.policer||(a.policer={"class":[]})})},r=function(a,b,e){return a.name.match(/^Default$/)?!1:!0};a.collect_classifiers=function(){return u("filter")(a.model.classifiers.classifier,r)};a.selectionRefExists=function(){var b;
angular.forEach(a.gridQOS_WAN2LAN.Selections,function(a,e){a._ctx&&0<a._ctx.ref.length&&(b=!0)});return b};a.findInboundWAN=function(b,e){var k=[];a.ctx=a.ctx||{};angular.forEach(a.model.interfaces["interface"],function(a,c){a["ciscosb-qos"]&&a["ciscosb-qos"]["qos-policy"].inbound["rate-control"]==b&&k.push(a.name);e&&e.entity&&(e.entity._ctx={ref:k})});e&&(e.ctx=e.ctx||{},e.ctx.arrWAN=k);return k};a.gen_class_id_seq=function(a){var b=[0,1,2,3,4,5,6,7],e=[],d=b.length;if(a)for(var c=a.length;c--;)if(a[c]){var h=
parseInt(a[c].id-1,10);e[h]=b.splice(c,1)[0]}for(c=d;c--;)null==e[c]&&(e[c]=b.pop());return e};a.renew_array_class=function(a,b,e){var d=b[e].match;angular.forEach(b,function(a,b){b!=e&&a.match==d&&(a.match="")})};a.update_class_id=function(a,b){var e=angular.copy(b),d;for(d in b)"id"!=d&&delete b[d];b.id=a+1;angular.extend(b,e)};a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridQOS_WAN2LAN=a.gridQOS_WAN2LAN||{};a.gridQOS_WAN2LAN.totalServerItems=0;a.gridQOS_WAN2LAN.Selections=[];a.gridQOS_WAN2LAN.Options=
{data:"model['ciscosb-qos']['policer-policies']['policer-policy']",enableColumnResize:!0,enableRowSelection:!0,keepLastSelected:!1,multiSelect:!1,selectedItems:a.gridQOS_WAN2LAN.Selections,showSelectionCheckbox:!0,enableSorting:!1,enableHighlighting:!0,selectWithCheckboxOnly:!1,totalServerItems:"gridQOS_WAN2LAN.totalServerItems",enableCellEditOnFocus:!1,checkboxHeaderTemplate:w.get("T_checkboxHeader.html"),columnDefs:[{field:"name",displayName:a.DICT("WAN_Queuing_Name")},{field:"description",displayName:a.DICT("WAN_Queuing_Description")},
{field:"name",displayName:a.DICT("WAN_Queuing_Applied_To"),cellTemplate:w.get("T_applied_to.htm")}]};a.gridQOS_WAN2LAN.add_empty_cb=function(a){var b={name:"Untitle",description:"Description","class":[]};a.push(b);return b};a.gridQOS_WAN2LAN.post_remove_cb=function(b){var e=a.gridQOS_WAN2LAN._del_ref;b=e.indexOf(b);for(var k in e[b])"name"!=k&&delete e[b][k]};a.save=function(){var b=function(a,b,c){void 0===c&&(c=!0);a=angular.copy(a);angular.forEach(a,function(a,c){void 0!=a._ctx&&delete a._ctx;
b&&b(a,c)});return a}(a.model["ciscosb-qos"]["policer-policies"]["policer-policy"],function(a,b){if(a.policer&&a.policer["class"])for(var c=a.policer["class"],h=0;h<c.length;h++){var g=c[h];if(null==g.match||void 0==g.match)g.match="",Log(DEBUG,"priority "+JSON.stringify(g.match))}});angular.copy(a.model_del["ciscosb-qos"]["policer-policies"]["policer-policy"]);var e=function(){m.post({url:resource_base+"data/qos_policing.json",method:"set_qos_policing",params:{"ciscosb-qos":{"policer-enable":a.model["ciscosb-qos"]["policer-enable"],
"policer-policies":{"policer-policy":b}}},success:function(b){a.success=!0;n()},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})};(function(){m.post({url:resource_base+"data/qos_policing.json",method:"del_qos_policing",params:{"ciscosb-qos":{"policer-policies":{"policer-policy":[]}}},success:function(a){e()},error:function(a){e();Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})})();a.resetModified()};a.cancel=function(){n();a.resetModified()}}]);app.controller("switchQueuingCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,t,m){a.success=!1;a.dataReady=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var w=function(){a.LANStyle={height:20,"margin-bottom":0};a.LAGStyle={height:20,"margin-bottom":0};b.post({url:resource_base+"data/wan_setting1.json",method:"get_qos_switch_classification",success:function(b){b.data&&b.data.result?u(b.data.result):u();a.dataReady=!0},error:function(a){u()}})},
u=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var m,e,x,n,l=[];a.model.lags=[];a.model.lans=[];angular.forEach(b,function(b,v){if(-1===b.name.indexOf("WAN")){if(-1!==b.name.indexOf("LAN")&&(m=parseInt(b.name.replace("LAN",""),10),isNaN(m))||-1!==b.name.indexOf("LAG")&&(m=parseInt(b.name.replace("LAG",""),10),isNaN(m)))return;e=b["ciscosb-switch-qos"]||{};x=e["queue-weight"]&&e["queue-weight"].queue||[];n={th:m,name:b.name,lag_ref:b["lag-ref"]||b.name,send_to_queue:b["send-to-queue"]||
1,edit:!0,weight1:1,weight2:2,weight3:4,weight4:8};angular.forEach(x,function(a,b){5>a.id&&0<a.id&&(n["weight"+a.id]=a.weight)});-1!==b.name.indexOf("LAN")&&(-1!==n.lag_ref.indexOf("LAG")&&(l.push(n.lag_ref),n.edit=!1),a.LANStyle.height+=app.ngGrid.rowHeight,a.model.lans[m-1]=n);-1!==b.name.indexOf("LAG")&&(a.LAGStyle.height+=app.ngGrid.rowHeight,a.model.lags[m-1]=n)}});angular.forEach(a.model.lags,function(a){a.edit=!1;angular.forEach(l,function(b){a.name===b&&(a.edit=!0)})});a.gridLanOptions.data=
a.model.lans;a.gridLagOptions.data=a.model.lags};a.model={lans:[],lags:[]};a.LANStyle={height:20,"margin-bottom":0};a.LAGStyle={height:20,"margin-bottom":0};a.LANChkInvalid=!1;a.LAGChkInvalid=!1;a.lanErrorMsg="";a.lagErrorMsg="";a.gridLanOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"th",displayName:a.DICT("Switch_Queuing_LAN_Port"),width:100},{field:"weight1",displayName:a.DICT("Switch_Queuing_Queue1_Weight"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,
max:100,required:!0},{field:"weight2",displayName:a.DICT("Switch_Queuing_Queue2_Weight"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0},{field:"weight3",displayName:a.DICT("Switch_Queuing_Queue3_Weight"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0},{field:"weight4",displayName:a.DICT("Switch_Queuing_Queue4_Weight"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0}]});
a.gridLagOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"th",displayName:a.DICT("Switch_Queuing_LAG_Port"),width:100},{field:"weight1",displayName:a.DICT("Switch_Queuing_Queue1_Weight_G"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0},{field:"weight2",displayName:a.DICT("Switch_Queuing_Queue2_Weight_G"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0},{field:"weight3",displayName:a.DICT("Switch_Queuing_Queue3_Weight_G"),
editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0},{field:"weight4",displayName:a.DICT("Switch_Queuing_Queue4_Weight_G"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0}]});a.funs={checkWeight:function(){a.lanErrorMsg="";a.LANChkInvalid=!1;angular.forEach(a.model.lans,function(b,m){var e;e=0+(0==b.weight1?1:0);e+=0==b.weight2?1:0;e+=0==b.weight3?1:0;e+=0==b.weight4?1:0;1<e&&(a.lanErrorMsg=a.DICT("Switch_Queuing_LAN_Error"),
a.LANChkInvalid=!0)});a.lagErrorMsg="";a.LAGChkInvalid=!1;angular.forEach(a.model.lags,function(b,m){var e;e=0+(0==b.weight1?1:0);e+=0==b.weight2?1:0;e+=0==b.weight3?1:0;e+=0==b.weight4?1:0;1<e&&(a.lagErrorMsg=a.DICT("Switch_Queuing_LAG_Error"),a.LAGChkInvalid=!0)})},save:function(){var m={interfaces:{"interface":[]}};angular.forEach(a.model.lans,function(a,b){m.interfaces["interface"].push({name:a.name,"ciscosb-switch-qos":{"queue-weight":{queue:[{id:1,weight:a.weight1},{id:2,weight:a.weight2},{id:3,
weight:a.weight3},{id:4,weight:a.weight4}]}}})});angular.forEach(a.model.lags,function(a,b){m.interfaces["interface"].push({name:a.name,"ciscosb-switch-qos":{"queue-weight":{queue:[{id:1,weight:a.weight1},{id:2,weight:a.weight2},{id:3,weight:a.weight3},{id:4,weight:a.weight4}]}}})});b.post({method:"set_qos_switch_classification",params:m,success:function(b){a.success=!0;w()},error:function(a){w()}});a.resetModified()},cancel:function(){w();a.resetModified()},restore:function(){angular.forEach(a.model.lans,
function(a,b){a.weight1=1;a.weight2=2;a.weight3=4;a.weight4=8});angular.forEach(a.model.lags,function(a,b){a.weight1=1;a.weight2=2;a.weight3=4;a.weight4=8});a.LANChkInvalid=!1;a.LAGChkInvalid=!1;a.modified()}};w()}]);app.controller("qos_queuing_main",["$scope","$q","MyHttp","GridRowBasedEditingAdv","$templateCache","$filter","wan_service","Sets","UserSession","userAccessRight",function(a,b,t,m,w,u,p,q,e,x){a.model=a.model||{};a.filterWANPHY={physical:!0,usb:!0};a.success=!1;a.dataReady=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=x.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();var n=function(){var e=t.post({url:resource_base+"data/qos_lan2wan.json",method:"get_qos_queuing",error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}}),d=t.post({url:resource_base+"data/interfaces_qos.json",method:"get_qos_wan_bandwidth",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),c=t.post({url:resource_base+"data/qos_class.json",method:"get_qos_class",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,d,c]).then(function(b){for(var c=0;c<b.length;c++)angular.extend(a.model,b[c].data.result);l();r();a.model_orig=angular.copy(a.model);
a.model_del=angular.copy(a.model);a.gridQOS_LAN2WAN._tbl_ref=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"];a.gridQOS_LAN2WAN._tbl_orig=a.model_orig["ciscosb-qos"]["queue-policies"]["queue-policy"];a.gridQOS_LAN2WAN._del_ref=a.model_del["ciscosb-qos"]["queue-policies"]["queue-policy"];a.gridQOS_LAN2WAN._del_ref.splice(0);delete a.model_del.interfaces;delete a.model_del.classifiers;a.gridQOS_LAN2WAN.edit=!1;a.gridQOS_LAN2WAN.Selections=[];a.gridQOS_LAN2WAN.operations=m;a.gridQOS_LAN2WAN.operations.init({rowState:a.selected.rowEditableState,
tbl_ref:a.gridQOS_LAN2WAN._tbl_ref,tbl_orig:a.gridQOS_LAN2WAN._tbl_orig,del_ref:a.gridQOS_LAN2WAN._del_ref,gridopt_ref:a.gridQOS_LAN2WAN.Options});a.refresh_grid_display_type(a.model["ciscosb-qos"]["queue-model"]);a.gridQOS_LAN2WAN.Options.data=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"];a.dataReady=!0})["catch"](function(a){console.log("=="+a)})},l=function(){a.model["ciscosb-qos"]||angular.extend(a.model,{"ciscosb-qos":{"queue-model":"priority","policer-enable":!1,"queue-policies":{"queue-policy":[]}}});
a.model["ciscosb-qos"]&&!a.model["ciscosb-qos"]["queue-policies"]&&angular.extend(a.model["ciscosb-qos"],{"queue-policies":{"queue-policy":[]}});angular.forEach(a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],function(a,b){a.queues||(a.queues={});a.radio=!1});var b=p.filter(a.model.interfaces["interface"],a.filterWANPHY);a.model.interfaces["interface"]=b;var d={"ciscosb-qos":{"qos-policy":{outbound:{priority:"Priority_Default","rate-control":"Rate_Control_Default","low-latency":"Low_Latency_Default"}}}};
angular.forEach(b,function(a,b){q.recover_object(a,d)})},r=function(){angular.forEach(a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],function(a,b){a.type="No data";angular.forEach(a.queues,function(b,d){switch(d){case "priority":case "low-latency":case "rate-control":a.type=d}})})};a.queuing_type_page_name=function(a){var b="";"priority"===a?b="Queuing-priority.htm":"rate-control"===a?b="Queuing-rate-control.htm":"low-latency"===a?b="Queuing-low-latency.htm":Log(ERROR,"queuing_type_page_name: unknown type - "+
a);return b};a.refresh_grid_display_type=function(b){a.gridQOS_LAN2WAN.Options.gridApi.core.notifyDataChange("all")};a.update_rule_choice_type=function(b){a.gridQOS_LAN2WAN.Selections=[];a.gridQOS_LAN2WAN.edit=!1;a.gridQOS_LAN2WAN.Options.gridApi.customApi.selectedRowRadio(-1);setTimeout(function(){a.refresh_grid_display_type(b);app.TOOLS.apply(a)},50)};a.selectionReservedName=function(){var b=a.gridQOS_LAN2WAN.Selections,d=!1;a.isDefaultRule=!1;angular.forEach(b,function(b,h){if(b.name.match(/^Priority_Default$/)||
b.name.match(/^Rate_Control_Default$/)||b.name.match(/^Low_Latency_Default$/))d=a.isDefaultRule=!0});return d};a.selectionRefExists=function(){var b;angular.forEach(a.gridQOS_LAN2WAN.Selections,function(a,c){a._ctx&&a._ctx.beUsed&&(b=!0)});return b};a.findOutboundWAN=function(b,d){var c=[];a.ctx=a.ctx||{};var h=a.model["ciscosb-qos"]["queue-model"];angular.forEach(a.model.interfaces["interface"],function(a,e){a["ciscosb-qos"]&&a["ciscosb-qos"]["qos-policy"].outbound[h]==b&&c.push(a.name);d&&d.entity&&
(d.entity._ctx={ref:c,beUsed:0!==c.length})});d&&(d.ctx=d.ctx||{},d.ctx.arrWAN=c);0===c.length&&c.push("--None--");return c};a.gen_rate_id_seq=function(a){var b=[0,1,2,3,4,5,6,7],c=[],h=b.length,g;if(a)for(g=a.length;g--;)if(a[g]){var e=parseInt(a[g].id-1,10);c[e]=b.splice(g,1)[0]}for(g=h;g--;)null==c[g]&&(c[g]=b.pop());return c};var v=function(a,b,c){return!0};a.collect_classifiers=function(){return u("filter")(a.model.classifiers.classifier,v)};a.check_minimum_maximum=function(b,d){var c=function(c){a.form.rate_form&&
(a.form.rate_form["RC_txt_minrate_"+b].$setValidity("minLargeThanMax",c),a.form.rate_form["RC_txt_maxrate_"+b].$setValidity("minLargeThanMax",c))};d["min-rate"]>d["max-rate"]?c(!1):c(!0)};a.update_rate_control_item=function(b,d,c){a.update_rate_control_id(b,d[c]);a.renew_array_class(b,d,c);a.update_min_rate_accu(b,d);a.check_minimum_maximum(b,d[c])};a.update_rate_control_id=function(b,d){var c=angular.copy(d),h;for(h in d)"id"!=h&&delete d[h];d.id=b+1;angular.extend(d,c);a.check_minimum_maximum(b,
d)};a.renew_array_class=function(a,b,c){var h=b[c].match;angular.forEach(b,function(a,b){b!=c&&a.match==h&&(a.match="")})};a.update_min_rate_accu=function(a,b){for(var c,h=0,g=0;6>=g;g++)c=b[g],h+=c["min-rate"];b[7]["min-rate"]=100-h};a.renew_objects_class=function(a,b){var c=a[b],h;for(h in a)h!=b&&a[h]==c&&(a[h]="")};a.update_ll_min_rate_accu=function(a){var b;b=0+a.queue1["min-rate"];b+=a.queue2["min-rate"];a.queue3["min-rate"]=100-b};a.renew_ll_class=function(a,b){var c=a[b].match,h;for(h in a)h!=
b&&a[h].match==c&&(a[h].match="")};a.filterRowsByType=function(b){var d=a.model["ciscosb-qos"]&&a.model["ciscosb-qos"]["queue-model"]||"priority",c=[];angular.forEach(b,function(a){a.entity.type===d&&c.push(a)});return c};a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridQOS_LAN2WAN=a.gridQOS_LAN2WAN||{};a.gridQOS_LAN2WAN.Selections=[];a.gridQOS_LAN2WAN.procClick=function(b){var d=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"];a.gridQOS_LAN2WAN.Selections=[];d[b]&&a.gridQOS_LAN2WAN.Selections.push(d[b]);
a.selectionReservedName();app.TOOLS.apply(a)};a.gridQOS_LAN2WAN.Options=app.uiGrid.generateGridOptions({filterOptions:{filterText:"_NoTranslate_Type:^priority"},onRegisterApi:function(b){a.gridQOS_LAN2WAN.Options.gridApi.core.registerRowsProcessor(a.filterRowsByType,200)},columnDefs:[{field:"radio",isRadio:!0,changedCbk:a.gridQOS_LAN2WAN.procClick},{field:"name",displayName:a.DICT("WAN_Queuing_Policy_Name")},{field:"description",displayName:a.DICT("WAN_Queuing_Description")},{field:"type",displayName:"_NoTranslate_Type",
visible:!1},{field:"name",displayName:a.DICT("WAN_Queuing_Applied_To"),cellTemplate:w.get("UG_applied_to.htm")}]});a.gridQOS_LAN2WAN.editFun=function(){a.gridQOS_LAN2WAN.edit=!a.gridQOS_LAN2WAN.edit};var s=function(b){b=a.model["ciscosb-qos"]["queue-model"]||"priority";return{name:a.schema.namePrefix[b]+"Untitle",description:"Description",queues:{"rate-control":{queue:[{id:1,match:"","min-rate":20,"max-rate":50},{id:2,match:"","min-rate":20,"max-rate":50},{id:3,match:"","min-rate":20,"max-rate":50},
{id:4,match:"","min-rate":10,"max-rate":50},{id:5,match:"","min-rate":10,"max-rate":50},{id:6,match:"","min-rate":10,"max-rate":50},{id:7,match:"","min-rate":9,"max-rate":50},{id:8,match:"Default","min-rate":1,"max-rate":100}]},"low-latency":{priority:{match:"","max-rate":50},queue1:{match:"","min-rate":50},queue2:{match:"","min-rate":30},queue3:{match:"Default","min-rate":20}},priority:{highest:"",high:"",medium:"",low:"Default"}},type:b}};a.gridQOS_LAN2WAN.add=function(){var b=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],
d;d=s(a.model["ciscosb-qos"]["queue-model"]);50<b.length?(d=a.DICT("WAN_Queuing_Reach_Max_Entry",{"%d":50}),app.TOOLS.criticalAlertBox({msg:d,cbk:function(a){}})):(b.push(d),setTimeout(function(){a.gridQOS_LAN2WAN.Options.gridApi.customApi.selectedRowRadio(b.length-1);a.gridQOS_LAN2WAN.Options.gridApi.customApi.scrollToLast();a.gridQOS_LAN2WAN.Selections=[b[b.length-1]];a.gridQOS_LAN2WAN.edit=!0},50),a.modified())};a.gridQOS_LAN2WAN.remove=function(b){b=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"];
var d;for(d=b.length-1;0<=d;d--)console.log(b[d]),b[d].radio&&b.splice(d,1);a.gridQOS_LAN2WAN.edit=!1;a.gridQOS_LAN2WAN.Selections=[];a.gridQOS_LAN2WAN.Options.gridApi.customApi.selectedRowRadio(-1);a.modified()};a.save=function(){var b=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],d=a.model_orig["ciscosb-qos"]["queue-policies"]["queue-policy"],c=function(b,c){if(b.queues&&b.queues["rate-control"]){var d=!0,g=[];angular.forEach(b.queues["rate-control"].queue,function(c,h){null==c&&g.push(h);
if(c&&null==c.match){var e;a:{e=a.gridQOS_LAN2WAN._del_ref;for(var k=e.length;k--;)if(e[k].name==b.name){e=k;break a}e=-1}-1==e?e=a.gridQOS_LAN2WAN._del_ref.push({name:b.name,queues:{"rate-control":{queue:[]}}})-1:d&&a.gridQOS_LAN2WAN._del_ref[e].queues["rate-control"].queue.splice(0);a.gridQOS_LAN2WAN._del_ref[e].queues["rate-control"].queue.push({id:c.id});d=!1;c.match="";g.push(h)}})}},h=function(a,b){var c=function(a,b){if(null==a[b]||void 0==a[b])a[b]=""};if(a.queues&&a.queues.priority){var d=
a.queues.priority;c(d,"highest");c(d,"high");c(d,"medium");c(d,"low")}},g=function(a,b,c){void 0===c&&(c=!0);a=angular.copy(a);angular.forEach(a,function(a,d){if(a.type&&a.queues){var g=a.type,h;for(h in a.queues)h!=g&&delete a.queues[h]}else c&&(a.type||alert("clean_web_metadata error, 'type' not exist"),a.queues||alert("clean_web_metadata error, 'queues' not exist"));void 0!=a.type&&delete a.type;void 0!=a._ctx&&delete a._ctx;delete a.radio;b&&b(a,d)});return a}(a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],
function(a,b){h(a,b);c(a,b);if(a.queues&&a.queues["low-latency"]){var d=a.queues["low-latency"];if(null==d.priority.match||""==d.priority.match)d.priority.match="";if(null==d.queue1.match||""==d.queue1.match)d.queue1.match="";if(null==d.queue2.match||""==d.queue2.match)d.queue2.match="";if(null==d.queue3.match||""==d.queue3.match)d.queue3.match=""}}),e=angular.copy(p.filter(a.model.interfaces["interface"],a.filterWANPHY)),l=[];angular.forEach(e,function(a,b){var c={},c={name:a.name};a["ciscosb-qos"]&&
a["ciscosb-qos"]["qos-policy"]&&(c["ciscosb-qos"]={"qos-policy":a["ciscosb-qos"]["qos-policy"]});l.push(c)});var r=function(){t.post({url:resource_base+"data/qos_lan2wan.json",method:"set_qos_queuing",params:{"ciscosb-qos":{"queue-model":a.model["ciscosb-qos"]["queue-model"],"queue-policies":{"queue-policy":g}},interfaces:{"interface":l}},success:function(b){a.success=!0;n()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})};(function(){var a=[],c;angular.forEach(d,
function(d){c=!1;angular.forEach(b,function(a){a.name===d.name&&(c=!0)});c||a.push({name:d.name})});a.length?t.post({url:resource_base+"data/qos_lan2wan.json",method:"del_qos_queuing",params:{"ciscosb-qos":{"queue-policies":{"queue-policy":a}}},success:function(a){r()},error:function(a){r();console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}):r()})();a.resetModified()};a.cancel=function(){n();a.resetModified()};a.combineNote=a.DICT("WAN_Bandwidth_Management_Go_To",{"%s":"<a ng-click=\"jumpToPage('QoS_WAN_Bandwidth')\">"+
a.DICT("WAN_Bandwidth_Management")+"</a>"});(function(){a.schema=a.schema||{};a.schema.namePrefix={priority:"Priority_","rate-control":"Rate_Control_","low-latency":"Low_Latency_"};a.schema.qos_queuing_type_choice=["priority","rate-control","low-latency"];a.schema.unmatchStr=a.DICT("WAN_Queuing_Unspecified");a.schema.strLUT={priority:a.DICT("WAN_Queuing_Priority"),"rate-control":a.DICT("WAN_Queuing_Rate_Control"),"low-latency":a.DICT("WAN_Queuing_Low_Latency"),queue1:a.DICT("WAN_Queuing_Queue1"),
queue2:a.DICT("WAN_Queuing_Queue2"),queue3:a.DICT("WAN_Queuing_Queue3"),highest:a.DICT("WAN_Queuing_Highest"),high:a.DICT("WAN_Queuing_High"),medium:a.DICT("WAN_Queuing_Medium"),low:a.DICT("WAN_Queuing_Low")};a.schema.dispStr=function(b){return a.schema.strLUT[b]}})();n()}]);app.controller("switchClassificationCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,t,m){var w=void 0;a.success=!1;a.loadReady=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var u=[{id:1,displayName:1},{id:2,displayName:2},{id:3,displayName:3},{id:4,displayName:4}],p=function(){b.post({url:resource_base+"data/switch_qos.json",method:"get_qos_switch_classification",success:function(b){b.data&&b.data.result?(e(b.data.result),q(b.data.result)):
(console.log("switchClassificationCtrl getQosData response is undefined"),e(),q());a.lagStyle=app.uiGrid.computeHeight(void 0==a.model.lag?0:a.model.lag.length);a.loadReady=!0},error:function(a){console.log("switchClassificationCtrl getQosData error, status "+a.status);e();q()}})},q=function(b){b||(b={});var e=b["switch-qos-policy"]||{};b=e["dscp-mapping"]||[];var l=e["cos-mapping"]||[],e=e.model||"port",k,d,c,h;a.model.cos=[];a.model.dscp=[];a.model.qos_model=e;x();n();angular.forEach(b,function(b,
e){k=parseInt(b.dscp,10);d=parseInt(b.queue,10);isNaN(k)?console.log("switchClassificationCtrl process DSCP item "+e+"th has error Item: "+JSON.stringify(b)):63<k||0>k?console.log("switchClassificationCtrl process DSCP item "+e+'th has error dscp: "'+k+'", range (0 ~ 64)'):4<d||1>d?console.log("switchClassificationCtrl process DSCP itme "+e+'th has error queue: "'+d+'", range (1 ~ 4)'):(c=k%16,h=(k-c)/16,a.model.dscp[c].list[h].queue.select=d,b["dscp-name"]&&(a.model.dscp[c].list[h].name=k+" - "+
b["dscp-name"]))});angular.forEach(l,function(b,c){k=parseInt(b.cos,10);d=parseInt(b.queue,10);isNaN(k)?console.log("switchClassificationCtrl process COS item "+c+"th has error Item: "+JSON.stringify(b)):7<k||0>k?console.log("switchClassificationCtrl process COS item "+c+'th has error cos: "'+k+'", range (0 ~ 7)'):4<d||1>d?console.log("switchClassificationCtrl process COS itme "+c+'th has error queue: "'+d+'", range (1 ~ 4)'):(a.model.cos[k].queue.select=d,b["cos-name"]&&(a.model.cos[k].name=b["cos-name"]))});
a.gridCosOptions.data=a.model.cos;a.gridDSCPOptions.data=a.model.dscp;a.dataReady.qos=!0},e=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var e,l,k,d=[],c=!1;a.lanStyle={height:20};a.lagStyle={height:20};a.model.lan=[];a.model.lag=[];angular.forEach(b,function(b,g){k=!0;if(-1===b.name.indexOf("VLAN"))if(e=b["ciscosb-switch-qos"]&&b["ciscosb-switch-qos"]["send-to-queue"]||1,e=parseInt(e,10),isNaN(e))console.log("switchClassificationCtrl proc interface "+b.name+" has error, queue is NaN");
else if(4<e||1>e)console.log("switchClassificationCtrl proc interface "+b.name+' has error queue: "'+e+'", range (1 ~ 4)');else{if(-1!==b.name.indexOf("LAN")){l=parseInt(b.name.replace("LAN",""),10);if(isNaN(l)){console.log("switchClassificationCtrl proc LAN "+b.name+" port number is NaN");return}b["lag-ref"]&&b["lag-ref"].match(/^LAG\d+$/)&&(k=!1,d.push(b["lag-ref"]),c=!0);a.lanStyle.height+=app.uiGrid.rowHeight;a.model.lan[l-1]={name:b.name,th:l,empty:"",edit:k,disabled:c,queue:{select:e,list:u}}}-1!==
b.name.indexOf("LAG")&&(l=parseInt(b.name.replace("LAG",""),10),isNaN(l)?console.log("switchClassificationCtrl proc LAG "+b.name+" port number is NaN"):(a.lagStyle.height+=app.uiGrid.rowHeight,a.model.lag[l-1]={name:b.name,th:l,empty:"",edit:!1,queue:{select:e,list:u}}))}});angular.forEach(a.model.lag,function(a){angular.forEach(d,function(b){a.name===b&&(a.edit=!0)})});a.gridLanPortOptions.data=a.model.lan;a.gridLagPortOptions.data=a.model.lag;a.dataReady.intf=!0},x=function(){var b,e,l;for(b=0;64>
b;b++)e=b%16,l=(b-e)/16,a.model.dscp[e]||(a.model.dscp[e]={edit:!0,list:{}}),a.model.dscp[e].list[l]||(a.model.dscp[e].list[l]={dscp:b,name:b,queue:{select:0,list:u}}),a.model.dscp[e].list[l].queue.select=16>b?1:16<=b&&24>b?2:24<=b&&40>b?3:40<=b&&48>b?4:3},n=function(){var b;for(b=0;8>b;b++)switch(a.model.cos[b]||(a.model.cos[b]={cos:b,name:b,edit:!0,queue:{select:0,list:u}}),b){case 0:case 1:a.model.cos[b].queue.select=1;break;case 2:a.model.cos[b].queue.select=2;break;case 3:case 4:a.model.cos[b].queue.select=
3;break;default:a.model.cos[b].queue.select=4}},l=function(){a.model.resize_event=!0;setTimeout(function(){a.model.resize_event=!1;app.TOOLS.apply(a)},10)};a.model={resize_event:!1,qos_model:"port",lan:[],lag:[],cos:[],dscp:[]};a.dataReady={qos:!1,intf:!1};a.gridLanPortOptions=app.uiGrid.generateGridOptions({enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,columnDefs:[{field:"th",displayName:a.DICT("Switch_Classification_LAN_Port"),minWidth:100},{field:"queue",displayName:a.DICT("Switch_Classification_Queue"),
minWidth:80,disabled:"disabled",editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"empty",isEmpty:!0,displayName:""}]});a.lagStyle={};a.gridLagPortOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"th",displayName:a.DICT("Switch_Classification_LAG_Port"),minWidth:100},{field:"queue",displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"empty",isEmpty:!0,displayName:""}]});
a.gridDSCPOptions=app.uiGrid.generateGridOptions({minRowsToShow:16,enableHorizontalScrollbar:app.uiGrid.scrollbars.NEVER,enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,columnDefs:[{field:"list[0].name",displayName:a.DICT("Switch_Classification_DSCP"),minWidth:120},{field:"list[0].queue",displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"list[1].name",displayName:a.DICT("Switch_Classification_DSCP"),minWidth:120},
{field:"list[1].queue",displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"list[2].name",displayName:a.DICT("Switch_Classification_DSCP"),minWidth:120},{field:"list[2].queue",displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"list[3].name",displayName:a.DICT("Switch_Classification_DSCP"),minWidth:120},{field:"list[3].queue",
displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"}]});a.gridCosOptions=app.uiGrid.generateGridOptions({enableHorizontalScrollbar:app.uiGrid.scrollbars.NEVER,columnDefs:[{field:"cos",displayName:a.DICT("Switch_Classification_CoS"),minWidth:100},{field:"name",displayName:a.DICT("Switch_Classification_Description")},{field:"queue",displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"}]});
a.funs={save:function(){var e={"switch-qos-policy":{model:a.model.qos_model,"dscp-mapping":[],"cos-mapping":[]}},l={interfaces:{"interface":[]}};angular.forEach(a.model.lan,function(a,b){l.interfaces["interface"].push({name:a.name,"ciscosb-switch-qos":{"send-to-queue":a.queue.select}})});angular.forEach(a.model.lag,function(a,b){l.interfaces["interface"].push({name:a.name,"ciscosb-switch-qos":{"send-to-queue":a.queue.select}})});angular.forEach(a.model.cos,function(a,b){e["switch-qos-policy"]["cos-mapping"][a.cos]=
{cos:a.cos,queue:a.queue.select}});angular.forEach(a.model.dscp,function(a,b){angular.forEach(a.list,function(a,b){e["switch-qos-policy"]["dscp-mapping"][a.dscp]={dscp:a.dscp,queue:a.queue.select}})});angular.extend(e,l);b.post({method:"set_qos_switch_classification",params:e,success:function(b){a.success=!0;p()},error:function(a){p()}});a.resetModified()},cancel:function(){p();a.resetModified()},restore_def:function(){x();a.modified()}};a.lanStyle={height:20};a.lagStyle={height:20};w=a.$watch(function(){return window.innerWidth},
function(){l()});a.$on("$destroy",function(){w&&w()});p()}]);app.controller("trafficClassesCtrl",["$scope","MyHttp","wan_service","meta_data_service","$q","$templateCache","UserSession","userAccessRight","device_os_type",function(a,b,t,m,w,u,p,q,e){a.success=!1;a.dataReady=!1;var x=a.gridFuns.getSelectDisplayNameFromList;a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&p.logout();var n=function(){return b.post({url:resource_base+"data/traffic_classes.json",method:"get_qos_class",error:function(a){console.log("Traffic Classes: get_qos_class error : "+
status);l()}})},l=function(b){b||(b={});b=(b.classifiers||{}).classifier||[];a.model.classes=[];angular.forEach(b,function(b,c){a.model.classes.push(r(b))});a.gridTrafficClassesOptions.data=a.model.classes},r=function(b){b||(b={});var c,d,g;c=b.rule||[];d=[];angular.forEach(c,function(b,c){g=v(b);a.prepareApp(g);d.push(g)});return{edit:!1,radio:!1,name:b.name||"",description:b.description||"",rule:d,in_use:!1,displayInUse:a.DICT("Traffic_Classes_No")}},v=function(b){b||(b={});var c=b.address||{},
d=b.service||{},g=b.application||{},h=b.dscp||{},e,k;b={name:b.name||"",invalidName:!1,checked:!1,edit:!1,disableCheckbox:!1,receive_intf:{select:b["receive-interface"]||a.model.ifs&&a.model.ifs[0]&&a.model.ifs[0].id||"",list:a.model.ifs},version:{select:b["ip-version"]||a.schema.version[0].id,list:a.schema.version},device_type:{select:b["device-type"]||a.model.devicetypes[0]&&a.model.devicetypes[0].id||"",list:a.model.devicetypes,disabled:!1},os_type:{select:b["os-type"]||"",list:[],disabled:!1},
address:{src:{ipv4:{ip:"0.0.0.0",mask:"0.0.0.0",desc_ip:"0.0.0.0 for any",desc_mask:"0.0.0.0 for any"},ipv6:{ip:"0::",mask:0,desc_ip:"0:: for any",desc_mask:"0 for any"}},dest:{ipv4:{ip:"0.0.0.0",mask:"0.0.0.0",desc_ip:"0.0.0.0 for any",desc_mask:"0.0.0.0 for any"},ipv6:{ip:"0::",mask:0,desc_ip:"0:: for any",desc_mask:"0 for any"}}},service_app:{type:"service",str:"",service_select:a.model.services[0]&&a.model.services[0].id||"",service_list:a.model.services,app_category:"any",app_name:"any",app_behaviour:"any",
apps:[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}],behaviours:[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}],start_port:"",end_port:"",start_port_any:1,end_port_any:65535},dscp:{match:{select:void 0!==h.match?h.match:a.model.dscp_match[0]&&a.model.dscp_match[0].id||"",list:a.model.dscp_match},set:{select:void 0!==h.set?h.set:a.model.dscp_set[0]&&a.model.dscp_set[0].id||"",list:a.model.dscp_set}}};b.os_type.list=a.model.ostypes[b.device_type.select]||[];b.os_type.select||(b.os_type.select=
b.os_type.list[0]&&b.os_type.list[0].id||"");c["ipv4-source"]&&(h=0===c["ipv4-source"]["prefix-length"]?"0.0.0.0":void 0!==c["ipv4-source"]["prefix-length"]?app.TOOLS.netmask.int2Inet(parseInt(c["ipv4-source"]["prefix-length"],10)):c["ipv4-source"].netmask||"",b.address.src.ipv4.ip=c["ipv4-source"].ip||"",b.address.src.ipv4.mask=h);c["ipv4-destination"]&&(h=0===c["ipv4-destination"]["prefix-length"]?"0.0.0.0":void 0!==c["ipv4-destination"]["prefix-length"]?app.TOOLS.netmask.int2Inet(parseInt(c["ipv4-destination"]["prefix-length"],
10)):c["ipv4-destination"].netmask||"",b.address.dest.ipv4.ip=c["ipv4-destination"].ip||"",b.address.dest.ipv4.mask=h);c["ipv6-source"]&&(b.address.src.ipv6.ip="::"===c["ipv6-source"].ip?"0::":c["ipv6-source"].ip||"",b.address.src.ipv6.mask=parseInt(c["ipv6-source"]["prefix-length"],10));c["ipv6-destination"]&&(b.address.dest.ipv6.ip="::"===c["ipv6-destination"].ip?"0::":c["ipv6-destination"].ip||"",b.address.dest.ipv6.mask=parseInt(c["ipv6-destination"]["prefix-length"],10));g.category&&(g.name&&
g.behaviour)&&(b.service_app.type="application",b.service_app.app_category=g.category,b.service_app.app_name=g.name,b.service_app.app_behaviour=g.behaviour);d["service-ref"]&&(b.service_app.service_select=d["service-ref"],b.service_app.type="service");d["port-range"]&&void 0!==d["port-range"].start&&(e=d["port-range"].start,b.service_app.start_port=e);d["port-range"]&&void 0!==d["port-range"].end&&(k=d["port-range"].end,b.service_app.end_port=k);if(d.protocol){switch(d.protocol){case "UDP":b.service_app.service_select=
1===e&&65535===k?"$udpAny":"$udp";break;case "TCP":b.service_app.service_select=1===e&&65535===k?"$tcpAny":"$tcp";break;default:console.log("trafficClassesCtrl procTrafficData protocol not support : "+d.protocol)}b.service_app.type="service"}return b},s=function(){return b.post({url:resource_base+"data/avc_meta_data.json",method:"get_avc",error:function(a){console.log("appControllerCtrl getAVCMetaData error "+a.status);k()}})},k=function(b){b&&b["avc-meta-data"]&&(b=m.generate(b["avc-meta-data"]),
a.model.meta={},angular.forEach(b,function(b){angular.forEach(b.categories,function(b,c){a.model.meta[c]=b})}),a.prepareCategory())},d=function(){return b.post({url:resource_base+"data/application_controller.json",method:"get_app_control",error:function(a){console.log("appControllerCtrl getAVCData error "+a.status);c()}})},c=function(b){b||(b={});b=b.avc||{};a.avcAvailable=!1;b.enable&&(a.avcAvailable=!0)},h=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",
error:function(a){console.log("trafficClassesCtrl getInterfaceData Error : "+a.status)}})},g=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var c=[],d=[],g=[{id:"any",displayName:a.DICT("Traffic_Classes_Any_VLAN")}];a.model.ifs=[];var h=t.filter(b,{physical:!0,subinterface:!0,usb:!0});angular.forEach(h,function(a){c.push({id:a.name,displayName:a.name})});angular.forEach(b,function(a,b){a.name.match(/^VLAN.*\d+$/)&&d.push({id:a.name,displayName:a.name})});a.model.ifs=g.concat(c).concat(d)},
A=function(){return b.post({url:resource_base+"data/service_management.json",method:"get_services",error:function(a){console.log("trafficClassesCtrl getServiceData error: "+a.status);y()}})},y=function(b){b||(b={});var c=[];b.services&&b.services.service&&(c=b.services.service);a.model.services=[{id:"$tcp",displayName:a.DICT("Traffic_Classes_TCP")},{id:"$tcpAny",displayName:a.DICT("Traffic_Classes_TCPAny")},{id:"$udp",displayName:a.DICT("Traffic_Classes_UDP")},{id:"$udpAny",displayName:a.DICT("Traffic_Classes_UDPAny")}];
angular.forEach(c,function(b,c){a.model.services.push({id:b.name,displayName:b.name})});a.model.services.sort(function(a,b){return a.displayName>b.displayName?1:-1})},z=function(){return b.post({url:resource_base+"data/switch_qos.json",method:"get_qos_switch_classification",error:function(a){console.log("trafficClassesCtrl getSwitchQosData error: "+a.status);B()}})},B=function(b){b||(b={});var c=[],d=[];b["switch-qos-policy"]&&b["switch-qos-policy"]["dscp-mapping"]&&(c=b["switch-qos-policy"]["dscp-mapping"]);
a.model.dscp_match=[];a.model.dscp_set=[];angular.forEach(c,function(a){d.push({id:a.dscp,displayName:a["dscp-name"]&&a.dscp+"("+a["dscp-name"]+")"||a.dscp})});a.model.dscp_match=[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}].concat(d);a.model.dscp_set=[{id:"none",displayName:a.DICT("Traffic_Classes_None")}].concat(d)},D=function(){return b.post({url:resource_base+"data/traffic_class_in_use.json",method:"get_classifiers_inuse",error:function(a){E()}})},E=function(b){b||(b={});angular.forEach(b,
function(b,c){angular.forEach(a.model.classes,function(b){c===b.name&&(b.in_use=!0,b.displayInUse=a.DICT("Traffic_Classes_Yes"))})})},C=function(){w.all([h(),n(),D()]).then(function(b){g(b[0].data&&b[0].data.result||{});l(b[1].data&&b[1].data.result||{});E(b[2].data&&b[2].data.result||{});a.resetModified()})};a.relativeWebPage={main:"traffic_classes_main.htm",edit:"traffic_classes_edit.htm"};var I=function(b){switch(b){case "main":a.currPage="main";break;case "edit":a.gridTrafficServiceOptions.data=
a.edit.rule,a.currPage="edit"}};a.currPage="main";a.edit={services:[],rule:[],version:{}};a.classIndex=-1;a.avcAvailable=!1;a.ui_data={selected_rules:[]};a.model={meta:{},categories:[],devicetypes:[],dscp_match:[],dscp_set:[],schema:{},classes:[],dels:[],services:[],ostypes:[]};a.chk_device_os=function(b){if(b){var c=b.entity,d=!0;c.os_type.list=a.model.ostypes[c.device_type.select]||[];angular.forEach(c.os_type.list,function(a){a===c.os_type.select&&(d=!1)});d&&(c.os_type.select=c.os_type.list[0]&&
c.os_type.list[0].id||"")}};var G=function(b){a.ui_data.selected_rules=[];angular.forEach(a.edit.rule,function(b){b.checked&&a.ui_data.selected_rules.push(b)})};a.gridTrafficClassesOptions=app.uiGrid.generateGridOptions({data:a.model.classes,columnDefs:[{field:"radio",changedCbk:function(b){a.classIndex=b},isRadio:!0},{field:"name",displayName:a.DICT("Traffic_Classes_Class_Name")},{field:"description",displayName:a.DICT("Traffic_Classes_Description")},{field:"in_use",displayName:a.DICT("Traffic_Classes_In_Use"),
cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});a.gridTrafficServiceOptions=app.uiGrid.generateGridOptions({rowHeight:2*app.uiGrid.rowHeight,enableHorizontalScrollbar:!0,columnDefs:[{field:"checked",changedCbk:G,headerChangedCbk:G,disableChkBoxField:"disableCheckbox",isCheckbox:!0},{field:"name",displayName:a.DICT("Traffic_Classes_Service_Name"),editRow:"edit",editTextHeight:18,required:!0,width:115,invalidField:"invalidName",change:function(){var b=a.edit.rule;angular.forEach(b,function(a){a.invalidName=
!1});for(i=0;i<b.length;i++)for(j=i+1;j<b.length;j++)b[i].name===b[j].name&&(b[i].invalidName=!0,b[j].invalidName=!0)},cellTemplate:u.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'maxlength="64" ng-uci-name="row.entity.edit === true"')},{field:"receive_intf",displayName:a.DICT("Traffic_Classes_Receive_Interface"),editRow:"edit",width:140,id:"interface",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"version",displayName:a.DICT("Traffic_Classes_IP_Version"),
editRow:"edit",width:100,id:"ip_version",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"address.src",displayName:a.DICT("Traffic_Classes_Source_IP"),editRow:"edit",minWidth:120,cellTemplate:"traffic_classes_service_ip_mask.html"},{field:"address.dest",displayName:a.DICT("Traffic_Classes_Destination_IP"),editRow:"edit",minWidth:120,cellTemplate:"traffic_classes_service_ip_mask.html"},{field:"service_app",displayName:a.DICT("Traffic_Classes_Service_Application"),editRow:"edit",changed:function(b){b&&
b.entity&&(b=b.entity,a.avcAvailable&&("service"===b.service_app.type?(b.os_type.disabled=!0,b.device_type.disabled=!0):(b.os_type.disabled=!1,b.device_type.disabled=!1)))},width:260,cellTemplate:"traffic_classes_service_service_app.html"},{field:"device_type",displayName:a.DICT("Traffic_Classes_Device_Type"),editRow:"edit",width:110,change:a.chk_device_os,id:"device",cellTemplate:u.get("UG_table_text_with_inline_select_edit.html")},{field:"os_type",displayName:a.DICT("Traffic_Classes_OS_Type"),editRow:"edit",
width:110,id:"os",cellTemplate:u.get("UG_table_text_with_inline_select_edit.html")},{field:"dscp.match",displayName:a.DICT("Traffic_Classes_Match_DSCP"),width:115,editRow:"edit",id:"dscp_match",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"dscp.set",displayName:a.DICT("Traffic_Classes_Rewrite_DSCP"),width:120,editRow:"edit",id:"dscp_set",cellTemplate:"UG_table_text_with_inline_select_edit.html"}]});var H=function(){F(-1);C();I("main")};a.getServiceStyle=function(a){var b={};switch(a){case "$udp":case "$tcp":b=
{width:"65px"};break;case "$udpAny":case "$tcpAny":b={width:"85px"};break;default:b={width:"212px"}}return b};a.prepareCategory=function(){a.model.categories=[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}];angular.forEach(a.model.meta,function(b){a.model.categories.push({id:b.id,displayName:b.name})});a.model.categories.sort(function(a,b){return a.displayName>b.displayName?1:-1})};a.prepareApp=function(b){var c=b.service_app.app_category,d=b.service_app.app_name,g=a.model.meta[c];b.service_app.apps=
[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}];"any"===c||!g?b.service_app.app_name="any":(g.applications[d]||(b.service_app.app_name="any"),angular.forEach(g.applications,function(a){b.service_app.apps.push({id:a.id,displayName:a.name})}),b.service_app.apps.sort(function(a,b){return a.displayName>b.displayName?1:-1}));a.prepareBehavior(b)};a.prepareBehavior=function(b){var c=b.service_app.app_category,d=b.service_app.app_name,g=b.service_app.app_behaviour,h=a.model.meta;b.service_app.behaviours=
[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}];"any"===c||"any"===d||!h[c]||!h[c].applications[d]?b.service_app.app_behaviour="any":(h[c].applications[d].behaviors[g]||(b.service_app.app_behaviour="any"),angular.forEach(h[c].applications[d].behaviors,function(a){b.service_app.behaviours.push({id:a.id,displayName:a.name})}),b.service_app.behaviours.sort(function(a,b){return a.displayName>b.displayName?1:-1}))};a.updateRuleString=function(){a.edit&&angular.forEach(a.edit.rule,function(b){if("service"===
b.service_app.type)switch(b.service_app.str=x(b.service_app.service_select,b.service_app.service_list),b.service_app.service_select){case "$tcp":case "$udp":b.service_app.str=b.service_app.str+"("+b.service_app.start_port+"-"+b.service_app.end_port+")";break;case "$tcpAny":case "$udpAny":b.service_app.str=b.service_app.str+"("+b.service_app.start_port_any+"-"+b.service_app.end_port_any+")"}else b.service_app.str=x(b.service_app.app_category,a.model.categories)+" > "+x(b.service_app.app_name,b.service_app.apps)+
" > "+x(b.service_app.app_behaviour,b.service_app.behaviours)})};var F=function(b){a.classIndex=b;a.gridTrafficClassesOptions&&a.gridTrafficClassesOptions.$gridScope&&(a.gridTrafficClassesOptions.$gridScope.columns[0].radioSelect=b)},K=function(){return 21<=a.model.classes.length?(a.msg=a.DICT("Traffic_Classes_Msg")+a.model.classes.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.funs={addClass:function(){K()||(a.edit=r(),a.edit.editType="create",a.edit.editIndex=-1,
a.updateRuleString(),I("edit"),a.modified())},delClass:function(){a.model.dels.push(a.model.classes[a.classIndex]);a.model.classes.splice(a.classIndex,1);a.classIndex>=a.model.classes.length&&F(-1);a.modified()},editClass:function(){a.edit=angular.copy(a.model.classes[a.classIndex]);a.edit.editType="edit";a.edit.editIndex=a.classIndex;a.updateRuleString();I("edit")},addRule:function(){var b=v();a.chk_device_os({entity:b});b.edit=!0;b.checked=!0;b.os_type.disabled=!a.avcAvailable||"service"===b.service_app.type;
b.device_type.disabled=!a.avcAvailable||"service"===b.service_app.type;a.gridTrafficServiceOptions.data.push(b);G();setTimeout(function(){a.gridTrafficServiceOptions.gridApi.customApi.scrollToLast()},100);a.modified()},delRule:function(){var b=a.edit.rule,c;for(c=b.length-1;0<=c;c--)b[c].checked&&a.edit.rule.splice(c,1);a.ui_data.selected_rules=[];a.modified()},editRule:function(){angular.forEach(a.edit.rule,function(b){b.checked&&(b.edit=!0);b.os_type.disabled=!a.avcAvailable||"service"===b.service_app.type;
b.device_type.disabled=!a.avcAvailable||"service"===b.service_app.type})},save:function(){var c=[],d=a.currPage;(function(){var b=[];a.model.dels.length&&angular.forEach(a.model.dels,function(a,c){b.push({name:a.name})});if("edit"===d){var g=a.edit,h;"edit"===g.editType&&(h=a.model.classes[a.edit.editIndex],h.name!==g.name&&b.push({name:h.name}))}b.length&&c.push({method:"del_qos_class",params:{classifiers:{classifier:b}}})})();(function(){if("edit"===d){var b,g=a.edit,h=[],e=[];angular.forEach(g.rule,
function(a,c){b={name:a.name,"ip-version":a.version.select,service:{},application:{category:"",name:"",behaviour:""},"device-type":a.device_type.select,"os-type":a.os_type.select,dscp:{match:a.dscp.match.select,set:a.dscp.set.select}};"any"===a.receive_intf.select?b["any-interface"]=null:b["receive-interface"]=a.receive_intf.select;"ipv4"===a.version.select?b.address={"ipv4-source":{ip:a.address.src.ipv4.ip,"prefix-length":app.TOOLS.netmask.inet2Int(a.address.src.ipv4.mask)},"ipv4-destination":{ip:a.address.dest.ipv4.ip,
"prefix-length":app.TOOLS.netmask.inet2Int(a.address.dest.ipv4.mask)}}:"ipv6"===a.version.select&&(b.address={"ipv6-source":{ip:a.address.src.ipv6.ip,"prefix-length":a.address.src.ipv6.mask},"ipv6-destination":{ip:a.address.dest.ipv6.ip,"prefix-length":a.address.dest.ipv6.mask}});if("service"===a.service_app.type)switch(a.service_app.service_select){case "$udp":b.service={protocol:"UDP","port-range":{start:a.service_app.start_port,end:a.service_app.end_port}};break;case "$tcp":b.service={protocol:"TCP",
"port-range":{start:a.service_app.start_port,end:a.service_app.end_port}};break;case "$udpAny":b.service={protocol:"UDP","port-range":{start:1,end:65535}};break;case "$tcpAny":b.service={protocol:"TCP","port-range":{start:1,end:65535}};break;default:b.service={"service-ref":a.service_app.service_select}}else"application"===a.service_app.type&&(b.application.category=a.service_app.app_category,b.application.name=a.service_app.app_name,b.application.behaviour=a.service_app.app_behaviour);e.push(b)});
h.push({name:g.name,description:g.description,rule:e});c.push({method:"set_qos_class",params:{classifiers:{classifier:h}}})}})();c.length?b.post({method:"set_bulk",forcedUsingPost:!0,params:c,success:function(b){H();a.success=!0;a.resetModified()},error:function(b){console.log("trafficClassesCtrl del_qos_class error : "+b.status);H();a.resetModified()}}):H()},cancel:function(){"edit"===a.currPage?H():(F(-1),C());a.resetModified()}};a.check_traffic=function(){return!a.model.classes[a.classIndex]?!1:
"Default"===a.model.classes[a.classIndex].name||!0===a.model.classes[a.classIndex].in_use?!0:!1};a.is_default=function(){return!a.model.classes||!a.model.classes[a.classIndex]?!1:"Default"===a.model.classes[a.classIndex].name?!0:!1};a.checkConnName=function(){var b=function(b){a.tcform&&a.tcform&&a.tcform.cname.$setValidity("repeat_name",b)},c=!1;!a.edit||!a.edit.name?b(!0):(angular.forEach(a.model.classes,function(b){b.name===a.edit.name&&(c=!0)}),c?b(!1):b(!0))};a.schema={version:[{id:"unknown",
displayName:a.DICT("Traffic_Classes_Either")},{id:"ipv4",displayName:"IPv4"},{id:"ipv6",displayName:"IPv6"}]};(function(){w.all([e.get(),s(),A(),z(),h(),n(),D(),d()]).then(function(b){var d=b[0]||{};a.model.devicetypes=d.device;a.model.ostypes=d.os;c(b[7].data&&b[7].data.result||{});k(b[1].data&&b[1].data.result||{});y(b[2].data&&b[2].data.result||{});B(b[3].data&&b[3].data.result||{});g(b[4].data&&b[4].data.result||{});l(b[5].data&&b[5].data.result||{});E(b[6].data&&b[6].data.result||{});a.resetModified();
a.dataReady=!0})})()}]);app.controller("qos_bandwidth_management_main",["$scope","$q","MyHttp","$templateCache","wan_service","UserSession","userAccessRight","goToPreviousPage","oneTimeLocker",function(a,b,t,m,w,u,p,q,e){a.model={interfaces:[],outbound_list:[],queue_model:"priority",default_outbound:"Priority_Default"};var x={priority:"Priority_Default","rate-control":"Rate_Control_Default","low-latency":"Low_Latency_Default"};a.backbtn=!1;a.success=!1;a.dataReady=!1;a.needbackbtnbywanpolicy=!1;a.goback=q.goback;a.jumpToPage=
function(b){app.TOOLS.jumpToPage(b,void 0,function(b){b&&a.backbtn&&e.put("comefromWanQueuing",!0)})};a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();var n=function(){var e=t.post({url:resource_base+"data/interfaces_qos.json",method:"get_qos_wan_bandwidth",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),k=t.post({url:resource_base+"data/qos_lan2wan.json",method:"get_qos_queuing",error:function(a){Log(ERROR,"AJAX loading error: "+
a.status+", URL: "+a.config.url)}});a.dataReady=!1;b.all([e,k]).then(function(b){v(b[1]&&b[1].data&&b[1].data.result||{});l(b[0]&&b[0].data&&b[0].data.result||{});a.gridBWManage.data=a.model.interfaces;a.resetModified();a.dataReady=!0})["catch"](function(a){Log(ERROR,"=="+a)})},l=function(b){b||(b={});b=b.interfaces&&b.interfaces["interface"]||[];b=w.filter(b,{physical:!0,usb:!0});a.model.interfaces=[];angular.forEach(b,function(b,d){a.model.interfaces.push(r(b))})},r=function(b){b||(b={});var e=
b["ciscosb-qos"]||{},d=e.bandwidth||{},e={name:b.name||"",upstream:d.upstream||0,downstream:d.downstream||0,outbound:((e["qos-policy"]||{}).outbound||{})[a.model.queue_model]||a.model.default_queuing,edit:!0,list:a.model.outbound_list,max_upstream:1048576,max_downstream:1048576};b.name.match(/^USB\d+$/)&&(e.max_upstream=524288,e.max_downstream=524288);return e},v=function(b){b||(b={});b=b["ciscosb-qos"]||{};var e=b["queue-model"]||"priority";b=b["queue-policies"]&&b["queue-policies"]["queue-policy"]||
[];var d=!1;a.model.outbound_list=[];a.model.queue_model=e;a.model.default_outbound="";angular.forEach(b,function(b){b.queues&&b.queues[e]&&(a.model.default_outbound||(a.model.default_outbound=b.name),b.name===x[e]&&(d=!0),a.model.outbound_list.push({id:b.name,displayName:b.name}))});d&&(a.model.default_outbound=x[e]);a.model.outbound_list.length||Log(ERROR,"[Qos Bandwidth] Get error for WAN Queuing list, there is not exist rule which queue-model is "+e)};a.gridBWManage=app.uiGrid.generateGridOptions({columnDefs:[{field:"name",
displayName:a.DICT("WAN_Bandwidth_Management_Interface"),headerCellTemplate:"qos_header_bandwidth_interface.html"},{field:"upstream",displayName:a.DICT("WAN_Bandwidth_Management_Upstream"),required:!0,minWidth:230,cellTemplate:m.get("UG_table_inline_number_edit.html").replace(/data-ng-expansion/,'min="8" max="{{row.entity.max_upstream}}"'),headerCellTemplate:"qos_header_bandwidth_upstream.html"},{field:"downstream",displayName:a.DICT("WAN_Bandwidth_Management_Downstream"),required:!0,minWidth:230,
cellTemplate:m.get("UG_table_inline_number_edit.html").replace(/data-ng-expansion/,'min="8" max="{{row.entity.max_downstream}}" '),headerCellTemplate:"qos_header_bandwidth_downstream.html"},{field:"outbound",displayName:a.DICT("WAN_Bandwidth_Management_Outbound_Queuing_Policy"),cellTemplate:m.get("UG_table_select1_with_inline_edit.html"),listField:"list",editRow:"edit",headerCellTemplate:"qos_header_bandwidth_outbond_queuing_policy.html"}]});a.save=function(){var b=[],e;angular.forEach(a.model.interfaces,
function(d){e={name:d.name,"ciscosb-qos":{"qos-policy":{outbound:{}},bandwidth:{upstream:d.upstream,downstream:d.downstream}}};e["ciscosb-qos"]["qos-policy"].outbound[a.model.queue_model]=d.outbound;b.push(e)});t.post({url:resource_base+"data/qos_class.json",method:"set_qos_wan_bandwidth",params:{interfaces:{"interface":b}},success:function(b){a.success=!0;n()},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})};a.cancel=function(){n()};a.combineNote=a.DICT("WAN_Bandwidth_Management_Need_To",
{"%s":"<a ng-click=\"jumpToPage('QoS_WAN_Policing')\">"+a.DICT("WAN_Bandwidth_Management_Here")+"</a>"});e.get("needbackbtnbywanpolicy")&&(a.needbackbtnbywanpolicy=!0);if(q.isneed()||a.needbackbtnbywanpolicy)a.backbtn=!0;n()}]);app.controller("routingIGMPProxyCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","wan_service",function(a,b,t,m,w,u){a.success=!1;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var p=function(){return b.post({method:"get_igmp",url:resource_base+"data/igmp_proxy.json",success:function(a){q(a.data.result)},error:function(a){console.log("routingIGMPProxyCtrl Error status: "+a.status)}})},q=function(b){b||(b={});b=b["igmp-proxy"]||{};a.model.enable=
void 0!==b.enable?b.enable:!0;a.model.upstream_intf=b["upstream-interface"]||"auto"};a.need_one_downstream=!1;a.model={enable:!0,upstream_intf:"auto",upstream_sel:"",upstream_list:[],downstream_list:[],list:[]};a.schema={upstream_intfs:[{name:a.DICT("IGMP_Proxy_WAN_Auto"),id:"auto"},{name:a.DICT("IGMP_Proxy_Fixed_Interface"),id:"fix"}]};var e=function(b){b||(b={});a.model.downstream_list=[];a.model.upstream_list=[];var e=[],r=[],m=[],s=[],k=-1,d,c=[],h=!1;b.interfaces&&b.interfaces["interface"]&&
(e=u.order_ifs(b));angular.forEach(e,function(b){b.name&&(d=b["igmp-proxy"]||{},"upstream"===d.type&&!0===d.enable&&(a.model.upstream_sel=b.name),b.name.match(/^WAN\d+($|\.\d+$)/)&&("downstream"===d.type&&!0===d.enable&&(h=!0),r.push({name:b.name,isdown:!1,id:b.name,disable:!1,type:"wan"})),b.name.match(/^VLAN\d+$/)&&s.push({name:b.name,isdown:"downstream"===d.type&&d.enable?!0:!1,id:b.name,disable:!1,type:"vlan"}),b.name.match(/^GRE\d+$/)&&c.push({name:b.name,isdown:"downstream"===d.type&&d.enable?
!0:!1,id:b.name,disable:!1,type:"gre"}))});m=r.concat(s).concat(c);k=-1;angular.forEach(m,function(b,c){0===c%10&&(k+=1,a.model.upstream_list.push([]));a.model.upstream_list[k].push(b)});m=[{name:"WAN",isdown:h,id:"wan",disable:"auto"===a.model.upstream_intf,type:"wan",wans:angular.copy(r)}].concat(s).concat(c);k=-1;angular.forEach(m,function(b,c){0===c%10&&(k+=1,a.model.downstream_list.push([]));a.model.downstream_list[k].push(b)})},x=function(){a.model.upstream_list=[];a.model.downstream_list=[];
t.all([p()]).then(function(b){a.model.upstream_sel="";q(b[0]&&b[0].data&&b[0].data.result||{});e(b[0]&&b[0].data&&b[0].data.result||{});"auto"===a.model.upstream_intf&&(a.model.upstream_sel=a.model.upstream_list[0]&&a.model.upstream_list[0][0]&&a.model.upstream_list[0][0].id||"");a.dataReady=!0})};a.funs={save:function(){var e=a.model.enable,l=a.model.upstream_intf,r=a.model.upstream_sel,m=[],s,k,d,c,h,g,A,y=a.model.downstream_list,z=!1;a.need_one_downstream=!1;for(s=y.length-1;0<=s;s--)for(k=y[s].length-
1;0<=k;k--)if(d=y[s][k],d.isdown&&(z=!0),"WAN"===d.name){if(d.wans&&d.wans.length)for(c=d.wans.length-1;0<=c;c--)h=d.wans[c],"auto"===l?(A="upstream",g=!0):r===h.id?(A="upstream",g=!0):d.isdown?(A="downstream",g=!0):(A="upstream",g=!1),m.push({name:h.name,"igmp-proxy":{enable:g,type:A}})}else if("vlan"===d.type||"gre"===d.type)"auto"===l?d.isdown?(A="downstream",g=!0):(A="downstream",g=!1):r===d.id?(A="upstream",g=!0):d.isdown?(A="downstream",g=!0):(A="downstream",g=!1),m.push({name:d.name,"igmp-proxy":{enable:g,
type:A}});e&&!z?a.need_one_downstream=!0:b.post({method:"set_igmp",params:{"igmp-proxy":{enable:e,"upstream-interface":l},interfaces:{"interface":m}},success:function(b){a.success=!0;x();a.resetModified()},error:function(b){x();a.resetModified()}})},cancel:function(){x();a.resetModified()}};a.check=function(){var b=!1,e=a.model.downstream_list,r,m,s;"auto"===a.model.upstream_intf&&(b=!0);for(r=e.length-1;0<=r;r--)for(m=e[r].length-1;0<=m;m--)s=e[r][m],"WAN"===s.name&&(s.disable=b)};a.dataReady=!1;
x()}]);app.controller("ripCtrl",["$scope","MyHttp","UserSession","userAccessRight","$q",function(a,b,t,m,w){a.success=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var u=function(){return b.post({url:resource_base+"data/rip.json",method:"get_rip",error:function(a){Log(ERROR,"ripCtrl error status: "+a.status)}})},p=function(b){b||(b={});a.model.ripList=[];var e=function(b,e){var k=e.name||"",d=void 0!==e.enabled?e.enabled:!0,c=void 0!==e.passive?e.passive:!0,h=e.authentication||
{},g=void 0;if(k){angular.forEach(a.model.ripList,function(a,b){a.ifname===k&&(g=a)});void 0===g&&(a.model.ripList.push({ifname:k,enabled:!1,NATEnable:!1,edit:!0,ripv1:{enabled:!1,passive:!1},ripv2:{enabled:!1,passive:!1},ripng:{enabled:!1,passive:!1},authentication:{enable:!1,type:"key-chain",password:"",key_chain:{id:"",key:""},orig_type:"key-chain",orig_password:"",orig_key_chain:{id:"",key:""}},empty:""}),g=a.model.ripList[a.model.ripList.length-1]);switch(b){case "ripv1":case "ripng":break;case "ripv2":angular.forEach(h,
function(a,b){switch(b){case "enable":g.authentication.enable=a;break;case "key-chain":g.authentication.type=b;g.authentication.orig_type=b;g.authentication.key_chain.id=void 0!==a.id?parseInt(a.id,10):"";g.authentication.key_chain.key=a.key||"";g.authentication.orig_key_chain=angular.copy(g.authentication.key_chain);break;case "key":g.authentication.type=b,g.authentication.password=a,g.authentication.orig_type=b,g.authentication.orig_password=a}});break;default:return}g[b].enabled=d;g[b].passive=
c}else Log(ERROR,"ripCtrl procRIPData addRIP error no ifname")};b=(b.routing||{})["routing-instance"]||[];var r=a.model;r.v4_enabled=!1;r.v6_enabled=!1;a.key={ripv1:{name:"",type:""},ripv2:{name:"",type:""},ripng:{name:"",type:""},name:""};angular.forEach(b,function(b,n){if("local"===b.name){a.key.name=b.name;var k;angular.forEach((b["routing-protocols"]||{})["routing-protocol"]||[],function(b,c){k=b.type.replace("ciscosb-routing-rip:","");if(a.key[k]){a.key[k].name=b.name;a.key[k].type=k;var h=b.rip,
g;void 0!==h["v4-enabled"]&&(r.v4_enabled=r.v4_enabled||h["v4-enabled"]);void 0!==h["v6-enabled"]&&(r.v6_enabled=r.v6_enabled||h["v6-enabled"]);if(h.ripv1)g="ripv1",h=h.ripv1.interfaces||{};else if(h.ripv2)g="ripv2",h=h.ripv2.interfaces||{};else if(h.ripng)g="ripng",h=h.ripng.interfaces||{};else{Log(ERROR,"ripCtrl error key type is error element");return}angular.forEach(h["interface"]||[],function(a,b){e(g,a)})}else Log(ERROR,"ripCtrl error key type is error type: "+k)})}});a.gridRipOptions.data=
a.model.ripList},q=function(){return b.post({method:"get_nat",url:resource_base+"data/wan_setting1.json",error:function(a){Log(ERROR,"getInterfacesData error status: "+a.status);e()}})},e=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];a.model.ifs={};angular.forEach(b,function(b,e){if(b.name.match(/^WAN/)||b.name.match(/^USB/)||b.name.match(/^VLAN/))a.model.ifs[b.name]={nat:b.nat&&void 0!==b.nat.enable?b.nat.enable:!1}})},x=function(){a.dataReady=!1;w.all([u(),q()]).then(function(b){p(b[0]&&
b[0].data&&b[0].data.result);e(b[1]&&b[1].data&&b[1].data.result);a.checkRelation();a.dataReady=!0})};a.checkRelation=function(){angular.forEach(a.model.ripList,function(b,e){a.chkRowRelation(b)})};a.chkRowRelation=function(b){a.model.ifs[b.ifname]&&a.model.ifs[b.ifname].nat?(b.NATEnable=!0,b.enabled=a.model.v4_enabled&&(b.ripv1.enabled||b.ripv2.enabled)||a.model.v6_enabled&&(b.ripng.enabled||b.ripng.passive)):b.enabled=a.model.v4_enabled&&(b.ripv1.enabled||b.ripv1.passive||b.ripv2.enabled||b.ripv2.passive)||
a.model.v6_enabled&&(b.ripng.enabled||b.ripng.passive);!b.ripv2.enabled&&b.authentication.enable&&(b.authentication.enable=!1);b.edit=!a.model.v4_enabled&&!a.model.v6_enabled?!1:!0};a.enableCbk=function(b){a.model.v4_enabled&&(b.ifname.match(/^WAN/)||b.ifname.match(/^USB/)?b.NATEnable||(b.ripv1.passive=b.enabled,b.ripv2.passive=b.enabled):(b.ripv1.passive=b.enabled,b.ripv2.passive=b.enabled),b.ripv1.enabled=b.enabled,b.ripv2.enabled=b.enabled);a.model.v6_enabled&&(b.ripng.enabled=b.enabled,b.ripng.passive=
b.enabled)};a.model={v4_enabled:!1,v6_enabled:!1,ripList:[],ifs:[],schema:{}};a.key={};a.dataReady=!1;a.funs={save:function(){var e=[],l=[],r=[],m=[],s,k;angular.forEach(a.model.ripList,function(a,b){var h={enable:a.authentication.enable};if(a.authentication.orig_type!==a.authentication.type||a.authentication.orig_password!==a.authentication.password||a.authentication.orig_key_chain.id!==a.authentication.key_chain.id||a.authentication.orig_key_chain.key!==a.authentication.key_chain.key)switch(a.authentication.type){case "key":h.key=
a.authentication.password;break;default:h["key-chain"]={id:a.authentication.key_chain.id,key:a.authentication.key_chain.key}}k=a.ripv1.enabled;s=a.ripv1.passive;e.push({name:a.ifname,enabled:k,passive:s});k=a.ripv2.enabled;s=a.ripv2.passive;l.push({name:a.ifname,enabled:k,passive:s,authentication:h});k=a.ripng.enabled;s=a.ripng.passive;r.push({name:a.ifname,enabled:k,passive:s})});m.push({type:a.key.ripv1.type,name:a.key.ripv1.name,rip:{"v4-enabled":a.model.v4_enabled,"v6-enabled":a.model.v6_enabled,
ripv1:{interfaces:{"interface":e}}}});m.push({type:a.key.ripv2.type,name:a.key.ripv2.name,rip:{"v4-enabled":a.model.v4_enabled,"v6-enabled":a.model.v6_enabled,ripv2:{interfaces:{"interface":l}}}});m.push({type:a.key.ripng.type,name:a.key.ripng.name,rip:{"v4-enabled":a.model.v4_enabled,"v6-enabled":a.model.v6_enabled,ripng:{interfaces:{"interface":r}}}});b.post({method:"set_rip",params:{routing:{"routing-instance":[{name:a.key.name,"routing-protocols":{"routing-protocol":m}}]}},success:function(b){a.success=
!0;x();a.resetModified()},error:function(){x();a.resetModified()}})},cancel:function(){x();a.resetModified()}};a.gridRipOptions=app.uiGrid.generateGridOptions({data:a.model.ripList,headerRowHeight:60,columnDefs:[{field:"ifname",displayName:a.DICT("RIP_Interface"),cellClass:"rip-content-tb-cell",width:100,headerCellTemplate:"rip_interface_header.html"},{field:"enabled",editRow:"edit",displayName:a.DICT("RIP_Enable"),editRow:"edit",cellClass:"rip-content-tb-cell",changedCbk:function(b,e,r,m){e&&e.entity&&
a.enableCbk(e.entity)},cellTemplate:"UG_table_checkbox_with_inline_edit.html",width:80,headerCellTemplate:"rip_enable_header.html"},{field:"ripv1",headerCellTemplate:"rip_ripv1_header.html",cellTemplate:"rip_ripv1_2_content.html",minWidth:140},{field:"ripv2",headerCellTemplate:"rip_ripv2_header.html",cellTemplate:"rip_ripv1_2_content.html",minWidth:140},{field:"ripng",headerCellTemplate:"rip_ripng_header.html",cellTemplate:"rip_ripng_content.html",minWidth:140},{field:"authentication",headerCellTemplate:"rip_auth_header.html",
cellTemplate:"rip_auth_content.html",minWidth:450},{field:"empty",isEmpty:!0,displayName:"",headerCellTemplate:"rip_empty_header.html"}]});a.model.schema={authTypeList:[{id:"key-chain",displayName:a.DICT("RIP_MD5")},{id:"key",displayName:a.DICT("RIP_Plain")}]};x()}]);app.controller("staticRoutingCtrl",["$scope","MyHttp","wan_service","$q","$templateCache","UserSession","userAccessRight",function(a,b,t,m,w,u,p){a.success=!1;a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();var q=function(){return b.post({url:resource_base+"data/routing_get_subnet.json",method:"get_subnet",error:function(a){Log(ERROR,"staticRoutingCtrl error status: "+a.status)}})},e=function(){return b.post({url:resource_base+"data/routing.json",method:"get_routing_protocol",
error:function(a){Log(ERROR,"staticRoutingCtrl error status: "+a.status)}})},x=function(b){b||(b={});b=(b.routing||{})["routing-instance"]||[];var c=(b[0]&&b[0]["routing-protocols"]||{})["routing-protocol"]||[];a.model.ipv4=[];a.model.ipv6=[];a.model.routingInstanceName=b.name||"local";a.model.routingInstanceType=b.type||"default-routing-instance";a.model.selects={ipv4:[],ipv6:[]};angular.forEach(c,function(b,c){if("static"===b.type){a.model.routingProtocolName=b.name||"local";a.model.routingProtocolType=
b.type||"static";var d=b["static-routes"]&&b["static-routes"].ipv6&&b["static-routes"].ipv6.route||[];angular.forEach(b["static-routes"]&&b["static-routes"].ipv4&&b["static-routes"].ipv4.route||[],function(b,c){a.model.ipv4.push(n(b))});angular.forEach(d,function(b,c){a.model.ipv6.push(l(b))});a.model.orig.ipv4=angular.copy(a.model.ipv4);a.model.orig.ipv6=angular.copy(a.model.ipv6)}});a.gridIpv4Options.data=a.model.ipv4;a.gridIpv6Options.data=a.model.ipv6;setTimeout(function(){a.gridIpv4Options.gridApi.customApi.checkSelectStatus();
a.gridIpv6Options.gridApi.customApi.checkSelectStatus()},0)},n=function(b,c){var d=b["destination-prefix"]&&b["destination-prefix"].split("/")||["",24],h=d[0],d=parseInt(d[1],10),e=b["next-hop"]&&b["next-hop"]||{};return{dest_prefix:b["destination-prefix"]||"",checked:!1,disableChk:!1,edit:c||!1,modify:c||!1,network:h,mask:0===d?"0.0.0.0":app.TOOLS.netmask.int2Inet(d),next_hop_address:e["ciscosb-routing:next-hop-address"]||e["next-hop-address"]||"",metric:void 0!==b.metric?b.metric:1,"interface":{select:e["outgoing-interface"]||
a.model.schema.intfs[0]&&a.model.schema.intfs[0].id||"",list:a.model.schema.intfs}}},l=function(b,c){var d=b["destination-prefix"]&&b["destination-prefix"].split("/")||["",64],h=d[0],d=parseInt(d[1],10),e=b["next-hop"]&&b["next-hop"]||{};return{dest_prefix:b["destination-prefix"]||"",edit:c||!1,checked:!1,disableChk:!1,modify:c||!1,prefix:h,length:d,next_hop_address:e["ciscosb-routing:next-hop-address"]||e["next-hop-address"]||"",metric:void 0!==b.metric?b.metric:1,"interface":{select:e["outgoing-interface"]||
a.model.schema.intfs[0]&&a.model.schema.intfs[0].id||"",list:a.model.schema.intfs}}};u=function(b){b=a.model.ipv4;var c=a.model.ipv6;a.model.selects.ipv4=[];angular.forEach(b,function(b,c){b.checked?a.model.selects.ipv4.push(c):(b.edit=!1,void 0==b.network&&(b.network=""),void 0==b.mask&&(b.mask="255.255.255.0"),void 0==b.next_hop_address&&(b.next_hop_address=""))});a.model.selects.ipv6=[];angular.forEach(c,function(b,c){b.checked?a.model.selects.ipv6.push(c):(b.edit=!1,void 0==b.prefix&&(b.prefix=
""),void 0==b.length&&(b.length=64),void 0==b.next_hop_address&&(b.next_hop_address=""))})};var r=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",error:function(a){Log(ERROR,"Static Routing getInterfacesData Error Status: "+a.status)}})},v=function(b){b||(b={});b=b.interfaces&&b.interfaces["interface"]||[];var c=[],d=[];a.model.schema.intfs=[];var h=t.filter(b,{gre:!0,usb:!0,physical:!0,ipv6transition:!0,subinterface:!0});angular.forEach(h,function(a){(a.name.match(/^USB\d+$/)||
a.name.match(/^TUN\d+$/))&&!1===a.enabled||c.push({id:a.name,displayName:a.name})});angular.forEach(b,function(a,b){a.name.match(/^VLAN/)&&d.push({id:a.name,displayName:a.name})});a.model.schema.intfs=c.concat(d)},s=function(){m.all([e()]).then(function(a){x(a[0]&&a[0].data&&a[0].data.result||{})})};a.dataReady=!0;a.model={routingInstanceName:"local",routingInstanceType:"default-routing-instance",routingProtocolName:"local",routingProtocolType:"static",ipv4:[],ipv6:[],selects:{ipv4:[],ipv6:[]},orig:{ipv4:[],
ipv6:[]},schema:{intfs:[],maxCnts:{ipv4:50,ipv6:50}},delItem:{ipv4:[],ipv6:[]}};var k=function(){return 100<=a.model.ipv4.length?(a.msg=a.DICT("Static_Routing_Msg_V4",{"%d":a.model.ipv4.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},d=function(){return 50<=a.model.ipv6.length?(a.msg=a.DICT("Static_Routing_Msg_V6",{"%d":a.model.ipv6.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},c=[],h={};a.ipv4RouteCbk=function(b){if(!b)return!0;var d=!0,e=[],
k=[],l=a.model.ipv4,n=l.length,r,m,s=!0,v,q=!0,F,p;"delete_row"===b.type&&(s=!1);var x=function(a,b,g,v){if(!(0>b||b>n))if(!(0>g||g>n)){q=!0;p=void 0;F=a.network+"_"+a.mask+"_"+g;c[g]&&(p=c[g].id,h[p]&&p!==F&&(h[p].cnts--,delete c[g]));for(r=b;r<n;r++)if((m=l[r])&&r!==g)app.TOOLS.validation.ipv4_getNet(m.network,m.mask).toString()==v?(Log(DEBUG,"### V4 entry "+(g+1)+" is the same with entry "+(r+1)),F=m.network+"_"+m.mask+"_"+r,c[r]||(c[r]={id:F},void 0===h[F]&&(h[F]={cnts:0}),h[F].cnts++,e.push(r)),
q=d=!1):c[r]&&(c[r].id===p&&h[p]&&1>=h[p].cnts)&&(k.push(r),delete c[r],delete h[p]);a&&(q?c[g]&&(k.push(g),delete c[g]):c[g]||(c[g]={id:F},void 0===h[F]&&(h[F]={cnts:0}),h[F].cnts++,e.push(g)))}};if(s){if(!b.row)return!0;s=app.TOOLS.validation.ipv4_getNet(b.row.entity.network,b.row.entity.mask).toString();x(b.row.entity,0,b.row.rowIndex,s)}else{b=angular.copy(c);angular.copy(h);c=[];h={};for(v=0;v<n;v++)l[v]&&(s=app.TOOLS.validation.ipv4_getNet(l[v].network,l[v].mask).toString(),x(l[v],v+1,v,s));
e=[];k=[];for(v=0;v<n;v++)b[v]&&!c[v]&&k.push(v),!b[v]&&c[v]&&e.push(v)}Log(DEBUG,"V4 valid="+d+" invalidRows="+e+" validRows="+k);return{result:d,invalidRows:e,validRows:k}};a.ipv6RouteCbk=function(b){if(!b)return!0;var d=!0,e=[],k=[],l=a.model.ipv6,n=l.length,r,m,v=!0,s,q=!0,F,p;"delete_row"===b.type&&(v=!1);var x=function(a,b,g,s){if(!(0>b||b>n))if(!(0>g||g>n)){q=!0;p=void 0;F=a.prefix+"_"+a.length+"_"+g;c[g]&&(p=c[g].id,h[p]&&p!==F&&(h[p].cnts--,delete c[g]));for(r=b;r<n;r++)if((m=l[r])&&r!==
g)b=app.TOOLS.validation.ipv6_getNet(m.prefix,m.length).toString(),Log(DEBUG,"### "+g+" rowV6Net="+b),b==s?(Log(INFO,"### V6 entry "+(g+1)+" is the same with entry "+(r+1)),F=m.prefix+"_"+m.length+"_"+r,c[r]||(c[r]={id:F},void 0===h[F]&&(h[F]={cnts:0}),h[F].cnts++,e.push(r)),q=d=!1):c[r]&&(c[r].id===p&&h[p]&&1>=h[p].cnts)&&(k.push(r),delete c[r],delete h[p]);a&&(q?c[g]&&(k.push(g),delete c[g]):c[g]||(c[g]={id:F},void 0===h[F]&&(h[F]={cnts:0}),h[F].cnts++,e.push(g)))}};if(v){if(!b.row)return!0;v=app.TOOLS.validation.ipv6_getNet(b.row.entity.prefix,
b.row.entity.length).toString();x(b.row.entity,0,b.row.rowIndex,v)}else{b=angular.copy(c);angular.copy(h);c=[];h={};for(s=0;s<n;s++)l[s]&&(v=app.TOOLS.validation.ipv6_getNet(l[s].prefix,l[s].length).toString(),x(l[s],s+1,s,v));e=[];k=[];for(s=0;s<n;s++)b[s]&&!c[s]&&k.push(s),!b[s]&&c[s]&&e.push(s)}Log(DEBUG,"V6 valid="+d+" invalidRows="+e+" validRows="+k);return{result:d,invalidRows:e,validRows:k}};a.chkIpv4SubnetIntfs=function(b){if(!b||!b.row)return!0;var c=!0,d=b.row.entity.next_hop_address;if(void 0===
d||""===d)return!0;angular.forEach(a.model.ipv4_intfs,function(a){"interfaces"==a.type&&a.ip==d&&(c=!1)});return c};a.chkIpv6SubnetIntfs=function(b){if(!b||!b.row)return!0;var c=!0;b=b.row.entity.next_hop_address;if(void 0===b||""===b)return!0;var d=app.TOOLS.ipv6.toFullV6Addr(b);angular.forEach(a.model.ipv6_intfs,function(a){var b=app.TOOLS.ipv6.toFullV6Addr(a.ip);"interfaces"==a.type&&d==b&&(c=!1)});return c};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridIpv4Options=app.uiGrid.generateGridOptions({IDPreifx:"GridIPv4",
data:a.model.ipv4,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:u,headerChangedCbk:u,disableChkBoxField:"disableChk"},{field:"network",editRow:"edit",customVldGroup:"1",displayName:a.DICT("Static_Routing_Network"),placeholder:"10.2.3.0",validationCbk:"gridInvalidCbk",required:!0,cellTemplate:w.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv4-ip extansion-or-reg="^0.0.0.0$" check-ipv4-multicast check-ipv4-bymask="row.entity[\'mask\']" custom-vld custom-vld-cbk="ipv4RouteCbk"'),
id:"GridIPv4_network"},{field:"mask",editRow:"edit",customVldGroup:"1",displayName:a.DICT("Static_Routing_Mask"),placeholder:"255.255.255.0",validationCbk:"gridInvalidCbk",required:!0,cellTemplate:w.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv4-netmask extansion-or-reg="^0.0.0.0$" check-mask-byipv4="row.entity[\'network\']" custom-vld custom-vld-cbk="ipv4RouteCbk"'),id:"GridIPv4_mask"},{field:"next_hop_address",editRow:"edit",customVldGroup:"ipv4SubnetIntfs",displayName:a.DICT("Static_Routing_Next_Hop"),
placeholder:" 10.2.3.4",required:!0,validationCbk:"gridInvalidCbk",cellTemplate:w.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv4-ip check-ipv4-multicast custom-vld custom-vld-cbk="chkIpv4SubnetIntfs"'),id:"GridIPv4_next"},{field:"metric",editRow:"edit",displayName:a.DICT("Static_Routing_Metric"),max:32766,min:0,required:!0,validationCbk:"gridInvalidCbk",cellTemplate:"UG_table_text_with_inline_number_edit.html",id:"GridIPv4_max"},{field:"interface",editRow:"edit",displayName:a.DICT("Static_Routing_Interface"),
cellTemplate:"UG_table_text_with_inline_select_edit.html",id:"GridIPv4_interface"}]});a.gridIpv6Options=app.uiGrid.generateGridOptions({IDPreifx:"GridIPv6",data:a.model.ipv6,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:u,headerChangedCbk:u,disableChkBoxField:"disableChk"},{field:"prefix",editRow:"edit",customVldGroup:"2",displayName:a.DICT("Static_Routing_Prefix"),placeholder:"2222::",validationCbk:"gridInvalidCbk",cellTemplate:w.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,
'ipv6-ip chk-ipv6-bylength="row.entity[\'length\']" custom-vld custom-vld-cbk="ipv6RouteCbk"'),id:"GridIPv6_prefix"},{field:"length",editRow:"edit",customVldGroup:"2",displayName:a.DICT("Static_Routing_Length"),min:0,max:128,required:!0,validationCbk:"gridInvalidCbk",cellTemplate:w.get("UG_table_text_with_inline_number_edit.html").replace(/data-ng-expansion/,'custom-vld chk-length-byipv6="row.entity[\'prefix\']" custom-vld-cbk="ipv6RouteCbk"'),id:"GridIPv6_length"},{field:"next_hop_address",editRow:"edit",
customVldGroup:"ipv6SubnetIntfs",displayName:a.DICT("Static_Routing_Next_Hop"),placeholder:"2222::1",required:!0,validationCbk:"gridInvalidCbk",cellTemplate:w.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv6-ip custom-vld custom-vld-cbk="chkIpv6SubnetIntfs"'),id:"GridIPv6_next"},{field:"metric",editRow:"edit",displayName:a.DICT("Static_Routing_Metric"),validationCbk:"gridInvalidCbk",max:32766,min:0,required:!0,cellTemplate:"UG_table_text_with_inline_number_edit.html",id:"GridIPv6_max"},
{field:"interface",editRow:"edit",displayName:a.DICT("Static_Routing_Interface"),cellTemplate:"UG_table_text_with_inline_select_edit.html",id:"GridIPv6_interface"}]});a.funs={add:function(b){switch(b){case "ipv4":if(k())return;break;case "ipv6":if(d())return}a.model[b].length>=a.model.schema.maxCnts[b]&&Log(INFO,"Static Routing funs.add, proto '"+b+"' reach Max count: "+a.model.schema.maxCnts[b]+". Reject Add command");switch(b){case "ipv4":b=n({},!0);b.checked=!0;a.model.ipv4.push(b);a.gridIpv4Options.gridApi.customApi.scrollToLast();
a.modified();break;case "ipv6":b=l({},!0),b.checked=!0,b.edit=!0,a.model.ipv6.push(b),a.gridIpv6Options.gridApi.customApi.scrollToLast(),a.modified()}},edit:function(b){switch(b){case "ipv4":case "ipv6":angular.forEach(a.model[b],function(a){a.checked&&(a.edit=!0,a.modify=!0)})}},del:function(b){var c=function(){var c=-1,d=-1;angular.forEach(a.model.selects[b],function(a,b){c<a&&(c=a,d=b)});a.model.selects[b].splice(d,1);return c},d,h;switch(b){case "ipv4":for(d=a.model.selects[b].length-1;0<=d;d--)h=
c(),a.model[b].splice(h,1);a.modified();break;case "ipv6":for(d=a.model.selects[b].length-1;0<=d;d--)h=c(),a.model[b].splice(h,1);a.modified()}},save:function(){var c=[],d=[],h=function(b,c){var d={},g={};b.length&&(d.ipv4={route:b});c.length&&(d.ipv6={route:c});g={routing:{"routing-instance":[{name:a.model.routingInstanceName,"routing-protocols":{"routing-protocol":[{type:a.model.routingProtocolType,name:a.model.routingProtocolName,"static-routes":d}]}}]}};b.length||delete g.routing["routing-instance"][0]["routing-protocols"]["routing-protocol"][0]["static-routes"].ipv4;
c.length||delete g.routing["routing-instance"][0]["routing-protocols"]["routing-protocol"][0]["static-routes"].ipv6;return g},e=[],k=[],l={},n={},r;angular.forEach(a.model.ipv4,function(a,b){r=a.network+"/"+app.TOOLS.netmask.inet2Int(a.mask);l[r]=!0;a.modify&&e.push({"destination-prefix":r,"next-hop":{"outgoing-interface":a["interface"].select,"ciscosb-routing:next-hop-address":a.next_hop_address},metric:a.metric})});angular.forEach(a.model.ipv6,function(a,b){r=a.prefix+"/"+a.length;n[r]=!0;a.modify&&
k.push({"destination-prefix":r,"next-hop":{"outgoing-interface":a["interface"].select,"ciscosb-routing:next-hop-address":a.next_hop_address},metric:a.metric})});var m=function(){b.post({method:"set_routing_protocol",params:h(e,k),success:function(b){a.success=!0;s();a.resetModified()},error:function(b){s();a.resetModified()}})};angular.forEach(a.model.orig.ipv4,function(a,b){a.dest_prefix&&!l[a.dest_prefix]&&c.push({"destination-prefix":a.dest_prefix})});angular.forEach(a.model.orig.ipv6,function(a,
b){a.dest_prefix&&!n[a.dest_prefix]&&d.push({"destination-prefix":a.dest_prefix})});c.length||d.length?b.post({method:"del_routing_protocol",params:h(c,d),success:function(){m()},error:function(){m()}}):m()},cancel:function(){s();a.resetModified()}};(function(){m.all([e(),r(),q()]).then(function(b){var c=b[2]&&b[2].data&&b[2].data.result||{};a.model.ipv4_intfs=c.subnets.ipv4||[];a.model.ipv6_intfs=c.subnets.ipv6||[];v(b[1]&&b[1].data&&b[1].data.result||{});x(b[0]&&b[0].data&&b[0].data.result||{})})})()}]);app.controller("antiThreatCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","Upload","dt",function(a,b,t,m,w,u,p){var q=app.TOOLS.getResponse,e=app.TOOLS.getVal;a.success=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var x=function(){return b.post({method:"get_anti_virus",url:resource_base+"data/anti_threat.json",error:function(a){n();Log(ERROR,"[AntiVirus] Error, getAntiVirus Error "+JSON.stringify(a))}})},n=
function(b){b||(b={});b=b&&b["anti-virus"]||{};var d=b.protocols||[];angular.forEach(a.model.av.proto,function(a){a.enable=!1;a.action="none"});angular.forEach(d,function(b){a.model.av.proto[b.name].enable=!1;a.model.av.proto[b.name]&&(a.model.av.proto[b.name].action=b.action,a.model.av.proto[b.name].enable=!0)});!b["file-size-threshold"]||!_.isNumber(b["file-size-threshold"])?(a.model.av.threshold_enabled=!1,a.model.av.threshold=1):(a.model.av.threshold_enabled=!0,a.model.av.threshold=b["file-size-threshold"]);
a.model.av.enabled=void 0!==b.enabled?b.enabled:!1},l=function(){return b.post({method:"get_anti_virus_state",url:resource_base+"data/anti_threat.json",error:function(a){n();Log(ERROR,"[AntiVirus] Error, getAntiVirusState Error "+JSON.stringify(a))}})},r=function(){return b.post({method:"get_signature_state",url:resource_base+"data/get_signature_state.json",error:function(a){Log(ERROR,"[AntiVirus][getSignatureStateData] Error "+JSON.stringify(a))}})},v=function(){t.all([x(),r(),l()]).then(function(b){n(q(b,
0));var d=q(b,1);d||(d={});var d=d["ciscosb-anti-virus:signature-state"]||{},c=p.parser(d["latest-update-time"]);a.model.signature_state.last_update_time=1===c.err_code?"N/A":p.timeStr(c);a.model.signature_state.version=d.version||"N/A";a.model.signature_state.available_version=d["available-version"]||"N/A";(b=q(b,2))||(b={});b=e(b.status,0);a.model.no_license=0===b;a.funs.check_protocol();a.ui_data.data_ready=!0;a.resetModified()})};a.model={no_license:!1,av:{enabled:!1,threshold_enabled:!1,threshold:1,
proto:{HTTP:{enable:!1,action:"none",list:[]},FTP:{enable:!1,action:"none",list:[]},SMTP:{enable:!1,action:"none",list:[]},POP3:{enable:!1,action:"none",list:[]},IMAP:{enable:!1,action:"none",list:[]}}},av_state:{last_reset_time:"N/A"},signature_state:{version:"N/A",last_update_time:"N/A"}};a.ui_data={data_ready:!1,disable_upgradeBtn:!0,protocols_none:[{id:"none",displayName:a.DICT("Anti_Threat_None")}],protocols:[{id:"log",displayName:a.DICT("Anti_Threat_Log")},{id:"log-destory",displayName:a.DICT("Anti_Threat_Log_Destroy")}],
pc_file:"",uploading:!1,progress:0,combineNote:a.DICT("Anti_Threat_Note",{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Here")+"</u></a>"})};var s=function(b){var d="";switch(b){case 2:d=a.DICT("Anti_Threat_Cannot_Connect_To_Cisco");break;case 3:d=a.DICT("Anti_Threat_You_Have_The_Lastest_Version");break;default:d=a.DICT("Anti_Threat_Update_Available_On_Cisco")}app.TOOLS.informationAlertBox({msg:d})};a.funs={check_update:function(){b.post({method:"check-latest-version",forcedUsingPost:!0,
success:function(a){s(3)},error:function(){s(2)}})},save:function(){var e=a.model.av,d={enabled:e.enabled};d["file-size-threshold"]=e.threshold_enabled?e.threshold:0;d.protocols=[];angular.forEach(e.proto,function(a,b){a.enable&&d.protocols.push({name:b,action:a.action})});b.post({method:"set_anti_virus",forcedUsingPost:!0,params:{"anti-virus":d},success:function(){v()},error:function(a){Log(ERROR,"[Anti Threat] Apply Error");Log(ERROR,JSON.stringify(a));v()}})},cancel:function(){v()},update:function(){var e=
function(){b.post({method:"action",params:{rpc:"file-copy",input:{fileType:"signature",source:"FILE://Signature/anti_virus_file"}},success:function(b){var d=b&&b.data&&b.data.result||{};b=d.code||-1;d=d.errstr||a.DICT("Anti_Threat_Upgrade_Fail");0===b?v():app.TOOLS.criticalAlertBox({msg:d,cbk:function(){v()}})},error:function(){app.TOOLS.criticalAlertBox({msg:a.DICT("Anti_Threat_Upgrade_Fail"),cbk:function(){v()}})}})},d=a.ui_data.pc_file;d.upload=u.upload({url:resource_base+"upload",headers:{"optional-header":"header-value"},
data:{sessionid:"EU6DJKEIWO",pathparam:"Signature",fileparam:"anti_virus_file",file:d}});a.ui_data.uploading=!0;d.upload.then(function(b){a.ui_data.uploading=!1;e()},function(b){a.ui_data.uploading=!1;app.TOOLS.criticalAlertBox({msg:a.DICT("Anti_Threat_Upload_Failure"),cbk:function(){v()}})},function(b){a.ui_data.progress=Math.min(100,parseInt(100*b.loaded/b.total,10))})},check_protocol:function(){angular.forEach(a.model.av.proto,function(b){b.enable?(b.list=a.ui_data.protocols,"none"===b.action&&
(b.action=a.ui_data.protocols[0].id)):(b.list=a.ui_data.protocols_none,b.action="none")})},chk_threshold:function(){!a.model.av.threshold_enabled&&!a.model.av.threshold&&(a.model.av.threshold=1)},pcFileFormatCheck:function(b){a.ui_data.pcfile_invalid=!1;a.ui_data.disable_upgradeBtn=!0;void 0!=b&&(b.name.toLowerCase().match(/(\.zip){1}$/)?(a.ui_data.pc_file=b,a.ui_data.disable_upgradeBtn=!1):(a.ui_data.disable_upgradeBtn=!0,app.TOOLS.criticalAlertBox({title:a.DICT("Error"),msg:a.DICT("Anti_Threat_File_Wrong_Format")})))}};
v()}]);app.controller("AppWizardCtrl",["$scope","MyHttp","pgWindow","meta_data_service","UserSession","userAccessRight","ngDialog","$location","$q",function(a,b,t,m,w,u,p,q,e){a.success=!1;a.maxAVCEntity=20;a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var x=function(b){var d=app.TOOLS.get_scope("WizardCtrl");d&&d.funs.close_application_wizard();b&&app.TOOLS.successAlertBox({title:a.DICT("Success"),msg:a.DICT("Application_Control_Wizard_Setup_Success"),cbk:function(){app.TOOLS.jumpToPage("Security_Application_Controller")}})},
n=function(){return b.post({url:resource_base+"data/avc_meta_data.json",method:"get_avc",success:function(a){a.data&&a.data.result?l(a.data.result):l()},error:function(a){console.log("AppWizardCtrl getAVCMetaData error "+a.status);l()}})},l=function(b){b&&b["avc-meta-data"]&&(a.model.meta=m.generate(b["avc-meta-data"],!0))},r=function(){return b.post({url:resource_base+"data/application_controller.json",method:"get_app_control",success:function(a){a.data&&a.data.result?v(a.data.result):v()},error:function(a){console.log("AppWizardCtrl getAppControllerData error : "+
a.status);v()}})},v=function(b){b||(b={});var d=b.avc||{},g=d.policy||[];a.model.reachMaxEntity=!1;a.model.enable=void 0!==d.enable?d.enable:!0;a.model.old_enable=a.model.enable;a.model.status=void 0!==b.status?b.status:0;a.model.orig_enable=a.model.enable;a.model.policys=[];angular.forEach(g,function(b){a.model.policys.push(s(b))});a.model.policys.length>=a.maxAVCEntity&&(a.model.reachMaxEntity=!0);a.dataReady=!0;a.resetModified()},s=function(b){b||(b={});var d=b.applications||[],g,e,k={name:b.name||
"",description:b.description||"",enable:void 0!==b.enable?b.enable:!1,ipgroup:"@none",display_ipgroup:"None",origapps:[],apps:[],display_apps:[],schedule:"#always-on",display_schedule:"Always On",exclusions:[],origexclusion:[],meta:angular.copy(a.model.meta)};angular.forEach(b,function(d,g){switch(g){case "schedule":k.schedule=b.schedule||a.model.schedules[0]&&a.model.schedules[0].id||"",k.display_schedule=k.schedule}});k.origname=k.name;angular.forEach(d,function(b){b.seq&&(b.category&&b.behaviour)&&
(b={seq:void 0!==b.seq?b.seq:k.apps.length,category:b.category||"",application:b.application||"",behaviour:b.behaviour||"",action:b.action||"log"},angular.forEach(a.model.meta,function(a){if(g=a.categories[b.category])if("-1"===b.application)angular.forEach(g.applications,function(a){angular.forEach(a.behaviors,function(b){k.display_apps.push({category:g.name,application:a.name,behaviour:b.name})})});else if(e=g.applications[b.application])"-1"===b.behaviour?angular.forEach(e.behaviors,function(a){k.display_apps.push({category:g.name,
application:e.name,behaviour:a.name})}):(be=e.behaviors[b.behaviour])&&k.display_apps.push({category:g.name,application:e.name,behaviour:be.name})}),k.apps.push(b))});k.origapps=angular.copy(k.apps);return k},k=function(){return b.post({url:resource_base+"data/schedule.json",method:"get_schedule",success:function(a){a.data&&a.data.result?d(a.data.result):d()},error:function(a){console.log("AppWizardCtrl getScheduleData error : "+a.status);d()}})},d=function(b){b||(b={});var d=[];b.schedules&&b.schedules.schedule&&
(d=b.schedules.schedule);a.model.schedules=[{id:"#always-on",displayName:"Always On"}];angular.forEach(d,function(b){a.model.schedules.push({id:b.name,displayName:b.name})})};a.dataReady=!1;a.wCurrPage="main";a.model={reachMaxEntity:!1,schema:{},enable:!0,old_enable:!0,status:0,schedules:[],policys:[],meta:[]};a.funs={submit:function(c){var d=!1;angular.forEach(a.model.policys,function(b){c.name===b.name&&(alert('Policy "'+c.name+'" has existed!'),a.edit.name="",a.edit.apps=[],a.edit.display_apps=
[],a.edit.schedule="",a.wCurrPage="main",d=!0)});d||(policy={name:c.name,description:"",applications:c.apps,enable:!0,"device-type":"ANY","os-type":"ANY","apply-ip-group":!1,"ip-groups":"","user-exclusion-entry":[]},"#always-on"===c.schedule?policy["always-on"]=null:policy.schedule=c.schedule,b.post({method:"set_app_control",forcedUsingPost:!0,params:{avc:{enable:a.model.enable,policy:[policy]}},success:function(a){app.TOOLS.get_scope("headerCtrl").enable_save_warning();x(!0)},error:function(a){x(!1)}}))}};
(function(){a.model.schema={global_action:[{id:"null",displayName:"------------------"},{id:"log",displayName:a.DICT("Application_Control_Wizard_Permit_Log")},{id:"pass",displayName:a.DICT("Application_Control_Wizard_Permit")},{id:"block",displayName:a.DICT("Application_Control_Wizard_Block")},{id:"log-block",displayName:a.DICT("Application_Control_Wizard_Block_Log")}],action:[{id:"log",displayName:a.DICT("Application_Control_Wizard_Permit_Log")},{id:"pass",displayName:a.DICT("Application_Control_Wizard_Permit")},
{id:"block",displayName:a.DICT("Application_Control_Wizard_Block")},{id:"log-block",displayName:a.DICT("Application_Control_Wizard_Block_Log")}]};e.all([n(),k(),r()]).then(function(b){l(b[0]&&b[0].data&&b[0].data.result||{});d(b[1]&&b[1].data&&b[1].data.result||{});v(b[2]&&b[2].data&&b[2].data.result||{});a.dataReady=!0;if(a.model.reachMaxEntity)app.TOOLS.criticalAlertBox({msg:a.DICT("Application_Control_Wizard_Max_Policies",{"%s0":a.maxAVCEntity,"%s1":a.maxAVCEntity}),cbk:function(){x(!1)}});else if(0===
a.model.status)app.TOOLS.criticalAlertBox({title:a.DICT("Application_Control_Wizard"),msg:a.DICT("Application_Control_Note",{"%s":'<a ng-click="no(); model.click();">'+a.DICT("Application_Control_Wizard_Smart_Licenses")+"</a>"}),cbk:function(){x(!1)},click:function(){x(!1);q.url("Admin_License/")}});else{var h={model:a.model};p.open({template:"app_control_wizard_dialog.html",closeByDocument:!1,className:"ngdialog-theme-default wizard-page",resolve:{obj:function(){return h}},controller:"app_controll_dialog",
preCloseCallback:function(b){!("$closeButton"===b||"close"===b)?a.funs.submit(b):x(!1)}})}})})()}]);
app.controller("app_controll_dialog",["$scope","obj",function(a,b){var t=function(b){a.show_skip_btn=b.canSkip?!0:!1;a.show_submit_btn=a.current_step===a.step_list.length-1?!0:!1};a.current_step=0;a.show_submit_btn=!1;a.show_skip_btn=!1;a.expandFlag=!1;a.isSubAppEdit=!1;a.model=b.model;a.title=a.DICT("Application_Control_Wizard");a.edit={name:"",display_apps:[],schedule:a.model.schedules[0]&&a.model.schedules[0].id||""};a.step_list=[{name:a.DICT("Application_Control_Wizard_Policy_Name"),templateUrl:"step1.html"},
{name:a.DICT("Application_Control_Wizard_Application_Name"),templateUrl:"step2.html"},{name:a.DICT("Application_Control_Wizard_Schedule"),templateUrl:"step3.html"},{name:a.DICT("Application_Control_Wizard_Summary"),templateUrl:"step4.html"}];a.submit=function(){a.closeThisDialog(a.edit)};a.cancel=function(){a.closeThisDialog("close")};a.next=function(){a.current_step<a.step_list.length&&(a.current_step+=1,t(a.step_list[a.current_step]))};a.back=function(){0<a.current_step&&(a.current_step-=1,t(a.step_list[a.current_step]))};
a.sub_submit=function(){a.isSubAppEdit=!1;a.editSave()};a.sub_cancel=function(){a.isSubAppEdit=!1};a.gridApplicationOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"category",displayName:a.DICT("Application_Control_Wizard_Category")},{field:"application",displayName:a.DICT("Application_Control_Wizard_Application")},{field:"behaviour",displayName:a.DICT("Application_Control_Wizard_Behavior")}]});a.expandAll=function(b){"true"===b?(angular.forEach(a.edit.meta,function(a){a.expanded=!0;angular.forEach(a.categories,
function(a){a.expanded=!0;angular.forEach(a.applications,function(a){a.expanded=!0})})}),a.expandFlag=!0):(angular.forEach(a.edit.meta,function(a){a.expanded=!1;angular.forEach(a.categories,function(a){a.expanded=!1;angular.forEach(a.applications,function(a){a.expanded=!1})})}),a.expandFlag=!1)};a.appEdit=function(){var b=angular.copy(a.model.meta),t,u,p;a.expandFlag=!1;angular.forEach(a.edit.apps,function(a){angular.forEach(b,function(b){b.categories&&b.categories[a.category]&&(t=b.categories[a.category],
"-1"===a.application?(angular.forEach(t.applications,function(b){b.checked=!0;angular.forEach(b.behaviors,function(b){b.checked=!0;b.action=a.action});b.action=a.action}),t.action=a.action):t.applications&&t.applications[a.application]&&(u=t.applications[a.application],"-1"===a.behaviour?(angular.forEach(u.behaviors,function(b){b.checked=!0;b.action=a.action}),u.action=a.action):u.behaviors&&u.behaviors[a.behaviour]&&(p=u.behaviors[a.behaviour],p.checked=!0,p.action=a.action)))})});a.edit.meta=[];
var q=0,e=[],x,n,l;angular.forEach(b,function(a){x=[];angular.forEach(a.categories,function(a){n=[];angular.forEach(a.applications,function(a){l=[];angular.forEach(a.behaviors,function(a){l.push(a)});a.behaviors=angular.copy(l);n.push(a)});a.applications=angular.copy(n);x.push(a)});a.categories=angular.copy(x);e.push(angular.copy(a))});a.edit.meta=e;var r,v,s;angular.forEach(a.edit.meta,function(a){void 0!==a.name&&(a.id="group"+q,q++);r=!1;angular.forEach(a.categories,function(a){v=!1;angular.forEach(a.applications,
function(a){s=!1;angular.forEach(a.behaviors,function(a){a.checked||(s=!0)});!1===s?a.checked=!0:v=!0});!1===v?a.checked=!0:r=!0});!1===r&&(a.checked=!0)});a.isSubAppEdit=!0};a.editSave=function(){a.edit.apps=[];a.edit.display_apps=[];var b=0,t,u,p,q,e,x,n,l,r;angular.forEach(a.edit.meta,function(v){angular.forEach(v.categories,function(s){n=!0;r=[];u=b;q=void 0;angular.forEach(s.applications,function(b){p=void 0;x=e=!0;t=u;l=[];angular.forEach(b.behaviors,function(d){d.checked?(p?p!==d.action&&(e=
!1):p=d.action,a.edit.display_apps.push({seq:t,category:s.name,application:b.name,behaviour:d.name,action:d.action}),l.push({seq:t,category:s.id,application:b.id,behaviour:d.id,action:d.action}),t+=1):x=!1});e&&x?(t=u,l=[{seq:t,category:s.id,application:b.id,behaviour:"-1",action:p}],q||(q=p),t+=1):n=!1;b.checked||(n=!1);q&&q!==p&&(n=!1);u=t;r=r.concat(l)});n?(r=[{seq:b,category:s.id,application:"-1",behaviour:"-1",action:q}],b+=1):b=u;a.edit.apps=a.edit.apps.concat(r)})});a.gridApplicationOptions.data=
a.edit.display_apps};a.change_behaviors=function(a,b){var t="",p=function(a){angular.forEach(a,function(a){a.action=t})},q=function(a){angular.forEach(a,function(a){a.action=t;p(a.behaviors)})},t=a.action;if("null"!==t)switch(b){case "group":angular.forEach(a.categories,function(a){a.action=t;q(a.applications)});break;case "category":q(a.applications);break;case "application":p(a.behaviors)}};a.checkPolicyName=function(){var b=!1;a.edit.name?(angular.forEach(a.model.policys,function(t){a.edit.name===
t.name&&(b=!0)}),b?a.wizardform.step0.name.$setValidity("repeat",!1):a.wizardform.step0.name.$setValidity("repeat",!0)):a.wizardform.step0.name.$setValidity("repeat",!0)};a.gridApplicationOptions.data=a.edit.display_apps;t(a.step_list[0])}]);app.controller("webFilteringCtrl",["$scope","MyHttp","pgWindow","meta_data_service","$q","UserSession","userAccessRight",function(a,b,t,m,w,u,p){var q=app.TOOLS.getResponse,e=app.TOOLS.getVal;a.success=!1;a.expandFlag=!1;a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();var x=function(){b.post({url:resource_base+"data/webfilter_meta_data.json",method:"get_webfilter_meta",success:function(a){a.data&&a.data.result?n(a.data.result):n()},error:function(a){Log(ERROR,
"webFilteringCtrl getWebFilterMetaData error: "+a.status);n()}})},n=function(b){b||(b={});b=b["webfilter-meta-data"]||{};var c=[],d=[],g;b["filter-levels"]&&b["filter-levels"]["filter-level"]&&(c=b["filter-levels"]["filter-level"]);b.categories&&b.categories.category&&(d=b.categories.category);a.model.categories={};a.model.meta=m.generate(b);a.model.levels={};angular.forEach(d,function(b){a.model.categories[b.id]={id:b.id||"",name:b.name||"",description:b.description||""}});angular.forEach(c,function(b,
c){b.level&&(g=b.level,a.model.levels[g]={categories:b.categories&&b.categories[0]&&b.categories[0].split(" ")||[],groups:b.groups&&b.groups[0]&&b.groups[0].split(" ")||[]})})},l=function(){return b.post({url:resource_base+"data/security_content_filter.json",method:"get_content_filter",error:function(a){r()}})},r=function(b){b||(b={});a.model.content_filtering_enable=(b["content-filtering"]||{}).enable||!1},v=function(){return b.post({url:resource_base+"data/web_filtering.json",method:"get_webfilter"})},
s=function(b){b||(b={});var c=b.webfilter||{},d=c.policy||[];a.model.enable=void 0!==c.enable?c.enable:!1;a.model.block_msg=e(c["blocked-page-message"],"");a.model.ori_status=a.model.enable;a.model.status=void 0!==b.status?b.status:0;a.model.orig_enable=a.model.enable;a.model.policys=[];angular.forEach(d,function(b){a.model.policys.push(k(b))});a.gridMainOptions.data=a.model.policys},k=function(b,c){b||(b={});var g=c?"low":b["filtering-level"]||"custom",h={},e={name:b.name||"",checked:!1,description:b.description||
"",enable:void 0!==b.enable?b.enable:!1,filtering_level:g,orig_filtering_level:g,apply_ipgroup:void 0!==b["apply-ip-group"]?b["apply-ip-group"]:!1,web_reputation:void 0!==b["web-reputation"]?b["web-reputation"]:!1,ipgroup:"@none",display_ipgroup:"Any",categories:{low:[],high:[],med:[],custom:[]},block:[],white:[],user_exclusion_ip:[],schedule:"#always-on",display_schedule:"Always On",orig_block_domain:void 0,orig_block_url:void 0,orig_white_domain:void 0,orig_white_url:void 0,orig_user_exclusion:void 0,
orig_ipgroup:void 0,orig_custom_categories:void 0,orig_level_categories:[]},k,l;b["ip-groups"]&&b["ip-groups"][0]&&(e.orig_ipgroup=b["ip-groups"][0],e.ipgroup=b["ip-groups"][0],e.display_ipgroup=b["ip-groups"][0]);b.categories&&b.categories[0]&&(e.orig_custom_categories=b.categories[0],k=b.categories[0].split(" "),angular.forEach(k,function(a){e.categories.custom.push({category:a})}));switch(g){case "low":case "high":case "med":b["custom-categories"]&&angular.forEach(b["custom-categories"],function(a){h[a.category]=
a;a.checked&&(e.orig_level_categories.push({category:a.category}),e.categories[g].push({category:a.category}))}),angular.forEach(a.model.levels[g].categories,function(a){(!h[a]||h[a].checked)&&e.categories[g].push({category:a})})}l=0;b["black-domain-list"]&&b["black-domain-list"][0]&&(e.orig_block_domain=b["black-domain-list"][0],k=b["black-domain-list"][0].split(" "),angular.forEach(k,function(b){e.block.push({id:l,selected:!1,edit:!1,type:{select:"domain",list:angular.copy(a.model.schema.blockList)},
value:b});l+=1}));b["black-url-keyword-list"]&&b["black-url-keyword-list"][0]&&(e.orig_block_url=b["black-url-keyword-list"][0],k=b["black-url-keyword-list"][0].split(" "),angular.forEach(k,function(b){e.block.push({id:l,selected:!1,edit:!1,type:{select:"keyword",list:angular.copy(a.model.schema.blockList)},value:b});l+=1}));l=0;b["white-domain-list"]&&b["white-domain-list"][0]&&(e.orig_white_domain=b["white-domain-list"][0],k=b["white-domain-list"][0].split(" "),angular.forEach(k,function(b){e.white.push({id:l,
selected:!1,edit:!1,type:{select:"domain",list:angular.copy(a.model.schema.whiteList)},value:b});l+=1}));b["white-url-keyword-list"]&&b["white-url-keyword-list"][0]&&(e.orig_white_url=b["white-url-keyword-list"][0],k=b["white-url-keyword-list"][0].split(" "),angular.forEach(k,function(b){e.white.push({id:l,selected:!1,edit:!1,type:{select:"keyword",list:angular.copy(a.model.schema.whiteList)},value:b});l+=1}));b["user-exclusion-ip"]&&(k=b["user-exclusion-ip"],angular.forEach(k,function(a,b){e.user_exclusion_ip.push(d(a,
b))}),e.orig_user_exclusion=angular.copy(e.user_exclusion_ip));angular.forEach(b,function(a,b){switch(b){case "schedule":e.schedule=a,e.display_schedule=a}});return e},d=function(b,c){b||(b={});var d="ipv4-ip",g="",h="",e="",k="",l="",r="",n;b.ipv4?(n=b.ipv4,n.single?(g=n.single||"",d="ipv4-ip"):n.range&&(e=n.range.start||"",k=n.range.end||"",d="ipv4-range")):b.ipv6&&(n=b.ipv6,n.single?(h=n.single||"",d="ipv6-ip"):n.range&&(l=n.range.start||"",r=n.range.end||"",d="ipv6-range"));return{seq:void 0!==
b.seq?b.seq:"",empty:"",id:void 0!==c?c:0,selected:!1,edit:!1,ips:{select:d,list:a.model.schema.userExclusionList,v4_ip:g||"",v6_ip:h||"",v4_rangeS:e||"",v6_rangeS:l||"",v4_rangeE:k||"",v6_rangeE:r||""}}},c=function(b){b||(b={});var c=[],d,g;b["ip-groups"]&&b["ip-groups"]["ip-group"]&&(c=b["ip-groups"]["ip-group"]);a.model.ipgroups=[{id:"@none",displayName:a.DICT("Web_Filtering_Any")}];a.model.ipgroup_map={};a.model.ex_ipgroups=[];angular.forEach(c,function(b){g=b.name;a.model.ex_ipgroups.push({id:g,
displayName:g});d=[];angular.forEach(b.ips,function(b){b.ipv4?angular.forEach(b.ipv4,function(b,c){switch(c){case "single":d.push({type:a.DICT("Web_Filtering_IP_Address"),rule:b});break;case "subnet":d.push({type:a.DICT("Web_Filtering_Subnet"),rule:b.ip+"/"+app.TOOLS.netmask.inet2Int(b.netmask)});break;case "range":d.push({type:a.DICT("Web_Filtering_Range"),rule:b.start+" - "+b.end})}}):b.ipv6&&angular.forEach(b.ipv6,function(b,c){switch(c){case "single":d.push({type:a.DICT("Web_Filtering_IP_Address"),
rule:b});break;case "subnet":d.push({type:a.DICT("Web_Filtering_Subnet"),rule:b.ip+"/"+b["prefix-length"]});break;case "range":d.push({type:a.DICT("Web_Filtering_Range"),rule:b.start+" - "+b.end})}})});a.model.ipgroup_map[g]=d});a.model.ipgroups=a.model.ipgroups.concat(a.model.ex_ipgroups)},h=function(b){b||(b={});var c=[];b.schedules&&b.schedules.schedule&&(c=b.schedules.schedule);a.model.schedules=[{id:"#always-on",displayName:a.DICT("Always_On")}];angular.forEach(c,function(b){a.model.schedules.push({id:b.name,
displayName:a.DICT(b.name)})})},g=function(){a.dataReady=!1;a.del_policys=[];w.all([v(),l()]).then(function(b){s(b[0]&&b[0].data&&b[0].data.result||{});r(b[1]&&b[1].data&&b[1].data.result||{});a.dataReady=!0;a.resetModified()})};t=function(b){return function(c){c=a.edit["edit_"+b];var d=c.length,g;for(g=a.sel_cnts[b]=0;g<d;g++)c[g].selected&&(a.sel_cnts[b]+=1)}};u=function(b){a.sel_policy_cnts=0;angular.forEach(a.model.policys,function(b){b.checked&&a.sel_policy_cnts++})};var A={main:"main",policy_edit:"policy_edit",
category_edit:"category_edit",customer_rules:"customer_rules"};a.currPage=A.main;a.sel_policy_cnts=0;a.dataReady=!1;a.edit;a.orig;a.del_policys=[];a.model={content_filtering_enable:!1,enable:!1,ori_status:!1,status:0,orig_enable:!1,meta:{},levels:{},ipgroups:[],ipgroup_map:{},ex_ipgroups:[],schedules:[],categories:{},show_ipgroup:!1,ipgroupnote:!1,urllookup:{url:"",category:"--",reputation:"--",status:"--"},block_msg:""};a.sel_cnts={white:0,block:0,user_exclusion_ip:0};a.check_ip_group_detail=function(){var b=
a.edit,c=a.model.show_ipgroup;b&&(a.model.show_ipgroup=!1,"@none"!==b.ipgroup&&a.model.ipgroup_map[b.ipgroup]&&(a.gridIPGroupsOptions.data=a.model.ipgroup_map[b.ipgroup],a.model.show_ipgroup=!0,c||(a.model.ipgroupnote=!0,setTimeout(function(){a.model.ipgroupnote=!1;app.TOOLS.apply(a)},2E3)),app.TOOLS.apply(a)))};a.gridMainOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:u,headerChangedCbk:u},{field:"name",displayName:a.DICT("Web_Filtering_Policies")},{field:"display_schedule",
displayName:a.DICT("Web_Filtering_Schedule_Names")},{field:"display_ipgroup",displayName:a.DICT("Web_Filtering_IP_Group")},{field:"web_reputation",displayName:a.DICT("Web_Filtering_Web_Reputation_N"),id:"web_reputation",cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"enable",displayName:a.DICT("Web_Filtering_Enable_N"),id:"enable",cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});a.gridCategoryOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"category",displayName:a.DICT("Web_Filtering_Category")}]});
a.gridWhiteInvalidCbk=function(a){a.row.entity.disableWhiteChk=a.rowInvalid};a.gridWhiteOptions=app.uiGrid.generateGridOptions({IDPreifx:"exceptionwhite",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:t("white"),headerChangedCbk:t("white"),disableChkBoxField:"disableWhiteChk"},{field:"type",displayName:a.DICT("Web_Filtering_Type"),editRow:"edit",width:150,id:"white_type",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"value",displayName:a.DICT("Web_Filtering_Value"),editRow:"edit",
validation:"type",id:"white_value",cellTemplate:"T_table_web_filter.html",required:!0,validationCbk:"gridWhiteInvalidCbk"}]});a.gridBlackInvalidCbk=function(a){a.row.entity.disableBlackChk=a.rowInvalid};a.gridBlockOptions=app.uiGrid.generateGridOptions({IDPreifx:"exceptionblock",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:t("block"),headerChangedCbk:t("block"),disableChkBoxField:"disableBlackChk"},{field:"type",displayName:a.DICT("Web_Filtering_Type"),editRow:"edit",width:150,id:"block_type",
cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"value",displayName:a.DICT("Web_Filtering_Value"),editRow:"edit",id:"value",validation:"type",cellTemplate:"T_table_web_filter.html",required:!0,validationCbk:"gridBlackInvalidCbk"}]});a.gridIPGroupsOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"type",displayName:a.DICT("Web_Filtering_Type")},{field:"rule",displayName:a.DICT("Web_Filtering_Address")}]});a.gridExclusionInvalidCbk=function(a){a.row.entity.disableExclusionChk=
a.rowInvalid};a.gridExclusionOptions=app.uiGrid.generateGridOptions({IDPreifx:"exceptionexclusion",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:t("user_exclusion_ip"),headerChangedCbk:t("user_exclusion_ip"),disableChkBoxField:"disableExclusionChk"},{field:"ips",displayName:a.DICT("Web_Filtering_Type"),editRow:"edit",width:150,id:"exclusion",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"ips",displayName:a.DICT("Web_Filtering_IP_Addr"),editRow:"edit",autosize:!0,id:"exclusion",
validationCbk:"gridExclusionInvalidCbk",cellTemplate:"webfilter_exclusion_value.html",required:!0,minWidth:640}]});var y=function(b){if(a.edit){var c=a.edit.filtering_level;if(b||"high"!==c)a.edit.categories.high=[],angular.forEach(a.model.levels.high.categories,function(b){a.edit.categories.high.push({category:b})});if(b||"low"!==c)a.edit.categories.low=[],angular.forEach(a.model.levels.low.categories,function(b){a.edit.categories.low.push({category:b})});if(b||"med"!==c)a.edit.categories.med=[],
angular.forEach(a.model.levels.med.categories,function(b){a.edit.categories.med.push({category:b})});if(b||"custom"!==c)a.edit.categories.custom=[]}};a.changeLevel=function(){var b=a.edit.meta,c=a.edit.filtering_level;angular.forEach(b,function(a){angular.forEach(a.categories,function(a){a.checked=!1})});switch(a.edit.filtering_level){case "high":case "med":case "low":case "custom":angular.forEach(b,function(b){angular.forEach(b.categories,function(b){angular.forEach(a.edit.categories[c],function(a){a.category===
b.id&&(b.checked=!0)})})})}a.edit.meta=b};var z=function(){var b=a.edit.meta,c=a.edit.filtering_level;a.edit.categories[c]=[];a.edit.display_categories=[];angular.forEach(b,function(b){angular.forEach(b.categories,function(b){b.checked&&(a.edit.categories[c].push({category:b.id}),a.edit.display_categories.push({category:b.name}))})})},B=function(){return 50<=a.model.policys.length?(a.msg="Only allow maximum of 50 entries for Web Filtering Policies. (Current Entry Number: "+a.model.policys.length+
")",app.TOOLS.criticalAlertBox({msg:a.DICT("Web_Filtering_Max_Policy",{"%d":a.model.policys.length}),cbk:function(a){}}),!0):!1},D=function(){return 30<=a.edit.edit_white.length?(a.msg="Only allow maximum of 30 entries for White List. (Current Entry Number: "+a.edit.edit_white.length+")",app.TOOLS.criticalAlertBox({msg:a.DICT("Web_Filtering_White_List_Max",{"%d":a.edit.edit_white.length}),cbk:function(a){}}),!0):!1},E=function(){return 30<=a.edit.edit_block.length?(a.msg="Only allow maximum of 30 entries for Black List. (Current Entry Number: "+
a.edit.edit_block.length+")",app.TOOLS.criticalAlertBox({msg:a.DICT("Web_Filtering_Black_List_Max",{"%d":a.edit.edit_block.length}),cbk:function(a){}}),!0):!1},C=function(){return 30<=a.edit.edit_user_exclusion_ip.length?(a.msg="Only allow maximum of 30 entries for Exclusion List. (Current Entry Number: "+a.edit.edit_user_exclusion_ip.length+")",app.TOOLS.criticalAlertBox({msg:a.DICT("Web_Filtering_Exclusion_List_Max",{"%d":a.edit.edit_user_exclusion_ip.length}),cbk:function(a){}}),!0):!1},I=function(){var b=
{webfilter:{"blocked-page-message":a.model.block_msg}};a.model.enable!==a.model.orig_enable&&(a.model.enable&&a.model.content_filtering_enable&&(b["content-filtering"]={enable:!a.model.enable}),b.webfilter.enable=a.model.enable);return{has_modify:!0,param:b}},G=function(c){b.post({method:"del_webfilter",params:{webfilter:{policy:a.del_policys}},success:function(){"function"===$.type(c)&&c()},error:function(){"function"===$.type(c)&&c()}})},H=function(){a.gridCategoryOptions.data=a.edit.display_categories;
a.gridWhiteOptions.data=a.edit.edit_white;a.gridBlockOptions.data=a.edit.edit_block;a.gridExclusionOptions.data=a.edit.edit_user_exclusion_ip};a.funs={main:{add:function(){if(!B()){var b=0;a.edit=k({},!0);a.orig=void 0;a.edit.checked=!0;a.edit.meta=angular.copy(a.model.meta);angular.forEach(a.edit.meta,function(a){void 0!==a.name&&(a.id="group"+b,b++)});a.check_ip_group_detail();a.expandFlag=!1;a.edit.type="add";y(!0);a.changeLevel();z();H();a.currPage=A.policy_edit;a.modified()}},edit:function(){a.edit=
void 0;angular.forEach(a.model.policys,function(b){b.checked&&(a.edit=angular.copy(b),a.orig=angular.copy(b))});a.edit?(a.edit.meta=angular.copy(a.model.meta),a.check_ip_group_detail(),a.expandFlag=!1,a.edit.type="edit",y(),a.changeLevel(),z(),H(),a.currPage=A.policy_edit):Log(ERROR,"policy edit button error, checked item is not exist")},del:function(){for(var b=a.model.policys.length-1;0<=b;b--)a.model.policys[b].checked&&(a.del_policys.push({name:a.model.policys[b].name}),a.modified(),a.model.policys.splice(b,
1))},save:function(){var c=I(),d=function(){b.post({method:"set_webfilter",params:c.param,success:function(){a.success=!0;g()},error:function(){g()}})};c.has_modify?a.del_policys.length?G(d):d():a.del_policys.length&&G(function(){a.success=!0;g()})},cancel:function(){g()}},policy:{save:function(){var c,d=a.edit,h="",e="",k="",l="",n=[],r=[],z="",m={},s=!1,v=d.filtering_level,y,B,q=function(){var c=I(),n={},m={name:d.name,enable:d.enable,description:d.description,"apply-ip-group":"@none"===d.ipgroup?
!1:!0,"web-reputation":d.web_reputation,"black-domain-list":[h],"black-url-keyword-list":[e],"white-domain-list":[k],"white-url-keyword-list":[l],"user-exclusion-ip":r};"custom"===v?m.categories=[z]:(m["filtering-level"]=v,m["custom-categories"]=[],angular.forEach(d.categories[v],function(a){n[a.category]=!0;m["custom-categories"].push({category:a.category,checked:!0})}),angular.forEach(a.model.levels[v].categories,function(a){n[a]||m["custom-categories"].push({category:a,checked:!1})}));"@none"!==
d.ipgroup&&(m["ip-groups"]=[d.ipgroup]);"#always-on"===d.schedule?m["always-on"]=null:m.schedule=d.schedule;c.param.webfilter.policy=[m];b.post({method:"set_webfilter",params:c.param,success:function(){a.success=!0;g();a.currPage=A.main},error:function(){g();a.currPage=A.main}})};angular.forEach(d.block,function(a){"keyword"===a.type.select?e=e+a.value+" ":h=h+a.value+" "});angular.forEach(d.white,function(a){"keyword"===a.type.select?l=l+a.value+" ":k=k+a.value+" "});angular.forEach(d.user_exclusion_ip,
function(a,b){y={seq:b+1};switch(a.ips.select){case "ipv4-ip":angular.extend(y,{ipv4:{single:a.ips.v4_ip}});break;case "ipv4-range":angular.extend(y,{ipv4:{range:{start:a.ips.v4_rangeS,end:a.ips.v4_rangeE}}});break;case "ipv6-ip":angular.extend(y,{ipv6:{single:a.ips.v6_ip}});break;case "ipv6-range":angular.extend(y,{ipv6:{range:{start:a.ips.v6_rangeS,end:a.ips.v6_rangeE}}});break;default:return}r.push(y)});angular.forEach(d.orig_user_exclusion,function(a){B=!0;angular.forEach(r,function(b){a.seq===
b.seq&&(B=!1)});B&&n.push({seq:a.seq})});"custom"===v&&angular.forEach(d.categories.custom,function(a){z=z+a.category+" "});h=h.trim();e=e.trim();k=k.trim();l=l.trim();z=z.trim();a.orig&&(c=a.orig,s=!1,m={name:d.name},d.orig_block_domain&&d.orig_block_domain!==h&&(m["black-domain-list"]=[d.orig_block_domain],s=!0),d.orig_block_url&&d.orig_block_url!==e&&(m["black-url-keyword-list"]=[d.orig_block_url],s=!0),d.orig_white_domain&&d.orig_white_domain!==k&&(m["white-domain-list"]=[d.orig_white_domain],
s=!0),d.orig_white_url&&d.orig_white_url!==l&&(m["white-url-keyword-list"]=[d.orig_white_url],s=!0),n.length&&(m["user-exclusion-ip"]=n,s=!0),d.orig_ipgroup&&d.orig_ipgroup!==d.ipgroup&&(m["ip-groups"]=[d.orig_ipgroup],s=!0),"custom"===d.filtering_level&&("custom"===c.filtering_level&&d.orig_custom_categories&&d.orig_custom_categories!==z)&&(m.categories=[d.orig_custom_categories],s=!0),"custom"!==d.filtering_level&&c.orig_level_categories.length&&(m["custom-categories"]=c.orig_level_categories,s=
!0),c=angular.copy(a.del_policys),c.push(m),s&&b.post({method:"del_webfilter",params:{webfilter:{policy:c}},success:function(a){q()},error:function(a){q()}}));s||(a.del_policys.length?G(q):q())},cancel:function(){a.currPage=A.main;g()},goToCategoryPage:function(){a.currPage=A.category_edit},goToException:function(){a.sel_cnts.white=0;a.sel_cnts.block=0;a.sel_cnts.user_exclusion_ip=0;a.edit.edit_white=angular.copy(a.edit.white);a.edit.edit_block=angular.copy(a.edit.block);a.edit.edit_user_exclusion_ip=
angular.copy(a.edit.user_exclusion_ip);H();a.edit.white_len=a.edit.white.length;a.edit.block_len=a.edit.block.length;a.edit.user_exclusion_ip_len=a.edit.user_exclusion_ip.length;a.currPage=A.customer_rules}},filter:{save:function(){z();H();a.edit.orig_filtering_level=a.edit.filtering_level;a.currPage=A.policy_edit},cancel:function(){a.edit.filtering_level=a.edit.orig_filtering_level;a.currPage=A.main},back:function(){a.edit.filtering_level=a.edit.orig_filtering_level;a.currPage=A.policy_edit},restore:function(){a.edit.filtering_level=
"low";y(!0);a.changeLevel()}},customer:{add:function(b){switch(b){case "block":if(E())return;a.edit.edit_block.push({id:a.edit.block_len,selected:!0,edit:!0,empty:"",type:{select:a.model.schema.blockList[0]&&a.model.schema.blockList[0].id||"",list:angular.copy(a.model.schema.blockList)},value:""});a.edit.block_len+=1;a.sel_cnts.block+=1;break;case "white":if(D())return;a.edit.edit_white.push({id:a.edit.white_len,selected:!0,edit:!0,empty:"",type:{select:a.model.schema.whiteList[0]&&a.model.schema.whiteList[0].id||
"",list:angular.copy(a.model.schema.whiteList)},value:""});a.edit.white_len+=1;a.sel_cnts.white+=1;break;case "user_exclusion_ip":if(C())return;b=d();b.seq=a.edit.edit_user_exclusion_ip.length;b.id=a.edit.edit_user_exclusion_ip.length;b.edit=!0;b.selected=!0;a.edit.edit_user_exclusion_ip.push(b);a.edit.user_exclusion_ip_len+=1;a.sel_cnts.user_exclusion_ip+=1}a.modified()},del:function(b){var c=a.edit;switch(b){case "block":for(b=c.edit_block.length-1;0<=b;b--)c.edit_block[b].selected&&(c.edit_block.splice(b,
1),a.modified(),a.sel_cnts.block-=1);break;case "white":for(b=c.edit_white.length-1;0<=b;b--)c.edit_white[b].selected&&(c.edit_white.splice(b,1),a.modified(),a.sel_cnts.white-=1);break;case "user_exclusion_ip":for(b=c.edit_user_exclusion_ip.length-1;0<=b;b--)c.edit_user_exclusion_ip[b].selected&&(c.edit_user_exclusion_ip.splice(b,1),a.modified(),a.sel_cnts.user_exclusion_ip-=1)}},edit:function(b){var c=a.edit;switch(b){case "block":angular.forEach(c.edit_block,function(a){a.selected&&(a.edit=!0)});
break;case "white":angular.forEach(c.edit_white,function(a){a.selected&&(a.edit=!0)});break;case "user_exclusion_ip":angular.forEach(c.edit_user_exclusion_ip,function(a){a.selected&&(a.edit=!0)})}},save:function(){angular.forEach(a.edit.edit_block,function(a){a.selected=!1;a.edit=!1});angular.forEach(a.edit.edit_white,function(a){a.selected=!1;a.edit=!1});angular.forEach(a.edit.edit_user_exclusion_ip,function(a){a.selected=!1;a.edit=!1});a.edit.block=a.edit.edit_block;a.edit.white=a.edit.edit_white;
a.edit.user_exclusion_ip=a.edit.edit_user_exclusion_ip;a.currPage=A.policy_edit},cancel:function(){a.currPage=A.main},back:function(){a.currPage=A.policy_edit}},urllookup:function(){var c=function(b){b=b&&b.data&&b.data.result&&b.data.result.output||{};var c,d="";(c=b.category.split(","))&&angular.forEach(c,function(b){d&&(d+=", ");d=a.model.categories[b]?d+a.model.categories[b].name:d+b});d||(d="--");a.model.urllookup.category=d;a.model.urllookup.reputation=b.reputation||"--";a.model.urllookup.status=
b.status||"--"};(function(){b.post({url:resource_base+"data/urllookup.json",method:"action",params:{input:{url:a.model.urllookup.url},rpc:"url-lookup"},procBackground:!0,success:function(a){c(a)},error:function(a){Log(ERROR,"[webFilteringCtrl] urllookup() RPC error")}})})()}};a.changeEnable=function(){if(a.model.enable&&a.model.content_filtering_enable&&a.model.ori_status!==a.model.enable){var b="<div>"+a.DICT("Web_Filtering_Msg1")+"</div>",b=b+"<div>"+a.DICT("Web_Filtering_Msg2")+"</div>",b=b+"<div>"+
a.DICT("Web_Filtering_Msg3")+"</div>";app.TOOLS.warningAlertBox({msg:b,btn_yes_str:a.DICT("Web_Filtering_Apply"),btn_no_str:a.DICT("Web_Filtering_Cancel"),width:550,cbk:function(b){b||(a.model.enable=!a.model.enable)}})}};a.checkPolicyName=function(){var b=!0;if(!a.edit.name||a.orig)return b;angular.forEach(a.model.policys,function(c){a.edit.name===c.name&&(b=!1)});return b};a.expandAll=function(b){"true"===b?(angular.forEach(a.edit.meta,function(a){a.expanded=!0;angular.forEach(a.categories,function(a){a.expanded=
!0})}),a.expandFlag=!0):(angular.forEach(a.edit.meta,function(a){a.expanded=!1;angular.forEach(a.categories,function(a){a.expanded=!1})}),a.expandFlag=!1)};a.combineNote=a.DICT("Web_Filtering_Note",{"%s":'<a id="link" href="#/Admin_License"><u>'+a.DICT("Web_Filtering_Here")+"</u></a>"});a.combineMsg1=a.DICT("Web_Filtering_URL_Msg1",{"%s":'<a target="#" href="http://www.brightcloud.com/tools/change-request-url-categorization.php"><span style="text-decoration: underline;">'+a.DICT("Web_Filtering_Here")+
"</span></a>"});a.combineMsg2=a.DICT("Web_Filtering_URL_Msg2",{"%s":'<a target="#" href="http://www.brightcloud.com/tools/change-request-url-reputation.php"><span style="text-decoration: underline;">'+a.DICT("Web_Filtering_Here")+"</span></a>"});(function(){a.dataReady=!1;a.del_policys=[];a.model.schema={blockList:[{id:"domain",displayName:a.DICT("Web_Filtering_Domain_Name")},{id:"keyword",displayName:a.DICT("Web_Filtering_Keyword")}],whiteList:[{id:"domain",displayName:a.DICT("Web_Filtering_Domain_Name")},
{id:"keyword",displayName:a.DICT("Web_Filtering_Keyword")}],userExclusionList:[{id:"ipv4-ip",displayName:a.DICT("Web_Filtering_IPv4_Addr")},{id:"ipv4-range",displayName:a.DICT("Web_Filtering_IPv4_Range")},{id:"ipv6-ip",displayName:a.DICT("Web_Filtering_IPv6_Addr")},{id:"ipv6-range",displayName:a.DICT("Web_Filtering_IPv6_Range")}]};x();w.all([v(),b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup"}),b.post({url:resource_base+"data/schedule.json",method:"get_schedule"}),l()]).then(function(b){c(q(b,
1));h(q(b,2));s(q(b,0));r(q(b,3));a.dataReady=!0})})()}]);app.controller("DashboardCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","dt","$uibModal",function(a,b,t,m,w,u,p){var q=app.TOOLS.getVal,e=app.TOOLS.str2int,x=app.TOOLS.int2str2,n=app.TOOLS.getResponse,l=void 0,r=void 0;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var v=function(){return b.post({method:"get_time",url:resource_base+"data/time.json",error:function(a){Log(ERROR,"[Dashboard] getSystemState Error "+
JSON.stringify(a));s()}})},s=function(b){b||(b={});b=u.parser(((b["system-state"]||{}).clock||{})["current-datetime"]||"");0===b.err_code?(a.model.sys_timestamp=u.get_time(b),a.model.standard_timestamp=u.get_time(b)):(a.model.sys_time="-",a.model.sys_timestamp=void 0,a.model.standard_timestamp=void 0);F();H()},k=function(a,b,c){b||(b={});var d=b.summary||[];b=b["last-reset-time"]||"";var g=!1,h=!1,e=!1,k=!1,l=function(a,b){_.isNumber(a.scanned)&&a.scanned>b&&(a.scanned=b+"+");_.isNumber(a.detected)&&
a.detected>b&&(a.detected=b+"+")},n=999;"total"===c&&(n=1998);a.time="-";b&&(c=u.parser(b),0===c.err_code&&(a.time=u.timeStr(c)));angular.forEach(a,function(a,b){switch(b){case "today":case "week":case "month":case "total":a.scanned="-",a.detected="-"}});angular.forEach(d,function(b){1===b.months&&(0===b.weeks&&0===b.days&&0===b.hours)&&(a.month.scanned=q(b.scanned,"-"),a.month.detected=q(b.detected,"-"),l(a.month,n),e=!0);0===b.months&&(1===b.weeks&&0===b.days&&0===b.hours)&&(a.week.scanned=q(b.scanned,
"-"),a.week.detected=q(b.detected,"-"),l(a.week,n),h=!0);0===b.months&&(0===b.weeks&&1===b.days&&0===b.hours)&&(a.today.scanned=q(b.scanned,"-"),a.today.detected=q(b.detected,"-"),l(a.today,n),g=!0);1!==b.months+b.weeks+b.days+b.hours&&a.total&&(a.total.scanned=q(b.scanned,"-"),a.total.detected=q(b.detected,"-"),l(a.total,n),k=!0)});!k&&a.total&&(e?(a.total.scanned=a.month.scanned,a.total.detected=a.month.detected):h?(a.total.scanned=a.week.scanned,a.total.detected=a.week.detected):g&&(a.total.scanned=
a.today.scanned,a.total.detected=a.today.detected),l(a.total,n))},d=function(){return b.post({method:"get_security_state",url:resource_base+"data/get_security_state.json",error:function(a){c();Log(ERROR,"[Dashboard] getSecurityState Error "+JSON.stringify(a))}})},c=function(b){b||(b={});var c=b["security-state"]||{};b=c.events||[];var d=b.length,g,h,l,n=a.model.standard_timestamp,r={},z={},m={},s=a.model.total,v=s.today,A=s.week,y=s.month;k(a.model.total,c,"total");v.events=[];A.events=[];y.events=
[];v.labels=[];A.labels=[];y.labels=[];if(!d||!_.isNumber(n)){for(c=0;24>c;c++)v.events.push(0),v.labels.push("");for(c=0;7>c;c++)A.events.push(0),A.labels.push("");for(c=0;31>c;c++)y.events.push(0),y.labels.push("")}else{n=a.model.standard_timestamp;for(c=0;24>c;c++)d=u.new_date(n-36E5*c),v.events[c]=0,v.colors[c]="#4BBEC5",v.labels[c]=x(d.hour)+":00",r[u.timeStr(d,"YYYY-MM-DD hh")]=c;n=a.model.standard_timestamp;for(c=0;31>c;c++)d=u.new_date(n-864E5*c),7>c&&(A.events[c]=0,A.colors[c]="#4BBEC5",
A.labels[c]=u.dayWeekStr[d.day_week],z[u.timeStr(d,"YYYY-MM-DD")]=c),y.events[c]=0,y.colors[c]="#4BBEC5",y.labels[c]=u.timeStr(d,"MM/DD"),m[u.timeStr(d,"YYYY-MM-DD")]=c;angular.forEach(b,function(a){g=u.parser(a.date);0!==g.err_code?Log(DEBUG,"[DashboardCtrl] procSecurityState() Err, date is incorrect"+JSON.stringify(a)):(l=e(q(a["event-num"],0)),h=u.timeStr(g,"YYYY-MM-DD"),void 0!==m[h]&&(y.events[m[h]]+=l),void 0!==z[h]&&(A.events[z[h]]+=l),h=u.timeStr(g,"YYYY-MM-DD hh"),void 0!==r[h]&&(v.events[r[h]]+=
l))});v.events.reverse();v.labels.reverse();v.colors.reverse();A.events.reverse();A.labels.reverse();A.colors.reverse();y.events.reverse();y.labels.reverse();y.colors.reverse()}},h=function(){t.all([v(),d(),y(),g(),B("threat"),B("ips"),E(),I()]).then(function(b){s(n(b,0));var d=n(b,2);d||(d={});d=q(d.status,0);a.model.no_license=0===d;a.model.no_license?(c({}),z({}),A({}),D({},"threat"),D({},"ips"),C({},"threat"),C({},"ips")):(c(n(b,1)),z(n(b,2)),A(n(b,3)),D(n(b,4),"threat"),D(n(b,5),"ips"),C(n(b,
6),"threat"),C(n(b,7),"ips"));G();a.ui_data.data_ready=!0})},g=function(){return b.post({method:"get_ips_state",url:resource_base+"data/get_ips_state.json",error:function(a){Log(ERROR,"[Dashboard] getIPSState() error "+JSON.stringify(a))}})},A=function(b){b||(b={});k(a.model.ips,b["ips-state"]||{},"ips")},y=function(){return b.post({method:"get_anti_virus_state",url:resource_base+"data/get_anti_virus_state.json",error:function(a){Log(ERROR,"[Dashboard] getAntiVirusState() error "+JSON.stringify(a));
A()}})},z=function(b){b||(b={});k(a.model.threat,b["anti-virus-state"]||{},"virus")},B=function(c){var d=resource_base+"data/get_top_clients.json";switch(c){case "ips":c="ips";d=resource_base+"data/get_top_clients.json";break;default:c="threat",d=resource_base+"data/get_top_clients.json"}return b.post({method:"action",url:d,params:{rpc:"get-top-clients",input:{num:a.ui_data.top_cnt,type:c}},error:function(a){Log(ERROR,"[Dashboard] getTopClients() error , type "+c+" errstr "+JSON.stringify(a));D(void 0,
c)}})},D=function(b,c){b||(b={});var d=(b.output||{}).clients||[],g,h,e,k,l;switch(c){case "ips":g=a.model.ips.top_client;l="attacks-count";break;default:g=a.model.threat.top_client,l="threats-count"}g.info=[];g.labels=[];g.data=[];angular.forEach(d,function(a){e=q(a[l],1);k=q(a.hostname,"-");h={mac:a.mac||"-",ipv4_address:a["ipv4-address"]||"-",ipv6_address:a["ipv6-address"]||"-",hostname:k,device_type:a["device-type"]||"-",os_type:a["os-type"]||"-",count:e};g.info.push(h);g.data.push(e);g.labels.push(k)});
g.data.length||(g.data.push(1),g.labels.push(["empty"]))},E=function(){return b.post({method:"action",url:resource_base+"data/get_top_threats.json",params:{rpc:"get-top-threats",input:{num:a.ui_data.top_cnt}},error:function(a){Log(ERROR,"[Dashboard] getTopThreats() error "+JSON.stringify(a));C(void 0,"threat")}})},C=function(b,c){b||(b={});var d=(b.output||{}).attacks||[],g,h,e,k;switch(c){case "ips":k=a.model.ips.top_ips;break;default:k=a.model.threat.top_threats}k.info=[];k.data=[];k.labels=[];
angular.forEach(d,function(a){e=q(a["clients-count"],1);h=q(a.id,"-");g={id:h,name:a.name||"-",impact:a.impact||"-",description:a.description||"-",recommendation:a.recommendation||"-",reference:a.reference||"-",issue_date:u.genTimeStrByTimeStamp(a["issue-date"],"-"),updated_date:u.genTimeStrByTimeStamp(a["updated-date"],"-"),category:a.category||"-",severity:a.severity||"-",count:e};k.info.push(g);k.data.push(e);k.labels.push(h)});k.info.length||(k.data.push(1),k.labels.push(["empty"]))},I=function(){return b.post({method:"action",
url:resource_base+"data/get_top_attacks.json",params:{rpc:"get-top-attacks",input:{num:a.ui_data.top_cnt}},error:function(a){Log(ERROR,"[Dashboard] getTopIPS() error "+JSON.stringify(a));C(void 0,"ips")}})},G=function(){angular.forEach(a.ui_data.tabs,function(b){b.active=b.name===a.ui_data.tab_sel})},H=function(){l&&(clearInterval(l),l=void 0);l=setInterval(function(){_.isNumber(a.model.sys_timestamp)?(a.model.sys_timestamp+=1E3,F()):clearInterval()},1E3)},F=function(){var b;_.isNumber(a.model.sys_timestamp)?
(b=u.new_date(a.model.sys_timestamp),a.model.sys_time=u.timeStr(b),K()):a.model.sys_time="-"},K=function(){r&&clearTimeout(r);r=setTimeout(function(){app.TOOLS.apply(a);r=void 0},20)};a.edit=void 0;a.detail=void 0;a.ui_data={today_boundary:Number.MAX_SAFE_INTEGER,week_boundary:Number.MAX_SAFE_INTEGER,month_boundary:Number.MAX_SAFE_INTEGER,data_ready:!1,tabs:[{heading:a.DICT("Dashboard_Total"),templateUrl:"dashboard_total.htm",name:"total",active:!1},{heading:a.DICT("Dashboard_Threat"),templateUrl:"dashboard_threat.htm",
name:"threat",active:!1},{heading:a.DICT("Dashboard_IPS"),templateUrl:"dashboard_ips.htm",name:"ips",action:!1}],tab_sel:"total",evt_list:[{id:"today",displayName:a.DICT("Dashboard_Last_24_Hours")},{id:"week",displayName:a.DICT("Dashboard_Last_Week")},{id:"month",displayName:a.DICT("Dashboard_Last_Month")}],evt_serious:["number"],evt_month_labels:[],evt_week_labels:[],evt_day_labels:[],evt_sel:"today",evt_colors:app.chart.backgroundColors,evt_options:{animation:!1,maintainAspectRatio:!1,tooltips:{callbacks:{label:function(a,
b){var c=b.datasets[a.datasetIndex].data[a.index];b.labels[a.index]||(c="Empty");0===c&&(c+="");return c}}},scales:{xAxes:[{gridLines:{display:!1},categoryPercentage:0.8,barPercentage:1}],yAxes:[{min:0,ticks:{beginAtZero:!0,suggestedMin:0,suggestedMax:100}}]}},top_cnt:10,pie_options:{animation:!1,maintainAspectRatio:!1,tooltips:{callbacks:{label:function(a,b){var c=b.labels[a.index],d=": "+b.datasets[a.datasetIndex].data[a.index];return c=_.isArray(c)&&"empty"===c[0]?"Empty: 0":c+d}}}},combineNote:a.DICT("Dashboard_Note",
{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Here")+"</u></a>"})};a.model={no_license:!0,sys_time:"",sys_timestamp:void 0,standard_timestamp:void 0,total:{time:"",today:{scanned:"",detected:"",labels:[],events:[],colors:[]},week:{scanned:"",detected:"",labels:[],events:[],colors:[]},month:{scanned:"",detected:"",labels:[],events:[],colors:[]},selected_event:"today"},threat:{time:"",today:{scanned:"",detected:""},week:{scanned:"",detected:""},total:{scanned:"",detected:""},
top_client:{info:[],data:[],labels:[]},top_threats:{info:[],data:[],labels:[]}},ips:{time:"",today:{scanned:"",detected:""},week:{scanned:"",detected:""},total:{scanned:"",detected:""},top_client:{info:[],data:[],labels:[]},top_ips:{info:[],data:[],labels:[]}}};var M=function(a,b,c){var d;if(b)return angular.forEach(a,function(a){a[c]===b._model.label&&(d=a)}),angular.copy(d)},N=function(a,b){a&&p.open({templateUrl:"dashboard_modal.html",controller:"DashboardModalCtrl",backdrop:"static",size:"dashboard",
resolve:{edit:function(){return a},type:function(){return b}}}).result.then(function(){},function(){})};a.funs={change_event:function(){},click_tab:function(b){a.model.no_license||(a.ui_data.tab_sel=b.name,G())},click_threat_client:function(b,c,d){a.edit=M(a.model.threat.top_client.info,d,"hostname");N(a.edit,"threat_client")},click_threat_detect:function(b,c,d){a.edit=M(a.model.threat.top_threats.info,d,"id");N(a.edit,"threat_detect")},click_ips_client:function(b,c,d){a.edit=M(a.model.ips.top_client.info,
d,"hostname");N(a.edit,"ips_client")},click_ips_attack:function(b,c,d){a.edit=M(a.model.ips.top_ips.info,d,"id");N(a.edit,"ips_attack")},reset:function(){app.TOOLS.warningAlertBox({msg:a.DICT("Dashboard_Reset_Note"),cbk:function(a){a&&b.post({method:"action",params:{rpc:"reset-security-state"},success:function(a){h()},error:function(a){h()}})}})}};a.$on("$destroy",function(){l&&(clearInterval(l),l=void 0)});h()}]);
app.controller("DashboardModalCtrl",["$scope","$q","MyHttp","type","edit","$uibModalInstance","$uibModal","dt",function(a,b,t,m,w,u,p,q){var e=app.TOOLS.getVal;a.time_list=[{id:"today",displayName:a.DICT("Dashboard_Today")},{id:"week",displayName:a.DICT("Dashboard_Last_7_Days")},{id:"total",displayName:a.DICT("Dashboard_Since_Activated")}];a.edit=w;a.type=m;a.m={time:"total"};a.title="";var x=function(b){b||(b={});b=(b.output||{}).clients||[];var d,c;a.edit.list=[];angular.forEach(b,function(b){d=
{client_info:[],remote_ip:b["remote-ip"]||"-",port:e(b.port,"-"),date:q.genTimeStrByTimeStamp(b.date,"-"),id:e(b.id,"-"),name:b.name||"-",mac:b.mae||"-",ipv4_addr:b["ipv4-address"]||"-",ipv6_addr:b["ipv6-address"]||"-",hostname:b.hostname||"-",device_type:b["device-type"]||"-",os_type:b["os-type"]||"-",remote_file:"-",threat:"-",attack:"-"};c="";"-"!==d.ipv4_addr&&(c=d.ipv4_addr);"-"!==d.ipv6_address&&"::"!==d.ipv6_address&&(c&&(c+=", "),c+=d.ipv6_addr);c||(c="-");d.client_info.push(d.hostname);d.client_info.push(c);
d.client_info.push(d.os_type);d.client_info.push(d.device_type);a.edit.list.push(d)});"ips_attack"===m?a.gridIpsAttackOptions.data=a.edit.list:a.gridThreatDetectedOptions.data=a.edit.list},n=function(b){b||(b={});b=(b.output||{}).attacks||[];var d;a.edit.list=[];angular.forEach(b,function(b){d={remote_ip:b["remote-ip"]||"-",port:e(b.port,"-"),date:q.genTimeStrByTimeStamp(b.date,"-"),id:e(b.id,"-"),name:b.name||"-",impact:b.impact||"-",description:b.description||"-",recommendation:b.recommendation||
"-",reference:b.reference||"-",issue_date:q.genTimeStrByTimeStamp(b["issue-date"],"-"),update_date:q.genTimeStrByTimeStamp(b["update-date"],"-"),category:b.category||"-",severity:b.severity||"-",attack:"-"};a.edit.list.push(d)});a.gridIpsClientsOption.data=a.edit.list},l=function(b){b||(b={});b=(b.output||{}).threats||[];var d;a.edit.list=[];angular.forEach(b,function(b){d={remote_ip:b["remote-ip"]||"-",port:e(b.port,"-"),date:q.genTimeStrByTimeStamp(b.date,"-"),id:b.id||"-",category:b.category||
"-",name:b.name||"-",remote_file:"-",threat:"-"};a.edit.list.push(d)});a.gridThreatClientOptions.data=a.edit.list},r=function(b,d){if(d&&void 0!==b){var c=(d.output||{}).signatures||[];a.detail=void 0;angular.forEach(c,function(c){c.id===b&&(a.detail={id:e(c.id,"-"),name:c.name||"-",os_type:"-",impact:c.impact||"-",description:c.description||"-",recommendation:c.recommendation||"-",reference:c.reference||"-",issue_date:q.genTimeStrByTimeStamp(c["issue-date"],"-"),updated_date:q.genTimeStrByTimeStamp(c["updated-date"],
"-"),category:c.category||"-",severity:c.severity||"-"})})}},v=function(){var b,d={},c,h;switch(a.m.time){case "today":b={hours:0,days:1,weeks:0,months:0};break;case "week":b={hours:0,days:0,weeks:1,months:0};break;default:b={hours:1,days:1,weeks:1,months:1}}switch(m){case "ips_attack":d.rpc="get-clients-per-event";b.event=a.edit.id;b.type="ips";c=x;h="data/get_clients_per_event.json";break;case "ips_client":d.rpc="get-attacks-per-client";b.client=a.edit.mac.toLowerCase();c=n;h="data/get_attacks_per_client.json";
break;case "threat_client":d.rpc="get-threats-per-client";b.client=a.edit.mac.toLowerCase();c=l;h="data/get_threats_per_client.json";break;default:d.rpc="get-clients-per-event",b.event=a.edit.id,b.type="threat",c=x,h="data/get_clients_per_event.json"}d.input=b;t.post({url:resource_base+h,method:"action",params:d,success:function(a){c(a.data&&a.data.result)},error:function(a){Log(ERROR,"[DashboardModalCtrl] doRpc() error "+JSON.stringify(a));c()}})},s=function(){a.detail&&p.open({templateUrl:"dashboard_detail_modal.html",
controller:"DashboardDetalModalCtrl",backdrop:"static",size:"dashboard",resolve:{detail:function(){return a.detail}}})};b=function(b,d,c,h){var g=d.entity.id;a.detail=void 0;t.post({url:resource_base+"data/get_ips_signatures.json",method:"action",params:{rpc:"get-ips-signatures",input:{query:g,"page-size":1,"page-num":1}},success:function(a){r(g,a.data&&a.data.result);s()},error:function(a){r(g);Log("[Dashboard] clickSignature() error "+JSON.stringify(a))}})};a.gridThreatClientOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"remote_ip",
displayName:a.DICT("Dashboard_Remote_Ip")},{field:"port",displayName:a.DICT("Dashboard_Remote_Port")},{field:"name",displayName:a.DICT("Dashboard_Threat")},{field:"category",displayName:a.DICT("Dashboard_Action")},{field:"date",displayName:a.DICT("Dashboard_Detected_Date_Time"),minWidth:230}]});a.gridThreatDetectedOptions=app.uiGrid.generateGridOptions({rowHeight:2.5*app.uiGrid.rowHeight,columnDefs:[{field:"client_info",displayName:a.DICT("Dashboard_Client_Detail_Name"),cellTemplate:"dashboard_client_info.html"},
{field:"remote_ip",displayName:a.DICT("Dashboard_Remote_Ip")},{field:"port",displayName:a.DICT("Dashboard_Remote_Port")},{field:"name",displayName:a.DICT("Dashboard_Threat")},{field:"date",displayName:a.DICT("Dashboard_Detected_Date_Time"),minWidth:230}]});a.gridIpsClientsOption=app.uiGrid.generateGridOptions({columnDefs:[{field:"remote_ip",displayName:a.DICT("Dashboard_Remote_Ip")},{field:"port",displayName:a.DICT("Dashboard_Remote_Port")},{field:"name",displayName:a.DICT("Dashboard_Attack")},{field:"category",
displayName:a.DICT("Dashboard_Attack_Categoty")},{field:"id",displayName:a.DICT("Dashboard_Signature_Id"),cellTemplate:"UG_table_text_with_inline_href_click.html",click:b},{field:"date",displayName:a.DICT("Dashboard_Detected_Date_Time"),minWidth:230}]});a.gridIpsAttackOptions=app.uiGrid.generateGridOptions({rowHeight:2.5*app.uiGrid.rowHeight,columnDefs:[{field:"client_info",displayName:a.DICT("Dashboard_Client_Detail_Name"),cellTemplate:"dashboard_client_info.html"},{field:"remote_ip",displayName:a.DICT("Dashboard_Remote_Ip")},
{field:"port",displayName:a.DICT("Dashboard_Remote_Port")},{field:"name",displayName:a.DICT("Dashboard_Attack")},{field:"id",displayName:a.DICT("Dashboard_Signature_Id"),cellTemplate:"UG_table_text_with_inline_href_click.html",click:b},{field:"date",displayName:a.DICT("Dashboard_Detected_Date_Time"),minWidth:230}]});a.change_threat=function(){v()};a.close=function(){u.close(a.edit)};switch(m){case "threat_client":a.title=a.DICT("Dashboard_Hostname")+": "+a.edit.hostname;break;case "threat_detect":a.title=
a.DICT("Dashboard_Threat")+": "+a.edit.name;break;case "ips_client":a.title=a.DICT("Dashboard_Hostname")+": "+a.edit.hostname;break;default:a.title=a.DICT("Dashboard_IPS_Category")+": "+a.edit.category}v()}]);app.controller("DashboardDetalModalCtrl",["$scope","$uibModalInstance","detail",function(a,b,t){a.detail=t;a.close=function(){b.close()}}]);app.controller("ipSrcGuardCtrl",["$scope","MyHttp","$templateCache","UserSession","userAccessRight","modelInfo",function(a,b,t,m,w,u){var p;a.success=!1;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var q=function(){b.post({url:resource_base+"data/ip_source_guard.json",method:"get_ip_source_guard",success:function(a){a.data&&a.data.result?e(a.data.result):e()},error:function(a){e()}})},e=function(b){b||(b={});var e=b["block-unknown-binding"]||{},l=e["static-bindings"]||
[],k=[];b["dhcp-binding-state"]&&b["dhcp-binding-state"].entry&&(k=b["dhcp-binding-state"].entry);a.model.block_unknown_mac_address=void 0!==e["block-unknown-mac-address"]?e["block-unknown-mac-address"]:!1;a.model.block_unknown_binding=void 0!==e["block-unknown-binding"]?e["block-unknown-binding"]:!1;a.model.static_bindings=[];a.model.dhcp_binding_static=[];angular.forEach(l,function(b){a.model.static_bindings.push(x(b))});angular.forEach(k,function(b,c){a.model.dhcp_binding_static.push({name:c,mac:b.mac||
"",ip:b["ip-address"]||"",action:[{cbk:function(c,g){var e=-1,k;angular.forEach(a.model.static_bindings,function(a,c){a.mac===b.mac&&(e=c)});k=x(b);-1===e?a.model.static_bindings.push(k):a.model.static_bindings[e]=k;e=-1;angular.forEach(a.model.dhcp_binding_static,function(a,c){a.mac===b.mac&&(e=c)});-1!==e&&a.model.dhcp_binding_static.splice(e,1);a.modified()},displayName:a.DICT("IP_Source_Guard_Add_To_Bind")}]})});p=angular.copy(a.model.static_bindings);a.gridDHCPLeaseOptions.data=a.model.dhcp_binding_static;
a.gridBindingOptions.data=a.model.static_bindings;a.dataReady=!0},x=function(a){a||(a={});return{checked:!1,edit:!1,isRepeat:!1,disableChk:!1,ip:a["ip-address"]||"",name:a.name||"",mac:a.mac||"",enable:void 0!==a.enable?a.enable:!0}};m=function(b){a.sel_cnts=0;angular.forEach(a.model.static_bindings,function(b,e){b.checked?a.sel_cnts+=1:(b.edit=!1,void 0==b.ip&&(b.ip=""),void 0==b.mac&&(b.mac=""))})};var n=function(){a.sel_cnts=0;q();a.updateMaxEntry();a.resetModified()};p=[];var l=function(b){var e=
a.isrv345,l=a.model.block_unknown_binding||!1,k=a.model.static_bindings.length||0,e=l^(a.model.block_unknown_mac_address||0)?l?e?100:45:e?100:90:e?100:45;return(b?k>=e:k>e)?(Log(DEBUG,"warning"),a.msg="Only allow maximum of "+e+" entries for IP & MAC Binding Table.(Current Entry Number: "+k+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.chkMac=function(b){b=a.model.static_bindings;var e=b.length,l,k;angular.forEach(b,function(a){a.isRepeat=!1});for(l=0;l<e;l++)for(k=l+1;k<
e;k++)b[l].mac===b[k].mac&&(b[l].isRepeat=!0,b[k].isRepeat=!0)};a.dataReady=!1;a.sel_cnts=0;a.rv345_flag=!1;a.rv345p_flag=!1;a.isrv345=!1;0<=u.get_pid().search("RV345")?a.rv345_flag=!0:0<=u.get_pid().search("RV345P")&&(a.rv345p_flag=!0);a.isrv345=a.rv345_flag||a.rv345p_flag;a.model={block_unknown_mac_address:!1,block_unknown_binding:!1,static_bindings:[],dhcp_binding_static:[]};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridBindingOptions=app.uiGrid.generateGridOptions({IDPreifx:"ipmacbinding",
columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:m,headerChangedCbk:m,disableChkBoxField:"disableChk"},{field:"ip",displayName:a.DICT("IP_Source_Guard_Static_IPv4_Addr"),editRow:"edit",id:"ip",validationCbk:"gridInvalidCbk",cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-ip ")},{field:"mac",displayName:a.DICT("IP_Source_Guard_MAC_Addr"),required:!0,editRow:"edit",id:"mac",validationCbk:"gridInvalidCbk",change:a.chkMac,invalidField:"isRepeat",invalidName:"isRepeat",
cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"mac-address ")}]});a.gridDHCPLeaseOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"ip",displayName:a.DICT("IP_Source_Guard_IPv4_Addr")},{field:"mac",displayName:a.DICT("IP_Source_Guard_MAC_Addr")},{field:"action",visible:!a.isrv345,displayName:a.DICT("IP_Source_Guard_Action"),cellTemplate:"UG_table_buttons.html"}]});a.funs={add:function(){if(!l(!0)){var b=x();b.edit=!0;b.checked=!0;a.model.static_bindings.push(b);
a.sel_cnts+=1;a.gridBindingOptions.gridApi.customApi.scrollToLast();a.modified()}},edit:function(){angular.forEach(a.model.static_bindings,function(a){a.checked&&(a.edit=!0)})},del:function(){for(var b=a.model.static_bindings.length-1;0<=b;b--)a.model.static_bindings[b].checked&&(a.sel_cnts-=1,a.model.static_bindings.splice(b,1))},save:function(){if(!l(!1)){var e=[],m;angular.forEach(p,function(b){m=!0;angular.forEach(a.model.static_bindings,function(a){b.mac===a.mac&&(m=!1)});m&&e.push({mac:b.mac})});
e=[];angular.forEach(a.model.static_bindings,function(a){e.push({mac:a.mac,"ip-address":a.ip,name:a.name,enable:a.enable})});b.post({method:"set_ip_source_guard",params:{"block-unknown-binding":{"static-bindings":e,"block-unknown-mac-address":a.model.block_unknown_mac_address,"block-unknown-binding":a.model.block_unknown_binding}},success:function(b){a.success=!0;n()},error:function(a){n()}})}},cancel:function(){n()}};a.updateMaxEntry=function(){var b=a.isrv345,e=a.model.block_unknown_mac_address||
!1;a.model.maxentry=(a.model.block_unknown_binding||0)^e?e?b?100:90:b?100:45:b?100:45};n()}]);app.controller("contentFilterCtrl",["$scope","MyHttp","$q","pgWindow","$templateCache","UserSession","userAccessRight",function(a,b,t,m,w,u,p){var q,e,x,n;a.success=!1;a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();var l=function(){return b.post({url:resource_base+"data/security_content_filter.json",method:"get_content_filter",error:function(a){r()}})},r=function(b){b||(b={});b=b["content-filtering"]||{};var c=b.allow_rules||{},d=b.block_rules||{},g=d.block_url_rules||
[],d=d.block_keyword_rules||[],h=c.allow_url_rules||[],c=c.allow_keyword_rules||[];a.model.type="block";a.model.enable=void 0!==b.enable?b.enable:!1;a.model.ori_status=a.model.enable;switch(b["filtering-type"]){case "ALLOW_LIST":a.model.type="allow";break;default:a.model.type="block"}a.model.blockUrls=[];a.model.blockKeys=[];a.model.allowUrls=[];a.model.allowKeys=[];angular.forEach(g,function(b,c){a.model.blockUrls.push(v(b))});angular.forEach(d,function(b){a.model.blockKeys.push(s(b))});angular.forEach(h,
function(b){a.model.allowUrls.push(v(b))});angular.forEach(c,function(b){a.model.allowKeys.push(s(b))});angular.copy(a.model.type);q=angular.copy(a.model.blockUrls);e=angular.copy(a.model.blockKeys);x=angular.copy(a.model.allowUrls);n=angular.copy(a.model.allowKeys);a.gridBlockUrlOptions.data=a.model.blockUrls;a.gridBlockKeywordOptions.data=a.model.blockKeys;a.gridAllowUrlOptions.data=a.model.allowUrls;a.gridAllowKeywordOptions.data=a.model.allowKeys;a.dataReady=!0},v=function(b){var c={edit:!1,selected:!1,
invalid:!1,empty:"",disableChkBox:!1,name:"",schedule:{select:"!always",list:angular.copy(a.model.schedules)}};if(!b)return c;angular.forEach(b,function(a,b){switch(b){case "domain-name":c.name=a;break;case "schedule":c.schedule.select=a}});return c},s=function(b){var c={edit:!1,selected:!1,invalid:!1,empty:"",disableChkBox:!1,name:"",schedule:{select:"!always",list:angular.copy(a.model.schedules)}};if(!b)return c;angular.forEach(b,function(a,b){switch(b){case "keyword-name":c.name=a;break;case "schedule":c.schedule.select=
a}});return c},k=function(){return b.post({url:resource_base+"data/schedule.json",method:"get_schedule",error:function(a){d()}})},d=function(b){b||(b={});var c=[];b.schedules&&b.schedules.schedule&&(c=b.schedules.schedule);a.model.schedules=[{id:"!always",displayName:a.DICT("Always")}];angular.forEach(c,function(b,c){a.model.schedules.push({id:b.name,displayName:a.DICT(b.name)})})},c=function(){a.dataReady=!1;t.all([k(),l(),b.post({url:resource_base+"data/web_filtering.json",method:"get_webfilter"})]).then(function(b){a.reset();
d(b[0].data&&b[0].data.result);r(b[1].data&&b[1].data.result);(b=b[2].data&&b[2].data.result)||(b={});a.model.webfilter_enable=(b&&b.webfilter||{}).enable||!1;a.resetModified()})};m=function(b){return function(c){a.sel_cnts[b]=0;angular.forEach(a.model[b],function(c){c.selected?a.sel_cnts[b]+=1:c.edit=!1})}};q=[];e=[];x=[];n=[];a.dataReady=!1;a.reset=function(){a.sel_cnts={blockUrls:0,blockKeys:0,allowUrls:0,allowKeys:0}};a.sel_cnts={blockUrls:0,blockKeys:0,allowUrls:0,allowKeys:0};a.model={blockUrls:[],
blockKeys:[],allowUrls:[],allowKeys:[],schedules:[],type:"block",enable:!0,ori_status:!1,webfilter_enable:!1};a.multiValidation=function(a,b){var c,d,g;angular.forEach(a,function(a){a.invalid=!1});g=a.length;for(c=0;c<g;c++)for(d=c+1;d<g;d++)a[c].name===a[d].name&&(a[c].invalid=!0,a[d].invalid=!0)};a.blockUrlCbk=function(b,c,d){a.multiValidation(a.model.blockUrls,"blockUrls")};a.blockKeyCbk=function(b,c,d){a.multiValidation(a.model.blockKeys,"blockKeys")};a.allowUrlCbk=function(b,c,d){a.multiValidation(a.model.allowUrls,
"allowUrls")};a.allowKeyCbk=function(b,c,d){a.multiValidation(a.model.allowKeys,"allowKeys")};a.gridInvalidCbk=function(a){a.row.entity.disableChkBox=a.rowInvalid};a.gridBlockUrlOptions=app.uiGrid.generateGridOptions({IDPreifx:"blockfilterbydomain",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:m("blockUrls"),headerChangedCbk:m("blockUrls"),disableChkBoxField:"disableChkBox"},{field:"name",displayName:a.DICT("Content_Filter_Domain_Name"),editRow:"edit",required:!0,id:"block_domain",validationCbk:"gridInvalidCbk",
customVldCbk:"blockUrlCbk",invalidField:"invalid",cellTemplate:w.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'maxlength="253" domain-name')},{field:"schedule",displayName:a.DICT("Content_Filter_Schedule"),editRow:"edit",width:200,id:"block_domain_schedule",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"empty",isEmpty:!0}]});a.gridBlockKeywordOptions=app.uiGrid.generateGridOptions({IDPreifx:"blockfilterbykeyword",columnDefs:[{field:"selected",isCheckbox:!0,
changedCbk:m("blockKeys"),headerChangedCbk:m("blockKeys"),disableChkBoxField:"disableChkBox"},{field:"name",displayName:a.DICT("Content_Filter_Keyword_Name"),editRow:"edit",required:!0,id:"block_keyword",validationCbk:"gridInvalidCbk",customVldCbk:"blockKeyCbk",invalidField:"invalid",cellTemplate:w.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'maxlength="64" keyword')},{field:"schedule",displayName:a.DICT("Content_Filter_Schedule"),editRow:"edit",width:200,id:"block_keyword_schedule",
cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"empty",isEmpty:!0}]});a.gridAllowUrlOptions=app.uiGrid.generateGridOptions({IDPreifx:"allowbydomain",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:m("allowUrls"),headerChangedCbk:m("allowUrls"),disableChkBoxField:"disableChkBox"},{field:"name",displayName:a.DICT("Content_Filter_Domain_Name"),editRow:"edit",required:!0,id:"allow_domain",validationCbk:"gridInvalidCbk",customVldCbk:"allowUrlCbk",invalidField:"invalid",cellTemplate:w.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,
'maxlength="253" domain-name')},{field:"schedule",displayName:a.DICT("Content_Filter_Schedule"),editRow:"edit",width:200,id:"allow_domain_schedule",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"empty",isEmpty:!0}]});a.gridAllowKeywordOptions=app.uiGrid.generateGridOptions({IDPreifx:"allowbykeyword",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:m("allowKeys"),headerChangedCbk:m("allowKeys"),disableChkBoxField:"disableChkBox"},{field:"name",displayName:a.DICT("Content_Filter_Keyword_Name"),
editRow:"edit",customVldGroup:"4",required:!0,id:"allow_keyword",validationCbk:"gridInvalidCbk",customVldCbk:"allowKeyCbk",invalidField:"invalid",cellTemplate:w.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'maxlength="64" keyword')},{field:"schedule",displayName:a.DICT("Content_Filter_Schedule"),editRow:"edit",width:200,id:"allow_keyword_schedule",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"empty",isEmpty:!0}]});var h=function(){return 50<=a.model.blockUrls.length?
(a.msg=a.DICT("Content_Filter_Max_Filter_Domain",{"%s":a.model.blockUrls.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},g=function(){return 50<=a.model.blockKeys.length?(a.msg=a.DICT("Content_Filter_Max_Filter_Keyword",{"%s":a.model.blockKeys.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},A=function(){return 50<=a.model.allowUrls.length?(a.msg=a.DICT("Content_Filter_Max_Allow_Domain",{"%s":a.model.allowUrls.length}),app.TOOLS.criticalAlertBox({msg:a.msg,
cbk:function(a){}}),!0):!1},y=function(){return 50<=a.model.allowKeys.length?(a.msg=a.DICT("Content_Filter_Max_Allow_Keyword",{"%s":a.model.allowKeys.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.funs={add:function(b){var c,d;switch(b){case "blockUrls":if(h())return;c=v();d=a.gridBlockUrlOptions.gridApi.customApi;break;case "blockKeys":if(g())return;d=a.gridBlockKeywordOptions.gridApi.customApi;c=s();break;case "allowUrls":if(A())return;d=a.gridAllowUrlOptions.gridApi.customApi;
c=v();break;case "allowKeys":if(y())return;d=a.gridAllowKeywordOptions.gridApi.customApi;c=s();break;default:return}c.selected=!0;c.edit=!0;a.sel_cnts[b]+=1;a.model[b].push(c);d.scrollToLast();a.modified()},edit:function(b){switch(b){case "blockUrls":case "blockKeys":case "allowUrls":case "allowKeys":angular.forEach(a.model[b],function(a,b){a.selected&&(a.edit=!0)})}},save:function(d){var g={},h,k=!1,l,r={},m,s,A,v=function(){var d=[],e=[],h=[],k=[];g="block"===a.model.type?{"filtering-type":"BLOCK_LIST"}:
{"filtering-type":"ALLOW_LIST"};angular.forEach(a.model.blockUrls,function(a){l={"domain-name":a.name};"!always"===a.schedule.select?l["always-on"]=null:l.schedule=a.schedule.select;d.push(l)});angular.forEach(a.model.blockKeys,function(a){l={"keyword-name":a.name};"!always"===a.schedule.select?l["always-on"]=null:l.schedule=a.schedule.select;e.push(l)});if(d.length||e.length)g.block_rules={},d.length&&(g.block_rules.block_url_rules=d),e.length&&(g.block_rules.block_keyword_rules=e);angular.forEach(a.model.allowUrls,
function(a){l={"domain-name":a.name};"!always"===a.schedule.select?l["always-on"]=null:l.schedule=a.schedule.select;h.push(l)});angular.forEach(a.model.allowKeys,function(a){l={"keyword-name":a.name};"!always"===a.schedule.select?l["always-on"]=null:l.schedule=a.schedule.select;k.push(l)});if(k.length||h.length)g.allow_rules={},k.length&&(g.allow_rules.allow_keyword_rules=k),h.length&&(g.allow_rules.allow_url_rules=h);(g.enable=a.model.enable)&&a.model.webfilter_enable&&(r.webfilter={enable:!a.model.enable});
r["content-filtering"]=g;b.post({method:"set_content_filter",params:r,success:function(b){a.success=!0;c()},error:function(a){c()}})};s=!1;m={block_url_rules:[],block_keyword_rules:[]};angular.forEach(q,function(b){h=!0;angular.forEach(a.model.blockUrls,function(a){b.name===a.name&&(h=!1)});h&&(s=k=!0,m.block_url_rules.push({"domain-name":b.name}))});angular.forEach(e,function(b){h=!0;angular.forEach(a.model.blockKeys,function(a){b.name===a.name&&(h=!1)});h&&(s=!0,m.block_keyword_rules.push({"keyword-name":b.name}))});
s&&(k=!0,g.block_rules=m);s=!1;A={allow_url_rules:[],allow_keyword_rules:[]};angular.forEach(x,function(b){h=!0;angular.forEach(a.model.allowUrls,function(a){b.name===a.name&&(h=!1)});h&&(s=!0,A.allow_url_rules.push({"domain-name":b.name}))});angular.forEach(n,function(b){h=!0;angular.forEach(a.model.allowKeys,function(a){b.name===a.name&&(h=!1)});h&&(s=!0,A.allow_keyword_rules.push({"keyword-name":b.name}))});s&&(k=!0,g.allow_rules=A);k&&b.post({method:"del_content_filter",params:{"content-filtering":g},
success:function(a){v()},error:function(a){v()}});k||v()},del:function(b){var c;switch(b){case "blockUrls":case "blockKeys":case "allowUrls":case "allowKeys":break;default:return}for(c=a.model[b].length-1;0<=c;c--)a.model[b][c].selected&&a.model[b].splice(c,1);0===a.model[b].length&&(a.sel_cnts[b]=0);a.modified()},cancel:function(){c()}};a.changeEnable=function(){if(a.model.enable&&a.model.webfilter_enable&&a.model.ori_status!==a.model.enable){var b="<div>"+a.DICT("Content_Filter_Msg1")+"</div>",
b=b+"<div>"+a.DICT("Content_Filter_Msg2")+"</div>",b=b+"<div>"+a.DICT("Content_Filter_Msg3")+"</div>";app.TOOLS.warningAlertBox({msg:b,width:550,cbk:function(b){b||(a.model.enable=!a.model.enable)}})}};c()}]);app.controller("UmbrellaCtrl",["$scope","MyHttp","$q","$timeout","UserSession","userAccessRight","$uibModal",function(a,b,t,m,w,u,p){var q=app.TOOLS.getVal,e=function(){return b.post({method:"get_opendns_state",url:resource_base+"data/opendns_state.json",error:function(a){Log(ERROR,"[Umbrella][getOpendnsState] "+JSON.stringify(a))}})},x=function(){return b.post({method:"get_opendns",url:resource_base+"data/opendns.json",error:function(a){Log(ERROR,"[Umbrella][getOpendns] "+JSON.stringify(a))}})},
n=function(){Log(DEBUG,"[Umbrella][resetNetworkDevicePolice] do reset");a.model.key=a.model.orig_key?"000000":"";a.model.key_modified=!1;a.model.secret=a.model.orig_secret?"000000":"";a.model.secret_modified=!1;a.model.ca_certificate=I;a.model.organizations=angular.copy(a.model.orig_organizations)},l=function(a,b){a||(a={});var c=a.id;b&&(c=a["policy-id"]);return{enabled:!1,name:a.name||"",id:parseInt(c,10),action:"none"}},r=function(a){a||(a={});var b=a.device||{};return{id:a.id||"",orig_id:a.id||
"",name:a.name||"",device_id:b["device-id"]||"",device_name:b.name||"",device_tag:b.tag||"",origin_id:b["origin-id"]||"",policies_str:"N/A",policies:{},orig_policies:{}}},v=function(b){b||(b={});var c=b.opendns||{},d=c["network-policies"]||{};b=c["network-device-policies"]||{};var g=c["local-domain-bypass"]||[],e=[];a.model.enabled=q(c.enabled,!0);a.model.block_lan_dns_query=!q(c["allow-dns-query-from-lan"],!1);angular.forEach(g,function(a){e.push({domain:a})});b.enabled?(a.model.policies="network-device",
c=b["dns-crypt"]||{}):(a.model.policies="network",c=d["dns-crypt"]||{});e.length||e.push({domain:""});a.model.key_modified=!1;a.model.secret_modified=!1;a.model.local_domain_bypass=e;a.model.ca_certificate=b["ca-certificate"]||I;a.model.organizations=r(b.organizations&&b.organizations[0]);a.model.orig_organizations=angular.copy(a.model.organizations);b.key?(a.model.key="00000000",a.model.orig_key=b.key):(a.model.key="",a.model.orig_key="");b.secret?(a.model.secret="00000000",a.model.orig_secret=b.secret):
(a.model.secret="",a.model.orig_secret="");a.model.dns_crypt.enabled=q(c.enabled,!1);a.model.dns_crypt.public_key=c["public-key"]||""},s=function(b,c){var d;switch(b){case "apply_warning":d="umbrella_apply_warning.htm";break;case "new_credentials":case "edit_credentials":d="umbrella_credentials.htm";break;case "new_organization":d="umbrella_organization.htm";break;case "new_policies":case "edit_policies":d="umbrella_policies.htm";break;case "edit_device_info":case "new_device_info":d="umbrella_device_info.htm";
break;case "de_register_warning":d="umbrella_de_register_warning.htm";break;case "setup_success":case "de_register_success":case "update_device_policy_success":case "update_credentials_success":case "update_device_info_success":d="umbrella_success.htm";break;case "update_credentials_error":case "update_device_info_error":case "update_device_policy_error":case "get_organization_error":case "get_policies_error":case "new_register_error":case "new_policy_associating_error":case "de_register_error":d=
"umbrella_error.htm";break;default:Log(ERROR,"[Umbrella][open_modal] Error type:"+b);return}a.ui_data.uibModalInstance=p.open({animation:a.animationsEnabled,templateUrl:d,controller:"UmbrellaModalCtrl",size:"umbrella-modal-generate",backdrop:"static",resolve:{model:function(){return a.model},ui_data:function(){return a.ui_data},is_edit:function(){return!1},type:function(){return b},genOpendnsOrganizationPolicy:function(){return l}}});a.ui_data.uibModalInstance.result.then(function(b){a.model=b.model;
a.ui_data=b.ui_data;_.isFunction(c)&&c(!0);a.ui_data.uibModalInstance=void 0},function(){_.isFunction(c)&&c(!1);a.ui_data.uibModalInstance=void 0})},k=function(a,b){z("read_organizations",function(b,c,g){b?d(c):d({});_.isFunction(a)&&a(b,c,g)},{background:b})},d=function(b){b=b.organizations||[];var c=a.model.organizations.id,d;a.model.organizations_list=[];angular.forEach(b,function(b){d={id:b["organization-id"],name:b.name,check:!1};c===d.id&&(d.check=!0);a.model.organizations_list.push(d)})},c=
function(b,c){a.ui_data.prepare_policies_list_error=!1;z("read_policies",function(c,d,g){c?h(d):(a.ui_data.prepare_policies_list_error=!0,h({}));_.isFunction(b)&&b(c,d,g)},{background:c})},h=function(b){b=b.policies||[];var c=[],d=[],g,e,h;a.model.policies_list=[];angular.forEach(b,function(a){e="true"===a["is-default"]?!0:!1;h=parseInt(q(a.priority,"0"),10);isNaN(h)&&(h=0);g={id:a["policy-id"],organization_id:a["organization-id"],name:a.name,priority:h,is_default:e,created_at:a["created-at"],check:!1,
disable_check:!1};g.is_default?(g.check=!0,g.disable_check=!0,c.push(g)):d.push(g)});c.sort(function(a,b){return a.priority-b.priority});d.sort(function(a,b){return a.priority-b.priority});a.model.policies_list=d.concat(c)},g=function(a,b){z("read_device_policies",function(b,c,d){b?A(c):A({});_.isFunction(a)&&a(b,c,d)},{background:b})},A=function(b){b||(b={});b=b.policies||[];var c=a.model.organizations.policies,d,g=[];a.model.organizations.policies_str="";angular.forEach(c,function(a,b){a.enabled=
!1});b.sort(function(a,b){var c=parseInt(a.priority,10),d=parseInt(b.priority,10);return c-d});angular.forEach(b,function(a){d=l(a,!0);d.enabled=!0;g.push(d.name);c[d.id]=d});a.model.organizations.policies_str=g.join(", ");a.model.organizations.policies_str||(a.model.organizations.policies_str="N/A");a.model.organizations.orig_policies=angular.copy(a.model.organizations.policies);a.model.orig_organizations.policies_str=a.model.organizations.policies_str;a.model.orig_organizations.policies=angular.copy(a.model.organizations.policies);
a.model.orig_organizations.orig_policies=angular.copy(a.model.organizations.policies)},y=function(b,d){var e,h,l,r,m;switch(b){case "new_credentials":case "edit_credentials":s(b,function(a){a?d?y("get_organization",d):B():n()});break;case "get_organization":k(function(b,c,g){!b||0===a.model.organizations_list.length?y("get_organization_error",d):d?y("new_organization",d):B(function(a){})});break;case "update_credentials_success":s("update_credentials_success",function(a){B(void 0,!0)});break;case "update_credentials_error":s("update_credentials_error",
function(a){n()});break;case "get_organization_error":s("get_organization_error",function(a){n()});break;case "new_organization":s("new_organization",function(b){b?d?(angular.forEach(a.model.organizations_list,function(b){b.check&&(a.model.organizations.id=b.id,a.model.organizations.name=b.name)}),y("get_policies",d)):Log(ERROR,'[Umbrella][FSM] "new_organization" state is wrong'):n()});break;case "get_policies":c(function(b,c,g){!b||0===a.model.policies_list.length?y("get_policies_error",d):d?y("new_policies",
d):y("edit_policies",d)});break;case "get_policies_error":s("get_policies_error",function(a){n()});break;case "new_policies":case "edit_policies":h=a.model.organizations.policies;angular.forEach(a.model.policies_list,function(a){a.disable_check||(a.check=h[a.id]&&h[a.id].enabled?!0:!1)});s(b,function(b){b?d?(angular.forEach(a.model.organizations.policies,function(a,b){a.enabled=!1}),angular.forEach(a.model.policies_list,function(b,c){b.check&&(a.model.organizations.policies[b.id].enabled=!0)}),y("new_device_info",
d)):y("update_policies",d):n()});break;case "new_device_info":case "edit_device_info":s(b,function(a){a?"new_device_info"===b?y("create_device_info",d):y("update_device_info",d):n()});break;case "create_device_info":z("create_a_device",function(b,c,g){b?(e=c.device||{},a.model.organizations.device_id=e["device-id"]||"",a.model.organizations.device_name=e.name||"",a.model.organizations.origin_id=e["origin-id"]||"",y("update_policies",d)):y("create_device_info_register_error",d)});break;case "update_policies":l=
a.model.organizations.orig_policies;h=a.model.organizations.policies;if(!d&&(r="",angular.forEach(l,function(a){"posting"===a.action&&(a.action="posted");a.enabled&&(h[a.id]&&!h[a.id].enabled&&"none"===a.action)&&!r&&(a.action="posting",r=a.id)}),r)){z("delete_device_policies",function(a,b,c){a?y("update_policies",d):y("update_device_policy_error",d)},{policy_id:r});break}r="";m=0;angular.forEach(h,function(a){"posting"===a.action&&(a.action="posted");a.enabled&&"none"===a.action&&(m+=1,r||(a.action=
"posting",r=a.id))});z("update_device_policies",function(a,b,c){a?1<m?y("update_policies",d):d?g(function(){B(function(){y("setup_success",d)},!0)}):g(function(){B(function(){y("update_device_policy_success",d)},!0)}):d?y("create_device_policy_associating_error",d):y("update_device_policy_error",d)},{policy_id:r});break;case "update_device_info":z("update_a_device",function(b,c,g){b?(e=c.device||{},a.model.organizations.device_id=e["device-id"]||"",a.model.organizations.device_name=e.name||"",a.model.organizations.origin_id=
e["origin-id"]||"",B(function(){y("update_device_info_success",d)},!0)):y("update_device_info_error",d)});break;case "create_device_info_register_error":s("new_register_error",function(){n()});break;case "create_device_policy_associating_error":s("new_policy_associating_error",function(){B(void 0,!0)});break;case "setup_success":s("setup_success",function(){});break;case "update_device_info_error":s("update_device_info_error",function(){n()});break;case "update_device_info_success":s("update_device_info_success",
function(){});break;case "update_device_policy_success":s("update_device_policy_success",function(a){});break;case "update_device_policy_error":s("update_device_policy_error",function(a){n()});break;default:Log(ERROR,"[Umbrella][FSM] state is error :"+b)}},z=function(c,d,g){g||(g={});var e=q(g.background,!1),h=resource_base+"jsonrpc",k={};a.model.key_modified&&(k.key=a.model.key);a.model.secret_modified&&(k.secret=a.model.secret);switch(c){case "read_organizations":c="opendns-read-organizations";
h=resource_base+"data/umbrella_read_organization.json";break;case "read_device":c="opendns-read-devices";h=resource_base+"data/umbrella_read_device.json";$.extend(k,{"organization-id":a.model.organizations.id,"device-id":a.model.organizations.origin_id});break;case "create_a_device":c="opendns-create-a-device";h=resource_base+"data/umbrella_create_a_device.json";$.extend(k,{"organization-id":a.model.organizations.id,device:{name:a.model.organizations.device_name}});break;case "delete_a_device":c=
"opendns-delete-a-device";h=resource_base+"data/umbrella_delete_a_device.json";$.extend(k,{"organization-id":a.model.organizations.id,"origin-id":a.model.organizations.origin_id});break;case "update_a_device":c="opendns-update-merge-a-device";h=resource_base+"data/umbrella_update_a_device.json";$.extend(k,{"organization-id":a.model.organizations.id,"origin-id":a.model.organizations.origin_id,patch:{name:a.model.organizations.device_name}});break;case "read_policies":c="opendns-read-policies";h=resource_base+
"data/umbrella_read_policy.json";$.extend(k,{"organization-id":a.model.organizations.id});break;case "read_device_policies":c="opendns-read-device-policies";h=resource_base+"data/umbrella_read_device_policy.json";$.extend(k,{"organization-id":a.model.organizations.id,"origin-id":a.model.organizations.origin_id});break;case "update_device_policies":c="opendns-update-replace-a-policy";h=resource_base+"data/umbrella_update_device_policy.json";$.extend(k,{"organization-id":a.model.organizations.id,"origin-id":a.model.organizations.origin_id,
"policy-id":g.policy_id});break;case "delete_device_policies":c="opendns-delete-policy";h=resource_base+"data/umbrella_delete_device_policy.json";$.extend(k,{"organization-id":a.model.organizations.id,"origin-id":a.model.organizations.origin_id,"policy-id":g.policy_id});break;default:Log(ERROR,"[Umbrella][do_rpc] type is not support :"+c);return}b.post({url:h,method:"action",params:{rpc:c,input:k},procBackground:e,success:function(a){var b=a.data&&a.data.result&&a.data.result.output||{},c=!1;void 0!==
b["success-code"]&&(c=!0);_.isFunction(d)&&d(c,b,a)},error:function(a){Log(DEBUG,"[Umbrella][do_rpc] "+JSON.stringify(params));Log(DEBUG,"[Umbrella][do_rpc] "+JSON.stringify(a));_.isFunction(ckb)&&d(!1,{},a)}})},B=function(c,d){var g={enabled:a.model.enabled,"allow-dns-query-from-lan":!a.model.block_lan_dns_query,"local-domain-bypass":[],"network-policies":{enabled:!1},"network-device-policies":{enabled:!1,organizations:[]}},h={enabled:a.model.dns_crypt.enabled,"public-key":a.model.dns_crypt.public_key},
e=[],k=[];angular.forEach(a.model.local_domain_bypass,function(a){a.domain&&g["local-domain-bypass"].push(a.domain)});g["local-domain-bypass"].length||g["local-domain-bypass"].push("");g["network-policies"].enabled="network"===a.model.policies;g["network-policies"]["dns-crypt"]=h;$.extend(g["network-device-policies"],{enabled:"network-device"===a.model.policies,"dns-crypt":h});(a.model.key_modified||!a.model.key)&&$.extend(g["network-device-policies"],{key:a.model.key});(a.model.secret_modified||
!a.model.secret)&&$.extend(g["network-device-policies"],{secret:a.model.secret});h={id:a.model.organizations.id,name:a.model.organizations.name,device:{"origin-id":a.model.organizations.origin_id,"device-id":a.model.organizations.device_id,name:a.model.organizations.device_name,tag:a.model.organizations.tag}};angular.forEach(a.model.organizations.policies,function(a,b){a.enabled&&e.push({id:a.id,name:a.name})});h.id&&g["network-device-policies"].organizations.push(h);k.push({method:"set_opendns",
params:{opendns:g}});b.post({forcedUsingPost:!0,method:"set_bulk",params:k,success:function(){_.isFunction(c)&&c(!0);d&&D();a.resetModified()},error:function(a){_.isFunction(c)&&c(!1);d&&D()}})},D=function(){t.all([e(),x()]).then(function(b){Log(INFO,"---------- "+new Date);var c=b[0]&&b[0].data&&b[0].data.result||{},d=(c["opendns-state"]||{}).status||"UNREGISTERED";a.model.opendns_state=d;Log(INFO,"opendns-state orig: "+JSON.stringify(c));Log(INFO,"opendns-state ui: "+a.model.opendns_state);a.model.opendns_state_str=
"UNREGISTERED"===d?a.DICT("Umbrella_Unregistered"):a.DICT("Umbrella_Registered");v(b[1]&&b[1].data&&b[1].data.result||{});a.ui_data.data_ready=!0;a.ui_data.getting_at_background=!1;a.ui_data.prepare_policies_list_error=!1;a.ui_data.dp_registered=!1;a.ui_data.net_registered=!1;"network"===a.model.policies&&(a.ui_data.net_registered="REGISTERED"===a.model.opendns_state&&a.model.enabled);"network-device"===a.model.policies&&(a.ui_data.dp_registered="REGISTERED"===a.model.opendns_state&&a.model.enabled,
a.ui_data.dp_registered&&a.model.enabled&&E());a.check_apply_btn();Log(INFO,"choose: "+a.model.policies);Log(INFO,"network-device register state: "+a.ui_data.dp_registered);Log(INFO,"network register state: "+a.ui_data.net_registered)})},E=function(){var b=t.defer(),d=t.defer();a.ui_data.getting_at_background=!0;c(function(){b.resolve()});g(function(){d.resolve()});t.all([b.promise,d.promise]).then(function(){a.ui_data.getting_at_background&&(a.ui_data.getting_at_background=!1,_.isFunction(a.ui_data.padding_action)&&
(app.transition.Out(),a.ui_data.padding_action(),a.ui_data.padding_action=void 0))})},C=function(b){a.ui_data.getting_at_background?(app.transition.In(),a.ui_data.padding_action=b):_.isFunction(b)&&b()},I="";a.ui_data={data_ready:!1,dp_registered:!1,net_registered:!1,disable_apply:!1,max_domain_bypass:10,html_intro_msg2:a.DICT("Umbrella_Intro_Msg2",{"%s0":"<a href=\"https://signup.umbrella.com/\" onclick=\"window.open(this.href, 'newwindow', 'width=700, height=1000'); return false;\">"+a.DICT("Umbrella_Account")+
"</a>"}),html_intro_msg3:a.DICT("Umbrella_Intro_Msg3",{"%s0":"<a href=\"https://dashboard.umbrella.com/\" onclick=\"window.open(this.href, 'newwindow', 'width=700, height=1000'); return false;\"> "+a.DICT("Umbrella_Intro_Msg3_1")+"</a>"}),html_network_msg1:a.DICT("Umbrella_Network_Msg1"),html_network_msg2:a.DICT("Umbrella_Network_Msg2",{"%s":"<a href=\"https://support.umbrella.com/hc/en-us/articles/115004547503-Networks-with-Dynamic-IP-Addresses\"onclick=\"window.open(this.href, 'newwindow', 'width=700, height=1000'); return false;\">"+
a.DICT("Here")+"</a>"}),placeholder_publickey:"B735:1140:206F:225D:3E2B:D822:D7FD:691E:A1C3:3CC8:D666:8D0C:BE04:BFAB:CA43:FB77",html_credential_msg:a.DICT("Umbrella_Credential_Msg",{"%s0":"<a href=\"https://dashboard.umbrella.com/\" onclick=\"window.open(this.href, 'newwindow', 'width=700, height=1000'); return false;\"> "+a.DICT("Umbrella")+"</a>"}),getting_at_background:!1,padding_action:void 0,uibModalInstance:void 0,prepare_device_error:!1,prepare_policies_list_error:!1,prepare_device_policies_error:!1};
a.model={opendns_state:"UNREGISTERED",opendns_state_str:"",enabled:!0,policies:"network",block_lan_dns_query:!0,key:"",orig_key:"",key_modified:!1,secret:"",orig_secret:"",secret_modified:!1,ca_certificate:"",local_domain_bypass:[],organizations:{id:"",device_id:"",device_name:"",origin_id:"",policies:{},orig_policies:{},policies_str:""},orig_organizations:{},dns_crypt:{enabled:!0,public_key:""},certificates:[],organizations_list:[],policies_list:[]};a.funs={save:function(){var b=function(a){a&&B(void 0,
!0)};a.model.enabled?s("apply_warning",b):B(void 0,!0)},cancel:function(){D()},get_start:function(){n();a.model.key="";a.model.secret="";y("new_credentials",!0)},change_policies:function(){C(function(){y("edit_policies",!1)})},change_credentials:function(){C(function(){y("edit_credentials",!1)})},change_device_info:function(){C(function(){y("edit_device_info",!1)})},de_register:function(){var b=function(b){b&&z("delete_a_device",function(b,c,d){b?(a.model.key="",a.model.secret="",a.model.organizations.id=
"",B(function(){s("de_register_success",function(){D()})})):s("de_register_error")})};C(function(){s("de_register_warning",b)})},add_domain_bypass:function(){a.model.local_domain_bypass.push({domain:""})},delete_domain_bypass:function(b){a.model.local_domain_bypass.splice(b,1)}};a.check_public_key=function(){var b=a.model.dns_crypt.public_key;if(b&&(!b.match(/(([0-9A-Fa-f]{4}:){15})([1-9A-Fa-f]{4})$/)||79!==b.length)){if(a.model.dns_crypt.enabled&&a.model.enabled){a.umbrella_form.public_key.$setValidity("format",
!1);return}a.model.dns_crypt.public_key=""}a.umbrella_form.public_key.$setValidity("format",!0)};a.change_policy_mode=function(){"network-device"===a.model.policies&&(a.model.dns_crypt.enabled=!0);a.check_apply_btn()};a.check_apply_btn=function(){a.ui_data.disable_apply=!1;if("network-device"===a.model.policies&&a.model.enabled&&!a.ui_data.dp_registered&&(!a.model.orig_key||!a.model.orig_secret))a.ui_data.disable_apply=!0};D()}]);
app.controller("UmbrellaModalCtrl",["$uibModalInstance","$scope","ui_data","model","is_edit","type","$location","genOpendnsOrganizationPolicy",function(a,b,t,m,w,u,p,q){b.model=m;b.ui_data=t;b.is_edit=w;b.type=u;b.policy_cnt=0;t=function(){var a=b.model.organizations.policies;b.policy_cnt=0;angular.forEach(a,function(b,n){a[n].enabled=!1});angular.forEach(b.model.policies_list,function(m){a[m.id]||(a[m.id]=q(m));m.check&&(a[m.id].enabled=!0,a[m.id].name=m.name,b.policies_cnt=b.policy_cnt+1)})};b.gridOrganizationOptions=
app.uiGrid.generateGridOptions({data:b.model.organizations_list,columnDefs:[{field:"check",isRadio:!0,changedCbk:function(){b.policy_cnt=0;angular.forEach(b.model.organizations_list,function(a){a.check&&(b.model.organizations.id=a.id,b.policy_cnt+=1)})}},{field:"name"}]});b.gridPoliciesOptions=app.uiGrid.generateGridOptions({data:b.model.policies_list,columnDefs:[{field:"check",isCheckbox:!0,changedCbk:t,headerChangedCbk:t,disableChkBoxField:"disable_check"},{field:"name"}]});b.warning_msg1=b.DICT("Umbrella_Enabled_Msg2",
{"%s0":"<a ng-click=\"jump('WAN_Settings/')\">"+b.DICT("Umbrella_Enabled_Msg2_1")+"</a>"});b.warning_msg2=b.DICT("Umbrella_Enabled_Msg3",{"%s0":"<a ng-click=\"jump('LAN_DHCP_Settings/')\">"+b.DICT("Umbrella_Enabled_Msg3_1")+"</a>"});b.warning_msg3=b.DICT("Umbrella_Enabled_Msg4",{"%s0":"<a ng-click=\"jump('Firewall_Access_Rules/')\">"+b.DICT("Umbrella_Enabled_Msg4_1")+"</a>"});b.jump=function(a){p.url(a);b.cancel()};b.ok=function(){a.close({model:b.model,ui_data:b.ui_data})};b.cancel=function(){a.dismiss("cancel")}}]);app.controller("IpsCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","$uibModal","dt","Upload",function(a,b,t,m,w,u,p,q){var e=app.TOOLS.getVal,x=app.TOOLS.getResponse;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var n=function(){return b.post({method:"get_ips",url:resource_base+"data/ips.json",error:function(a){Log(ERROR,"[IPS][getIpsData] Error "+JSON.stringify(a))}})},l=function(b){b||(b={});b=b.ips||{};var c=
b.zone||[];a.model.enabled=!0===b.enabled;a.model.mode=b.mode||"prevention";a.model.level=b.level||"connectivity";angular.forEach(a.model.zone,function(b,c){a.model.zone[c]=!1});angular.forEach(c,function(b,c){void 0!==a.model.zone[c]&&(a.model.zone[c]=!0)})},r=function(){return b.post({method:"get_signature_state",url:resource_base+"data/ips.json",error:function(a){Log(ERROR,"[IPS][getSignatureStateData] Error "+JSON.stringify(a))}})},v=function(b){b||(b={});b=b["ciscosb-ips:signature-state"]||{};
a.model.signature.version=b.version||"N/A";a.model.signature.available_version=b["available-version"]||"N/A";a.model.signature.latest_update_time=p.genTimeStrByTimeStamp(b["latest-update-time"]||"","N/A");a.model.signature.last_check_time=p.genTimeStrByTimeStamp(b["last-check-time"]||"","N/A")},s=function(){return b.post({method:"get_ips_state",url:resource_base+"data/ips.json",error:function(a){Log(ERROR,"[IPS][getIpsData] Error "+JSON.stringify(a))}})},k=function(b){b||(b={});b=p.parser((b["ips-state"]||
{})["last-reset-time"]||"");b=0===b.err_code?p.timeStr(b):"N/A";a.model.ips_state.last_reset_time=b},d=function(c){return b.post({url:resource_base+"data/get_ips_signatures.json",method:"action",params:{rpc:"get-ips-signatures",input:{"page-size":a.pagingOps.pageSize,"page-num":a.ui_data.page_num,query:a.ui_data.query}},error:function(a){Log(ERROR,"[IPS][rpcForSignatures] "+JSON.stringify(a))}})},c=function(b,c){b||(b={});var d=function(a){var b="N/A",c,d;a||(a={},b="");c=a["issue-date"]?p.genTimeStrByTimeStamp(a["issue-date"],
b):b;d=a["updated-date"]?p.genTimeStrByTimeStamp(a["updated-date"],b):b;return{id:e(a.id,b),name:e(a.name,b),impact:e(a.impact,b),description:e(a.description,b),recommendation:e(a.recommendation,b),reference:e(a.reference,b),issue_date:c,updated_date:d,category:e(a.category,b),severity:e(a.severity,b)}},g=b.output||{},h=g.code,k=g.signatures||[],l=a.ui_data.page_num,n=a.pagingOps.pageSize,r,g=_.isNumber(g["total-num"])?g["total-num"]:10861;a.ui_data.grid_signatures=[];-1===h&&(g=0);k.length||(g=0);
if(c){r=Math.ceil(g/n);a.ui_data.total_signatures=g;a.ui_data.exist_page=[""];a.ui_data.grid_signatures=[];a.pagingOps.total=g;0===a.pagingOps.total&&(a.pagingOps.total=1);for(h=0;h<r;h++)a.ui_data.exist_page.push(!1);for(h=0;h<g;h++)a.ui_data.grid_signatures.push(d())}n*=l-1;r=k.length;for(h=0;h<r;h++)a.ui_data.grid_signatures[n+h]=d(k[h]);a.ui_data.exist_page[l]=!0;a.gridIpsSignatureOption.data=a.ui_data.grid_signatures;A()},h=function(){a.model.no_license||b.post({url:resource_base+"data/rpc_ips_check.json",
method:"action",params:{rpc:""},success:function(a){g(a.data&&a.data.result)},error:function(a){Log(ERROR,"[IPS][doRpcForCheckIps] "+JSON.stringify(a));g()}})},g=function(b){b||(b={});b=b.output||{};var c=b.errstr||a.DICT("Ips_Cannot_Connect_to_Cisco_Com");switch(b.code){case 0:z();break;default:app.TOOLS.criticalAlertBox({msg:c})}},A=function(){_.isFunction(a.pagingOps.updateOpts)&&a.pagingOps.updateOpts()},y=function(b,g){b&&(a.ui_data.page_num=1,A());t.all([d()]).then(function(a){c(a[0]&&a[0].data&&
a[0].data.result||{},b);_.isFunction(g)&&g()})},z=function(){var b;t.all([s()]).then(function(c){k(x(c,0));b=a.model.signature.version===a.model.signature.available_version?a.DICT("Ips_Have_Latest_Version_Already"):a.DICT("Ips_Update_Available_On_Cisco_Com",{"%s1":a.signature.available_version,"%s2":a.signature.version});app.TOOLS.informationAlertBox({msg:b})})},B=function(){a.ui_data.page_num=1;A();t.all([n(),s(),r(),d()]).then(function(b){var d=x(b,1);d||(d={});d=e(d.status,0);a.model.no_license=
0===d;a.model.no_license?(l(),k(),v(),c()):(l(x(b,0)),k(x(b,1)),v(x(b,2)),c(x(b,3),!0));a.ui_data.data_ready=!0;a.resetModified()})},D=function(b){var c=function(){_.isFunction(b)&&b()};a.ui_data.exist_page[a.ui_data.page_num]?c():y(!1,c)};a.success=!1;a.pagingOps={pages:[50,100,150],pageSize:50,total:0,changePageIdxCbk:{pre:void 0,post:function(b,c){a.ui_data.page_num=b;D(c)}},changePageSizeCbk:function(b,c){a.pagingOps.pageSize=b;y(!0,c)}};a.ui_data={pc_file:"",data_ready:!1,page_num:1,exist_page:[],
query:"",uploading:!1,upload_str:"",progress:-1,show_paging:!1,grid_signatures:[],total_signatures:0,disable_upgradeBtn:!0,combineNote:a.DICT("Ips_Note",{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Here")+"</u></a>"})};a.model={enabled:!1,mode:"prevention",level:"connectivity",zone:{LAN:!1,DMZ:!1,PRINTERS:!1,SMARTHOME:!1,VLAN100:!1,GUEST:!1},signature:{version:"",latest_update_time:"",available_version:"",last_check_time:""},ips_state:{last_reset_time:""},no_license:!0};
a.gridIpsSignatureOption=app.uiGrid.generateGridOptions({enablePaginationControls:!1,paginationPageSize:a.pagingOps.pageSize,enablePagination:!0,columnDefs:[{field:"name",displayName:a.DICT("Ips_Name")},{field:"id",displayName:a.DICT("Ips_Id"),cellTemplate:"UG_table_text_with_inline_href_click.html",click:function(a,b,c,d){u.open({animation:!0,templateUrl:"ips_detail.html",controller:"IpsDetailCtrl",size:"ips-detail",backdrop:"static",resolve:{edit:function(){return b.entity}}}).result.then(function(){})}},
{field:"severity",displayName:a.DICT("Ips_Severity")},{field:"category",displayName:a.DICT("Ips_Category")}]});a.funs={save:function(){var c=a.model;b.post({method:"set_ips",forcedUsingPost:!0,params:{ips:{enabled:c.enabled,mode:c.mode,level:c.level}},success:function(){a.success=!0;B()},error:function(){B()}})},cancel:function(){B()},check_for_update:function(){h()},search:function(){y(!0,function(){_.isFunction(a.pagingOps.goTo)?a.pagingOps.goTo(1):a.ui_data.page_num=1})},update:function(){var c=
function(){b.post({method:"action",params:{rpc:"file-copy",input:{fileType:"signature",source:"FILE://Signature/signature_file"}},success:function(b){var c=b&&b.data&&b.data.result||{};b=c.code||-1;c=c.errstr||a.DICT("Ips_Upgrade_Fail");0===b?B():app.TOOLS.criticalAlertBox({msg:c,cbk:function(){B()}})},error:function(){app.TOOLS.criticalAlertBox({msg:errstr,cbk:function(){B()}})}})},d=a.ui_data.pc_file;d.upload=q.upload({url:resource_base+"upload",headers:{"optional-header":"header-value"},data:{sessionid:"EU6DJKEIWO",
pathparam:"Signature",fileparam:"signature_file",file:d}});a.ui_data.uploading=!0;d.upload.then(function(b){a.ui_data.uploading=!1;c()},function(b){a.ui_data.uploading=!1;app.TOOLS.criticalAlertBox({msg:a.DICT("Ips_Upload_Failure"),cbk:function(){B()}})},function(b){a.ui_data.progress=Math.min(100,parseInt(100*b.loaded/b.total,10))})},pcFileFormatCheck:function(b){a.ui_data.pcfile_invalid=!1;a.ui_data.disable_upgradeBtn=!0;void 0!==b&&(b.name.toLowerCase().match(/(\.zip){1}$/)?(a.ui_data.pc_file=
b,a.ui_data.disable_upgradeBtn=!1):(app.TOOLS.criticalAlertBox({title:a.DICT("Error"),msg:a.DICT("Ips_File_Wrong_Format")}),a.ui_data.disable_upgradeBtn=!0))}};B()}]);app.controller("IpsDetailCtrl",["$scope","$uibModalInstance","edit",function(a,b,t){a.edit=t;a.cancel=function(){b.close()}}]);app.controller("appControllerCtrl",["$scope","MyHttp","pgWindow","meta_data_service","$q","UserSession","userAccessRight","device_os_type",function(a,b,t,m,w,u,p,q){a.success=!1;a.expandFlag=!1;a.maxAVCEntity=20;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();var e="",x="",n=function(){return b.post({url:resource_base+"data/avc_meta_data.json",method:"get_avc",error:function(a){console.log("appControllerCtrl getAVCMetaData error "+
a.status);l()}})},l=function(b){b&&b["avc-meta-data"]&&(a.model.meta=m.generate(b["avc-meta-data"],!0))},r=function(){return b.post({url:resource_base+"data/application_controller.json",method:"get_app_control",error:function(a){console.log("appControllerCtrl getAppControllerData error : "+a.status);v()}})},v=function(b){b||(b={});var c=b.avc||{},d=c.policy||[];a.model.enable=void 0!==c.enable?c.enable:!0;a.model.status=void 0!==b.status?b.status:0;a.model.orig_enable=a.model.enable;a.model.policys=
[];angular.forEach(d,function(b){a.model.policys.push(s(b))});a.gridMainOptions.data=a.model.policys;a.dataReady=!0},s=function(b){b||(b={});var c=b.applications||[],d=b["user-exclusion-entry"]||[],g,h,l={name:b.name||"",checked:!1,description:b.description||"",enable:void 0!==b.enable?b.enable:!1,ipgroup:"@none",display_ipgroup:"Any",orig_ipgroup:"",policydevicetype:b["device-type"]||e,policydevicelist:a.model.devicetypes,policyostype:b["os-type"]||"",policyostypelist:[],origapps:[],apps:[],display_apps:[],
schedule:"#always-on",display_schedule:"Always On",exclusions:[],origexclusion:[],meta:angular.copy(a.model.meta)};l.policyostypelist=a.model.ostypes[l.policydevicetype]||[];b["apply-ip-group"]&&(b["ip-groups"]&&b["ip-groups"][0])&&(l.ipgroup=b["ip-groups"][0],l.display_ipgroup=b["ip-groups"][0]);l.orig_ipgroup=l.ipgroup;angular.forEach(b,function(c,d){switch(d){case "schedule":l.schedule=b.schedule||a.model.schedules[0]&&a.model.schedules[0].id||"",l.display_schedule=l.schedule}});l.origname=l.name;
angular.forEach(c,function(b){b.seq&&(b.category&&b.behaviour)&&(b={seq:void 0!==b.seq?b.seq:l.apps.length,category:b.category||"",application:b.application||"",behaviour:b.behaviour||"",action:b.action||"log"},angular.forEach(a.model.meta,function(a){if(g=a.categories[b.category])if("-1"===b.application)angular.forEach(g.applications,function(a){angular.forEach(a.behaviors,function(b){l.display_apps.push({category:g.name,application:a.name,behaviour:b.name})})});else if(h=g.applications[b.application])"-1"===
b.behaviour?angular.forEach(h.behaviors,function(a){l.display_apps.push({category:g.name,application:h.name,behaviour:a.name})}):(be=h.behaviors[b.behaviour])&&l.display_apps.push({category:g.name,application:h.name,behaviour:be.name})}),l.apps.push(b))});l.origapps=angular.copy(l.apps);var n;angular.forEach(d,function(a){n=k(a);n.checked=!1;l.exclusions.push(n)});l.origexclusion=angular.copy(l.exclusions);return l},k=function(b){b||(b={});var c="any",d="",g="",h="",k="",l="",n="",r;angular.forEach(b,
function(a,b){switch(b){case "mac":c="mac";break;case "user-exclusion-ip":if(!a||!a[0])break;a[0].ipv4?(r=a[0].ipv4,r.single?(d=r.single||"",c="ipv4-ip"):r.range&&(h=r.range.start||"",k=r.range.end||"",c="ipv4-range")):a[0].ipv6&&(r=a[0].ipv6,r.single?(g=r.single||"",c="ipv6-ip"):r.range&&(l=r.range.start||"",n=r.range.end||"",c="ipv6-range"))}});b={seq:void 0!==b.seq?b.seq:"",checked:!1,edit:!1,empty:"",ipmac:{select:c,list:a.model.schema.ipmacs,mac:b.mac||"",v4_ip:d||"",v6_ip:g||"",v4_rangeS:h||
"",v6_rangeS:l||"",v4_rangeE:k||"",v6_rangeE:n||""},ecdevicetype:{select:b["device-type"]||e,list:a.model.devicetypes||[]},ecostype:{select:b["os-type"]||x,list:[]}};b.ecostype.list=a.model.ostypes[b.ecdevicetype.select]||[];return b},d=function(){return b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup",error:function(a){console.log("appControllerCtrl getIpGroupData error : "+a.status);c()}})},c=function(b){b||(b={});var c=[],d,g,h,k,l;b["ip-groups"]&&b["ip-groups"]["ip-group"]&&
(c=b["ip-groups"]["ip-group"]);a.model.ipgroups=[{id:"@none",displayName:a.DICT("Application_Control_Any")}];a.model.ex_ipgroups=[];a.model.ipgroups_ips_macs={};angular.forEach(c,function(b){a.model.ex_ipgroups.push({id:b.name,displayName:b.name});d={ips:[],macs:[]};angular.forEach(b.ips,function(b){g={};h="ipv4";b.ipv6&&(h="ipv6");angular.forEach(b[h],function(b,c){switch(c){case "subnet":g="ipv4"===h?{type:a.DICT("Application_Control_Subnet"),address:b.ip+"/"+app.TOOLS.netmask.inet2Int(b.netmask)||
"-"}:{type:a.DICT("Application_Control_Subnet"),address:b.ip+"/"+b["prefix-length"]||"-"};break;case "range":g={type:a.DICT("Application_Control_Range"),address:b.start+" - "+b.end||"-"};break;default:g={type:a.DICT("Application_Control_IP_Address"),address:b}}});k=b["device-type"]||e;l=b["os-type"]||x;angular.extend(g,{seq:b.seq,edit:!0,os_type:{select:l,list:a.model.ostypes[k]||[]},device_type:{select:k,list:a.model.devicetypes}});d.ips.push(g)});angular.forEach(b.macs,function(b){k=b["device-type"]||
e;l=b["os-type"]||x;g={type:a.DICT("Application_Control_MAC_N"),mac:b.mac||"-",edit:!0,device_type:{select:k,list:a.model.devicetypes},os_type:{select:l,list:a.model.ostypes[k]}};d.macs.push(g)});a.model.ipgroups_ips_macs[b.name]=angular.copy(d)});a.model.ipgroups=a.model.ipgroups.concat(a.model.ex_ipgroups)},h=function(){return b.post({url:resource_base+"data/schedule.json",method:"get_schedule",error:function(a){console.log("appControllerCtrl getScheduleData error : "+a.status);g()}})},g=function(b){b||
(b={});var c=[];b.schedules&&b.schedules.schedule&&(c=b.schedules.schedule);a.model.schedules=[{id:"#always-on",displayName:a.DICT("Always_On")}];angular.forEach(c,function(b){a.model.schedules.push({id:b.name,displayName:a.DICT(b.name)})})};t=function(b){a.sel_cnts=0;angular.forEach(a.edit.exclusions,function(b,c){b.checked?a.sel_cnts+=1:b.edit=!1})};u=function(b){a.sel_policy_cnts=0;angular.forEach(a.model.policys,function(b){b.checked&&a.sel_policy_cnts++})};var A=function(){a.dataReady=!1;a.del_policys=
[];w.all([r()]).then(function(b){v(b[0]&&b[0].data&&b[0].data.result||{});a.resetModified()})},y={main:"main",policy_edit:"policy_edit",app_edit:"application_edit"};a.dataReady=!1;a.sel_cnts=0;a.sel_policy_cnts=0;a.currPage="main";a.del_policys=[];a.model={enable:!0,status:0,schema:{},ex_ipgroups:[],ipgroups:[],ipgroups_ips_macs:{},ostypes:{},schedules:[],policys:[],devicetypes:[],meta:[]};a.chk_device_os=function(b){if(a.edit){var c=a.edit,d;c.policyostypelist=a.model.ostypes[c.policydevicetype]||
[];b||(d=!0,angular.forEach(c.policyostypelist,function(a){a===c.policyostype&&(d=!1)}),d&&(c.policyostype=c.policyostypelist&&c.policyostypelist[0]&&c.policyostypelist[0].id||""))}};a.chk_ec_device_os=function(b,c,d,g){var h,e=c.entity;e.ecostype.list=a.model.ostypes[e.ecdevicetype.select]||[];h=!0;angular.forEach(e.ecostype.list,function(a){a===e.ecostype.select&&(h=!1)});h&&(e.ecostype.select=e.ecostype.list&&e.ecostype.list[0]&&e.ecostype.list[0].id||"")};a.change_ipgroup=function(){var b=a.edit,
c=a.model.ipgroups_ips_macs[b.ipgroup];"@none"===b.ipgroup?(a.gridIPSOptions.data=[],a.gridMACOptions.data=[]):(a.gridIPSOptions.data=c.ips,a.gridMACOptions.data=c.macs)};p=function(b,c,d,g){b=c.entity;a.model.ostypes[b.device_type.select]&&(b.os_type.list=a.model.ostypes[b.device_type.select],b.os_type.select=q.get_default_os_type(a.model.ostypes[b.device_type.select]))};a.edit={};a.gridMainOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:u,headerChangedCbk:u},
{field:"name",displayName:a.DICT("Application_Control_Policy_Name_N")},{field:"display_ipgroup",displayName:a.DICT("Application_Control_IP_Group_N")},{field:"display_schedule",displayName:a.DICT("Application_Control_Schedule_Name")},{field:"enable",displayName:a.DICT("Application_Control_Enable"),id:"appctrlpolicy_enable",cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});a.gridApplicationOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"category",displayName:a.DICT("Application_Control_Category")},
{field:"application",displayName:a.DICT("Application_Control_Application_N")},{field:"behaviour",displayName:a.DICT("Application_Control_Behavior")}]});a.gridIPSOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"type",displayName:a.DICT("Application_Control_Type")},{field:"address",displayName:a.DICT("Application_Control_Address")},{field:"device_type",displayName:a.DICT("Application_Control_Device_Type_N"),cellTemplate:"UG_table_select_with_inline_edit.html",editRow:"edit",changedCbk:p},
{field:"os_type",displayName:a.DICT("Application_Control_OS_Type_N"),cellTemplate:"UG_table_select_with_inline_edit.html",editRow:"edit"}]});a.gridMACOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"type",displayName:a.DICT("Application_Control_Type")},{field:"mac",displayName:a.DICT("Application_Control_MAC")},{field:"device_type",displayName:a.DICT("Application_Control_Device_Type_N"),cellTemplate:"UG_table_select_with_inline_edit.html",editRow:"edit",changedCbk:p},{field:"os_type",displayName:a.DICT("Application_Control_OS_Type_N"),
cellTemplate:"UG_table_select_with_inline_edit.html",editRow:"edit"}]});a.gridExclusionInvalidCbk=function(a){a.row.entity.disableExclusionChk=a.rowInvalid};a.gridExclusionOptions=app.uiGrid.generateGridOptions({IDPreifx:"exclusion",rowHeight:1.5*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t,disableChkBoxField:"disableExclusionChk"},{field:"ipmac",displayName:a.DICT("Application_Control_Type"),editRow:"edit",width:155,id:"exclusions_type",cellTemplate:"UG_table_select_with_inline_edit.html"},
{field:"ipmac",displayName:a.DICT("Application_Control_IP_MAC"),editRow:"edit",minWidth:290,validationCbk:"gridExclusionInvalidCbk",required:!0,id:"exclusions_ipgroupmac",cellTemplate:"application_ctrl_ipsel_mactxt.html"},{field:"ecdevicetype",displayName:a.DICT("Application_Control_Device_Type_N"),editRow:"edit",minWidth:200,changedCbk:a.chk_ec_device_os,id:"exclusions_devicetype",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"ecostype",displayName:a.DICT("Application_Control_OS_Type_N"),
editRow:"edit",minWidth:200,id:"exclusions_ostype",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"empty",displayName:"",isEmpty:!0}]});var z=function(){return a.model.policys.length>=a.maxAVCEntity?(a.msg=a.DICT("Application_Control_Max_Policies",{"%s0":a.maxAVCEntity,"%s1":a.model.policys.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},B=function(){return 30<=a.edit.exclusions.length?(a.msg=a.DICT("Application_Control_Max_Exclusion_List",{"%s":a.edit.exclusions.length}),
app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},D=function(c){b.post({method:"del_app_control",params:{avc:{policy:a.del_policys}},success:function(b){"function"===$.type(c)&&c();a.success=!0},error:function(a){"function"===$.type(c)&&c()}})};a.funs={mainSave:function(){var c=function(){b.post({method:"set_app_control",params:{avc:{enable:a.model.enable}},success:function(b){a.success=!0;A()},error:function(a){A()}})};a.model.enable!==a.model.orig_enable?a.del_policys.length?D(c):
c():a.del_policys.length?D(function(){A()}):A()},mainCancel:function(){A()},policyEdit:function(){a.edit=void 0;angular.forEach(a.model.policys,function(b){b.checked&&(a.edit=angular.copy(b))});a.edit?(a.edit.isEditMode=!0,a.change_ipgroup(),a.gridApplicationOptions.data=a.edit.display_apps,a.gridExclusionOptions.data=a.edit.exclusions,a.currPage=y.policy_edit):Log(ERROR,"policy edit button error, checked item is not exist")},policyAdd:function(){z()||(a.edit=s(),a.edit.checked=!0,a.edit.seq=a.model.policys.length,
a.chk_device_os(),a.change_ipgroup(),a.gridApplicationOptions.data=a.edit.display_apps,a.gridExclusionOptions.data=a.edit.exclusions,a.currPage=y.policy_edit,a.modified())},policyDel:function(){for(var b=a.model.policys.length-1;0<=b;b--)a.model.policys[b].checked&&(a.del_policys.push({name:a.model.policys[b].name}),a.model.policys.splice(b,1),a.modified())},exclusionEdit:function(){angular.forEach(a.edit.exclusions,function(b,c){b.checked&&(a.chk_ec_device_os(c,{entity:b}),b.edit=!0)})},exclusionAdd:function(){if(!B()){var b=
k(),c=a.edit.exclusions.length;b.seq=c+1;b.edit=!0;b.checked=!0;a.chk_ec_device_os(c,{entity:b});a.sel_cnts+=1;a.edit.exclusions.push(b);a.gridExclusionOptions.gridApi.customApi.scrollToLast();a.modified()}},exclusionDel:function(){for(var b=a.edit.exclusions.length-1;0<=b;b--)a.edit.exclusions[b].checked&&(a.edit.exclusions.splice(b,1),a.modified(),a.sel_cnts-=1)},policySave:function(){var c=[],d=a.edit,g,h=function(){var g={name:d.name,description:d.description,applications:d.apps,enable:d.enable,
"device-type":d.policydevicetype,"os-type":d.policyostype,"apply-ip-group":"@none"===d.ipgroup?!1:!0,"ip-groups":[],"user-exclusion-entry":c},h,e=[];"@none"!==d.ipgroup&&(g["ip-groups"]=[d.ipgroup],h={name:d.ipgroup,ips:[],macs:[]},angular.forEach(a.model.ipgroups_ips_macs[d.ipgroup].ips,function(a){h.ips.push({seq:a.seq,"device-type":a.device_type.select,"os-type":a.os_type.select})}),angular.forEach(a.model.ipgroups_ips_macs[d.ipgroup].macs,function(a){h.macs.push({mac:a.mac,"device-type":a.device_type.select,
"os-type":a.os_type.select})}),(h.ips.length||h.macs.length)&&e.push({method:"set_ipgroup",params:{"ip-groups":{"ip-group":[h]}}}));"#always-on"===d.schedule?g["always-on"]=null:g.schedule=d.schedule;e.push({method:"set_app_control",params:{avc:{enable:a.model.enable,policy:[g]}}});b.post({method:"set_bulk",params:e,success:function(b){a.success=!0;A();a.currPage=y.main},error:function(b){A();a.currPage=y.main}})};angular.forEach(d.exclusions,function(a,b){g={seq:b+1,"device-type":a.ecdevicetype.select,
"os-type":a.ecostype.select};switch(a.ipmac.select){case "mac":g.mac=a.ipmac.mac;break;case "ipv4-ip":g["user-exclusion-ip"]=[{seq:1,ipv4:{single:a.ipmac.v4_ip}}];break;case "ipv4-range":g["user-exclusion-ip"]=[{seq:1,ipv4:{range:{start:a.ipmac.v4_rangeS,end:a.ipmac.v4_rangeE}}}];break;case "ipv6-ip":g["user-exclusion-ip"]=[{seq:1,ipv6:{single:a.ipmac.v6_ip}}];break;case "ipv6-range":g["user-exclusion-ip"]=[{seq:1,ipv6:{range:{start:a.ipmac.v6_rangeS,end:a.ipmac.v6_rangeE}}}];break;case "any":break;
default:return}c.push(g)});a.del_policys.length?D(h):h()},policyCancel:function(){a.currPage=y.main;a.resetModified()},policy2AppEdit:function(){var b=angular.copy(a.model.meta),c,d,g;a.expandFlag=!1;angular.forEach(a.edit.apps,function(a){angular.forEach(b,function(b){b.categories&&b.categories[a.category]&&(c=b.categories[a.category],"-1"===a.application?(angular.forEach(c.applications,function(b){b.checked=!0;angular.forEach(b.behaviors,function(b){b.checked=!0;b.action=a.action});b.action=a.action}),
c.action=a.action):c.applications&&c.applications[a.application]&&(d=c.applications[a.application],"-1"===a.behaviour?(angular.forEach(d.behaviors,function(b){b.checked=!0;b.action=a.action}),d.action=a.action):d.behaviors&&d.behaviors[a.behaviour]&&(g=d.behaviors[a.behaviour],g.checked=!0,g.action=a.action)))})});a.edit.meta=[];var h=0,e=[],k,l,n;angular.forEach(b,function(a){k=[];angular.forEach(a.categories,function(a){l=[];angular.forEach(a.applications,function(a){n=[];angular.forEach(a.behaviors,
function(a){n.push(a)});a.behaviors=angular.copy(n);l.push(a)});a.applications=angular.copy(l);k.push(a)});a.categories=angular.copy(k);e.push(angular.copy(a))});a.edit.meta=e;var r,m,s;angular.forEach(a.edit.meta,function(a){void 0!==a.name&&(a.id="group"+h,h++);r=!1;angular.forEach(a.categories,function(a){m=!1;angular.forEach(a.applications,function(a){s=!1;angular.forEach(a.behaviors,function(a){a.checked||(s=!0)});!1===s?a.checked=!0:m=!0});!1===m?a.checked=!0:r=!0});!1===r&&(a.checked=!0)});
a.currPage=y.app_edit},policy2IpGroupEdit:function(){},policy2ScheduleEdit:function(){},appSave:function(){a.edit.apps=[];a.edit.display_apps=[];var b=0,c,d,g,h,e,k,l,n,r;angular.forEach(a.edit.meta,function(m){angular.forEach(m.categories,function(m){l=!0;r=[];d=b;h=void 0;angular.forEach(m.applications,function(b){g=void 0;k=e=!0;c=d;n=[];angular.forEach(b.behaviors,function(d){d.checked?(g?g!==d.action&&(e=!1):g=d.action,a.edit.display_apps.push({seq:c,category:m.name,application:b.name,behaviour:d.name,
action:d.action}),n.push({seq:c,category:m.id,application:b.id,behaviour:d.id,action:d.action}),c+=1):k=!1});e&&k?(c=d,n=[{seq:c,category:m.id,application:b.id,behaviour:"-1",action:g}],h||(h=g),c+=1):l=!1;b.checked||(l=!1);h&&h!==g&&(l=!1);d=c;r=r.concat(n)});l?(r=[{seq:b,category:m.id,application:"-1",behaviour:"-1",action:h}],b+=1):b=d;a.edit.apps=a.edit.apps.concat(r)})});a.gridApplicationOptions.data=a.edit.display_apps;a.currPage=y.policy_edit},appCancel:function(){a.currPage=y.main;a.resetModified()},
appBack:function(){a.currPage=y.policy_edit}};a.change_behaviors=function(a,b){var c="",d=function(a){angular.forEach(a,function(a){a.action=c})},g=function(a){angular.forEach(a,function(a){a.action=c;d(a.behaviors)})},c=a.action;if("null"!==c)switch(b){case "group":angular.forEach(a.categories,function(a){a.action=c;g(a.applications)});break;case "category":g(a.applications);break;case "application":d(a.behaviors)}};a.checkPolicyName=function(){var b=!1;a.edit.name?(angular.forEach(a.model.policys,
function(c){a.edit.name===c.name&&(b=!0)}),b?a.appform.name.$setValidity("repeat",!1):a.appform.name.$setValidity("repeat",!0)):a.appform.name.$setValidity("repeat",!0)};a.expandAll=function(b){"true"===b?(angular.forEach(a.edit.meta,function(a){a.expanded=!0;angular.forEach(a.categories,function(a){a.expanded=!0})}),a.expandFlag=!0):(angular.forEach(a.edit.meta,function(a){a.expanded=!1;angular.forEach(a.categories,function(a){a.expanded=!1;angular.forEach(a.applications,function(a){a.expanded=!1})})}),
a.expandFlag=!1)};a.combineNote=a.DICT("Application_Control_Note",{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Application_Control_Here")+"</u></a>"});a.abc;a.model.schema={global_action:[{id:"null",displayName:"------------------"},{id:"log",displayName:a.DICT("Application_Control_Permit_Log")},{id:"pass",displayName:a.DICT("Application_Control_Permit")},{id:"block",displayName:a.DICT("Application_Control_Block")},{id:"log-block",displayName:a.DICT("Application_Control_Block_Log")}],
action:[{id:"log",displayName:a.DICT("Application_Control_Permit_Log")},{id:"pass",displayName:a.DICT("Application_Control_Permit")},{id:"block",displayName:a.DICT("Application_Control_Block")},{id:"log-block",displayName:a.DICT("Application_Control_Block_Log")}],ipmacs:[{id:"any",displayName:a.DICT("Application_Control_Any")},{id:"mac",displayName:a.DICT("Application_Control_MAC_N")},{id:"ipv4-ip",displayName:a.DICT("Application_Control_IPv4_IP_Addr")},{id:"ipv4-range",displayName:a.DICT("Application_Control_IPv4_IP_Range")},
{id:"ipv6-ip",displayName:a.DICT("Application_Control_IPv6_IP_Addr")},{id:"ipv6-range",displayName:a.DICT("Application_Control_IPv6_IP_Range")}]};(function(){a.del_policys=[];w.all([n(),h(),q.get(),d(),r()]).then(function(b){var d;d=b[2]||{};a.model.devicetypes=angular.copy(d.device||[]);a.model.ostypes=angular.copy(d.os||{});e=q.get_default_device_type(a.model.devicetypes);x=q.get_default_os_type(a.model.ostypes[e]);l(b[0]&&b[0].data&&b[0].data.result||{});g(b[1]&&b[1].data&&b[1].data.result||{});
c(b[3]&&b[3].data&&b[3].data.result||{});v(b[4]&&b[4].data&&b[4].data.result||{});a.resetModified()})})();A()}]);app.controller("qos_statistics_main",["$scope","$q","MyHttp","ngGridCellBuilder","$templateCache","Sets","$filter","wan_service","userAccessRight","UserSession",function(a,b,t,m,w,u,p,q,e,x){a.model=a.model||{};a.ctx=a.ctx||{};a.userAccessFlag=e.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&x.logout();a.ctx.displayresult=!1;var n,l,r=function(){var c=t.post({url:resource_base+"data/qos_state.json",method:"get_qos_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+
a.config.url)}}),d=t.post({url:resource_base+"data/qos_wan_bandwidth.json",method:"get_qos_wan_bandwidth",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),g=t.post({url:resource_base+"data/qos_queuing.json",method:"get_qos_queuing",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),h=t.post({url:resource_base+"data/qos_policing.json",method:"get_qos_policing",error:function(a){console.log("AJAX loading error: "+a.status+
", URL: "+a.config.url)}}),e=t.post({url:resource_base+"data/time.json",method:"get_time",success:function(b){a.currentTime=b.data&&b.data.result&&b.data.result["system-state"]&&b.data.result["system-state"].clock?b.data.result["system-state"].clock["current-datetime"]||0:0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,d,g,h,e]).then(function(b){for(var c=0;3>c;c++)angular.extend(a.model,b[c].data.result);b=b[3].data.result;a.model["ciscosb-qos"]||
(a.model["ciscosb-qos"]={});angular.extend(a.model["ciscosb-qos"],b["ciscosb-qos"]["policer-policies"]);a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);b=a.collect_wan_list();a.model.selected=void 0!==a.model.keepifname?a.model.keepifname:b[0].name;a.name=a.model["ciscosb-qos"]["queue-model"]||"";a.model["interfaces-state"]&&a.model["interfaces-state"]["interface"]&&(v(),s());a.gridOutboundStat.data=a.model.outbound;a.gridInboundStat.data=a.model.inbound;a.loadReady=!0})["catch"](function(a){console.log("=="+
a)})};a.model={policy:{},queuepolicy:{},policerpolicy:{},stat:{},outbound:{},inbound:{}};var v=function(){angular.forEach(a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],function(b,c){a.model.queuepolicy[b.name]={description:b.description||"",outbound:b.queues||""}});angular.forEach(a.model["ciscosb-qos"]["policer-policy"],function(b,c){a.model.policerpolicy[b.name]={inbound:b.policer||""}});angular.forEach(n,function(b,c){var d=b["ciscosb-qos"]["qos-policy"].outbound[a.name]||"";a.model.policy[b.name]=
{outboundpolicyname:d||"",description:a.model.queuepolicy[d].description||"",inboundpolicyname:b["ciscosb-qos"]["qos-policy"].inbound["rate-control"]||""||""}})},s=function(){l=h();angular.forEach(l,function(b,c){a.model.stat[b.name]={outbound:void 0!==b["ciscosb-qos"]["queue-statistics"].outbound?b["ciscosb-qos"]["queue-statistics"].outbound:"",inbound:void 0!==b["ciscosb-qos"]["queue-statistics"].inbound?b["ciscosb-qos"]["queue-statistics"].inbound:"",last_reset_time:void 0!==b["ciscosb-qos"]["queue-statistics"]["last-reset-time"]?
b["ciscosb-qos"]["queue-statistics"]["last-reset-time"]:""}});k();d();c()},k=function(){a.model.outbound=[];var b=a.model["ciscosb-qos"]["queue-model"]||"",c=a.model.queuepolicy[a.model.policy[a.model.selected].outboundpolicyname||""]||"",d={};if("priority"===b){a.model.stat[a.model.selected]&&(""!==a.model.stat[a.model.selected].outbound&&void 0!==a.model.stat[a.model.selected].outbound)&&(d=a.model.stat[a.model.selected].outbound.priority||"");for(var b=["highest","high","medium","low"],g=0;g<b.length;g++)a.model.outbound.push({queue:g+
1,tclass:""!==c.outbound&&void 0!==c.outbound.priority[b[g]]?c.outbound.priority[b[g]]:"<unspecified>",sent:d[b[g]]&&void 0!==d[b[g]].packets?d[b[g]].packets:"0",drop:d[b[g]]&&void 0!==d[b[g]].discards?d[b[g]].discards:"0"})}else if("rate-control"===b){var h=[],e=[];a.model.stat[a.model.selected]&&(""!==a.model.stat[a.model.selected].outbound&&void 0!==a.model.stat[a.model.selected].outbound)&&(d=a.model.stat[a.model.selected].outbound["rate-control"]||"");angular.forEach(d.queue,function(a,b){h["id"+
a.id]={packets:a.packets||"0",discards:a.discards||"0"}});angular.forEach(c.outbound["rate-control"].queue,function(a,b){e["id"+a.id]={tclass:void 0!==a.match?a.match:"<unspecified>"}});for(g=0;8>g;g++)a.model.outbound.push({queue:g+1,tclass:void 0!==(e["id"+(g+1)]&&e["id"+(g+1)].tclass)?e["id"+(g+1)].tclass:"<unspecified>",sent:void 0!==(h["id"+(g+1)]&&h["id"+(g+1)].packets)?h["id"+(g+1)].packets:"0",drop:void 0!==(h["id"+(g+1)]&&h["id"+(g+1)].discards)?h["id"+(g+1)].discards:"0"})}else if("low-latency"===
b){a.model.stat[a.model.selected]&&(""!==a.model.stat[a.model.selected].outbound&&void 0!==a.model.stat[a.model.selected].outbound)&&(d=a.model.stat[a.model.selected].outbound["low-latency"]||"");b=["priority","queue1","queue2","queue3"];for(g=0;g<b.length;g++)a.model.outbound.push({queue:g+1,tclass:""!==c.outbound&&void 0!==c.outbound["low-latency"][b[g]].match?c.outbound["low-latency"][b[g]].match:"<unspecified>",sent:void 0!==(d[b[g]]&&d[b[g]].packets)?d[b[g]].packets:"0",drop:void 0!==(d[b[g]]&&
d[b[g]].discards)?d[b[g]].discards:"0"})}a.gridOutboundStat.data=a.model.outbound},d=function(){a.model.inbound=[];var b=[],c=[],d=a.model.policerpolicy[a.model.policy[a.model.selected].inboundpolicyname||""]||"",g={};a.model.stat[a.model.selected]&&(""!==a.model.stat[a.model.selected].inbound&&void 0!==a.model.stat[a.model.selected].inbound)&&(g=a.model.stat[a.model.selected].inbound);angular.forEach(g.queue,function(a,c){b["id"+a.id]={packets:a.packets||"0",discards:a.discards||"0"}});angular.forEach(d.inbound["class"],
function(a,b){c["id"+a.id]={tclass:void 0!==a.match?a.match:"<unspecified>"}});for(d=0;8>d;d++)a.model.inbound.push({queue:d+1,tclass:void 0!==(c["id"+(d+1)]&&c["id"+(d+1)].tclass)?c["id"+(d+1)].tclass:"<unspecified>",sent:void 0!==(b["id"+(d+1)]&&b["id"+(d+1)].packets)?b["id"+(d+1)].packets:"0",drop:void 0!==(b["id"+(d+1)]&&b["id"+(d+1)].discards)?b["id"+(d+1)].discards:"0"});a.gridInboundStat.data=a.model.inbound},c=function(){var b=a.model.stat[a.model.selected]&&""!==a.model.stat[a.model.selected].last_reset_time?
a.model.stat[a.model.selected].last_reset_time:0,c=0;0!==a.currentTime&&0!==b&&(c=Date.parse(a.currentTime)/1E3-Date.parse(b)/1E3);a.model.lastResetTime=0<c?{days:Math.floor(c/86400),hours:Math.floor(c%86400/3600),minutes:Math.floor(c%86400%3600/60)}:{days:"0",hours:"0",minutes:"0"}};a.update=function(){k();d();c()};a.collect_wan_list=function(){a.filterWAN_WANsub={physical:!0,subinterface:!1,usb:!0};var b=[];a.model.interfaces&&a.model.interfaces["interface"]&&(b=q.filter(a.model.interfaces["interface"],
a.filterWAN_WANsub));return n=b};var h=function(){a.filterWAN_WANsub={physical:!0,subinterface:!1,usb:!0};var b=[];a.model["interfaces-state"]&&a.model["interfaces-state"]["interface"]&&(b=q.filter(a.model["interfaces-state"]["interface"],a.filterWAN_WANsub));return b};a.gridOutboundStat=app.uiGrid.generateGridOptions({columnDefs:[{field:"queue",displayName:a.DICT("Switch_QoS_Statistics_Queue")},{field:"tclass",displayName:a.DICT("Switch_QoS_Statistics_Traffic_Class")},{field:"sent",displayName:a.DICT("Switch_QoS_Statistics_Packets_Sent")},
{field:"drop",displayName:a.DICT("Switch_QoS_Statistics_Packets_Dropped")}]});a.gridInboundStat=app.uiGrid.generateGridOptions({columnDefs:[{field:"queue",displayName:a.DICT("Switch_QoS_Statistics_Queue")},{field:"tclass",displayName:a.DICT("Switch_QoS_Statistics_Traffic_Class")},{field:"sent",displayName:a.DICT("Switch_QoS_Statistics_Packets_Sent")},{field:"drop",displayName:a.DICT("Switch_QoS_Statistics_Packets_Dropped")}]});var g=function(a){if(a&&a.rpc){var b={rpc:a.rpc};a.input&&(b.input=a.input);
t.post({method:"action",background:a.background||!1,params:b,success:function(b){"function"===$.type(a.success)&&a.success(b)},error:function(b){"function"===$.type(a.error)&&a.error(b)}})}};a.clear=function(){a.model.keepifname=a.model.selected;var b=function(b){if(b.data.result&&b.data.result.output)switch(a.ctx.displayresult=!0,b.data.result.output.code){case 0:a.ctx.return_code=!0;r();break;default:a.ctx.return_code=!1}else console.log("Error: getRPCResult, data.result not exist")};g({rpc:"reset-qos-statistics",
input:{"interface-name":a.model.selected},success:b,error:b})};r()}]);app.controller("tcpIPServicesCtrl",["$scope","MyHttp",function(a,b){var t={"127.0.0.1":"localhost"};a.DICT("CLOSE_WAIT");a.DICT("ESTABLISHED");var m={tcpv4:"tcp4",udpv4:"udp4",tcpv6:"tcp6",udpv6:"udp6"},w=function(b){a.model.ports=[];a.model.connections=[];b||(b={});var t=[],n=[];b["tcp-ip-services-state"]&&b["tcp-ip-services-state"].service&&(t=b["tcp-ip-services-state"].service);b["tcp-ip-services-state"]&&b["tcp-ip-services-state"].connection&&(n=b["tcp-ip-services-state"].connection);angular.forEach(t,
function(b,e){a.model.ports.push({protocol:m[b.protocol],ip_addrress:q(b["listen-ip-address"]),list_port:p(b["listen-port"],b["listen-port-alias"]),listen_port_alias:b["listen-port-alias"]})});angular.forEach(n,function(b,e){a.model.connections.push({protocol:m[b.protocol],local_ip_address:q(b["local-ip-address"]),local_port:p(b["local-port"],b["local-port-alias"]),foreign_address:q(b["foreign-address"]),foreign_port:p(b["foreign-port"],b["foreign-port-alias"]),status:b.status})});a.gridPortOptions.data=
a.model.ports;a.gridConnectionOptions.data=a.model.connections},u=function(b){a.model.services=[];angular.forEach(b.services.service,function(b,e){b["port-range"]&&a.model.services.push({name:b.name,start:b["port-range"].start,end:b["port-range"].end})})},p=function(a,b){return res=b?b+" ("+a+")":a},q=function(a){var b=t[a];return b?b+" ("+a+")":a?a:"*"};a.dataReady=!1;a.model={services:[],ports:[],connections:[]};a.gridPortOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"protocol",displayName:a.DICT("TCP-IP_Services_Protocol")},
{field:"ip_addrress",displayName:a.DICT("TCP-IP_Services_Listen_IP_Addr")},{field:"list_port",displayName:a.DICT("TCP-IP_Services_Listen_Port")}]});a.gridConnectionOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"protocol",displayName:a.DICT("TCP-IP_Services_Protocol")},{field:"local_ip_address",displayName:a.DICT("TCP-IP_Services_Local_IP_Addr")},{field:"local_port",displayName:a.DICT("TCP-IP_Services_Local_Port")},{field:"foreign_address",displayName:a.DICT("TCP-IP_Services_Foreign_Addr")},
{field:"foreign_port",displayName:a.DICT("TCP-IP_Services_Foreign_Port")},{field:"status",displayName:a.DICT("TCP-IP_Services_Status")}]});(function(){b.post({method:"get_services",url:resource_base+"data/service_management.json",success:function(a){u(a.data.result)},error:function(a){console.log("tcpIPServicesCtrl getServicesData error, status: "+a.status)}})})();(function(){b.post({method:"get_tcp_ip_services_state",url:resource_base+"data/status_tcp_ip_services.json",success:function(b){w(b.data.result);
a.dataReady=!0},error:function(b){console.log("tcpIPServicesCtrl getData error, status: "+b.status);a.dataReady=!0}})})()}]);app.controller("DhcpBindingCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,t,m){a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();a.model={bindings:[]};a.dataReady=!1;var w=function(){b.post({url:resource_base+"data/dhcp_bindings.json",method:"get_dhcp_binding_state",success:function(a){p(a.data&&a.data.result)},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},u={"provided-isp":a.DICT("DHCP_Bindings_Provided_ISP"),
dynamic:a.DICT("DHCP_Bindings_Dynamic"),"static":a.DICT("DHCP_Bindings_Static")},p=function(b){a.model.bindings=[];b||(b={});var e=[],m,n;b["dhcp-binding-state"]&&b["dhcp-binding-state"].entry&&(e=b["dhcp-binding-state"].entry);angular.forEach(e,function(b){m=parseInt(b["lease-expire-time"],10);if(!isNaN(m))if(0<m){var e=m,v=Math.floor(e/86400),s=Math.floor((e-86400*v)/3600),e=[v,s,Math.floor((e-86400*v-3600*s)/60),Math.floor(e%60)];m=e[0]+" days, "+e[1]+" hours, "+e[2]+" minutes"}else m="--";n=u[b.type];
a.model.bindings.push({hostname:b.hostname||"--",ip_address:b["ip-address"]||"--",mac:b.mac,lease_expire_time:m||"--",type:n||"--",action:[{displayName:a.DICT("DHCP_Bindings_Delete"),className:"icon-delete",cbk:a.deleteRule}]})});a.gridDHCPBindingOptions.data=a.model.bindings;a.dataReady=!0};a.gridDHCPBindingOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"hostname",displayName:a.DICT("DHCP_Bindings_Hostname")},{field:"ip_address",displayName:a.DICT("DHCP_Bindings_IPv4_v6_Addr")},{field:"mac",
displayName:a.DICT("DHCP_Bindings_MAC_Addr")},{field:"lease_expire_time",displayName:a.DICT("DHCP_Bindings_Lease_Expires")},{field:"type",displayName:a.DICT("DHCP_Bindings_Type")},{field:"action",displayName:a.DICT("DHCP_Bindings_Action"),cellTemplate:"UG_table_icons.html"}]});a.deleteRule=function(a,e){b.post({method:"action",forcedUsingGet:!0,params:{rpc:"dhcp-release-binding",input:{mac:e.entity.mac}},success:function(){w()},error:function(){w()}})};a.refresh=function(){w()};w()}]);app.controller("conn_devices_main",["$scope","MyHttp",function(a,b){var t=app.rshelper,m={"static":a.DICT("Connected_Devices_Static"),dynamic:a.DICT("Connected_Devices_Dynamic"),pppoe:a.DICT("Connected_Devices_PPPoe"),pptp:a.DICT("Connected_Devices_PPTP"),"trasparent-bridge":a.DICT("Connected_Devices_TB"),l2tp:a.DICT("Connected_Devices_L2TP")},w=function(a){a=a||{};b.post({method:"get_connect_device",url:resource_base+"data/conn_devices.json",success:function(b){u(b.data.result,a)},error:function(a){console.log("conn_devices_main Error status: "+
a.status)}})},u=function(b,e){b||(b={});var p=e.ip_type||"any",n=!1,l=!1,r=b["interfaces-state"]&&b["interfaces-state"]["interface"]||[],v,s,k;if("ipv4"===p||"any"===p)n=!0,a.model.ipv4State=[];if("ipv6"===p||"any"===p)l=!0,a.model.ipv6State=[];angular.forEach(r,function(b,c){v=b.name;s=b.ipv4&&b.ipv4.neighbor||[];k=b.ipv6&&b.ipv6.neighbor||[];n&&angular.forEach(s,function(b){a.model.ipv4State.push({hostname:b.hostname||"-",ip:b.ip||"-",mac:b["link-layer-address"]||"-",type:m[b.origin]||"-",intf:v||
"-",checked:!1,disableChk:!1})});l&&angular.forEach(k,function(b){a.model.ipv6State.push({ip:b.ip||"-",mac:b["link-layer-address"]||"-",checked:!1,disableChk:!1})})});a.gridIPv4State.Options.data=a.model.ipv4State;a.gridIPv6State.Options.data=a.model.ipv6State;a.dataReady=!0};a.forcedUsingPost=!0;a.gridIPv4State={};a.gridIPv4State.totalServerItems=0;a.gridIPv4State.Selections=[];a.gridIPv4State.procNgClick=function(b){a.gridIPv4State.Selections=[];angular.forEach(a.model.ipv4State,function(b,m){b.checked?
(a.gridIPv4State.Selections.push(b),t.rs_event_trig(b,"SEL_ITEM_EVENT")):t.rs_event_trig(b,"DESEL_ITEM_EVENT")})};a.gridIPv4State.add_to_static_dhcp=function(){var b=[],e;angular.forEach(a.gridIPv4State.Selections,function(a,n){e={name:a.mac.replace(/:/g,"_"),mac:a.mac,"ip-address":a.ip,enable:!0};a.hostname&&("*"!==a.hostname&&"-"!==a.hostname)&&(e.name=a.hostname);b.push(e)});p(b)};a.gridIPv4State.refresh=function(){w({ip_type:"ipv4"})};a.gridIPv4State.Options=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",
isCheckbox:!0,changedCbk:a.gridIPv4State.procNgClick,headerChangedCbk:a.gridIPv4State.procNgClick,disableChkBoxField:"disableChk"},{field:"hostname",displayName:a.DICT("Connected_Devices_Hostname")},{field:"ip",displayName:a.DICT("Connected_Devices_IPv4_Addr")},{field:"mac",displayName:a.DICT("Connected_Devices_MAC_Addr")},{field:"type",displayName:a.DICT("Connected_Devices_Type")},{field:"intf",displayName:a.DICT("Connected_Devices_Interface")}]});a.gridIPv6State={};a.gridIPv6State.Options=app.uiGrid.generateGridOptions({columnDefs:[{field:"ip",
displayName:a.DICT("Connected_Devices_IPv6_Addr")},{field:"mac",displayName:a.DICT("Connected_Devices_MAC_Addr")}]});a.gridIPv6State.refresh=function(){w({ip_type:"ipv6"})};a.model={ipv4State:[],ipv6State:[]};var p=function(m){m=app.modelhelper.web2dbFn({static_dhcp:{entry:m}});b.post({url:resource_base+"p_data/rpc_result.json",method:"set_dhcp_static",forcedUsingPost:a.forcedUsingPost,params:m,success:function(b){a.success=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+
a.config.url);modelinit()}})};a.dataReady=!1;w()}]);app.controller("system_summary_main",["$scope","$q","MyHttp","$templateCache","rpcFns","Sets","$filter","wan_service","wan_lib","userAccessRight","UserSession","modelInfo","dt",function(a,b,t,m,w,u,p,q,e,x,n,l,r){var v=app.TOOLS.getVal,s=!1,k=void 0;a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.usbs=a.ctx.usbs||[];a.jumpToPage=app.TOOLS.jumpToPage;a.model.vpnstatus=[];a.model.bootup_time="";a.model.current_time="";a.model.bootup_timstamp="";a.model.current_timestamp="";var d=void 0,c=a.DICT("System_Summary_Days"),
h=a.DICT("System_Summary_Hours"),g=a.DICT("System_Summary_Minutes"),A=a.DICT("System_Summary_Sec");a.spec=a.spec||{};a.forcedUsingPost=!0;var y={procBackground:!0,forcedUsingPost:a.forcedUsingPost},z={procBackground:!1,forcedUsingPost:a.forcedUsingPost};a.userAccessFlag=x.get();a.ruFlag=x.russia();a.wan1MAC="";a.wan2MAC="";a.vlanMAC="";a.cpuMemUsage="N/A";"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();a.checkRepeat=[];0<=l.get_pid().search("RV345")?(a.checkRepeat.push("0"),a.checkRepeat.push("1")):
a.checkRepeat.push("0");a.spec.WifiSupport=l.spec_WifiSupport();a.model_wifi=a.model_wifi||{};a.model.radio24g=a.model.radio24g||{};a.model.radio5g=a.model.radio5g||{};a.model.radio24g_enable="";a.model.radio24g_mac="";a.model.radio24g_channel="";a.model.radio24g_mode="";a.model.radio24g_bw="";a.model.radio5g_enable="";a.model.radio5g_mac="";a.model.radio5g_channel="";a.model.radio5g_mode="";a.model.radio5g_bw="";var B=function(){var c=t.post({url:resource_base+"data/system_summary.json",method:"get_system_info",
procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),d=t.post({url:resource_base+"data/wlan_button_state.json",method:"get_wifi_button_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),g=t.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",procBackground:!0,error:function(a){console.log("WANSettingCtrl error: "+a.status)}}),h,k,l,n,r,m,d=b.all([c,d,g]).then(function(c){Log(DEBUG,
"phase1_promise");for(var d=0;d<c.length;d++)H(c[d]);a.use_firmware_state_sample={"firmware-state":{version:"N/A","latest-version":"N/A",images:{image:[]}}};u.recover_object(a.model,a.use_firmware_state_sample);a.schema=a.schema||{};a.schema.PortNameList={LAN1:{role:"1",alias:"LAN"},LAN2:{role:"2",alias:"LAN"},LAN3:{role:"3",alias:"LAN"},LAN4:{role:"4/DMZ",alias:"LAN"},LAN5:{role:"5",alias:"LAN"},LAN6:{role:"6",alias:"LAN"},LAN7:{role:"7",alias:"LAN"},LAN8:{role:"8",alias:"LAN"},USB1:{role:"USB",
alias:"USB1"},USB2:{role:"USB",alias:"USB2"},USB3:{role:"USB",alias:"USB3"},WAN1:{role:"Internet",alias:"WAN1"},WAN2:{role:"Internet",alias:"WAN2"},WAN_PORT1:{role:"Internet",alias:"WAN1"},WAN_PORT2:{role:"Internet",alias:"WAN2"}};a.schema.StatusMap={"true":a.DICT("System_Summary_On"),"false":a.DICT("System_Summary_Off")};a.schema.RV345PortNameList={LAN1:{role:"1",alias:"LAN"},LAN2:{role:"2",alias:"LAN"},LAN3:{role:"3",alias:"LAN"},LAN4:{role:"4",alias:"LAN"},LAN5:{role:"5",alias:"LAN"},LAN6:{role:"6",
alias:"LAN"},LAN7:{role:"7",alias:"LAN"},LAN8:{role:"8",alias:"LAN"},LAN9:{role:"9",alias:"LAN"},LAN10:{role:"10",alias:"LAN"},LAN11:{role:"11",alias:"LAN"},LAN12:{role:"12",alias:"LAN"},LAN13:{role:"13",alias:"LAN"},LAN14:{role:"14",alias:"LAN"},LAN15:{role:"15",alias:"LAN"},LAN16:{role:"16/DMZ",alias:"LAN"},USB1:{role:"USB",alias:"USB1"},USB2:{role:"USB",alias:"USB2"},WAN1:{role:"Internet",alias:"WAN1"},WAN2:{role:"Internet",alias:"WAN2"},WAN_PORT1:{role:"Internet",alias:"WAN1"},WAN_PORT2:{role:"Internet",
alias:"WAN2"}};C();F();N();E();R();h=t.post({url:resource_base+"data/system_summary.json",method:"get_interface_state",procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});var g=b.defer();k=g.promise;!0===a.spec.WifiSupport&&function(){Log(DEBUG,"=initWifiRequest");n=t.post({url:resource_base+"data/wlan_radio.json",method:"get_wifi_interfaces",params:{filter:"WLAN"},procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+
", URL: "+a.config.url)}});r=t.post({url:resource_base+"data/wlan_radio_state.json",method:"get_radio_state",procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});m=t.post({url:resource_base+"data/wlan_state.json",method:"get_wlan_state",procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})}();var s=b.defer();l=s.promise;h.then(function(b){var c=!0;if(0===(((b.data&&b.data.result||{})["interfaces-state"]||
{})["interface"]||[]).length)c=!1;c?(H(b),a.use_interfaces_state_sample={"interfaces-state":{"interface":[]}},u.recover_object(a.model,a.use_interfaces_state_sample),I(),T(),S(),a.loadReady_port=!0,g.resolve(),Log(DEBUG,"promiseOverlay"),s.resolve()):(Log(DEBUG,"promiseOverlay Data Abnormal"),s.reject())});c=e.init();b.all([l,c]).then(function(a){Log(DEBUG,"promiseOverlay promise4");(a=a[1]&&a[1][0])&&W(a);L()});k.then(function(b){b=b||{};if((b=(b.data||{}).result||{})&&b["interfaces-state"]&&b["interfaces-state"]["interface"]&&
b["interfaces-state"]["interface"])b=b["interfaces-state"]["interface"],a.filter_WAN=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}},angular.forEach(b,function(b,c){if(b&&b.name&&b.ddns){var d="^"+b.name+"$";if((d=p("filter")(a.collect_wan_list("interfaces-state"),a.filter_WAN(d)))&&d[0])d=d[0],d.ddns=d.ddns||{},u.recover_object(d.ddns,b.ddns)}});a.loadReday_DDNS=!0});!0===a.spec.WifiSupport&&function(){Log(DEBUG,"=procWifiRequest");n.then(function(b){if((b=(b.data||{}).result||
{})&&b.interfaces&&b.interfaces["interface"]){a.model_wifi=angular.copy(b);a.model.radio24g=G(a.model_wifi,"WLAN1");a.model.radio5g=G(a.model_wifi,"WLAN2");a.model.radio24g_mode=a.model.radio24g.radio&&a.model.radio24g.radio["operating-standards"]&&a.model.radio24g.radio["operating-standards"][0]||"";for(a.model.radio24g_mode="802.11"+a.model.radio24g_mode;0<=a.model.radio24g_mode.search(" ");)a.model.radio24g_mode=a.model.radio24g_mode.replace(" ","/");a.model.radio24g_bw=a.model.radio24g.radio&&
a.model.radio24g.radio["operating-channel-bandwidth"]||"";a.model.radio5g_mode=a.model.radio5g.radio&&a.model.radio5g.radio["operating-standards"]&&a.model.radio5g.radio["operating-standards"][0]||"";for(a.model.radio5g_mode="802.11"+a.model.radio5g_mode;0<=a.model.radio5g_mode.search(" ");)a.model.radio5g_mode=a.model.radio5g_mode.replace(" ","/");a.model.radio5g_bw=a.model.radio5g.radio&&a.model.radio5g.radio["operating-channel-bandwidth"]||""}});r.then(function(b){(b=(b.data||{}).result||{})&&
(b["interfaces-state"]&&b["interfaces-state"]["interface"])&&angular.forEach(b["interfaces-state"]["interface"],function(b){b.name&&("WLAN1"===b.name?(a.model.radio24g_mac=b["phys-address"]?b["phys-address"]:"",a.model.radio24g_channel=b.radio&&b.radio["channels-in-use"]?b.radio["channels-in-use"][0]:""):"WLAN2"===b.name&&(a.model.radio5g_mac=b["phys-address"]?b["phys-address"]:"",a.model.radio5g_channel=b.radio&&b.radio["channels-in-use"]?b.radio["channels-in-use"][0]:""))})});m.then(function(b){a.model.radio24g_enable=
"Disabled";a.model.radio5g_enable="Disabled";a.model.radio24g=G(a.model_wifi,"WLAN1");a.model.radio5g=G(a.model_wifi,"WLAN2");1===a.model.wifi_button_state&&(a.model.radio24g&&!0===a.model.radio24g.radio.enable&&(a.model.radio24g_enable="Enabled"),a.model.radio5g&&!0===a.model.radio5g.radio.enable&&(a.model.radio5g_enable="Enabled"))})}();a.get_usb_object().then(function(b){a.ctx.usbs=b.usbs||[]});a.loadReady=!0;Log(DEBUG,"phase1_promise Done")})["catch"](function(a){console.log("=="+a)}),g=b.all([d,
function(){return b.all([c]).then(function(a){return t.post({url:resource_base+"data/vpn_summary.json",method:"get_vpn_summary",params:{},procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})}(),function(){return b.all([c]).then(function(a){return t.post({url:resource_base+"data/security_summary.json",method:"get_security_summary",params:{},procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})}()]).then(function(b){for(var c=
1;c<b.length;c++)H(b[c]);a.use_vpn_summary_sample={"ipsec-profiles":{"ipsec-profile":[]},"site-to-sites":{"site-to-site":[]},"client-to-sites":{"client-to-site":[]},l2tp:{enable:!0},"l2tp-state":{connections:{connection:[]}},pptp:{enable:!0},"pptp-state":{connections:{connection:[]}},sslvpn:{enable:!1}};u.recover_object(a.model,a.use_vpn_summary_sample);a.loadReady_p2=!0;C()});b.all([d,g]).then(function(b){a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model)})};B();var D=function(a){t.post({url:resource_base+
"data/system_summary.json",method:"get_sys_state_platform",procBackground:!0,isPolling:!0,success:function(b){H(b);N();_.isFunction(a)&&a()},error:function(b){N();_.isFunction(a)&&a()}})},E=function(){void 0!==k&&clearTimeout(k);k=void 0;k=setTimeout(function(){k=void 0;D(function(){s||E()})},5E3)},C=function(){var b=a.model["site-to-sites"]||{},c=b["site-to-site"]||[],d=a.model["client-to-sites"]||{},g=d["client-to-site"]||[],h=a.model.l2tp||{},e=a.model.pptp||{},k=a.model.sslvpn||{},l=k["group-policies"]&&
k["group-policies"]["group-policy"]||[];a.model.vpnstatus=[];a.model.vpnstatus.push({name:a.DICT("System_Summary_Ipsec"),active:1<=a.getEnabledItems(c).length?a.DICT("System_Summary_Enabled"):a.DICT("System_Summary_Disabled"),configures:c.length||0,max_entity:b["max-tunnel"]||"-",connected_cnt:a.getConnNumOf("site-to-site-state")||0});a.model.vpnstatus.push({name:a.DICT("System_Summary_Easy_Vpn"),active:1<=a.getEnabledItems(g).length?a.DICT("System_Summary_Enabled"):a.DICT("System_Summary_Disabled"),
configures:g.length||0,max_entity:d["max-group"]||"-",connected_cnt:a.getConnNumOf("client-to-site-state")||0});a.model.vpnstatus.push({name:a.DICT("System_Summary_L2TP"),active:h.enable?a.DICT("System_Summary_Enabled"):a.DICT("System_Summary_Disabled"),configures:1,max_entity:h["max-session"]||"-",connected_cnt:a.getConnNumOf("l2tp-state")||0});a.model.vpnstatus.push({name:a.DICT("System_Summary_PPTP"),active:e.enable?a.DICT("System_Summary_Enabled"):a.DICT("System_Summary_Disabled"),configures:1,
max_entity:e["max-session"]||"-",connected_cnt:a.getConnNumOf("pptp-state")||0});a.model.vpnstatus.push({name:a.DICT("System_Summary_SSLVPN"),active:k.enable?a.DICT("System_Summary_Enabled"):a.DICT("System_Summary_Disabled"),configures:l.length||0,max_entity:k["max-session"]||0,connected_cnt:a.getConnNumOf("sslvpn-state")||0});a.gridVPNStatus.data=a.model.vpnstatus},I=function(){angular.forEach(a.model["interfaces-state"]["interface"],function(b){"WAN1"===b.name?a.wan1MAC=b["phys-address"]:"WAN2"===
b.name?a.wan2MAC=b["phys-address"]:"VLAN1"===b.name&&(a.vlanMAC=b["phys-address"])})},G=function(a,b){var c={};if(!a||!a.interfaces||!a.interfaces["interface"])return c;for(var d=a.interfaces["interface"].length,g="",h=0;h<d;h++)if(g=a.interfaces["interface"][h].name,g.match(b)){c=angular.copy(a.interfaces["interface"][h]);break}return c},H=function(b){angular.extend(a.model,b.data.result)},F=function(){var b=(a.model["system-state"]||{}).clock||{},c=b["boot-datetime"]||"",b=r.parser(b["current-datetime"]||
"");0===b.err_code&&(a.model.current_timestamp=r.get_time(b));b=r.parser(c);0===b.err_code&&(a.model.bootup_timstamp=r.get_time(b));K();M();d=setInterval(function(){a.model.current_timestamp&&(a.model.current_timestamp+=1E3);M()},1E3)},K=function(){d&&(clearInterval(d),d=void 0)},M=function(){var b,d,e,k;_.isNumber(a.model.current_timestamp)?(d=r.new_date(a.model.current_timestamp),a.model.current_time=r.timeStr(d),_.isNumber(a.model.bootup_timstamp)?(b=Math.abs(a.model.current_timestamp-a.model.bootup_timstamp),
b/=1E3,d=b%60,b=(b-d)/60,e=b%60,b=(b-e)/60,k=b%24,b=(b-k)/24,a.model.bootup_time=b+" "+c+" "+k+" "+h+" "+e+" "+g+" "+d+" "+A):a.model.bootup_time="N/A",app.TOOLS.apply(a)):(a.model.current_time="N/A",a.model.bootup_time="N/A",K())},N=function(){if(!a.model["system-state"]||!a.model["system-state"].platform)a.cpuMemUsage="N/A";else{var b=a.model["system-state"].platform||{},c=b.memory||{},b=v(b["cpu-usage"],""),c=v(c["physical-memory-usage"],""),d="",d=_.isNumber(b)&&_.isNumber(c)?b+"% / "+c+"%":"N/A";
a.cpuMemUsage=d}},J=[{name:"WAN_PORT1"},{name:"WAN_PORT2"}],R=function(){a.model&&a.model["fake-interfaces-state"]&&a.model["fake-interfaces-state"]["interface"]?a.model["fake-interfaces-state"]["interface"].splice(0):a.model["fake-interfaces-state"]={"interface":[]};var b=p("filter")(a.model.interfaces["interface"],function(a,b,c){return a.name&&a.name.match(/^(LAN|WAN|WAN_PORT|USB)/)?!0:!1}),b=b.concat(J);a.model["fake-interfaces-state"]["interface"]=angular.copy(b)},W=function(b){var c=a.collect_wan_list("interfaces");
angular.forEach(c,function(a,c){angular.forEach(b,function(b,c){a.name==b.name&&(a.ipv4=a.ipv4||{},a.ipv6=a.ipv6||{},a.ipv4.connectType=b.ipv4.connectType,a.ipv6.connectType=b.ipv6.connectType)})})},S=function(){var b=a.collect_wan_list("interfaces-state"),c=a.collect_wan_list("interfaces");angular.forEach(b,function(a,b){angular.forEach(c,function(b,c){a.name==b.name&&(a._ref=b)})})},X=function(a){var b=[],c=[],d=[];angular.forEach(a,function(a){0<=a.name.search("WAN1")?b.push(a):0<=a.name.search("WAN2")&&
c.push(a)});1<b.length&&(b=b.sort(function(a,b){var c="",d="",c=0<=a.name.search("WAN1.")?a.name.replace("WAN1.",""):"0",d=0<=b.name.search("WAN1.")?b.name.replace("WAN1.",""):"0",c=parseInt(c,10),d=parseInt(d,10);return c>d?1:-1}));1<c.length&&(c=c.sort(function(a,b){var c="",d="",c=0<=a.name.search("WAN2.")?a.name.replace("WAN2.",""):"0",d=0<=b.name.search("WAN2.")?b.name.replace("WAN2.",""):"0",c=parseInt(c,10),d=parseInt(d,10);return c>d?1:-1}));return d=angular.copy(b.concat(c))},T=function(){a.filterWAN_WANsub=
{physical:!1,subinterface:!1,usb:!0};var b=q.filter(a.model["interfaces-state"]["interface"],a.filterWAN_WANsub);a.filterWAN_WANsub={physical:!0,subinterface:!0,usb:!1};var c=q.filter(a.model["interfaces-state"]["interface"],a.filterWAN_WANsub),d=p("filter")(a.model["interfaces-state"]["interface"],function(a,b,c){return a.name&&a.name.match(/^TUN\d+/)?!0:!1}),c=X(c),c=c.concat(b),c=c.concat(d);a.ctx=a.ctx||{};a.ctx.ifs_overlay=angular.copy(c)},L=function(){a.filterWANlogic={subinterface:!0,logical:!0};
var b=q.filter(a.model["interfaces-state"]["interface"],a.filterWANlogic),c=q.filter(a.ctx.ifs_overlay,{physical:!0,subinterface:!0}),d=function(a){var c=p("filter")(b,function(b,c,d){return b.name&&b.name.match("^"+a+"$")?!0:!1});if(c&&c[0])return c[0]},g=function(a,b){var c;if(a._ref&&a._ref[b]&&a._ref[b].connectType){c=a._ref[b].connectType;var g,h=a.name.replace(/^(WAN[0-9]+).*/,"$1"),e=a.name.replace(/^(WAN[0-9]+).*(\.[0-9]+$)/,"$2");"."!=e.charAt(0)&&(e="");switch(c){case "l2tp":g=h+"-L2TP"+
e;delete a[b];break;case "pptp":g=h+"-PPTP"+e;delete a[b];break;case "pppoe":g=h+"-PPPOE"+e;delete a[b];break;case "trasparent-bridge":g=h+"-BRIDGE"+e,delete a[b]}if(c=d(g))c&&c[b]&&(a[b]=angular.extend(c[b])),c&&c.ddns&&(a.ddns=angular.extend(c.ddns))}};angular.forEach(c,function(a,b){a.name.match(/^WAN/)&&(g(a,"ipv4"),g(a,"ipv6"))})};a.gridVPNStatus=app.uiGrid.generateGridOptions({minRowsToShow:6,columnDefs:[{field:"name",minWidth:200,displayName:a.DICT("System_Summary_Type")},{field:"active",minWidth:85,
displayName:a.DICT("System_Summary_Enabled")},{field:"configures",minWidth:100,displayName:a.DICT("System_Summary_Configured")},{field:"max_entity",minWidth:185,displayName:a.DICT("System_Summary_Max_Supported_Sessions")},{field:"connected_cnt",minWidth:200,displayName:a.DICT("System_Summary_Connected_Sessions")}]});a.showMultiWanState=function(b,c){var d="isNA",g=b["redundant-wan"]||{},h={offline:a.DICT("System_Summary_Offline"),disabled:a.DICT("System_Summary_Detection_Disabled"),online:a.DICT("System_Summary_Online")};
"ipv6"===c?g["ipv6-status"]&&h[g["ipv6-status"]]&&(d=g["ipv6-status"]):g["ipv4-status"]&&h[g["ipv4-status"]]&&(d=g["ipv4-status"]);return d};a.showDdnsState=function(b,c){var d="",g;b&&(b.ddns&&(b.ddns.status&&b.ddns.status.state)&&(g=b.ddns.status.state),"ipv6"===c&&!b._ref[c].enabled&&(g="disabled"));return d=void 0==g?a.DICT("System_Summary_Disabled"):"disabled"==g?a.DICT("System_Summary_Disabled"):g};a.OnOff=function(b){return a.schema.StatusMap[b]};a.get_usb_object=function(){var a=b.defer();
w.RPC_generic_send("usb-check-attached",void 0,function(b,c,d){d=d||{};a.resolve(d)},void 0,y);return a.promise};a.showPortSpeed=function(a){return"Connected"==a["link-status"]&&a["speed-status"]?a["speed-status"]+"Mbps":"--"};a.PortNoData=function(){return a.loadReady_port?"N/A":""};a.collect_port_list=function(b){b=parseInt(b,10);var c=[],d=[];a.loadReady&&a.loadReady_port?(c=a.model["interfaces-state"]["interface"],d=a.ctx.usbs):(c=a.model["fake-interfaces-state"]["interface"],d=a.model["fake-interfaces-state"]["interface"]);
var g=app.TOOLS.sortingInterfaceFn(!1),h=p("filter")(c,function(a,b,c){return a.name.match(/^LAN\d+$/)?!0:!1}),h=h.sort(g),c=p("filter")(c,function(a,b,c){return a.name.match(/^WAN_PORT\d+$/)?!0:!1}),c=c.sort(g),g=p("filter")(d,function(a,b,c){return a.name.match(/^USB\d+$/)?!0:!1}),e=h.concat(c).concat(g),d=[];if(0<=l.get_pid().search("RV345")){d=e.slice(10*b,10*(b+1));b=10-d.length;for(b=Math.max(0,b);0<b;b--)d.push(null);return d}return h.concat(c).concat(g)};a.showUSB=function(b){b=b||{};if(angular.isDefined(b.attached))b=
b["usbs-type"]||"";else return"";return 0<=b.search("3g")?"3G":0<=b.search("4g")?"4G":0<=b.search("mass-storage")?a.DICT("System_Summary_Storage"):0<=b.search("other")?a.DICT("System_Summary_Other"):"disconnect"};a.showIF=function(a){var b="";a=a||{};b=a["link-status"]||"";"NotConnected"==b?b="disconnect":"Connected"==b&&(b="connected");return b};a.collect_wan_list=function(b){var c=[];"interfaces-state"==b?c=a.ctx.ifs_overlay||[]:(a.filterWAN_WANsub={physical:!0,subinterface:!0,usb:!0},c=q.filter(a.model[b]["interface"],
a.filterWAN_WANsub));return c};a.collect_ifstate_list=function(b){var c=[],d;d=a.loadReady&&a.loadReady_port?"interfaces-state":"fake-interfaces-state";"ipv4"==b?(c=a.collect_wan_list(d),c=p("filter")(c,function(a,b,c){return a.name&&a.name.match(/^TUN\d+/)?!1:!0})):"ipv6"==b&&(c=a.collect_wan_list(d));return c};a.collect_firmware_state=function(b){var c=[];a.model&&(a.model["image-state"]&&a.model["image-state"].firmware&&a.model["image-state"].firmware.images&&a.model["image-state"].firmware.images.image)&&
(c=a.model["image-state"].firmware.images.image);return p("filter")(c,function(a,c,d){return a.active&&a.active.match(b)?!0:!1})};a.show_firmware_value=function(b,c){var d=a.collect_firmware_state(b),g;d&&(d[0]&&d[0][c])&&(g=d[0][c]);return g};a.isGotIp=function(a,b){if(a[b]&&a[b].address&&a[b].address[0]&&a[b].address[0].ip){var c=a[b].address[0].ip;if(!(""==c||"::"==c||"0.0.0.0"==c)&&a._ref&&a._ref[b]&&a._ref[b].enabled&&"dynamic"===a._ref[b].connectType)return!0}return!1};a.dhcp_renewed=function(a,
b){var c=a._ref;if(c&&c[b]&&c[b].connectType){switch(c[b].connectType){case "dynamic":return!0}return!1}};var U=function(b,c,d,g){return(c=p("filter")(a.ctx.usbs,function(a,c,d){return b&&a.name.match("^"+b.name+"$")&&a.attached&&("3g"==a["usbs-type"]||"4g"==a["usbs-type"])?!0:!1}))&&0<c.length?"connect"==d&&!g?!0:"disconnect"==d&&g?!0:!1:"noattach"};a.WAN_connected=function(a,b,c){var d=a._ref,g=!1;a[b]&&(a[b].address&&a[b].address[0]&&a[b].address[0].ip)&&(g=a[b].address[0].ip,g=""==g||"::"==g||
"0.0.0.0"==g?!1:!0);if(a.name.match(/^USB/))a=U(a,b,c,g);else a:if(!d||!d[b]||!d[b].connectType)a=void 0;else{switch(d[b].connectType){case "pppoe":case "l2tp":case "pptp":if("connect"==c&&!g){a=!0;break a}else if("disconnect"==c&&g){a=!0;break a}}a=!1}return a};a.RPC_connection=function(a,c,d){var g=b.defer();c={"interface":c.name,"ip-version":d.substr(2)};w.RPC_generic_send(a,c,function(a,b,c){a=c.code;switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");c=c||{};g.resolve(c);break;
default:console.log(b+": RPC done. got unknown code: "+a)}},void 0,z);return g.promise};a.do_dhcp_op=function(b,c,d){a.RPC_connection(d,b,c).then(function(a){B()})};a.do_conn_op=function(b,c,d){var g=a.RPC_connection(d,b,c);"disconnect"==d&&g.then(function(a){0==a.code&&(b[c]&&b[c].address&&b[c].address.splice(0),b[c].gateway="")});g.finally(function(){B()})};var V=function(a,b,c){return a.enable?!0:!1};a.getEnabledItems=function(a){return p("filter")(a,V)};a.getConnNumOf=function(b){if(!a.loadReady_p2)return"-";
var c=function(a,b,c){return"UP"===a.status.toUpperCase()?!0:!1};if(("pptp-state"==b||"l2tp-state"==b||"site-to-site-state"==b)&&a.model[b]&&a.model[b].connections&&a.model[b].connections.connection){var d=a.model[b].connections.connection;return"site-to-site-state"==b?p("filter")(d,c).length:d.length}if("sslvpn-state"==b&&a.model[b]&&a.model[b]["group-policies"]&&a.model[b]["group-policies"]["group-policy"]){var d=a.model[b]["group-policies"]["group-policy"],g=0;angular.forEach(d,function(a,b){0<
a.sessions&&(g+=a.sessions)});return g}if("client-to-site-state"==b&&a.model[b]&&a.model[b].connection){var d=a.model[b].connection,h=0;angular.forEach(d,function(a,b){0<a.tunnels&&(h+=a.tunnels)});return h}return 0};a.selected=a.selected||{};a.$on("$destroy",function(){K();void 0!==k&&clearTimeout(k);k=void 0;s=!0})}]);app.controller("system_summary_ipv4",["$scope",function(a){a.iptype="ipv4"}]);app.controller("system_summary_ipv6",["$scope",function(a){a.iptype="ipv6"}]);app.controller("routing_status_main",["$scope","$rootScope","$log","MyHttp","$http","ngGridCellBuilder","$templateCache","Sets",function(a,b,t,m,w,u,p,q){a.model=a.model||{};a.dataReady=!1;(function(){m.post({url:resource_base+"data/routing_status.json",method:"get_routing_state",success:function(b){angular.extend(a.model,b.data.result);a.model["routing-state"]||angular.extend(a.model,{"routing-state":{"routing-instance":[{name:"default",ribs:{rib:[{name:"local","address-family":"ipv4-unicast",routes:{route:[]}},
{name:"local6","address-family":"ipv6-unicast",routes:{route:[]}}]}}]}});a.schema=a.schema||{};a.schema.sourceEnum={"static":a.DICT("Routing_Status_Static"),direct:a.DICT("Routing_Status_Direct"),rip:a.DICT("Routing_Status_RIP")};a.model_orig=angular.copy(a.model);a.gridRoutes.Options1.data=a.model["routing-state"]["routing-instance"][0].ribs.rib[0].routes.route;a.gridRoutes.Options2.data=a.model["routing-state"]["routing-instance"][0].ribs.rib[1].routes.route;a.dataReady=!0},error:function(b){a.gridRoutes.Options1.data=
[];a.gridRoutes.Options2.data=[];console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}})})();a.doDiff=function(){a.diff4=q.getDiff(a.model_orig,a.model,{mode:a.mode});var b=a.diff4;a.setOnly=q.filterNonNull(b);a.delOnly=q.getDiff(a.setOnly,b,{mode:3})};a.doDiffTest=function(){a.diffTest()};a.diffTest=function(){a.doDiff()};a.gridRoutes=a.gridRoutes||{};a.gridRoutes.Options1=app.uiGrid.generateGridOptions({columnDefs:[{field:"v4ur:destination-prefix",displayName:a.DICT("Routing_Status_Destination")},
{field:"next-hop",displayName:a.DICT("Routing_Status_Next_Hop"),cellTemplate:p.get("UG_CellText_empty_filled_dash.html").replace(/MODEL_COL_FIELD/g,"MODEL_COL_FIELD['v4ur:next-hop-address']")},{field:"metric",displayName:a.DICT("Routing_Status_Metric"),cellTemplate:p.get("UG_CellText_empty_filled_dash.html")},{field:"next-hop",displayName:a.DICT("Routing_Status_Interface"),cellTemplate:p.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"MODEL_COL_FIELD['outgoing-interface']")},{field:"source-protocol",
displayName:a.DICT("Routing_Status_Source"),cellTemplate:p.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"grid.appScope.schema.sourceEnum[MODEL_COL_FIELD]")}]});a.gridRoutes.Options2=app.uiGrid.generateGridOptions({columnDefs:[{field:"v6ur:destination-prefix",displayName:a.DICT("Routing_Status_Destination")},{field:"next-hop",displayName:a.DICT("Routing_Status_Next_Hop"),cellTemplate:p.get("UG_CellText_empty_filled_dash.html").replace(/MODEL_COL_FIELD/g,"MODEL_COL_FIELD['v6ur:next-hop-address']")},
{field:"metric",displayName:a.DICT("Routing_Status_Metric"),cellTemplate:p.get("UG_CellText_empty_filled_dash.html")},{field:"next-hop",displayName:a.DICT("Routing_Status_Interface"),cellTemplate:p.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"MODEL_COL_FIELD['outgoing-interface']")},{field:"source-protocol",displayName:a.DICT("Routing_Status_Source"),cellTemplate:p.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"grid.appScope.schema.sourceEnum[MODEL_COL_FIELD]")}]})}]);app.controller("switch_qos_statistics_main",["$scope","$q","MyHttp","ngGridCellBuilder","$templateCache","Sets","$filter","wan_service",function(a,b,t,m,w,u,p,q){a.model=a.model||{};var e=0,x=0;(function(){var e=t.post({url:resource_base+"data/qos_switch_state.json",method:"get_qos_switch_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),l=t.post({url:resource_base+"data/qos_switch_classification.json",method:"get_qos_switch_classification",error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}});b.all([e,l]).then(function(b){for(var d=0;2>d;d++)angular.extend(a.model,b[d].data.result);a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.model.lastresettime="0 days, 0, and 0 minutes";a.loadReady=!0}).catch(function(a){console.log("=="+a)})})();a.model={lanList:[],lagList:[]};var n=function(){var b=a.model.interfaces["interface"];b&&angular.forEach(b,function(a,b){a.name.match(/^LAN\d+/)&&e++;a.name.match(/^LAG\d+/)&&x++})},l=function(){var b=
a.model["interfaces-state"]["interface"],l=[];b&&angular.forEach(b,function(a,b){a.name.match(/^LAN\d+/)&&(l[a.name]={stat:a["ciscosb-switch-qos"].queues.queue||void 0})});for(b=0;b<e;b++){var k=l["LAN"+(b+1)].stat,d=[];k&&angular.forEach(k,function(a,b){d["id"+a.id]={packets:a.packets,discards:a.discards}});a.model.lanList.push({port:b+1,queue1:{sent:void 0!==(d.id1&&d.id1.packets)?d.id1.packets:"0",drop:void 0!==(d.id1&&d.id1.discards)?d.id1.discards:"0"},queue2:{sent:void 0!==(d.id2&&d.id2.packets)?
d.id2.packets:"0",drop:void 0!==(d.id2&&d.id2.discards)?d.id2.discards:"0"},queue3:{sent:void 0!==(d.id3&&d.id3.packets)?d.id3.packets:"0",drop:void 0!==(d.id3&&d.id3.discards)?d.id3.discards:"0"},queue4:{sent:void 0!==(d.id4&&d.id4.packets)?d.id4.packets:"0",drop:void 0!==(d.id4&&d.id4.discards)?d.id4.discards:"0"}})}},r=function(){var b=a.model["interfaces-state"]["interface"],e=[];b&&angular.forEach(b,function(a,b){a.name.match(/^LAG\d+/)&&(e[a.name]={stat:a["ciscosb-switch-qos"].queues.queue||
void 0})});for(b=0;b<x;b++){var k=e["LAG"+(b+1)].stat,d=[];k&&angular.forEach(k,function(a,b){d["id"+a.id]={packets:a.packets,discards:a.discards}});a.model.lagList.push({group:b+1,queue1:{sent:void 0!==(d.id1&&d.id1.packets)?d.id1.packets:"0",drop:void 0!==(d.id1&&d.id1.discards)?d.id1.discards:"0"},queue2:{sent:void 0!==(d.id2&&d.id2.packets)?d.id2.packets:"0",drop:void 0!==(d.id2&&d.id2.discards)?d.id2.discards:"0"},queue3:{sent:void 0!==(d.id3&&d.id3.packets)?d.id3.packets:"0",drop:void 0!==(d.id3&&
d.id3.discards)?d.id3.discards:"0"},queue4:{sent:void 0!==(d.id4&&d.id4.packets)?d.id4.packets:"0",drop:void 0!==(d.id4&&d.id4.discards)?d.id4.discards:"0"}})}};a.show_stat=function(){a.model["interfaces-state"]&&a.model["interfaces-state"]["interface"]&&(n(),l(),r())}}]);app.controller("port_traffic_main",["$scope","$q","MyHttp","$timeout","modelInfo","userAccessRight","UserSession",function(a,b,t,m,w,u,p){0<=w.get_pid().search("RV340W")&&(a.rv340w_flag=1);a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&p.logout();var q=function(){b.all({state_traffic:function(){return t.post({url:resource_base+"data/port_traffic.json",method:"get_interface_traffic",error:function(a){console.log("port_traffic_main getData Error status: "+a.status)}})}(),
port_settings:function(){return t.post({url:resource_base+"data/lan_port_settings.json",method:"get_port_settings",error:function(a){console.log("port_traffic_main getData Error status: "+a.status)}})}()}).then(function(a){var b=a.state_traffic,c=x;b.data&&b.data.result?c(b.data.result):c();a=a.port_settings;b=e;a.data&&a.data.result?b(a.data.result):b()})},e=function(b){b||(b={});b.interfaces=b.interfaces||{};b.interfaces["interface"]=b.interfaces["interface"]||[];var c=function(a,b){a=a||[];angular.forEach(a,
function(a,c){b.name===a.id&&(a.description=b.description)})};angular.forEach(b.interfaces["interface"],function(b,d){c(a.model.portTraffic,b);c(a.model.portStatus,b)})},x=function(b){b||(b={});var c;a.model.portTraffic=[];a.model.wirelessTraffic=[];a.model.portStatus=[];var d=[],e=[],k=void 0!==b["interfaces-state"]&&void 0!==b["interfaces-state"]["interface"]?b["interfaces-state"]["interface"]:{};angular.forEach(k,function(b,g){var h=b.name||"";if(h.match(/^LAN\d+$/)||!("WAN_PORT1"!==h&&"WAN_PORT2"!==
h)){"WAN_PORT1"===h&&(h="WAN1");"WAN_PORT2"===h&&(h="WAN2");var k=n(b["link-status"]||""),l=b.statistics||{},r=0,m=0,s=0,v=0,p=0,r=parseInt(l["in-unicast-pkts"],10)||0,r=r+(parseInt(l["in-broadcast-pkts"],10)||0),r=r+(parseInt(l["in-multicast-pkts"],10)||0),m=l["in-octets"]||0,s=parseInt(l["out-unicast-pkts"],10)||0,s=s+(parseInt(l["out-broadcast-pkts"],10)||0),s=s+(parseInt(l["out-multicast-pkts"],10)||0),v=l["out-octets"]||0,p=l["in-errors"]||0,p=p+(l["out-errors"]||0);c=[{className:k?"icon-up":
"icon-down",displayName:k?a.DICT("Up"):a.DICT("Down")}];if(4<=h.length&&"LAN"===h.substr(0,3))d.push({id:h,status:c,rx_packets:r,rx_bytes:m,tx_packets:s,tx_bytes:v,packet_error:p});else if(4<=h.length&&"WAN"===h.substr(0,3))e.push({id:h,status:c,rx_packets:r,rx_bytes:m,tx_packets:s,tx_bytes:v,packet_error:p});else if(4==h.length&&"USB"===h.substr(0,3)){var q=k=0,B=0,k=void 0!==l["in-multicast-pkts"]?parseInt(l["in-multicast-pkts"],10):0,q=void 0!==l["in-discards"]?parseInt(l["in-discards"],10):0,
q=q+(void 0!==l["out-discards"]?parseInt(l["out-discards"],10):0),B=void 0!==l["in-collision-pkts"]?parseInt(l["in-collision-pkts"],10):0,B=B+(void 0!==l["out-collision-pkts"]?parseInt(l["out-collision-pkts"],10):0);a.model.wirelessTraffic.push({ssid:h,radio:"",status:c,rx_packets:r,rx_bytes:m,tx_packets:s,tx_bytes:v,mcast_packets:k,packet_error:p,packet_drop:q,collisions:B})}}});d=h(d,"LAN");e=h(e,"WAN");a.model.portTraffic=angular.copy(d.concat(e));d=[];e=[];k=void 0!==b["interfaces-state"]&&void 0!==
b["interfaces-state"]["interface"]?b["interfaces-state"]["interface"]:{};angular.forEach(k,function(b){var c=void 0!==b.name?b.name:"";if(c.match(/^LAN\d+$/)||"WAN_PORT1"===c||"WAN_PORT2"===c){"WAN_PORT1"===c&&(c="WAN1");"WAN_PORT2"===c&&(c="WAN2");var g=n(b["link-status"]||""),h=[{displayName:g?a.DICT("Up"):a.DICT("Down"),className:g?"icon-up":"icon-down"}],k;switch(void 0!==b["port-activity"]?b["port-activity"]:""){case "enable":k=a.DICT("Port_Traffic_Enabled");break;case "disable":k=a.DICT("Port_Traffic_Disabled");
break;default:k=""}var l;switch(void 0!==b["duplex-status"]?b["duplex-status"]:""){case "half":l=a.DICT("Port_Traffic_Half");break;case "full":l=a.DICT("Port_Traffic_Full");break;default:l=""}var r;switch(void 0!==b["auto-negotiated"]?b["auto-negotiated"]:""){case !0:r=a.DICT("Port_Traffic_Enabled");break;default:r=a.DICT("Port_Traffic_Disabled")}c.match(/^LAN\d+$/)?d.push({id:c,type:void 0!==b.type?b.type:"",status:h,activity:k,speed:void 0!==b["speed-status"]?"Not Connected"===g?"--":b["speed-status"]:
"",duplex:"Not Connected"===g?"--":l,auto_negoti:r}):e.push({id:c,type:void 0!==b.type?b.type:"",status:h,activity:k,speed:void 0!==b["speed-status"]?"Not Connected"===g?"--":b["speed-status"]:"",duplex:"Not Connected"===g?"--":l,auto_negoti:r})}});d=h(d,"LAN");e=h(e,"WAN");a.model.portStatus=angular.copy(d.concat(e));a.rv340w_flag&&v();a.gridPortTrafficItems.data=a.model.portTraffic;a.gridWirelessTrafficItems.data=a.model.wirelessTraffic;a.gridPortStatusItems.data=a.model.portStatus;a.dataReady=
!0},n=function(a){switch(a){case "Connected":a=!0;break;default:a=!1}return a},l=function(){t.post({url:resource_base+"data/wlan_ssid.json",method:"get_wifi_settings",success:function(a){r(a.data.result)},error:function(a){console.log("getData Error status: "+a.status)}})},r=function(b){b||(b={});b=(b.wlans||{}).ssid||[];var d=0,h=0,e=a.ssid_state,k=a.ssid_statistics;a.model.showWireless=[];angular.forEach(b,function(b){var g=c(b),l=0,n=0,r=0,m=0,s=0,v=0,p=0,q=0,t=0,u="",x=function(){g=c(b);t=q=p=
v=s=m=r=n=l=0},w=function(){k["VAP1_"+d]&&(l=parseInt(k["VAP1_"+d].in_unicast,10)||0,l+=parseInt(k["VAP1_"+d].in_broadcast,10)||0,l+=parseInt(k["VAP1_"+d].in_multicast,10)||0,r=parseInt(k["VAP1_"+d].out_unicast,10)||0,r+=parseInt(k["VAP1_"+d].out_broadcast,10)||0,r+=parseInt(k["VAP1_"+d].out_multicast,10)||0,n=parseInt(k["VAP1_"+d].in_octets,10)||0,m=parseInt(k["VAP1_"+d].out_octets,10)||0,s=parseInt(k["VAP1_"+d].in_multicast,10)||0,s+=parseInt(k["VAP1_"+d].out_multicast,10)||0,v=parseInt(k["VAP1_"+
d].in_errors,10)||0,v+=parseInt(k["VAP1_"+d].out_errors,10)||0,p=parseInt(k["VAP1_"+d].in_discards,10)||0,p+=parseInt(k["VAP1_"+d].out_discards,10)||0,q=parseInt(k["VAP1_"+d].in_collision,10)||0,q+=parseInt(k["VAP1_"+d].out_collision,10)||0,t=parseInt(e["VAP1_"+d].number,10)||0)},X=function(){k["VAP2_"+h]&&(l=parseInt(k["VAP2_"+h].in_unicast,10)||0,l+=parseInt(k["VAP2_"+h].in_broadcast,10)||0,l+=parseInt(k["VAP2_"+h].in_multicast,10)||0,r=parseInt(k["VAP2_"+h].out_unicast,10)||0,r+=parseInt(k["VAP2_"+
h].out_broadcast,10)||0,r+=parseInt(k["VAP2_"+h].out_multicast,10)||0,n=parseInt(k["VAP2_"+h].in_octets,10)||0,m=parseInt(k["VAP2_"+h].out_octets,10)||0,s=parseInt(k["VAP2_"+h].in_multicast,10)||0,s+=parseInt(k["VAP2_"+h].out_multicast,10)||0,v=parseInt(k["VAP2_"+h].in_errors,10)||0,v+=parseInt(k["VAP2_"+h].out_errors,10)||0,p=parseInt(k["VAP2_"+h].in_discards,10)||0,p+=parseInt(k["VAP2_"+h].out_discards,10)||0,q=parseInt(k["VAP2_"+h].in_collision,10)||0,q+=parseInt(k["VAP2_"+h].out_collision,10)||
0,t=parseInt(e["VAP2_"+h].number,10)||0)},T=function(){a.model.showWireless.push({ssid:b.ssid,vlan:b.vlan_id||1,radio:u,status:b.enable?a.DICT("Port_Traffic_Enabled"):a.DICT("Port_Traffic_Disabled"),rx_packets:l,rx_bytes:n,tx_packets:r,tx_bytes:m,mcast_packets:s,packet_error:v,packet_drop:p,collisions:q,no_client:t})};switch(g){case "2.4G":d++;u="2.4G";x();w();T();break;case "5G":h++;u="5G";x();X();T();break;case "Both":for(var L=0;2>L;L++)L?(h++,u="5G",x(),X()):(d++,u="2.4G",x(),w()),T();break;default:console.log("Error "+
g)}});a.gridWifiTrafficItems.data=a.model.showWireless},v=function(){t.post({url:resource_base+"data/ssid_state.json",method:"get_ssid_state",params:{filter:"BRIEF"},success:function(a){s(a.data.result);k()},error:function(a){console.log("getData Error status: "+a.status)}})},s=function(b){b||(b={});a.ssid_state={};b["interfaces-state"]&&b["interfaces-state"]["interface"]&&angular.forEach(b["interfaces-state"]["interface"],function(b,c){if(b&&b.name){var d=b.ssid||"";a.ssid_state[b.name]={number:void 0!==
d["associated-device-count"]?d["associated-device-count"]:""}}})},k=function(){t.post({url:resource_base+"data/port_traffic.json",method:"get_interface_statistics",params:{filter:"SSID"},success:function(a){d(a.data.result);l()},error:function(a){console.log("getData Error status: "+a.status)}})},d=function(b){b||(b={});a.ssid_statistics={};b["interfaces-state"]&&b["interfaces-state"]["interface"]&&angular.forEach(b["interfaces-state"]["interface"],function(b,c){if(b&&b.name){var d=b.statistics||
"";a.ssid_statistics[b.name]={in_octets:void 0!==d["in-octets"]?d["in-octets"]:"",in_unicast:void 0!==d["in-unicast-pkts"]?d["in-unicast-pkts"]:"",in_broadcast:void 0!==d["in-broadcast-pkts"]?d["in-broadcast-pkts"]:"",in_multicast:void 0!==d["in-multicast-pkts"]?d["in-multicast-pkts"]:"",in_discards:void 0!==d["in-discards"]?d["in-discards"]:"",in_errors:void 0!==d["in-errors"]?d["in-errors"]:"",out_octets:void 0!==d["out-octets"]?d["out-octets"]:"",out_unicast:void 0!==d["out-unicast-pkts"]?d["out-unicast-pkts"]:
"",out_broadcast:void 0!==d["out-broadcast-pkts"]?d["out-broadcast-pkts"]:"",out_multicast:void 0!==d["out-multicast-pkts"]?d["out-multicast-pkts"]:"",out_discards:void 0!==d["out-discards"]?d["out-discards"]:"",out_errors:void 0!==d["out-errors"]?d["out-errors"]:"",in_collision:void 0!==d["in-collision-pkts"]?d["in-collision-pkts"]:"",out_collision:void 0!==d["out-collision-pkts"]?d["out-collision-pkts"]:""}}})},c=function(a){return"WLAN1"===a.radio?"2.4G":"WLAN2"===a.radio?"5G":"BOTH"===a.radio?
"Both":"None"},h=function(a,b){1<a.length&&(a=a.sort(function(a,c){var d="",g="",d=0<=a.id.search(b)?a.id.replace(b,""):"0",g=0<=c.id.search(b)?c.id.replace(b,""):"0",d=parseInt(d,10),g=parseInt(g,10);return d>g?1:-1}));return a};a.gridPortTrafficItems=app.uiGrid.generateGridOptions({columnDefs:[{field:"id",displayName:a.DICT("Port_Traffic_Port_ID")},{field:"description",displayName:a.DICT("Port_Traffic_Port_Label")},{field:"status",displayName:a.DICT("Port_Traffic_Link_Status"),cellTemplate:"UG_table_icons.html"},
{field:"rx_packets",displayName:a.DICT("Port_Traffic_Rx_Packets")},{field:"rx_bytes",displayName:a.DICT("Port_Traffic_Rx_Bytes")},{field:"tx_packets",displayName:a.DICT("Port_Traffic_Tx_Packets")},{field:"tx_bytes",displayName:a.DICT("Port_Traffic_Tx_Bytes")},{field:"packet_error",displayName:a.DICT("Port_Traffic_Packet_Error")}]});a.gridWirelessTrafficItems=app.uiGrid.generateGridOptions({columnDefs:[{field:"ssid",displayName:a.DICT("Port_Traffic_SSID_Name"),sort:{direction:"asc"}},{field:"status",
displayName:a.DICT("Port_Traffic_Status"),cellTemplate:"UG_table_icons.html"},{field:"rx_packets",displayName:a.DICT("Port_Traffic_Rx_Packets")},{field:"rx_bytes",displayName:a.DICT("Port_Traffic_Rx_Bytes")},{field:"tx_packets",displayName:a.DICT("Port_Traffic_Tx_Packets")},{field:"tx_bytes",displayName:a.DICT("Port_Traffic_Tx_Bytes")},{field:"mcast_packets",displayName:a.DICT("Port_Traffic_Multicast_Packets")},{field:"packet_error",displayName:a.DICT("Port_Traffic_Packet_Error")},{field:"packet_drop",
displayName:a.DICT("Port_Traffic_Packet_Dropped")},{field:"collisions",displayName:a.DICT("Port_Traffic_Collisions")}]});a.gridPortStatusItems=app.uiGrid.generateGridOptions({columnDefs:[{field:"id",displayName:a.DICT("Port_Traffic_Port_ID")},{field:"description",displayName:a.DICT("Port_Traffic_Port_Label")},{field:"status",displayName:a.DICT("Port_Traffic_Link_Status"),cellTemplate:"UG_table_icons.html"},{field:"activity",displayName:a.DICT("Port_Traffic_Port_Activity")},{field:"speed",displayName:a.DICT("Port_Traffic_Speed_Status")},
{field:"duplex",displayName:a.DICT("Port_Traffic_Duplex_Status")},{field:"auto_negoti",displayName:a.DICT("Port_Traffic_Auto_Negotiation")}]});a.gridWifiTrafficItems=app.uiGrid.generateGridOptions({columnDefs:[{field:"ssid",displayName:a.DICT("Port_Traffic_SSID_Name")},{field:"vlan",displayName:a.DICT("Port_Traffic_VLAN")},{field:"radio",displayName:a.DICT("Port_Traffic_Radio_Name")},{field:"status",displayName:a.DICT("Port_Traffic_Status")},{field:"rx_packets",displayName:a.DICT("Port_Traffic_Rx_Packets")},
{field:"rx_bytes",displayName:a.DICT("Port_Traffic_Rx_Bytes")},{field:"tx_packets",displayName:a.DICT("Port_Traffic_Tx_Packets")},{field:"tx_bytes",displayName:a.DICT("Port_Traffic_Tx_Bytes")},{field:"mcast_packets",displayName:a.DICT("Port_Traffic_Multicast_Packets")},{field:"packet_error",displayName:a.DICT("Port_Traffic_Packet_Error")},{field:"packet_drop",displayName:a.DICT("Port_Traffic_Packet_Dropped")},{field:"collisions",displayName:a.DICT("Port_Traffic_Collisions")},{field:"no_client",displayName:a.DICT("Port_Traffic_No_Clients")}]});
a.model={portTraffic:[],wirelessTraffic:[],portStatus:[],showWireless:[]};a.funs={refresh:function(){q()},reset:function(){t.post({method:"action",params:{rpc:"reset-counters"},success:function(a){q()},error:function(a){q()}})},freezeButton:function(b){a.ctx.btnDisabled=!0;m(function(){a.ctx.btnDisabled=!1},1E3*b)},wifiRefresh:function(){v()},wifiReset:function(){t.post({method:"action",params:{rpc:"reset-wifi-counters"},success:function(a){v()},error:function(a){v()}})}};a.ctx=a.ctx||{};a.dataReady=
!1;q()}]);app.controller("app_statistics_main",["$scope","MyHttp","userAccessRight","UserSession","$q","dt",function(a,b,t,m,w,u){var p=app.TOOLS.int2str2,q=app.TOOLS.str2int,e=app.TOOLS.getVal,x=app.TOOLS.getResponse,n=app.TOOLS.MBpkt2String,l=app.TOOLS.cpuPercentageNum,r=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var v=function(a){return b.post({method:"get_interface_statistics",procBackground:a,isPolling:a,params:{filter:"WAN"},
url:resource_base+"data/port_traffic.json",error:function(a){}})},s=function(b,c){var g=[],h,e,k,l,n,r,m,s,v,p,y,z,A,B,t,u,x,w,C=new Date,D,E=[],da,Z=function(a){return!_.isNumber(a)||0>a?0:a};b&&(b["interfaces-state"]&&b["interfaces-state"]["interface"])&&(g=b["interfaces-state"]["interface"]);d();B=a.model.tf_last_idx;C=C.getTime();a.ui_data.def_interface="";angular.forEach(g,function(b){if(b.name.match(/^WAN_PORT\d+$/)||b.name.match(/^USB\d+$/)){y=b.statistics||{};A="WAN_PORT1"===b.name?a.ui_data.def_interface=
"WAN1":"WAN_PORT2"===b.name?"WAN2":b.name;if(void 0===a.model.traffic_data[A]){if(a.model.interfaces.push({id:A,displayName:A}),a.model.traffic_data[A]={chart_data:[[],[]],orig_data:[[],[],[]]},w=a.model.traffic_data[A],void 0!==B)for(x=0;x<=B;x++)w.chart_data[0].push(0),w.chart_data[1].push(0),w.orig_data[0].push(0),w.orig_data[1].push(0),w.orig_data[2].push(C)}else w=a.model.traffic_data[A];h=q(y["out-octets"]);e=q(y["in-octets"]);z=local_database?Math.floor(104857600*Math.random()+1):0;h+=z;z=
local_database?Math.floor(104857600*Math.random()+1):0;e+=z;r=[];n=[];E=[];s=[];m=[];if(0<=B){l=w.orig_data[0][B];k=w.orig_data[1][B];D=w.orig_data[2][B];v=w.chart_data[0][B];p=w.chart_data[1][B];da=(C-D)/1E3;u=Math.floor(!_.isNumber(8*(e-l)/da)?0:Math.floor(8*(e-l)/da/1048576));t=Math.floor(8*(!_.isNumber(h-k)?0:Math.floor((h-k)/1048576))/da);"WAN1"===A&&(Log(DEBUG,"================="+A),Log(DEBUG,"tf_last_idx:"+B),Log(DEBUG,a.model.traffic_data.WAN1),Log(DEBUG,"last_i_val: "+l+", last_o_val: "+
k),Log(DEBUG,"i_val: "+e+", o_val: "+h),Log(DEBUG,"i_change: "+u+", o_change: "+t),Log(DEBUG,"last_i_change: "+v+", last_o_change: "+p));switch(c){case 30:z=Math.floor((t-p)/2);n.push(Z(p+z));m.push(Math.floor((k+h)/2));z=Math.floor((u-v)/2);r.push(v+z);E.push(0);s.push(Math.floor((l+e)/2));break;case 60:z=Math.floor((t-p)/4),n.push(Z(p+z)),n.push(Z(p+2*z)),n.push(Z(p+3*z)),Log(DEBUG,"o_offset: "+z),m.push(Math.floor(1*(k+h)/4)),m.push(Math.floor(2*(k+h)/4)),m.push(Math.floor(3*(k+h)/4)),Log(DEBUG,
"orig_o_offset: "+z),z=Math.floor((u-v)/4),r.push(Z(v+z)),r.push(Z(v+2*z)),r.push(Z(v+3*z)),Log(DEBUG,"i_offset: "+z),s.push(Math.floor(1*(l+e)/4)),s.push(Math.floor(2*(l+e)/4)),s.push(Math.floor(3*(l+e)/4)),Log(DEBUG,"orig_i_offset: "+z),E=E.concat([0,0,0])}n.push(Z(t));r.push(Z(u))}else n.push(0),r.push(0);E.push(C);m.push(h);s.push(e);"WAN1"===A&&(Log(DEBUG,"o_d: "+JSON.stringify(n)),Log(DEBUG,"i_d: "+JSON.stringify(r)),Log(DEBUG,"o_orig: "+JSON.stringify(m)),Log(DEBUG,"i_orig: "+JSON.stringify(s)));
w.chart_data[0]=w.chart_data[0].concat(r);w.chart_data[1]=w.chart_data[1].concat(n);w.orig_data[0]=w.orig_data[0].concat(s);w.orig_data[1]=w.orig_data[1].concat(m);w.orig_data[2]=w.orig_data[2].concat(E)}});switch(c){case 30:a.model.tf_last_idx+=2;break;case 60:a.model.tf_last_idx+=4;break;default:a.model.tf_last_idx+=1}a.model.interfaces.sort(function(a,b){var c=a.id.match(/^(WAN|USB)(\d+)$/),d=b.id.match(/^(WAN|USB)(\d+)$/);return!c||!d?0:"USB"===c[1]&&"WAN"===d[1]?1:"WAN"===c[1]&&"USB"===d[1]?
-1:q(c[2])-q(d[2])});a.ui_data.def_interface||(a.ui_data.def_interface=a.model.interfaces[0]&&a.model.interfaces[0].id||"")},k=function(){return b.post({method:"get_time",url:resource_base+"data/time.json",error:function(){}})},d=function(){var b,c,d,g=a.model.tf_last_datetime;b=a.model.tf_last_idx;if(void 0!==b&&!(120>b+4)){Log(DEBUG,"del_len: 4, _tf_last_idx: "+b);a.model.traffic_labels.splice(0,4);a.model.tf_last_idx=b-4;angular.forEach(a.model.traffic_data,function(a){a.orig_data[0].splice(0,
4);a.orig_data[1].splice(0,4);a.orig_data[2].splice(0,4);a.chart_data[0].splice(0,4);a.chart_data[1].splice(0,4)});d=120-a.model.traffic_labels.length;c=g.getTime()+15E3;g=new Date(c);for(b=0;b<d;b++)c=g.getTime()+15E3*b,c=new Date(c),0===b%4?a.model.traffic_labels.push(p(c.getHours())+":"+p(c.getMinutes())):a.model.traffic_labels.push("");a.model.tf_last_datetime=c}},c=function(a){return b.post({url:resource_base+"data/avc_state_applications.json",method:"get_avc_state",procBackground:a,isPolling:a,
error:function(){}})},h=function(b){b=b&&b["avc-state"]&&b["avc-state"]||{};var c=b.applications||[],d,g,h,k,r=0,m,s,v,p,z,y,A,B;a.model.applications=[];a.model.application_reset_time_str=u.genTimeStrByTimeStamp(b["last-reset-time"],"N/A");angular.forEach(c,function(b){d={application:b.application||"-",protocol:b.protocol||"-",port:b.port||"N/A",flows:b.flows||"-",clients:[],in_pkts:0,out_pkts:0,in_pkt_str:"",out_pkt_str:"",usage_pkts:0,usage_str:0,usage_per:0,usage_per_num:0,usage_per_str:0,client_cnt:0};
v=s=0;A=b.clients||[];angular.forEach(A,function(a){B={edit:!0,mac:a.mac||"",in_pkts:q(e(a["in-pkts"],"0")),out_pkts:q(e(a["out-pkts"],"0")),in_pkt_str:"",out_pkt_str:"",usage_pkts:0,usage_str:"",usage_per:0,usage_per_num:0,usage_per_str:"",ip_address:"-",hostname:"-",device_type:"-",os_type:"-",status:"-",ip_group:"@none",orig_ip_group:"@none",ip_groups:[]};B.in_pkt_str=n(B.in_pkts);B.out_pkt_str=n(B.out_pkts);B.usage_pkts=B.in_pkts+B.out_pkts;B.usage_str=n(B.usage_pkts);s+=B.in_pkts;v+=B.out_pkts;
d.clients.push(B)});d.in_pkts=s;d.in_pkt_str=n(d.in_pkts);d.out_pkts=v;d.out_pkt_str=n(d.out_pkts);d.usage_pkts=d.in_pkts+d.out_pkts;d.usage_str=n(d.usage_pkts);d.client_cnt=d.clients.length;y=z=p=0;m=d.usage_pkts;angular.forEach(d.clients,function(a){0===m?(a.usage_per_num=0,a.usage_per=0,a.usage_per_str="0%"):(a.usage_per_num=l(a.usage_pkts,m,1),a.usage_per=Math.floor(a.usage_per_num),p+=a.usage_per,y+=1,0===a.usage_per&&0!==a.usage_pkts?(z+=1,a.usage_per_str="<1%"):a.usage_per_str=a.usage_per+
"%")});d.clients.sort(function(a,b){return b.usage_per-a.usage_per});if(100!==p&&0!==m)if(1===z&&2===y)angular.forEach(d.clients,function(a){0!==a.usage_pkts&&0!==a.usage_per&&(a.usage_per_str=">99%")});else{k=d.clients;g=100-p;0<z&&(g-=1);for(h=0;h<k.length&&g;h++)0<g&&k[h].usage_pkts&&(k[h].usage_per+=1,k[h].usage_per_str=k[h].usage_per+"%",g-=1)}r+=d.usage_pkts;a.model.applications.push(d)});y=z=p=0;angular.forEach(a.model.applications,function(a){0===r?(a.usage_per_num=0,a.usage_per=0,a.usage_per_str=
"0%"):(a.usage_per_num=l(a.usage_pkts,r,1),a.usage_per=Math.floor(a.usage_per_num),y+=1,p+=a.usage_per,0===a.usage_per&&0!==a.usage_pkts?(z+=1,a.usage_per_str="<1%"):a.usage_per_str=a.usage_per+"%")});if(100!==p&&0!==r)if(1===z&&2===y)angular.forEach(a.model.applications,function(a){0!==a.usage_pkts&&0!==a.usage_per&&(a.usage_per_str=">99%")});else{a.model.applications.sort(function(a,b){return b.usage_per-a.usage_per});k=a.model.applications;g=100-p;0<z&&(g-=1);for(h=0;h<k.length&&g;h++)0<g&&k[h].usage_pkts&&
(k[h].usage_per+=1,k[h].usage_per_str=k[h].usage_per+"%",g-=1)}a.model.applications.sort(function(a,b){return a.application<b.application?-1:1})};procClient=function(b){b=(b&&b["avc-state"]&&b["avc-state"]||{}).clients||[];var c;a.model.client_map={};angular.forEach(b,function(b){c={mac:b.mac||"",ipv4_address:b["ipv4-address"]||"",ipv6_address:b["ipv6-address"]||"",hostname:b.hostname||"",device_type:b["device-type"]||"",os_type:b["os-type"]||"",status:b.status||"",ip_group:b["ip-group"]||"@none",
orig_ip_group:""};c.orig_ip_group=c.ip_group;a.model.client_map[c.mac]=c})};var g=function(){var b;angular.forEach(a.model.applications,function(c){angular.forEach(c.clients,function(c){if(b=a.model.client_map[c.mac])c.ip_address=b.ipv4_address||b.ipv6_address||"-",c.hostname=b.hostname,c.device_type=b.device_type,c.os_type=b.os_type,c.status=b.status,c.ip_group=b.ip_group,c.orig_ip_group=b.orig_ip_group})})},A=function(){return b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup",
error:function(a){Log(ERROR,"appControllerCtrl getIpGroupData error : "+a.status);y()}})},y=function(b){var c=[],d;b&&(b["ip-groups"]&&b["ip-groups"]["ip-group"])&&(c=b["ip-groups"]["ip-group"]);a.model.ip_groups=[];a.model.mac2ipgroup={};a.model.ip_groups.push({id:"@none",displayName:a.DICT("Application_Statistics_None")});angular.forEach(c,function(b){d={id:b.name||"",displayName:b.name||"",macs:b.macs||[]};angular.forEach(d.macs,function(c){a.model.mac2ipgroup[c.mac]=b.name});a.model.ip_groups.push(d)})},
z=function(){D();w.all([k(),v(!1),c(!1),A()]).then(function(b){E();var c=x(b,0),d,k,l;c&&(c["system-state"]&&c["system-state"].clock&&c["system-state"].clock["current-datetime"])&&(d=c["system-state"].clock["current-datetime"],c=u.parser(d),0===c.err_code&&(k=u.timeStr(c),d=c.date));d||(c=u.new_date(),k=u.timeStr(c),d=c.date);a.model.tf_datetime=d;a.model.tf_datetime_str=k;for(k=0;120>k;k++)l=d.getTime()+15E3*k,l=new Date(l),0===k%4?a.model.traffic_labels[k]=p(l.getHours())+":"+p(l.getMinutes()):
a.model.traffic_labels.push("");a.model.tf_last_datetime=l;s(x(b,1),a.ui_data.update_timer);h(x(b,2));procClient(x(b,2));y(x(b,3));(b=x(b,2))||(b={});b=e(b.status,0);a.ui_data.no_license=0===b;g();a.ui_data.no_license?a.model.application_reset_time_str="N/A":(B(),a.gridApplicationOptions.data=a.model.applications);a.ui_data.sel_interface=a.ui_data.def_interface;a.ui_data.data_ready=!0;a.resetModified()},function(a){Log(ERROR,"[app_statistics_main] init() "+JSON.stringify(a));z()})},B=function(){var b=
a.ui_data.update_timer;void 0===a.ui_data.polling_timeId&&(a.ui_data.polling_timeId=setTimeout(function(){w.all([v(!0)]).then(function(c){a.ui_data.polling_timeId=void 0;s(x(c,0),b);r||B()},function(a){Log(ERROR,"[app_statistics_main] startPolling() "+JSON.stringify(a));B()})},1E3*a.ui_data.update_timer))},D=function(){void 0!==a.ui_data.polling_timeId&&(clearTimeout(a.ui_data.polling_timeId),a.ui_data.polling_timeId=void 0)};a.ui_data={no_license:!0,data_ready:!1,update_timer:15,def_interface:"",
sel_interface:"",polling_timeId:void 0,page:"main",combineNote:a.DICT("Application_Statistics_Note",{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Here")+"</u></a>"})};a.schema={update_timers:[{id:15,displayName:a.DICT("Application_Statistics_15s")},{id:30,displayName:a.DICT("Application_Statistics_30s")},{id:60,displayName:a.DICT("Application_Statistics_60s")}]};var E=function(){var b="N/A";a.model.application_reset_time_str&&(b=a.model.application_reset_time_str);a.model=
{interfaces:[],tf_datetime:"",tf_datetime_str:"",tf_last_datetime:void 0,tf_last_idx:-1,traffic_data:{},traffic_series:["Download","Upload"],traffic_labels:[],traffic_override:[{hidden:!1,id:"Download",label:"Download",pointHoverRadius:1,pointRadius:1},{hidden:!1,id:"Upload",label:"Upload",pointHoverRadius:1,pointRadius:1}],traffic_options:{animation:!1,maintainAspectRatio:!1,borderColor:["rgba(255, 0, 0, 1)","rgba(0, 255, 0, 1)","rgba(0, 0, 255, 1)","rgba(255, 255, 0, 1)"],scales:{yAxes:[{min:0,
maxTicksLimit:1E3,gridLines:{display:!0},ticks:{callback:function(a,b,c){return Math.floor(a)+" Mbps"},beginAtZero:!0,suggestedMin:0,suggestedMax:100}}],xAxes:[{gridLines:{display:!0}}]}},ip_groups:[],mac2ipgroup:{},applications:[],client_map:{},client_app_name:"",clients:[],application_reset_time_str:b}};a.model={};a.change_interface=function(){};var C=function(){angular.forEach(a.model.clients,function(b){b.ip_group||(b.ip_group="@none");b.ip_groups=a.model.ip_groups})};t=function(a){return function(b,
c,d,g,h){return d.entity[a]===g.entity[a]?0:d.entity[a]>g.entity[a]?1:-1}};a.gridApplicationOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"application",displayName:a.DICT("Application_Statistics_Application"),click:function(b,c,d,g){a.model.clients=c.entity.clients||[];a.model.client_app_name=b;C();a.gridClientOptions.data=a.model.clients;a.ui_data.page="sub"},cellTemplate:"UG_table_text_with_inline_href_click.html"},{field:"protocol",displayName:a.DICT("Application_Statistics_Protocol")},
{field:"port",displayName:a.DICT("Application_Statistics_Port"),sortingAlgorithm:t("port")},{field:"usage_per_str",displayName:a.DICT("Application_Statistics_Usage_Percentage"),sortingAlgorithm:t("usage_pkts")},{field:"usage_str",displayName:a.DICT("Application_Statistics_Usage"),sortingAlgorithm:t("usage_pkts")},{field:"out_pkt_str",displayName:a.DICT("Application_Statistics_Sent"),sortingAlgorithm:t("out_pkts")},{field:"in_pkt_str",displayName:a.DICT("Application_Statistics_Received"),sortingAlgorithm:t("in_pkts")},
{field:"client_cnt",displayName:a.DICT("Application_Statistics_Client_Counter")}]});a.gridClientOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"ip_address",displayName:a.DICT("Application_Statistics_IP_Address")},{field:"hostname",displayName:a.DICT("Application_Statistics_Hostname")},{field:"device_type",displayName:a.DICT("Application_Statistics_Device_Type")},{field:"os_type",displayName:a.DICT("Application_Statistics_OS_Type")},{field:"usage_per_str",displayName:a.DICT("Application_Statistics_Usage_Percentage"),
sortingAlgorithm:t("usage_pkts")},{field:"ip_group",displayName:a.DICT("Application_Statistics_IP_Group"),editRow:"edit",listField:"ip_groups",cellTemplate:"UG_table_select1_with_inline_edit.html"}]});a.funs={back:function(){a.ui_data.page="main"},cancel:function(){a.ui_data.data_ready=!1;a.ui_data.page="main";z()},save:function(){var c={},d=[],g,h;angular.forEach(a.model.clients,function(b){if(b.ip_group!==b.orig_ip_group){"@none"!==b.ip_group&&!c[b.ip_group]&&angular.forEach(a.model.ip_groups,function(a){a.id===
b.ip_group&&(c[b.ip_group]={name:a.id,macs:a.macs})});"@none"!==b.orig_ip_group&&!c[b.orig_ip_group]&&angular.forEach(a.model.ip_groups,function(a){a.id===b.orig_ip_group&&(c[b.orig_ip_group]={name:a.id,macs:a.macs})});if("@none"!==b.orig_ip_group){h=c[b.orig_ip_group].macs;for(g=h.length-1;0<=g;g--)h[g].mac===b.mac&&h.splice(g,1)}"@none"!==b.ip_group&&c[b.ip_group].macs.push({mac:b.mac})}});angular.forEach(c,function(a){d.push(a)});d.length?b.post({forcedUsingPost:!0,method:"set_ipgroup",params:{"ip-groups":{"ip-group":d}},
success:function(){a.ui_data.data_ready=!1;a.ui_data.page="main";z()},error:function(){a.ui_data.data_ready=!1;a.ui_data.page="main";z()}}):(a.ui_data.data_ready=!1,a.ui_data.page="main",z())},reset_state:function(){app.TOOLS.warningAlertBox({msg:a.DICT("Application_Statistics_Reset_Note"),cbk:function(a){a&&b.post({method:"action",params:{rpc:"reset-avc-state"},success:function(){z()},error:function(){z()}})}})},refresh:function(){w.all([c()]).then(function(b){h(x(b,0));procClient(x(b,0));g();a.gridApplicationOptions.data=
a.model.applications})}};a.$on("$destroy",function(){D();r=!0});z()}]);app.controller("stat_mobile_network_main",["$scope","MyHttp","$q","userAccessRight","UserSession",function(a,b,t,m,w){a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var u=function(a){return"number"!==$.type(a)?"":10>a?"0"+a:a.toString()},p=function(){return b.post({method:"get_mobile_state",url:resource_base+"data/wan_setting_state.json",error:function(a){q();console.log("getMobileStatus Error status: "+a.status)}})},q=function(b){b||(b={});var e=function(a){var b;
b=parseFloat(a);if(isNaN(b))return"";b=Math.round(100*a)/100;a=b.toString();b=a.indexOf(".");0>b&&(b=a.length,a+=".");for(;a.length<=b+2;)a+="0";return a},n=function(a){return"number"!==$.type(a)?"":1>=a?a+" Byte":1024>a?a+" Bytes":1048576>a?e(a/1024)+" KB":1073741824>a?e(a/1048576)+" MB":e(a/1073741824)+" GB"};b=b["interfaces-state"]&&b["interfaces-state"]["interface"]||[];var m={},k,d,c,h,g,p,q,z,B,t,x;a.model.usbs=[];a.model.usb_list=[];angular.forEach(b,function(b){b.name&&b.name.match(/^USB\d+$/)&&
(k=b.ipv4||{},c=k.address&&k.address[0]||{},d=b["mobile-connection"]||{},q=h="-",c&&(c.netmask?h=c.netmask:c["prefix-length"]&&(h=app.TOOLS.netmask.int2Inet(parseInt(c["prefix-length"],10)))),void 0!==d["connection-time"]&&(p=d["connection-time"],q=u(p%60),p=(p-p%60)/60,q=u(p%60)+":"+q,p=(p-p%60)/60,q=u(p%24)+":"+q,p-=p%24,0<p&&(q=p/24+" days, "+q)),t=0,d["session-usage-tx-bytes"]?(g=parseInt(d["session-usage-tx-bytes"],10)||0,t+=g,z="Tx="+n(g)+", "):z="Tx=0 bytes, ",d["session-usage-rx-bytes"]?(g=
parseInt(d["session-usage-rx-bytes"],10)||0,t+=g,z=z+"Rx="+n(g)):z+="Rx=0 byte",x=0,d["monthly-usage-tx-bytes"]?(g=parseInt(d["monthly-usage-tx-bytes"],10)||0,x+=g,B="Tx="+n(g)+", "):B="Tx: 0 bytes, ",d["monthly-usage-rx-bytes"]?(g=parseInt(d["monthly-usage-rx-bytes"],10)||0,x+=g,B=B+"Rx="+n(g)):B+="Rx=0 byte",z=a.DICT("Mobile_Network_Usage_Str",{"%s0":n(t),"%s1":z}),B=a.DICT("Mobile_Network_Usage_Str",{"%s0":n(x),"%s1":B}),m={name:b.name,v4_ip:c.ip||"-",v4_netmask:h,has_ipv4:c.ip?!0:!1,gateway:k.gateway||
"-",device_name:d["device-name"]||"",connection_time:q,service_name:d.service_name||"-",session_usage:z,monthly_usage:B,service_type:"-",manufacture:"-",firmware_version:"-",sim_status:"-",imsi:"-",carrier:"-",signal_strength:0,card_status:!1},a.model.usb_list.push({name:m.name,id:a.model.usbs.length}),a.model.usbs.push(m))})},e=function(){return b.post({url:resource_base+"data/usb_modem_state.json",method:"get_usb_modem_state",error:function(a){console.log("getUsbModemsStatus error "+a.status)}})},
x=function(b){b||(b={});var e,n;angular.forEach(b["usb-modems-state"]&&b["usb-modems-state"]["usb-modem"]||[],function(b,k){angular.forEach(a.model.usbs,function(a){switch(b["device-name"]){case "/dev/modem1":n="USB1";break;case "/dev/modem2":n="USB2";break;default:return}a.name===n&&(e="",angular.forEach(b["network-mode"],function(a){Log(DEBUG,""===e);e=e?e+", "+a:a}),b["network-mode"]&&2<b["network-mode"].length&&(e="[ "+e+" ]"),angular.extend(a,{service_type:e||"-",manufacture:b.manufacture||"-",
firmware_version:b["firmware-version"]||"-",sim_status:b["sim-status"]||"-",imsi:b.imsi||"-",carrier:b.carrier||"-",signal_strength:b["signal-strength"]||0,card_status:a.has_ipv4?!0:!1}))})})},n=function(b){var n=-1;t.all([p(),e()]).then(function(e){q(e&&e[0]&&e[0].data&&e[0].data.result||{});x(e&&e[1]&&e[1].data&&e[1].data.result||{});a.model.usb_list.length&&(angular.forEach(a.model.usbs,function(a,b){-1===n&&"-"!==a.service_type&&(n=b)}),b||(a.model.sel=-1!==n?n:0),a.change_usb());a.dataReady=
!0})};a.model={usbs:[],usb_list:[],sel:0};a.d={};a.funs={clear:function(){b.post({method:"action",params:{rpc:"reset-mobile-statistics",input:{"interface-name":a.d.name}},success:function(a){n()},error:function(a){n()}})},update:function(){n(!0)}};a.change_usb=function(){a.d=a.model.usbs[a.model.sel]};a.dataReady=!1;n()}]);app.controller("view_logs_main",["$scope","$q","$uibModal","MyHttp","$filter","usb_lib","modelInfo","userAccessRight","UserSession","dt",function(a,b,t,m,w,u,p,q,e,x){var n=app.TOOLS.getResponse;a.ctx={facility_cnt:0,severity_cnt:0,all_facility:!1,all_severity:!1,facility:{kern:!1,system:!1,firewall:!1,network:!1,vpn:!1,"ssl-vpn":!1,license:!1,"web-filter":!1,"application-control":!1,user:!1,mobile:!1,wireless:!1,pnp:!1,"anti-virus":!1,ips:!1},severity:{emergency:!1,alert:!1,critical:!1,error:!1,
warning:!1,notice:!1,info:!1,debug:!1},keyword:""};a.model={totalPages:0,totalItems:0,currPage:1,logs:[],downloaded_page:[]};a.pagingOptions={pages:[50,100,150],pageSize:50,total:0,changePageIdxCbk:{pre:void 0,post:function(b,d){a.model.currPage=b;a.grid_seak(d)}},changePageSizeCbk:function(b,h){a.pagingOptions.pageSize=b;a.init_query_logs();a.pagingOptions.goTo(1);a.gridApi.grid.options.paginationPageSize=a.pagingOptions.pageSize;d()}};a.jumpToPage=app.TOOLS.jumpToPage;a.query_once=!1;a.usbs_avaiable=
void 0;a.rv340w_flag=!1;a.grayout=!1;a.userAccessFlag=q.get();a.ruFlag=q.russia();a.dataReady=!1;a.warning_msg=a.DICT("View_Logs_Msg1",{"%s":"<a ng-click=\"jumpToPage('System_Config_Log')\">"+a.DICT("View_Logs_Here")+"</a>"});a.note_msg=a.DICT("View_Logs_Configure_Log_Settings",{"%s":"<a ng-click=\"jumpToPage('System_Config_Log')\">"+a.DICT("View_Logs_Here")+"</a>"});"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();0<=p.get_pid().search("RV340W")&&(a.rv340w_flag=!0);var l=function(b){b||
(b={});var d=b["syslog-view-stat"]||{};b=d["logging-sevirity"]||[];d=d["logging-facilities"]||[];angular.forEach(a.ctx.facility,function(b,c){a.ctx.facility[c]=!1});angular.forEach(a.ctx.severity,function(b,c){a.ctx.severity[c]=!1});angular.forEach(b,function(b){void 0!==a.ctx.severity[b.severity]?a.ctx.severity[b.severity]=!0:Log(ERROR,"[View Logs] procViewLogs() severity got error, no exist severity "+b.severity)});angular.forEach(d,function(b){void 0!==a.ctx.facility[b.facility]?a.ctx.facility[b.facility]=
!0:Log(ERROR,"[View Logs] procViewLogs() facility got error, no exist facility "+b.facility)})},r=function(){var c=m.post({url:resource_base+"data/view_logs.json",method:"get_view_logs",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),d=m.post({url:resource_base+"data/log.json",method:"get_log",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,d]).then(function(b){l(n(b,0));b=n(b,1);a.grayout=!1;b&&(b.syslog&&b.syslog["global-logging-action"])&&
null===b.syslog["global-logging-action"].none&&(a.grayout=!0);a.checkSeverityAllStatus();a.checkFacilityAllStatus();a.dataReady=!0})};a.checkSeverityAllStatus=function(){var b=!0;a.ctx.severity_cnt=0;angular.forEach(a.ctx.severity,function(d){d?a.ctx.severity_cnt+=1:b=!1});a.ctx.all_severity=b};a.checkFacilityAllStatus=function(){var b=!0;a.ctx.facility_cnt=0;angular.forEach(a.ctx.facility,function(d){d?a.ctx.facility_cnt+=1:b=!1});a.ctx.all_facility=b};a.gridviewOptions=app.uiGrid.generateGridOptions({enablePaginationControls:!1,
paginationPageSize:a.pagingOptions.pageSize,rowHeight:2*app.uiGrid.rowHeight,enablePagination:!0,columnDefs:[{field:"timestamp",displayName:a.DICT("View_Logs_Log_Time"),width:220},{field:"severity",displayName:a.DICT("View_Logs_Log_Severity"),width:130},{field:"facility",displayName:a.DICT("View_Logs_Category_N"),width:110},{field:"message",displayName:a.DICT("View_Logs_Description"),cellClass:"grid-white-space-normal",cellTooltip:function(a){return a.entity.message}}],onRegisterApi:function(b){a.pagingOptions.gridApi=
b;a.gridApi=b}});a.gridApi;var v=function(){var b=[];angular.forEach(a.ctx.severity,function(a,d){a&&b.push({severity:d})});return b},s=function(){var b=[];angular.forEach(a.ctx.facility,function(a,d){a&&b.push({facility:d})});return b};a.save=function(b,d){var g={"syslog-view-stat":{"logging-facilities":s(),"logging-sevirity":v()}},e={"logging-facilities":s(),"logging-sevirity":v(),"page-size":a.pagingOptions.pageSize};a.ctx.keyword&&angular.extend(e,{keyword:a.ctx.keyword});e=function(){m.post({url:resource_base+
"data/log.json",method:"set_view_logs",params:g,success:function(b){r();a.init_query_logs()},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})};"RO"===a.userAccessFlag?a.init_query_logs():e()};var k=function(a){if(a&&a.rpc){var b={rpc:a.rpc};a.input&&(b.input=a.input);m.post({method:"action",background:a.background||!1,popRPCResonsepAlert:a.popRPCResonsepAlert,params:b,success:function(b){"function"===$.type(a.success)&&a.success(b)},error:function(b){"function"===
$.type(a.error)&&a.error(b)}})}},d=function(){_.isFunction(a.pagingOptions.updateOpts)&&a.pagingOptions.updateOpts()};a.query_logs_by_current_page=function(b){if(a.model.totalPages){var d=a.model.currPage,g=a.pagingOptions.pageSize,e=function(){b&&"function"===$.type(b.cbk)&&b.cbk()};if(a.model.downloaded_page[d])Log(DEBUG,"logs is exist, do nothing"),e();else{var l=function(b){if(b&&b.data&&b.data.result){b=b.data.result;b=b.output&&b.output.log||[];var c=(d-1)*g,k=d*g,l=b.length,n;a.model.downloaded_page[d]=
!0;for(n=0;n<l;n++)b[n].timestamp=x.genTimeStrByTimeStamp(b[n].timestamp,"N/A"),a.model.logs[c]=angular.copy(b[n]),c+=1;d===a.model.totalPages&&a.model.logs.splice(c,k-c);e()}};k({rpc:"query-syslog-current-page",input:{"page-size":g,"page-index":d},success:l,error:l})}}};a.init_query_logs=function(){var b=a.pagingOptions.pageSize,h={"logging-facilities":s(),"logging-sevirity":v(),"page-size":b};a.ctx.keyword&&angular.extend(h,{keyword:a.ctx.keyword});a.query_once=!0;var g=function(g){if(g&&g.data&&
g.data.result){var h=g.data.result,e=0;g=0;h.output&&h.output.total&&(e=parseInt(h.output.total,10),isNaN(e)&&(e=0));2E3<e&&(e=2E3);a.model.totalItems=e;a.pagingOptions.total=e;g=(e-e%b)/b+(e%b?1:0);a.model.totalPages=g;a.model.logs=[];a.model.downloaded_page=[];if(0!==g){a.model.downloaded_page.push(!0);a.model.currPage=1;e=g*b;for(h=2;h<=g;h++)a.model.downloaded_page.push(!1);for(h=0;h<e;h++)a.model.logs.push({});a.query_logs_by_current_page({cbk:function(){_.isFunction(a.pagingOptions.goTo)?a.pagingOptions.goTo(a.model.currPage):
(a.gridApi.pagination.seek(a.model.currPage),a.gridApi.grid.refresh())}})}a.gridviewOptions.data=a.model.logs;d()}};k({popRPCResonsepAlert:!0,rpc:"query-syslog",input:h,success:g,error:g})};a.cancel=function(){};a.allFacility=function(){var b=a.ctx.all_facility,d=0;angular.forEach(a.ctx.facility,function(g,e){(a.ctx.facility[e]=b)&&(d+=1)});a.ctx.facility_cnt=d};a.allSeverity=function(){var b=a.ctx.all_severity,d=0;angular.forEach(a.ctx.severity,function(g,e){(a.ctx.severity[e]=b)&&(d+=1)});a.ctx.severity_cnt=
d};a.refresh=function(){a.init_query_logs();a.grid_seak()};a.clear=function(){var b=function(){a.model.logs=[];a.gridviewOptions.data=a.model.logs;a.query_once=!1};k({popRPCResonsepAlert:!0,rpc:"file-delete",input:{fileType:"log",source:{"location-url":"FILE://Log/syslog.log"}},success:b,error:b})};a.to_pc=function(){var a=function(a){var b=a&&a.data&&a.data.result||{},b=b.output&&b.output["download-url"]||"";if(b.length){var c=b.split("/");a=app.TOOLS.download_save_to(b,c[c.length-1],"text/plain");
var d=0,e=function(){4===a.readyState&&200===a.status?app.TOOLS.successAlertBox({msg:"Download Success",cbk:function(a){}}):3<=d?app.TOOLS.criticalAlertBox({msg:"Download Fail",cbk:function(a){}}):(d++,setTimeout(e,2E3))};e()}else app.TOOLS.criticalAlertBox({msg:"Download Fail",cbk:function(a){}})};k({popRPCResonsepAlert:!1,rpc:"file-download",input:{fileType:"log"},success:a,error:a})};a.to_usb=function(){var c=function(){t.open({animation:a.animationsEnabled,templateUrl:"export_log_to_usb.html",
controller:"usb_ctrl",size:"sm",resolve:{usbs_avaiable:function(){return a.usbs_avaiable},usb_name:function(){return""}}}).result.then(function(a){var b=function(a){return 10>parseInt(a,10)?"0"+a:a.toString()},c=new Date,b=c.getYear()+1900+b(c.getMonth()+1)+b(c.getDate())+"T"+b(c.getHours())+b(c.getMinutes())+b(c.getSeconds());k({popRPCResonsepAlert:!0,rpc:"file-copy",input:{fileType:"log",source:{"location-url":"FILE://Log/syslog.log"},destination:{"location-url":"FILE://"+a+"/rv340_syslog_"+b+".log"}},
success:function(a){Log(DEBUG,"success "+JSON.stringify(a))},error:function(a){Log(DEBUG,"error "+JSON.stringify(a))}})},function(){Log(DEBUG,"do nothing")})};b.all([u.usbs_avaiable()]).then(function(b){a.usbs_avaiable=b[0];c()})};a.grid_seak=function(b){void 0===a.model.currPage||1>a.model.currPage||a.model.currPage>a.model.totalPages?Log(DEBUG,"grid_seak do nothing "+a.model.currPage+" "+a.model.totalPages):(_.isFunction(b)||(b=function(){_.isFunction(a.pagingOptions.goTo)?a.pagingOptions.goTo(a.model.currPage):
(a.gridApi.pagination.seek(a.model.currPage),a.gridApi.grid.refresh())}),a.query_logs_by_current_page({cbk:b}))};a.schema={severity:[{id:"emergency",displayName:a.DICT("View_Logs_Emergency")},{id:"alert",displayName:a.DICT("View_Logs_Alert")},{id:"critical",displayName:a.DICT("View_Logs_Critical")},{id:"error",displayName:a.DICT("View_Logs_Error")},{id:"warning",displayName:a.DICT("View_Logs_Warning")},{id:"notice",displayName:a.DICT("View_Logs_Notification")},{id:"info",displayName:a.DICT("View_Logs_Information")},
{id:"debug",displayName:a.DICT("View_Logs_Debugging")}]};r()}]);app.controller("usb_ctrl",["$scope","$uibModalInstance","usbs_avaiable","usb_name",function(a,b,t,m){a.usbs_avaiable=t;a.usb_name=m||"";m||(t.USB1?a.usb_name="USB1":t.USB2&&(a.usb_name="USB2"));a.save=function(){b.close(a.usb_name)};a.cancel=function(){b.dismiss()}}]);app.controller("vpn_status_main",["$scope","$rootScope","$q","$location","$filter","MyHttp","oneTimeLocker","$templateCache","Sets","userAccessRight","UserSession","$cookies",function(a,b,t,m,w,u,p,q,e,x,n,l){a.model=a.model||{};a.ip_groups={};a.userAccessFlag=x.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var r=function(a,b){return u.post({url:resource_base+"data/"+b,method:a,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},v=function(b,
c,d){var g,h;switch(b){case "vpn_status":g="get_vpn_state";h="vpn_status.json";a.model["pptp-state"]=void 0;a.model["l2tp-state"]=void 0;a.model["site-to-site-state"]=void 0;a.model["client-to-site-state"]=void 0;a.model["sslvpn-state"]=void 0;break;case "ipsec_s2s_state":g="get_site_to_site_state";h="ipsec_site_to_site_state.json";break;case "pptp_server":g="get_pptp_server";h="pptp_server.json";break;case "l2tp_server":g="get_l2tp_server";h="l2tp_server.json";break;case "ipsec_s2s":g="get_site_to_site";
h="ipsec_site_to_site.json";break;case "ipsec_c2s":g="get_client_to_site";h="ipsec_client_to_site.json";break;case "ipsec_profiles":g="get_ipsec_profile";h="ipsec_profiles.json";break;case "sslvpn":g="get_sslvpn";h="sslvpn.json";break;case "teleworker_vpn_state":g="get_teleworker_vpn_state";h="teleworker_vpn_state.json";break;case "teleworker_vpn":g="get_teleworker_vpn";h="telework_vpn_clients.json";break;case "ip_group":g="get_ipgroup";h="ip_group.json";break;default:console.log("prepareModelOf: unknown name: "+
b)}b=r(g,h);if(c||d)b.then(function(b){d&&d(b);angular.extend(a.model,b.data.result);k();a.gridC2SConn.viewConn=!1;a.gridSSLConn.viewConn=!1;c&&c(b)});else return b},s={number:!0,name:!0,enable:!0,status:!0,auth:!0,"local-group":!0,"remote-group":!0,"remote-gateway":!0,"wan-interface":!1,"ike-sa-time":!1,"ipsec-sa-time":!1,"tx-bytes":!1,"rx-bytes":!1,"tx-packets":!1,"rx-packets":!1,action:!0};a.visible_s2s_col=s;if(b=l.getObject("vpn_status"))angular.forEach(s,function(a,b){s[b]=!1}),angular.forEach(b,
function(a,b){void 0!==s[b]&&(s[b]=a)});var k=function(){var b=function(a,b){angular.forEach(a,function(a,c){a.number=c+1;_.isUndefined(a.checked)&&(a.checked=!1);b&&angular.forEach(a.client,function(a,b){a.number=b+1})})};e.recover_object(a.model,{"site-to-site-state":{connections:{connection:[]}}});e.recover_object(a.model,{"client-to-site-state":{connection:[]}});e.recover_object(a.model,{"l2tp-state":{connections:{connection:[]}}});e.recover_object(a.model,{"pptp-state":{connections:{connection:[]}}});
e.recover_object(a.model,{"sslvpn-state":{"group-policies":{"group-policy":[]}}});b(a.model["site-to-site-state"].connections.connection);b(a.model["client-to-site-state"].connection,!0);b(a.model["l2tp-state"].connections.connection);b(a.model["pptp-state"].connections.connection);b(a.model["sslvpn-state"]["group-policies"]["group-policy"],!0);c();a.gridS2SConn.Options.data=a.model["site-to-site-state"].connections.connection;a.gridC2SConn.Options.data=a.model["client-to-site-state"].connection;
a.gridSSLConn.Options.data=a.model["sslvpn-state"]["group-policies"]["group-policy"];a.gridL2TPConn.Options.data=a.model["l2tp-state"].connections.connection;a.gridPPTPConn.Options.data=a.model["pptp-state"].connections.connection;a.gridS2SConn.Selections=[];a.gridC2SConn.Selections=[];a.gridSSLConn.Selections=[]},d=function(){a.ip_groups={};var b,c,d;angular.forEach(a.model["ip-groups"]&&a.model["ip-groups"]["ip-group"]||[],function(g){b=g.ips||[];c={name:g.name,id:g.name,list:[],tip:""};angular.forEach(b,
function(a){angular.forEach(a.ipv4,function(a,b){switch(b){case "single":c.list.push(a);c.tip=c.tip+"<div>"+a+"</div>";break;case "subnet":d=a.ip+"/"+app.TOOLS.netmask.inet2Int(a.netmask);c.list.push(d);c.tip=c.tip+"<div>"+d+"</div>";break;case "range":d=a.start+"-"+a.end,c.list.push(d),c.tip=c.tip+"<div>"+d+"</div>"}});angular.forEach(a.ipv6,function(a,b){switch(b){case "single":c.list.push(a);c.tip=c.tip+"<div>"+a+"</div>";break;case "subnet":d=a.ip+"/"+a["prefix-length"];c.list.push(d);c.tip=c.tip+
"<div>"+d+"</div>";break;case "range":d=a.start+"-"+a.end,c.list.push(d),c.tip=c.tip+"<div>"+d+"</div>"}})});c.list.length||(c.tip=a.DICT("VPN_Status_IP_Groups_No_IP_Address",{"%s":g.name}));a.ip_groups[g.name]=c})},c=function(){var b={},c,d;angular.forEach(a.model["site-to-sites"]["site-to-site"],function(a){b[a["connection-name"]]=a});angular.forEach(a.model["site-to-site-state"].connections.connection,function(g){c=b[g.name];g.local_group={info:g["local-group"],tip:""};g.remote_group={info:g["remote-group"],
tip:""};c&&(d="",c["local-group"].group["ip-group"]&&(d=c["local-group"].group["ip-group"][0]),a.ip_groups[d]&&(g.local_group.tip=a.ip_groups[d].tip),d="",c["remote-group"].group["ip-group"]&&(d=c["remote-group"].group["ip-group"][0]),a.ip_groups[d]&&(g.remote_group.tip=a.ip_groups[d].tip));if(!g.local_group.info||"any"===!g.local_group.info)g.local_group.info="0.0.0.0/0";if(!g.remote_group.info||"any"===!g.remote_group.info)g.remote_group.info="0.0.0.0/0"})};a.getConnNumOf=function(b){var c=function(a,
b,c){return"UP"===a.status.toUpperCase()?!0:!1},d;if(("pptp-state"==b||"l2tp-state"==b||"site-to-site-state"==b)&&a.model[b]&&a.model[b].connections&&a.model[b].connections.connection)return d=a.model[b].connections.connection,"site-to-site-state"==b?w("filter")(d,c).length:d.length;if("sslvpn-state"==b&&a.model[b]&&a.model[b]["group-policies"]&&a.model[b]["group-policies"]["group-policy"]){d=a.model[b]["group-policies"]["group-policy"];var g=0;angular.forEach(d,function(a,b){0<a.sessions&&(g+=a.sessions)});
return g}if("client-to-site-state"==b&&a.model[b]&&a.model[b].connection){d=a.model[b].connection;var h=0;angular.forEach(d,function(a,b){0<a.tunnels&&(h+=a.tunnels)});return h}return 0};a.getEnabledNumOf=function(b){var c=0,d=function(a,b,c){a=a.status.toUpperCase();return"UP"===a||"DOWN"===a?!0:!1};"site-to-site-state"==b&&a.model[b]?(b=a.model[b].connections.connection,c=w("filter")(b,d).length):"client-to-site-state"==b&&a.model[b]&&(b=a.model[b].connection,c=b.reduce(function(a,b,c){return a+
(b.enable?1:0)},0));return c};a.getDefinedNumOf=function(b){return!a.model[b]?0:a.model[b].connections.connection.length};a.RPC_generic=function(a,b,c){y.doSyncRPC({url:resource_base+"data/vpn_rpc_result.json",rpcname:a,input:b}).then(function(b){y.ret_code_dispatcher(b,c,a)})};a.RPC_S2S=function(b,c){a.RPC_generic(b,c,function(a,b){switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");v("vpn_status",function(a){Log(DEBUG,"update success")});break;default:console.log(b+": RPC done. got unknown code: "+
a)}})};a.RPC_C2S=function(b,c){a.RPC_generic(b,c,function(a,b){switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");v("vpn_status",function(a){Log(DEBUG,"update success")});break;default:console.log(b+": RPC done. got unknown code: "+a)}})};a.RPC_SSL=function(b,c){a.RPC_generic(b,c,function(a,b){switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");v("vpn_status",function(a){Log(DEBUG,"update success")});break;default:console.log(b+": RPC done. got unknown code: "+a)}})};
a.RPC_PPTP=function(b,c){a.RPC_generic(b,c,function(a,b){switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");v("vpn_status",function(a){Log(DEBUG,"update success")});break;default:console.log(b+": RPC done. got unknown code: "+a)}})};a.RPC_L2TP=function(b,c){a.RPC_generic(b,c,function(a,b){switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");v("vpn_status",function(a){Log(DEBUG,"update success")});break;default:console.log(b+": RPC done. got unknown code: "+a)}})};a.S2Smethod_row=
function(a,b){u.post({url:resource_base+"data/vpn_status.json",method:a,params:{"site-to-sites":{"site-to-site":[{"connection-name":b}]}},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(a){Log(DEBUG,"POST is done. checking result if success");v("vpn_status",function(a){Log(DEBUG,"update success")})})};a.C2Smethod_row=function(a,b){u.post({url:resource_base+"data/vpn_status.json",method:a,params:{"client-to-sites":{"client-to-site":[{seq:b}]}},
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(a){Log(DEBUG,"POST is done. checking result if success");v("vpn_status",function(a){Log(DEBUG,"update success")})})};a.SSLmethod_row=function(a,b){u.post({url:resource_base+"data/sslvpn.json",method:a,params:{sslvpn:{"group-policies":{"group-policy":{"policy-name":b}}}},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(a){Log(DEBUG,"POST is done. checking result if success");
v("vpn_status",function(a){Log(DEBUG,"update success")})})};a.pageJump=function(a){var b={S2S:"VPN_Site_to_Site",C2S:"VPN_Client_to_Site",SSL:"VPN_SSL"}[a];b||alert("unknown pageId:"+a);a=document.location;document.location.href=a.protocol+"//"+a.host+a.pathname+"#/"+b};var h=function(a,b){var c;"add"==a?c="":b&&(b[0]&&b[0].name)&&(c=b[0].name);if(void 0!=c)return{action:a,key:c}},g=function(a,b){var c;"add"==a?c="":b&&(b[0]&&b[0]["group-name"])&&(c=b[0]["group-name"]);if(void 0!=c)return{action:a,
key:c}},A=function(a,b){var c;"add"==a?c="":b&&(b[0]&&b[0]["policy-name"])&&(c=b[0]["policy-name"]);if(void 0!=c)return{action:a,key:c}};a.pageActionJump=function(b,c,d){var e={S2S:{lockerID:"IPSec_S2S",prepareItem_cb:h},C2S:{lockerID:"IPSec_C2S",prepareItem_cb:g},SSL:{lockerID:"SSL_VPN",prepareItem_cb:A}},k=e[b].lockerID;c=e[b].prepareItem_cb(c,d);p.put(k,c);app.transition.In();a.pageJump(b)};a.idTrue=!0;a.idFalse=!1;a.T_cellEdit=q.get("T_editWithNoFoucs_by_rowEditableState.html");a.selected=a.selected||
{};a.selected.rowEditableState=[];a.gridS2SConn=a.gridS2SConn||{};a.gridS2SConn.toggleColumnSelect=function(a,b){var c={},d=new Date,g,h=new Date,d=d.getTime();h.setTime(d+31536E6);angular.forEach(b,function(a){g=a.field;switch(g){case "local_group":g="local-group";break;case "remote_group":g="remote-group"}a.visible&&(c[g]=a.visible)});l.putObject("vpn_status",c,{expires:h})};a.gridS2SConn.rowActionList=[{id:"connect",text:"Connect",toast:a.DICT("VPN_Status_Connect"),className:"icon-connect",stateDisplay:{"0":!0,
1:!1,2:!1},click:function(b,c){a.RPC_S2S("s2s-connect",{"connection-name":c.entity.name})}},{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),className:"icon-disconnect",stateDisplay:{"0":!1,1:!0,2:!1},click:function(b,c){a.RPC_S2S("s2s-disconnect",{"connection-name":c.entity.name})}}];a.gridS2SConn.rowActionRule=function(b,c,d){c=2;if("connect"==d.id||"disconnect"==d.id){c=b.entity["ipsec-profile"];var g="",g=c.match(/^prof_/)?c.substr(5):c;c="UP"==b.entity.status;var h=!1;
angular.forEach(a.model["ipsec-profiles"]["ipsec-profile"],function(a,b){a["profile-name"]==g&&(h=a["keying-mode"]&&a["keying-mode"]["phase1-options"]?!0:!1)});c=c?1:0;b.entity._disabled=h?!1:!0;!1==b.entity.enable&&(b.entity._disabled=!0)}return d.stateDisplay[c]};a.gridS2SConn.Selections=[];a.gridS2SConn.procClick=function(b){a.gridS2SConn.Selections=[];a.gridS2SConn.Selections.push(a.model["site-to-site-state"].connections.connection[b])};a.gridS2SConn.Options=app.uiGrid.generateGridOptions({IDPreifx:"Connection",
columnDefs:[{field:"checked",isRadio:!0,changedCbk:a.gridS2SConn.procClick},{field:"number",displayName:a.DICT("VPN_Status_No"),minWidth:55,hideInMenu:!0,visible:s.number},{field:"name",displayName:a.DICT("VPN_Status_Name_N"),visible:s.name},{field:"enable",displayName:a.DICT("VPN_Status_Enable"),cellTemplate:q.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"grid.appScope.schema.StatusMap[MODEL_COL_FIELD]"),visible:s.enable},{field:"status",displayName:a.DICT("VPN_Status_Status_N"),visible:s.status},
{field:"auth",displayName:a.DICT("VPN_Status_Phase2_Enc_Auth_Grp"),minWidth:240,visible:s.auth,cellTemplate:q.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"grid.appScope.showAuthGroup(MODEL_COL_FIELD)")},{field:"local_group",displayName:a.DICT("VPN_Status_Local_Group"),visible:s["local-group"],cellTemplate:q.get("vpnstatus_group.html")},{field:"remote_group",displayName:a.DICT("VPN_Status_Remote_Group"),minWidth:135,visible:s["remote-group"],cellTemplate:q.get("vpnstatus_group.html")},{field:"remote-gateway",
displayName:a.DICT("VPN_Status_Remote_Gateway"),minWidth:135,visible:s["remote-gateway"]},{field:"wan-interface",displayName:a.DICT("VPN_Status_WAN_Interface"),visible:s["wan-interface"]},{field:"ike-sa-time",displayName:a.DICT("VPN_Status_IKE_SA_Time_Expire"),visible:s["ike-sa-time"]},{field:"ipsec-sa-time",displayName:a.DICT("VPN_Status_IPSec_SA_Time_Expire"),visible:s["ipsec-sa-time"]},{field:"tx-bytes",displayName:a.DICT("VPN_Status_TX_Bytes"),visible:s["tx-bytes"]},{field:"rx-bytes",displayName:a.DICT("VPN_Status_RX_Bytes"),
visible:s["rx-bytes"]},{field:"tx-packets",displayName:a.DICT("VPN_Status_TX_Packets"),visible:s["tx-packets"]},{field:"rx-packets",displayName:a.DICT("VPN_Status_RX_Packets"),visible:s["rx-packets"]},{field:"action",displayName:a.DICT("VPN_Status_Action"),width:180,cellTemplate:q.get("T_VPNStatus_Action.html"),rowAction:a.gridS2SConn.rowActionList,rowActionRule:a.gridS2SConn.rowActionRule,visible:s.action,hideInMenu:!0}]});a.showAuthGroup=function(a){return a.match("modp1024")?a+"-group 2":a.match("modp1536")?
a+"-group 5":a};a.showLocalRemoteGroup=function(a){return!angular.isDefined(a)||""==a||"any"==a?"0.0.0.0/0":a};a.gridS2SConn.remove=function(){a.S2Smethod_row("del_site_to_site",a.gridS2SConn.Selections[0].name);a.gridRefresh()};a.gridS2SConn.refresh=function(){v("ipsec_s2s_state",function(){k()},function(){a.model&&(a.model["site-to-site-state"]&&a.model["site-to-site-state"].connections&&a.model["site-to-site-state"].connections.connection)&&a.model["site-to-site-state"].connections.connection.splice(0)})};
a.gridRefresh=function(){Log(DEBUG,"==Refresh==");a.gridS2SConn.refresh()};a.gridC2SConn=a.gridC2SConn||{};a.gridC2SConn.clickView=function(){a.gridC2SConn.viewConn=!a.gridC2SConn.viewConn};a.gridC2SConn.Plugin={init:function(a,b,c){}};a.gridC2SConn.rowActionList=[{id:"viewConnection",text:"View Connection",toast:a.DICT("VPN_Status_View"),className:"icon-look",stateDisplay:{"0":!0,1:!0,2:!0},click:function(b,c){a.gridC2SConn.viewConn=!a.gridC2SConn.viewConn}},{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),
className:"icon-disconnect",stateDisplay:{"0":!0,1:!1,2:!0},click:function(b,c){a.RPC_C2S("c2s-disconnect",{"group-name":c.entity["group-name"]})}},{id:"delete",text:"Delete",toast:a.DICT("VPN_Status_Delete"),stateDisplay:{"0":!0,1:!0,2:!0},className:"icon-delete",click:function(b,c){a.C2Smethod_row("del_client_to_site",c.entity.name)}}];a.gridC2SConn.rowActionRule=function(a,b,c){b=2;if("connect"==c.id||"disconnect"==c.id)b="UP"==a.entity.status?1:0;return c.stateDisplay[b]};a.gridC2SConn.Selections=
[];a.gridC2SConn.procClick=function(b){b=a.model["client-to-site-state"].connection[b];a.gridC2SConn.Selections=[];a.gridC2SConn.Selections.push(b);a.gridC2SConnDetail.Options.data=b.client;a.gridC2SConn.viewConn&&a.gridC2SConn.Options.gridApi.core.notifyDataChange("all")};a.gridC2SConn.Options=app.uiGrid.generateGridOptions({IDPreifx:"C2SConn",columnDefs:[{field:"checked",isRadio:!0,changedCbk:a.gridC2SConn.procClick},{field:"number",displayName:a.DICT("VPN_Status_No"),minWidth:55,hideInMenu:!0},
{field:"group-name",displayName:a.DICT("VPN_Status_Group_Tunnel_Name")},{field:"tunnels",displayName:a.DICT("VPN_Status_Connections")},{field:"auth",displayName:a.DICT("VPN_Status_Phase2_Enc_Auth_Grp")},{field:"local-group",displayName:a.DICT("VPN_Status_Local_Group"),cellTemplate:q.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"grid.appScope.showLocalRemoteGroup(MODEL_COL_FIELD)")},{field:"wan-interface",displayName:a.DICT("VPN_Status_WAN_Interface"),visible:!1},{field:"ike-sa-time",displayName:a.DICT("VPN_Status_IKE_SA_Time_Expire"),
visible:!1},{field:"ipsec-sa-time",displayName:a.DICT("VPN_Status_IPSec_SA_Time_Expire"),visible:!1},{field:"tx-bytes",displayName:a.DICT("VPN_Status_TX_Bytes"),visible:!1},{field:"rx-bytes",displayName:a.DICT("VPN_Status_RX_Bytes"),visible:!1},{field:"tx-packets",displayName:a.DICT("VPN_Status_TX_Packets"),visible:!1},{field:"rx-packets",displayName:a.DICT("VPN_Status_RX_Packets"),visible:!1},{field:"action",displayName:a.DICT("VPN_Status_Action"),width:180,visible:!1,id:"C2SConnAction",cellTemplate:q.get("T_VPNStatus_Action.html"),
rowAction:a.gridC2SConn.rowActionList,rowActionRule:a.gridC2SConn.rowActionRule,hideInMenu:!0}]});a.gridC2SConn.remove=function(){a.C2Smethod_row("del_client_to_site",a.gridC2SConn.Selections[0]["group-name"]);a.gridRefresh()};a.gridC2SConnDetail=a.gridC2SConnDetail||{};a.gridC2SConnDetail.rowActionList=[{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),stateDisplay:{"0":!0,1:!1,2:!0},className:"icon-disconnect",click:function(b,c){var d=a.gridC2SConn.Selections[0],g=d.client[b];
a.RPC_C2S("c2s-disconnect",{"group-name":d["group-name"],ip:g.ip,vip:g.vip})}}];a.gridC2SConnDetail.rowActionRule=function(a,b,c){b=2;if("connect"==c.id||"disconnect"==c.id)b="UP"==a.entity.status?1:0;return c.stateDisplay[b]};a.gridC2SConnDetail.Options=app.uiGrid.generateGridOptions({IDPreifx:"C2SConnDetail",columnDefs:[{field:"number",displayName:a.DICT("VPN_Status_No"),width:55,hideInMenu:!0},{field:"ip",displayName:a.DICT("VPN_Status_Client_IP_Actual")},{field:"vip",displayName:a.DICT("VPN_Status_Client_IP_VPN")},
{field:"tx-bytes",displayName:a.DICT("VPN_Status_TX_Bytes")},{field:"rx-bytes",displayName:a.DICT("VPN_Status_RX_Bytes")},{field:"tx-packets",displayName:a.DICT("VPN_Status_TX_Packets")},{field:"rx-packets",displayName:a.DICT("VPN_Status_RX_Packets")},{field:"connect-time",displayName:a.DICT("VPN_Status_Connect_Time")},{field:"action",displayName:a.DICT("VPN_Status_Action"),width:180,id:"C2SConnDetailAction",cellTemplate:q.get("T_VPNStatus_Action.html"),rowAction:a.gridC2SConnDetail.rowActionList,
rowActionRule:a.gridC2SConnDetail.rowActionRule,hideInMenu:!0}]});a.gridSSLConn=a.gridSSLConn||{};a.gridSSLConn.clickView=function(){a.gridSSLConn.viewConn=!a.gridSSLConn.viewConn};a.gridSSLConn.Plugin={init:function(a,b,c){}};a.gridSSLConn.rowActionList=[{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),className:"icon-disconnect",stateDisplay:{"0":!1,1:!0,2:!0},click:function(b,c){a.RPC_SSL("ssl-disconnect",{"session-id":c.entity["session-id"]})}},{id:"delete",text:"Delete",
toast:"Delete",className:"icon-delete",stateDisplay:{"0":!0,1:!0,2:!0},click:function(b,c){a.SSLmethod_row("del_sslvpn",c.entity["policy-name"])}}];a.gridSSLConn.rowActionRule=function(a,b,c){b=2;if("connect"==c.id||"disconnect"==c.id)b="UP"==a.entity.status?1:0;return c.stateDisplay[b]};a.gridSSLConn.Selections=[];a.gridSSLConn.procClick=function(b){a.gridSSLConn.Selections=[];a.gridSSLConn.Selections.push(a.model["sslvpn-state"]["group-policies"]["group-policy"][b]);a.gridSSLConnDetail.Options.data=
a.gridSSLConn.Selections[0].client};a.gridSSLConn.Options=app.uiGrid.generateGridOptions({IDPreifx:"SSLConn",columnDefs:[{field:"checked",isRadio:!0,changedCbk:a.gridSSLConn.procClick},{field:"number",displayName:a.DICT("VPN_Status_No"),width:55,hideInMenu:!0},{field:"policy-name",displayName:a.DICT("VPN_Status_Policy_Name")},{field:"sessions",displayName:a.DICT("VPN_Status_Sessions")},{field:"wan-interface",displayName:a.DICT("VPN_Status_WAN_Interface"),visible:!1},{field:"ike-sa-time",displayName:a.DICT("VPN_Status_IKE_SA_Time_Expire"),
visible:!1},{field:"ipsec-sa-time",displayName:a.DICT("VPN_Status_IPSec_SA_Time_Expire"),visible:!1},{field:"tx-bytes",displayName:a.DICT("VPN_Status_TX_Bytes"),visible:!1},{field:"rx-bytes",displayName:a.DICT("VPN_Status_RX_Bytes"),visible:!1},{field:"tx-packets",displayName:a.DICT("VPN_Status_TX_Packets"),visible:!1},{field:"rx-packets",displayName:a.DICT("VPN_Status_RX_Packets"),visible:!1}]});a.gridSSLConn.remove=function(){a.SSLmethod_row("del_sslvpn",a.gridSSLConn.Selections[0]["policy-name"]);
a.gridRefresh()};a.gridSSLConnDetail=a.gridSSLConnDetail||{};a.gridSSLConnDetail.rowActionList=[{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),stateDisplay:{"0":!0,1:!1,2:!0},className:"icon-disconnect",click:function(b,c){a.RPC_SSL("ssl-disconnect",{"session-id":c.entity["session-id"]})}}];a.gridSSLConnDetail.rowActionRule=function(a,b,c){b=2;if("connect"==c.id||"disconnect"==c.id)b="UP"==a.entity.status?1:0;return c.stateDisplay[b]};a.gridSSLConnDetail.Selections=[];a.gridSSLConnDetail.Options=
app.uiGrid.generateGridOptions({IDPreifx:"SSLConnDetail",columnDefs:[{field:"number",displayName:a.DICT("VPN_Status_No"),width:55,hideInMenu:!0},{field:"ip",displayName:a.DICT("VPN_Status_Client_IP_Actual")},{field:"vip",displayName:a.DICT("VPN_Status_Client_IP_VPN")},{field:"tx-bytes",displayName:a.DICT("VPN_Status_TX_Bytes")},{field:"rx-bytes",displayName:a.DICT("VPN_Status_RX_Bytes")},{field:"tx-packets",displayName:a.DICT("VPN_Status_TX_Packets")},{field:"rx-packets",displayName:a.DICT("VPN_Status_RX_Packets")},
{field:"connect-time",displayName:a.DICT("VPN_Status_Connect_Time")},{field:"action",displayName:a.DICT("VPN_Status_Action"),width:180,id:"C2SConnDetailAction",cellTemplate:q.get("T_VPNStatus_Action.html"),rowAction:a.gridSSLConnDetail.rowActionList,rowActionRule:a.gridSSLConnDetail.rowActionRule,hideInMenu:!0}]});a.gridPPTPConn=a.gridPPTPConn||{};a.gridPPTPConn.rowActionList=[{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),className:"icon-disconnect",click:function(b,c){a.RPC_PPTP("pptp-disconnect",
{"tunnel-ip":c.entity["tunnel-ip"],"session-id":c.entity["session-id"]})}}];a.gridPPTPConn.rowActionRule=function(a,b,c){return!0};a.gridPPTPConn.Options=app.uiGrid.generateGridOptions({IDPreifx:"PPTPConn",columnDefs:[{field:"session-id",displayName:a.DICT("VPN_Status_Session_ID")},{field:"user-name",displayName:a.DICT("VPN_Status_User_Name")},{field:"remote-address",displayName:a.DICT("VPN_Status_Remote_Address")},{field:"tunnel-ip",displayName:a.DICT("VPN_Status_Tunnel_IP")},{field:"connect-time",
displayName:a.DICT("VPN_Status_Connect_Time")},{field:"action",displayName:a.DICT("VPN_Status_Action"),width:120,id:"PPTPConnAction",cellTemplate:q.get("T_VPNStatus_Action.html"),rowAction:a.gridPPTPConn.rowActionList,rowActionRule:a.gridPPTPConn.rowActionRule,hideInMenu:!0}]});a.gridL2TPConn=a.gridL2TPConn||{};a.gridL2TPConn.rowActionList=[{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),className:"icon-disconnect",click:function(b,c){a.RPC_L2TP("l2tp-disconnect",{"tunnel-ip":c.entity["tunnel-ip"],
"session-id":c.entity["session-id"]})}}];a.gridL2TPConn.rowActionRule=function(a,b,c){return!0};a.gridL2TPConn.Options=app.uiGrid.generateGridOptions({IDPreifx:"L2TPConn",columnDefs:[{field:"session-id",displayName:a.DICT("VPN_Status_Session_ID")},{field:"user-name",displayName:a.DICT("VPN_Status_User_Name")},{field:"remote-address",displayName:a.DICT("VPN_Status_Remote_Address")},{field:"tunnel-ip",displayName:a.DICT("VPN_Status_Tunnel_IP")},{field:"connect-time",displayName:a.DICT("VPN_Status_Connect_Time")},
{field:"action",displayName:a.DICT("VPN_Status_Action"),width:120,id:"L2TPConnAction",cellTemplate:q.get("T_VPNStatus_Action.html"),rowAction:a.gridL2TPConn.rowActionList,rowActionRule:a.gridL2TPConn.rowActionRule,hideInMenu:!0}]});a.Fns={getRPCResult:function(a,b){if(a.data.result&&a.data.result.output){var c=a.data.result.output;return b?c[b]:c}console.log("Error: getRPCResult, data.result not exist")},doSyncRPC:function(a,b){var c={};a.input&&(c.input=a.input);c.rpc=a.rpcname||"";return u.post({url:a.url||
"",method:"action",params:c,success:function(a){b&&b.success&&b.success(a)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);b&&b.error&&b.error(a)}})},ret_code_dispatcher:function(a,b,c){a=y.getRPCResult(a,"code");b&&b(a,c)}};var y=a.Fns;(function(){var b=v("vpn_status"),c=v("pptp_server"),g=v("l2tp_server"),h=v("ipsec_s2s"),l=v("ipsec_c2s"),n=v("ipsec_profiles"),r=v("sslvpn"),m=v("teleworker_vpn_state"),s=v("teleworker_vpn"),p=v("ip_group");t.all([b,c,g,h,l,
n,r,m,s,p]).then(function(b){for(var c=0;c<b.length;c++)angular.extend(a.model,b[c].data.result);d();k();e.recover_object(a.model,{"teleworker-vpn-clients-state":{}});e.recover_object(a.model,{"teleworker-vpn-clients":{}});a.schema=a.schema||{};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.loadReady=!0})["catch"](function(a){console.log("=="+a)})})()}]);app.controller("captivePortalStatusCtrl",["$scope","MyHttp","$q","rpcFns",function(a,b,t,m){a.dataReady=!1;a.forcedUsingPost=!0;var w={procBackground:!0,forcedUsingPost:a.forcedUsingPost},u,p=function(){a.model={};a.gridCaptivePortalState=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:n,headerChangedCbk:n},{field:"name",displayName:a.DICT("Captive_Portal_Status_Username")},{field:"ssid",displayName:a.DICT("Captive_Portal_Status_SSID")},{field:"ip_address",displayName:a.DICT("Captive_Portal_Status_IP_Addr")},
{field:"mac_address",displayName:a.DICT("Captive_Portal_Status_MAC_Addr")},{field:"auth",displayName:a.DICT("Captive_Portal_Status_Auth")},{field:"tx_bytes",displayName:a.DICT("Captive_Portal_Status_Tx_Bytes")},{field:"rx_bytes",displayName:a.DICT("Captive_Portal_Status_Rx_Bytes")},{field:"connect_time",displayName:a.DICT("Captive_Portal_Status_Connected_Time")}]});t.all([e()]).then(function(b){u=b[0]&&b[0].data&&b[0].data.result||{};x();a.resetModified();a.dataReady=!0});a.model.selected=void 0!==
a.keepname?a.keepname:"All"},q=function(a){var b=Math.floor(a/3600),e=Math.floor(a%3600/60);a=a%3600%60;return(9<b?b:"0"+b)+":"+(9<e?e:"0"+e)+":"+(9<a?a:"0"+a)},e=function(){return b.post({url:resource_base+"data/captive_portal_state.json",method:"get_portal_state",error:function(a){console.log("[Err] captivePortalStatusCtrl, getCaptivePortalStatusData status: "+a.status)}})},x=function(){u||(u={});var b=(u["cp-user-state"]||{}).client||[];a.model.userList=[];var e=void 0,l=void 0,k=!0;if(a.model.selected&&
"All"!==a.model.selected){var d=/(.+)\((.+)\)/,k=!1,e=a.model.selected.replace(d,"$1"),d=a.model.selected.replace(d,"$2");"2.4G"==d?l="WLAN1":"5G"==d&&(l="WLAN2")}angular.forEach(b,function(b){if(k||e&&l&&e==b.ssid&&l==b.radio)a.model.userList.push({name:b.name||"",ssid:b.ssid||"",ip_address:b["ip-address"]||"",mac_address:b["mac-address"]||"",auth:void 0!==b.auth?b.auth?a.DICT("Captive_Portal_Status_TRUE"):a.DICT("Captive_Portal_Status_FALSE"):"",tx_bytes:b["tx-bytes"]||"",rx_bytes:b["rx-bytes"]||
"",connect_time:b["connected-time"]?q(b["connected-time"]):""})});b=a.model.userList.length||0;d=a.model.userList;if(b)for(var c=0;c<b;c++)void 0===d[c].checked&&(d[c].checked=!1);a.gridCaptivePortalState.data=a.model.userList},n=function(b){var e=!0;angular.forEach(a.model.userList,function(a){a.checked||(e=!1)});a.gridCaptivePortalState.columnDefs[0].allSelected=e;l()},l=function(){var b=a.model.userList,e=b.length,l;a.model.selects=[];for(l=0;l<e;l++)b[l].checked&&a.model.selects.push(l)};a.collect_ssid_list=
function(){var a=[];angular.forEach((u["cp-user-state"]||{}).client||[],function(b){if(b.ssid&&b.radio){var e=void 0;"WLAN1"==b.radio?e=b.ssid+"(2.4G)":"WLAN2"==b.radio&&(e=b.ssid+"(5G)");e&&a.push(e)}});a.sort(function(a,b){return a>b?1:-1});a.unshift("All");return a.filter(function(a,b,e){return e.indexOf(a)===b})};a.update=function(){x()};a.refresh=function(){a.dataReady=!1;p()};a.RPC_disconnect=function(){var b;if(a.gridCaptivePortalState.columnDefs[0].allSelected)b={all:null};else if(1==a.model.selects.length)b=
a.model.selects[0],b={one:a.model.userList[b].mac_address};else for(var e=[],l=0;l<a.model.selects.length;l++)b=a.model.selects[l],e.push(a.model.userList[b].mac_address),b={list:e};m.RPC_generic_send("terminate-cp-user",b,function(b,d,c){b&&(a.dataReady=!1,p())},void 0,w)};p()}]);app.controller("clientStatisticsCtrl",["$scope","MyHttp","userAccessRight","UserSession","$q","dt","device_os_type","$templateCache","goToPreviousPage",function(a,b,t,m,w,u,p,q,e){a.jumpToPage=app.TOOLS.jumpToPage;a.backbtn=!1;var x=app.TOOLS.getVal,n=app.TOOLS.str2int,l=app.TOOLS.getResponse,r=app.TOOLS.MBpkt2String,v=app.TOOLS.cpuPercentageNum;e.isneed()&&(a.backbtn=!0);var s=0,k=function(b){var c="",d,g;if(!_.isNumber(b))return"-";d=Math.floor(b/86400);0<d&&(g=1===d?a.DICT("Client_Statistics_Day"):
a.DICT("Client_Statistics_Days"),c=d+" "+g);d=Math.floor(b/3600)%24;if(0<d||c&&0===d)c&&(c+=", "),g=1>=d?a.DICT("Client_Statistics_Hour"):a.DICT("Client_Statistics_Hours"),c=c+d+" "+g;d=Math.floor(b/60)%60;if(0<d||c&&0===d)c&&(c+=", "),g=1>=d?a.DICT("Client_Statistics_Minute"):a.DICT("Client_Statistics_Minutes"),c=c+d+" "+g;d=b%60;c&&(c+=", ");g=1>=d?a.DICT("Client_Statistics_Second"):a.DICT("Client_Statistics_Seconds");return c+d+" "+g},d=function(){return b.post({url:resource_base+"data/ip_group.json",
method:"get_ipgroup",error:function(a){Log(ERROR,"clientStatisticsCtrl getIpGroupData error : "+a.status);c()}})},c=function(b){var c=[],d;b&&(b["ip-groups"]&&b["ip-groups"]["ip-group"])&&(c=b["ip-groups"]["ip-group"]);a.model.ip_groups=[];a.model.mac2ipgroup_map={};angular.forEach(c,function(b,c){d=h(b);d.id=c+1;angular.forEach(d.macs,function(c){a.model.mac2ipgroup_map[c.mac]=b.name;d.macsStr&&(d.macsStr+=", ");d.macsStr+=c.mac});d.macsStr||(d.macsStr="-");a.model.ip_groups.push(d)});s=a.model.ip_groups.length},
h=function(a){a||(a={});var b={type:"origin",id:0,name:a.name||"",macs:[],checked:!1,disable:!0,invalid:!1,edit:!1,macsStr:""};angular.forEach(a.macs||[],function(a){b.macs.push({mac:a.mac||"",device_type:a["device-type"]||"ANY",os_type:a["os-type"]||"ANY"})});return b},g=function(){return b.post({url:resource_base+"data/avc_state_applications.json",method:"get_avc_state",error:function(){}})},A=function(b){b=b&&b["avc-state"]&&b["avc-state"]||{};var c=b.applications||[],d;a.model.app_map={};tmp=
u.parser(b["last-reset-time"]);0===tmp.err_code&&(a.model.application_reset_time_str=k(tmp.date));angular.forEach(c,function(b){d={application:b.application||"-",protocol:b.protocol||"-",port:b.port||"N/A",flows:b.flows||"-"};a.model.app_map[d.application]=d})},y=function(b){b||(b={});b=x(b.status,0);a.model.no_license=0===b};procClientData=function(b){b=(b&&b["avc-state"]&&b["avc-state"]||{}).clients||[];var c,d=0,g,h,e,k,l,m,s,p,q,y,A;a.model.clients=[];angular.forEach(b,function(b){s=x(b["os-type"],
"ANY");p=x(b["device-type"],"ANY");"Unknown"===s&&(s="ANY");"Unknown"===p&&(p="ANY");c={checked:!1,edit:!1,mac:b.mac||"",ip_address:b["ipv4-address"]||b["ipv6-address"]||"",hostname:b.hostname||"-",device_type:p,os_type:s,status:b.status||"unknown",ip_group:b["ip-group"]||"@none",in_pkts:b["in-pkts"]||0,out_pkts:b["out-pkts"]||0,applications:[],device_type_list:[],os_type_list:[],orig_ip_group:"",orig_os_type:"",orig_device_type:"",orig_hostname:"",action:"",usage_pkts:0,usage_per_num:0,usage_per:0,
usage_per_str:"0%",ip_groups_list:[],ip_group_id:0};g=b.applications||[];m=l=0;angular.forEach(g,function(b){h={application:b["app-id"],active_time:x(b["active-time"],"N/A"),active_time_str:"",in_pkts:n(x(b["in-pkts"],0)),out_pkts:n(x(b["out-pkts"],0)),in_pkts_str:"",out_pkts_str:"",usage_pkts:0,usage_str:"",usage_per_num:0,usage_per:0,usage_per_str:"",port:"N/A",protocol:"-",flows:"-"};h.usage_pkts=h.in_pkts+h.out_pkts;h.usage_str=r(h.usage_pkts);h.in_pkts_str=r(h.in_pkts);h.out_pkts_str=r(h.out_pkts);
b=h.active_time;var d="",g,e;if(_.isNumber(b)){g=Math.floor(b/1440);0<g&&(e=1===g?a.DICT("Client_Statistics_Day"):a.DICT("Client_Statistics_Days"),d=g+" "+e);g=Math.floor(b/60)%24;if(0<g||d&&0===g)d&&(d+=", "),e=1>=g?a.DICT("Client_Statistics_Hour"):a.DICT("Client_Statistics_Hours"),d=d+g+" "+e;g=b%60;d&&(d+=", ");e=1>=g?a.DICT("Client_Statistics_Minute"):a.DICT("Client_Statistics_Minutes");b=d+g+" "+e}else b="-";h.active_time_str=b;l+=h.in_pkts;m+=h.out_pkts;c.applications.push(h)});c.in_pkts=l;
c.out_pkts=m;c.usage_pkts=c.in_pkts+c.out_pkts;c.usage_str=r(c.usage_pkts);c.orig_ip_group=c.ip_group;c.orig_os_type=c.os_type;c.orig_device_type=c.device_type;c.orig_hostname=c.hostname;d+=c.usage_pkts;sub_total=c.usage_pkts;A=q=y=0;angular.forEach(c.applications,function(a){0===sub_total?(a.usage_per_num=0,a.usage_per=0,a.usage_per_str="0%"):(a.usage_per_num=v(a.usage_pkts,sub_total,1,!1),a.usage_per=Math.floor(a.usage_per_num),q+=a.usage_per,A+=1,0===a.usage_per&&0!==a.usage_pkts?(y+=1,a.usage_per_str=
"<1%"):a.usage_per_str=a.usage_per+"%")});if(100!==q&&0!==sub_total)if(1===y&&2===A)angular.forEach(c.applications,function(a){0!==a.usage_pkts&&0!==a.usage_per&&(a.usage_per_str=">99%")});else{c.applications.sort(function(a,b){return b.usage_per_num-a.usage_per_num});k=c.applications;e=100-q;0!==y&&(e-=1);for(i=0;i<k.length&&e;i++)0<e&&0!==k[i].usage_pkts&&(k[i].usage_per+=1,k[i].usage_per_str=k[i].usage_per+"%",e-=1)}c.applications.sort(function(a,b){return a.application<b.application?-1:1});a.model.clients.push(c)});
A=y=q=0;angular.forEach(a.model.clients,function(a){0===d?(a.usage_per=0,a.usage_per_str="0%"):(a.usage_per_num=v(a.usage_pkts,d,1,!1),a.usage_per=Math.floor(a.usage_per_num),A+=1,q+=a.usage_per,0===a.usage_per&&0!==a.usage_pkts?(y+=1,a.usage_per_str="<1%"):a.usage_per_str=a.usage_per+"%")});a.model.clients.sort(function(a,b){return b.usage_per-a.usage_per});if(100!==q&&0!==d)if(1===y&&2===A)angular.forEach(a.model.clients,function(a){0!==a.usage_per&&0!==a.usage_pkts&&(a.usage_per_str=">99%")});
else{k=a.model.clients;e=100-q;0<y&&(e-=1);for(i=0;i<k.length&&e;i++)0<e&&0!==k[i].usage_pkts&&(k[i].usage_per+=1,k[i].usage_per_str=k[i].usage_per+"%",e-=1)}};var z=function(){a.model.g_ip_groups_list=[{id:0,name:"@none",displayName:a.DICT("Client_Statistics_None")}];angular.forEach(a.model.ip_groups,function(b){a.model.g_ip_groups_list.push({id:b.id,name:b.name||"",displayName:b.name||""})});angular.forEach(a.model.clients,function(b){b.ip_groups_list=a.model.g_ip_groups_list})},B=function(){var b=
{"@none":0};angular.forEach(a.model.g_ip_groups_list,function(a){b[a.name]=a.id});angular.forEach(a.model.clients,function(a){void 0===b[a.ip_group]&&(a.ip_group="@none");a.ip_group_id=b[a.ip_group]})},D=function(){setTimeout(function(){a.gridClientOptions.gridApi&&a.gridClientOptions.gridApi.customApi&&a.gridClientOptions.gridApi.customApi.checkSelectStatus()},50)},E=function(){var b;angular.forEach(a.model.clients,function(c){angular.forEach(c.applications,function(c){if(b=a.model.app_map[c.application])c.port=
b.port,c.flows=b.flows,c.protocol=b.protocol})})},C=function(){s=0;w.all([d(),g(),p.get()]).then(function(b){c(l(b,0));procClientData(l(b,1));A(l(b,1));y(l(b,1));a.model.device_types=b[2].device;a.model.os_types=b[2].os;a.ui_data.disabled_ipgroup_btns=!0;z();B();E();angular.forEach(a.model.clients,function(b){b.device_type_list=a.model.device_types;b.os_type_list=a.model.os_types[b.device_type]||[]});a.model.no_license||(a.gridIpGroupsOptions.data=a.model.ip_groups,a.gridClientOptions.data=a.model.clients);
D();a.ui_data.data_ready=!0;a.resetModified()})},I=function(){w.all([g()]).then(function(b){procClientData(l(b,0));A(l(b,0));E();angular.forEach(a.model.clients,function(b){b.device_type_list=a.model.device_types;b.os_type_list=a.model.os_types[b.device_type]||[]});a.gridClientOptions.data=a.model.clients;z();B();D()})};a.ui_data={max_ip_group_cnt:50,disabled_ipgroup_btns:!0,data_ready:!1,client_name:"",client_status:"",client_device_type:"",page:"main",ip_group_note:"",checked_clients:[],combineNote:a.DICT("Client_Statistics_Note",
{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Here")+"</u></a>"})};a.ui_data.ip_group_note=a.DICT("Client_Statistics_IP_Group_Note",{"%s":"<a ng-click=\"jumpToPage('System_Config_IP_Address')\">"+a.DICT("Client_Statistics_Here")+"</a>"});a.model={no_license:!0,ip_groups:[],g_ip_groups_list:[],clients:[],device_types:[],os_types:{},def_device_type:"",mac2ipgroup_map:{},app_map:{},apps:[]};t=function(){a.ui_data.checked_clients=[];angular.forEach(a.model.clients,function(b){b.checked&&
a.ui_data.checked_clients.push(b)})};var G=function(b){var c={};angular.forEach(a.model.g_ip_groups_list,function(a){c[a.id]=a.name});angular.forEach(a.model.clients,function(a){void 0===c[a.ip_group_id]?(a.ip_group_id=0,a.ip_group="@none"):a.ip_group=c[a.ip_group_id]})};m=function(a){return function(b,c,d,g,h){return d.entity[a]===g.entity[a]?0:d.entity[a]>g.entity[a]?1:-1}};a.gridIpGroupsOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"name",displayName:a.DICT("Client_Statistics_Groupname"),
editRow:"edit",change:function(b){b=a.model.ip_groups;var c,d,g;angular.forEach(b,function(a){a.invalid=!1;"new"===a.type&&(a.disable=!1)});g=b.length;for(c=0;c<g;c++)for(d=c+1;d<g;d++)b[c].name===b[d].name&&(b[c].invalid=!0,b[d].invalid=!0,b[c].disable=!0,b[d].disable=!0);z();G()},invalidField:"invalid",required:!0,cellTemplate:q.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'uci-name maxlength="64" size="64"')},{field:"macsStr",displayName:a.DICT("Client_Statistics_Clients")}]});
a.gridClientOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t},{field:"mac",displayName:a.DICT("Client_Statistics_MAC_Address"),click:function(b,c){var d=c.entity;a.ui_data.client_title=d.ip_address||"";a.ui_data.client_name=d.hostname||"";a.ui_data.client_status=d.status||"";a.ui_data.client_device_type=d.device_type||"";a.ui_data.apps=d.applications;a.gridApplicationOptions.data=a.ui_data.apps;a.ui_data.page="sub"},cellTemplate:"UG_table_text_with_inline_href_click.html"},
{field:"ip_address",displayName:a.DICT("Client_Statistics_IPv4_IPv6_Address")},{field:"status",displayName:a.DICT("Client_Statistics_Status")},{field:"hostname",displayName:a.DICT("Client_Statistics_Hostname"),editRow:"edit",required:!0,cellTemplate:"UG_table_text_with_inline_edit.html"},{field:"device_type",displayName:a.DICT("Client_Statistics_Device_Type"),editRow:"edit",required:!0,changedCbk:function(b,c){var d=c.entity;a.model.os_types[d.device_type]&&(d.os_type_list=a.model.os_types[d.device_type],
d.os_type=p.get_default_os_type(d.os_type_list))},listField:"device_type_list",cellTemplate:"UG_table_select1_with_inline_edit.html"},{field:"os_type",displayName:a.DICT("Client_Statistics_OS_Type"),editRow:"edit",required:!0,listField:"os_type_list",cellTemplate:"UG_table_select1_with_inline_edit.html"},{field:"usage_per_str",displayName:a.DICT("Client_Statistics_Usage_Per"),sortingAlgorithm:m("usage_pkts")},{field:"ip_group_id",displayName:a.DICT("Client_Statistics_Ip_Group"),changedCbk:function(b,
c){var d=c.entity;angular.forEach(a.model.g_ip_groups_list,function(a){d.ip_group_id===a.id&&(d.ip_group=a.name)})},editRow:"edit",listField:"ip_groups_list",cellTemplate:"UG_table_select1_with_inline_edit.html"}]});a.gridApplicationOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"application",displayName:a.DICT("Client_Statistics_Destination")},{field:"protocol",displayName:a.DICT("Client_Statistics_Protocol"),width:100},{field:"port",displayName:a.DICT("Client_Statistics_Port"),width:80,
sortingAlgorithm:m("port")},{field:"usage_per_str",displayName:a.DICT("Client_Statistics_Usage_Per"),sortingAlgorithm:m("usage_pkts")},{field:"usage_str",displayName:a.DICT("Client_Statistics_Usage"),sortingAlgorithm:m("usage_pkts")},{field:"out_pkts_str",displayName:a.DICT("Client_Statistics_Sent"),sortingAlgorithm:m("out_pkts")},{field:"in_pkts_str",displayName:a.DICT("Client_Statistics_Received"),sortingAlgorithm:m("in_pkts")},{field:"active_time_str",displayName:a.DICT("Client_Statistics_Active_Time"),
sortingAlgorithm:m("active_time")}]});a.funs={addIpGroup:function(){if(a.model.ip_groups.length>=a.ui_data.max_ip_group_cnt)app.TOOLS.criticalAlertBox({msg:a.DICT("Client_Statistics_Reach_Max_Entry",{"%d":a.ui_data.max_ip_group_cnt}),cbk:function(){}});else{var b=h();s+=1;b.type="new";b.edit=!0;b.id=s;b.checked=!0;b.disable=!0;a.model.ip_groups.push(b);a.modified()}},editIpGroup:function(){angular.forEach(a.model.ip_groups,function(a){"new"===a.type&&igp.checked&&(a.edit=!0)})},delIpGroup:function(){var b=
a.model.ip_groups,c;for(c=b.length-1;0<=c;c--)"new"===b[c].type&&b[c].checked&&(angular.forEach(a.model.clients,function(a){a.ip_group_id===b[c].id&&(a.ip_group_id=0,a.ip_group="@none")}),b.splice(c,1),a.modified());z();B()},editClient:function(){angular.forEach(a.model.clients,function(a){a.checked&&(a.edit=!0)})},sub_cancel:function(){a.ui_data.page="main"},save:function(){var c,d=[],g,h,e={},k=[],l=!1,n=function(){k.length&&b.post({forcedUsingPost:!0,method:"set_ipgroup",params:{"ip-groups":{"ip-group":k}},
success:function(){C()},error:function(){C()}})};angular.forEach(a.model.ip_groups,function(a){"origin"!==a.type&&(e[a.name]||(e[a.name]=!0))});angular.forEach(a.model.clients,function(b){if(b.orig_hostname!==b.hostname||b.orig_os_type!==b.os_type||b.orig_device_type!==b.device_type)d.push({mac:b.mac,"device-type":b.device_type,"os-type":b.os_type,hostname:b.hostname}),l=!0;angular.forEach(a.model.ip_groups,function(a){h=a.macs;if(a.name===b.ip_group&&"@none"!==b.ip_group)exist=!1,angular.forEach(h,
function(a){a.mac===b.mac&&(exist=!0)}),exist||(e[a.name]=!0,a.macs.push({mac:b.mac,device_type:b.device_type,os_type:b.os_type}));else for(c=h.length-1;0<=c;c--)h[c].mac===b.mac&&(h.splice(c,1),e[a.name]=!0)})});angular.forEach(a.model.ip_groups,function(a){e[a.name]&&(g={name:a.name,macs:[]},angular.forEach(a.macs,function(a){g.macs.push({mac:a.mac,"device-type":a.device_type,"os-type":a.os_type})}),k.push(g),l=!0)});d.length?b.post({forcedUsingPost:!0,method:"action",params:{rpc:"update-clients",
input:{clients:d}},success:function(){n()},error:function(b){b=b&&b.output&&b.output.errstr||"";app.TOOLS.criticalAlertBox({msg:"<div>"+a.DICT("Client_Statistics_RPC_Error")+"</div><div>"+b+"</div>",cbk:function(){C()}})}}):n();l||C()},cancel:function(){C()},refresh_client:function(){I()},goback:e.goback};C()}]);app.controller("snmp_controller",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,t,m){a.success=!1;a.loadReady=!1;var w=a.password_flag=!1;a.trapPortFlag=!1;a.ruFlag=m.russia();a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var u=function(){return b.post({url:resource_base+"data/snmp.json",method:"get_snmp",success:function(a){p(a.data.result)},error:function(a){console.log("get snmp error")}})},p=function(b){b||(b={});var m=b.snmp||{},n=b["SNMPv2-MIB"]&&
b["SNMPv2-MIB"].system||{},l=(b["SNMP-COMMUNITY-MIB"]&&b["SNMP-COMMUNITY-MIB"].snmpCommunityTable||{}).snmpCommunityEntry||[],r=(b["SNMP-TARGET-MIB"]&&b["SNMP-TARGET-MIB"].snmpTargetAddrTable||{}).snmpTargetAddrEntry||[];b=(b["SNMP-USER-BASED-SM-MIB"]&&b["SNMP-USER-BASED-SM-MIB"].usmUserTable||{}).usmUserEntry||[];var p="v1",s={},k="",d="",c="",h="",g="",q={},y={},t="",u="",D,E=/^(\d+\.\d+\.\d+\.\d+).(\d+).(\d+)$/;D=/^(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+)$/;
angular.forEach(m.snmpVersions,function(a,b){a&&(p=b)});"v2c"===p&&(p="v2");angular.forEach(r,function(a){a.snmpTargetAddrName===p&&(s=a)});if(s&&s.snmpTargetAddrTAddress)if(18===s.snmpTargetAddrTAddress.split(".").length){if(r=[],E="",D=D.exec(s.snmpTargetAddrTAddress)){r[0]="0";for(t=1;16>=t;t++)r[t]=parseInt(D[t],10).toString(16),1===r[t].length&&(r[t]="0"+r[t]);E=r[1]+r[2]+":"+r[3]+r[4]+":"+r[5]+r[6]+":"+r[7]+r[8]+":"+r[9]+r[10]+":"+r[11]+r[12]+":"+r[13]+r[14]+":"+r[15]+r[16];t=app.TOOLS.ipv6.toFullV6Addr(E);
t=app.TOOLS.ipv6.compress(t);u=256*parseInt(D[17],10)+parseInt(D[18],10)}}else if(D=E.exec(s.snmpTargetAddrTAddress))t=D[1],u=256*parseInt(D[2],10)+parseInt(D[3],10);angular.forEach(l,function(a,b){"private"===a.snmpCommunitySecurityName&&(d=a.snmpCommunityName||"",g=a.snmpCommunitySecurityName||"",c=a.snmpCommunityContextEngineID||"80:00:61:81:05:01");"public"===a.snmpCommunitySecurityName&&(k=a.snmpCommunityName||"",h=a.snmpCommunitySecurityName||"",c=a.snmpCommunityContextEngineID||"80:00:61:81:05:01")});
w=!1;angular.forEach(b,function(a){"admin"===a.usmUserName&&(q=a,w=!0);"guest"===a.usmUserName&&(y=a)});a.model.d={enabled:void 0!==m.enabled?m.enabled:!1,allow_access_from_wan:void 0!==m["allow-access-from-wan"]?m["allow-access-from-wan"]:!1,allow_access_from_vpn:void 0!==m["allow-access-from-vpn"]?m["allow-access-from-vpn"]:!1,version:p||"v1",system_name:n.sysName||"",system_contact:n.sysContact||"",system_location:n.sysLocation||"",get_community:k,set_community:d,engineID:c,get_securityName:h,
set_securityName:g,username:!0===w?"admin":"guest",v3:{guest:{usmUserEngineID:y.usmUserEngineID||"80:00:61:81:05:01",usmUserName:y.usmUserName||"guest",auth:y.usmUserAuthKey||"",auth_flag:!1,encryption:y.usmUserPrivKey||"",encryption_flag:!1,auth_alg:y.usmUserAuthProtocol||a.schema.auth_algs[0].id,encryption_alg:y.usmUserPrivProtocol||a.schema.ecr_algs[0].id},admin:{usmUserEngineID:q.usmUserEngineID||"80:00:61:81:05:01",usmUserName:q.usmUserName||"admin",auth:q.usmUserAuthKey||"",auth_flag:!1,encryption:q.usmUserPrivKey||
"",encryption_flag:!1,auth_alg:q.usmUserAuthProtocol||a.schema.auth_algs[0].id,encryption_alg:q.usmUserPrivProtocol||a.schema.ecr_algs[0].id}},trap_ip:t,trap_port:0===u?"":u}},q=function(){a.model=a.model||{};u();a.loadReady=!0;a.resetModified()};a.model={d:{}};a.schema={versions:[{displayName:"v1",id:"v1"},{displayName:"v2c",id:"v2"},{displayName:"v3",id:"v3"}],auth_algs:[{displayName:"None",id:"1.3.6.1.6.3.10.1.1.1"},{displayName:"MD5",id:"1.3.6.1.6.3.10.1.1.2"},{displayName:"SHA1",id:"1.3.6.1.6.3.10.1.1.3"}],
ecr_algs:[{displayName:"None",id:"1.3.6.1.6.3.10.1.2.1"},{displayName:"DES",id:"1.3.6.1.6.3.10.1.2.2"},{displayName:"AES",id:"1.3.6.1.6.3.10.1.2.4"}]};a.save=function(){var e=a.model.d,m="",n,l=[],r=0,p=[];n=[];var r="",s="1.3.6.1.6.1.1";if(""!==e.trap_ip&&0<=e.trap_ip.search(":")){r=createIpAddr().parse(e.trap_ip);s="1.3.6.1.2.1.100.1.2";for(m=0;8>m;m++)l[m]=r.parts[m].toString(16);for(m=0;8>m;m++)for(var r=l[m].length,k=0;k<4-r;k++)l[m]="0"+l[m];p[0]=l[0].substr(0,2);p[1]=l[0].substr(2,2);p[2]=
l[1].substr(0,2);p[3]=l[1].substr(2,2);p[4]=l[2].substr(0,2);p[5]=l[2].substr(2,2);p[6]=l[3].substr(0,2);p[7]=l[3].substr(2,2);p[8]=l[4].substr(0,2);p[9]=l[4].substr(2,2);p[10]=l[5].substr(0,2);p[11]=l[5].substr(2,2);p[12]=l[6].substr(0,2);p[13]=l[6].substr(2,2);p[14]=l[7].substr(0,2);p[15]=l[7].substr(2,2);for(m=0;16>m;m++)n[m]=parseInt(p[m],16).toString(10);r=n[0];for(m=1;16>m;m++)r=r+"."+n[m];if(""===e.trap_port||void 0===e.trap_port||null===e.trap_port)e.trap_port=162;n=e.trap_port%256;m=(e.trap_port-
n)/256;n=n.toString(10);m=m.toString(10);m=r+"."+m+"."+n}else if(""!==e.trap_ip){s="1.3.6.1.6.1.1";if(""===e.trap_port||void 0===e.trap_port||null===e.trap_port)e.trap_port=162;n=e.trap_port%256;m=(e.trap_port-n)/256;m=e.trap_ip+"."+m+"."+n}l="";l="guest"===e.username?"1.3.6.1.6.3.10.1.1.1"===e.v3.guest.auth_alg?"trap_target_v3_gu_noauthnopriv":"1.3.6.1.6.3.10.1.2.1"===e.v3.guest.encryption_alg?"trap_target_v3_gu_authnopriv":"trap_target_v3_gu_authpriv":"1.3.6.1.6.3.10.1.1.1"===e.v3.admin.auth_alg?
"trap_target_v3_ad_noauthnopriv":"1.3.6.1.6.3.10.1.2.1"===e.v3.admin.encryption_alg?"trap_target_v3_ad_authnopriv":"trap_target_v3_ad_authpriv";n={snmp:{enabled:e.enabled,snmpVersions:{v1:"v1"===e.version,v2c:"v2"===e.version,v3:"v3"===e.version},"allow-access-from-wan":e.allow_access_from_wan,"allow-access-from-vpn":e.allow_access_from_vpn},"SNMPv2-MIB":{system:{sysName:e.system_name,sysContact:e.system_contact,sysLocation:e.system_location}},"SNMP-TARGET-MIB":{snmpTargetAddrTable:{snmpTargetAddrEntry:[]}}};
""!==e.trap_ip&&"v1"===e.version?n["SNMP-TARGET-MIB"].snmpTargetAddrTable.snmpTargetAddrEntry.push({snmpTargetAddrName:e.version,snmpTargetAddrTAddress:m,snmpTargetAddrTDomain:s,snmpTargetAddrParams:"target_v1",snmpTargetAddrTimeout:1500,snmpTargetAddrRetryCount:3,snmpTargetAddrTagList:"std_v1_trap std_trap std_v1_inform std_inform",snmpTargetAddrStorageType:"nonVolatile",snmpTargetAddrEngineID:e.engineID,snmpTargetAddrTMask:"",snmpTargetAddrMMS:2048}):""!==e.trap_ip&&"v2"===e.version?n["SNMP-TARGET-MIB"].snmpTargetAddrTable.snmpTargetAddrEntry.push({snmpTargetAddrName:e.version,
snmpTargetAddrTAddress:m,snmpTargetAddrTDomain:s,snmpTargetAddrParams:"target_v2",snmpTargetAddrTimeout:1500,snmpTargetAddrRetryCount:3,snmpTargetAddrTagList:"std_v2_trap std_trap std_v2_inform std_inform",snmpTargetAddrStorageType:"nonVolatile",snmpTargetAddrEngineID:e.engineID,snmpTargetAddrTMask:"",snmpTargetAddrMMS:2048}):""!==e.trap_ip&&"v3"===e.version&&(n["SNMP-TARGET-MIB"].snmpTargetAddrTable.snmpTargetAddrEntry.push({snmpTargetAddrName:"v3",snmpTargetAddrTAddress:m,snmpTargetAddrTDomain:s,
snmpTargetAddrParams:l,snmpTargetAddrTimeout:1500,snmpTargetAddrRetryCount:3,snmpTargetAddrTagList:"std_v3_trap std_trap",snmpTargetAddrStorageType:"nonVolatile",snmpTargetAddrEngineID:e.engineID,snmpTargetAddrTMask:"",snmpTargetAddrMMS:2048}),n["SNMP-TARGET-MIB"].snmpTargetAddrTable.snmpTargetAddrEntry.push({snmpTargetAddrName:"v3.inform",snmpTargetAddrTAddress:m,snmpTargetAddrTDomain:s,snmpTargetAddrParams:"inform_target_v3",snmpTargetAddrTimeout:1500,snmpTargetAddrRetryCount:3,snmpTargetAddrTagList:"std_v3_inform std_inform",
snmpTargetAddrStorageType:"nonVolatile",snmpTargetAddrEngineID:e.engineID,snmpTargetAddrTMask:"",snmpTargetAddrMMS:2048}));"v3"!==e.version&&(s=[],e.set_community&&e.get_community&&(s.push({snmpCommunityIndex:"2",snmpCommunityName:e.set_community,snmpCommunitySecurityName:"private",snmpCommunityContextEngineID:e.engineID}),s.push({snmpCommunityIndex:"1",snmpCommunityName:e.get_community,snmpCommunitySecurityName:"public",snmpCommunityContextEngineID:e.engineID})),n["SNMP-COMMUNITY-MIB"]={snmpCommunityTable:{snmpCommunityEntry:s}});
s={usmUserSecurityName:"public",usmUserEngineID:e.v3.guest.usmUserEngineID,usmUserName:e.v3.guest.usmUserName,usmUserPrivProtocol:e.v3.guest.encryption_alg,usmUserAuthProtocol:e.v3.guest.auth_alg};m={usmUserSecurityName:"admin",usmUserEngineID:e.v3.admin.usmUserEngineID,usmUserName:e.v3.admin.usmUserName,usmUserPrivProtocol:e.v3.admin.encryption_alg,usmUserAuthProtocol:e.v3.admin.auth_alg};e.v3.guest.encryption_flag&&(s.usmUserPrivKey=e.v3.guest.encryption);e.v3.guest.auth_flag&&(s.usmUserAuthKey=
e.v3.guest.auth);e.v3.admin.encryption_flag&&(m.usmUserPrivKey=e.v3.admin.encryption);e.v3.admin.auth_flag&&(m.usmUserAuthKey=e.v3.admin.auth);"v3"===e.version&&!0===a.password_flag&&(n["SNMP-USER-BASED-SM-MIB"]={usmUserTable:{usmUserEntry:[]}},"guest"===e.username?n["SNMP-USER-BASED-SM-MIB"].usmUserTable.usmUserEntry.push(s):"admin"===e.username&&n["SNMP-USER-BASED-SM-MIB"].usmUserTable.usmUserEntry.push(m));b.post({method:"set_snmp",params:n,success:function(b){a.success=!0;a.password_flag=!1;q()},
error:function(a){q()}})};a.cancel=function(){q()};a.change_auth=function(){a.password_flag=!0;a.model.d.v3[a.model.d.username].auth_flag=!0};a.change_encryption=function(){a.password_flag=!0;a.model.d.v3[a.model.d.username].encryption_flag=!0};a.check_v3_password=function(){var b=a.model.d,m=b.username,n=/^([0-9A-Fa-f]{2}:)*([0-9A-Fa-f]{2})$/;"v3"!==b.version?(a.snmpform.v3_auth.$setValidity("illegal",!0),a.snmpform.v3_encryption.$setValidity("illegal",!0)):(b.v3[m].auth||a.snmpform.v3_auth.$setValidity("illegal",
!0),b.v3[m].encryption?n.exec(b.v3[m].encryption)?a.snmpform.v3_encryption.$setValidity("illegal",!0):a.snmpform.v3_encryption.$setValidity("illegal",!1):a.snmpform.v3_encryption.$setValidity("illegal",!0),b.v3[m].auth?n.exec(b.v3[m].auth)?a.snmpform.v3_auth.$setValidity("illegal",!0):a.snmpform.v3_auth.$setValidity("illegal",!1):a.snmpform.v3_auth.$setValidity("illegal",!0))};a.change_username=function(){a.password_flag=!0;a.model.d.v3[a.model.d.username].auth="";a.model.d.v3[a.model.d.username].encryption=
""};a.change_auth_method=function(){a.password_flag=!0;a.model.d.v3[a.model.d.username].auth="";!1===a.model.d.v3[a.model.d.username].encryption_flag&&(a.model.d.v3[a.model.d.username].encryption="")};a.change_encryption_method=function(){a.password_flag=!0;!1===a.model.d.v3[a.model.d.username].auth_flag&&(a.model.d.v3[a.model.d.username].auth="");a.model.d.v3[a.model.d.username].encryption=""};a.checkTrapPort=function(){a.trapPortFlag=!1;null!==a.model.d.trap_port&&void 0===a.model.d.trap_port&&
(a.trapPortFlag=!0)};q()}]);app.controller("PnPCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight",function(a,b,t,m,w){a.success=!1;a.dataReady=!1;var u=app.TOOLS.getResponse;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var p=function(){return b.post({url:resource_base+"data/get_pnp_enabled_static.json",method:"get_pnp",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},q=function(){return b.post({url:resource_base+"data/cert2.json",procBackground:!0,
method:"get_ca_cert",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},e=function(b){b||(b={});var e=[];b["certs-state"]&&b["certs-state"].cert&&(e=b["certs-state"].cert);a.model.ca=[{id:"%default",displayName:a.DICT("PnP_Pre_Installed_CA_Bundles")}];angular.forEach(e,function(b){b.info&&b.info["is-ca-enabled"]&&a.model.ca.push({id:b.name,displayName:b.name})})},x=function(){t.all([p()]).then(function(b){(b=u(b,0))||(b={});var e={},m=!0;b.pnp&&(void 0!==b.pnp.enabled&&
(m=b.pnp.enabled),b.pnp.transport&&(e=b.pnp.transport));a.model.pnp={enabled:m,mode:"auto",type:e.type||"https",type_str:"-",address:e.address||"",port:e.port||443,ca_cert:"",orig_ca_cert:e["ca-certificate"]||"%default"};switch(a.model.pnp.type){case "https":a.model.pnp.type_str=a.DICT("PnP_HTTPS_Only")}switch(e.mode){case "static":a.model.pnp.mode="static"}n();a.resetModified();a.dataReady=!0})},n=function(){var b=!1,e=a.model.pnp.orig_ca_cert;a.getting_ca||!a.model.pnp.orig_ca_cert?a.model.pnp.ca_cert=
"":(angular.forEach(a.model.ca,function(a){a.id===e&&(b=!0)}),a.model.pnp.ca_cert=b?e:"%default")};a.schema={pnp_trans:[{id:"auto",displayName:a.DICT("PnP_Auto")},{id:"static",displayName:a.DICT("PnP_Static")}]};a.model={pnp:{},ca:[]};a.funs={save:function(){var e=a.model.pnp,n={mode:e.mode,port:e.port};switch(e.mode){case "static":$.extend(n,{type:"https",address:e.address,"ca-certificate":"%default"===e.ca_cert?"":e.ca_cert})}b.post({url:resource_base+"jsonrpc",method:"set_pnp",forcedUsingPost:!0,
params:{pnp:{enabled:e.enabled,transport:n}},success:function(b){a.success=!0;x()},error:function(a){x()}})},cancel:function(){x()}};(function(){a.getting_ca=!0;t.all([q()]).then(function(b){e(u(b,0));a.getting_ca=!1;n()})})();x()}]);app.controller("setupWizardCtrl",["$scope","MyHttp","wan_lib","$q","$cookies","UserSession","userAccessRight","$location","modelInfo","ngDialog","dt",function(a,b,t,m,w,u,p,q,e,x,n){var l=app.TOOLS.int2str2;a.board_current_date="";a.board_timezone="";a.userAccessFlag=p.get();a.destroy=!1;a.subnetObj={};a.ruFlag=p.russia();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();var r=function(b){var c=app.TOOLS.get_scope("WizardCtrl");c&&c.funs.close_setup_wizard();b&&app.TOOLS.successAlertBox({title:a.DICT("Success"),
msg:a.DICT("Initial_Setup_Wizard_Setup_Success"),cbk:function(){app.TOOLS.jumpToPage("Status_System_Stats")}})},v=function(b){b||(b=[]);var c;a.model.intf_state={WAN1:{state:"down",phys_address:""},WAN2:{state:"down",phys_address:""}};var d="down";angular.forEach(b,function(b){d="down";c="";b.name&&b.name.match(/^WAN/)&&("WAN_PORT1"===b.name?c="WAN1":"WAN_PORT2"===b.name&&(c="WAN2"),c&&("Connected"===b.link_status&&(d="up"),a.model.intf_state[c].state=d),"WAN1"===b.name&&b.phys_address?a.model.intf_state.WAN1.phys_address=
b.phys_address:"WAN2"===b.name&&b.phys_address&&(a.model.intf_state.WAN2.phys_address=b.phys_address))})},s=function(){return b.post({url:resource_base+"data/aaa.json",method:"get_subnet",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},k=function(b){b.data&&(b.data.result&&b.data.result.subnets&&b.data.result.subnets.ipv4&&b.data.result.subnets.ipv6)&&(a.subnetObj=angular.copy(b.data.result.subnets))},d=function(){var b={},c=[{name:a.DICT("Initial_Setup_Wizard_Welcome"),
templateUrl:"step0.html"},{name:a.DICT("Initial_Setup_Wizard_Check_Connection_Order"),templateUrl:"step1.html"},{name:a.DICT("Initial_Setup_Wizard_Configure_Router"),templateUrl:"step2.html"},{name:a.DICT("Initial_Setup_Wizard_Configure_Router"),templateUrl:"step3.html"},{name:a.DICT("Initial_Setup_Wizard_Configure_Router"),templateUrl:"step4.html"},{name:a.DICT("Initial_Setup_Wizard_Configure_Router"),templateUrl:"step5.html"},{name:a.DICT("Initial_Setup_Wizard_Enable_Security"),templateUrl:"step6.html"},
{name:a.DICT("Initial_Setup_Wizard_Enable_Security"),templateUrl:"step7.html"}];a.model.has_wifi&&(c.push({name:a.DICT("Initial_Setup_Wizard_Enable_Security"),templateUrl:"step8.html"}),c.push({name:a.DICT("Initial_Setup_Wizard_Enable_Security"),templateUrl:"step9.html"}),c.push({name:a.DICT("Initial_Setup_Wizard_Enable_Security"),templateUrl:"step10.html"}));b={title:a.DICT("Initial_Setup_Wizard"),model:a.model,list:c,date:a.date};x.open({template:"setup_wizard_dialog.html",closeByDocument:!1,className:"ngdialog-theme-default wizard-page",
resolve:{obj:function(){return b}},controller:"setup_wizard_dialog_ctrl",preCloseCallback:function(b){!("$closeButton"===b||"close"===b)?a.funs.submit(b):r(!1)}});a.dataReady=!0},c=function(){return b.post({url:resource_base+"data/time.json",method:"get_time",error:function(a){Log(ERROR,"timeCtrl getData Error status: "+a.status)}})},h=function(){return b.post({url:resource_base+"data/time.json",method:"get_wifi_settings",error:function(a){Log(ERROR,"ssidCtrl getData Error status: "+a.status)}})},
g=function(b){b&&(b=b&&b.data&&b.data.result||{},a.board_current_date=b&&b["system-state"]&&b["system-state"].clock["current-datetime"]||"",a.board_timezone=b&&b.system&&b.system.clock["timezone-name"]||"",b=n.parser(a.board_current_date),a.model.d.current_datatime=new Date(b.year,b.month,b.day),a.model.d.hour=b.hour,a.model.d.minute=b.minute,a.model.d.second=b.second,a.model.d.timezone=a.board_timezone)},A=function(b){b&&(b=b&&b.data&&b.data.result||{},a.model.d.ssid=b.wlans&&b.wlans.ssid||{})},
y=function(){a.dataReady=!1;a.model.d=z();a.model.d.intf_status="loading";m.all([t.init({full_configure:!0}),t.get_wan_state(),c(),s(),h()]).then(function(b){v(b[1]||[]);angular.forEach(b[0][0],function(b){"WAN1"===b.name?a.model.d.orig_wan.wan1=b:"WAN2"===b.name&&(a.model.d.orig_wan.wan2=b)});a.model.pc_mac=b[0][2];g(b[2]);k(b[3]);A(b[4]);d()})},z=function(){for(var b=t.gen_wan_settings({name:"WAN1"}),c=new Date,d="1"===w.get("disable-startup"),g=c.getHours(),h=c.getMinutes(),e=c.getSeconds(),k=
a.model.schema.timezone[0]&&a.model.schema.timezone[0].tz||"",l="",n=0;8>n;n++)var m=Math.floor(68*Math.random()),l=l+"abcdefghijklmnopqrstuvwxyz!@#$%^&*()-+<>/\\ABCDEFGHIJKLMNOP1234567890".charAt(m);c={not_show_on_start_up:d,intf_status:"loading",wan:{},orig_wan:{},hour:g,minute:h,second:e,timezone:k,time_type:!0,current_datatime:c,mac_type:"default",custom_mac:"",router_password:"",confirm_router_password:"",disable_password_strength:!1,keep_current_password:!1,network_name:"",security_type:"aes",
security_key:l};b.ipv4.setting.confirm_password="";c.wan=b;return c};a.pageMap={};a.currPage=1;a.dataReady=!1;a.model={has_wifi:e.spec_WifiSupport(),intf_state:{},d:{},schema:{}};var B=function(c){var d=a.model.d;b.post({method:"set_time",params:{gui:{"disable-startup-page":d.not_show_on_start_up},system:{clock:{"timezone-name":d.timezone},ntp:{enabled:d.time_type}}},success:function(a){Log(DEBUG,"set time success");n.setTimezoneName(d.timezone);"function"===$.type(c)&&c()},error:function(a){Log(ERROR,
"set time error");Log(ERROR,a);"function"===$.type(c)&&c()}})},D=function(c){var d=a.model.d,g;!1===d.time_type?(g=d.hour,angular.forEach(Timezone,function(a){}),d=d.current_datatime.getYear()+1900+"-"+l(d.current_datatime.getMonth()+1)+"-"+l(d.current_datatime.getDate())+"T"+l(parseInt(g,10))+":"+l(parseInt(d.minute,10))+":"+l(parseInt(d.second,10)),b.post({method:"action",params:{rpc:"set-current-datetime",input:{"current-datetime":d}},success:function(a){Log(DEBUG,"set current datetime success");
"function"===$.type(c)&&c()},error:function(a){Log(INFO,"set current datetime error, should be skip");Log(INFO,a);"function"===$.type(c)&&c()}})):"function"===$.type(c)&&c()},E=function(){var c=a.model.d;c.keep_current_password?r(!0):b.post({method:"set_password_complexity",params:{"password-complexity":{enabled:!c.disable_password_strength}},success:function(a){C()},error:function(a){Log(ERROR,"set complexity error");Log(ERROR,a)}})},C=function(){var c=a.model.d,d=w.get("user");b.post({method:"change_password",
params:{name:d,password:c.router_password},success:function(b){if(b=b.data.result.code)switch(b){case 0:r(!0);break;case 1:app.TOOLS.successAlertBox({title:a.DICT("Success"),width:490,msg:a.DICT("Initial_Setup_Wizard_Setup_Success")+"<br/>"+a.DICT("Initial_Setup_Wizard_Need_Logout"),cbk:function(){u.logout();app.transition.In()}});break;default:app.TOOLS.criticalAlertBox({title:a.DICT("Failure"),msg:a.DICT("Initial_Setup_Wizard_New_Password_Incorrect"),cbk:function(b){b&&(a.currPage=8,a.resetModified())}})}},
error:function(a){Log(ERROR,"set user error");Log(ERROR,a)}})},I=function(){var c=a.model.d,d=c.ssid;app.TOOLS.get_scope("WizardCtrl");var g=!c.disable_password_strength&&""===c.router_password?!0:!1;d[0]||(d[0]={});d[0].ssid=c.network_name;d[0].enable=!0;"aes"===c.security_type?(d[0].security={"mode-enabled":"WPA2-Personal","WPA2-Personal":{"key-passphrase":c.security_key}},d[0].pmf="capable"):"no_security"===c.security_type&&(d[0].security={"mode-enabled":"None"},d[0].pmf="not-required");b.post({method:"set_wifi_settings",
params:{wlans:{ssid:d}},success:function(a){g?r(!0):E()},error:function(a){Log(ERROR,"set ssid error");Log(ERROR,a);r(!1)}})};a.funs={next:function(){switch(a.currPage){case 3:a.currPage="dynamic"===a.model.d.wan.ipv4.connectType?a.currPage+2:a.currPage+1;break;case 5:"custom"!==a.model.d.mac_type&&(a.model.d.custom_mac="");a.currPage+=1;break;default:a.currPage+=1}},back:function(){switch(a.currPage){case 5:a.currPage="dynamic"===a.model.d.wan.ipv4.connectType?a.currPage-2:a.currPage-1;break;case 3:a.currPage-=
1;break;default:a.currPage-=1}},cancel:function(){a.currPage=1;y();a.resetModified()},submit:function(b){var c=b.d.wan,d=b.d.orig_wan.wan1,g=b.d;a.model=b;Log(DEBUG,"Press submit");"WAN2"===g.wan.intf&&(d=a.model.d.orig_wan.wan2);"pc"===g.mac_type&&(c.mac_address_clone=!0,c.mac_address=a.model.pc_mac);"custom"===g.mac_type&&(c.mac_address_clone=!0,c.mac_address=a.model.d.custom_mac);switch(g.wan.ipv4.connectType){case "pptp":case "l2tp":g.wan.ipv4.physical="static"}g.wan.ipv4.setting.selectDemand=
!1;g.wan.ipv6=d.ipv6;g.wan.ipv4.setting.naming_server.servers[0].length&&(g.wan.ipv4.setting.peerdns=!1);D(function(){B(function(){m.all([t.set_wan_interface({orig:d,edit:c})]).then(function(b){w.put("disable-startup",g.not_show_on_start_up?"1":"0");app.TOOLS.get_scope("headerCtrl").enable_save_warning();a.model.has_wifi?I():E()})})})},done:function(){I()}};a.date={format:"yyyy-MM-dd",options:{formatYear:"yyyy",startingDay:0},disabled:function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},
importPCTime:function(){var b=new Date,c=b.getHours(),d=b.getMinutes();a.model.d.current_datatime=b;a.model.d.hour=c;a.model.d.minute=d;a.model.d.second=b.getSeconds()},minDate:null,opened:!1,open:function(){this.opened=!0}};(function(){var b,c,d={},g=[];a.pageMap=a.model.has_wifi?{1:"welcome",2:"check_connection",3:"connection_type",4:"setup_wan_proto",5:"date_time",6:"mac_address",7:"wan_summary",8:"set_security",9:"network_name",10:"wireless_network",11:"wireless_summary"}:{1:"welcome",2:"check_connection",
3:"connection_type",4:"setup_wan_proto",5:"date_time",6:"mac_address",7:"wan_summary",8:"set_security"};a.model.schema={intfs:[{id:"WAN1",displayName:"WAN1"},{id:"WAN2",displayName:"WAN2"}],timezone:[],hours:[],minutes:[],seconds:[]};for(b=0;24>b;b++)a.model.schema.hours.push({id:b,displayName:l(b)});for(b=0;60>b;b++)a.model.schema.minutes.push({id:b,displayName:l(b)}),a.model.schema.seconds.push({id:b,displayName:l(b)});Timezone.sort(function(a,b){return a.offset<b.offset?-1:a.offset>b.offset?1:
a.display<b.display?-1:a.display>b.display?1:0});angular.forEach(Timezone,function(a,b){a.is_cisco&&!d[a.cisco_display]&&(c=a.offset+1E3,g[c]||(g[c]=[]),d[a.cisco_display]=!0,g[c].push({tz:a.tz,display:a.cisco_display,offset:a.offset}))});a.model.schema.timezone=[];angular.forEach(g,function(b){b&&(b.sort(function(a,b){var c=a.display.match(/^\(UTC .\d+:\d+. (.*)/),d=b.display.match(/^\(UTC .\d+:\d+. (.*)/),c=c&&c[1]||"",d=d&&d[1]||"";return!c||!d?0:c<d?-1:c>d?1:0}),a.model.schema.timezone=a.model.schema.timezone.concat(b))})})();
y()}]);
app.controller("setup_wizard_dialog_ctrl",["$scope","addressPoolValidate","obj","wan_lib","userAccessRight","$q",function(a,b,t,m,w,u){var p=0;a.ruFlag=w.russia();var q=function(b){a.show_skip_btn=b.canSkip?!0:!1;a.show_submit_btn=a.current_step===a.step_list.length-1?!0:!1},e=function(){0!==p&&clearTimeout(p);app.TOOLS.get_scope("setupWizardCtrl")&&!a.destroy&&(1<a.current_step||(p=setTimeout(function(){p=0;u.all([m.get_wan_state({background:!0,isPolling:!0})]).then(function(b){x(b[0]||[]);a.change_interface();
e()})},5E3)))},x=function(b){b||(b=[]);var e;a.model.intf_state={WAN1:{state:"down",phys_address:""},WAN2:{state:"down",phys_address:""}};var m="down";angular.forEach(b,function(b){m="down";e="";b.name&&b.name.match(/^WAN/)&&("WAN_PORT1"===b.name?e="WAN1":"WAN_PORT2"===b.name&&(e="WAN2"),e&&("Connected"===b.link_status&&(m="up"),a.model.intf_state[e].state=m),"WAN1"===b.name&&b.phys_address?a.model.intf_state.WAN1.phys_address=b.phys_address:"WAN2"===b.name&&b.phys_address&&(a.model.intf_state.WAN2.phys_address=
b.phys_address))})};a.model=t.model;a.date=t.date;a.step_list=t.list||[];a.title=t.title||"";a.current_step=0;a.show_skip_btn=!1;a.show_submit_btn=!1;a.destroy=!1;a.errstr={network_name:""};a.ui_data={date_time_manually:a.DICT("Initial_Setup_Wizard_Set_Date_Time_Manually",{"%s":'<a ng-click="date.importPCTime()">'+a.DICT("Here")+"</a>"})};a.protoMap={dynamic:"DHCP","static":"Static IP Address",pppoe:"PPPoE",l2tp:"L2TP",pptp:"PPTP"};a.change_complexity=function(){a.model.d.disable_password_strength&&
app.TOOLS.warningAlertBox({msg:"Disabling password strength enforcement will increase your network security risk. Are you sure you want to disable password strength?",cbk:function(b){!1===b&&(a.model.d.disable_password_strength=!a.model.d.disable_password_strength)}})};a.ipv4Vali=function(){var e=!0,e=angular.copy(a.subnetObj.ipv4);return void 0===a.model.d.wan.ipv4.address.ip||""===a.model.d.wan.ipv4.address.ip||void 0===a.model.d.wan.ipv4.address.netmask||""===a.model.d.wan.ipv4.address.netmask||
void 0===e?!0:e=b.poolMaskValidate("wan",a.model.d.wan.intf,"ipv4",a.subnetObj,a.model.d.wan.ipv4.address.ip,a.model.d.wan.ipv4.address.netmask)};a.change_interface=function(){a.model.d.intf_status=a.model.intf_state[a.model.d.wan.intf].state;a.model.phys_address=a.model.intf_state[a.model.d.wan.intf].phys_address};a.check_password=function(){var b=a.model.d.wan.ipv4.setting;b.changed_password=!0;void 0==b.password||!b.password.length&&!b.confirm_password.length?(a.wizardform.password.$setValidity("not_same",
!0),a.wizardform.confirm_password.$setValidity("not_same",!0)):b.password!==b.confirm_password?(a.wizardform.password.$setValidity("not_same",!1),a.wizardform.confirm_password.$setValidity("not_same",!1)):(a.wizardform.password.$setValidity("not_same",!0),a.wizardform.confirm_password.$setValidity("not_same",!0))};a.chk_network_name=function(){var b=a.model.d,e=!1;angular.forEach(b.ssid,function(a){a.ssid===b.network_name&&(e=!0)});a.wizardform.step8.txt_netname.$setValidity("repeated",!e);a.errstr.network_name=
"Network Name(SSID): "+b.network_name+" already be used. Please input another name."};a.next=function(){var b=a.model.d.wan,e=0;switch(a.current_step){case 2:"dynamic"===b.ipv4.connectType&&(e=1)}a.current_step<a.step_list.length&&(a.current_step=a.current_step+1+e,q(a.step_list[a.current_step]))};a.back=function(){var b=a.model.d.wan,e=0;switch(a.current_step){case 4:"dynamic"===b.ipv4.connectType&&(e=-1)}0<a.current_step&&(a.current_step=a.current_step-1+e,q(a.step_list[a.current_step]))};a.submit=
function(){a.destroy=!0;a.closeThisDialog(a.model)};a.cancel=function(){a.destroy=!0;a.closeThisDialog("close")};a.$on("$destroy",function(){a.destroy=!0});e();a.change_interface()}]);var Timezone=[{tz:"Africa/Abidjan",display:"Africa/Abidjan",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Accra",display:"Africa/Accra",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Addis_Ababa",display:"Africa/Addis Ababa",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Algiers",display:"Africa/Algiers",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Asmara",display:"Africa/Asmara",
offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Asmera",display:"Africa/Asmera",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Bamako",display:"Africa/Bamako",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Bangui",display:"Africa/Bangui",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Banjul",display:"Africa/Banjul",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,
cisco_display:""},{tz:"Africa/Bissau",display:"Africa/Bissau",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Blantyre",display:"Africa/Blantyre",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Brazzaville",display:"Africa/Brazzaville",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Bujumbura",display:"Africa/Bujumbura",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Cairo",
display:"Africa/Cairo",offset:120,isdst:!1,abbr:"EET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Cairo"},{tz:"Africa/Casablanca",display:"Africa/Casablanca",offset:0,isdst:!0,abbr:"WET",abbr_dst:"WEST",is_cisco:!0,cisco_display:"(UTC +00:00) Casablanca"},{tz:"Africa/Ceuta",display:"Africa/Ceuta",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Conakry",display:"Africa/Conakry",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Dakar",
display:"Africa/Dakar",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Dar_es_Salaam",display:"Africa/Dar es_Salaam",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Djibouti",display:"Africa/Djibouti",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Douala",display:"Africa/Douala",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/El_Aaiun",display:"Africa/El Aaiun",offset:0,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Freetown",display:"Africa/Freetown",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Gaborone",display:"Africa/Gaborone",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Harare",display:"Africa/Harare",offset:120,isdst:!1,abbr:"CAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Harare, Pretoria"},{tz:"Africa/Johannesburg",display:"Africa/Johannesburg",offset:120,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Juba",display:"Africa/Juba",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Kampala",display:"Africa/Kampala",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Khartoum",display:"Africa/Khartoum",offset:120,isdst:!1,abbr:"CAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Khartoum"},{tz:"Africa/Kigali",display:"Africa/Kigali",offset:120,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Africa/Kinshasa",display:"Africa/Kinshasa",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Lagos",display:"Africa/Lagos",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Libreville",display:"Africa/Libreville",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Lome",display:"Africa/Lome",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Luanda",
display:"Africa/Luanda",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Lubumbashi",display:"Africa/Lubumbashi",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Lusaka",display:"Africa/Lusaka",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Malabo",display:"Africa/Malabo",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Maputo",display:"Africa/Maputo",offset:120,isdst:!1,
abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Maseru",display:"Africa/Maseru",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Mbabane",display:"Africa/Mbabane",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Mogadishu",display:"Africa/Mogadishu",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Monrovia",display:"Africa/Monrovia",offset:0,isdst:!1,abbr:"UTC",abbr_dst:"",is_cisco:!0,
cisco_display:"(UTC +00:00) Monrovia, Reykjavik"},{tz:"Africa/Nairobi",display:"Africa/Nairobi",offset:180,isdst:!1,abbr:"EAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Nairobi"},{tz:"Africa/Ndjamena",display:"Africa/Ndjamena",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Niamey",display:"Africa/Niamey",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Nouakchott",display:"Africa/Nouakchott",offset:0,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Africa/Ouagadougou",display:"Africa/Ouagadougou",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Porto-Novo",display:"Africa/Porto-Novo",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Sao_Tome",display:"Africa/Sao Tome",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Timbuktu",display:"Africa/Timbuktu",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Africa/Tripoli",display:"Africa/Tripoli",offset:120,isdst:!1,abbr:"EET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Tripoli"},{tz:"Africa/Tunis",display:"Africa/Tunis",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Windhoek",display:"Africa/Windhoek",offset:120,isdst:!0,abbr:"CAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Windhoek"},{tz:"America/Adak",display:"America/Adak",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Anchorage",display:"America/Anchorage",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Anguilla",display:"America/Anguilla",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Antigua",display:"America/Antigua",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Araguaina",display:"America/Araguaina",offset:-180,isdst:!1,abbr:"BRT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Araguaina"},
{tz:"America/Argentina/Buenos_Aires",display:"America/Argentina/Buenos Aires",offset:-180,isdst:!1,abbr:"ART",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) City of Buenos Aires"},{tz:"America/Argentina/Catamarca",display:"America/Argentina/Catamarca",offset:-180,isdst:!0,abbr:"WGT",abbr_dst:"WGST",is_cisco:!0,cisco_display:"(UTC -03:00) Greenland"},{tz:"America/Argentina/ComodRivadavia",display:"America/Argentina/ComodRivadavia",offset:-180,isdst:!1,abbr:"CLST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Punta Arenas"},
{tz:"America/Argentina/Cordoba",display:"America/Argentina/Cordoba",offset:-180,isdst:!1,abbr:"BRT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Salvador"},{tz:"America/Argentina/Jujuy",display:"America/Argentina/Jujuy",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/La_Rioja",display:"America/Argentina/La Rioja",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/Mendoza",display:"America/Argentina/Mendoza",
offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/Rio_Gallegos",display:"America/Argentina/Rio Gallegos",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/Salta",display:"America/Argentina/Salta",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/San_Juan",display:"America/Argentina/San Juan",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/San_Luis",
display:"America/Argentina/San Luis",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/Tucuman",display:"America/Argentina/Tucuman",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/Ushuaia",display:"America/Argentina/Ushuaia",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Aruba",display:"America/Aruba",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Asuncion",display:"America/Asuncion",offset:-240,isdst:!0,abbr:"PYT",abbr_dst:"PYST",is_cisco:!0,cisco_display:"(UTC -04:00) Asuncion"},{tz:"America/Atikokan",display:"America/Atikokan",offset:-300,isdst:!0,abbr:"EST",abbr_dst:"EDT",is_cisco:!0,cisco_display:"(UTC -05:00) Turks and Caicos"},{tz:"America/Atka",display:"America/Atka",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Bahia",display:"America/Bahia",offset:-180,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"America/Bahia_Banderas",display:"America/Bahia Banderas",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Barbados",display:"America/Barbados",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Belem",display:"America/Belem",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Belize",display:"America/Belize",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Blanc-Sablon",display:"America/Blanc-Sablon",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Boa_Vista",display:"America/Boa Vista",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Bogota",display:"America/Bogota",offset:-300,isdst:!1,abbr:"COT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -05:00) Bogota, Lima, Quito, Rio Branco"},{tz:"America/Boise",display:"America/Boise",offset:-420,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"America/Buenos_Aires",display:"America/Buenos Aires",offset:-180,isdst:!1,abbr:"ART",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) City of Buenos Aires"},{tz:"America/Cambridge_Bay",display:"America/Cambridge Bay",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Campo_Grande",display:"America/Campo Grande",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Cancun",display:"America/Cancun",
offset:-300,isdst:!1,abbr:"EST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -05:00) Chetumal"},{tz:"America/Caracas",display:"America/Caracas",offset:-240,isdst:!1,abbr:"VET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -04:00) Caracas"},{tz:"America/Catamarca",display:"America/Catamarca",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Cayenne",display:"America/Cayenne",offset:-180,isdst:!1,abbr:"GFT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Cayenne, Fortaleza"},
{tz:"America/Cayman",display:"America/Cayman",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Chicago",display:"America/Chicago",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Chihuahua",display:"America/Chihuahua",offset:-420,isdst:!0,abbr:"MST",abbr_dst:"MDT",is_cisco:!0,cisco_display:"(UTC -07:00) Chihuahua, La Paz, Mazatlan"},{tz:"America/Coral_Harbour",display:"America/Coral Harbour",offset:-300,isdst:!0,abbr:"EST",abbr_dst:"EDT",
is_cisco:!0,cisco_display:"(UTC -05:00) Haiti"},{tz:"America/Cordoba",display:"America/Cordoba",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Costa_Rica",display:"America/Costa Rica",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Creston",display:"America/Creston",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Cuiaba",display:"America/Cuiaba",offset:-240,isdst:!0,abbr:"AMT",abbr_dst:"AMST",
is_cisco:!0,cisco_display:"(UTC -04:00) Cuiaba"},{tz:"America/Curacao",display:"America/Curacao",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Danmarkshavn",display:"America/Danmarkshavn",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Dawson",display:"America/Dawson",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Dawson_Creek",display:"America/Dawson Creek",offset:-420,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"America/Denver",display:"America/Denver",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Detroit",display:"America/Detroit",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Dominica",display:"America/Dominica",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Edmonton",display:"America/Edmonton",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Eirunepe",display:"America/Eirunepe",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/El_Salvador",display:"America/El Salvador",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Ensenada",display:"America/Ensenada",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Fort_Nelson",display:"America/Fort Nelson",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Fort_Wayne",
display:"America/Fort Wayne",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Fortaleza",display:"America/Fortaleza",offset:-180,isdst:!1,abbr:"GFT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Cayenne, Fortaleza"},{tz:"America/Glace_Bay",display:"America/Glace Bay",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Godthab",display:"America/Godthab",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Goose_Bay",
display:"America/Goose Bay",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Grand_Turk",display:"America/Grand Turk",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Grenada",display:"America/Grenada",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Guadeloupe",display:"America/Guadeloupe",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Guatemala",display:"America/Guatemala",
offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Guayaquil",display:"America/Guayaquil",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Guyana",display:"America/Guyana",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Halifax",display:"America/Halifax",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Havana",display:"America/Havana",offset:-300,isdst:!0,abbr:"CST",
abbr_dst:"CDT",is_cisco:!0,cisco_display:"(UTC -05:00) Havana"},{tz:"America/Hermosillo",display:"America/Hermosillo",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Indianapolis",display:"America/Indiana/Indianapolis",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Knox",display:"America/Indiana/Knox",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Marengo",display:"America/Indiana/Marengo",
offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Petersburg",display:"America/Indiana/Petersburg",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Tell_City",display:"America/Indiana/Tell City",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Vevay",display:"America/Indiana/Vevay",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Vincennes",
display:"America/Indiana/Vincennes",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Winamac",display:"America/Indiana/Winamac",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indianapolis",display:"America/Indianapolis",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Inuvik",display:"America/Inuvik",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Iqaluit",
display:"America/Iqaluit",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Jamaica",display:"America/Jamaica",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Jujuy",display:"America/Jujuy",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Juneau",display:"America/Juneau",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Kentucky/Louisville",display:"America/Kentucky/Louisville",
offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Kentucky/Monticello",display:"America/Kentucky/Monticello",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Knox_IN",display:"America/Knox IN",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Kralendijk",display:"America/Kralendijk",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/La_Paz",display:"America/La Paz",
offset:-240,isdst:!1,abbr:"GYT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -04:00) Georgetown, La Paz, Manaus, San Juan"},{tz:"America/Lima",display:"America/Lima",offset:-300,isdst:!1,abbr:"COT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -05:00) Bogota, Lima, Quito, Rio Branco"},{tz:"America/Los_Angeles",display:"America/Los Angeles",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Louisville",display:"America/Louisville",offset:-300,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"America/Lower_Princes",display:"America/Lower Princes",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Maceio",display:"America/Maceio",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Managua",display:"America/Managua",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Manaus",display:"America/Manaus",offset:-240,isdst:!1,abbr:"GYT",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Marigot",display:"America/Marigot",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Martinique",display:"America/Martinique",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Matamoros",display:"America/Matamoros",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Mazatlan",display:"America/Mazatlan",offset:-420,isdst:!0,abbr:"MST",abbr_dst:"MDT",is_cisco:!0,cisco_display:"(UTC -07:00) Chihuahua, La Paz, Mazatlan"},
{tz:"America/Mendoza",display:"America/Mendoza",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Menominee",display:"America/Menominee",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Merida",display:"America/Merida",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Metlakatla",display:"America/Metlakatla",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Mexico_City",
display:"America/Mexico City",offset:-360,isdst:!0,abbr:"CST",abbr_dst:"CDT",is_cisco:!0,cisco_display:"(UTC -06:00) Guadalajara, Mexico City, Monterrey"},{tz:"America/Miquelon",display:"America/Miquelon",offset:-180,isdst:!0,abbr:"PMST",abbr_dst:"PMDT",is_cisco:!0,cisco_display:"(UTC -03:00) Saint Pierre and Miquelon"},{tz:"America/Moncton",display:"America/Moncton",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Monterrey",display:"America/Monterrey",offset:-360,
isdst:!0,abbr:"CST",abbr_dst:"CDT",is_cisco:!0,cisco_display:"(UTC -06:00) Guadalajara, Mexico City, Monterrey"},{tz:"America/Montevideo",display:"America/Montevideo",offset:-180,isdst:!1,abbr:"UYT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Montevideo"},{tz:"America/Montreal",display:"America/Montreal",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Montserrat",display:"America/Montserrat",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Nassau",display:"America/Nassau",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/New_York",display:"America/New York",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Nipigon",display:"America/Nipigon",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Nome",display:"America/Nome",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Noronha",display:"America/Noronha",
offset:-120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/North_Dakota/Beulah",display:"America/North Dakota/Beulah",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/North_Dakota/Center",display:"America/North Dakota/Center",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/North_Dakota/New_Salem",display:"America/North Dakota/New_Salem",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Ojinaga",display:"America/Ojinaga",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Panama",display:"America/Panama",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Pangnirtung",display:"America/Pangnirtung",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Paramaribo",display:"America/Paramaribo",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Phoenix",
display:"America/Phoenix",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Port_of_Spain",display:"America/Port of_Spain",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Port-au-Prince",display:"America/Port-au-Prince",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Porto_Acre",display:"America/Porto Acre",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Porto_Velho",
display:"America/Porto Velho",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Puerto_Rico",display:"America/Puerto Rico",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Rainy_River",display:"America/Rainy River",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Rankin_Inlet",display:"America/Rankin Inlet",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Recife",
display:"America/Recife",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Regina",display:"America/Regina",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Resolute",display:"America/Resolute",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Rio_Branco",display:"America/Rio Branco",offset:-300,isdst:!1,abbr:"COT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -05:00) Bogota, Lima, Quito, Rio Branco"},
{tz:"America/Rosario",display:"America/Rosario",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Santa_Isabel",display:"America/Santa Isabel",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Santarem",display:"America/Santarem",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Santiago",display:"America/Santiago",offset:-240,isdst:!0,abbr:"CLT",abbr_dst:"CLST",is_cisco:!0,cisco_display:"(UTC -04:00) Santiago"},
{tz:"America/Santo_Domingo",display:"America/Santo Domingo",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Sao_Paulo",display:"America/Sao Paulo",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Scoresbysund",display:"America/Scoresbysund",offset:-60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Shiprock",display:"America/Shiprock",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Sitka",display:"America/Sitka",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Barthelemy",display:"America/St Barthelemy",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Johns",display:"America/St Johns",offset:-210,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Kitts",display:"America/St Kitts",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Lucia",
display:"America/St Lucia",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Thomas",display:"America/St Thomas",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Vincent",display:"America/St Vincent",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Swift_Current",display:"America/Swift Current",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Tegucigalpa",
display:"America/Tegucigalpa",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Thule",display:"America/Thule",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Thunder_Bay",display:"America/Thunder Bay",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Tijuana",display:"America/Tijuana",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Toronto",display:"America/Toronto",
offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Tortola",display:"America/Tortola",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Vancouver",display:"America/Vancouver",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Virgin",display:"America/Virgin",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Whitehorse",display:"America/Whitehorse",offset:-480,isdst:!1,
abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Winnipeg",display:"America/Winnipeg",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Yakutat",display:"America/Yakutat",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Yellowknife",display:"America/Yellowknife",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Casey",display:"Antarctica/Casey",offset:660,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Antarctica/Davis",display:"Antarctica/Davis",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/DumontDUrville",display:"Antarctica/DumontDUrville",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Macquarie",display:"Antarctica/Macquarie",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Mawson",display:"Antarctica/Mawson",offset:300,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Antarctica/McMurdo",display:"Antarctica/McMurdo",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Palmer",display:"Antarctica/Palmer",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Rothera",display:"Antarctica/Rothera",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/South_Pole",display:"Antarctica/South Pole",offset:720,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Antarctica/Syowa",display:"Antarctica/Syowa",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Troll",display:"Antarctica/Troll",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Vostok",display:"Antarctica/Vostok",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Arctic/Longyearbyen",display:"Arctic/Longyearbyen",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Asia/Aden",display:"Asia/Aden",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Pyongyang",display:"Asia/Pyongyang",offset:510,isdst:!1,abbr:"PYT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:30) Pyongyang"},{tz:"Asia/Almaty",display:"Asia/Almaty",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Amman",display:"Asia/Amman",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Amman"},{tz:"Asia/Anadyr",
display:"Asia/Anadyr",offset:720,isdst:!1,abbr:"ANAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +12:00) Anadyr, Petropavlovsk-Kamchatsky"},{tz:"Asia/Aqtau",display:"Asia/Aqtau",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Aqtobe",display:"Asia/Aqtobe",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Ashgabat",display:"Asia/Ashgabat",offset:300,isdst:!1,abbr:"TMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:00) Ashgabat, Tashkent"},
{tz:"Asia/Ashkhabad",display:"Asia/Ashkhabad",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Atyrau",display:"Asia/Atyrau",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Baghdad",display:"Asia/Baghdad",offset:180,isdst:!1,abbr:"AST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Baghdad"},{tz:"Asia/Bahrain",display:"Asia/Bahrain",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Baku",display:"Asia/Baku",
offset:240,isdst:!1,abbr:"AZT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Baku"},{tz:"Asia/Bangkok",display:"Asia/Bangkok",offset:420,isdst:!1,abbr:"ICT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Bangkok, Hanoi, Jakarta"},{tz:"Asia/Barnaul",display:"Asia/Barnaul",offset:420,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Barnaul, Gorno-Altaysk"},{tz:"Asia/Beirut",display:"Asia/Beirut",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Beirut"},
{tz:"Asia/Bishkek",display:"Asia/Bishkek",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Brunei",display:"Asia/Brunei",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Calcutta",display:"Asia/Calcutta",offset:330,isdst:!1,abbr:"IST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:30) Sri Jayawardenapura"},{tz:"Asia/Chita",display:"Asia/Chita",offset:540,isdst:!1,abbr:"YAKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:00) Chita"},
{tz:"Asia/Choibalsan",display:"Asia/Choibalsan",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Chongqing",display:"Asia/Chongqing",offset:480,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Beijing, Chongqing, Hong Kong, Urumqi"},{tz:"Asia/Chungking",display:"Asia/Chungking",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Colombo",display:"Asia/Colombo",offset:330,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Asia/Dacca",display:"Asia/Dacca",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Damascus",display:"Asia/Damascus",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Damascus"},{tz:"Asia/Dhaka",display:"Asia/Dhaka",offset:360,isdst:!1,abbr:"BST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +06:00) Dhaka"},{tz:"Asia/Dili",display:"Asia/Dili",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Dubai",
display:"Asia/Dubai",offset:240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Dushanbe",display:"Asia/Dushanbe",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Famagusta",display:"Asia/Famagusta",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Gaza",display:"Asia/Gaza",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Gaza, Hebron"},{tz:"Asia/Harbin",display:"Asia/Harbin",offset:480,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Hebron",display:"Asia/Hebron",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Gaza, Hebron"},{tz:"Asia/Ho_Chi_Minh",display:"Asia/Ho Chi_Minh",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Hong_Kong",display:"Asia/Hong Kong",offset:480,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Beijing, Chongqing, Hong Kong, Urumqi"},{tz:"Asia/Hovd",
display:"Asia/Hovd",offset:420,isdst:!0,abbr:"HOVT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Hovd"},{tz:"Asia/Irkutsk",display:"Asia/Irkutsk",offset:480,isdst:!1,abbr:"IRKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Irkutsk"},{tz:"Asia/Istanbul",display:"Asia/Istanbul",offset:180,isdst:!1,abbr:"TRT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Istanbul"},{tz:"Asia/Jakarta",display:"Asia/Jakarta",offset:420,isdst:!1,abbr:"ICT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Bangkok, Hanoi, Jakarta"},
{tz:"Asia/Jayapura",display:"Asia/Jayapura",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Jerusalem",display:"Asia/Jerusalem",offset:120,isdst:!0,abbr:"IST",abbr_dst:"IDT",is_cisco:!0,cisco_display:"(UTC +02:00) Jerusalem"},{tz:"Asia/Kabul",display:"Asia/Kabul",offset:270,isdst:!1,abbr:"AFT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:30) Kabul"},{tz:"Asia/Kamchatka",display:"Asia/Kamchatka",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Asia/Karachi",display:"Asia/Karachi",offset:300,isdst:!1,abbr:"PKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:00) Islamabad, Karachi"},{tz:"Asia/Kashgar",display:"Asia/Kashgar",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Kathmandu",display:"Asia/Kathmandu",offset:345,isdst:!1,abbr:"NPT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:45) Kathmandu"},{tz:"Asia/Katmandu",display:"Asia/Katmandu",offset:345,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Asia/Khandyga",display:"Asia/Khandyga",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Kolkata",display:"Asia/Kolkata",offset:330,isdst:!1,abbr:"IST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:30) Chennai, Kolkata, Mumbai, New Delhi"},{tz:"Asia/Krasnoyarsk",display:"Asia/Krasnoyarsk",offset:420,isdst:!1,abbr:"KRAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Krasnoyarsk"},{tz:"Asia/Kuala_Lumpur",display:"Asia/Kuala Lumpur",offset:480,isdst:!1,abbr:"SGT",
abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Kuala Lumpur, Singapore"},{tz:"Asia/Kuching",display:"Asia/Kuching",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Kuwait",display:"Asia/Kuwait",offset:180,isdst:!1,abbr:"AST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Kuwait, Riyadh"},{tz:"Asia/Macao",display:"Asia/Macao",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Macau",display:"Asia/Macau",offset:480,isdst:!1,abbr:"",
abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Magadan",display:"Asia/Magadan",offset:660,isdst:!1,abbr:"MAGT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Magadan"},{tz:"Asia/Makassar",display:"Asia/Makassar",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Manila",display:"Asia/Manila",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Muscat",display:"Asia/Muscat",offset:240,isdst:!1,abbr:"GST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Abu Dhabi, Muscat"},
{tz:"Asia/Nicosia",display:"Asia/Nicosia",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Novokuznetsk",display:"Asia/Novokuznetsk",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Novosibirsk",display:"Asia/Novosibirsk",offset:420,isdst:!1,abbr:"NOVT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Novosibirsk"},{tz:"Asia/Omsk",display:"Asia/Omsk",offset:360,isdst:!1,abbr:"OMST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +06:00) Omsk"},
{tz:"Asia/Oral",display:"Asia/Oral",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Phnom_Penh",display:"Asia/Phnom Penh",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Pontianak",display:"Asia/Pontianak",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Pyongyang",display:"Asia/Pyongyang",offset:540,isdst:!1,abbr:"PYT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:00) Pyongyang"},{tz:"Asia/Qatar",display:"Asia/Qatar",
offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Qyzylorda",display:"Asia/Qyzylorda",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Rangoon",display:"Asia/Rangoon",offset:390,isdst:!1,abbr:"MMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +06:30) Yangon (Rangoon)"},{tz:"Asia/Riyadh",display:"Asia/Riyadh",offset:180,isdst:!1,abbr:"AST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Kuwait, Riyadh"},{tz:"Asia/Saigon",display:"Asia/Saigon",
offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Sakhalin",display:"Asia/Sakhalin",offset:660,isdst:!1,abbr:"SAKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Sakhalin"},{tz:"Asia/Samarkand",display:"Asia/Samarkand",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Seoul",display:"Asia/Seoul",offset:540,isdst:!1,abbr:"KST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:00) Seoul"},{tz:"Asia/Shanghai",display:"Asia/Shanghai",offset:480,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Singapore",display:"Asia/Singapore",offset:480,isdst:!1,abbr:"SGT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Kuala Lumpur, Singapore"},{tz:"Asia/Srednekolymsk",display:"Asia/Srednekolymsk",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Taipei",display:"Asia/Taipei",offset:480,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Taipei"},{tz:"Asia/Tashkent",display:"Asia/Tashkent",
offset:300,isdst:!1,abbr:"TMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:00) Ashgabat, Tashkent"},{tz:"Asia/Tbilisi",display:"Asia/Tbilisi",offset:240,isdst:!1,abbr:"GET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Tbilisi"},{tz:"Asia/Tehran",display:"Asia/Tehran",offset:210,isdst:!0,abbr:"IRST",abbr_dst:"IRDT",is_cisco:!0,cisco_display:"(UTC +03:30) Tehran"},{tz:"Asia/Tel_Aviv",display:"Asia/Tel Aviv",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Thimbu",
display:"Asia/Thimbu",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Thimphu",display:"Asia/Thimphu",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Tokyo",display:"Asia/Tokyo",offset:540,isdst:!1,abbr:"JST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:00) Osaka, Sapporo, Tokyo"},{tz:"Asia/Tomsk",display:"Asia/Tomsk",offset:420,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Tomsk"},{tz:"Asia/Ujung_Pandang",
display:"Asia/Ujung Pandang",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Ulaanbaatar",display:"Asia/Ulaanbaatar",offset:480,isdst:!0,abbr:"ULAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Ulaanbaatar"},{tz:"Asia/Ulan_Bator",display:"Asia/Ulan Bator",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Urumqi",display:"Asia/Urumqi",offset:360,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Ust-Nera",display:"Asia/Ust-Nera",
offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Vientiane",display:"Asia/Vientiane",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Vladivostok",display:"Asia/Vladivostok",offset:600,isdst:!1,abbr:"VLAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +10:00) Vladivostok"},{tz:"Asia/Yakutsk",display:"Asia/Yakutsk",offset:540,isdst:!1,abbr:"YAKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:00) Yakutsk"},{tz:"Asia/Yangon",display:"Asia/Yangon",
offset:390,isdst:!1,abbr:"MMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +06:30) Yangon (Rangoon)"},{tz:"Asia/Yekaterinburg",display:"Asia/Yekaterinburg",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Yerevan",display:"Asia/Yerevan",offset:240,isdst:!1,abbr:"AMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Yerevan"},{tz:"Atlantic/Azores",display:"Atlantic/Azores",offset:-60,isdst:!0,abbr:"AZOT",abbr_dst:"AZOST",is_cisco:!0,cisco_display:"(UTC -01:00) Azores"},
{tz:"Atlantic/Bermuda",display:"Atlantic/Bermuda",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Canary",display:"Atlantic/Canary",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Cape_Verde",display:"Atlantic/Cape Verde",offset:-60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Faeroe",display:"Atlantic/Faeroe",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Faroe",display:"Atlantic/Faroe",
offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Jan_Mayen",display:"Atlantic/Jan Mayen",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Madeira",display:"Atlantic/Madeira",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Reykjavik",display:"Atlantic/Reykjavik",offset:0,isdst:!1,abbr:"UTC",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +00:00) Monrovia, Reykjavik"},{tz:"Atlantic/South_Georgia",display:"Atlantic/South Georgia",
offset:-120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/St_Helena",display:"Atlantic/St Helena",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Stanley",display:"Atlantic/Stanley",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/ACT",display:"Australia/ACT",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Adelaide",display:"Australia/Adelaide",offset:570,isdst:!0,
abbr:"ACST",abbr_dst:"ACDT",is_cisco:!0,cisco_display:"(UTC +09:30) Adelaide"},{tz:"Australia/Brisbane",display:"Australia/Brisbane",offset:600,isdst:!1,abbr:"AEST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +10:00) Brisbane"},{tz:"Australia/Broken_Hill",display:"Australia/Broken Hill",offset:570,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Canberra",display:"Australia/Canberra",offset:600,isdst:!0,abbr:"AEST",abbr_dst:"AEDT",is_cisco:!0,cisco_display:"(UTC +10:00) Canberra, Melbourne, Sydney"},
{tz:"Australia/Currie",display:"Australia/Currie",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Darwin",display:"Australia/Darwin",offset:570,isdst:!1,abbr:"ACST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:30) Darwin"},{tz:"Australia/Eucla",display:"Australia/Eucla",offset:525,isdst:!1,abbr:"ACWST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:45) Eucla"},{tz:"Australia/Hobart",display:"Australia/Hobart",offset:600,isdst:!0,abbr:"AEST",abbr_dst:"AEDT",
is_cisco:!0,cisco_display:"(UTC +10:00) Hobart"},{tz:"Australia/LHI",display:"Australia/LHI",offset:630,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Lindeman",display:"Australia/Lindeman",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Lord_Howe",display:"Australia/Lord Howe",offset:630,isdst:!0,abbr:"LHST",abbr_dst:"LHDT",is_cisco:!0,cisco_display:"(UTC +10:30) Lord Howe Island"},{tz:"Australia/Melbourne",display:"Australia/Melbourne",
offset:600,isdst:!0,abbr:"AEST",abbr_dst:"AEDT",is_cisco:!0,cisco_display:"(UTC +10:00) Canberra, Melbourne, Sydney"},{tz:"Australia/North",display:"Australia/North",offset:570,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/NSW",display:"Australia/NSW",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Perth",display:"Australia/Perth",offset:480,isdst:!1,abbr:"AWST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Perth"},{tz:"Australia/Queensland",
display:"Australia/Queensland",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/South",display:"Australia/South",offset:570,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Sydney",display:"Australia/Sydney",offset:600,isdst:!0,abbr:"AEST",abbr_dst:"AEDT",is_cisco:!0,cisco_display:"(UTC +10:00) Canberra, Melbourne, Sydney"},{tz:"Australia/Tasmania",display:"Australia/Tasmania",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Australia/Victoria",display:"Australia/Victoria",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/West",display:"Australia/West",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Yancowinna",display:"Australia/Yancowinna",offset:570,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Brazil/Acre",display:"Brazil/Acre",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Brazil/DeNoronha",
display:"Brazil/DeNoronha",offset:-120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Brazil/East",display:"Brazil/East",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Brazil/West",display:"Brazil/West",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Canada/Atlantic",display:"Canada/Atlantic",offset:-240,isdst:!0,abbr:"AST",abbr_dst:"AT",is_cisco:!0,cisco_display:"(UTC -04:00) Atlantic Time (Canada)"},{tz:"Canada/Central",display:"Canada/Central",
offset:-360,isdst:!0,abbr:"CST",abbr_dst:"CDT",is_cisco:!0,cisco_display:"(UTC -06:00) Central Time (US & Canada)"},{tz:"Canada/Eastern",display:"Canada/Eastern",offset:-300,isdst:!0,abbr:"EST",abbr_dst:"EDT",is_cisco:!0,cisco_display:"(UTC -05:00) Eastern Time (US & Canada)"},{tz:"Canada/East-Saskatchewan",display:"Canada/East-Saskatchewan",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Canada/Mountain",display:"Canada/Mountain",offset:-420,isdst:!0,abbr:"MST",abbr_dst:"MDT",
is_cisco:!0,cisco_display:"(UTC -07:00) Mountain Time (US & Canada)"},{tz:"Canada/Newfoundland",display:"Canada/Newfoundland",offset:-210,isdst:!0,abbr:"NST",abbr_dst:"NDT",is_cisco:!0,cisco_display:"(UTC -03:30) Newfoundland"},{tz:"Canada/Pacific",display:"Canada/Pacific",offset:-480,isdst:!0,abbr:"PST",abbr_dst:"PDT",is_cisco:!0,cisco_display:"(UTC -08:00) Pacific Time (US & Canada)"},{tz:"Canada/Saskatchewan",display:"Canada/Saskatchewan",offset:-360,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!0,
cisco_display:"(UTC -06:00) Saskatchewan"},{tz:"Canada/Yukon",display:"Canada/Yukon",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"CET",display:"CET",offset:60,isdst:!1,abbr:"CET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +01:00) West Central Africa"},{tz:"Chile/Continental",display:"Chile/Continental",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Chile/EasterIsland",display:"Chile/EasterIsland",offset:-360,isdst:!0,abbr:"EAST",abbr_dst:"EASST",
is_cisco:!0,cisco_display:"(UTC -06:00) Easter Island"},{tz:"CST6CDT",display:"CST6CDT",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Cuba",display:"Cuba",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"EET",display:"EET",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Egypt",display:"Egypt",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Eire",display:"Eire",offset:0,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"EST",display:"EST",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"EST5EDT",display:"EST5EDT",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT",display:"Etc/GMT",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+0",display:"Etc/GMT+0",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+1",display:"Etc/GMT+1",offset:-60,isdst:!1,abbr:"CVT",abbr_dst:"",
is_cisco:!0,cisco_display:"(UTC -01:00) Cabo Verde Is."},{tz:"Etc/GMT+10",display:"Etc/GMT+10",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+11",display:"Etc/GMT+11",offset:-660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -11:00) Coordinated Universal Time-11"},{tz:"Etc/GMT+12",display:"Etc/GMT+12",offset:-720,isdst:!1,abbr:"DST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -12:00) International Date Line West"},{tz:"Etc/GMT+2",display:"Etc/GMT+2",
offset:-120,isdst:!1,abbr:"FNT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -02:00) Coordinated Universal Time-02"},{tz:"Etc/GMT+3",display:"Etc/GMT+3",offset:-180,isdst:!0,abbr:"BRT",abbr_dst:"BRST",is_cisco:!0,cisco_display:"(UTC -03:00) Brasilia"},{tz:"Etc/GMT+4",display:"Etc/GMT+4",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+5",display:"Etc/GMT+5",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+6",display:"Etc/GMT+6",
offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+7",display:"Etc/GMT+7",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+8",display:"Etc/GMT+8",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -08:00) Coordinated Universal Time-08"},{tz:"Etc/GMT+9",display:"Etc/GMT+9",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT0",display:"Etc/GMT0",offset:0,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-0",display:"Etc/GMT-0",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-1",display:"Etc/GMT-1",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-10",display:"Etc/GMT-10",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-11",display:"Etc/GMT-11",offset:660,isdst:!1,abbr:"SRET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Chokurdakh"},{tz:"Etc/GMT-12",display:"Etc/GMT-12",
offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-13",display:"Etc/GMT-13",offset:780,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +13:00) Coordinated Universal Time+13"},{tz:"Etc/GMT-14",display:"Etc/GMT-14",offset:840,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-2",display:"Etc/GMT-2",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-3",display:"Etc/GMT-3",offset:180,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-4",display:"Etc/GMT-4",offset:240,isdst:!1,abbr:"MUT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Port Louis"},{tz:"Etc/GMT-5",display:"Etc/GMT-5",offset:300,isdst:!1,abbr:"YEKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:00) Ekaterinburg"},{tz:"Etc/GMT-6",display:"Etc/GMT-6",offset:360,isdst:!1,abbr:"ALMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +06:00) Astana"},{tz:"Etc/GMT-7",display:"Etc/GMT-7",offset:420,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-8",display:"Etc/GMT-8",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-9",display:"Etc/GMT-9",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/Greenwich",display:"Etc/Greenwich",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/UCT",display:"Etc/UCT",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/Universal",display:"Etc/Universal",offset:0,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/UTC",display:"Etc/UTC",offset:0,isdst:!1,abbr:"UTC",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/Zulu",display:"Etc/Zulu",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Amsterdam",display:"Europe/Amsterdam",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},{tz:"Europe/Andorra",display:"Europe/Andorra",offset:60,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Astrakhan",display:"Europe/Astrakhan",offset:240,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Astrakhan, Ulyanovsk"},{tz:"Europe/Athens",display:"Europe/Athens",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Athens, Bucharest"},{tz:"Europe/Belfast",display:"Europe/Belfast",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Belgrade",
display:"Europe/Belgrade",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague"},{tz:"Europe/Berlin",display:"Europe/Berlin",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},{tz:"Europe/Bratislava",display:"Europe/Bratislava",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague"},
{tz:"Europe/Brussels",display:"Europe/Brussels",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Brussels, Copenhagen, Madrid, Paris"},{tz:"Europe/Bucharest",display:"Europe/Bucharest",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Athens, Bucharest"},{tz:"Europe/Budapest",display:"Europe/Budapest",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague"},
{tz:"Europe/Busingen",display:"Europe/Busingen",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Chisinau",display:"Europe/Chisinau",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Chisinau"},{tz:"Europe/Copenhagen",display:"Europe/Copenhagen",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Brussels, Copenhagen, Madrid, Paris"},{tz:"Europe/Dublin",display:"Europe/Dublin",offset:0,isdst:!0,
abbr:"UTC",abbr_dst:"IST",is_cisco:!0,cisco_display:"(UTC +00:00) Dublin, Edinburgh, Lisbon, London"},{tz:"Europe/Gibraltar",display:"Europe/Gibraltar",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Guernsey",display:"Europe/Guernsey",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Helsinki",display:"Europe/Helsinki",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius"},
{tz:"Europe/Isle_of_Man",display:"Europe/Isle of_Man",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Istanbul",display:"Europe/Istanbul",offset:180,isdst:!1,abbr:"TRT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Istanbul"},{tz:"Europe/Jersey",display:"Europe/Jersey",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Kaliningrad",display:"Europe/Kaliningrad",offset:120,isdst:!1,abbr:"EET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Kaliningrad"},
{tz:"Europe/Kiev",display:"Europe/Kiev",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Kirov",display:"Europe/Kirov",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Lisbon",display:"Europe/Lisbon",offset:0,isdst:!0,abbr:"UTC",abbr_dst:"IST",is_cisco:!0,cisco_display:"(UTC +00:00) Dublin, Edinburgh, Lisbon, London"},{tz:"Europe/Ljubljana",display:"Europe/Ljubljana",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague"},
{tz:"Europe/London",display:"Europe/London",offset:0,isdst:!0,abbr:"UTC",abbr_dst:"IST",is_cisco:!0,cisco_display:"(UTC +00:00) Dublin, Edinburgh, Lisbon, London"},{tz:"Europe/Luxembourg",display:"Europe/Luxembourg",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Madrid",display:"Europe/Madrid",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Brussels, Copenhagen, Madrid, Paris"},{tz:"Europe/Malta",display:"Europe/Malta",offset:60,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Mariehamn",display:"Europe/Mariehamn",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Minsk",display:"Europe/Minsk",offset:180,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Minsk"},{tz:"Europe/Monaco",display:"Europe/Monaco",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Moscow",display:"Europe/Moscow",offset:180,isdst:!1,abbr:"MSK",abbr_dst:"",
is_cisco:!0,cisco_display:"(UTC +03:00) Moscow, St. Petersburg, Volgograd"},{tz:"Europe/Nicosia",display:"Europe/Nicosia",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Oslo",display:"Europe/Oslo",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Paris",display:"Europe/Paris",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Brussels, Copenhagen, Madrid, Paris"},{tz:"Europe/Podgorica",display:"Europe/Podgorica",
offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Prague",display:"Europe/Prague",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague"},{tz:"Europe/Riga",display:"Europe/Riga",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius"},{tz:"Europe/Rome",display:"Europe/Rome",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",
is_cisco:!0,cisco_display:"(UTC +01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},{tz:"Europe/Samara",display:"Europe/Samara",offset:240,isdst:!1,abbr:"SAMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Izhevsk, Samara"},{tz:"Europe/San_Marino",display:"Europe/San Marino",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Sarajevo",display:"Europe/Sarajevo",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Sarajevo, Skopje, Warsaw, Zagreb"},
{tz:"Europe/Saratov",display:"Europe/Saratov",offset:240,isdst:!0,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Saratov"},{tz:"Europe/Simferopol",display:"Europe/Simferopol",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Skopje",display:"Europe/Skopje",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Sarajevo, Skopje, Warsaw, Zagreb"},{tz:"Europe/Sofia",display:"Europe/Sofia",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",
is_cisco:!0,cisco_display:"(UTC +02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius"},{tz:"Europe/Stockholm",display:"Europe/Stockholm",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},{tz:"Europe/Tallinn",display:"Europe/Tallinn",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius"},{tz:"Europe/Tirane",display:"Europe/Tirane",offset:60,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Tiraspol",display:"Europe/Tiraspol",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Ulyanovsk",display:"Europe/Ulyanovsk",offset:240,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Astrakhan, Ulyanovsk"},{tz:"Europe/Uzhgorod",display:"Europe/Uzhgorod",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Vaduz",display:"Europe/Vaduz",offset:60,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Vatican",display:"Europe/Vatican",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Vienna",display:"Europe/Vienna",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},{tz:"Europe/Vilnius",display:"Europe/Vilnius",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius"},
{tz:"Europe/Volgograd",display:"Europe/Volgograd",offset:180,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Moscow, St. Petersburg, Volgograd"},{tz:"Europe/Warsaw",display:"Europe/Warsaw",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Sarajevo, Skopje, Warsaw, Zagreb"},{tz:"Europe/Zagreb",display:"Europe/Zagreb",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Sarajevo, Skopje, Warsaw, Zagreb"},{tz:"Europe/Zaporozhye",
display:"Europe/Zaporozhye",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Zurich",display:"Europe/Zurich",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GB",display:"GB",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GB-Eire",display:"GB-Eire",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GMT",display:"GMT",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GMT+0",
display:"GMT+0",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GMT0",display:"GMT0",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GMT-0",display:"GMT-0",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Greenwich",display:"Greenwich",offset:0,isdst:!1,abbr:"GMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +00:00) Greenwich"},{tz:"Hongkong",display:"Hongkong",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"HST",display:"HST",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Iceland",display:"Iceland",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Antananarivo",display:"Indian/Antananarivo",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Chagos",display:"Indian/Chagos",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Christmas",display:"Indian/Christmas",offset:420,isdst:!1,
abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Cocos",display:"Indian/Cocos",offset:390,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Comoro",display:"Indian/Comoro",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Kerguelen",display:"Indian/Kerguelen",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Mahe",display:"Indian/Mahe",offset:240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Indian/Maldives",display:"Indian/Maldives",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Mauritius",display:"Indian/Mauritius",offset:240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Mayotte",display:"Indian/Mayotte",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Reunion",display:"Indian/Reunion",offset:240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Iran",display:"Iran",offset:210,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Israel",display:"Israel",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Jamaica",display:"Jamaica",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Japan",display:"Japan",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Kwajalein",display:"Kwajalein",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Libya",display:"Libya",offset:120,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"MET",display:"MET",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Mexico/BajaNorte",display:"Mexico/BajaNorte",offset:-480,isdst:!0,abbr:"PST",abbr_dst:"PDT",is_cisco:!0,cisco_display:"(UTC -08:00) Baja California"},{tz:"Mexico/BajaSur",display:"Mexico/BajaSur",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Mexico/General",display:"Mexico/General",offset:-360,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"MST",display:"MST",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"MST7MDT",display:"MST7MDT",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Navajo",display:"Navajo",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"NZ",display:"NZ",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"NZ-CHAT",display:"NZ-CHAT",offset:765,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,
cisco_display:""},{tz:"Pacific/Apia",display:"Pacific/Apia",offset:780,isdst:!0,abbr:"WST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +13:00) Samoa"},{tz:"Pacific/Auckland",display:"Pacific/Auckland",offset:720,isdst:!0,abbr:"NZST",abbr_dst:"NZDT",is_cisco:!0,cisco_display:"(UTC +12:00) Auckland, Wellington"},{tz:"Pacific/Bougainville",display:"Pacific/Bougainville",offset:660,isdst:!1,abbr:"BST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Bougainville Island"},{tz:"Pacific/Chatham",display:"Pacific/Chatham",
offset:765,isdst:!0,abbr:"CHAST",abbr_dst:"CHADT",is_cisco:!0,cisco_display:"(UTC +12:45) Chatham Islands"},{tz:"Pacific/Chuuk",display:"Pacific/Chuuk",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Easter",display:"Pacific/Easter",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Efate",display:"Pacific/Efate",offset:660,isdst:!1,abbr:"SBT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Solomon Is., New Caledonia"},{tz:"Pacific/Enderbury",
display:"Pacific/Enderbury",offset:780,isdst:!1,abbr:"TOT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +13:00) Nuku'alofa"},{tz:"Pacific/Fakaofo",display:"Pacific/Fakaofo",offset:780,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Fiji",display:"Pacific/Fiji",offset:720,isdst:!0,abbr:"FJT",abbr_dst:"FJST",is_cisco:!0,cisco_display:"(UTC +12:00) Fiji"},{tz:"Pacific/Funafuti",display:"Pacific/Funafuti",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Galapagos",
display:"Pacific/Galapagos",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Gambier",display:"Pacific/Gambier",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Guadalcanal",display:"Pacific/Guadalcanal",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Guam",display:"Pacific/Guam",offset:600,isdst:!1,abbr:"ChST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +10:00) Guam, Port Moresby"},{tz:"Pacific/Honolulu",
display:"Pacific/Honolulu",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Johnston",display:"Pacific/Johnston",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Kiritimati",display:"Pacific/Kiritimati",offset:840,isdst:!1,abbr:"LINT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +14:00) Kiritimati Island"},{tz:"Pacific/Kosrae",display:"Pacific/Kosrae",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Kwajalein",
display:"Pacific/Kwajalein",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Majuro",display:"Pacific/Majuro",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Marquesas",display:"Pacific/Marquesas",offset:-570,isdst:!1,abbr:"MART",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -09:30) Marquesas Islands"},{tz:"Pacific/Midway",display:"Pacific/Midway",offset:-660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Nauru",
display:"Pacific/Nauru",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Niue",display:"Pacific/Niue",offset:-660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Norfolk",display:"Pacific/Norfolk",offset:660,isdst:!1,abbr:"NFT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Norfolk Island"},{tz:"Pacific/Noumea",display:"Pacific/Noumea",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Pago_Pago",display:"Pacific/Pago Pago",
offset:-660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Palau",display:"Pacific/Palau",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Pitcairn",display:"Pacific/Pitcairn",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Pohnpei",display:"Pacific/Pohnpei",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Ponape",display:"Pacific/Ponape",offset:660,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Pacific/Port_Moresby",display:"Pacific/Port Moresby",offset:600,isdst:!1,abbr:"ChST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +10:00) Guam, Port Moresby"},{tz:"Pacific/Rarotonga",display:"Pacific/Rarotonga",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Saipan",display:"Pacific/Saipan",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Samoa",display:"Pacific/Samoa",offset:-660,isdst:!1,abbr:"false",
abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Tahiti",display:"Pacific/Tahiti",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Tarawa",display:"Pacific/Tarawa",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Tongatapu",display:"Pacific/Tongatapu",offset:780,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Truk",display:"Pacific/Truk",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Pacific/Wake",display:"Pacific/Wake",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Wallis",display:"Pacific/Wallis",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Yap",display:"Pacific/Yap",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Poland",display:"Poland",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Portugal",display:"Portugal",offset:0,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"PRC",display:"PRC",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"PST8PDT",display:"PST8PDT",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"ROC",display:"ROC",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"ROK",display:"ROK",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Singapore",display:"Singapore",offset:480,isdst:!1,abbr:"SGT",abbr_dst:"",is_cisco:!0,
cisco_display:"(UTC +08:00) Kuala Lumpur, Singapore"},{tz:"Turkey",display:"Turkey",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"UCT",display:"UCT",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Universal",display:"Universal",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"US/Alaska",display:"US/Alaska",offset:-540,isdst:!0,abbr:"AKST",abbr_dst:"AKDT",is_cisco:!0,cisco_display:"(UTC -09:00) Alaska"},{tz:"US/Aleutian",
display:"US/Aleutian",offset:-600,isdst:!0,abbr:"HAST",abbr_dst:"HADT",is_cisco:!0,cisco_display:"(UTC -10:00) Aleutian Islands"},{tz:"US/Arizona",display:"US/Arizona",offset:-420,isdst:!1,abbr:"MST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -07:00) Arizona"},{tz:"US/Central",display:"US/Central",offset:-360,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -06:00) Central America"},{tz:"US/Eastern",display:"US/Eastern",offset:-300,isdst:!0,abbr:"EST",abbr_dst:"EDT",is_cisco:!0,cisco_display:"(UTC -05:00) Eastern Time (US & Canada)"},
{tz:"US/East-Indiana",display:"US/East-Indiana",offset:-300,isdst:!0,abbr:"EST",abbr_dst:"EDT",is_cisco:!0,cisco_display:"(UTC -05:00) Indiana (East)"},{tz:"US/Hawaii",display:"US/Hawaii",offset:-600,isdst:!1,abbr:"HAST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -10:00) Hawaii"},{tz:"US/Indiana-Starke",display:"US/Indiana-Starke",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"US/Michigan",display:"US/Michigan",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"US/Mountain",display:"US/Mountain",offset:-420,isdst:!0,abbr:"MST",abbr_dst:"MDT",is_cisco:!0,cisco_display:"(UTC -07:00) Mountain Time (US & Canada)"},{tz:"US/Pacific",display:"US/Pacific",offset:-480,isdst:!0,abbr:"PST",abbr_dst:"PDT",is_cisco:!0,cisco_display:"(UTC -08:00) Pacific Time (US & Canada)"},{tz:"US/Pacific-New",display:"US/Pacific-New",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"US/Samoa",display:"US/Samoa",offset:-660,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"UTC",display:"UTC",offset:0,isdst:!1,abbr:"UTC",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +00:00) Coordinated Universal Time"},{tz:"WET",display:"WET",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"W-SU",display:"W-SU",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Zulu",display:"Zulu",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""}];app.controller("service_management_main",["$scope","$rootScope","$q","MyHttp","$http","GridRowBasedEditingAdv","$templateCache","Sets","UserSession","userAccessRight","goToPreviousPage","sslvpn_port_vld",function(a,b,t,m,w,u,p,q,e,x,n,l){var r=app.uiGrid.sortFun;a.model={};a.backbtn=!1;n.isneed()&&(a.backbtn=!0);a.schema={protocols:[{id:"ALL",displayName:a.DICT("Service_Management_All")},{id:"TCP_UDP",displayName:a.DICT("Service_Management_TCP_UDP")},{id:"TCP",displayName:a.DICT("Service_Management_TCP")},
{id:"UDP",displayName:a.DICT("Service_Management_UDP")},{id:"IP",displayName:a.DICT("Service_Management_IP")},{id:"ICMP",displayName:a.DICT("Service_Management_ICMP")}],protocols_map:{ALL:"All",TCP_UDP:"TCP&UDP",TCP:"TCP",UDP:"UDP",IP:"IP",ICMP:"ICMP"}};a.success=!1;a.dataReady=!1;a.userAccessFlag=x.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();var v=function(){t.all({pService:function(){return m.post({url:resource_base+"data/service_management.json",method:"get_services",error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}})}(),pPortFw:function(){return m.post({url:resource_base+"data/port_forwarding.json",method:"get_port_forwarding",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})}(),pPortTr:function(){return m.post({url:resource_base+"data/port_triggering.json",method:"get_port_triggering",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})}(),sslvpn_port_vld:l.init()}).then(function(b){var c=[],h;a.model.services=
[];b.pService.data&&(b.pService.data.result&&b.pService.data.result.services&&b.pService.data.result.services.service)&&(c=b.pService.data.result.services.service);angular.forEach(c,function(b){h=k(b);h.type="orig";a.model.services.push(h)});angular.extend(a.model,b.pPortFw.data.result);angular.extend(a.model,b.pPortTr.data.result);s();a.gridSERVICE.Options.data=a.model.services;a.orig_services=angular.copy(a.model.services);a.dataReady=!0;setTimeout(function(){a.gridSERVICE.Options.gridApi&&a.gridSERVICE.Options.gridApi.customApi.checkSelectStatus()},
50);a.resetModified()})},s=function(){var b=function(b,d){var g=[],e,k=!1;"PortFw"===d?(g=a.model["port-forwarding-rules"]&&a.model["port-forwarding-rules"]["port-forwarding-entry"]||[],e=function(a,b){return b["external-service"]===a||b["internal-service"]===a}):"PortTr"===d&&(g=a.model["port-triggering-rules"]&&a.model["port-triggering-rules"]["port-triggering-entry"]||[],e=function(a,b){return b["trigger-service"]===a||b["incoming-service"]===a});for(var l=0,n;l<g.length;l++)if(n=g[l],e(b,n)){k=
!0;break}return k};(function(){angular.forEach(a.model.services,function(a,h){a._ctx=a._ctx||{};if(b(a.name,"PortFw")){var g=a._ctx;g.inuse=g.inuse||[];g.inuse.push("Port Forwarding")}b(a.name,"PortTr")&&(g=a._ctx,g.inuse=g.inuse||[],g.inuse.push("Port Triggering"))})})()};a.gridSERVICE={};a.gridSERVICE.Selections=[];a.gridSERVICE.procNgClick=function(b){a.gridSERVICE.Selections=[];angular.forEach(a.model.services,function(b,d){b.checked?a.gridSERVICE.Selections.push(b):(b.edit=!1,b.edit_name=!1)});
a.gridSERVICE.check_remove_condition()};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.checkInuse=function(a,b){return("ICMP"===b.id||"IP"===b.id)&&a._ctx&&a._ctx.inuse&&0<a._ctx.inuse.length?!0:!1};a.checkNameIsRepeat=function(){var b=a.gridSERVICE.Options.data,c=b.length,h,g;angular.forEach(b,function(a){a.invalid_name=!1});for(h=0;h<c;h++)for(g=h+1;g<c;g++)b[h].name===b[g].name&&(b[h].invalid_name=!0,b[g].invalid_name=!0)};a.check_service=function(b){b=b.entity;var c,h,g;
b.invalid=!1;a.errstr="";switch(b.protocol){case "TCP_UDP":case "TCP":g=b.name;c=b.port.start;h=b.port.end;if(!g||!_.isNumber(c)||!_.isNumber(h))break;c=l.check_service_port(g,c,h);c.valid||(b.invalid=!0,b.errstr=c.err)}};a.gridSERVICE.Options=app.uiGrid.generateGridOptions({IDPreifx:"Service",minRowsToShow:10,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridSERVICE.procNgClick,headerChangedCbk:a.gridSERVICE.procNgClick,disableChkBoxField:"disableChk"},{field:"name",displayName:a.DICT("Service_Management_Application_Name"),
id:"ServiceAppName",validationCbk:"gridInvalidCbk",cellTemplate:p.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"str-name"),editRow:"edit_name",invalidField:"invalid_name",customVldCbk:"checkNameIsRepeat",required:!0},{field:"protocol",displayName:a.DICT("Service_Management_Protocol"),width:130,id:"ServiceProtocol",cellTemplate:p.get("UG_table_text_with_inline_select_edit_and_custom_options.html").replace(/NGOPTIONS/,"item.id as item.displayName disable when grid.appScope.checkInuse(row.entity, item) for (key, item) in grid.appScope.schema.protocols").replace(/data-ng-expansion/,
'ng-change="grid.appScope.check_service(row)"'),editRow:"edit",list:a.schema.protocols,default_str:"--"},{field:"port",displayName:a.DICT("Service_Management_Port_Start"),id:"ServicePortStart",validationCbk:"gridInvalidCbk",cellTemplate:p.get("UG_portRange_start.html"),editRow:"edit",default_str:"--",sortingAlgorithm:function(a,b,h,g,e){var k=void 0,l=void 0;switch(h.entity.protocol){case "TCP_UDP":case "TCP":case "UDP":k=a.start;break;case "IP":k=a.ip;break;case "ICMP":k=a.icmp}switch(g.entity.protocol){case "TCP_UDP":case "TCP":case "UDP":l=
b.start;break;case "IP":l=b.ip;break;case "ICMP":l=b.icmp}return r(k,l,e)}},{field:"port",displayName:a.DICT("Service_Management_Port_End"),id:"ServicePortEnd",validationCbk:"gridInvalidCbk",cellTemplate:p.get("UG_portRange_end.html"),editRow:"edit",default_str:"--",sortingAlgorithm:function(a,b,h,g,e){var k=void 0,l=void 0;switch(h.entity.protocol){case "TCP_UDP":case "TCP":case "UDP":k=a.end}switch(g.entity.protocol){case "TCP":case "UDP":case "TCP_UPD":l=b.end}return r(k,l,e)}}]});a.gridSERVICE.selRow=
function(b,c){a.gridSERVICE.operations.selRow(b,c)};var k=function(a){a||(a={});var b=a["port-range"]||{};return{name:a.name||"",protocol:a.protocol||"TCP",port:{start:_.isNumber(b.start)?b.start:1E4,end:_.isNumber(b.end)?b.end:1E4,icmp:_.isNumber(a["icmp-type"])?a["icmp-type"]:"",ip:_.isNumber(a["ip-type"])?a["ip-type"]:""},type:"orig",invalid_name:!1,checked:!1,edit_name:!1,edit:!1}};a.gridSERVICE.add=function(){var b=k();200<=a.gridSERVICE.Options.data.length?(b=a.DICT("Service_Management_Reach_Max_Entry",
{"%d":200}),app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})):(b.checked=!0,b.type="new",b.edit_name=!0,b.edit=!0,a.gridSERVICE.Options.data.push(b),a.gridSERVICE.Options.gridApi.customApi.scrollToLast(),a.modified())};a.gridSERVICE.edit=function(){angular.forEach(a.gridSERVICE.Options.data,function(a){a.checked&&(a.edit=!0,a.type="edit")})};a.gridSERVICE.remove=function(){var b=a.model.services,c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);a.checkNameIsRepeat();a.modified()};a.gridSERVICE.allTrafficExsit=
!1;a.gridSERVICE.check_remove_condition=function(){var b=a.gridSERVICE.Selections;a.gridSERVICE.allTrafficExsit=!1;angular.forEach(b,function(b,d){"All Traffic"==b.name&&(a.gridSERVICE.allTrafficExsit=!0)})};a.save=function(){var b=[],c,e=a.model.services,g=[],k=[],n=[],r,p=!1,s=function(){angular.forEach(e,function(a,b){r={name:a.name,protocol:a.protocol};switch(a.protocol){case "TCP":case "UDP":case "TCP_UDP":r["port-range"]={start:a.port.start,end:a.port.end};break;case "ICMP":r["icmp-type"]=a.port.icmp;
break;case "IP":r["ip-type"]=a.port.ip;break;case "ALL":break;default:return}k.push(r)});k.length&&(c={method:"set_services",params:{services:{service:k}}},b.push(c),p=!0)},q=function(){var g;angular.forEach(a.orig_services,function(a){g=!1;angular.forEach(e,function(b){b.name===a.name&&(g=!0)});g||n.push({name:a.name})});n.length&&(c={method:"del_services",params:{services:{service:n}}},b.push(c),p)};angular.forEach(e,function(a){a.invalid&&(g=g.concat(a.errstr))});g.length?app.TOOLS.criticalAlertBox({title:a.DICT("Error"),
msg:l.get_err_html(g)}):(q(),s(),p?m.post({url:resource_base+"data/rpc_result.json",method:"set_bulk",params:b,success:function(b){b.data.result&&b.data.result.code&&0!==b.data.result.code?(b="Can not delete, following Tables is in use:<br/>"+b.data.result.errstr+"<br/><br/>",app.TOOLS.criticalAlertBox({msg:b+"Apply failed, and reloading settings from device",cbk:function(a){v()}})):(a.success=!0,v())},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);v()}}):v())};
a.back=n.goback;a.cancel=function(){v()};v()}]);app.controller("lldpCtrl",["$scope","MyHttp","$uibModal","wan_service","UserSession","userAccessRight",function(a,b,t,m,w,u){a.success=!1;a.dataReady=!1;a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var p=function(b){b||(b={});var e=b.interfaces&&b.interfaces["interface"]||[];b=b["interfaces-state"]&&b["interfaces-state"]["interface"]||[];var m,p=[],k=[],d=[],d=[];a.model.neighbors=[];a.skip_lldp_update_once||(a.model.ifs=[]);angular.forEach(e,function(a,b){a.name.match(/^LAN/)&&
p.push(a);a.name.match(/^WAN\d+$/)&&k.push(a)});p=n(p,"LAN");d=p.concat(k);a.skip_lldp_update_once||(angular.forEach(d,function(b,d){m=b.lldp||{};a.model.ifs.push({name:b.name,edit:!0,lldp:{enable:void 0!==m.enable?m.enable:!0,transmit:void 0!==m.transmit?m.transmit:!0,receive:void 0!==m.receive?m.receive:!0}})}),a.gridLLDPPortOptions.data=a.model.ifs);p=[];k=[];angular.forEach(b,function(a){a.name.match(/^LAN/)&&p.push(a);a.name.match(/^WAN_PORT\d+$/)&&(a.name=a.name.replace("_PORT",""),k.push(a))});
d=p.concat(k);angular.forEach(d,function(a){a.lldp&&(a.lldp.neighbors&&a.lldp.neighbors.neighbor)&&q(a.lldp.neighbors.neighbor)});a.gridNeighborOptions.data=a.model.neighbors;a.skip_lldp_update_once=!1},q=function(b){angular.forEach(b,function(b,e){a.model.neighbors.push({receiving_interface_ref:b["receiving-interface-ref"]&&b["receiving-interface-ref"].replace("_PORT","")||"",receiving_port_ref:b["receiving-port-ref"]||"",end_of_lldppdu:b["end-of-lldppdu"]||"",chasis_id_subtype:b["chasis-id-subtype"]||
"",chasis_id:b["chasis-id"]||"",port_id_subtype:b["port-id-subtype"]||"",port_vlan_id:b["prot-vlan-id"]||"",system_name:b["system-name"]||"",port_id:b["port-id"]||"",ttl:b.ttl||"",port_desc:b["port-desc"]||"",system_desc:b["system-desc"]||"",system_capabilities:b["system-capabilities"]||"",enabled_capabilities:b["enabled-capabilities"]||"",management_address:b["management-address"]||""})})},e=function(a){b.post({url:resource_base+"data/lldp.json",method:"get_lldp",success:function(b){b.data&&b.data.result?
a?a(b.data.result):(x(b.data.result),p(b.data.result)):a?a():(x(),p())},error:function(b){a?a():(x(),p());console.log("lldpCtrl getLLDPData error status: "+b.status)}})},x=function(b){b||(b={});b=b.lldp||{};a.model.lldp={enable:void 0!==b.enable?b.enable:!0,hold_time:b["hold-time"]||120,reinit:b.reinit||2,timer:b.timer||30}},n=function(a,b){1<a.length&&(a=a.sort(function(a,e){var k="",d="",k=0<=a.name.search(b)?a.name.replace(b,""):"0",d=0<=e.name.search(b)?e.name.replace(b,""):"0",k=parseInt(k,10),
d=parseInt(d,10);return k>d?1:-1}));return a};a.model={ifs:[],lldp:{},neighbors:[],select:-1,refreshInterval:!1};a.funs={save:function(){var l={interfaces:{"interface":[]}},n={lldp:{enable:a.model.lldp.enable,"hold-time":a.model.lldp.hold_time,reinit:a.model.lldp.reinit,timer:a.model.lldp.timer}};angular.forEach(a.model.ifs,function(a,b){l.interfaces["interface"].push({name:a.name,lldp:{enable:a.lldp.enable,transmit:a.lldp.transmit,receive:a.lldp.receive}})});angular.extend(n,l);b.post({method:"set_lldp",
params:n,success:function(b){a.success=!0;e();a.resetModified()},error:function(a){}})},cancel:function(){e();a.dataReady=!0;a.resetModified()},detail:function(){t.open({animation:a.animationsEnabled,templateUrl:"lldp_neighbors_detail.htm",controller:"lldpNeighborsDetailCtrl",backdrop:"static",resolve:{data:function(){return a.model.neighbors[a.model.select]}}}).result.then(function(){},function(a){})},refresh:function(){a.skip_lldp_update_once=!0;e(p)}};a.gridLLDPPortOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"name",
displayName:a.DICT("LLDP_Interface")},{field:"lldp.enable",displayName:a.DICT("LLDP_Enable_LLDP"),editRow:"edit",id:"LLDPPort",cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});a.gridNeighborOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"radio",isRadio:!0,changedCbk:function(b){a.model.select=b},id:"Neighbor"},{field:"receiving_interface_ref",displayName:a.DICT("LLDP_Local_Port")},{field:"chasis_id_subtype",displayName:a.DICT("LLDP_Chassis_ID_Subtype")},{field:"chasis_id",displayName:a.DICT("LLDP_Chassis_ID")},
{field:"port_id_subtype",displayName:a.DICT("LLDP_Port_ID_Subtype")},{field:"port_id",displayName:a.DICT("LLDP_Port_ID")},{field:"system_name",displayName:a.DICT("LLDP_System_Name")},{field:"ttl",displayName:a.DICT("LLDP_Time_To_Live")}]});e();a.dataReady=!0}]);app.controller("lldpNeighborsDetailCtrl",["$scope","$uibModalInstance","data",function(a,b,t){a.data=t;a.funs={ok:function(){b.close()}}}]);app.controller("WizardCtrl",["$scope","MyHttp","$q","UserSession","oneTimeLocker","userAccessRight",function(a,b,t,m,w,u){b=w.get("WIZARDS");a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();a.ui_data={ru_flag:u.russia(),data_ready:!0,open_vpn_wizard:!1,open_setup_wizard:!1,open_application_wizard:!1};a.funs={setup_wizard:function(){a.ui_data.open_setup_wizard=!0;app.TOOLS.apply(a)},application_wizard:function(){a.ui_data.open_application_wizard=!0;app.TOOLS.apply(a)},
vpn_wizard:function(){a.ui_data.open_vpn_wizard=!0;app.TOOLS.apply(a)},close_setup_wizard:function(){a.ui_data.open_setup_wizard=!1;app.TOOLS.apply(a)},close_application_wizard:function(){a.ui_data.open_application_wizard=!1;app.TOOLS.apply(a)},close_vpn_wizard:function(){a.ui_data.open_vpn_wizard=!1;app.TOOLS.apply(a)}};if(b)switch(b){case "setup_wizard":a.funs.setup_wizard();break;case "application_wizard":a.funs.application_wizard();break;case "vpn_wizard":a.funs.vpn_wizard()}}]);app.controller("log_main",["$scope","$q","$log","MyHttp","$filter","modelInfo","UserSession","userAccessRight","goToPreviousPage","oneTimeLocker",function(a,b,t,m,w,u,p,q,e,x){a.model=a.model||{};a.backbtn=!1;a.goback=e.goback;a.ctx=a.ctx||{};a.ctx.email=a.ctx.email||{};a.ctx.alert=a.ctx.alert||{};a.ctx.log=a.ctx.log||{};a.ctx.facility=a.ctx.facility||{};a.model["email-server"]=a.model["email-server"]||{};a.rv340w_flag=0;a.rv345p_flag=0;a.success=!1;a.loadReady=!1;a.jumpToPage=function(b){app.TOOLS.jumpToPage(b,
void 0,function(b){b&&a.backbtn&&x.put("comefromviewlog",!0)})};a.email_setting=a.DICT("Log_Link_Email_Page",{"%s":"<a ng-click=\"jumpToPage('System_Config_Email')\">"+a.DICT("Log_Here")+"</a>"});a.ruFlag=q.russia();a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&p.logout();if(e.isneed()||x.get("needbackbtnbyemail"))a.backbtn=!0;0<=u.get_pid().search("RV340W")&&(a.rv340w_flag=1);0<=u.get_pid().search("RV345P")&&(a.rv345p_flag=1);var n=function(){var e=m.post({url:resource_base+
"data/log.json",method:"get_log",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),k=m.post({url:resource_base+"data/log.json",method:"action",params:{rpc:"usb-check-attached"},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,k]).then(function(b){for(var c=0;c<b.length;c++)angular.extend(a.model,b[c].data.result);r();a.schema=a.schema||{};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};a.schema={severity:[{id:"emergency",
displayName:a.DICT("Log_Emergency")},{id:"alert",displayName:a.DICT("Log_Alert")},{id:"critical",displayName:a.DICT("Log_Critical")},{id:"error",displayName:a.DICT("Log_Error")},{id:"warning",displayName:a.DICT("Log_Warning")},{id:"notice",displayName:a.DICT("Log_Notification")},{id:"info",displayName:a.DICT("Log_Information")},{id:"debug",displayName:a.DICT("Log_Debugging")}],threshold:[{id:"hourly",displayName:a.DICT("Log_Hourly")},{id:"daily",displayName:a.DICT("Log_Daily")},{id:"weekly",displayName:a.DICT("Log_Weekly")}],
email_severity:[{id:"emergency",displayName:a.DICT("Log_Emergency")},{id:"alert",displayName:a.DICT("Log_Alert")},{id:"critical",displayName:a.DICT("Log_Critical")},{id:"error",displayName:a.DICT("Log_Error")},{id:"warning",displayName:a.DICT("Log_Warning")},{id:"notice",displayName:a.DICT("Log_Notification")},{id:"info",displayName:a.DICT("Log_Information")},{id:"debug",displayName:a.DICT("Log_Debugging")}],transport:[{id:"TCP",displayName:a.DICT("Log_TCP")},{id:"UDP",displayName:a.DICT("Log_UDP")}]};
a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);l();a.updatealert();a.loadReady=!0})};n();var l=function(){a.schema.email_severity=[];switch(a.ctx.log.severity){case "emergency":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});"emergency"!==a.ctx.email.severity&&(a.ctx.email.severity="emergency");break;case "alert":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});
"emergency"!==a.ctx.email.severity&&"alert"!==a.ctx.email.severity&&(a.ctx.email.severity="alert");break;case "critical":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});a.schema.email_severity.push({id:"critical",displayName:a.DICT("Log_Critical")});"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity)&&(a.ctx.email.severity="critical");break;
case "error":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});a.schema.email_severity.push({id:"critical",displayName:a.DICT("Log_Critical")});a.schema.email_severity.push({id:"error",displayName:a.DICT("Log_Error")});"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity&&"error"!==a.ctx.email.severity)&&(a.ctx.email.severity="error");break;
case "warning":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});a.schema.email_severity.push({id:"critical",displayName:a.DICT("Log_Critical")});a.schema.email_severity.push({id:"error",displayName:a.DICT("Log_Error")});a.schema.email_severity.push({id:"warning",displayName:a.DICT("Log_Warning")});"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity&&
"error"!==a.ctx.email.severity&&"warning"!==a.ctx.email.severity)&&(a.ctx.email.severity="warning");break;case "notice":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});a.schema.email_severity.push({id:"critical",displayName:a.DICT("Log_Critical")});a.schema.email_severity.push({id:"error",displayName:a.DICT("Log_Error")});a.schema.email_severity.push({id:"warning",displayName:a.DICT("Log_Warning")});
a.schema.email_severity.push({id:"notice",displayName:a.DICT("Log_Notification")});"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity&&"error"!==a.ctx.email.severity&&"warning"!==a.ctx.email.severity&&"notice"!==a.ctx.email.severity)&&(a.ctx.email.severity="notice");break;case "info":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});a.schema.email_severity.push({id:"critical",
displayName:a.DICT("Log_Critical")});a.schema.email_severity.push({id:"error",displayName:a.DICT("Log_Error")});a.schema.email_severity.push({id:"warning",displayName:a.DICT("Log_Warning")});a.schema.email_severity.push({id:"notice",displayName:a.DICT("Log_Notification")});a.schema.email_severity.push({id:"info",displayName:a.DICT("Log_Information")});"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity&&"error"!==a.ctx.email.severity&&"warning"!==
a.ctx.email.severity&&"notice"!==a.ctx.email.severity&&"info"!==a.ctx.email.severity)&&(a.ctx.email.severity="info");break;case "debug":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")}),a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")}),a.schema.email_severity.push({id:"critical",displayName:a.DICT("Log_Critical")}),a.schema.email_severity.push({id:"error",displayName:a.DICT("Log_Error")}),a.schema.email_severity.push({id:"warning",displayName:a.DICT("Log_Warning")}),
a.schema.email_severity.push({id:"notice",displayName:a.DICT("Log_Notification")}),a.schema.email_severity.push({id:"info",displayName:a.DICT("Log_Information")}),a.schema.email_severity.push({id:"debug",displayName:a.DICT("Log_Debugging")}),"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity&&"error"!==a.ctx.email.severity&&"warning"!==a.ctx.email.severity&&"notice"!==a.ctx.email.severity&&"info"!==a.ctx.email.severity&&"debug"!==a.ctx.email.severity)&&
(a.ctx.email.severity="debug")}},r=function(){a.model.syslog["global-logging-action"]?null==a.model.syslog["global-logging-action"].none&&(a.ctx.log.enable=!1):a.ctx.log.enable=!0;a.model.syslog["file-logging-action"]["file-logging-archive"]?(a.ctx.log.usb=a.model.syslog["file-logging-action"]["file-logging-archive"]["file-number"],a.ctx.log.usb_enable=!0):a.ctx.log.usb_enable=!1;a.model.syslog["file-logging-action"]["file-size"]=a.model.syslog["file-logging-action"]["file-size"]||"1024";a.model.syslog["file-logging-action"]["logging-facilities"]=
a.model.syslog["file-logging-action"]["logging-facilities"]||[];a.ctx.email=a.model.syslog["email-logging-action"];a.ctx.email.severity=a.ctx.email.severity||"notice";a.ctx.log.severity=a.ctx.log.severity||"notice";a.ctx.email["queue-length"]=a.ctx.email["queue-length"]||"50";a.ctx.email["email-subject"]=a.ctx.email["email-subject"]||"";a.ctx.facility={kern:!1,system:!1,firewall:!1,network:!1,vpn:!1,"ssl-vpn":!1,license:!1,"web-filter":!1,"application-control":!1,user:!1,mobile:!1,wireless:!1,pnp:!1,
"anti-virus":!1,ips:!1};angular.forEach(a.model.alert["email-alerting-action"]["alert-facilities"],function(b,c){a.ctx.alert[b.facility]=b});angular.forEach(a.model.syslog["file-logging-action"]["logging-facilities"],function(b,c){var e=b.facility;a.ctx.log.severity=b.severity;a.ctx.facility[e]=!0});var b=0,e=a.model.syslog["remote-logging-action"]["remote-logging-destination"]||[];a.ctx.server1="";a.ctx.server2="";a.ctx.transport1="UDP";a.ctx.port1=514;a.ctx.transport2="UDP";a.ctx.port2=514;for(b=
0;b<e.length;b++)1==e[b].order&&(a.ctx.server1=e[b].destination,e[b].transport&&(a.ctx.transport1=e[b].transport||"UDP"),e[b].port&&(a.ctx.port1=e[b].port||514)),2==e[b].order&&(a.ctx.server2=e[b].destination,e[b].transport&&(a.ctx.transport2=e[b].transport||"UDP"),e[b].port&&(a.ctx.port2=e[b].port||514));v()},v=function(){var b=!1;angular.forEach(a.ctx.facility,function(a){a||(b=!0)});a.ctx.log.all=!b};a.updatefacility=function(b,e){e||v();var d=w("filter")(a.model.syslog["file-logging-action"]["logging-facilities"],
{facility:b},!0);if(a.ctx.facility[b]){var c={facility:b,severity:a.ctx.log.severity};d.length||a.model.syslog["file-logging-action"]["logging-facilities"].push(c)}else c=w("filter")(a.model.syslog["file-logging-action"]["logging-facilities"],{facility:b},!0),c=a.model.syslog["file-logging-action"]["logging-facilities"].indexOf(c[0]),d.length&&a.model.syslog["file-logging-action"]["logging-facilities"].splice(c,1)};a.updatealert=function(b){var e=!0;angular.forEach(a.ctx.alert,function(a){a.enable||
(e=!1)});a.ctx.email.all=e};a.save=function(b,e){(function(){a.model.syslog["remote-logging-action"]["remote-logging-destination"]=[];a.ctx.server1&&a.model.syslog["remote-logging-action"]["remote-logging-destination"].push({destination:a.ctx.server1,order:1,transport:a.ctx.transport1,port:a.ctx.port1});a.ctx.server2&&a.model.syslog["remote-logging-action"]["remote-logging-destination"].push({destination:a.ctx.server2,order:2,transport:a.ctx.transport2,port:a.ctx.port2});!0==a.ctx.log.usb_enable&&
(a.model.syslog["file-logging-action"]["file-logging-archive"]["file-number"]=a.ctx.log.usb);var b=[],c;for(c in a.ctx.facility)a.ctx.facility[c]&&b.push({facility:c});c=[];switch(a.ctx.log.severity){case "emergency":c.push({severity:"emergency"});break;case "alert":c.push({severity:"emergency"});c.push({severity:"alert"});break;case "critical":c.push({severity:"emergency"});c.push({severity:"alert"});c.push({severity:"critical"});break;case "error":c.push({severity:"emergency"});c.push({severity:"alert"});
c.push({severity:"critical"});c.push({severity:"error"});break;case "warning":c.push({severity:"emergency"});c.push({severity:"alert"});c.push({severity:"critical"});c.push({severity:"error"});c.push({severity:"warning"});break;case "notice":c.push({severity:"emergency"});c.push({severity:"alert"});c.push({severity:"critical"});c.push({severity:"error"});c.push({severity:"warning"});c.push({severity:"notice"});break;case "info":c.push({severity:"emergency"});c.push({severity:"alert"});c.push({severity:"critical"});
c.push({severity:"error"});c.push({severity:"warning"});c.push({severity:"notice"});c.push({severity:"info"});break;case "debug":c.push({severity:"emergency"}),c.push({severity:"alert"}),c.push({severity:"critical"}),c.push({severity:"error"}),c.push({severity:"warning"}),c.push({severity:"notice"}),c.push({severity:"info"}),c.push({severity:"debug"})}b={"syslog-view-stat":{"logging-facilities":b,"logging-sevirity":c}};c=[];c.push({method:"set_log",params:{syslog:a.model.syslog,alert:a.model.alert}});
c.push({method:"set_view_logs",params:b});m.post({method:"set_bulk",params:c,success:function(b){a.success=!0;n()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})();a.resetModified()};a.cancel=function(){n();a.resetModified()};a.email_all=function(){if(!0==a.ctx.email.all)for(var b in a.ctx.alert)a.ctx.alert[b].enable=!0;else for(b in a.ctx.alert)a.ctx.alert[b].enable=!1};a.log_all=function(){angular.forEach(a.ctx.facility,function(b,e){a.ctx.facility[e]=
a.ctx.log.all;a.updatefacility(e,!0)})};a.log_enable=function(){!1==a.ctx.log.enable?(a.model.syslog["global-logging-action"]={},a.model.syslog["global-logging-action"].none=null,a.ctx.email.enable=!1,a.model.syslog["remote-logging-action"].enable=!1):delete a.model.syslog["global-logging-action"]};a.severity_change=function(){angular.forEach(a.model.syslog["file-logging-action"]["logging-facilities"],function(b,e){b.severity=a.ctx.log.severity});l()};a.usb=function(){var e=m.post({url:resource_base+
"data/log.json",method:"action",params:{rpc:"usb-check-attached"},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e]).then(function(b){for(var d=0;d<b.length;d++)angular.extend(a.model,b[d].data.result)});!0==a.ctx.log.usb_enable?(a.model.syslog["file-logging-action"]["file-logging-archive"]=a.model.syslog["file-logging-action"]["file-logging-archive"]||{},a.model.syslog["file-logging-action"]["file-logging-archive"]["file-number"]=a.ctx.log.usb):delete a.model.syslog["file-logging-action"]["file-logging-archive"]}}]);app.controller("emailCtrl",["$scope","MyHttp","UserSession","userAccessRight","goToPreviousPage","oneTimeLocker",function(a,b,t,m,w,u){var p=u.get("comefromviewlog");a.success=!1;a.loadReady=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var q=function(){b.post({url:resource_base+"data/config_email.json",method:"get_email",success:function(a){e(a.data.result)},error:function(a){Log(ERROR,"emailCtrl error, status: "+a.status)}})},e=function(b){b=b["email-server"]||
{};var e=parseInt(b["smtp-port"],10);isNaN(e)&&(e=25);a.model.smtp_server=b["smtp-server"]||"";a.model.orig_smtp_server=b["smtp-server"]||"";a.model.smtp_port=e;a.model.encryption=b.encryption||a.model.schema.encryption[0].id;a.model.authentication=b.authentication||a.model.schema.authentication[0].id;a.model.user_name=b["user-name"]||"";a.model.from_email_address=b["from-email-address"]||"";a.model.to_email_addresses=["",""];a.model.modified_pwd=!1;b.password&&(a.model.password="00000000");angular.forEach(b["to-email-addresses"],
function(b,e){a.model.to_email_addresses[e]=b["email-address"]});a.model.orig_email_addresses=angular.copy(a.model.to_email_addresses);a.resetModified();a.loadReady=!0},x=function(){var b={"smtp-server":a.model.smtp_server,"smtp-port":a.model.smtp_port,encryption:a.model.encryption,authentication:a.model.authentication,"user-name":a.model.user_name,"to-email-addresses":[],"from-email-address":a.model.from_email_address};a.model.modified_pwd&&(b.password=a.model.password);angular.forEach(a.model.to_email_addresses,
function(a,e){0<a.length&&b["to-email-addresses"].push({"email-address":a})});return b};a.model={smtp_server:"",smtp_port:"",encryption:"",authentication:"",user_name:"",password:"",to_email_addresses:[],from_email_address:"",schema:{},orig_email_addresses:[],back_btn:!1,comefromviewlog:!1};var n=function(a,e){b.post({method:"set_email",params:{"email-server":x()},success:function(b){_.isFunction(a)&&a()},error:function(a){_.isFunction(e)&&e()}})};a.change_pwd=function(){a.model.modified_pwd=!0};
a.funs={save:function(b){n(function(){a.success=!0;q();a.resetModified()},function(){q();a.resetModified()})},cancel:function(){q();a.resetModified()},test:function(){n(function(){b.post({method:"action",forcedUsingPost:!0,params:{rpc:"test-connectivity"},success:function(b){0===(b.data&&b.data.result&&b.data.result.output&&b.data.result.output.code)?app.TOOLS.successAlertBox({title:a.DICT("Information"),msg:a.DICT("Email_Test_SMTP_Server_Success",{"%s":a.model.smtp_server}),cbk:function(){q()}}):
app.TOOLS.criticalAlertBox({title:a.DICT("Alert"),msg:a.DICT("Email_Test_SMTP_Server_Failed",{"%s":a.model.smtp_server}),cbk:function(){q()}})},error:function(b){app.TOOLS.criticalAlertBox({title:a.DICT("Alert"),msg:a.DICT("Email_Test_SMTP_Server_Failed",{"%s":a.model.smtp_server}),cbk:function(){q()}})}})},function(){app.TOOLS.criticalAlertBox({title:a.DICT("Email_Alert"),msg:a.DICT("Email_Apply_Email_Configure_Failure"),cbk:function(){q()}})})},reset:function(){app.TOOLS.warningAlertBox({title:a.DICT("Warning"),
msg:a.DICT("Email_Confirm_Reset_Configure"),cbk:function(b){b&&(a.model.smtp_server="",a.model.smtp_port=25,a.model.encryption=a.model.schema.encryption[0].id,a.model.authentication=a.model.schema.authentication[0].id,a.model.user_name="",a.model.password="",a.model.from_email_address="",a.model.to_email_addresses=[],n(function(){q()},function(){app.TOOLS.criticalAlertBox({title:a.DICT("Email_Alert"),msg:a.DICT("Email_Reset_Email_Configure_Failure"),cbk:function(){}})}))}})},go_back:function(){w.goback(function(b){b&&
a.model.comefromviewlog&&u.put("needbackbtnbyemail",!0)})}};w.isneed()&&(a.model.back_btn=!0);p&&(a.model.comefromviewlog=!0);a.model.schema={encryption:[{id:"NONE",displayName:a.DICT("Email_NONE")},{id:"TLS",displayName:a.DICT("Email_TLS_SSL")}],authentication:[{id:"NONE",displayName:a.DICT("Email_NONE")},{id:"LOGIN",displayName:a.DICT("Email_LOGIN")},{id:"PLAINTEXT",displayName:a.DICT("Email_PLAINTEXT")},{id:"MD5",displayName:a.DICT("Email_MD5")}]};q()}]);app.controller("user_account_main",["$scope","$q","$location","rpcFns","modelInfo","MyHttp","oneTimeLocker","$templateCache","Sets","$timeout","Upload","goToPreviousPage","UserSession","userAccessRight","passwordComplex","$filter","$cookies","sessionAPI",function(a,b,t,m,w,u,p,q,e,x,n,l,r,v,s,k,d,c){var h={source:"http",getResult:function(a,b,c){return e.getResult(this,a,b,c)}};a.goBackPreviousPage=l.goback;a.model=a.model||{};a.ctx=a.ctx||{};a.success=!1;a.loadReady=!1;a.ctx.pwMeterInvalid=!1;a.backbtn=
!1;a.pcFile=void 0;a.needLogout=!1;a.spec={WIFI_CAPTIVE_PORTAL_SUPPORT:!1};l.isneed()&&(a.backbtn=!0);w.get_pid().match("^RV340W")?a.spec.WIFI_CAPTIVE_PORTAL_SUPPORT=!0:a.spec.WIFI_CAPTIVE_PORTAL_SUPPORT=!1;a.forcedUsingPost=!0;var g={procBackground:!0,forcedUsingPost:a.forcedUsingPost},A={procBackground:!1,forcedUsingPost:a.forcedUsingPost};a.pageMap={main:"UserAccountMain.html",user_edit:"LocalUsersEditSection.html",ras_edit:"RASEdit.html"};var y=a.pageMap,z=a.fop={get_groups_ref:function(){return a.model.groups},
get_nacm_user_ref:function(){a.model.nacm_users=a.model.nacm_users||[];return a.model.nacm_users},get_username:function(a){return a.user_name},get_ras_ref:function(b){a.model.ras=a.model.ras||[];return a.model.ras},get_password_complex_ref:function(b){a.model.password_complex=a.model.password_complex||{};return a.model.password_complex}};a.flagGetOutside=!1;var B=angular.copy(p.get("USER_ACCOUNT"));B&&B.username?(a.flagGetOutside=!0,a.currPage=y.user_edit):a.currPage=y.main;a.userAccessFlag=v.get();
"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&r.logout();var D={user_groups:b.defer(),ras:b.defer(),users:b.defer(),complexity:b.defer(),aging_time:b.defer(),web_session_timeout:b.defer()},E=function(){var a={};D.user_groups=b.defer();return"dproxy"==h.source?(proxy.Groups.init(function(){var b=proxy.Groups.get_config();e.recover_object(b,a);D.user_groups.resolve(b)}),D.user_groups.promise):u.post({url:resource_base+"data/aaatrans_groups.json",method:"get_groups",options:{transformResponse:app.modelhelper.db2webFn},
success:function(a){},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},C=function(){var c={};D.ras=b.defer();return"dproxy"==h.source?(proxy.RemoteAuthenticationService.init(function(){var a=proxy.RemoteAuthenticationService.get_config();e.recover_object(a,c);D.ras.resolve(a)}),D.ras.promise):u.post({url:resource_base+"data/aaatrans_ras.json",method:"get_ras",options:{transformResponse:app.modelhelper.db2webFn},success:function(b){var c={default_order:["radius",
"ldap","ad","local-db"]};e.default_result(b,{remote_authentication_services:{remote_authentication_service:[],authentication_order:{services:[]}}});var d=b.data.result.remote_authentication_services.authentication_order;if(d.default_order){if(d.default_order[0]&&-1<d.default_order[0].indexOf(":"))for(var c=0,g;c<d.default_order.length;c++)g=d.default_order[c],d.default_order[c]=g.replace(/^[a-z-]+:/,"")}else e.recover_object(d,c);var c=d.services,k,l;for(g=c.length-1;0<=g;g--){k=c[g];l=!1;if("ezvpn"===
k.service||"web-login-readonly"===k.service)l=!0;if(!a.spec.WIFI_CAPTIVE_PORTAL_SUPPORT&&("ssid"===k.service||"captive-portal"===k.service))l=!0;P.service_display(k.service)==="(_undef_) - "+k.service&&(l=!0);l&&c.splice(g,1)}l=c;c=Array.apply(null,Array(Math.max(10,l.length))).map(String.prototype.valueOf,"_");g=l.length-1;for(k;0<=g;g--){k=l[g];var n={"web-login-administration":0,"s2s-vpn":1,"anyconnect-vpn":2,ssid:3,"captive-portal":3,pptp:4,l2tp:5,dot1x:6}[k.service];angular.isDefined(n)?c[n]=
k:c.push(k)}g=c.length-1;for(k;0<=g;g--)k=c[g],"_"===k&&c.splice(g,1);g=c.length-1;for(k;0<=g;g--)k=c[g],k.order||(k.order=[]);d.services=c;b.data.result&&(d=h.getResult(b,"remote_authentication_services")||{},b.data.result=d)},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},I=function(){D.complexity=b.defer();return"dproxy"==h.source?void 0:u.post({url:resource_base+"data/aaatrans_password_complexity.json",method:"get_password_complexity",options:{transformResponse:app.modelhelper.db2webFn},
success:function(a){e.default_result(a,{password_complexity:{}});if(a.data.result){var b=h.getResult(a,"password_complexity")||{};angular.isDefined(b.enabled)&&(b.complex_enable=b.enabled,delete b.enabled);a.data.result.password_complex=b}},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},G=function(){D.aging_time=b.defer();return"dproxy"==h.source?void 0:u.post({url:resource_base+"data/aaatrans_password_aging_time.json",method:"get_password_aging_time",options:{transformResponse:app.modelhelper.db2webFn},
success:function(a){e.default_result(a,{password_aging_time:{}})},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},H=function(){D.web_session_timeout=b.defer();return"dproxy"==h.source?void 0:u.post({url:resource_base+"data/aaatrans_web_session_timeout.json",method:"get_web_session_timeout",options:{transformResponse:app.modelhelper.db2webFn},success:function(a){e.default_result(a,{web_session_timeout:{}})},error:function(a){Log(ERROR,"AJAX loading error: "+
a.status+", URL: "+a.config.url)}})},F=function(){D.users=b.defer();var a=h.source;if("dproxy"==a){var c={};proxy.Users.init(function(){c=proxy.Users.get_config();D.users.resolve(c)});return D.users.promise}return"u2d_http"==a?u.post({url:resource_base+"p_data/u2d_users.json",method:"u2d_get_users",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}):u.post({url:resource_base+"data/aaatrans_users.json",method:"get_users",options:{transformResponse:app.modelhelper.db2webFn},
error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},K=function(){a.model={};a.ctx={};a.loadReady=!1;b.all({user_groups:E(),ras:C(),complexity:I(),aging_time:G(),web_session_timeout:H(),users:F()}).then(function(b){var c=angular.copy(h.getResult(b.ras,"remote_authentication_service"));angular.forEach(c,function(a){"RADIUS"===a.name&&(a.radius_setting||(a.radius_setting={}),_.isNumber(a.radius_setting.retry_timeout)||(a.radius_setting.retry_timeout=5),_.isNumber(a.radius_setting.retry_limit)||
(a.radius_setting.retry_limit=2))});a.model.ras=c;c=angular.copy(h.getResult(b.ras,"authentication_order"));a.model.ras_ao=c;a.model.password_complex=h.getResult(b.complexity,"password_complex")||{};a.model.password_aging_time=h.getResult(b.aging_time,"password_aging_time")||{};a.model.web_session_timeout=h.getResult(b.web_session_timeout,"web_session_timeout")||{};c=h.getResult(b.user_groups,"groups").group;a.model.groups=c;a.model.users=h.getResult(b.users,"users");(b=a.model.password_complex)&&
s.update_config(b);N();a.schema=a.schema||{};a.schema.rasAuth=[{id:"radius",displayName:a.DICT("User_Accounts_RADIUS")},{id:"ad",displayName:a.DICT("User_Accounts_Active_Directory")},{id:"ldap",displayName:a.DICT("User_Accounts_LDAP")}];a.schema.rasAuthMap={radius:"Radius",ad:"Active Directory",ldap:"LDAP"};a.ctx=a.ctx||{};S();J();R();W();M();a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.gridUserList.editState="main";a.gridRAS.editState="main";a.login_username=d.get("user");
P.prepareAOCtx();P.updateGridAuthenticationOrderOptions();a.gridUserList.Options.data=a.model.users.user;a.gridRAS.Options.data=a.model.ras;a.gridAO.Options.data=a.model.ras_ao.services;a.gridRAS.checkRASField();var g=function(b){var c=b.username;angular.forEach(a.model.users.user,function(d,g){if(d.name==c&&(a.gridUserList.selectedEditItem=d,a.gridUserList.editState="edit",a.currPage=y.user_edit,angular.isDefined(b.forceChangePW)))switch(a.ctx.forceChangePW=!1,a.ctx.pwdAging=!1,b.redirect_admin){case "1":a.ctx.forceChangePW=
!0;break;case "2":a.ctx.pwdAging=!0}})};x(function(){a.gridRAS.Selections=[];a.flagGetOutside&&(a.loadReady=!1,g(B));a.loadReady=!0},100)})["catch"](function(a){Log(ERROR,"==catch "+a)})};a.updateRASAuthInuse=function(){a.ctx.RASAuthInuse=[];var b=z.get_ras_ref();angular.forEach(b,function(b,c){a.ctx.RASAuthInuse.push(b.authenticate_mode)})};var M=function(){var b=z.get_ras_ref();angular.forEach(b,function(a,b){a.ldap_setting?a._ref=a.ldap_setting:a.radius_setting?a._ref=a.radius_setting:a.ad_setting&&
(a._ref=a.ad_setting);a.radius_setting=a.radius_setting||{};a.ldap_setting=a.ldap_setting||{};a.ad_setting=a.ad_setting||{}});a.updateRASAuthInuse()},N=function(){e.recover_object(a.model,{password_complex:{complex_enable:!1,minimum_length:8,minimum_number_character_classes:3,new_must_different_than_current:!1}});e.recover_object(a.model,{users:{user:[]}});angular.forEach(a.model.ras,function(b){a.update_ras_auth_type(b)});angular.forEach(a.model.users.user,function(a,b){a.old_name=a.name;a.checked=
!1;a.number=b+1});angular.forEach(a.model.ras_ao.services,function(b){b.ao_invalid=!1;b.service_name=a.ao.service_display(b.service);"web-login-administration"===b.service&&("local-db"!==b.order[0]&&"local-db"!==b.order[1]&&!b.use_default_order)&&(b.ao_invalid=!0)});a.users_sample={name:"admin",group:"admin"}},J=function(){var b=!1,c=a.model.users,d=z.get_nacm_user_ref();angular.forEach(d,function(a,d){angular.forEach(c.user,function(c,d){a.name==c.name&&(a._ref_aaa=c,c.$$parentNode=a,b=!0)})});b||
Log(ERROR,"Error: AAA ref not exist")},R=function(){angular.forEach(a.model.users.user,function(a,b){a.password&&(a._pw_exist=!0);delete a.password})},W=function(){var a=z.get_ras_ref();angular.forEach(a,function(a,b){a.radius_setting&&a.radius_setting.preshared_key&&(a.radius_setting._pk_exist=!0,delete a.radius_setting.preshared_key)})},S=function(){var a=function(a){var b=z.get_nacm_user_ref(),c={_usertmp:{}};angular.forEach(a,function(a,b){var d=z.get_username(a);if(d&&d[0])for(var g=d.length,
e;g--;)e=d[g],void 0==c._usertmp[e]&&(c._usertmp[e]={group:[]}),c._usertmp[e].group[b]=a.name,c._usertmp[e].same_group_count=d.length});b&&b.splice(0);for(var d in c._usertmp)b.push({name:d,join:!1,group:c._usertmp[d].group,same_group_count:c._usertmp[d].same_group_count});delete c._usertmp},b=z.get_groups_ref();b&&a(b)},X=function(a,b,c){var d=z.get_groups_ref();angular.forEach(d,function(d,g){if(d.name==a||void 0===a){var e=z.get_username(d),h=-1;e&&e[0]&&(h=e[0].indexOf(c));b?-1==h&&(e&&e[0]?e[0]+=
(0<e[0].length?" ":"")+c:(e.splice(0),e.push(c))):-1<h&&e&&e[0]&&(e[0]=e[0].replace(c,"").replace("  "," ").replace(/^ /,"").replace(/ $/,""))}})};a.syncUserName=function(a){angular.forEach(a.group,function(b,c){X(b,!1,a._oldname)});a._oldname=a.name;angular.forEach(a.group,function(b,c){X(b,!0,a.name)});a._ref_aaa.name=a.name};a.idTrue=!0;a.idFalse=!1;a.selected=a.selected||{};var T=function(){var b=a.gridUserList.Selections,c=!1,d={admin:0};a.gridUserList.disabledDeleteBtn=!1;angular.forEach(b,
function(b,g){"cisco"===b.name&&(c=!0);b.name===a.login_username&&(c=!0);"admin"==b.group&&(d.admin+=1)});angular.forEach(b,function(a,b){"admin"==a.group&&(a.$$parentNode&&a.$$parentNode.same_group_count<=d.admin)&&(c=!0)});a.gridUserList.disabledDeleteBtn=c};t=function(b){b=a.model.users.user;a.gridUserList.Selections=[];a.gridUserList.disabledDeleteBtn=!1;angular.forEach(b,function(b){b.checked&&a.gridUserList.Selections.push(b)});T()};a.gridUserList={};a.gridUserList.Selections=[];a.gridUserList.disabledDeleteBtn=
!1;a.gridUserList.Options=app.uiGrid.generateGridOptions({IDPreifx:"localUserMembership",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t},{field:"number",displayName:"#",width:50},{field:"name",displayName:a.DICT("User_Accounts_User_Name"),width:200},{field:"group",displayName:a.DICT("User_Accounts_Group_S")}]});a.gridUserList.add=function(b){b=a.model.users.user;var c={name:"",group:z.get_groups_ref()[0].name,password:"",checked:!1,number:-1};400<=b.length?(b=a.DICT("User_Accounts_Reach_Max_Entry",
{"%d":400}),app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})):(a.ctx&&a.ctx.user&&(a.ctx.user.password="",a.ctx.user.confirm_password=""),c.checked=!0,c.number=b.length+1,b.push(c),a.gridUserList.selectedEditItem=c,a.gridUserList.editState="add",a.currPage=y.user_edit)};a.gridUserList.edit=function(){var b;angular.forEach(a.model.users.user,function(c){c.checked&&(b=a.gridUserList.selectedEditItem=c)});a.ctx.user=b&&b._pw_exist?{password:"12345678901234567890123456789012",confirm_password:"abcdefghijabcdefghijabcdefghijab"}:
{password:"",confirm_password:""};a.success=!1;a.currPage=y.user_edit;a.gridUserList.editState="edit"};a.gridUserList.remove=function(){var b=a.model.users.user,c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);a.modified()};a.gridUserList.doDownloadTmpl=function(){var a=0,b=function(d){if(d){var g=d.split("/"),g=app.TOOLS.download_save_to(d,g[g.length-1],"application/octet-stream");g.then(function(a){});g.fail(function(g){2<=a?c(2):x(function(){a++;b(d)},1E3)})}else c(3)},c=function(a){app.TOOLS.criticalAlertBox({msg:"Download Fail("+
a+")",cbk:function(a){}})};m.RPC_generic_send("file-download",{fileType:"user-template"},function(a,d,g){a=g.code;var e=g.errstr;switch(a){case 0:var h=g["download-url"]||void 0;x(function(){b(h)},1E3);break;default:c(1),Log(ERROR,d+": RPC done. got unknown code: "+a+" errstr= "+e)}},void 0,g)};a.gridUserList.doImportUserList=function(b){var c={};Log(DEBUG,"-pc-");a.formUpload=!0;b&&a.upload(b,c)};a.getAttr=function(a,b,c){if(a)return a[b];if(c)return c[b]};a.clean_backup_port=function(a,b){a&&""===
b.$viewValue&&(a.backup_server_port="")};a.update_prekey=function(b,c){b.$dirty&&b.$valid?c.preshared_key=a.ctx.ras.prekey:c.preshared_key&&delete c.preshared_key};a.update_passwd=function(b){var c=a.gridUserList.selectedEditItem,d=a.ctx.user.password;""===d&&!angular.isDefined(a.ctx.user.confirm_password)&&(a.ctx.user.confirm_password="");x(function(){b.$valid?c.password=d:c.password&&delete c.password},0)};a.select_group_disabled=function(a){return a&&a.$$parentNode&&-1<a.$$parentNode.group.indexOf("admin")&&
1>=a.$$parentNode.same_group_count?!0:!1};a.updateRASenable=function(b){for(var c=b.entity.authenticate_mode,d=z.get_ras_ref(),g=0;g<d.length;g++)d[g]!=b.entity&&d[g].authenticate_mode==c&&(d[g].enable=!1);a.gridRAS.checkRASField()};a.chunkSize=512;var L=function(b,c,d){d.fileparam="file001.csv";b.upload=n.upload({url:resource_base+"upload"+a.getReqParams(),resumeSizeUrl:c?resource_base+"upload?name22="+encodeURIComponent(b.name):null,resumeChunkSize:c?a.chunkSize:null,headers:{"optional-header":"header-value"},
data:{sessionid:"EU6DJKEIWO",pathparam:"User",fileparam:"file001.csv",file:b}});b.upload.then(function(c){x(function(){b.result=c.data;Log(DEBUG,"do rpc Upload");a.RPC_import_users(d)})},function(b){0<b.status&&(a.errorMsg=b.status+": "+b.data);Log(Error,"do upload error")},function(a){b.progress=Math.min(100,parseInt(100*a.loaded/a.total,10))});b.upload.xhr(function(a){})};a.getReqParams=function(){return a.generateErrorOnServer?"?errorCode="+a.serverErrorCode+"&errorMessage="+a.serverErrorMsg:""};
a.upload=function(b,c){a.errorMsg=null;L(b,!1,c)};a.RPC_save_to_cdb=function(){m.RPC_generic_send("file-copy",{fileType:"configuration",source:{"config-type":"config-running"},destination:{"config-type":"config-startup"}},function(b,c,d){b=d.code;var g=d.errstr;a.ctx.displayresult=!0;switch(b){case 0:r.logout();a.ctx.errstr=g;a.ctx.return_code=!0;break;default:Log(ERROR,c+": RPC done. got unknown code: "+b+" errstr= "+g),x(function(){Log(ERROR,"save_to_cdb Exception: "+g)},200),a.ctx.errstr=g,a.ctx.return_code=
!1}},void 0,A)};a.RPC_import_users=function(b){m.RPC_generic_send("import-users",{file:"FILE://AAA/"+b.fileparam},function(b,c,d){b=d.code;var g=d.errstr;a.ctx.displayresult=!0;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");K();a.ctx.errstr=g;a.ctx.return_code=!0;break;default:Log(ERROR,c+": RPC done. got unknown code: "+b+" errstr= "+g),x(function(){Log(ERROR,"Import Exception: "+g)},200),K(),a.ctx.errstr=g,a.ctx.return_code=!1}},void 0,A)};t=function(){a.gridRAS.Selections=[];
angular.forEach(a.model.ras,function(b){b.checked&&a.gridRAS.Selections.push(b)})};a.gridRAS={};a.gridRAS.Selections=[];a.gridRAS.Options=app.uiGrid.generateGridOptions({IDPreifx:"remoteAuthService",enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t},{field:"enable",displayName:a.DICT("User_Accounts_Enable"),width:90,id:"remoteAuthEnable",cellTemplate:q.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/,'ng-change="grid.appScope.updateRASenable(row)"')},
{field:"name",displayName:a.DICT("User_Accounts_Name"),width:200},{field:"_ref.primary_server",displayName:a.DICT("User_Accounts_Primary_Server")},{field:"_ref.backup_server",displayName:a.DICT("User_Accounts_Backup_Server")}]});var U=function(){var b=a.gridRAS.collectAvailAuthmode(),c="radius";b&&(b[0]&&b[0].id)&&(c=b[0].id);b={name:"",authenticate_mode:c,enable:!1,radius_setting:{primary_server:"",primary_server_port:1645,backup_server:"",backup_server_port:"",preshared_key:"",retry_timeout:5,retry_limit:2},
ad_setting:{},ldap_setting:{}};b._ref=b[b.authenticate_mode+"_setting"];return b};a.gridRAS.remove=function(){var b=a.model.ras,c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);a.updateRASAuthInuse();a.modified()};a.update_ras_auth_type=function(a){a._ref=a[a.authenticate_mode+"_setting"]};a.gridRAS.add=function(){var b=a.model.ras,c=U();angular.forEach(b,function(a){a.checked=!1});c.checked=!0;c.number=b.length+1;b.push(c);a.gridRAS.Selections=[c];a.update_ras_auth_type(c);a.currPage=y.ras_edit;
a.gridRAS.editState="add";a.success=!1};a.gridRAS.edit=function(){var b=a.gridRAS.Selections[0];a.ctx.ras=void 0!=b&&b._ref&&b._ref._pk_exist?{prekey:"12345678901234567890123456789012",confirm_prekey:"abcdefghijabcdefghijabcdefghijab"}:{prekey:"",confirm_prekey:""};a.update_ras_auth_type(b);a.currPage=y.ras_edit;a.gridRAS.editState="edit";a.gridRAS.disableApplyBtn=!1;a.success=!1};a.gridRAS.checkRASField=function(){a.gridRAS.disableApplyBtn=!1;angular.forEach(a.model.ras,function(b){if(b.enable)switch(b.authenticate_mode){case "ad":if(!b.ad_setting||
!b.ad_setting.primary_server||!_.isNumber(b.ad_setting.primary_server_port))a.gridRAS.disableApplyBtn=!0;break;case "ldap":if(!b.ldap_setting||!b.ldap_setting.primary_server||!_.isNumber(b.ldap_setting.primary_server_port))a.gridRAS.disableApplyBtn=!0;break;case "radius":if(!b.radius_setting||!b.radius_setting.primary_server||!_.isNumber(b.radius_setting.primary_server_port))a.gridRAS.disableApplyBtn=!0}})};var V=function(b,c,d){c=a.ctx.RASAuthInuse;for(d=0;d<c.length;d++)if(b.id==c[d])return!1;return!0};
a.gridRAS.collectAvailAuthmode=function(){return k("filter")(a.schema.rasAuth,V)||[]};var P=a.ao={AOOPT_NONE:null,updateGridAuthenticationOrderOptions:function(){a.gridAO={};a.gridAO.disabledCheckbox=function(a){switch(a.entity.service){case "dot1x":case "pptp":case "l2tp":return a.entity.use_default_order=!1,!0;default:return!1}};a.gridAO.checkAUSeq=function(a){a=a.entity;a.ao_invalid=!1;"web-login-administration"===a.service&&(!a.use_default_order&&"local-db"!==a.order[0]&&"local-db"!==a.order[1])&&
(a.ao_invalid=!0)};a.gridAO.clickUseDefault=function(a){a=a.entity;if(a.use_default_order)switch(a.service){case "web-login-administration":a.ao_invalid=!1;a.order[0]="radius";a.order[1]="local-db";break;case "s2s-vpn":case "captive-portal":case "ssid":case "anyconnect-vpn":a.order[0]="radius",a.order[1]="ldap"}};a.gridAO.Options=app.uiGrid.generateGridOptions({IDPreifx:"AO_Services",enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,columnDefs:[{field:"service_name",displayName:a.DICT("User_Accounts_Service"),
minWidth:400},{field:"use_default_order",displayName:a.DICT("User_Accounts_Use_Default"),minWidth:150,id:"ao_def_order",cellTemplate:q.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/,'ng-disabled="grid.appScope.gridAO.disabledCheckbox(row, col, grid)" ng-change="grid.appScope.gridAO.clickUseDefault(row)"')},{field:"order[0]",displayName:a.DICT("User_Accounts_Customize_Primary"),minWidth:200,id:"ao_primary",cellTemplate:q.get("UG_genericSelect.html").replace(/NGOPTIONS/,"p.id as p.disaplyName for p in grid.appScope.ao.get_order_list(row.entity, 0) ").replace(/data-ng-expansion/,
'id="{{\'slct_ao_mode0_\'+grid.appScope.gridFuns.getRowIndex(row, col, grid)}}"ng-disabled="row.entity.use_default_order" required ng-change="grid.appScope.gridAO.checkAUSeq(row)" grid-invalid-field="\'ao_invalid\'"')},{field:"order[1]",displayName:a.DICT("User_Accounts_Customize_Secondary"),minWidth:200,id:"ao_backup",cellTemplate:q.get("UG_genericSelect.html").replace(/NGOPTIONS/,"p.id as p.disaplyName disable when (row.entity.order[0] === p.id) for p in grid.appScope.ao.get_order_list(row.entity, 1) ").replace(/data-ng-expansion/,
'id="{{\'slct_ao_mode1_\'+grid.appScope.gridFuns.getRowIndex(row, col, grid)}}" ng-disabled="row.entity.use_default_order || grid.appScope.ao.get_order_list(row.entity, 1).length <= 2"ng-change="grid.appScope.gridAO.checkAUSeq(row)" grid-invalid-field="\'ao_invalid\'"')}]})},service_display:function(b){var c="";switch(b){case "web-login-administration":c=a.DICT("User_Accounts_Web_Login");break;case "s2s-vpn":c=a.DICT("User_Accounts_Site_to_site_EzVPN_3rd_Party_Client_to_site_VPN");break;case "anyconnect-vpn":c=
a.DICT("User_Accounts_AnyConnect_SSL_VPN");break;case "captive-portal":case "ssid":c=a.DICT("User_Accounts_Captive_Portal");break;case "pptp":c=a.DICT("User_Accounts_PPTP_Server");break;case "l2tp":c=a.DICT("User_Accounts_L2TP_Server");break;case "dot1x":c=a.DICT("User_Accounts_802_1x");break;default:c="(_undef_) - "+b}return c},prepareAOCtx:function(){P.prepareOrderList();for(var b=a.model.ras_ao.services,c=a.orderOptions_0,d=!1,g=!1,e=0,h;e<b.length;e++){h=b[e];var d=g=!1,k=P.oopt_map(h.service),
k=c[k];h.order.splice(2);h.order.splice(k.length);for(var l=0,n;l<k.length;l++)n=k[l],h.order[0]===n.id&&(d=!0),h.order[1]===n.id&&(g=!0);d||(h.order[0]=P.AOOPT_NONE);g||(h.order[1]=P.AOOPT_NONE);h.order[0]===P.AOOPT_NONE&&h.order[1]===P.AOOPT_NONE&&(h.order[0]=(a.model.ras_ao.default_order||[P.AOOPT_NONE,P.AOOPT_NONE])[0],"web-login-administration"===h.service&&(h.order[1]="local-db"))}},prepareOrderList:function(b){if(!a.orderOptions_0){var c={id:P.AOOPT_NONE,disaplyName:a.DICT("User_Accounts_None")},
d={id:"radius",disaplyName:a.DICT("User_Accounts_RADIUS")},g={id:"ldap",disaplyName:a.DICT("User_Accounts_LDAP")},e={id:"ad",disaplyName:a.DICT("User_Accounts_Active_Directory")},h={id:"local-db",disaplyName:a.DICT("User_Accounts_Local_DB")};b=function(a){var b;0===a?b={dot1x:[d],pptp:[h,d],l2tp:[h,d],"s2s-vpn":[h,d,g,e],_default:[h,d,g,e]}:1<=a&&(b={dot1x:[c,d],pptp:[c,h,d],l2tp:[c,h,d],"s2s-vpn":[c,h,d,g,e],_default:[c,h,d,g,e]});return b};a.orderOptions_0=b(0);a.orderOptions_1=b(1)}},oopt_map:function(a){var b=
"";switch(a){case "pptp":case "l2tp":case "dot1x":b=a;break;default:b="_default"}return b},get_order_list:function(b,c){var d=P.oopt_map(b.service);if(0===c)return a.orderOptions_0[d];if(1<=c)return a.orderOptions_1[d]},gen_cleaned_ao_metadata:function(a){var b=function(a,b,c,d){b=a[b];b.service===c&&(c=angular.copy(b),c.service=d,a.push(c))};a=angular.copy(a);for(var c=a.length,d=0,g;d<c;d++){g=a[d];void 0!==a[d].ao_invalid&&delete a[d].ao_invalid;var e=g.order.indexOf(P.AOOPT_NONE);-1<e&&g.order.splice(e,
1);b(a,d,"s2s-vpn","ezvpn");b(a,d,"web-login-administration","web-login-readonly")}return a}};a.aaa_user_save=function(){var c=b.defer(),d=function(b){var c=[];if(!0===a.ctx.forceChangePW||a.ctx.pwdAging){var d=a.gridUserList.selectedEditItem;angular.isDefined(d.password)||(d.password="")}var g=void 0;angular.forEach(b,function(b,d){g=angular.isDefined(b.password)?b.password:void 0;var e={name:b.name||void 0,group:b.group||void 0,password:g,old_password:b.old_password||""};b.old_name&&b.old_name!==
b.name&&(b.old_name===a.login_username&&(a.needLogout=!0),e.old_name=b.old_name);c.push(e)});return c},g=[];a.gridUserList.selectedEditItem&&g.push(a.gridUserList.selectedEditItem);var e,h=function(){e=d(g);var b=!0,h=!1,l=function(){app.TOOLS.criticalAlertBox({msg:"Account settings failed, check if you are chosen a protected group <br/>",cbk:function(a){}})},n=function(){app.TOOLS.criticalAlertBox({msg:"Your request was rejected, maybe:\n<br/>  * Old-password is not correct"+(a.model.password_complex.new_must_different_than_current?
", or\n<br/>  * New password are same with current one":""),cbk:function(a){}})};return u.post({url:resource_base+"data/result_set_users.json",method:"set_users",params:{users:{user:e}},success:function(c){var d=k(c);-2==d.code?(b=!1,l()):-1==d.code?(b=!1,n()):1==d.code?(b=h=!0,!a.ctx.forceChangePW&&!a.ctx.pwdAging&&r.logout()):0==d.code?b=!0:Log(ERROR,"Response unknown case: "+c.status+", method: "+this.method+", URL: "+c.config.url+", ret= "+JSON.stringify(d))},error:function(a){c.reject();Log(ERROR,
"AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(d){b&&(!0==a.ctx.forceChangePW||a.ctx.pwdAging)?a.RPC_save_to_cdb():b&&!1==h&&(a.needLogout?r.logout():(a.success=!0,c.resolve()))})},k=function(a){var b={};a.data&&void 0!==a.data.result&&(a=a.data.result,"number"==typeof a?b.code=parseInt(a):"object"==typeof a&&(b=a,b.code=parseInt(b.code)));return b},l=function(b){var d=[],g=a.model.users.user,e;angular.forEach(a.model_orig.users.user,function(a){e=!1;angular.forEach(g,function(b){a.old_name===
b.old_name&&(e=!0);b.name===a.old_name&&(e=!0)});e||d.push({name:a.name})});var h=!0,l=!1,n=function(){var a="Delete user account failed";b&&(a+=", and follows User operation (Add/Set) will be canceled<br/>");app.TOOLS.criticalAlertBox({msg:a,cbk:function(a){}})};d.length?u.post({url:resource_base+"data/result_del_users.json",method:"del_users",params:{users:{user:d}},success:function(a){var b=k(a);-1==b.code?(h=!1,l=!0,n()):0==b.code?h=!0:Log(ERROR,"Response unknown case: "+a.status+", method: "+
this.method+", URL: "+a.config.url+", ret= "+JSON.stringify(b))},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(d){b&&!1==l?b():c.resolve();h&&(a.success=!0)}):b?b():c.resolve()};"add"==a.gridUserList.editState?l(function(){e=d(g);u.post({url:resource_base+"data/rpc_result.json",method:"add_users",forcedUsingPost:a.forcedUsingPost,params:{users:{user:e}},success:function(b){c.resolve();a.success=!0},error:function(a){c.reject();Log(ERROR,"AJAX loading error: "+
a.status+", URL: "+a.config.url)}})}):"edit"==a.gridUserList.editState?a.ctx.forceChangePW?h():l(h):l();return c.promise};a.aaa_save=function(){var d=b.defer(),g=[],e=function(b){return a.form[b]&&!0===a.form[b].$dirty?!0:!1},k=function(b){if(("edit"==a.gridRAS.editState||"add"==a.gridRAS.editState)&&a.gridRAS.Selections&&a.gridRAS.Selections[0])a.gridRAS.Selections[0].enable=!0;b=angular.copy(b);angular.forEach(b,function(a,b){var c=a.authenticate_mode;"radius"==c?(delete a.ad_setting,delete a.ldap_setting,
a.radius_setting&&(null==a.radius_setting.primary_server&&(a.radius_setting.primary_server=""),null==a.radius_setting.primary_server_port&&(a.radius_setting.primary_server_port=""),null==a.radius_setting.backup_server&&(a.radius_setting.backup_server=""),null==a.radius_setting.backup_server_port&&(a.radius_setting.backup_server_port=""))):"ldap"==c?(delete a.radius_setting,delete a.ad_setting):"ad"==c&&(delete a.radius_setting,delete a.ldap_setting);a._ref&&angular.isDefined(a._ref._pk_exist)&&delete a._ref._pk_exist;
a._ref&&delete a._ref;angular.isDefined(a._oldname)&&delete a._oldname;delete a.number;delete a.checked});return b}(z.get_ras_ref()),l=P.gen_cleaned_ao_metadata(a.model.ras_ao.services);(function(a){return angular.copy(a)})(z.get_groups_ref());var n=e("form_pw_complexity")||!1,m=e("form_wst")||!1,r=e("form_ras")||!1,p=e("form_ras_ao")||!1,q={};!0===r&&angular.extend(q,{"remote-authentication-service":k});!0===p&&angular.extend(q,{"authentication-order":{services:l}});!1===r&&!1===p&&(q=void 0);var l=
function(){u.post({url:resource_base+"data/result_set_bulk.json",forcedUsingPost:!0,method:"set_bulk",params:g,success:function(b){c.init();d.resolve();a.success=!0},error:function(a){d.reject();Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},s=function(){var b;b=(!a.ctx||!a.ctx.forceChangePW&&!a.ctx.pwdAging)&&"edit"!==a.gridRAS.editState&&!1===n&&!1===m&&!1===r&&!1===p?!1:!0;if(b){b=function(){var b=app.modelhelper.web2dbFn({password_aging_time:{timeout:a.model.password_aging_time.timeout}});
g.push({method:"set_password_aging_time",params:b})};var c=function(){var b=app.modelhelper.web2dbFn({web_session_timeout:angular.copy(a.model.web_session_timeout)});g.push({method:"set_web_session_timeout",params:b})},d=function(){var b=a.model.password_complex,b=app.modelhelper.web2dbFn({"password-complexity":{enabled:b.complex_enable,"minimum-length":b.minimum_length,"minimum-number-character-classes":b.minimum_number_character_classes,"new-must-different-than-current":b.new_must_different_than_current}});
g.push({method:"set_password_complexity",params:b})};q&&function(){var a=app.modelhelper.web2dbFn({"remote-authentication-services":q}),b;a["remote-authentication-services"]["authentication-order"]&&a["remote-authentication-services"]["authentication-order"].services&&angular.forEach(a["remote-authentication-services"]["authentication-order"].services,function(a){b=a.order;delete a.order;delete a["service-name"];a.order=b});g.push({method:"set_ras",params:a})}();e("form_pw_complexity")&&(d(),b());
e("form_wst")&&c()}},v=function(){var b=a.model.ras,c=[],d;angular.forEach(a.model_orig.ras,function(a){d=!1;angular.forEach(b,function(b){a.name===b.name&&(d=!0)});d||c.push({name:a.name})});c.length&&g.push({method:"del_ras",params:{"remote-authentication-services":{"remote-authentication-service":c}}})};"dproxy"==h.source?(l={},l.remote_authentication_service=k,l.password_complex=a.model.password_complex,k=execPW_RAS_SetOp(),l.$$save_option={setflag:k},proxy.RemoteAuthenticationService.set_config(l),
a.result=proxy.RemoteAuthenticationService.commit({cbk:function(){d.resolve();a.success=!0}})):(v(),s(),0<g.length?l():d.resolve());return d.promise};a.save=function(){a.aaa_save().finally(function(){return a.aaa_user_save()}).finally(function(){a.gridUserList.editState="main";a.gridRAS.editState="main";a.currPage=y.main;K()}).finally(function(){a.resetModified()})};a.selectUploadFile=function(b){a.pcFile=b};a.cancel=function(){a.currPage=y.main;a.flagGetOutside=!1;a.loadReady=!1;K();a.resetModified()};
K()}]);
app.controller("user_account_main_pw_complexity",["$scope","passwordComplex",function(a,b){a.ctx.pwcpx=a.ctx.pwcpx||{};a.ctx.pwMeterInvalid=!1;a.pwFns=a.pwFns||{};a.ctx.pwcpx.cpxScore=0;a.model.pwd_min_len=0;a.disable_pwd_complex=function(t){!t.complex_enable&&a.ctx.pwMeterInvalid&&(t.minimum_length=a.model_orig.password_complex.minimum_length,t.minimum_number_character_classes=a.model_orig.password_complex.minimum_number_character_classes,b.update_config(t),a.ctx.pwMeterInvalid=!1)};a.update_pw_meter=function(t,
m){if(m.complex_enable){a.ctx.pwMeterInvalid=m.minimum_length<m.minimum_number_character_classes?!0:!1;t=t||"";b.update_config(m);var w=b.getStrength({pwd:t})||0;a.ctx.pwcpx.raw_cpxScore=w||0;0==m.minimum_length&&0==m.minimum_number_character_classes?w=3:2>=w&&(w=0);a.ctx.pwcpx.cpxScore=w||0}};a.getAttr=function(a,b,w){if(a)return a[b];if(w)return w[b]};a.proc_password_min_len=function(){var b=0,b=a.model.password_complex||{},b=b.complex_enable?b.minimum_length||0:0;a.model.pwd_min_len=b};a.password_placeholder_msg=
function(b){var m="";return m=b.complex_enable&&0<b.minimum_length?a.DICT("User_Accounts_Pwd_Not_Left_Blank"):a.DICT("User_Accounts_Keep_Blank")};a.proc_password_min_len()}]);app.controller("scheduleCtrl",["$scope","MyHttp","pgWindow","$templateCache","UserSession","userAccessRight","oneTimeLocker",function(a,b,t,m,w,u,p){a.success=!1;a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var q=function(){b.post({url:resource_base+"data/schedule.json",method:"get_schedule",success:function(a){a.data&&a.data.result?e(a.data.result):e()},error:function(a){Log(ERROR,"scheduleCtrl getScheduleData error : "+a.status);e()}})},e=function(b){b||
(b={});var e=[];b.schedules&&b.schedules.schedule&&(e=b.schedules.schedule);a.model.schedules=[];angular.forEach(e,function(b){a.model.schedules.push(x(b))});a.model.orig=angular.copy(a.model.schedules);a.gridScheduleOptions.data=a.model.schedules;a.dataReady=!0},x=function(a){a||(a={});var b=a.duration||{},e={editName:!1,edit:!1,checked:!1,"default":"ANYTIME"===a.name||"BUSINESS"===a.name||"EVENINGHOURS"===a.name||"WORKHOURS"===a.name?!0:!1,name:a.name,name_is_repeat:!1,description:a.description,
start_time:b["start-time"]||"00:00:00",end_time:b["end-time"]||"00:00:00",days:{every_day:!1,week_day:!1,week_end:!1,sun:!1,mon:!1,tue:!1,wed:!1,thu:!1,fir:!1,sat:!1}};a=[];b["recur-on"]&&(b["recur-on"]["recur-on"]&&b["recur-on"]["recur-on"][0])&&(a=b["recur-on"]["recur-on"][0].split(" "));angular.forEach(a,function(a){e.days[a]=!0});return e};t=function(b){var e=!1;a.sel_cnts=0;angular.forEach(a.model.schedules,function(b,l){b.checked?(a.sel_cnts+=1,b["default"]&&(e=!0)):(b.editName=!1,b.edit=!1)});
a.default_schedule=e?!0:!1};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.chk_name=function(){var b=a.model.schedules,e=b.length,n,m;angular.forEach(b,function(a){a.invalid=!1});for(n=0;n<e;n++)for(m=n+1;m<e;m++)b[n].name===b[m].name&&(b[n].invalid=!0,b[m].invalid=!0)};a.gridScheduleOptions=app.uiGrid.generateGridOptions({IDPreifx:"Schedule",rowHeight:2*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t,disableChkBoxField:"disableChk"},
{field:"name",displayName:a.DICT("Schedule_Name"),required:!0,customVldCbk:"chk_name",invalidField:"invalid",minWidth:180,width:180,editRow:"editName",id:"scheduleName",validationCbk:"gridInvalidCbk",cellTemplate:m.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'uci-name maxlength="31"')},{field:"start_time",displayName:a.DICT("Schedule_Start_Time"),validationCbk:"gridInvalidCbk",isWrapHeader:!0,enableSorting:!1,minWidth:100,width:100,editRow:"edit",required:!0,id:"scheduleStartTime",
cellTemplate:"UG_table_date_with_inline_time_edit.html"},{field:"end_time",displayName:a.DICT("Schedule_End_Time"),validationCbk:"gridInvalidCbk",isWrapHeader:!0,enableSorting:!1,minWidth:100,width:100,editRow:"edit",id:"scheduleEndTime",cellTemplate:"UG_table_date_with_inline_time_edit.html"},{field:"days",displayName:a.DICT("Schedule_Days"),weekdayChange:function(a){var b=a.entity.days.week_day;a.entity.days.week_end=!1;a.entity.days.every_day=!1;a.entity.days.mon=b;a.entity.days.tue=b;a.entity.days.wed=
b;a.entity.days.thu=b;if(a.entity.days.fri=b)a.entity.days.sun=!b,a.entity.days.sat=!b},everydayChange:function(a){var b=a.entity.days.every_day;a.entity.days.week_end=!1;a.entity.days.week_day=!1;a.entity.days.sun=b;a.entity.days.mon=b;a.entity.days.tue=b;a.entity.days.wed=b;a.entity.days.thu=b;a.entity.days.fri=b;a.entity.days.sat=b},enableSorting:!1,minWidth:680,weekendChange:function(a){var b=a.entity.days.week_end;a.entity.days.every_day=!1;a.entity.days.week_day=!1;a.entity.days.sun=b;if(a.entity.days.sat=
b)a.entity.days.mon=!b,a.entity.days.tue=!b,a.entity.days.wed=!b,a.entity.days.thu=!b,a.entity.days.fri=!b},editRow:"edit",cellTemplate:"schdule_days_with_inline_edit.html"}]});a.dataReady=!1;a.fromACL=!1;a.sel_cnts=0;a.default_schedule=!1;a.policy={};a.model={schedules:[],orig:[]};var n=function(){return 30<=a.model.schedules.length?(a.msg="Only allow maximum of 30 entries for Schedule. (Current Entry Number: "+a.model.schedules.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),
!0):!1};a.funs={add:function(){if(!n()){var b=x();b.checked=!0;b.editName=!0;b.edit=!0;b["default"]=!1;a.model.schedules.push(b);a.gridScheduleOptions.gridApi.customApi.scrollToLast();a.modified()}},edit:function(){angular.forEach(a.model.schedules,function(a){a.checked&&(a.edit=!0)})},del:function(){for(var b=a.model.schedules.length-1;0<=b;b--)a.model.schedules[b].checked&&a.model.schedules.splice(b,1);a.sel_cnts=0;a.chk_name();a.modified()},save:function(){var e=a.model.schedules,n,m=!1,p=[],k=
"",d=function(){var c=[];angular.forEach(e,function(a){k="";angular.forEach(a.days,function(a,b){switch(b){case "sun":case "mon":case "tue":case "wed":case "thu":case "fri":case "sat":a&&(k=k+b+" ")}});c.push({name:a.name,duration:{"start-time":a.start_time,"end-time":a.end_time,"recur-on":{"recur-on":[k.trim()]}}})});c.length&&b.post({method:"set_schedule",params:{schedules:{schedule:c}},success:function(b){a.success=!0;q();a.resetModified()},error:function(b){q();a.resetModified()}})};angular.forEach(a.model.orig,
function(a){n=!0;angular.forEach(e,function(b){a.name===b.name&&(n=!1)});n&&(p.push({name:a.name}),m=!0)});m?b.post({method:"del_schedule",params:{schedules:{schedule:p}},success:function(){d()},error:function(){d()}}):d()},cancel:function(){q();a.resetModified()},back:function(){p.put("backFromSchedule",{});history.back()}};p.get("jumpFromACL")&&(a.fromACL=!0);q()}]);app.controller("user_group_main",["$scope","$q","$uibModal","$log","$filter","MyHttp","GridRowBasedEditingOper","oneTimeLocker","$templateCache","Sets","$timeout","modelInfo","UserSession","userAccessRight",function(a,b,t,m,w,u,p,q,e,x,n,l,r,v){var s={source:"http",getResult:function(a,b,c){return x.getResult(this,a,b,c)}};a.model=a.model||{};a.ctx=a.ctx||{};a.flags=a.flags||{};a.rv340w_flag=0;a.success=!1;a.loadReady=!1;a.flags.leaflist_sep_as_space=!1;a.flags.users_remove_joined_user=!1;a.ruFlag=
v.russia();a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&r.logout();0<=l.get_pid().search("RV340W")&&(a.rv340w_flag=1);var k=a.fop={get_groups_ref:function(){return a.model.groups},get_users_ref:function(){a.model.users.user=a.model.users&&a.model.users.user||[];return a.model.users.user},get_users_join_ref:function(){a.model.users_join=a.model.users_join||[];return a.model.users_join}},d=function(a,b,c,d){return u.post({url:resource_base+"data/"+b,method:a,params:c||
void 0,procBackground:d||void 0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},c=function(a){var b,c,g,e;switch(a){case "groups":b="get_groups";c="aaatrans_groups.json";break;case "users":b="get_users";c="aaa_user_hi.json";break;case "vpn_summary":b="get_vpn_summary";c="vpn_summary.json";g={filter:"CONFIG"};e=!0;break;case "ssid":b="get_wifi_settings";c="wlan_ssid.json";e=!0;break;default:console.log("prepareModelOf: unknown name: "+a)}return d(b,c,g,e)},
h=function(){a.loadReady=!1;b.all({groups:c("groups"),users:c("users")}).then(function(b){a.model.users=s.getResult(b.users,"users");b=s.getResult(b.groups,"groups").group;a.model.groups=b;z();x.recover_object(a.model,{"ipsec-profiles":{"ipsec-profile":[]},"site-to-sites":{"site-to-site":[]},"client-to-sites":{"client-to-site":[]},l2tp:{enable:!0},"l2tp-state":{connections:{connection:[]}},pptp:{enable:!0},"pptp-state":{connections:{connection:[]}},sslvpn:{enable:!0,"group-policies":{"group-policy":[]}},
wlans:{ssid:[]}});a.schema=a.schema||{};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};a.schema.actionMap={permit:"Enabled",deny:"Disabled"};a.schema.weblogin=["web-login-disabled","web-login-readonly","web-login-administration"];a.schema.webloginStr={"web-login-disabled":"Disabled","web-login-readonly":"Read Only","web-login-administration":"Admin"};B();D();E();a.gridUserGroup.Options.data=a.model.groups;a.model_orig=angular.copy(a.model);a.gridUserGroup.operations=new app.ngGrid.setupGridAct({oper:p,
grid:a.gridUserGroup});a.gridUserList.operations=new app.ngGrid.setupGridAct({oper:p,grid:a.gridUserList});angular.equals(a.gridUserGroup.operations,a.gridUserList.operations);a.loadReady=!0;n(function(){a.gridUserList._tbl_ref&&a.gridUserList.operations.resetState();a.gridUserGroup._tbl_ref&&a.gridUserGroup.operations.resetState()},100)});b.all({vpn_summary:c("vpn_summary"),ssid:1==a.rv340w_flag?c("ssid"):void 0}).then(function(b){var c=s.getResult(b.vpn_summary);a.model.sslvpn=c.sslvpn;a.model["site-to-sites"]=
c["site-to-sites"];a.model["client-to-sites"]=c["client-to-sites"];b.ssid&&(a.model.wlans=s.getResult(b.ssid,"wlans"));a.loadReady_p2=!0})};h();var g=function(a,b){a.operations=new app.ngGrid.setupGridAct({oper:p,grid:a})};a.find=function(a,b,c){angular.forEach(a,function(a,d){for(var g=b.length;g--;)a.service==b[g]&&c(b[g],g,d)})};var A=function(b,c){var d=!1;a.find(b["feature-rule"],[c],function(a,b,c){d=!0});if(!d){var g=angular.copy(a.use_feature_rule_sample[c]);b["feature-rule"].push(g)}},y=
function(b){x.recover_object(b,a.use_feature_rule_array_sample);A(b,"anyconnect-vpn");A(b,"ssid");A(b,"dot1x");A(b,"ezvpn");A(b,"pptp");A(b,"l2tp");A(b,"s2s-vpn");var c=!1;a.find(b["feature-rule"],["web-login-disabled","web-login-disabled","web-login-readonly","web-login-administration"],function(a,b,d){c=!0});c||A(b,"web-login-disabled")},z=function(){a.use_feature_rule_array_sample={"feature-rule":[]};a.use_feature_rule_sample={ssid:{service:"ssid",action:"permit"},dot1x:{service:"dot1x",action:"deny"},
ezvpn:{service:"ezvpn",option:[],action:"permit"},l2tp:{service:"l2tp",action:"deny"},pptp:{service:"pptp",action:"deny"},"s2s-vpn":{service:"s2s-vpn",option:[],action:"permit"},"web-login-disabled":{service:"web-login-disabled",action:"permit"},"anyconnect-vpn":{service:"anyconnect-vpn",option:[],action:"permit"}};var b=k.get_groups_ref(),c,d;for(c=b.length-1;0<=c;c--)d=b[c],y(d)},B=function(){var b=function(b,c,d){b._ctx[c]={};var g=void 0;a.find(b["feature-rule"],[c],function(a,d,e){b._ctx[c].ref=
b["feature-rule"][e];g=e});d&&d(b,c,g)},c=function(b,c,d){var g=function(){var g=[];a.flags.leaflist_sep_as_space?b["feature-rule"][d].option&&b["feature-rule"][d].option[0]&&(g=b["feature-rule"][d].option[0].split(" ")):g=angular.copy(b["feature-rule"][d].option);angular.forEach(g,function(a){b._ctx[c].member.push({name:a})})};b._ctx[c].member=[];angular.isDefined(d)&&g()},d=function(d){angular.forEach(d,function(d,g){d._ctx={};d["feature-rule"]&&0<=d["feature-rule"].length&&(d._ctx.weblogin=a.schema.weblogin[0],
a.find(d["feature-rule"],a.schema.weblogin,function(a,b){d._ctx.weblogin=a}),b(d,"pptp"),b(d,"l2tp"),b(d,"dot1x"),b(d,"ezvpn",c),b(d,"s2s-vpn",c),b(d,"anyconnect-vpn",c),b(d,"ssid",c))})},g=k.get_groups_ref();g&&d(g)},D=function(){var b=function(a){var b=[],c=k.get_groups_ref();angular.forEach(a,function(a,d){for(var g=void 0,e=c.length;e--;)c[e].name==a.group&&(g=c[e]);b.push({name:a.name||"",join:!1,invisible:!1,readonly:!1,group:[a.group],_groupref:g})});return b},c=k.get_users_ref();if(0<c.length){a.model.users_join?
a.model.users_join.splice(0):a.model.users_join=[];b=b(c)||[];for(c=0;c<b.length;c++)a.model.users_join.push(b[c]);a.gridUserList.Options.data=a.model.users_join}},E=function(){var a=k.get_groups_ref();a&&angular.forEach(a,function(a,b){"admin"==a.name&&(a._priv="reserved");"guest"==a.name&&(a._priv="adminNotAllow");a.checked=!1})};a.ifJoined=function(a,b){return-1<a.indexOf(b)?!0:!1};a.check_remove_condition=function(){var b=a.gridUserGroup.Selections,c=!1;angular.forEach(b,function(a,b){if("admin"==
a.name||"guest"==a.name)c=!0});var d=!0;b&&(0!==b.length&&0===b[0]._ctx.ezvpn.member.length&&0===b[0]._ctx["s2s-vpn"].member.length&&0===b[0]._ctx["anyconnect-vpn"].member.length)&&(1===a.rv340w_flag&&0===b[0]._ctx.ssid.member.length?d=!1:1!==a.rv340w_flag&&(d=!1));return c||d};a.collect_group_named=function(a){return w("filter")(k.get_groups_ref(),function(b,c,d){c=!1;b.name==a&&(c=!0);return c})};a.check_inuse=function(){var b=!1;0!==a.gridUserGroup.Selections.length&&angular.forEach(a.gridUserGroup.Selections,
function(c,d){var g=a.collect_group_named(c.name);g&&(g[0]&&g[0]["user-name"]&&g[0]["user-name"][0]&&0<g[0]["user-name"][0].length)&&(b=!0)});return b};a.remove_disabled_reason=function(){var b="";a.check_inuse()&&(b="Remove th users firstly to delete this group.");return b};a.idTrue=!0;a.idFalse=!1;a.gridUserList=a.gridUserList||{};a.getIndex=function(a,b){var c="";if(!a||!b)return"";angular.forEach(b,function(b,d){b.uid===a.uid&&(c=d+1)});return c};a.gridUserList.Options=app.uiGrid.generateGridOptions({columnDefs:[{field:"number",
displayName:"#",width:50,cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.getIndex(row, grid.rows)")},{field:"join",displayName:a.DICT("User_Groups_Join"),width:70,id:"localUserJoin",cellTemplate:e.get("T_gridUserList_join_checkbox.html").replace(/ARGS1/,e.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/,"ng-disabled=(row.entity['readonly']===true) ng-change='grid.appScope.gridUserList.check_join_state(row.entity)'"))},{field:"name",displayName:a.DICT("User_Groups_User_Name"),
width:220},{field:"group",displayName:a.DICT("User_Groups_Joined_Groups_S"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"MODEL_COL_FIELD.join(' ')")}]});a.gridUserList.check_join_state=function(a){var b=function(a,b){var c=0,d=[],g=k.get_users_join_ref();angular.forEach(g,function(b,g){b._groupref.name==a&&(!0===b.join?c++:!1===b.join&&d.push(b))});var e=c>=b-1;angular.forEach(d,function(a,b){a.readonly=e?!0:!1})};if(a&&a._groupref&&a._groupref["user-name"]){var c=a._groupref.name;
a=a._groupref["user-name"].length;"admin"==c&&b(c,a)}};a.gridUserGroup=a.gridUserGroup||{};q=function(){a.gridUserGroup.Selections=[];angular.forEach(a.model.groups,function(b){b.checked&&a.gridUserGroup.Selections.push(b)})};a.gridUserGroup.Selections=[];a.gridUserGroup.Options=app.uiGrid.generateGridOptions({IDPreifx:"userGroup",columnDefs:a.ruFlag?[{field:"checked",isCheckbox:!0,changedCbk:q,headerChangedCbk:q},{field:"name",displayName:a.DICT("User_Groups_Group")},{field:"_ctx.weblogin",displayName:a.DICT("User_Groups_Web_Login"),
cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.webloginStr[MODEL_COL_FIELD]")},{field:"_ctx['dot1x'].ref.action",displayName:a.DICT("User_Groups_802.1x"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.actionMap[MODEL_COL_FIELD]")},{field:"_ctx['ssid'].ref",displayName:a.DICT("User_Groups_Captive_Portal"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.showProfileList(MODEL_COL_FIELD)"),
visible:1===a.rv340w_flag?!0:!1}]:[{field:"checked",isCheckbox:!0,changedCbk:q,headerChangedCbk:q},{field:"name",displayName:a.DICT("User_Groups_Group")},{field:"_ctx.weblogin",displayName:a.DICT("User_Groups_Web_Login"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.webloginStr[MODEL_COL_FIELD]")},{field:"_ctx['s2s-vpn'].ref",displayName:a.DICT("User_Groups_S2S_VPN2"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.showProfileList(MODEL_COL_FIELD)")},
{field:"_ctx['ezvpn'].ref",displayName:a.DICT("User_Groups_EzVPN_Party"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.showProfileList(MODEL_COL_FIELD)")},{field:"_ctx['anyconnect-vpn'].ref",displayName:a.DICT("User_Groups_SSL_VPN"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.showProfileList(MODEL_COL_FIELD)")},{field:"_ctx['pptp'].ref.action",displayName:a.DICT("User_Groups_PPTP"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,
"grid.appScope.schema.actionMap[MODEL_COL_FIELD]")},{field:"_ctx['l2tp'].ref.action",displayName:a.DICT("User_Groups_L2TP"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.actionMap[MODEL_COL_FIELD]")},{field:"_ctx['dot1x'].ref.action",displayName:a.DICT("User_Groups_802.1x"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.actionMap[MODEL_COL_FIELD]")},{field:"_ctx['ssid'].ref",displayName:a.DICT("User_Groups_Captive_Portal"),
cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.showProfileList(MODEL_COL_FIELD)"),visible:1===a.rv340w_flag?!0:!1}]});var C=function(b){var c=k.get_users_join_ref();angular.forEach(c,function(c,d){c.join=a.ifJoined(c.group,b.name);-1<c.group.indexOf(b.name)?c.readonly=!0:c.readonly=!1;a.gridUserList.check_join_state(c)})};a.showProfileList=function(b){var c="--";return c=b&&b.option&&b.option[0]?a.flags.leaflist_sep_as_space?b.option[0]:b.option.join(", "):b?"Disabled":
"--"};a.update_sslvpn=function(a){0<a.target.length&&a.target.splice(0);a.target.push({name:a.selItem})};var I=function(){var b=k.get_groups_ref().length;return 50<=b?(a.msg="Only allow maximum of 50 entries for User Groups. (Current Entry Number: "+b+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},G=function(){var b=a.gridUserGroup.Selections[0];a.gridS2SGroup.Options.data=b._ctx["s2s-vpn"].member;a.gridEZVPNGroup.Options.data=b._ctx.ezvpn.member;g(a.gridS2SGroup);g(a.gridEZVPNGroup);
1===a.rv340w_flag&&(a.gridCaptivePortalGroup.Options.data=b._ctx.ssid.member,g(a.gridCaptivePortalGroup))};a.gridUserGroup.addItem=function(){if(!I()){var b=a.model.groups,c={checked:!0,name:"","user-name":[],"feature-rule":[]};angular.forEach(b,function(a){a.checked=!1});y(c);b.push(c);B();D();n(function(){G()},50);a.gridUserGroup.edit=!0;a.gridUserGroup.action="add";a.modified()}};a.gridUserGroup.editItem=function(){var b;angular.forEach(a.model.groups,function(a,c){a.checked&&(b=a)});C(b);G();
a.gridUserGroup.edit=!0;a.gridUserGroup.action="edit"};a.gridUserGroup.delItem=function(){var b=a.model.groups,c;for(c=b.length-1;0<=c;c--)b[c].checked&&(b.splice(c,1),a.modified())};a.syncGroupName=function(b){var c=!0;a.form.txt_groupname.$setValidity("exist",!0);angular.forEach(k.get_groups_ref(),function(a,d){b!==a&&b.name===a.name&&(c=!1)});c?a.form.txt_groupname.$setValidity("exist",!0):a.form.txt_groupname.$setValidity("exist",!1)};a.gridS2SGroup=a.gridS2SGroup||{};a.gridS2SGroup.rowActionRule=
function(a,b,c){b=2;if("connect"==c.id||"disconnect"==c.id)b=a.entity.enable?1:0;return c.stateDisplay[b]};var H=function(b){return function(){var c,d;switch(b){case "ssid":d=a.gridCaptivePortalGroup;break;case "ezvpn":d=a.gridEZVPNGroup;break;case "s2s-vpn":d=a.gridS2SGroup;break;default:return}c=d.Options.data;d.Selections=[];angular.forEach(c,function(a){a.checked&&d.Selections.push(a)})}};a.gridS2SGroup.Selections=[];a.gridS2SGroup.Options=app.uiGrid.generateGridOptions({IDPreifx:"S2SGroup",columnDefs:[{field:"checked",
isCheckbox:!0,changedCbk:H("s2s-vpn"),headerChangedCbk:H("s2s-vpn")},{field:"number",displayName:"#",width:50,cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.getIndex(row, grid.rows)")},{field:"name",displayName:a.DICT("User_Groups_Connection_Name")}]});q=function(b){return function(){var c,d;switch(b){case "ssid":c=a.gridCaptivePortalGroup.Options.data;break;case "ezvpn":c=a.gridEZVPNGroup.Options.data;break;case "s2s-vpn":c=a.gridS2SGroup.Options.data;break;default:return}for(d=
c.length-1;0<=d;d--)c[d].checked&&c.splice(d,1);H(b)}};a.gridS2SGroup.remove=q("s2s-vpn");a.gridEZVPNGroup=angular.copy(a.gridS2SGroup);a.gridEZVPNGroup.Options=app.uiGrid.generateGridOptions({IDPreifx:"EZVPN",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:H("ezvpn"),headerChangedCbk:H("ezvpn")},{field:"number",displayName:"#",width:50,cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.getIndex(row, grid.rows)")},{field:"name",displayName:a.DICT("User_Groups_Group_Name_N")}]});
a.gridEZVPNGroup.delItem=q("ezvpn");1==a.rv340w_flag&&(a.gridCaptivePortalGroup=angular.copy(a.gridS2SGroup),a.gridCaptivePortalGroup.Options=app.uiGrid.generateGridOptions({IDPreifx:"captivePortal",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:H("ssid"),headerChangedCbk:H("ssid")},{field:"number",displayName:"#",width:50,cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.getIndex(row, grid.rows)")},{field:"name",displayName:a.DICT("User_Groups_SSID")}]}),a.gridCaptivePortalGroup.delItem=
q("ssid"));a.save=function(){var b=[],c=function(b,c){if(b._ctx[c]&&b._ctx[c].ref&&b._ctx[c].member){var d=[];angular.forEach(b._ctx[c].member,function(a,b){delete a.checked;null!==a.name&&angular.isDefined(a.name)&&d.push(a.name)});b._ctx[c].ref.option=a.flags.leaflist_sep_as_space?d.join(" "):d}},d=function(b){angular.forEach(b,function(b,d){if(b["feature-rule"]){var g=b["feature-rule"],e=b._ctx.weblogin,h=[];"web-login-administration"==e?h=["web-login-readonly","web-login-disabled","web-login"]:
"web-login-readonly"==e?h=["web-login-administration","web-login-disabled","web-login"]:"web-login-disabled"==e&&(h=["web-login-administration","web-login-readonly","web-login-disabled","web-login"]);for(var k=!1,l=g.length;l--;)for(var n=h.length;n--;)void 0==g[l]&&console.log("feature[k] not defined, k="+l),void 0==g[l].service&&console.log("feature[k].service not defined, k="+l),g[l].service==h[n]?(g.splice(l,1),l=0<l?l-1:l):g[l].service==e&&(k=!0);!k&&"web-login-disabled"!==e&&g.push({service:e,
action:"permit"})}b._ctx&&(c(b,"s2s-vpn"),c(b,"ezvpn"),c(b,"anyconnect-vpn"),1==a.rv340w_flag&&c(b,"ssid"),delete b._ctx);b._groupref&&delete b._groupref;angular.isDefined(b._priv)&&delete b._priv;delete b.checked});return b},g=function(b){var c=angular.copy(b),c=d(c);if(!a.gridUserGroup.edit||0>=a.gridUserGroup.Selections.length)return c;var g=a.gridUserGroup.Selections[0].name;b=k.get_users_join_ref();var e=function(b,c,d){var e;angular.forEach(b,function(b,h){if(b.name!==g)if(e=h,Log(DEBUG,"== "+
e),b["user-name"]&&b["user-name"][0]){if(d)if(a.flags.leaflist_sep_as_space)b["user-name"][0]=b["user-name"][0].replace(c.name,"").replace("  "," ").replace(/^ /,"").replace(/ $/,"");else{var k=b["user-name"].indexOf(c.name);-1<k&&(b["user-name"].splice(k,1),0==b["user-name"].length&&(b["user-name"]=[""]))}}else b["user-name"]=[""]})},h=-1;angular.forEach(c,function(a,b){a.name==g&&(h=b)});var l=c[h];angular.forEach(b,function(b,d){var g=-1;l["user-name"]&&l["user-name"][0]&&(g=a.flags.leaflist_sep_as_space?
l["user-name"][0].indexOf(b.name):l["user-name"].indexOf(b.name));b.join?(-1==g&&(l["user-name"]&&l["user-name"][0]?a.flags.leaflist_sep_as_space?l["user-name"][0]+=(0<l["user-name"][0].length?" ":"")+b.name:l["user-name"].push(b.name):(l["user-name"]=[],l["user-name"].push(b.name))),e(c,b,!0)):(a.flags.users_remove_joined_user&&-1<g&&(l["user-name"]&&l["user-name"][0])&&(a.flags.leaflist_sep_as_space?l["user-name"][0]=l["user-name"][0].replace(b.name,"").replace("  "," ").replace(/^ /,"").replace(/ $/,
""):(g=l["user-name"].indexOf(b.name),-1<g&&(l["user-name"].splice(g,1),0==l["user-name"].length&&(l["user-name"]=[""])))),e(c,b,!1))});return c}(k.get_groups_ref()),e=[],l=a.model.groups,n;angular.forEach(a.model_orig.groups,function(a){n=!1;angular.forEach(l,function(b){a.name===b.name&&(n=!0)});n||e.push({name:a.name})});var m=function(){var c=!0,d=!1;u.post({url:resource_base+"data/result_set_bulk.json",method:"set_bulk",params:b,success:function(a){var b;b={};if(a.data&&void 0!==a.data.result){var g=
a.data.result;"number"==typeof g?b.code=parseInt(g):"object"==typeof g&&(b=g,b.code=parseInt(b.code))}1==b.code?(d=c=!0,r.logout()):0==b.code?c=!0:console.log("Response unknown case: "+a.status+", URL: "+a.config.url+", ret= "+JSON.stringify(b))},error:function(b){h();a.gridUserGroup.edit=!1;a.gridUserGroup.action="";console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}}).then(function(b){c&&!1==d&&(a.success=!0);!1==d&&(h(),a.gridUserGroup.edit=!1,a.gridUserGroup.action="")})};0<e.length&&
b.push({method:"del_groups",params:{groups:{group:e}}});b.push({method:"set_groups",params:{groups:{group:g}}});a.resetModified();0<b.length&&m()};a.cancel=function(){a.gridUserGroup.edit=!1;h();a.resetModified()};a.open=function(b){t.open({templateUrl:"feature_add.htm",controller:"user_group_main_modal_add_user",size:b[0],backdrop:"static",resolve:{model:function(){return a.model},ctx:function(){return a.ctx},gridFeatureUser:function(){return b[1]},gridUserGroup:function(){return a.gridUserGroup},
userType:function(){return b[2]}}}).result.then(function(a){},function(){m.info("Modal dismissed at: "+new Date)})}}]);
app.controller("user_group_main_modal_add_user",["$scope","$uibModalInstance","$filter","model","gridUserGroup","gridFeatureUser","userType",function(a,b,t,m,w,u,p){a.gridFeatureUser=u||{};a.gridUserGroup=w||{};a.model=m||{};a.ctx=a.ctx||{};a.ctx.profile_ref=[];var q=u.Options.data;m=function(a,b,e){b=!1;a["extended-authentication"]&&!0==a["extended-authentication"].enable&&(b=!0);return b};w=function(a,b,e){e=b=!1;if(a.mode||a["group-name"])e=!0;e?b=!0:a["extended-authentication"]&&!0==a["extended-authentication"].enable&&
(b=!0);return b};u=function(a,b,e){b=!0;!1===a["captive-portal-enable"]&&(b=!1);return b};var e=function(a,b,e){var m=!0;if(0<b)for(b-=1;0<=b;b--)a.ssid===e[b].ssid&&!0===e[b]["captive-portal-enable"]&&(m=!1);return m};"S2S"==p?(a.ctx.profile_ref=a.model["site-to-sites"]["site-to-site"],a.ctx.profile_ref=t("filter")(a.ctx.profile_ref,m),a.ctx.ref_key="connection-name",a.ctx.target=q):"ezvpn"==p?(a.ctx.profile_ref=a.model["client-to-sites"]["client-to-site"],a.ctx.profile_ref=t("filter")(a.ctx.profile_ref,
w),a.ctx.ref_key="seq",a.ctx.target=q):"anyconnect-vpn"==p?(a.ctx.profile_ref=a.model.sslvpn["group-policies"]["group-policy"],a.ctx.ref_key="policy-name",a.ctx.target=q):"ssid"==p&&(a.ctx.profile_ref=a.model.wlans.ssid,a.ctx.profile_ref=t("filter")(a.ctx.profile_ref,u),a.ctx.profile_ref=t("filter")(a.ctx.profile_ref,e),a.ctx.ref_key="ssid",a.ctx.target=q);a.getNotInUseItems=function(b,e){e=e||[];var l=t("filter")(b,function(b,l,m){b=b[a.ctx.ref_key];l=!0;for(m=0;m<e.length;m++)e[m].name==b&&(l=!1);
return l});return l=l||[]};a.add=function(){a.ctx.target=a.ctx.target||[];q.push({name:a.ctx.selItem});a.modified();a.cancel()};a.cancel=function(){b.dismiss("cancel")}}]);app.controller("timeCtrl",["$scope","MyHttp","UserSession","userAccessRight","dt","goToPreviousPage",function(a,b,t,m,w,u){var p=app.TOOLS.int2str2,q=app.TOOLS.str2int,e=app.TOOLS.getVal,x=void 0,n=void 0;angular.copy(w.dayWeek);angular.copy(w.month);var l={Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6},r="Sun Mon Tue Wed Thu Fri Sat".split(" "),v=["",a.DICT("Time_1st_Week"),a.DICT("Time_2nd_Week"),a.DICT("Time_3rd_Week"),a.DICT("Time_4th_Week"),a.DICT("Time_5th_Week"),a.DICT("Time_6th_Week")];a.months=
[];a.hours=[];a.minutes=[];a.startDays=[];a.endDays=[];a.seconds=[];a.success=!1;a.dataReady=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var s=function(a,b){if(b){var c;a.m=b.month||a.m;a.d=b.day||a.d;a.dw=b["week-day"]&&l[b["week-day"]]||a.dw;a.w=isNaN(parseInt(b.week,10))?a.w:parseInt(b.week,10);c=b.time&&b.time.split(":")||[];a.hour=isNaN(parseInt(c[0],10))?a.hour:parseInt(c[0],10);a.minute=isNaN(parseInt(c[1],10))?a.minute:parseInt(c[1],10)}},k=function(){b.post({url:resource_base+
"data/time.json",method:"get_time",success:function(b){b.data&&b.data.result?d(b.data.result):d();a.chk_date();a.chk_dst();a.daylightSavingInvalid=!1;a.dataReady=!0},error:function(b){console.log("timeCtrl getData Error status: "+b.status);d();a.daylightSavingInvalid=!1;a.chk_date();a.chk_dst()}})},d=function(b){b||(b={});var d=new Date,h=b.system||{},k=h.clock||{},l=(b["system-state"]||{}).clock||{};b=k["timezone-summer-time"]||{};h=h.ntp||{};a.model.clock={timezone_name:k["timezone-name"]||"Eastern Time (US & Canada)",
current_datatime:new Date,display_curr_datatime:"-",current_timestamp:-1,curr_time:{hour:d.getHours(),minute:d.getMinutes(),second:d.getSeconds()},summer:{enabled:void 0!==b.enabled?b.enabled:!0,start:{date:"",year:0,m:1,d:1,hour:0,minute:0,w:1,dw:0},end:{date:"",year:0,m:2,d:1,hour:0,minute:0,w:1,dw:0},offset:b["saving-offset"]||0,recurring:b.recurring||!1}};l["current-datetime"]&&(d=w.parser(l["current-datetime"]),0===d.err_code&&(k=new Date(d.year,d.month,d.day),a.model.clock.current_datatime=
k,k=12>=d.hour?d.hour:d.hour-12,0===k&&(k=12),a.model.clock.current_timestamp=w.get_time(d),c(),a.model.clock.curr_time={hour:d.hour,minute:d.minute,second:d.second},n&&(clearInterval(n),n=void 0),n=setInterval(function(){a.model.clock.current_timestamp+=1E3;c()},1E3)));a.model.clock.summer.start.year=a.model.clock.current_datatime.getYear()+1900;a.model.clock.summer.end.year=a.model.clock.current_datatime.getYear()+1900;s(a.model.clock.summer.start,b["start-date"]);s(a.model.clock.summer.end,b["end-date"]);
var m,p;a.model.ntp={enabled:void 0!==h.enabled?h.enabled:!0,ntp_default:!1,server1:{name:"0",address:"",def_address:"0.ciscosb.pool.ntp.org",port:123},server2:{name:"1",address:"",def_address:"1.ciscosb.pool.ntp.org",port:123},server3:{name:"2",address:"",def_address:"2.ciscosb.pool.ntp.org",port:123},server4:{name:"3",address:"",def_address:"3.ciscosb.pool.ntp.org",port:123}};h.server&&angular.forEach(h.server,function(b,c){m=q(b.name);switch(m){case 0:case 1:case 2:case 3:break;default:return}p=
"server"+(m+1);angular.extend(a.model.ntp[p],{name:e(b.name,b.name),address:e(b.udp&&b.udp.address,""),port:q(e(b.udp&&b.udp.port,123))})});a.model.orig_ntp=angular.copy(a.model.ntp);""===a.model.ntp.server1.address&&(""===a.model.ntp.server2.address&&""===a.model.ntp.server3.address&&""===a.model.ntp.server4.address)&&(a.model.ntp.ntp_default=!0)};a.daylightSavingInvalid=!1;a.model={clock:{},ntp:{},orig_ntp:{},schema:{},back_btn:!1};a.date={format:"yyyy-MM-dd",options:{formatYear:"yyyy",startingDay:0},
disabled:function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},minDate:null,opened:!1,open:function(){a.date.opened=a.model.ntp.enabled?!1:!0}};a.funs={go_back:u.goback,save:function(){var c=a.model.clock,d=c.summer,e=a.model.ntp,h=a.model.orig_ntp,l=c.current_datatime,n=l.getYear()+1900,m=d.start,q=d.end,s=[],v,t,l=p(n)+"-"+p(l.getMonth()+1)+"-"+p(l.getDate())+"T"+p(c.curr_time.hour)+":"+p(c.curr_time.minute)+":"+p(c.curr_time.second),u={system:{clock:{"timezone-name":c.timezone_name},
ntp:{enabled:e.enabled,server:[]}}},x={rpc:"set-current-datetime",input:{"current-datetime":l}};d.recurring?(v={month:m.m,time:p(m.hour)+":"+p(m.minute),week:m.w,"week-day":r[m.dw]},t={month:q.m,time:p(q.hour)+":"+p(q.minute),week:q.w,"week-day":r[q.dw]}):(v={month:m.m,time:p(m.hour)+":"+p(m.minute),day:m.d},t={month:q.m,time:p(q.hour)+":"+p(q.minute),day:q.d});a.daylightSavingInvalid=!1;var M=function(){e.enabled?k():b.post({method:"action",params:x,success:function(b){a.success=!0;k()},error:function(a){k()}})},
N=function(){var a=!1,b,c;if(!e.ntp_default)for(c=1;5>c;c++)b="server"+c,e[b].address&&(u.system.ntp.server.push({name:e[b].name,udp:{address:e[b].address}}),a=!0);a||delete u.system.ntp.server;u.system.clock["timezone-summer-time"]={enabled:d.enabled};!0===d.enabled&&angular.extend(u.system.clock["timezone-summer-time"],{"saving-offset":d.offset,recurring:d.recurring,"start-date":v,"end-date":t});s.push({method:"set_time",params:u})},J=function(){R();N();b.post({method:"set_bulk",params:s,success:function(b){w.setTimezoneName(c.timezone_name);
a.success=!0;M()},eorro:function(a){M()}})},R=function(){var a,b,c=[];for(b=1;5>b;b++)a="server"+b,h[a].address&&(!e[a].address||e.ntp_default)&&c.push({name:h[a].name});c.length&&s.push({method:"del_time",params:{system:{ntp:{server:c}}}})};!0===d.enabled?(n={year:n,recurring:d.recurring,"saving-offset":d.offset},angular.extend(n,{"start-date":v,"end-date":t}),b.post({method:"action",params:{rpc:"clock-check-dst",input:n},success:function(b){b=b.data||{};b.result&&b.result.output&&0===b.result.output.code?
J():a.daylightSavingInvalid=!0;a.resetModified()},error:function(b){a.daylightSavingInvalid=!0;a.resetModified()}})):(J(),a.resetModified())},cancel:function(){k();a.resetModified()}};a.checkNTPServer=function(b){h();x=setTimeout(function(){var b,c,d,g,e=a.model.ntp;x=void 0;var h={server1:!0,server2:!0,server3:!0,server4:!0};if(!a.model.ntp.ntp_default&&a.model.ntp.enabled)for(b=1;5>b;b++){d="server"+b;for(c=b+1;5>c;c++)g="server"+c,e[d].address&&(e[g].address&&e[d].address===e[g].address)&&(h[d]=
!1,h[g]=!1)}a.timeform.server1.$setValidity("repeat",h.server1);a.timeform.server2.$setValidity("repeat",h.server2);a.timeform.server3.$setValidity("repeat",h.server3);a.timeform.server4.$setValidity("repeat",h.server4);app.TOOLS.apply(a)},100)};var c=function(){var b=a.model.clock,c;-1===b.current_timestamp?b.display_curr_datatime="-":(c=w.new_date(b.current_timestamp),b.display_curr_datatime=w.timeStr(c));app.TOOLS.apply(a)},h=function(){void 0!==x&&(clearTimeout(x),x=void 0)};a.chk_date=function(){var b=
void 0,c=function(b){a.timeform.slct_date&&a.timeform.slct_date.$setValidity("invalid-year",b)};a.model.clock.current_datatime&&(b=a.model.clock.current_datatime.getFullYear());void 0===b?c(!1):2037<b||1970>b?c(!1):(c(!0),a.chk_dst())};a.chk_dst=function(){var b=a.model.clock.current_datatime,c=a.model.clock.summer,d;b&&(d=b.getFullYear());if(void 0!==d){var e,h;a.startDays=[];a.startWeeks=[];b=(new Date(d,c.start.m,0)).getDate();e=(new Date(d,c.start.m-1,1)).getDay();(new Date(d,c.start.m-1,1)).getDate();
e=1+Math.ceil((b+e-7)/7);for(h=1;h<=b;h++)a.startDays.push({id:h,displayName:p(h)});c.start.d>b&&(c.start.d=1);for(h=1;h<e;h++)a.startWeeks.push({id:h,displayName:v[h]});a.startWeeks.push({id:e,displayName:a.DICT("Time_Last_Week")});c.start.w>e&&(c.start.w=1);a.endDays=[];a.endWeeks=[];b=(new Date(d,c.end.m,0)).getDate();e=(new Date(d,c.end.m-1,1)).getDay();(new Date(d,c.end.m-1,1)).getDate();e=1+Math.ceil((b+e-7)/7);for(h=1;h<=b;h++)a.endDays.push({id:h,displayName:p(h)});c.end.d>b&&(c.end.d=1);
for(h=1;h<e;h++)a.endWeeks.push({id:h,displayName:v[h]});a.endWeeks.push({id:e,displayName:a.DICT("Time_Last_Week")});c.end.w>e&&(c.end.w=1)}};a.$on("$destroy",function(){h();n&&(clearInterval(n),n=void 0)});u.isneed()&&(a.model.back_btn=!0);(function(){a.model.schema={timezone:[],shortweek:w.dayWeekab,daylight_offset:[]};var b,c={},d=[],e;for(b=-4;4>=b;b++)a.model.schema.daylight_offset.push({id:15*b,displayName:(0>15*b?"":"+")+15*b});a.hours=[];a.minutes=[];a.seconds=[];a.months=[];for(b=1;12>=
b;b++)a.months.push({id:b,displayName:b+""});for(b=0;24>b;b++)a.hours.push({id:b,displayName:p(b)});for(b=0;60>b;b++)a.minutes.push({id:b,displayName:p(b)});for(b=0;60>b;b++)a.seconds.push({id:b,displayName:p(b)});Timezone.sort(function(a,b){return a.offset<b.offset?-1:a.offset>b.offset?1:a.display<b.display?-1:a.display>b.display?1:0});angular.forEach(Timezone,function(a,b){a.is_cisco&&!c[a.cisco_display]&&(c[a.cisco_display]=!0,e=1E3+a.offset,d[e]||(d[e]=[]),d[e].push({id:a.tz,displayName:a.cisco_display,
offset:a.offset}))});angular.forEach(d,function(b){b&&(b.sort(function(a,b){var c=a.displayName.match(/^\(UTC .\d+:\d+. (.*)/),d=b.displayName.match(/^\(UTC .\d+:\d+. (.*)/),c=c&&c[1]||"",d=d&&d[1]||"";return!c||!d?0:c<d?-1:c>d?1:0}),a.model.schema.timezone=a.model.schema.timezone.concat(b))})})();k()}]);app.controller("discovery_bonjour",["$scope","MyHttp","wan_service","UserSession","userAccessRight",function(a,b,t,m,w){a.success=!1;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var u=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var l;a.skip_bonjour_update_once||(a.model.ifs=[]);a.filterWANphy={physical:!1,subinterface:!1};var k=t.filter(b,a.filterWANphy),d=[];angular.forEach(b,function(a,b){"VLAN"===a.name.substr(0,4)&&d.push(a)});d=d.concat(k);
angular.forEach(d,function(b,d){if(!a.skip_bonjour_update_once){l=b.bonjour||{};var g="";a.model.ifs_state[b.name]&&(g=""!==a.model.ifs_state[b.name].ip?a.model.ifs_state[b.name].ip:"");a.model.ifs.push({name:b.name,ip:g,edit:!0,bonjour:{enable:void 0!==l.enable?l.enable:!0}})}});a.gridBonjourOptions.data=a.model.ifs;a.skip_bonjour_update_once=!1;e.ifs=!0;q()},p=function(b){b||(b={});angular.forEach((b["interfaces-state"]||{})["interface"]||[],function(b,e){if(b.name){var d=b.ipv4||{};a.model.ifs_state[b.name]=
{ip:(d.address&&d.address[0]||"").ip||""}}});e.ip=!0},q=function(){e.ifs&&(e.ip&&e.nat&&e.bonjour)&&(angular.forEach(a.model.ifs,function(b,e){a.model.nat[b.name]&&!0===a.model.nat[b.name].nat&&(a.model.ifs[e].edit=!1)}),a.dataReady=!0)};a.dataReady=!1;var e={ifs:!1,ip:!1,nat:!1,bonjour:!1},x=function(){b.post({method:"get_nat",url:resource_base+"data/bonjour_nat.json",success:function(a){a.data&&a.data.result?n(a.data.result):n()},error:function(a){console.log("getInterfacesNat error status: "+a.status);
n()}})},n=function(b){b||(b={});angular.forEach((b.interfaces||{})["interface"]||[],function(b,e){if(b.name.match(/^WAN/)||b.name.match(/^VLAN/))a.model.nat[b.name]={nat:b.nat&&void 0!==b.nat.enable?b.nat.enable:!1}});e.nat=!0},l=function(a){b.post({url:resource_base+"data/bonjour.json",method:"get_bonjour",success:function(b){b.data&&b.data.result?a?a(b.data.result):(p(b.data.result),r(b.data.result),u(b.data.result)):a?a():(r(),u())},error:function(b){a?a():(r(),u());console.log("discovery_bonjour getbonjourData error status: "+
b.status)}})},r=function(b){b||(b={});b=b["bonjour-global"]||{};a.model.bonjour={enable:void 0!==b.enable?b.enable:!0};e.bonjour=!0};a.model={ifs:[],ifs_state:[],bonjour:{},nat:{},select:-1,refreshInterval:!1};a.funs={save:function(){var e={interfaces:{"interface":[]}},l={"bonjour-global":{enable:a.model.bonjour.enable}};angular.forEach(a.model.ifs,function(a,b){e.interfaces["interface"].push({name:a.name,bonjour:{enable:a.bonjour.enable}})});angular.extend(l,e);b.post({method:"set_bonjour",params:l,
success:function(b){a.success=!0;a.resetModified()},error:function(b){a.resetModified()}})},cancel:function(){x();l();a.resetModified()},refresh:function(){a.skip_bonjour_update_once=!0;l(u)}};a.gridBonjourOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"name",displayName:a.DICT("Discovery_Bonjour_Avaliable_Interface")},{field:"ip",displayName:a.DICT("Discovery_Bonjour_IP_Addr")},{field:"bonjour.enable",displayName:a.DICT("Discovery_Bonjour_Enable_Bonjour"),editRow:"edit",id:"Bonjour",
cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});x();l()}]);app.controller("systemCtrl",["$scope","MyHttp","UserSession","userAccessRight","goToPreviousPage",function(a,b,t,m,w){a.success=!1;a.loadReady=!1;a.dataReady=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var u=function(){b.post({url:resource_base+"data/sys_system.json",method:"get_sys_info",success:function(b){b.data&&b.data.result?p(b.data.result):p();a.dataReady=!0;a.loadReady=!0},error:function(a){console.log("systemCtrl getData Error status: "+a.status)}})},
p=function(b){b||(b={});b=b.system||{};a.model.hostname=void 0!==b.hostname?b.hostname:"";a.model.domainname=void 0!==b["domain-name"]?b["domain-name"]:""};a.model={hostname:"",domainname:"",back_btn:!1};a.funs={save:function(){b.post({method:"set_sys_info",params:{system:{hostname:a.model.hostname,"domain-name":a.model.domainname}},success:function(b){a.success=!0;u();a.resetModified()},eorro:function(b){u();a.resetModified()}})},cancel:function(){u();a.resetModified()},go_back:w.goback};w.isneed()&&
(a.model.back_btn=!0);u()}]);app.controller("gettingStartedCtrl",["$scope","MyHttp","$cookies","userAccessRight","oneTimeLocker","$location",function(a,b,t,m,w,u){a.disable_startup="1"===t.get("disable-startup");a.ruFlag=m.russia();a.goto_setup_wizard=function(){w.put("WIZARDS","setup_wizard");u.url("Configuration_Wizards/")};a.goto_application_wizard=function(){w.put("WIZARDS","application_wizard");u.url("Configuration_Wizards/")};a.goto_vpn_wizard=function(){w.put("WIZARDS","vpn_wizard");u.url("Configuration_Wizards/")};a.change_startup=
function(){var m=a.disable_startup?"1":"0";b.post({method:"set_gui",params:{gui:{"disable-startup-page":a.disable_startup}},success:function(a){t.put("disable-startup",m)},error:function(a){}})}}]);app.controller("ipGroupCtrl",["$scope","MyHttp","$uibModal","$templateCache","UserSession","userAccessRight","device_os_type","$q","goToPreviousPage",function(a,b,t,m,w,u,p,q,e){var x=app.TOOLS.netmask.inet2Int,n=app.TOOLS.getVal;a.success=!1;a.loadReady=!1;a.backbtn=!1;a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();e.isneed()&&(a.backbtn=!0);var l=function(){return b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup",error:function(a){console.log("ipGroupCtrl getIPGroupData error "+
a.status);r()}})},r=function(b){b||(b={});var d=[];b["ip-groups"]&&b["ip-groups"]["ip-group"]&&(d=b["ip-groups"]["ip-group"]);var g=0;a.model.ipgroups=[];angular.forEach(d,function(b,c){a.model.ipgroups.push(v(b,c))});angular.forEach(a.model.ipgroups,function(a){void 0!==a.name&&(a.id="group"+g,g++)});c();a.gridMainOptions.data=a.model.ipgroups;a.gridMainOptions.gridApi&&(a.gridMainOptions.gridApi&&_.isFunction(a.gridMainOptions.gridApi.customApi.checkSelectStatus))&&setTimeout(function(){a.gridMainOptions.gridApi.customApi.checkSelectStatus()},
50);a.model.orig=angular.copy(a.model.ipgroups)},v=function(a,b){a||(a={});var c={name:a.name||"",orig_name:a.name||"",macRepeated:!1,popover:"",edit:!1,modify:!1,checked:!1,type:"",uniqueKey:b,action:[],ips:[],macs:[]},d=a.macs||[];angular.forEach(a.ips||[],function(a){c.ips.push(s(a,void 0,c.name))});angular.forEach(d,function(a){c.macs.push(k(a,!0))});return c},s=function(b,c,d){var g,e,h,k;g=b["os-type"];e=b["device-type"];_.isUndefined(g)&&(g="ANY");_.isUndefined(e)&&(e="ANY");h={edit:!1,groupKey:d,
checked:!1,disableChk:!1,seq:void 0!==b.seq?b.seq:void 0!==c&&!isNaN(parseInt(c,10))?c:0,proto:{select:"ipv4",list:a.schema.protos},type:{select:"single",list:a.schema.types},setting:{detailStr:"",ipv4:{ip:"",subnet_ip:"",subnet_netmask:"255.255.255.0",subnet_prefix:24,start:"",end:""},ipv6:{ip:"",subnet_ip:"",subnet_netmask:"",start:"",end:""}},os_type:{select:g,list:[]},device_type:{select:e,list:[]}};angular.forEach(b.ipv4,function(a,b){switch(b){case "subnet":h.setting.ipv4.subnet_ip=a.ip||"";
h.setting.ipv4.subnet_netmask=a.netmask||"";h.setting.ipv4.sub_prefix=x(h.setting.ipv4.subnet_netmask);h.type.select="subnet";break;case "single":h.setting.ipv4.ip=a||"";h.type.select="single";break;case "range":h.setting.ipv4.start=a.start||"";h.setting.ipv4.end=a.end||"";h.type.select="range";break;default:return}h.proto.select="ipv4"});angular.forEach(b.ipv6,function(a,b){switch(b){case "subnet":k=parseInt(a["prefix-length"],10);h.setting.ipv6.subnet_ip=a.ip||"";h.setting.ipv6.subnet_netmask=isNaN(k)?
"":k;h.type.select="subnet";break;case "single":h.setting.ipv6.ip=a||"";h.type.select="single";break;case "range":h.setting.ipv6.start=a.start||"";h.setting.ipv6.end=a.end||"";h.type.select="range";break;default:return}h.proto.select="ipv6"});return h},k=function(a,b){a||(a={});var c=a["os-type"]||"",d=a["device-type"]||"";b&&(c||(c="ANY"),d||(d="ANY"));return{mac:a.mac||"",os_type:{select:c,list:[]},device_type:{select:d,list:[]},invalid:!1,repeatedWithOtherGroup:!1,repeatedWithOtherEntity:!1,edit:!1,
disableChk:!1,empty:""}},d=function(a){var b=a.proto.select,c="-";switch(a.type.select){case "single":c=a.setting[b].ip;break;case "range":c=a.setting[b].start+" - "+a.setting[b].end;break;case "subnet":prefix="ipv4"===b?x(a.setting[b].subnet_netmask):a.setting[b].subnet_netmask;prefix=parseInt(prefix,10);if(isNaN(prefix))break;c=a.setting[b].subnet_ip+"/"+prefix}return c},c=function(){var b,c,g=a.model.ipgroups,e=g.length,h=[];angular.forEach(g,function(a){a.macRepeated=!1});angular.forEach(g,function(a,
h){a.popover="";angular.forEach(a.ips,function(c,g){c.seq=g;c.setting.detailStr="-";b=d(c);"-"!==b&&(a.popover=a.popover+"<div>"+b+"</div>",c.setting.detailStr=b)});angular.forEach(a.macs,function(b){for(c=h+1;c<e;c++)angular.forEach(g[c].macs,function(d){b.mac===d.mac&&(a.macRepeated=!0,g[c].macRepeated=!0)})})});a.ui_data.mac_repeat_note="";angular.forEach(g,function(a){a.macRepeated&&h.push(a.name)});h.length&&(a.ui_data.mac_repeat_note=a.DICT("IP_Address_Group_Mac_Repeated_Note",{"%s":"<b>"+h.join(", ")+
"</b>"}))},h=function(){q.all([l(),p.get()]).then(function(b){a.sel_cnts=0;a.sel_device_cnts=0;a.model.device=b[1]&&b[1].device||[];a.model.os=b[1]&&b[1].os||[];a.model.def_device=p.get_default_device_type(a.model.device);a.model.def_os=p.get_default_os_type(a.model.os[a.model.def_device]);r(b[0]&&b[0].data.result);a.resetModified();a.loadReady=!0})};a.edit={};a.model={ipgroups:[],os:[],device:[],def_os:"",def_device:""};a.ui_data={mac_repeat_note:""};a.schema={protos:[{id:"ipv4",displayName:a.DICT("IP_Address_Group_IPv4")},
{id:"ipv6",displayName:a.DICT("IP_Address_Group_IPv6")}],types:[{id:"single",displayName:a.DICT("IP_Address_Group_IP_Addr")},{id:"subnet",displayName:a.DICT("IP_Address_Group_IP_Addr_Subnet")},{id:"range",displayName:a.DICT("IP_Address_Group_IP_Addr_Range")}]};m=function(b){a.sel_cnts=0;angular.forEach(a.model.ipgroups,function(b){b.checked&&(a.sel_cnts+=1)})};a.gridMainOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:m,headerChangedCbk:m},{field:"name",
name:"name",displayName:a.DICT("IP_Address_Group_Group_Name_N"),id:"IPGroupName"},{field:"popover",name:"popover",displayName:a.DICT("IP_Address_Group_Detail"),cellTemplate:"UG_table_icon_with_popover_html.html"}]});var g=function(){return 50<=a.model.ipgroups.length?(a.msg="Only allow maximum of 50 entries for IP Address Group. (Current Entry Number: "+a.model.ipgroups.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},A=function(b){t.open({animation:a.animationsEnabled,
templateUrl:"ipgroup_edit.html",controller:"ipgroupEditCtrl",size:"ip-address-edit",backdrop:"static",resolve:{model:function(){return a.model},edit:function(){return a.edit},genIpsAtom:function(){return s},genMacAtom:function(){return k},genDetailStr:function(){return d}}}).result.then(function(c){a.edit=c;"function"===$.type(b)&&b(!0)},function(c){a.resetModified();"function"===$.type(b)&&b(!1)})};a.funs={goback:e.goback,create:function(){if(!g()){var b=v({},a.model.ipgroups.length);b.modify=!0;
b.edit=!0;a.edit=b;a.modified();A(function(c){Log(DEBUG,"Create for modal result: "+c);c&&(a.model.ipgroups.push(b),a.funs.save())})}},editGroup:function(){var b;a.modified();angular.forEach(a.model.ipgroups,function(c){c.checked&&(b=angular.copy(c),b.modify=!0,a.edit=b)});A(function(b){Log(DEBUG,"Edit for modal result: "+b);b?(angular.forEach(a.model.ipgroups,function(b,c){a.edit.uniqueKey===b.uniqueKey&&(a.model.ipgroups[c]=a.edit)}),a.funs.save()):a.resetModified()})},delGroup:function(b,d,g){b=
a.model.ipgroups;for(d=b.length-1;0<=d;d--)b[d].checked&&b.splice(d,1);angular.forEach(a.model.ipgroups,function(a,b){a.uniqueKey=b});c();a.modified()},cancel:function(){h()},save:function(){var c=a.model.ipgroups,d=a.model.orig,g=[],e=[],k=[],l=[],m=[],p=[],r=[],q,s,v,t,u;angular.forEach(d,function(a){s=!0;angular.forEach(c,function(b){a.name===b.name&&(s=!1)});s&&l.push({name:a.name})});angular.forEach(c,function(a,b){if(!1!==a.modify){q=void 0;angular.forEach(d,function(b,c){a.name===b.name&&(q=
b)});if(q&&(k=[],angular.forEach(q.ips,function(b){s=!0;angular.forEach(a.ips,function(a){b.seq===a.seq&&(s=!1)});s&&k.push({seq:b.seq})}),p=[],angular.forEach(q.macs,function(b){s=!0;angular.forEach(a.macs,function(a){b.mac===a.mac&&(s=!1)});s&&p.push({mac:b.mac})}),k.length||p.length))u={name:a.name},k.length&&(u.ips=k),p.length&&(u.macs=p),l.push(u);e=[];angular.forEach(a.ips,function(a,b){v={seq:a.seq,"device-type":a.device_type.select,"os-type":a.os_type.select};t=a.proto.select;switch(a.type.select){case "single":v[t]=
{single:a.setting[t].ip};break;case "range":v[t]={range:{start:a.setting[t].start,end:a.setting[t].end}};break;case "subnet":v[t]="ipv4"===t?{subnet:{ip:a.setting[t].subnet_ip,netmask:a.setting[t].subnet_netmask}}:{subnet:{ip:a.setting[t].subnet_ip,"prefix-length":a.setting[t].subnet_netmask}};break;default:Log(ERROR,"type is "+a.type.select);return}e.push(v)});r=[];angular.forEach(a.macs,function(a,b){r.push({mac:a.mac,"os-type":a.os_type.select,"device-type":a.device_type.select})});g.push({name:a.name,
ips:e,macs:r})}});l.length&&m.push({method:"del_ipgroup",params:{"ip-groups":{"ip-group":l}}});g.length&&m.push({method:"set_ipgroup",params:{"ip-groups":{"ip-group":g}}});m.length?b.post({method:"set_bulk",params:m,forcedUsingPost:!0,success:function(b){var c=b.data&&b.data.result||{};b=n(c.code,0);c=n(c.errstr,"");switch(b){case 0:a.success=!0;break;default:b="",c?-1!==c.indexOf("/ciscosb-avc:avc/")?b=a.DICT("Web_Filtering_Delete_Failure_AVC_Msg"):-1!==c.indexOf("/ciscosb-vpn-ipsec:site-to-sites/")?
b=a.DICT("Web_Filtering_Delete_Failure_S2S_Msg"):-1!==c.indexOf("/ciscosb-webfilter:webfilter/")&&(b=a.DICT("Web_Filtering_Delete_Failure_Webfilter_Msg")):b="",b=b?"<div>"+a.DICT("Web_Filtering_Delete_Failure_Default_Msg")+"</div><div>"+b+"</div>":a.DICT("Web_Filtering_Delete_Failure_Default_Msg"),app.TOOLS.criticalAlertBox({msg:b})}h()},error:function(a){h()}}):h()}};h()}]);
app.controller("ipgroupEditCtrl",["$scope","$templateCache","$uibModalInstance","model","edit","UserSession","userAccessRight","genIpsAtom","genMacAtom","genDetailStr",function(a,b,t,m,w,u,p,q,e,x){a.model=m;a.edit=w;a.sel_cnts=0;a.sel_device_cnts=0;a.device=m.device;a.os=m.os;a.note=a.DICT("IP_Address_Group_Note",{"%s":"<a ng-click=\"funs.jump('client_statistics')\">"+a.DICT("Here")+"</a>"});var n=app.TOOLS.netmask.inet2Int,l=app.TOOLS.netmask.int2Inet;angular.forEach(a.edit.macs,function(b){b.device_type.list=
a.device;b.os_type.list=a.os[b.device_type.select]});angular.forEach(a.edit.ips,function(b){b.device_type.list=a.device;b.os_type.list=a.os[b.device_type.select];b.setting.detail=x(b)});var r=function(a){var b;angular.forEach(a,function(a){"ANY"===a.id&&(b=a.id)});b||(b=a[0]&&a[0].id||"");return b};w=function(){a.sel_cnts=0;angular.forEach(a.edit.ips,function(b,d){b.checked?a.sel_cnts+=1:b.edit&&(b.edit=!1,b.setting.detailStr=x(b))})};u=function(){a.sel_device_cnts=0;angular.forEach(a.edit.macs,function(b){b.checked?
a.sel_device_cnts+=1:b.edit&&(b.edit=!1)})};var v=function(){var b=a.model.ipgroups,d=a.edit,c=a.edit.macs,e=c.length,g,l=[],m,n;angular.forEach(c,function(a){a.invalid=!1;a.repeatedWithOtherGroup=!1;a.repeatedWithOtherEntity=!1;a.errstr=""});angular.forEach(b,function(b){if(!(d.orig_name&&b.orig_name===d.orig_name)){g=b.macs;for(m=0;m<e;m++){l=[];for(n=g.length-1;0<=n;n--)g[n].mac===c[m].mac&&(c[m].repeatedWithOtherGroup=!0,l.push(b.name));l.length&&(c[m].errstr="<div>"+a.DICT("IP_Address_Group_Mac_Repeated_With_Other_Group",
{"%s":l.join(",")})+"</div>")}}});for(m=0;m<e;m++){for(n=m+1;n<e;n++)c[m].mac===c[n].mac&&(c[m].repeatedWithOtherEntity=!0,c[n].repeatedWithOtherEntity=!0);c[m].repeatedWithOtherEntity&&(c[m].errstr+="<div>"+a.DICT("IP_Address_Group_Mac_Repeated_With_Other_Mac")+"</div>");c[m].invalid=c[m].repeatedWithOtherGroup||c[m].repeatedWithOtherEntity}};a.ipsValidationCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.macValidationCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridIPSOptions=
app.uiGrid.generateGridOptions({rowHeight:1.5*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:w,headerChangedCbk:w,disableChkBoxField:"disableChk"},{name:"proto",field:"proto",displayName:a.DICT("IP_Address_Group_Protocol"),editRow:"edit",width:90,id:"Protocol",cellTemplate:"UG_table_select_with_inline_edit.html"},{name:"type",field:"type",displayName:a.DICT("IP_Address_Group_Type"),editRow:"edit",width:165,id:"Type",cellTemplate:"UG_table_select_with_inline_edit.html"},
{name:"detail",field:"setting",displayName:a.DICT("IP_Address_Group_Addr_Details"),id:"detail",editRow:"edit",minWidth:255,cellTemplate:"ip_group_sub_detail_cell.html",validationCbk:"ipsValidationCbk"},{name:"device_type",field:"device_type",displayName:a.DICT("IP_Address_Group_Device_Type"),editRow:"edit",minWidth:130,cellTemplate:"UG_table_select_with_inline_edit.html",changedCbk:function(b,d,c,e){b=d.entity;b.os_type.list=a.os[b.device_type.select];b.os_type.select=r(b.os_type.list)}},{field:"os_type",
displayName:a.DICT("IP_Address_Group_Os_Type"),minWidth:130,cellTemplate:"UG_table_select_with_inline_edit.html",editRow:"edit"}]});a.gridMacOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:u,headerChangedCbk:u,disableChkBoxField:"disableChk"},{field:"mac",displayName:a.DICT("IP_Address_Group_MAC_Address"),minWidth:150,maxWidth:200,id:"mac",change:v,required:!0,editRow:"edit",invalidField:"invalid",cellTemplate:b.get("IP_Address_text_with_inline_edit.html").replace(/data-ng-expansion/,
"mac-address"),validationCbk:"macValidationCbk"},{field:"device_type.select",displayName:a.DICT("IP_Address_Group_Device_Type")},{field:"os_type.select",displayName:a.DICT("IP_Address_Group_Os_Type")},{field:"empty",isEmpty:!0}]});a.gridIPSOptions.data=a.edit.ips;a.gridMacOptions.data=a.edit.macs;a.ipGroupCbk=function(b){var d,c,e,g=a.model.ipgroups,l=a.model.ipgroups.length;c=a.edit.name;e=a.edit.uniqueKey;d=!0;for(b=0;b<l;b++)e!==g[b].uniqueKey&&c===g[b].name&&(d=!1);Log(DEBUG,"IP Address Group Name validation: "+
d);return d};var s=function(b){var d,c;switch(b){case "ip":d=a.edit.ips;c="IP Address";break;case "mac":d=a.edit.macs,c="MAC Address"}return 50<=d.length?(a.msg="Only allow maximum of 50 entries for "+c+". (Current Entry Number: "+d.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.ipv4={change_netmask:function(a){a=a.entity.setting.ipv4;a.subnet_netmask&&(a.subnet_prefix=n(a.subnet_netmask))},change_prefix:function(a){a=a.entity.setting.ipv4;_.isNumber(a.subnet_prefix)&&
(a.subnet_netmask=l(a.subnet_prefix))}};a.funs={addIps:function(){if(!s("ip")){var b=q({},a.edit.ips.length,a.edit.uniqueKey);b.edit=!0;b.checked=!0;b.device_type.list=a.device;b.device_type.select=m.def_device;b.os_type.list=a.os[b.device_type.select];b.os_type.select=r(b.os_type.list);a.edit.ips.push(b)}},editIps:function(){angular.forEach(a.edit.ips,function(a){a.checked&&(a.edit=!0)})},delIps:function(){var b;for(b=a.edit.ips.length-1;0<=b;b--)a.edit.ips[b].checked&&a.edit.ips.splice(b,1);angular.forEach(a.edit.ips,
function(a,b){a.seq=b})},addMac:function(){if(!s("mac")){var b=e();b.disableChk=!0;b.checked=!0;b.edit=!0;b.device_type.list=a.device;b.device_type.select=m.def_device;b.os_type.list=a.os[b.device_type.select];b.os_type.select=r(b.os_type.list);a.edit.macs.push(b)}},editMac:function(){angular.forEach(a.edit.macs,function(a){a.checked&&(a.edit=!0)})},deleteMac:function(){var b=a.edit.macs,d;for(d=b.length-1;0<=d;d--)b[d].checked&&b.splice(d,1);v()},save:function(){t.close(a.edit)},cancel:function(){t.dismiss("cancel")},
jump:function(a){app.TOOLS.jumpToPage(a,void 0,function(a){a&&t.dismiss("cancel")})}};v()}]);app.controller("automaticUpdateCtrl",["$scope","MyHttp","UserSession","userAccessRight","$templateCache","dt",function(a,b,t,m,w,u){a.success=!1;a.checkNowFail=!1;a.checkNowSuccess=!1;a.dataReady=!1;a.errstr="check latest version error";a.jumpToPage=app.TOOLS.jumpToPage;a.notification_msg=a.DICT("Automatic_Updates_Msg2",{"%s":"<a ng-click=\"jumpToPage('System_Config_Email')\">"+a.DICT("Automatic_Updates_Here")+"</a>"});a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();
var p=function(b){b||(b={});var l=b;l||(l={});var l=l.image&&l.image["auto-update-global"]||{},k=l.notification&&l.notification.email||{};a.model.auto_update_global={};a.model.auto_update_global={enable:l.enable||!1,check_frequency:l["check-frequency"]||a.model.schema.checkFrequencys[2].id,email:k.address||"",bEmail:k.enabled||!1,bGUI:!0};a.model.autoUpdateGridData=[];(k=b)||(k={});var l=(k.image&&k.image.firmware||{})["auto-update"]||{},k=k["image-state"]&&k["image-state"].firmware||{},d=k["latest-version"]||
"",c=k["available-version"]||"",h="",g=u.genTimeStrByTimeStamp(k["latest-update-time"],""),m={};c&&d?h="Version "+d+(g?" was applied on "+g:"")+", Version "+c+" is available on Cisco.com.":!c&&d&&(h="Version "+d+(g?" was applied on "+g:""));h||(h="-");m={type:"firmware",name:a.DICT("Automatic_Updates_System_Firmware"),edit:!0,version:d,notify:void 0!==l.notify?l.notify:!1,update_option:l["update-option"]||"never",list:a.model.schema.firewall_usb_options,update_time:l["update-time"]||0,available_version:k["available-version"]||
"",last_check_time:k["last-check-time"]||"",state:h};e(l,m);a.model.autoUpdateGridData.push(m);(k=b)||(k={});l=(k["dongle-driver"]||{})["auto-update"]||{};k=k["dongle-driver-state"]||{};d=k["available-version"]||"";c=k.version||"";h="";g=u.genTimeStrByTimeStamp(k["latest-update-time"],"");m={};d&&c?h="Version "+c+(g?" was applied on "+g:"")+", Version "+d+" is available on Cisco.com.":!d&&c&&(h="Version "+c+(g?" was applied on "+g:""));h||(h="-");m={type:"dongle",name:a.DICT("Automatic_Updates_USB_Modem_Firmware"),
edit:!0,buildin_version:c,latest_update_time:k["latest-update-time"]||"",notify:void 0!==l.notify?l.notify:!1,update_option:l["update-option"]||"never",list:a.model.schema.firewall_usb_options,update_time:l["update-time"]||0,available_version:d,last_check_time:k["last-check-time"]||"",state:h};e(l,m);a.model.autoUpdateGridData.push(m);(k=b)||(k={});b=(k.signature||{})["auto-update"]||{};(l=k["ciscosb-security:signature-state"])||(l=k["ciscosb-avc:signature-state"]);l||(l={});k=l["available-version"]||
"";d=l.version||"";c="";h=u.genTimeStrByTimeStamp(l["latest-update-time"],"");g={};k&&d?c="Version "+d+(h?" was applied on "+h:"")+", Version "+k+" is available on Cisco.com.":!k&&d&&(c="Version "+d+(h?" was applied on "+h:""));c||(c="-");g={type:"signature",name:a.DICT("Automatic_Updates_Security_Signature"),edit:!0,version:d,last_update_time:l["latest-update-time"]||"",notify:void 0!==b.notify?b.notify:!1,update_option:b["update-option"]||"never",list:a.model.schema.updateOptions,update_time:b["update-time"]||
0,available_version:k,last_check_time:l["last-check-time"]||"",state:c};e(b,g);a.model.autoUpdateGridData.push(g);a.gridAutoUpdateOptions.data=a.model.autoUpdateGridData},q=function(){b.post({url:resource_base+"data/automatic_updates.json",method:"get_auto_update",success:function(a){app.TOOLS.get_scope("headerCtrl").update_asd_notify(a);a.data&&a.data.result?p(a.data.result):p()},error:function(a){console.log("automaticUpdateCtrl getData error status: "+a.status);p()}})},e=function(a,b){var e=parseInt(a["update-time"],
10);switch(a["update-option"]){case "time":!isNaN(e)&&0<=e&&24>e?b.update=e:b.update="never";break;case "immediately":b.update="immediately";break;default:b.update="never"}},x=[{id:"never",displayName:a.DICT("Automatic_Updates_Never")},{id:"immediately",displayName:a.DICT("Automatic_Updates_Immediately")}],n=function(a){var b=!1;angular.forEach(x,function(e,d){e.id===a&&(b=!0)});return b},l=function(b){var e=a.model.auto_update_global;b.image["auto-update-global"]={enable:"none"===e.check_frequency?
!1:!0,"check-frequency":e.check_frequency,notification:{email:{enabled:e.bEmail,address:e.email},gui:e.bGUI}};return b},r=function(){q();a.dataReady=!0};a.model={autoUpdateGridData:[],schema:{checkFrequencys:[],updateOptions:[],firewall_usb_options:[]},dongle_driver:{},signature:{},auto_update_global:{},checking_status:"none",firmware:{}};a.gridAutoUpdateOptions=app.uiGrid.generateGridOptions({minRowsToShow:4,enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,enableHorizontalScrollbar:app.uiGrid.scrollbars.NEVER,
columnDefs:[{field:"name",displayName:"",enableSorting:!1,width:175},{field:"notify",displayName:a.DICT("Automatic_Updates_Notify"),width:120,editRow:"edit",cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"update",displayName:a.DICT("Automatic_Updates_Update"),editRow:"edit",width:180,cellTemplate:w.get("UG_table_text_with_inline_select_edit_and_custom_options.html").replace(/NGOPTIONS/,"m.id as m.displayName for m in row.entity.list")},{field:"state",displayName:a.DICT("Automatic_Updates_Status")}]});
a.funs={save:function(){var e={image:{}};a.checkNowFail=!1;a.checkNowSuccess=!1;e=l(e);angular.forEach(a.model.autoUpdateGridData,function(a,b){switch(a.type){case "firmware":var d=e;d.image.firmware={"auto-update":{notify:a.notify,"update-option":a.update}};n(a.update)||(d.image.firmware["auto-update"]["update-option"]="time",d.image.firmware["auto-update"]["update-time"]=a.update);e=d;break;case "dongle":d=e;d["dongle-driver"]={"auto-update":{notify:a.notify,"update-option":a.update}};n(a.update)||
(d["dongle-driver"]["auto-update"]["update-option"]="time",d["dongle-driver"]["auto-update"]["update-time"]=a.update);e=d;break;case "signature":d=e,d.signature={"auto-update":{notify:a.notify,"update-option":a.update}},n(a.update)||(d.signature["auto-update"]["update-option"]="time",d.signature["auto-update"]["update-time"]=a.update),e=d}});b.post({method:"set_auto_update",params:e,success:function(b){a.success=!0;r();a.resetModified()},error:function(b){r();a.resetModified()}})},cancel:function(){a.checkNowFail=
!1;a.checkNowSuccess=!1;r();a.resetModified()},checkNow:function(){a.checkNowSuccess=!1;a.checkNowFail=!1;var b=app.TOOLS.get_scope("backgroundAppCtrl");b&&(b.firmware_lib&&"function"===$.type(b.firmware_lib.check_firmware))&&"start"===b.firmware_lib.check_firmware()&&(a.model.checking_status="checking")}};a.hasNewVersionCbk=function(a){r();console.log("has new firmware")};a.invokeCheckingSuccessCbk=function(b,e){a.model.checking_status="finish";a.errstr=e;!0===b?(e||(e=a.DICT("Success")),app.TOOLS.successAlertBox({title:a.DICT("Information"),
msg:e,cbk:function(){r()}})):(e||(e=a.DICT("Failure")),app.TOOLS.criticalAlertBox({title:a.DICT("Alert"),msg:e,cbk:function(){r()}}))};(function(){var b;a.model.schema={checkFrequencys:[{id:"none",displayName:a.DICT("Automatic_Updates_Never")},{id:"weekly",displayName:a.DICT("Automatic_Updates_Week")},{id:"monthly",displayName:a.DICT("Automatic_Updates_Month")}],firewall_usb_options:angular.copy(x),updateOptions:angular.copy(x)};a.model.schema.firewall_usb_options.splice(1,1);for(b=0;24>b;b++)a.model.schema.updateOptions.push({id:b,
displayName:(10>b?"0":"")+b+":00"}),a.model.schema.firewall_usb_options.push({id:b,displayName:(10>b?"0":"")+b+":00"})})();r()}]);app.controller("clientToSiteCtrl",["$scope","MyHttp","oneTimeLocker","$window","$q","$templateCache","UserSession","userAccessRight","addressPoolValidate","wan_service",function(a,b,t,m,w,u,p,q,e,x){var n=!1,l=app.TOOLS.getVal,r=app.TOOLS.getResponse;a.success=!1;a.disable_add_user_group=!1;a.disable_del_user_group=!1;a.subnetObj={};a.ori_status=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.ipsecprofile_note=a.DICT("Client_to_Site_Ipsec_Profile_Note",{"%s":"<a ng-click=\"jumpToPage('VPN_IPsec_Profiles')\">"+
a.DICT("here")+"</a>"});a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&p.logout();var v=function(){return b.post({url:resource_base+"data/ipsec_client_to_site.json",method:"get_client_to_site",error:function(a){Log(ERROR,"clientToSIteCtrl getClientToSiteData error, status: "+a.status);s();M()}})},s=function(b){b||(b={});b=b["client-to-sites"]||{};var c=b["client-to-site"]||[];a.model.max_group=b["max-group"]||0;a.model.c2s=[];angular.forEach(c,function(b,c){a.model.c2s.push(k(b))});
a.model.orig_c2s=angular.copy(a.model.c2s)},k=function(b){var c=!1;b||(c=!0,b={});var d={},g=b.mode||{},e=b["extended-authentication"]||{},h=b["ip-pool"]||{},k=!1,l=b["remote-endpoint"]||{},m=b["split-tunnel"]||{},n=b["split-dns"]||{},p,r,q,s=function(a){var b={type:"",ip:"",fqdn:"",user_fqdn:"",der_asn1_dn:"","interface":""};if(!a)return b;angular.forEach(a,function(a,c){switch(c){case "ip":b.type=c;b.ip=a;break;case "interface":b.type=c;b["interface"]="";break;case "fqdn":b.type=c;b.fqdn=a;break;
case "user-fqdn":b.type=c;b.user_fqdn=a;break;case "der-asn1-dn":b.type=c,b.der_asn1_dn=a}});return b};q=p=void 0;k=!1;b["local-certificate"]&&b["local-certificate"].certificate&&(p=b["local-certificate"].certificate,k=!0);b["remote-certificate"]&&b["remote-certificate"].certificate&&(q=b["remote-certificate"].certificate,k=!0);void 0===q&&(q=a.model.default_ca_cert);p||(p=a.model.default_cert);b["ipsec-profile"]&&(r=b["ipsec-profile"]||"");r||(r=a.model.default_profile);d={seq:b.seq||"",type:"cisco-vpn",
editType:"new",group_name:b["group-name"]||"",group_auth:void 0!==b["group-authentication"]?b["group-authentication"]:a.model.auth_groups[0]?a.model.auth_groups[0].id:"",mode:{type:"client",start_ip:g["start-ip"]||"",end_ip:g["end-ip"]||""},backup_server_1:b["backup-server-1"]||"",backup_server_2:b["backup-server-2"]||"",backup_server_3:b["backup-server-3"]||"",ipsec_profile:b["ipsec-profile"]||a.model.default_profile,ike_mode:(a.model.profilesMap[r]||{}).ike_mode||"v2",local_identifier:{},remote_identifier:{},
extended_auth:{enable:void 0!==e.enable?e.enable:!1,group:void 0!==e.group?e.group:a.model.auth_groups[0]?a.model.auth_groups[0].id:""},ip_pool:{start_ip:h["start-ip"]||"",end_ip:h["end-ip"]||""},remote_endpoint:{type:"dynamic-ip",static_ip:"",fqdn:""},local_group:{},aggressive_mode:void 0!==b["aggressive-mode"]?b["aggressive-mode"]:!1,compress:void 0!==b.compress?b.compress:!1,enable:void 0!==b.enable?b.enable:!1,intf:b["interface"]||a.model.ifs[0]&&a.model.ifs[0].id||"",auth:{method:k?"certificate":
"preshared-key",password:b.password||"",show_key_in_plain:!1,enable_show_key_in_plain:!1,strength_meter:b["strength-meter"]||0,min_complexity:void 0!==b["minimum-complexity"]?b["minimum-complexity"]:!0,certificate:p,remote_certificate:q},primary_dns:b["primary-dns"]||"",secondary_dns:b["secondary-dns"]||"",primary_wins:b["primary-wins"]||"",secondary_wins:b["secondary-wins"]||"",default_domain:b["default-domain"]||"",split_tunnel:{enable:void 0!==m.enable?m.enable:!1,networks:[]},split_dns:{enable:void 0!==
n.enable?n.enable:!1,fqdn:[]}};void 0===b["group-name"]&&!c&&(d.type="third-party-vpn");b.mode&&angular.forEach(b.mode,function(a,b){"nem"===b&&(d.mode.type="nem")});angular.forEach(l,function(a,b){switch(b){case "static-ip":d.remote_endpoint.static_ip=a;d.remote_endpoint.type=b;break;case "fqdn":d.remote_endpoint.fqdn=a;d.remote_endpoint.type=b;break;case "dynamic-ip":d.remote_endpoint.type=b}});m.networks&&angular.forEach(m.networks,function(a,b){d.split_tunnel.networks.push(J(a))});n.fqdn&&angular.forEach(n.fqdn,
function(a,b){d.split_dns.fqdn.push(R(a))});d.local_identifier=s(b["local-identifier"]||void 0);d.local_identifier.type||(d.local_identifier.type=a.schema.local_identifier[0].id);d.local_identifier.der_asn1_dn="";d.remote_identifier=s(b["remote-identifier"]);d.remote_identifier.type||(d.remote_identifier.type=a.schema.remote_identifier[0].id);"der-asn1-dn"===d.remote_identifier.type&&"%any"===d.remote_identifier.der_asn1_dn&&(d.remote_identifier.der_asn1_dn="");d.local_group=function(a){a||(a={});
var b={type:"any",subnet_ip:"",subnet_netmask:"",ip:"",begin_ip:"",end_ip:""};if(!a)return b;angular.forEach(a,function(a,c){switch(c){case "subnet":"0.0.0.0"===a.ip&&"0.0.0.0"===a.netmask?b.type="any":(b.type="subnet",b.subnet_ip=a.ip||"",b.subnet_netmask=a.netmask||"");break;case "ip":b.type="ip";b.ip=a.ip;break;case "ip-range":b.type="ip-range",b.begin_ip=a["begin-ip"],b.end_ip=a["end-ip"]}});return b}(b["local-group"]);return d},d=function(){return b.post({url:resource_base+"data/wan_setting_state.json",
method:"get_interface_state",error:function(a){Log(ERROR,"getInterfaceState error: "+a.status);c();h()}})},c=function(b){b||(b={});var c=[];b["interfaces-state"]&&b["interfaces-state"]["interface"]&&(c=b["interfaces-state"]["interface"]);a.model.vlanIp="";angular.forEach(c,function(b){"VLAN1"===b.name&&(a.model.vlanIp=b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].ip||"")})},h=function(b){b||(b={});a.model.ifs_state=x.get_ifs_status(b)},g=function(){return b.post({url:resource_base+
"data/nacm_group.json",method:"get_groups",error:function(a){A()}})},A=function(b){b||(b={});b=b.groups&&b.groups.group||[];a.model.auth_groups=[];angular.forEach(b,function(b,c){a.model.auth_groups.push({id:b.name,displayName:b.name})});a.model.rule_list=[];a.model.nacm_grid=[];a.model.groups=[];a.model.connections=[];a.model.c2s_group_yes=[];a.model.c2s_group_no=[];b&&(a.model.rule_list=angular.copy(b));angular.forEach(a.model.rule_list,function(b){a.model.groups.push(b.name)});angular.forEach(a.model.rule_list,
function(b){b["feature-rule"]&&angular.forEach(b["feature-rule"],function(b){if("ezvpn"===b.service&&b.option){var c=[],c=angular.copy(b.option);for(b=0;b<c.length;b++)if(0===a.model.connections.length)a.model.connections.push({name:c[b],yes_group:[],no_group:[],grid_table:[]});else{f=!0;for(var d=0;d<a.model.connections.length;d++)if(c[b]===a.model.connections[d].name){f=!1;break}!0===f&&a.model.connections.push({name:c[b],yes_group:[],no_group:[],grid_table:[]})}}})});angular.forEach(a.model.connections,
function(b){angular.forEach(a.model.rule_list,function(a){a["feature-rule"]&&angular.forEach(a["feature-rule"],function(c){if("ezvpn"===c.service&&c.option){var d=[],d=angular.copy(c.option);for(c=0;c<d.length;c++)if(b.name===d[c]){b.yes_group.push({name:a.name,id:a.name,displayName:a.name});break}}})})});angular.forEach(a.model.connections,function(b){angular.forEach(a.model.rule_list,function(a){f=!0;angular.forEach(b.yes_group,function(b){a.name===b.name&&(f=!1)});!0===f&&b.no_group.push({name:a.name,
id:a.name,displayName:a.name})})});angular.forEach(a.model.connections,function(a){angular.forEach(a.yes_group,function(b){a.grid_table.push({exp:{list:a.yes_group,select:b.name},empty:"",invalid:!1,edit:!1})})})},y=function(){var b=[],c=!0;angular.forEach(a.model.c2s,function(b){for(var c=0;c<a.model.connections.length;c++)if(b.seq===a.model.connections[c].name){b.nacm=angular.copy(a.model.connections[c]);break}});angular.forEach(a.model.groups,function(a){b.push({name:a,id:a,displayName:a})});angular.forEach(a.model.c2s,
function(d){c=!0;angular.forEach(a.model.connections,function(a){d.seq===a.name&&(c=!1)});!0===c&&(a.model.connections.push({name:d.seq,yes_group:[],no_group:b,grid_table:[]}),d.nacm=angular.copy({name:d.seq,yes_group:[],no_group:b,grid_table:[]}))})},z=function(){return b.post({url:resource_base+"data/ipsec_profiles.json",method:"get_ipsec_profile",error:function(a){Log(ERROR,"siteToSiteCtrl getProfile error, status: "+a.status)}})},B=function(b){b||(b={});b=(b["ipsec-profiles"]||{})["ipsec-profile"]||
[];var c,d,g,e,h;a.model.profiles=[];a.model.profilesMap={};a.model.default_profile="";angular.forEach(b,function(b,k){c=b["keying-mode"]||{};if(e=b["profile-name"]||"")d="auto",g="",h={},b["keying-mode"]&&(c["phase1-options"]?(d="auto",angular.forEach(c["ike-version"],function(a,b){switch(b){case "v1":g="v1";break;default:g="v2"}})):g=d="manual"),h={id:e,displayName:e,mode:d,ike_mode:g},a.model.profiles.push(h),a.model.profilesMap[e]=h,"Default"===e&&(a.model.default_profile=e)});a.model.default_profile||
(a.model.default_profile=a.model.profiles[0]&&a.model.profiles[0].name||"")},D=function(b){b||(b={});b=(b["certs-state"]||{}).cert||[];var c={},d,g;a.model.certs=[];a.model.default_cert="";angular.forEach(b,function(b,e){if((d=b.name||"")&&!c[d]&&!("imported"!==b.source&&"generated"!==b.source))"Default"===d&&(g=d),a.model.certs.push({name:d,subject:app.TOOLS.cert2subject(b)}),c[d]=!0});g||(g=a.model.certs[0]&&a.model.certs[0].name||"");a.model.default_cert=g},E=function(){return b.post({url:resource_base+
"data/wan_setting1.json",method:"get_interface",error:function(a){Log(ERROR,"clientToSIteCtrl getInterfaceData error "+a.status);C()}})},C=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var c=[],d=[];a.model.ifs=[];angular.forEach(b,function(a,b){a.name&&(a.name.match(/^WAN\d+($|\.\d+$)/)&&c.push({id:a.name,displayName:a.name}),a.name.match(/^USB\d+/)&&d.push({id:a.name,displayName:a.name}))});a.model.ifs=c.concat(d)},I=function(){b.post({method:"get_all_cert",procBackground:!0,url:resource_base+
"data/get_all_cert.json",success:function(b){b=b&&b.data&&b.data.result||{};D(b);G(b);a.certReady=!0;H();a.checkASN1DNCert()},error:function(b){Log(ERROR,"[S2S] get_all_cert error "+JSON.stringify(b));D();G();a.certReady=!0;H();a.checkASN1DNCert()}})},G=function(b){b||(b={});var c=[],d;b["certs-state"]&&b["certs-state"].cert&&(c=b["certs-state"].cert);a.model.ca_certs=[];angular.forEach(c,function(b){b.info&&b.info["is-ca-enabled"]&&(d={name:b.name||"",displayName:b.name||""},d.name&&a.model.ca_certs.push(d))});
a.model.default_ca_cert=a.model.ca_certs[0]&&a.model.ca_certs[0].name||""},H=function(){if(a.edit&&a.certReady){var b=a.edit;b.auth.certificate||(b.auth.certificate=a.model.default_cert);b.auth.remote_certificate||(b.auth.remote_certificate=a.model.default_ca_cert);a.waitForCert=!1}},F=function(){return b.post({url:resource_base+"data/telework_vpn_clients.json",method:"get_teleworker_vpn",error:function(a){Log(ERROR,"teleworkerVPNCtrl getTeleworkerData error : "+a.status);K()}})},K=function(b){b||
(b={});a.model.teleworker_enable=b&&b["teleworker-vpn-clients"]&&b["teleworker-vpn-clients"].enable?!0:!1},M=function(){a.model.display=[];angular.forEach(a.model.c2s,function(b,c){a.model.display.push({checked:!1,group:b.seq,seq:b.seq,intf:b.intf,auth:"preshared-key"===b.auth.method?a.DICT("Client_to_Site_Preshared_Key"):a.DICT("Client_to_Site_Certificate"),mode:"client"===b.mode.type?"Client":"Nem",action:[{cbk:a.funs.disconnect,displayName:a.DICT("Client_to_Site_Disconnect")}]})});a.gridC2SOptions.data=
a.model.display},N=[{id:"interface",displayName:a.DICT("Client_to_Site_Local_WAN_IP")},{id:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N")},{id:"fqdn",displayName:a.DICT("Client_to_Site_FQDN")},{id:"user-fqdn",displayName:a.DICT("Client_to_Site_User_FQDN")}],J=function(a){var b=!1;a||(a={},b=!0);return{ip:a.ip||"",netmask:a.netmask||"",edit:!1,checked:b?!0:!1,invalid:!1}},R=function(a){var b=!1;a||(a={},b=!0);return{fqdn:a.fqdn||"",edit:!1,checked:b?!0:!1,invalid:!1}},W=function(){return b.post({url:resource_base+
"data/ipsec_enable.json",method:"get_ipsec_enable",error:function(a){Log(ERROR,"[C2S][getIPSecEnable] "+JSON.stringify(a));S()}})},S=function(b){b||(b={});b=l((b.ipsec||{}).enable,!0);a.model.ipsec_enable=b},X=function(){return b.post({url:resource_base+"data/aaa.json",method:"get_subnet",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},T=function(b){b.data&&(b.data.result&&b.data.result.subnets&&b.data.result.subnets.ipv4&&b.data.result.subnets.ipv6)&&(a.subnetObj=
angular.copy(b.data.result.subnets))},L=function(){w.all([g(),v(),F()]).then(function(b){A(b[0].data&&b[0].data.result||{});s(b[1].data&&b[1].data.result||{});K(b[2].data&&b[2].data.result||{});y();M();a.edit=void 0;a.procC2SClick();setTimeout(function(){a.gridC2SOptions.gridApi.customApi.checkSelectStatus()},50);a.resetModified()})};a.changeIpsecProfile=function(){var b=a.edit,c;if(b)switch(c=a.model.profilesMap[b.ipsec_profile],b.ike_mode=c&&c.ike_mode||"v2",b.ike_mode){case "manual":a.model.profileInfo=
a.DICT("Client_to_Site_Manual_Profile_Chosen");break;case "v1":a.model.profileInfo=a.DICT("Client_to_Site_IKEv1_Profile_Chosen");break;default:a.model.profileInfo=a.DICT("Client_to_Site_IKEv2_Profile_Chosen")}};var U=function(){a.tabs=angular.copy(P);a.tabUrl="ipsec_c2s_3rd_basic.html";a.currPage="edit"},V=function(){a.selectIdx=-1;a.currPage="main"},P=[{heading:a.DICT("Client_to_Site_Header_Basic"),templateUrl:"ipsec_c2s_3rd_basic.html"},{heading:a.DICT("Client_to_Site_Header_Advanced"),templateUrl:"ipsec_c2s_3rd_adv.html"}];
a.pageMap={main:"ipsec_c2s_main.html",edit:"ipsec_c2s_edit.html"};a.currPage="main";a.tabUrl="ipsec_c2s_3rd_basic.html";a.dataReady=!1;a.selectIdx=-1;a.selection=[];a.edit=void 0;a.origEdit=void 0;a.edit_split_fqdns=[];a.edit_split_tunnels=[];a.certReady=!1;a.waitForCert=!1;a.schema={};a.model={ipsec_enable:!0,c2s:[],orig_c2s:[],ifs:[],display:[],certs:[],profiles:[],profilesMap:{},profileInfo:"",default_profile:"",default_cert:"",default_ca_cert:"",ca_certs:[],auth_groups:[],max_group:0,vlanIp:"",
rule_list:[],nacm_grid:[],c2s_group_remain:[],c2s_group_yes:[],c2s_group_no:[],groups:[],connections:[],c2s_group_dels:[],ifs_state:{}};a.procC2SClick=function(b){var c=-1;a.selectIdx=-1;angular.forEach(a.model.display,function(b,d){c=-1;angular.forEach(a.selection,function(a,b){a===d&&(c=b)});b.checked?-1===c&&(a.selection.push(d),a.selectIdx=d):-1!==c&&a.selection.splice(c,1)})};a.gridC2SOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.procC2SClick,
headerChangedCbk:a.procC2SClick},{field:"group",displayName:a.DICT("Client_to_Site_Group_Tunnel_Name")},{field:"intf",displayName:a.DICT("Client_to_Site_WAN_Interface")},{field:"auth",displayName:a.DICT("Client_to_Site_Authentication_Method")}]});a.splitTunnelCbk=function(){var b=[],c=0,d,g,e;if(a.edit){var b=a.edit.split_tunnel.networks,c=b.length,h=function(a,e,h){if(!(0>a))for(d=a;d<c;d++)if((g=b[d])&&d!==e&&app.TOOLS.validation.ipv4_getNet(g.ip,g.netmask).toString()==h)g.invalid=!0,b[e].invalid=
!0};angular.forEach(b,function(a){a.invalid=!1});for(e=0;e<c;e++)if(b[e]&&b[e].ip&&b[e].netmask){var k=app.TOOLS.validation.ipv4_getNet(b[e].ip,b[e].netmask).toString();h(e,e,k)}}};a.procSplitTunnelNetworksClick=function(){a.edit_split_tunnels=[];angular.forEach(a.edit.split_tunnel.networks,function(b,c){b.checked?a.edit_split_tunnels.push(b):b.edit=!1})};a.gridSplitTunnelInvalidCbk=function(a){a.row.entity.disableSplitTunnelChk=a.rowInvalid};a.gridSplitTunnelOptions=app.uiGrid.generateGridOptions({IDPreifx:"c2sSplitTunnel",
columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.procSplitTunnelNetworksClick,headerChangedCbk:a.procSplitTunnelNetworksClick,disableChkBoxField:"disableSplitTunnelChk"},{field:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N"),editRow:"edit",id:"splittunnelip",validationCbk:"gridSplitTunnelInvalidCbk",cellTemplate:u.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-ip check-ipv4-bymask=\"row.entity['netmask']\""),customVldCbk:"splitTunnelCbk",invalidField:"invalid",
required:!0},{field:"netmask",displayName:a.DICT("Client_to_Site_Netmask"),editRow:"edit",id:"splittunnelnetmask",validationCbk:"gridSplitTunnelInvalidCbk",cellTemplate:u.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv4-netmask check-mask-byipv4="row.entity[\'ip\']" custom-vld custom-vld-cbk="splitTunnelCbk"'),required:!0,invalidField:"invalid",customVldCbk:"splitTunnelCbk"}]});a.splitDnsCbk=function(b){b=a.edit.split_dns.fqdn;var c=b.length,d,g;angular.forEach(b,function(a){a.invalid=
!1});for(d=0;d<c;d++)for(g=d+1;g<c;g++)b[d].fqdn===b[g].fqdn&&(b[d].invalid=!0,b[g].invalid=!0)};a.procSplitDNSClick=function(b){a.edit_split_fqdns=[];angular.forEach(a.edit.split_dns.fqdn,function(b,c){b.checked?a.edit_split_fqdns.push(c):b.edit=!1})};a.gridSplitDNSInvalidCbk=function(a){a.row.entity.disableSplitDNSChk=a.rowInvalid};a.gridSplitDNSOptions=app.uiGrid.generateGridOptions({IDPreifx:"c2sSplitDNS",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.procSplitDNSClick,headerChangedCbk:a.procSplitDNSClick,
disableChkBoxField:"disableSplitDNSChk"},{field:"fqdn",displayName:a.DICT("Client_to_Site_Domain_Name"),editRow:"edit",id:"splittunneldomain",validationCbk:"gridSplitDNSInvalidCbk",cellTemplate:u.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'domain-name maxlength="253"'),required:!0,customVldCbk:"splitDnsCbk",invalidField:"invalid"}]});var O=function(b){if(a.edit){var c=a.edit.seq||"",d=!0,g=[];a.model.nacm_grid=[];a.model.c2s_group_yes=[];a.model.c2s_group_no=[];n=!0;if("new"===
b)angular.forEach(a.model.groups,function(a){g.push({name:a,id:a,displayName:a})}),a.edit.nacm=angular.copy({name:"newConn",yes_group:[],no_group:g,grid_table:[]});else{d=!0;for(b=0;b<a.model.connections.length;b++)if(c===a.model.connections[b].name){d=!1;break}!0===d&&(angular.forEach(a.model.groups,function(a){g.push({name:a,id:a,displayName:a})}),a.model.connections.push({name:c,yes_group:[],no_group:g,grid_table:[]}),a.edit.nacm=angular.copy({name:c,yes_group:[],no_group:g,grid_table:[]}))}a.model.nacm_grid=
angular.copy(a.edit.nacm.grid_table);a.model.c2s_group_yes=angular.copy(a.edit.nacm.yes_group);a.model.c2s_group_no=angular.copy(a.edit.nacm.no_group);angular.forEach(a.model.nacm_grid,function(a,b){a.checked=!1});a.disable_add_user_group=0>=a.model.c2s_group_no.length?!0:!1;a.disable_del_user_group=0>=a.model.nacm_grid.length?!0:!1}},Q=function(){a.model.c2s_group_remain=angular.copy(a.model.c2s_group_no);angular.forEach(a.model.nacm_grid,function(b){if(!0===b.edit)for(var c=0;c<a.model.c2s_group_remain.length;c++)if(b.exp.select===
a.model.c2s_group_remain[c].name){a.model.c2s_group_remain.splice(c,1);break}});angular.forEach(a.model.nacm_grid,function(b){!0===b.edit&&(b.exp.list=[{name:b.exp.select,id:b.exp.select,displayName:b.exp.select}].concat(a.model.c2s_group_remain))})};a.procNgClick=function(b){a.disable_del_user_group=!0;a.model.c2s_group_dels=[];angular.forEach(a.model.nacm_grid,function(b,c){b.checked&&(a.disable_del_user_group=!1,a.model.c2s_group_dels.push(b))})};a.gridGroup=app.uiGrid.generateGridOptions({IDPreifx:"c2s",
columnDefs:[{field:"checked",isCheckbox:!0,displayName:"",changedCbk:a.procNgClick,headerChangedCbk:a.procNgClick},{field:"exp",displayName:a.DICT("Client_to_Site_Group_Name_N"),minWidth:350,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html",change:Q},{field:"empty",isEmpty:!0}]});var Y=function(){var b=[],c=[],d=!1,g,e,h=[];angular.forEach(a.model.orig_c2s,function(c){g=!1;angular.forEach(a.model.c2s,function(a){c.seq===a.seq&&(g=!0)});g||b.push(c)});angular.forEach(b,function(b,
c){e=b.seq;h.push({seq:e});angular.forEach(a.model.rule_list,function(a){angular.forEach(a["feature-rule"],function(a){if("ezvpn"===a.service&&a.option)for(var b=0;b<a.option.length;b++)if(e===a.option[b]){d=!0;a.option.splice(b,1);break}})})});h.length&&(d&&c.push({method:"set_groups",params:{groups:{group:a.model.rule_list}}}),c.push({method:"del_client_to_site",params:{"client-to-sites":{"client-to-site":h}}}));return c},aa=function(){var b=[],c=!1;if(!a.edit)return b;if(n){var d=a.edit.seq,g=
[],e=[],h;angular.forEach(a.model.nacm_grid,function(a){g.push(a.exp.select)});angular.forEach(a.model.c2s_group_remain,function(a){e.push(a.name)});for(h=0;h<g.length;h++)angular.forEach(a.model.rule_list,function(a){g[h]===a.name&&angular.forEach(a["feature-rule"],function(a){if("ezvpn"===a.service)if(a.option){flag=!1;for(var b=0;b<a.option.length;b++)if(d===a.option[b]){flag=!0;break}!1===flag&&(a.option.push(d),c=!0)}else option=[],option.push(d),a.option=angular.extend(option),c=!0})});for(h=
0;h<e.length;h++)angular.forEach(a.model.rule_list,function(a){e[h]===a.name&&angular.forEach(a["feature-rule"],function(a){if("ezvpn"===a.service&&a.option)for(var b=0;b<a.option.length;b++)if(d===a.option[b]){a.option.splice(b,1);c=!0;break}})})}var k=a.origEdit,l=a.edit,m;(function(){var a=!1,c;k&&(m={seq:k.seq},k.seq!==l.seq?(k=void 0,a=!0):(angular.forEach(k.split_dns.fqdn,function(b){c=!0;angular.forEach(l.split_dns.fqdn,function(a){b.fqdn===a.fqdn&&(c=!1)});c&&(m["split-dns"]||(m["split-dns"]=
{fqdn:[]}),m["split-dns"].fqdn.push({fqdn:b.fqdn}),a=!0)}),angular.forEach(k.split_tunnel.networks,function(b){c=!0;angular.forEach(l.split_tunnel.networks,function(a){b.ip===a.ip&&(c=!1)});c&&(m["split-tunnel"]||(m["split-tunnel"]={networks:[]}),m["split-tunnel"].networks.push({ip:b.ip}),a=!0)})),a&&b.push({method:"del_client_to_site",params:{"client-to-sites":{"client-to-site":[m]}}}))})();(function(){var c=function(a){var b=void 0;switch(a.type){case "ip":b={ip:a.ip};break;case "fqdn":b={fqdn:a.fqdn};
break;case "user-fqdn":b={"user-fqdn":a.user_fqdn};break;case "der-asn1-dn":b={"der-asn1-dn":a.der_asn1_dn};break;case "interface":b={"interface":l.intf}}return b};m={seq:l.seq,enable:l.enable,"interface":l.intf};if("cisco-vpn"===l.type){m["group-name"]=l.seq;m["group-authentication"]=l.group_auth;switch(l.mode.type){case "client":m.mode={"start-ip":l.mode.start_ip,"end-ip":l.mode.end_ip};break;case "nem":m.mode={nem:null}}if(!k||k.backup_server_1!==l.backup_server_1)m["backup-server-1"]=l.backup_server_1;
if(!k||k.backup_server_2!==l.backup_server_2)m["backup-server-2"]=l.backup_server_2;if(!k||k.backup_server_3!==l.backup_server_3)m["backup-server-3"]=l.backup_server_3}else if("third-party-vpn"===l.type){m["extended-authentication"]={enable:l.extended_auth.enable,group:l.extended_auth.group};m["ipsec-profile"]=l.ipsec_profile;m["ip-pool"]={enable:!0,"start-ip":l.ip_pool.start_ip,"end-ip":l.ip_pool.end_ip};switch(l.remote_endpoint.type){case "static-ip":m["remote-endpoint"]={"static-ip":l.remote_endpoint.static_ip};
break;case "fqdn":m["remote-endpoint"]={fqdn:l.remote_endpoint.fqdn};break;case "dynamic-ip":m["remote-endpoint"]={"dynamic-ip":null}}switch(l.local_group.type){case "subnet":m["local-group"]={subnet:{ip:l.local_group.subnet_ip,netmask:l.local_group.subnet_netmask}};break;case "ip":m["local-group"]={ip:{ip:l.local_group.ip}};break;case "ip-range":m["local-group"]={"ip-range":{"begin-ip":l.local_group.begin_ip,"end-ip":l.local_group.end_ip}};break;case "any":m["local-group"]={subnet:{ip:"0.0.0.0",
netmask:"0.0.0.0"}}}m["local-identifier"]=c(l.local_identifier);"der-asn1-dn"===l.local_identifier.type&&(m["local-identifier"]["der-asn1-dn"]="asn1dn");m["local-group"]||(m["local-group"]={});"der-asn1-dn"===l.remote_identifier.type&&!l.remote_identifier.der_asn1_dn&&(l.remote_identifier.der_asn1_dn="%any");m["remote-identifier"]=c(l.remote_identifier);m["aggressive-mode"]=l.aggressive_mode;m.compress=l.compress}switch(l.auth.method){case "preshared-key":if(!k||k.auth.password!==l.auth.password)m.password=
l.auth.password,m["strength-meter"]=l.auth.strength_meter;m["minimum-complexity"]=l.auth.min_complexity;break;case "certificate":m["local-certificate"]={certificate:l.auth.certificate},m["remote-certificate"]={certificate:l.auth.remote_certificate}}if(!k||k.primary_dns!==l.primary_dns)m["primary-dns"]=l.primary_dns;if(!k||k.secondary_dns!==l.secondary_dns)m["secondary-dns"]=l.secondary_dns;if(!k||k.primary_wins!==l.primary_wins)m["primary-wins"]=l.primary_wins;if(!k||k.secondary_wins!==l.secondary_wins)m["secondary-wins"]=
l.secondary_wins;if(!k||k.default_domain!==l.default_domain)m["default-domain"]=l.default_domain;m["split-tunnel"]={enable:l.split_tunnel.enable,networks:[]};angular.forEach(l.split_tunnel.networks,function(a){m["split-tunnel"].networks.push({ip:a.ip,netmask:a.netmask})});m["split-dns"]={enable:l.split_dns.enable,fqdn:[]};angular.forEach(l.split_dns.fqdn,function(a){m["split-dns"].fqdn.push({fqdn:a.fqdn})});a.edit.enable&&a.model.teleworker_enable&&b.push({method:"set_teleworker_vpn",params:{"teleworker-vpn-clients":{enable:!1}}});
b.push({method:"set_client_to_site",params:{"client-to-sites":{"client-to-site":[m]}}})})();c&&b.push({method:"set_groups",params:{groups:{group:a.model.rule_list}}});return b},ba=function(){return 10<=a.model.display.length?(a.msg="Only allow maximum of 10 entries for IPSec Client-to-Site. (Current Entry Number: "+a.model.display.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.splitTunnelCheck=function(){return 50<=a.edit.split_tunnel.networks.length?(a.msg="Only allow maximum of 50 entries for Split Tunnel. (Current Entry Number: "+
a.edit.split_tunnel.networks.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};var ca=function(){return 30<=a.edit.split_dns.fqdn.length?(a.msg="Only allow maximum of 30 entries for Split DNS. (Current Entry Number: "+a.edit.split_dns.fqdn.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.funs={save:function(){var c=[],c=c.concat(Y()),c=c.concat(aa());c.length?b.post({method:"set_bulk",forcedUsingPost:!0,params:c,success:function(b){a.success=
!0;a.selectIdx>=a.model.c2s.length-1&&(a.selectIdx=-1);V();L()},error:function(a){V();L()}}):(V(),L())},cancel:function(){V();L()},add:function(){ba()||(a.disable_del_user_group=!0,a.edit=k(),a.edit.editIdx=-1,a.edit.editType="new",a.edit.primary_dns=a.model.vlanIp,a.edit.auth.enable_show_key_in_plain=!0,a.edit.auth.show_key_in_plain=!1,a.origEdit=void 0,a.checkLocalIdentifier(),a.ori_status=a.edit.enable||!1,O(a.edit.editType),a.changeIpsecProfile(),a.gridSplitTunnelOptions.data=a.edit.split_tunnel.networks,
a.gridSplitDNSOptions.data=a.edit.split_dns.fqdn,a.gridGroup.data=a.model.nacm_grid,a.change_auth_method(),U(),a.modified())},edit:function(){var b=-1;angular.forEach(a.model.display,function(a,c){a.checked&&(b=c)});a.edit=angular.copy(a.model.c2s[b]);a.edit.editIdx=b;a.edit.editType="edit";a.edit.auth.enable_show_key_in_plain="preshared-key"===a.edit.auth.method?!1:!0;a.edit.auth.show_key_in_plain=!1;a.checkLocalIdentifier();a.origEdit=angular.copy(a.edit);a.ori_status=a.edit.enable||!1;O();a.changeIpsecProfile();
a.gridSplitTunnelOptions.data=a.edit.split_tunnel.networks;a.gridSplitDNSOptions.data=a.edit.split_dns.fqdn;a.gridGroup.data=a.model.nacm_grid;a.change_auth_method();U()},del:function(){var b,c,d=a.model.display,g=a.model.c2s;for(b=d.length-1;0<=b;b--)if(d[b].checked){for(c=g.length-1;0<=c;c--)if(g[c].seq===d[b].seq){g.splice(c,1);break}d.splice(b,1)}},connect:function(a){},disconnect:function(c){b.post({forcedUsingPost:!0,method:"action",params:{input:{"group-name":a.model.c2s[c].seq},rpc:"c2s-disconnect"}})},
split_dns:{add:function(){if(!ca()){var b=R();b.edit=!0;a.edit.split_dns.fqdn.push(b);a.procSplitDNSClick()}},edit:function(){angular.forEach(a.edit_split_fqdns,function(b,c){a.edit.split_dns.fqdn[b].edit=!0})},del:function(){for(var b=a.edit_split_fqdns.length-1,c,d;0<=b;b--)d=c=-1,angular.forEach(a.edit_split_fqdns,function(a,b){c<a&&(c=a,d=b)}),a.edit_split_fqdns.splice(d,1),a.edit.split_dns.fqdn.splice(c,1);a.procSplitDNSClick();a.splitDnsCbk()}},split_tunnel:{add:function(){if(!a.splitTunnelCheck()){var b=
J();b.edit=!0;a.edit.split_tunnel.networks.push(b);a.procSplitTunnelNetworksClick()}},edit:function(){angular.forEach(a.edit.split_tunnel.networks,function(a,b){a.checked&&(a.edit=!0)})},del:function(){var b,c=a.edit.split_tunnel.networks;for(b=c.length-1;0<=b;b--)c[b].checked&&c.splice(b,1);a.edit_split_tunnels=[]}},clickTab:function(b){a.tabUrl=b.templateUrl}};a.checkSeq=function(b){var c=!1;!a.edit||!a.edit.seq?(a.c2sform[b].$setValidity("special",!0),a.c2sform[b].$setValidity("repeat",!0)):(a.edit.seq.match(/^\w+$/)?
a.c2sform[b].$setValidity("special",!0):a.c2sform[b].$setValidity("special",!1),angular.forEach(a.model.c2s,function(b){b.seq===a.edit.seq&&(c=!0)}),a.c2sform[b].$setValidity("repeat",!c))};a.change_auth_method=function(){var b=a.edit;a.schema.local_identifier=angular.copy(N);"preshared-key"===b.auth.method?(a.schema.remote_identifier=[{id:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N")},{id:"fqdn",displayName:a.DICT("Client_to_Site_FQDN")},{id:"user-fqdn",displayName:a.DICT("Client_to_Site_User_FQDN")}],
"der-asn1-dn"===b.local_identifier.type&&(b.local_identifier.type=a.schema.local_identifier[0].id),"der-asn1-dn"===b.remote_identifier.type&&(b.remote_identifier.type=a.schema.remote_identifier[0].id)):(a.schema.local_identifier.push({id:"der-asn1-dn",displayName:a.DICT("Client_to_Site_ASN1DN")}),a.schema.remote_identifier=[{id:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N")},{id:"fqdn",displayName:a.DICT("Client_to_Site_FQDN")},{id:"user-fqdn",displayName:a.DICT("Client_to_Site_User_FQDN")},
{id:"der-asn1-dn",displayName:a.DICT("Client_to_Site_ASN1DN")}]);"certificate"===b.auth.method&&!a.certReady&&(a.waitForCert=!0);H();a.checkLocalIdentifier()};a.addGroup=function(){a.model.c2s_group_remain=angular.copy(a.model.c2s_group_no);angular.forEach(a.model.nacm_grid,function(b){if(!0===b.edit)for(var c=0;c<a.model.c2s_group_remain.length;c++)if(b.exp.select===a.model.c2s_group_remain[c].name){a.model.c2s_group_remain.splice(c,1);break}});a.model.nacm_grid.push({exp:{list:a.model.c2s_group_remain,
select:a.model.c2s_group_remain[0].name},empty:"",edit:!0,checked:!0});Q();a.disable_add_user_group=0>=a.model.c2s_group_remain.length?!0:!1;a.disable_del_user_group=0>=a.model.nacm_grid.length?!0:!1;a.gridGroup.gridApi.customApi.scrollToLast();a.procNgClick()};a.delGroup=function(){var b=a.model.c2s_group_dels.length,c,d;for(c=0;c<b;c++)for(d=a.model.nacm_grid.length-1;0<=d;d--)if(a.model.c2s_group_dels[c].exp.select===a.model.nacm_grid[d].exp.select){a.model.nacm_grid.splice(d,1);break}for(c=0;c<
b;c++)for(d=a.model.c2s_group_yes.length-1;0<=d;d--)if(a.model.c2s_group_dels[c].exp.select===a.model.c2s_group_yes[d].name){a.model.c2s_group_yes.splice(d,1);break}for(c=0;c<b;c++){flag=!0;for(d=0;d<a.model.c2s_group_no.length;d++)if(a.model.c2s_group_dels[c].exp.select===a.model.c2s_group_no[d].name){flag=!1;break}!0===flag&&a.model.c2s_group_no.push({name:a.model.c2s_group_dels[c].exp.select,id:a.model.c2s_group_dels[c].exp.select,displayName:a.model.c2s_group_dels[c].exp.select})}Q();a.disable_add_user_group=
0>=a.model.c2s_group_remain.length?!0:!1;a.disable_del_user_group=0>=a.model.nacm_grid.length?!0:!1;for(c=b-1;0<=c;c--)a.model.c2s_group_dels.splice(c,1);a.procNgClick()};a.poolValidation=function(){var b=!0;a.c2sform.txt_c2sstartip.$setValidity("range",!0);a.c2sform.txt_c2sendip.$setValidity("range",!0);a.c2sform.txt_c2sstartip.$setValidity("subnet",!0);a.c2sform.txt_c2sendip.$setValidity("subnet",!0);if(void 0===a.edit.mode.start_ip||void 0===a.edit.mode.end_ip||""===a.edit.mode.start_ip||""===
a.edit.mode.end_ip)return!0;if(void 0===a.edit.seq||!a.edit.seq)a.edit.seq="";b=e.compareIpRange(a.edit.mode.start_ip,a.edit.mode.end_ip);!1===b?(a.c2sform.txt_c2sstartip.$setValidity("range",!1),a.c2sform.txt_c2sendip.$setValidity("range",!1)):(b=e.poolValidate("client-to-sites",a.edit.seq,"ipv4",a.subnetObj,a.edit.mode.start_ip,a.edit.mode.end_ip),!1===b&&(a.c2sform.txt_c2sstartip.$setValidity("subnet",!1),a.c2sform.txt_c2sendip.$setValidity("subnet",!1)));return b};a.poolValidation3rd=function(){var b=
!0;a.c2sform.txt_c2s3rdstartip.$setValidity("range",!0);a.c2sform.txt_c2s3rdendip.$setValidity("range",!0);a.c2sform.txt_c2s3rdstartip.$setValidity("subnet",!0);a.c2sform.txt_c2s3rdendip.$setValidity("subnet",!0);if(void 0===a.edit.ip_pool.start_ip||void 0===a.edit.ip_pool.end_ip||""===a.edit.ip_pool.start_ip||""===a.edit.ip_pool.end_ip)return!0;if(void 0===a.edit.seq||!a.edit.seq)a.edit.seq="";b=e.compareIpRange(a.edit.ip_pool.start_ip,a.edit.ip_pool.end_ip);!1===b?(a.c2sform.txt_c2s3rdstartip.$setValidity("range",
!1),a.c2sform.txt_c2s3rdendip.$setValidity("range",!1)):(b=e.poolValidate("client-to-sites",a.edit.seq,"ipv4",a.subnetObj,a.edit.ip_pool.start_ip,a.edit.ip_pool.end_ip),!1===b&&(a.c2sform.txt_c2s3rdstartip.$setValidity("subnet",!1),a.c2sform.txt_c2s3rdendip.$setValidity("subnet",!1)));return b};a.changeEnable=function(){a.edit.enable&&a.model.teleworker_enable&&a.ori_status!==a.edit.enable&&app.TOOLS.warningAlertBox({msg:"Teleworker VPN Client will be disabled.<br>You cannot enable Client-to-Site and Teleworker VPN Client simultaneously.<br>Click Apply to proceed.",
btn_yes_str:"Apply",btn_no_str:"Cancel"})};a.checkLocalIdentifier=function(){var b=a.edit,c;b&&(b.local_identifier["interface"]="0.0.0.0","interface"===b.local_identifier.type&&(c=a.model.ifs_state[b.intf])&&(c.ipv4&&c.ipv4.length)&&(b.local_identifier["interface"]=c.ipv4[0]),a.checkASN1DNCert())};a.updateIntfState=function(){w.all([d()]).then(function(b){h(b[0].data&&b[0].data.result||{});a.checkLocalIdentifier()})};a.change_pwd=function(){a.edit.auth.enable_show_key_in_plain=!0};a.checkASN1DNCert=
function(){var b=a.edit,c;b&&(c=b.auth.certificate,angular.forEach(a.model.certs,function(a){a.name===c&&(b.local_identifier.der_asn1_dn=a.subject)}))};a.schema={local_identifier:angular.copy(N),remote_identifier:[],endpoint:[{id:"static-ip",displayName:a.DICT("Client_to_Site_Static_IP")},{id:"fqdn",displayName:a.DICT("Client_to_Site_FQDN")},{id:"dynamic-ip",displayName:a.DICT("Client_to_Site_Dynamic_IP")}],group:[{id:"subnet",displayName:a.DICT("Client_to_Site_Subnet")},{id:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N")},
{id:"any",displayName:a.DICT("Client_to_Site_Any")}]};a.schema.remote_identifier=[{id:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N")},{id:"fqdn",displayName:a.DICT("Client_to_Site_FQDN")},{id:"user-fqdn",displayName:a.DICT("Client_to_Site_U")},{id:"der-asn1-dn",displayName:a.DICT("Client_to_Site_ASN1DN")}];(function(){I();w.all([g(),z(),E(),v(),X(),d(),F(),W()]).then(function(b){a.selection=[];A(r(b,0));B(r(b,1));C(r(b,2));s(r(b,3));T(b[4]);c(r(b,5));h(r(b,5));K(r(b,6));S(r(b,7));y();M();a.edit=
void 0;var d=t.get("IPSec_C2S");if(d)switch(Log(INFO,"Jump from VPN Status: "+JSON.stringify(d)),d.action){case "edit":angular.forEach(a.model.display,function(b,c){b.seq===d.key&&(b.checked=!0,a.selectIdx=c,a.funs.edit())});break;case "add":a.funs.add()}a.dataReady=!0;a.resetModified()})})()}]);app.controller("GreTunnelCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","wan_service","wan_lib",function(a,b,t,m,w,u,p){var q=app.TOOLS.getVal,e="";a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var x=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",params:{filter:"WAN"},error:function(a){n();Log(ERROR,"[GRE][getInterface] "+JSON.stringify(a))}})},n=function(b){b||(b={});var d=[];b.interfaces&&b.interfaces["interface"]&&
(d=b.interfaces["interface"]);d=u.filter(d,{physical:!0});a.model.ifs=[];e="";angular.forEach(d,function(b){"WAN1"===b.name&&(e=b.name);a.model.ifs.push({id:b.name,displayName:b.name})});e||(e=a.model.ifs[0]&&a.model.ifs[0].id||"")},l=function(){return b.post({method:"get_gre",url:resource_base+"data/gre_tunnel.json",error:function(a){r();Log(ERROR,"[GRE][getGreTunnel] "+JSON.stringify(a))}})},r=function(b){b||(b={});var d=[];b.interfaces&&b.interfaces["interface"]&&(d=b.interfaces["interface"]);
a.model.gres=[];angular.forEach(d,function(b){a.model.gres.push(v(b))})},v=function(b){b||(b={});var d="",g={},k=b["tunnel-configuration"]||{},l=k["tunnel-source"]||{},k=k["tunnel-destination"]||{},m=b.ipv4||{},n=m.address&&m.address[0]||{},p;if(b.name)d=b.name;else{angular.forEach(a.model.gres,function(a){g[a.name]=!0});for(p=1;;){if(!g["GRE"+p]){d="GRE"+p;break}p+=1}}b={checked:!1,edit:!1,type:"new",name:d,enabled:q(b.enabled,!1),description:b.description||"",source:{type:"interface","interface":l["interface"]||
e},destination:{type:"v4_ip",v4_ip:k["ipv4-address"]||""},ipv4:{enabled:q(m.enabled,!0),mtu:q(m.mtu,1440),ip:q(n.ip,""),prefix:q(n["prefix-length"],""),netmask:""},display:{name:"-",ipaddr:"-",source:"-",destination:"-",enabled:"-",status:a.DICT("Gre_Tunnel_Disconnected")}};_.isNumber(b.ipv4.prefix)&&(b.ipv4.netmask=app.TOOLS.netmask.int2Inet(parseInt(b.ipv4.prefix,10)));_.isNumber(b.ipv4.prefix)&&b.ipv4.ip&&(b.display.ipaddr=b.ipv4.ip+"/"+b.ipv4.prefix);b.display.name=b.name+" ("+b.description+")";
b.display.enabled=b.enabled?a.DICT("Gre_Tunnel_Enabled"):a.DICT("Gre_Tunnel_Disabled");switch(b.source.type){case "interface":b.display.source=b.source["interface"]}switch(b.destination.type){case "v4_ip":_.isNumber(b.ipv4.prefix)&&b.destination.v4_ip&&(b.display.destination=b.destination.v4_ip+"/"+b.ipv4.prefix)}return b},s=function(){var b={};a.ui_data.connected_cnt=0;angular.forEach(a.model.wan_state,function(a){b[a.name]=a});angular.forEach(a.model.gres,function(d){d.display.status=a.DICT("Gre_Tunnel_Disconnected");
d.enabled&&b[d.source["interface"]]&&b[d.source["interface"]].ipv4_ip.length&&(d.display.status=a.DICT("Gre_Tunnel_Connected"),a.ui_data.connected_cnt+=1)})},k=function(){t.all([x(),l(),p.get_wan_state()]).then(function(b){n(b[0]&&b[0].data&&b[0].data.result);r(b[1]&&b[1].data&&b[1].data.result);a.model.wan_state=b[2];s();a.gridGreTunnelOptions.data=a.model.gres;a.model.orig_gre=angular.copy(a.model.gres);a.ui_data.number_of_connect=a.DICT("Gre_Tunnel_Number_Of_Connect",{"%d1":a.ui_data.connected_cnt,
"%d2":a.model.gres.length,"%d3":a.ui_data.max_cnt});setTimeout(function(){a.gridGreTunnelOptions.gridApi.customApi.checkSelectStatus()},50);a.edit=void 0;a.resetModified();a.ui_data.page="main";a.ui_data.data_ready=!0})},d=function(b){var d,g,e={};a.ui_data.gre_names=[];angular.forEach(a.model.gres,function(a){e[a.name]=!0});for(d=1;d<=a.ui_data.max_cnt;d++)g={name:"GRE"+d,used:!1},e[g.name]&&b!==g.name&&(g.used=!0),a.ui_data.gre_names.push(g)};a.edit=void 0;a.ui_data={max_cnt:10,selected:[],data_ready:!1,
page:"main",gre_names:[],connected_cnt:0,number_of_connect:""};a.model={ifs:[],gres:[],orig_gre:[],gre_state:[],wan_state:[]};m=function(){a.ui_data.selected=[];angular.forEach(a.model.gres,function(b){b.checked&&a.ui_data.selected.push(b)})};a.gridGreTunnelOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:m,headerChangedCbk:m},{field:"display.name",displayName:a.DICT("Gre_Tunnel_Interface_Name")},{field:"display.ipaddr",displayName:a.DICT("Gre_Tunnel_Ip_Address")},
{field:"display.source",displayName:a.DICT("Gre_Tunnel_Source")},{field:"display.destination",displayName:a.DICT("Gre_Tunnel_Destination")},{field:"display.enabled",displayName:a.DICT("Gre_Tunnel_Enable")},{field:"display.status",displayName:a.DICT("Gre_Tunnel_Status")}]});a.funs={add:function(){var b=v();b.checked=!0;d();a.edit=b;a.model.gres.push(b);a.ui_data.page="edit";a.modified()},del:function(){var b=a.model.gres,d;for(d=b.length-1;0<=d;d--)b[d].checked&&(b.splice(d,1),a.modified())},edit:function(){angular.forEach(a.model.gres,
function(b){b.checked&&(b.type="edit",a.edit=b)});d(a.edit.name);a.ui_data.page="edit"},save:function(){var c=[],d=!1,g=function(){c.length?b.post({method:"set_bulk",forcedUsingPost:!0,params:c,success:function(a){k()},error:function(a){Log(ERROR,"[GRE][save] "+JSON.stringify(a));k()}}):k()};(function(){var b=[],g=!1;angular.forEach(a.model.orig_gre,function(c){g=!0;angular.forEach(a.model.gres,function(a){c.name===a.name&&(g=!1)});g&&b.push({name:c.name})});b.length&&(d=!0,c.push({method:"del_gre",
params:{interfaces:{"interface":b}}}))})();(function(){var b=a.edit;if(b){var d={},g={};switch(b.source.type){case "interface":d={"interface":b.source["interface"]}}switch(b.destination.type){case "v4_ip":g={"ipv4-address":b.destination.v4_ip}}b={name:b.name,description:b.description,enabled:b.enabled,type:"tunnel","tunnel-configuration":{"tunnel-source":d,"tunnel-destination":g},ipv4:{enabled:!0,mtu:b.ipv4.mtu,address:[{ip:b.ipv4.ip,"prefix-length":app.TOOLS.netmask.inet2Int(b.ipv4.netmask)}]}};
c.push({method:"set_gre",params:{interfaces:{"interface":[b]}}})}})();d?app.TOOLS.warningAlertBox({msg:a.DICT("Gre_Tunnel_Warning_Msg1"),title:a.DICT("Gre_Tunnel_Warning"),cbk:function(a){a&&g()}}):g()},cancel:function(){a.model.page="main";k()}};a.chk_description=function(){var b=function(b){a.gre_tunnel&&a.gre_tunnel.description&&a.gre_tunnel.description.$setValidity("repeat",b)},d=a.edit;b(!0);angular.forEach(a.model.gres,function(a){a.name!==d.name&&a.description===d.description&&b(!1)})};k()}]);app.controller("VPNSetupWizardCtrl",["$scope","MyHttp","wan_service","$q","UserSession","userAccessRight","$location",function(a,b,t,m,w,u,p){a.success=!1;a.validation={isErr:!1,repeat_conn:"",profile_name_repeat:!1,profile_name_repeat_err_str:""};var q=[],e=function(b){var c=app.TOOLS.get_scope("WizardCtrl");c&&c.funs.close_vpn_wizard();b&&app.TOOLS.successAlertBox({title:a.DICT("Success"),msg:a.DICT("VPN_Setup_Wizard_Setup_Success"),cbk:function(){app.TOOLS.jumpToPage("VPN_Site_to_Site")}})};a.userAccessFlag=
u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var x=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",error:function(a){n()}})},n=function(b){b||(b={});var c=[];b.interfaces&&b.interfaces["interface"]&&(c=t.filter(b.interfaces["interface"],{physical:!0,usb:!0,subinterface:!0}));a.model.intfs=[];angular.forEach(c,function(b){a.model.intfs.push({id:b.name,displayName:b.name})})},l=function(){return b.post({url:resource_base+"data/ipsec_profiles.json",
method:"get_ipsec_profile",error:function(a){console.log("VPNSetupWizardCtrl getIPSecProfileData error "+a.status);r()}})},r=function(b){b||(b={});var c=[],d,e,k=function(b){b||(b={});return{dh_group:b["dh-group"]||a.model.dh_group[0]&&a.model.dh_group[0].id||"",encryption:b.encryption||a.model.encryption[0]&&a.model.encryption[0].id||"",authentication:b.authentication||a.model.authentication[0]&&a.model.authentication[0].id||"",lifetime:b["sa-lifetime"]||28800}},l=function(b){b||(b={});var c={dh_group:b["dh-group"]||
a.model.dh_group[0]&&a.model.dh_group[0].id||"",protocal:"esp",encryption:b.encryption||a.model.encryption[0]&&a.model.encryption[0].id||"",authentication:b.authentication||a.model.authentication[0]&&a.model.authentication[0].id||"",lifetime:b["sa-lifetime"]||3600,pfs:void 0!==b["perfect-forward-secrecy"]?b["perfect-forward-secrecy"]:!0};angular.forEach(b,function(b,d){switch(d){case "encryption":c.protocal="esp";c.encryption=b||a.model.encryption[0]&&a.model.encryption[0].id||"";break;case "empty":c.protocal=
"ah"}});return c};b["ipsec-profiles"]&&b["ipsec-profiles"]["ipsec-profile"]&&(c=b["ipsec-profiles"]["ipsec-profile"]);a.model.profiles=[{id:"@new",displayName:"New Profile",ikeMode:"v2",phase1:k(),phase2:l()}];a.model.default_profile=void 0;angular.forEach(c,function(b){if((e=b["keying-mode"])&&e["phase1-options"]&&e["phase2-options"])d="v2",e["ike-version"]&&angular.forEach(e["ike-version"],function(a,b){switch(b){case "v1":d="v1";break;default:d="v2"}}),a.model.profiles.push({id:b["profile-name"],
displayName:b["profile-name"],ikeMode:d,phase1:k(e["phase1-options"]),phase2:l(e["phase2-options"])}),"Default"===b["profile-name"]&&(a.model.default_profile="Default")});a.model.default_profile||(a.model.default_profile=a.model.profiles[0]&&a.model.profiles[0].id||"")},v=function(){return b.post({url:resource_base+"data/ipsec_site_to_site.json",method:"get_site_to_site",error:function(a){console.log("siteToSiteCtrl getSiteToSiteData error, status: "+a.status);s()}})},s=function(b){b||(b={});var c=
(b["site-to-sites"]||{})["site-to-site"]||[];b="";q=[];a.model.s2s=[];angular.forEach(c,function(b){a.model.s2s.push(k(b))});for(c=0;c<a.model.s2s.length;c++)b=a.model.s2s[c]["interface"]+"#","static-ip"===a.model.s2s[c].remote_endpoint.type?b=b+a.model.s2s[c].remote_endpoint.type+"#"+a.model.s2s[c].remote_endpoint.ip:"fqdn"===a.model.s2s[c].remote_endpoint.type?b=b+a.model.s2s[c].remote_endpoint.type+"#"+a.model.s2s[c].remote_endpoint.fqdn:"dynamic-ip"===a.model.s2s[c].remote_endpoint.type&&(b=b+
a.model.s2s[c].remote_endpoint.type+"#dynamic-ip"),b+="#","interface"===a.model.s2s[c].local_group.identifier.type?b=b+a.model.s2s[c].local_group.identifier.type+"#0.0.0.0":"ip"===a.model.s2s[c].local_group.identifier.type?b=b+a.model.s2s[c].local_group.identifier.type+"#"+a.model.s2s[c].local_group.identifier.ip:"fqdn"===a.model.s2s[c].local_group.identifier.type?b=b+a.model.s2s[c].local_group.identifier.type+"#"+a.model.s2s[c].local_group.identifier.fqdn:"user-fqdn"===a.model.s2s[c].local_group.identifier.type?
b=b+a.model.s2s[c].local_group.identifier.type+"#"+a.model.s2s[c].local_group.identifier.user_fqdn:"der-asn1-dn"===a.model.s2s[c].local_group.identifier.type&&(b=b+a.model.s2s[c].local_group.identifier.type+"#any"),b+="#","ip"===a.model.s2s[c].remote_group.identifier.type?b=b+a.model.s2s[c].remote_group.identifier.type+"#"+a.model.s2s[c].remote_group.identifier.ip:"fqdn"===a.model.s2s[c].remote_group.identifier.type?b=b+a.model.s2s[c].remote_group.identifier.type+"#"+a.model.s2s[c].remote_group.identifier.fqdn:
"user-fqdn"===a.model.s2s[c].remote_group.identifier.type?b=b+a.model.s2s[c].remote_group.identifier.type+"#"+a.model.s2s[c].remote_group.identifier.user_fqdn:"der-asn1-dn"===a.model.s2s[c].remote_group.identifier.type&&(b=void 0===a.model.s2s[c].remote_group.identifier.asn1dn||""===a.model.s2s[c].remote_group.identifier.asn1dn?b+a.model.s2s[c].remote_group.identifier.type+"#any":b+a.model.s2s[c].remote_group.identifier.type+"#"+a.model.s2s[c].remote_group.identifier.asn1dn),b=b+"@"+a.model.s2s[c].connection_name,
q.push(b)},k=function(b){b||(b={});var c=b["remote-endpoint"]||{},d={},e=a.model.ifs,k=a.model.profile,l=function(a,b){a&&(a.identifier&&angular.forEach(a.identifier,function(a,c){switch(c){case "ip":b.identifier.type=c;b.identifier.ip=a||"";break;case "interface":b.identifier.type=c;b.identifier["interface"]="";break;case "fqdn":b.identifier.type=c;b.identifier.fqdn=a||"";break;case "user-fqdn":b.identifier.type=c;b.identifier.user_fqdn=a||"";break;case "der-asn1-dn":b.identifier.type=c,b.identifier.asn1dn=
a||""}}),a.group&&angular.forEach(a.group,function(a,c){switch(c){case "subnet":"0.0.0.0"===a.ip&&"0.0.0.0"===a.netmask?b.group.type="any":(b.group.type=c,b.group.subnet_ip=a.ip||"",b.group.subnet_netmask=a.netmask||"");break;case "ip":b.group.type=c;b.group.ip=a.ip||"";break;case "ip-range":b.group.type=c,b.group.begin_ip=a["begin-ip"]||"",b.group.end_ip=a["end-ip"]||""}}))},d={connection_name:b["connection-name"]||"",type:"s2s",ike_mode:"v2",enable:void 0!==b.enable?b.enable:!0,"interface":b["interface"]||
e[0]&&e[0].name||"",ipsec_profile:b["ipsec-profile"]||k[0]&&k[0].name||"",ipsec_profile_type:"",remote_endpoint:{type:"static-ip",ip:"",fqdn:""},local_group:{identifier:{type:"interface",ip:"","interface":"",fqdn:"",user_fqdn:"",asn1dn:""},group:{type:"subnet",subnet_ip:"",subnet_netmask:"",ip:"",begin_ip:"",end_ip:""}},remote_group:{identifier:{type:"ip",ip:"",fqdn:"",user_fqdn:"",asn1dn:""},group:{type:"subnet",subnet_ip:"",subnet_netmask:"",ip:"",begin_ip:"",end_ip:""}}};b["remote-endpoint"]&&
(d.remote_endpoint.type="dynamic-ip",angular.forEach(c,function(a,b){switch(b){case "static-ip":d.remote_endpoint.type=b;d.remote_endpoint.ip=a;break;case "fqdn":d.remote_endpoint.type=b,d.remote_endpoint.fqdn=a}}));l(b["local-group"],d.local_group);l(b["remote-group"],d.remote_group);return d},d=[{id:"subnet",displayName:a.DICT("VPN_Setup_Wizard_Subnet_N")},{id:"ip",displayName:a.DICT("VPN_Setup_Wizard_IP_Addr_N")}],c=function(){var b={intf:"",connect_name:"",remote_conn_type:a.model.conn_type_list[0].id,
remote_ip:"",remote_fqdn:"",presharekey:"",show_key_in_plain:!1,ipsec_profile:"",profile_name:"",ike_mode:"v2",symm_authentication:{presharekey:"",show_key_in_plain:!1},local_authentication:{presharekey:"",show_key_in_plain:!1},remote_authentication:{presharekey:"",show_key_in_plain:!1},local:{type:a.model.local_group[0].id,subnet_ip:"",subnet_netmask:"",ip:""},remote:{type:a.model.remote_group[0].id,subnet_ip:"",subnet_netmask:"",ip:""},phase1:{},phase2:{}};b.intf=a.model.intfs[0]&&a.model.intfs[0].id||
"";b.ipsec_profile=a.model.default_profile;return b};a.dataReady=!1;a.model={default_profile:"",profiles:[],intfs:[],d:{},s2s:[]};a.model.changeProfle=function(){var b,c;if("@new"===a.model.d.ipsec_profile)a.model.d.phase1={dh_group:a.model.dh_group[0]&&a.model.dh_group[0].id||"",encryption:a.model.encryption[0]&&a.model.encryption[0].id||"",authentication:a.model.authentication[0]&&a.model.authentication[0].id||"",lifetime:28800,pfs:!0},a.model.d.phase2={dh_group:a.model.dh_group[0]&&a.model.dh_group[0].id||
"",protocal:a.model.protocals[0]&&a.model.protocals[0].id||"",encryption:a.model.encryption[0]&&a.model.encryption[0].id||"",authentication:a.model.authentication[0]&&a.model.authentication[0].id||"",lifetime:3600},a.model.d.ike_mode="v2";else{for(c=a.model.profiles.length-1;0<=c;c--)if(a.model.profiles[c].id===a.model.d.ipsec_profile){b=a.model.profiles[c];break}a.model.d.phase1=b.phase1;a.model.d.phase2=b.phase2;a.model.d.ike_mode=b.ikeMode}};a.model.getGroupName=function(b,c){var d="",e,k;if("remote"===
c)k=a.model.remote_group;else if("local"===c)k=a.model.local_group;else return"";for(e=k.length-1;0<=e;e--)if(k[e].id===b){d=k[e].displayName;break}return d};a.model.getAuthenticationName=function(b){var c="",d;for(d=a.model.authentication.length-1;0<=d;d--)if(a.model.authentication[d].id===b){c=a.model.authentication[d].displayName;break}return c};a.model.getEncryptionName=function(b){var c="",d;for(d=a.model.encryption.length-1;0<=d;d--)if(a.model.encryption[d].id===b){c=a.model.encryption[d].displayName;
break}return c};a.model.getDHGroupName=function(b){var c="",d;for(d=a.model.dh_group.length-1;0<=d;d--)if(a.model.dh_group[d].id===b){c=a.model.dh_group[d].displayName;break}return c};a.model.change_ip_type=function(){var b=a.model.d,c=b.local,b=b.remote;c&&b&&(a.model.local_group=angular.copy(d),a.model.remote_group=angular.copy(d),"any"===c.type&&"any"!==b.type?a.model.local_group.push({id:"any",displayName:a.DICT("VPN_Setup_Wizard_Any")}):("any"!==c.type&&"any"===b.type||a.model.local_group.push({id:"any",
displayName:a.DICT("VPN_Setup_Wizard_Any")}),a.model.remote_group.push({id:"any",displayName:a.DICT("VPN_Setup_Wizard_Any")})))};a.validation.check_profile_name=function(){var b=a.model.d,c=b.profile_name||"",d=!1;a.validation.profile_name_repeat=!1;a.validation.profile_name_repeat_err_str="";if("@new"===b.ipsec_profile){for(b=0;b<a.model.profiles.length;b++)a.model.profiles[b].id===c&&(d=!0);d&&(a.validation.profile_name_repeat=!0,a.validation.profile_name_repeat_err_str=a.DICT("VPN_Setup_Wizard_Ipsec_Profile_Repeat",
{"%s":c}))}};a.funs={cancel:function(){a.model.d=c();a.model.change_ip_type();a.resetModified()},submit:function(c){var d=c.d;c=!1;var k=function(){var a={"connection-name":d.connect_name,"interface":d.intf,"ipsec-profile":d.ipsec_profile,"remote-endpoint":{},"local-group":{},"remote-group":{}};"v1"===d.ike_mode?a["symm-authentication"]={password:d.symm_authentication.presharekey,"minimum-complexity":!1}:(a["local-authentication"]={password:d.local_authentication.presharekey,"minimum-complexity":!1},
a["remote-authentication"]={password:d.remote_authentication.presharekey,"minimum-complexity":!1});switch(d.local.type){case "any":a["local-group"]={group:{subnet:{ip:"0.0.0.0",netmask:"0.0.0.0"}}};break;case "subnet":a["local-group"]={group:{subnet:{ip:d.local.subnet_ip,netmask:d.local.subnet_netmask}}};break;default:a["local-group"]={group:{ip:{ip:d.local.ip}}}}switch(d.remote.type){case "any":a["remote-group"]={group:{subnet:{ip:"0.0.0.0",netmask:"0.0.0.0"}}};break;case "subnet":a["remote-group"]=
{group:{subnet:{ip:d.remote.subnet_ip,netmask:d.remote.subnet_netmask}}};break;default:a["remote-group"]={group:{ip:{ip:d.remote.ip}}}}switch(d.remote_conn_type){case "static-ip":a["remote-endpoint"]={"static-ip":d.remote_ip};a["remote-group"].identifier={ip:d.remote_ip};break;default:a["remote-endpoint"]={fqdn:d.remote_fqdn},a["remote-group"].identifier={fqdn:d.remote_fqdn}}b.post({method:"set_site_to_site",forcedUsingPost:!0,params:{"site-to-sites":{"site-to-site":[a]}},success:function(){app.TOOLS.get_scope("headerCtrl").enable_save_warning();
e(!0)},error:function(){e(!1)}})};"@new"===d.ipsec_profile&&(d.ipsec_profile=d.profile_name,c={"profile-name":d.profile_name,"keying-mode":{"ike-version":{},"phase1-options":{"dh-group":d.phase1.dh_group,encryption:d.phase1.encryption,authentication:d.phase1.authentication,"sa-lifetime":d.phase1.lifetime},"phase2-options":{authentication:d.phase2.authentication,"sa-lifetime":d.phase2.lifetime,"perfect-forward-secrecy":d.phase2.pfs}}},"v1"===d.ike_mode?c["keying-mode"]["ike-version"].v1=null:c["keying-mode"]["ike-version"].v2=
null,"ah"===d.phase2.protocal?c["keying-mode"]["phase2-options"].empty=null:c["keying-mode"]["phase2-options"].encryption=d.phase2.encryption,d.phase1.pfs&&(c["keying-mode"]["phase2-options"]["dh-group"]=d.phase2.dh_group),b.post({method:"set_ipsec_profile",forcedUsingPost:!0,params:{"ipsec-profiles":{"ipsec-profile":[c]}},success:function(a){k()},error:function(a){e(!1)}}),c=!0);c||k();a.resetModified()}};a.validation.checkCombineUnique=function(){a.isErr=!1;var b=a.model.d.intf,c=a.model.d.remote_conn_type,
d="",e="",k="",l="",m=[];if(void 0===a.model.d.remote_ip||void 0===a.model.d.remote_fqdn)a.isErr=!1;else{"static-ip"===c?d=a.model.d.remote_ip:"fqdn"===c&&(d=a.model.d.remote_fqdn);l=b+"#"+c+"#"+d+"#";l+="interface#0.0.0.0#";"static-ip"===c?(e="ip",k=d):"fqdn"===c&&(e="fqdn",k=d);l=l+e+"#"+k;for(b=0;b<q.length;b++)if(m=q[b].split("@"),m[0]===l){a.validation.repeat_conn=m[1];a.validation.isErr=!0;break}}};a.model.conn_type_list=[{id:"static-ip",displayName:a.DICT("VPN_Setup_Wizard_IP_Addr_N")},{id:"fqdn",
displayName:a.DICT("VPN_Setup_Wizard_FQDN")}];a.model.local_identifier=[{id:"ip",displayName:a.DICT("VPN_Setup_Wizard_Local_WAN_IP")},{id:"fqdn",displayName:a.DICT("VPN_Setup_Wizard_Local_FQDN")},{id:"user-fqdn",displayName:a.DICT("VPN_Setup_Wizard_Local_User_FQDN")}];a.model.remote_identifier=[{id:"ip",displayName:a.DICT("VPN_Setup_Wizard_Remote_WAN_IP")},{id:"fqdn",displayName:a.DICT("VPN_Setup_Wizard_Remote_FQDN")},{id:"user-fqdn",displayName:a.DICT("VPN_Setup_Wizard_Remote_User_FQDN")}];a.model.local_group=
angular.copy(d);a.model.remote_group=angular.copy(d);a.model.authentication=[{id:"md5",displayName:"MD5"},{id:"sha1",displayName:"SHA1"},{id:"sha2-256",displayName:"SHA2-256"}];a.model.protocals=[{id:"esp",displayName:"ESP"},{id:"ah",displayName:"AH"}];a.model.encryption=[{id:"esp-3des",displayName:"3DES"},{id:"esp-aes-128",displayName:"AES 128"},{id:"esp-aes-192",displayName:"AES 192"},{id:"esp-aes-256",displayName:"AES 256"}];a.model.dh_group=[{id:"dh-group-2",displayName:"Group2 - 1024 bit"},{id:"dh-group-5",
displayName:"Group5 - 1536 bit"},{id:"dh-group-14",displayName:"Group14 - 2048 bit"}];(function(){a.dataReady=!1;m.all([x(),l(),v()]).then(function(b){n(b[0].data&&b[0].data.result||{});r(b[1].data&&b[1].data.result||{});s(b[2].data&&b[2].data.result||{});a.model.d=c();a.model.change_ip_type();a.model.changeProfle();app.TOOLS.wizardBox({title:a.DICT("VPN_Setup_Wizard"),className:"ngdialog-theme-default wizard-page",validation:a.validation,model:a.model,list:[{name:a.DICT("VPN_Setup_Wizard_Getting_Started"),
templateUrl:"step1.html"},{name:a.DICT("VPN_Setup_Wizard_Remote_Router_Settings"),templateUrl:"step2.html"},{name:a.DICT("VPN_Setup_Wizard_Local_Remote_Networks"),templateUrl:"step3.html"},{name:a.DICT("VPN_Setup_Wizard_Profile"),templateUrl:"step4.html"},{name:a.DICT("VPN_Setup_Wizard_Summary"),templateUrl:"step5.html"}],cbk:function(b,c){b?a.funs.submit(c):e(!1)}});a.dataReady=!0})})()}]);app.controller("ipsecProfilesCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","goToPreviousPage",function(a,b,t,m,w,u){var p=a.DICT("IP_Sec_Profiles_Yes"),q=a.DICT("IP_Sec_Profiles_No"),e=app.TOOLS.getVal,x=app.TOOLS.getResponse;a.success=!1;a.userAccessFlag=w.get();a.backbtn=!1;"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();u.isneed()&&(a.backbtn=!0);var n=function(){return b.post({url:resource_base+"data/ipsec_profiles.json",method:"get_ipsec_profile",error:function(a){Log(ERROR,
"ipsecProfilesCtrl getProfileData error, status: "+a.status)}})},l=function(b){b||(b={});b=(b["ipsec-profiles"]||{})["ipsec-profile"]||[];a.model.profile=[];angular.forEach(b,function(b,c){a.model.profile.push(r(b))});g()},r=function(b){b||(b={});var c=a.model.schema,d=b["keying-mode"]||{},g=d["ike-version"]||{},e=d["phase1-options"]||{},h=d["phase2-options"]||{},k,l="auto";b["keying-mode"]&&(l=d["phase1-options"]?"auto":"manual");k={profile_name:b["profile-name"]||"",key_mode:l,ike_version:null===
g.v2?"v2":"v1",phase1:{dh_group:e["dh-group"]||c.dh_group[0].id,encryption:e.encryption||c.encryption[0].id,authentication:e.authentication||c.authentication[0].id,sa_lifetime:e["sa-lifetime"]||28800},phase2:{protocal:"esp",encryption:c.encryption[0].id,dh_group:h["dh-group"]||c.dh_group[0].id,authentication:h.authentication||c.authentication[0].id,sa_lifetime:h["sa-lifetime"]||3600,perfect_forward_secrecy:void 0!==h["perfect-forward-secrecy"]?h["perfect-forward-secrecy"]:!0},spi_incoming:void 0!==
d["spi-incoming"]?d["spi-incoming"].toString(16).toUpperCase():"100",spi_outgoing:void 0!==d["spi-outgoing"]?d["spi-outgoing"].toString(16).toUpperCase():"100",encryption:d.encryption||"esp-3des",encryption_key_in:d["encryption-key-in"]||"",encryption_key_out:d["encryption-key-out"]||"",authentication:d.authentication||"md5",authentication_key_in:d["authentication-key-in"]||"",authentication_key_out:d["authentication-key-out"]||"",inUse:!1};angular.forEach(h,function(b,c){switch(c){case "encryption":k.phase2.protocal=
"esp";k.phase2.encryption=b||a.model.schema.protocals[0]&&a.model.schema.protocals[0].id||"";break;case "empty":k.phase2.protocal="ah"}});return k},v=function(){return b.post({url:resource_base+"data/ipsec_site_to_site.json",method:"get_site_to_site",error:function(a){Log(ERROR,"ipsecProfilesCtrl getSiteToSiteData error, status: "+a.status)}})},s=function(b){b||(b={});b=(b["site-to-sites"]||{})["site-to-site"]||[];a.model.site2site=[];angular.forEach(b,function(b){a.model.site2site.push({connection_name:b["connection-name"]||
"",ipsec_profile:b["ipsec-profile"]||""})})},k=function(){return b.post({url:resource_base+"data/l2tp_server.json",method:"get_l2tp_server",error:function(a){d()}})},d=function(b){b||(b={});a.model.l2tp_server_ipsec_profile=(b.l2tp||{})["ipsec-profile"]||""},c=function(){return b.post({url:resource_base+"data/ipsec_client_to_site.json",method:"get_client_to_site",error:function(a){Log(ERROR,"ipsecProfilesCtrl getClientToSiteData error "+a.status);h()}})},h=function(b){b||(b={});var c=[];a.model.client2site=
[];b["client-to-sites"]&&b["client-to-sites"]["client-to-site"]&&(c=b["client-to-sites"]["client-to-site"]);angular.forEach(c,function(b){b["ipsec-profile"]&&a.model.client2site.push({seq:b.seq,ipsec_profile:b["ipsec-profile"]})})},g=function(){var b;a.model.profileTable=[];angular.forEach(a.model.profile,function(c,d){c.inUse=!1;"Default"===c.profile_name&&(c.inUse=!0);angular.forEach(a.model.site2site,function(a){a.ipsec_profile===c.profile_name&&(c.inUse=!0)});angular.forEach(a.model.client2site,
function(a){a.ipsec_profile===c.profile_name&&(c.inUse=!0)});c.profile_name===a.model.l2tp_server_ipsec_profile&&(c.inUse=!0);b="auto"===c.key_mode?"v1"===c.ike_version?a.DICT("IP_Sec_Profiles_IKE1"):a.DICT("IP_Sec_Profiles_IKE2"):"--";a.model.profileTable.push({checked:!1,name:c.profile_name||"",policy:"auto"===c.key_mode?a.DICT("IP_Sec_Profiles_Auto"):a.DICT("IP_Sec_Profiles_Manual"),ikeVersion:b,inUseStr:c.inUse?p:q,idx:d})});a.gridProfileOptions.data=a.model.profileTable},A=function(){return b.post({url:resource_base+
"data/ipsec_enable.json",method:"get_ipsec_enable",error:function(a){Log(ERROR,"[IPSec Profile][getIPSecEnable] "+JSON.stringify(a));y()}})},y=function(b){b||(b={});b=e((b.ipsec||{}).enable,!0);a.model.ipsec_enable=b},z=function(){a.model.schema={dh_group:[{id:"dh-group-2",displayName:"Group2 - 1024 bit"},{id:"dh-group-5",displayName:"Group5 - 1536 bit"},{id:"dh-group-14",displayName:"Group14 - 2048 bit"}],encryption:[{id:"esp-3des",displayName:"3DES"},{id:"esp-aes-128",displayName:"AES-128"},{id:"esp-aes-192",
displayName:"AES-192"},{id:"esp-aes-256",displayName:"AES-256"}],authentication:[{id:"md5",displayName:"MD5"},{id:"sha1",displayName:"SHA1"},{id:"sha2-256",displayName:"SHA2-256"}],key_mode:[{id:"auto",displayName:a.DICT("IP_Sec_Profiles_Auto")},{id:"manual",displayName:a.DICT("IP_Sec_Profiles_Manual")}],key_length:{md5:32,sha1:40,"sha2-256":64,"esp-3des":48,"esp-aes-128":32,"esp-aes-192":48,"esp-aes-256":64,"dh-group-2":256,"dh-group-5":384,"dh-group-14":512},protocals:[{id:"esp",displayName:"ESP"},
{id:"ah",displayName:"AH"}]};t.all([v(),c(),k(),n(),A()]).then(function(b){a.selectIdx=-1;s(x(b,0));h(x(b,1));d(x(b,2));l(x(b,3));y(x(b,4));a.model.dels=[];B();a.resetModified();setTimeout(function(){a.gridProfileOptions.gridApi&&a.gridProfileOptions.gridApi.customApi&&a.gridProfileOptions.gridApi.customApi.checkSelectStatus()},50);a.dataReady=!0})};a.pageMap={main:"ipsec_profile_main.html",edit:"ipsec_profile_edit.html"};var B=function(b){a.ui_data.selected=[];a.ui_data.disableDelBtn=!1;angular.forEach(a.model.profileTable,
function(b){if(b.checked&&(a.ui_data.selected.push(b),b.inUseStr===p||"Default"===b.name))a.ui_data.disableDelBtn=!0})},D=function(){return 50<=a.model.profileTable.length?(a.msg=a.DICT("IP_Sec_Profiles_Max_Entry",{"%d":a.model.profileTable.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.currPage="main";a.selectIdx=-1;a.dataReady=!1;a.ui_data={selected:[]};a.model={ipsec_enable:!0,profile:[],schema:{},site2site:[],client2site:[],l2tp_server_ipsec_profile:"",profileTable:[],
dels:[],selects:[]};a.edit={};a.orig=void 0;a.key_pattern=/^[0-9a-fA-F]+$/;a.funs={edit:function(){var b;angular.forEach(a.model.profileTable,function(c){c.checked&&angular.forEach(a.model.profile,function(a){c.name===a.profile_name&&(b=a)})});a.edit={};a.edit=angular.copy(b);a.edit.type="edit";a.orig=angular.copy(b);a.modified();a.currPage="edit"},del:function(b){var c=a.model.profile,d;angular.forEach(a.model.profileTable,function(b){if(b.checked)for(d=c.length-1;0<=d;d--)c[d].profile_name===b.name&&
!c[d].inUse&&(a.model.dels.push(c[d]),c.splice(d,1))});g();a.ui_data.selected=[];a.modified()},clone:function(){var b;angular.forEach(a.model.profileTable,function(c){c.checked&&angular.forEach(a.model.profile,function(a){c.name===a.profile_name&&(b=a)})});a.edit={};a.edit=angular.copy(b);a.edit.profile_name="";a.edit.type="clone";a.edit.inUse=!1;a.orig=void 0;a.modified();a.currPage="edit"},add:function(){D()||(a.edit={},a.edit=r(),a.edit.type="new",a.orig=void 0,a.currPage="edit",a.modified())},
save:function(){var c=[];(function(){var b=[];0<a.model.dels.length&&(angular.forEach(a.model.dels,function(a){b.push({"profile-name":a.profile_name})}),c.push({method:"del_ipsec_profile",params:{"ipsec-profiles":{"ipsec-profile":b}}}),a.model.dels=[])})();(function(){var b=a.edit,d=a.orig,g=a.currPage,e={};c.push({method:"set_ipsec_enable",params:{ipsec:{enable:a.model.ipsec_enable}}});if("edit"===g){switch(a.edit.type){case "clone":case "new":case "edit":break;default:return}d&&d.profile_name!==
b.profile_name&&c.push({method:"del_ipsec_profile",params:{"ipsec-profiles":{"ipsec-profile":[{"profile-name":d.profile_name}]}}});e={"profile-name":b.profile_name,"keying-mode":{}};"auto"===b.key_mode?(e["keying-mode"]={"ike-version":"v1"===b.ike_version?{v1:null}:{v2:null},"phase1-options":{"dh-group":b.phase1.dh_group,encryption:b.phase1.encryption,authentication:b.phase1.authentication,"sa-lifetime":b.phase1.sa_lifetime},"phase2-options":{"dh-group":!b.phase2.perfect_forward_secrecy?b.phase1.dh_group:
b.phase2.dh_group,authentication:b.phase2.authentication,"sa-lifetime":b.phase2.sa_lifetime,"perfect-forward-secrecy":b.phase2.perfect_forward_secrecy}},"ah"===b.phase2.protocal?e["keying-mode"]["phase2-options"].empty=null:e["keying-mode"]["phase2-options"].encryption=b.phase2.encryption):e["keying-mode"]={"spi-incoming":parseInt(b.spi_incoming,16),"spi-outgoing":parseInt(b.spi_outgoing,16),encryption:b.encryption,"encryption-key-in":b.encryption_key_in,"encryption-key-out":b.encryption_key_out,
authentication:b.authentication,"authentication-key-in":b.authentication_key_in,"authentication-key-out":b.authentication_key_out};c.push({method:"set_ipsec_profile",params:{"ipsec-profiles":{"ipsec-profile":[e]}}})}})();c.length?b.post({method:"set_bulk",params:c,success:function(b){a.success=!0;z();a.currPage="main"},error:function(b){a.success=!0;z();a.currPage="main"}}):(z(),a.currPage="main")},cancel:function(){a.currPage="main";z()},go_back:u.goback};a.gridProfileOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",
changedCbk:B,headerChanged:B,isCheckbox:!0,id:"ipsecprofile"},{field:"name",displayName:a.DICT("IP_Sec_Profiles_Name")},{field:"ikeVersion",displayName:a.DICT("IP_Sec_Profiles_IKE_Version_N")},{field:"policy",displayName:a.DICT("IP_Sec_Profiles_Policy")},{field:"inUseStr",displayName:a.DICT("IP_Sec_Profiles_In_Use")}]});a.checkProfileName=function(){if(!a.edit||!a.edit.profile_name)return a.profile.profile_name.$setValidity("repeat",!0),a.profile.profile_name.$setValidity("special",!0),!0;if(a.edit.profile_name.match(/^\w+$/))a.profile.profile_name.$setValidity("special",
!0);else return a.profile.profile_name.$setValidity("special",!1),!1;var b=!1;angular.forEach(a.model.profile,function(c,d){c.profile_name===a.edit.profile_name&&(b=!0)});if(b)return a.profile.profile_name.$setValidity("repeat",!1),!1;a.profile.profile_name.$setValidity("repeat",!0);return!0};a.checkSPI=function(b){var c,d=parseInt("0xFFFFFFFE",16);switch(b){case "spi_in":c=a.edit.spi_incoming;break;case "spi_out":c=a.edit.spi_outgoing;break;default:return}c=parseInt("0x"+c,16);isNaN(c)||256>c||c>
d?a.profile[b].$setValidity("illegal",!1):a.profile[b].$setValidity("illegal",!0)};z()}]);app.controller("l2tp_server_main",["$scope","$q","MyHttp","UserSession","userAccessRight","addressPoolValidate",function(a,b,t,m,w,u){var p=app.TOOLS.getResponse,q=app.TOOLS.getVal;a.loadReady=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.ipsecprofile_note=a.DICT("L2TP_Server_Ipsec_Profile_Note",{"%s":"<a ng-click=\"jumpToPage('VPN_IPsec_Profiles')\">"+a.DICT("here")+"</a>"});a.model={ipsec_enable:!0,rule_list:[],nacm_grid:[],orig_dbgroups:[],orig_groups:[],groups:[],connections:[],l2tp:{enable:!1,mtu:1400,
start_ip:"",end_ip:"",primary_dns:"",secondary_dns:"",ipsec:!1,ipsec_profile:"",psk:""}};a.ui_data={show_key_in_plain:!1,enable_show_key_in_plain:!1,pwd_changed:!1,disable_DE_btn:!1,disable_add_btn:!1};var e="";a.success=!1;a.subnetObj={};a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var x=function(b){b||(b={});var d=[],g;b["ipsec-profiles"]&&b["ipsec-profiles"]["ipsec-profile"]&&(d=b["ipsec-profiles"]["ipsec-profile"]);a.model.ipsec_profiles=[];e="";angular.forEach(d,
function(b){if((g=b["keying-mode"])&&(g["phase1-options"]&&g["phase2-options"])&&!("v2"in g["ike-version"]))"Default"===b["profile-name"]&&(e=b["profile-name"]),a.model.ipsec_profiles.push({id:b["profile-name"]||"",displayName:b["profile-name"]||""})});e||(e=a.model.ipsec_profiles[0]&&a.model.ipsec_profiles[0].id||"")},n=function(){return t.post({url:resource_base+"data/ipsec_enable.json",method:"get_ipsec_enable",error:function(a){Log(ERROR,"[S2S][getIPSecEnable] "+JSON.stringify(a));l()}})},l=function(b){b||
(b={});b=q((b.ipsec||{}).enable,!0);a.model.ipsec_enable=b},r=function(){var c=t.post({url:resource_base+"data/l2tp_server.json",method:"get_l2tp_server",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),d=t.post({url:resource_base+"data/nacm_group.json",method:"get_groups",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),g=t.post({url:resource_base+"data/ipsec_profiles.json",method:"get_ipsec_profile",error:function(a){Log(ERROR,
"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),k=t.post({url:resource_base+"data/aaa.json",method:"get_subnet",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,d,g,k,n()]).then(function(b){x(p(b,2));var c=p(b,3);a.subnetObj={};c&&(c.subnets&&c.subnets.ipv4&&c.subnets.ipv6)&&(a.subnetObj=angular.copy(c.subnets));v(p(b,1));(c=p(b,0))||(c={});c=c.l2tp||{};a.model.l2tp={enable:q(c.enable,!1),mtu:q(c.mtu,1400),start_ip:c["start-ip"]||"",end_ip:c["end-ip"]||
"",primary_dns:c["primary-dns"]||"",secondary_dns:c["secondary-dns"]||"",ipsec:q(c.ipsec,!1),ipsec_profile:c["ipsec-profile"]||e,psk:""};c["preshared-key"]?(a.model.l2tp.psk="12345678901234567890",a.ui_data.enable_show_key_in_plain=!1):a.ui_data.enable_show_key_in_plain=!0;a.ui_data.show_key_in_plain=!1;a.ui_data.pwd_changed=!1;l(p(b,4));a.gridGroup.data=a.model.selected_groups;a.loadReady=!0})},v=function(b){var d=[];b||(b={});b.groups&&b.groups.group&&(d=b.groups.group);a.model.orig_dbgroups=angular.copy(d);
a.model.orig_groups=[];a.model.selected_groups=[];angular.forEach(d,function(b){a.model.orig_groups.push({id:b.name,displayName:b.name});angular.forEach(b["feature-rule"],function(c){"l2tp"===c.service&&"permit"===c.action&&a.model.selected_groups.push({checked:!1,edit:!1,empty:"",exp:{select:b.name,list:[]}})})});k()},s=function(){var b=angular.copy(a.model.orig_groups),d;angular.forEach(a.model.selected_groups,function(a){for(d=b.length-1;0<=d;d--)b[d].id===a.exp.select&&b.splice(d,1)});return b},
k=function(){var b=s();a.ui_data.disable_add_btn=b.length?!1:!0;angular.forEach(a.model.selected_groups,function(a){a.exp.list=[{id:a.exp.select,displayName:a.exp.select}];a.exp.list=a.exp.list.concat(b)})},d=function(b){a.ui_data.disable_DE_btn=!0;angular.forEach(a.model.selected_groups,function(b,c){b.checked&&(a.ui_data.disable_DE_btn=!1)})};a.gridGroup=app.uiGrid.generateGridOptions({IDPreifx:"l2tp",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:d,headerChangedCbk:d},{field:"exp",displayName:a.DICT("L2TP_Server_Group_Name"),
minWidth:350,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html",change:k},{field:"empty",isEmpty:!0}]});a.save=function(){var b=[];(function(){var d={},g=!1,e;angular.forEach(a.model.selected_groups,function(a){d[a.exp.select]=!0});angular.forEach(a.model.orig_dbgroups,function(a){angular.forEach(a["feature-rule"],function(b){"l2tp"===b.service&&(e=d[a.name]?"permit":"deny",e!==b.action&&(b.action=e,g=!0))})});g&&b.push({method:"set_groups",params:{groups:{group:a.model.orig_dbgroups}}})})();
(function(){var d=a.model.l2tp,g={enable:d.enable,mtu:d.mtu,"start-ip":d.start_ip,"end-ip":d.end_ip,"primary-dns":d.primary_dns,"secondary-dns":d.secondary_dns,ipsec:d.ipsec,"ipsec-profile":d.ipsec_profile};a.ui_data.pwd_changed&&(g["preshared-key"]=d.psk);b.push({method:"set_l2tp_server",params:{l2tp:g}})})();t.post({method:"set_bulk",params:b,success:function(b){r();a.resetModified()},error:function(b){Log(ERROR,"[L2TP Server] set_bulk ERR");Log(ERROR,b);r();a.resetModified()}})};a.cancel=function(){r();
a.resetModified()};a.addGroup=function(){var b=s();a.model.selected_groups.push({checked:!0,empty:"",edit:!0,exp:{select:b[0].id,list:[]}});k();d();a.gridGroup.gridApi.customApi.scrollToLast();a.modified()};a.editGroup=function(){angular.forEach(a.model.selected_groups,function(a){a.checked&&(a.edit=!0)})};a.delGroup=function(){var b=a.model.selected_groups,e;for(e=b.length-1;0<=e;e--)b[e].checked&&b.splice(e,1);d();k();a.modified()};a.poolValidation=function(){var b=!0,d=a.model.l2tp.start_ip,g=
a.model.l2tp.end_ip;a.form.l2tp_start_ip.$setValidity("range",!0);a.form.l2tp_end_ip.$setValidity("range",!0);a.form.l2tp_start_ip.$setValidity("subnet",!0);a.form.l2tp_end_ip.$setValidity("subnet",!0);if(!d||!g)return!0;b=u.compareIpRange(d,g);!1===b?(a.form.l2tp_start_ip.$setValidity("range",!1),a.form.l2tp_end_ip.$setValidity("range",!1)):(b=u.poolValidate("l2tp","l2tp","ipv4",a.subnetObj,d,g),!1===b&&(a.form.l2tp_start_ip.$setValidity("subnet",!1),a.form.l2tp_end_ip.$setValidity("subnet",!1)));
return b};a.change_pwd=function(){a.ui_data.enable_show_key_in_plain=!0;a.ui_data.pwd_changed=!0};a.focus_pwd=function(){a.ui_data.pwd_changed||(a.model.l2tp.psk="")};a.blur_pwd=function(){a.ui_data.pwd_changed||(a.model.l2tp.psk="12345678901234567890")};r()}]);app.controller("pptp_server_main",["$scope","$rootScope","$q","$log","MyHttp","$http","ngGridCellBuilder","$templateCache","Sets","UserSession","userAccessRight","addressPoolValidate",function(a,b,t,m,w,u,p,q,e,x,n,l){a.model=a.model||{};a.model.rule_list=[];a.model.nacm_grid=[];a.model.groups=[];a.model.connections=[];var r=[],v=[],s=[],k=[];a.disable_add_user_group=!1;var d=a.disable_del_user_group=!1;a.success=!1;a.subnetObj={};a.dataReady=!1;a.model.proxy={groups:{group:[]}};a.userAccessFlag=
n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&x.logout();var c=function(){var b=w.post({url:resource_base+"data/pptp_server.json",method:"get_pptp_server",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),c=w.post({url:resource_base+"data/nacm_group.json",method:"get_groups",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),d=w.post({url:resource_base+"data/aaa.json",method:"get_subnet",error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}});t.all([b,c,d]).then(function(b){angular.extend(a.model,b[0].data.result);var c=b[1];c.data&&(c.data.result&&c.data.result.groups&&c.data.result.groups.group)&&(a.model.proxy.groups=angular.copy(c.data.result.groups));b=b[2];b.data&&(b.data.result&&b.data.result.subnets&&b.data.result.subnets.ipv4&&b.data.result.subnets.ipv6)&&(a.subnetObj=angular.copy(b.data.result.subnets));a.model.pptp||angular.extend(a.model,{pptp:{enable:!1,"start-ip":"","end-ip":"","user-authentication":"Default",
"mppe-encryption":"mppe-none","max-session":10}});h();a.schema=a.schema||{};a.schema.mppeencryptionMap=[{id:"mppe-none",displayName:a.DICT("PPTPServer_None")},{id:"mppe-128",displayName:"128 bits"}];a.model_orig=angular.copy(a.model);a.gridGroup.data=a.model.nacm_grid});a.dataReady=!0};c();var h=function(){a.model.nacm_grid=[];a.model.groups=[];a.model.connections=[];a.model.connections.push({name:"pptp",yes_group:[],no_group:[],grid_table:[]});a.model.proxy&&(a.model.proxy.groups&&a.model.proxy.groups.group)&&
(a.model.rule_list=angular.copy(a.model.proxy.groups.group),angular.forEach(a.model.rule_list,function(b){a.model.groups.push(b.name)}),angular.forEach(a.model.connections,function(b){angular.forEach(a.model.rule_list,function(a){a["feature-rule"]&&angular.forEach(a["feature-rule"],function(c){"pptp"===c.service&&"permit"===c.action&&b.yes_group.push({name:a.name,id:a.name,displayName:a.name})})})}),angular.forEach(a.model.connections,function(b){angular.forEach(a.model.rule_list,function(a){a["feature-rule"]&&
angular.forEach(a["feature-rule"],function(c){"pptp"===c.service&&"deny"===c.action&&b.no_group.push({name:a.name,id:a.name,displayName:a.name})})})}),angular.forEach(a.model.connections,function(a){angular.forEach(a.yes_group,function(b){a.grid_table.push({exp:{list:a.yes_group,select:b.name},edit:!1})})}));a.model.nacm_grid=angular.copy(a.model.connections[0].grid_table);v=angular.copy(a.model.connections[0].yes_group);s=angular.copy(a.model.connections[0].no_group);angular.forEach(a.model.nacm_grid,
function(a,b){a.checked=!1});a.disable_add_user_group=0>=s.length?!0:!1;a.disable_del_user_group=0>=a.model.nacm_grid.length?!0:!1},g=function(){r=angular.copy(s);angular.forEach(a.model.nacm_grid,function(a){if(!0===a.edit)for(var b=0;b<r.length;b++)if(a.exp.select===r[b].name){r.splice(b,1);break}});angular.forEach(a.model.nacm_grid,function(a){!0===a.edit&&(a.exp.list=[{name:a.exp.select,id:a.exp.select,displayName:a.exp.select}].concat(r))})};a.procNgClick=function(b){a.disable_del_user_group=
!0;k=[];angular.forEach(a.model.nacm_grid,function(b,c){b.checked&&(a.disable_del_user_group=!1,k.push(b))})};a.gridGroup=app.uiGrid.generateGridOptions({IDPreifx:"pptp",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.procNgClick,headerChangedCbk:a.procNgClick},{field:"exp",displayName:a.DICT("Teleworker_VPN_Client_G_Name"),minWidth:300,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html",change:g},{field:"empty",isEmpty:!0}]});a.save=function(){(function(){var b,c=[];
c.push({method:"set_pptp_server",params:{pptp:a.model.pptp}});if(d){for(b=0;b<a.model.nacm_grid.length;b++)angular.forEach(a.model.rule_list,function(c){angular.forEach(c["feature-rule"],function(d){c.name===a.model.nacm_grid[b].exp.select&&"pptp"===d.service&&(d.action="permit")})}),a.model.nacm_grid[b].edit=!1;for(b=0;b<r.length;b++)angular.forEach(a.model.rule_list,function(a){angular.forEach(a["feature-rule"],function(c){a.name===r[b].name&&"pptp"===c.service&&(c.action="deny")})});c.push({method:"set_groups",
params:{groups:{group:a.model.rule_list}}});w.post({url:resource_base+"data/pptp_server.json",method:"set_bulk",params:c,success:function(b){a.success=!0;a.config_saved=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});s=angular.copy(r);v=[];angular.forEach(a.model.nacm_grid,function(a){v.push({name:a.exp.select,id:a.exp.select,displayName:a.exp.select,empty:""})});d=!1}else w.post({url:resource_base+"data/pptp_server.json",method:"set_bulk",params:c,success:function(b){a.success=
!0;a.config_saved=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})();a.resetModified()};a.cancel=function(){c();a.resetModified()};a.addGroup=function(){r=angular.copy(s);d=!0;angular.forEach(a.model.nacm_grid,function(a){if(!0===a.edit)for(var b=0;b<r.length;b++)if(a.exp.select===r[b].name){r.splice(b,1);break}});a.model.nacm_grid.push({exp:{list:r,select:r[0].name},empty:"",edit:!0,checked:!0});g();a.disable_add_user_group=0>=r.length?!0:!1;a.disable_del_user_group=
0>=a.model.nacm_grid.length?!0:!1;a.gridGroup.gridApi.customApi.scrollTo(a.gridGroup.data.length-1,1);a.procNgClick();a.modified()};a.delGroup=function(){var b=k.length,c=!1,e,h;d=!0;for(e=0;e<b;e++)for(h=a.model.nacm_grid.length-1;0<=h;h--)if(k[e].exp.select===a.model.nacm_grid[h].exp.select){a.model.nacm_grid.splice(h,1);break}for(e=0;e<b;e++)for(h=v.length-1;0<=h;h--)if(k[e].exp.select===v[h].name){v.splice(h,1);break}for(e=0;e<b;e++){c=!0;for(h=0;h<s.length;h++)if(k[e].exp.select===s[h].name){c=
!1;break}!0===c&&s.push({name:k[e].exp.select,id:k[e].exp.select,displayName:k[e].exp.select})}g();a.disable_add_user_group=0>=r.length?!0:!1;a.disable_del_user_group=0>=a.model.nacm_grid.length?!0:!1;for(e=b-1;0<=e;e--)k.splice(e,1);a.procNgClick();a.modified()};a.poolValidation=function(){var b=!0;a.form.pptp_start_ip.$setValidity("range",!0);a.form.pptp_end_ip.$setValidity("range",!0);a.form.pptp_start_ip.$setValidity("subnet",!0);a.form.pptp_end_ip.$setValidity("subnet",!0);if(void 0===a.model.pptp["start-ip"]||
void 0===a.model.pptp["end-ip"]||""===a.model.pptp["start-ip"]||""===a.model.pptp["end-ip"])return!0;b=l.compareIpRange(a.model.pptp["start-ip"],a.model.pptp["end-ip"]);!1===b?(a.form.pptp_start_ip.$setValidity("range",!1),a.form.pptp_end_ip.$setValidity("range",!1)):(b=l.poolValidate("pptp","pptp","ipv4",a.subnetObj,a.model.pptp["start-ip"],a.model.pptp["end-ip"]),!1===b&&(a.form.pptp_start_ip.$setValidity("subnet",!1),a.form.pptp_end_ip.$setValidity("subnet",!1)));return b}}]);app.controller("teleworkerVPNCtrl",["$scope","MyHttp","pgWindow","$q","UserSession","userAccessRight","ciscosb",function(a,b,t,m,w,u,p){var q=a.success=!1,e=a.DICT("Teleworker_VPN_Client_Down"),x=a.DICT("Teleworker_VPN_Client_Up"),n=a.DICT("Teleworker_VPN_Client_Connecting"),l=app.TOOLS.getResponse,r=app.TOOLS.getVal;a.jumpToPage=app.TOOLS.jumpToPage;a.ipsecprofile_note=a.DICT("Teleworker_VPN_Client_Ipsec_Profile_Note",{"%s":"<a ng-click=\"jumpToPage('VPN_IPsec_Profiles')\">"+a.DICT("here")+"</a>"});
a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var v=function(){return b.post({url:resource_base+"data/telework_vpn_clients.json",method:"get_teleworker_vpn",error:function(a){console.log("teleworkerVPNCtrl getTeleworkerData error : "+a.status);s()}})},s=function(b){b||(b={});var c=[];b=b["teleworker-vpn-clients"]||{};b["teleworker-vpn-client"]&&(c=b["teleworker-vpn-client"]);a.model.enable=void 0!==b.enable?b.enable:!1;a.model.auto_initiation_retry=void 0!==
b["auto-initiation-retry"]?b["auto-initiation-retry"]:!1;a.model.retry_interval=b["retry-interval"]||120;a.model.retry_limit=void 0===b["retry-limit"]?2:b["retry-limit"];a.model.orig_enable=a.model.enable;a.model.orig_auto=a.model.auto_initiation_retry;a.model.orig_interval=a.model.retry_interval;a.model.orig_limit=a.model.retry_limit;a.model.clients=[];angular.forEach(c,function(b){a.model.clients.push(k(b))});a.gridTeleworkerOptions.data=a.model.clients;a.dataReady=!0},k=function(b){b||(b={});var c=
function(a){a||(a={});var b={type:"ip",ip:"",fqdn:"",user_fqdn:"",der_asn1_dn:""};angular.forEach(a,function(a,c){switch(c){case "ip":b.ip=a;break;case "fqdn":b.fqdn=a;break;case "user-fqdn":b.user_fqdn=a;break;case "der-asn1-dn":b.der_asn1_dn=a;break;default:return}b.type=c});return b},d=void 0;b.certificate?d=b.certificate:angular.forEach(a.model.certs,function(a){"Default"===a.id&&(d=a.id)});void 0===d&&(d=a.model.certs[0]&&a.model.certs[0].id||"");var g={name:b.name||"",checked:!1,server:b.server||
"",startup:void 0!==b["activate-connection-on-startup"]?b["activate-connection-on-startup"]:!1,display_startup:!1,auth_type:void 0!==b.certificate?"cert":"preshare",display_auth_type:void 0!==b.certificate?"Certificate":"Preshared Key",group_name:b["group-name"]||"",password:b.password||"",password_changed:!1,certificate:d,mode:"client",display_mode:"Client",vlan:a.model.vlans[0]&&a.model.vlans[0].id,user_name:b["user-name"]||"",user_password:b["user-password"]||"",user_password_changed:!1,confirm_user_password:b["confirm-user-password"]||
"",confirm_user_password_changed:!1,backup_server_1:b["backup-server-1"]||"",backup_server_2:b["backup-server-2"]||"",backup_server_3:b["backup-server-3"]||"",display_backup_server:[],peer_timeout:b["peer-timeout"]||120,connect_status:"down",status:e};b.password&&(g.password="0000000000000");b["user-password"]&&(g.user_password="0000000000000");b["confirm-user-password"]&&(g.confirm_user_password="0000000000000");g.backup_server_1&&g.display_backup_server.push(g.backup_server_1);g.backup_server_2&&
g.display_backup_server.push(g.backup_server_2);g.backup_server_3&&g.display_backup_server.push(g.backup_server_3);g.display_backup_server.length||g.display_backup_server.push("-");g.startup&&(g.display_startup=!0);angular.forEach(b,function(a,b){"vlan"===b&&(g.vlan=a,g.mode="nem",g.display_mode="NEM")});g.local_identifier=c(b["local-identifier"]);g.remote_identifier=c(b["remote-identifier"]);return g},d=function(){return b.post({url:resource_base+"data/ipsec_client_to_site.json",method:"get_client_to_site",
error:function(a){console.log("clientToSIteCtrl getClientToSiteData error, status: "+a.status);c()}})},c=function(b){b||(b={});b=(b["client-to-sites"]||{})["client-to-site"]||[];a.model.c2s=[];angular.forEach(b,function(b){a.model.c2s.push(b)})},h=function(a){return b.post({url:resource_base+"data/teleworker_vpn_state.json",method:"get_teleworker_vpn_state",procBackground:a&&a.procBackground||void 0,error:function(a){g()}})},g=function(b){b||(b={});b=b["teleworker-vpn-clients-state"]||{};a.model.state=
{name:b.name||"",status:b.status||"",primary_dns:b["primary-dns"]||"",secondary_dns:b["secondary-dns"]||"",primary_wins:b["primary-wins"]||"",secondary_wins:b["secondary-wins"]||"",default_domain:b["default-domain"]||"",backup_server_1:b["backup-server-1"]||"",backup_server_2:b["backup-server-2"]||"",backup_server_3:b["backup-server-3"]||"",split_tunnel:b["split-tunnel"]||"",split_dns:b["split-dns"]||""}},A=function(){return b.post({url:resource_base+"data/cert2.json",method:"get_cert",error:function(a){console.log("teleworkerVPNCtrl getCertificateData error: "+
a.status);y()}})},y=function(b){b||(b={});var c=[],d={},g;b["certs-state"]&&b["certs-state"].cert&&(c=b["certs-state"].cert);a.model.certs=[];angular.forEach(c,function(b){if((g=b.name||"")&&!d[g])a.model.certs.push({id:g,displayName:b.name}),d[g]=!0})},z=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",params:{filter:"VLAN"},success:function(a){a.data&&a.data.result?B(a.data.result):B()},error:function(a){B()}})},B=function(b){b||(b={});var c=[],d;b.interfaces&&
b.interfaces["interface"]&&(c=b.interfaces["interface"]);a.model.vlans=[];angular.forEach(c,function(b){b.name.match(/^VLAN\d*$/)&&(d=b["vlan-interface-settings"]&&b["vlan-interface-settings"]["vlan-id"],void 0!==d&&a.model.vlans.push({id:d,displayName:d}))})},D=function(){return b.post({url:resource_base+"data/ipsec_enable.json",method:"get_ipsec_enable",error:function(a){Log(ERROR,"[TLKVPN][getIPSecEnable] "+JSON.stringify(a));E()}})},E=function(b){b||(b={});b=r((b.ipsec||{}).enable,!0);a.model.ipsec_enable=
b},C={main:"main",edit:"edit"},I=function(b){1===a.sel_c2s_cnt?a.connectedName?angular.forEach(a.model.clients,function(b){b.checked&&(a.selOPAble=b.name===a.connectedName?b.connect_status:"down")}):a.selOPAble="down":a.selOPAble=""},G=function(){a.model.state_step="none";a.sel_c2s_cnt=0;a.del_clients=[];m.all([v(),d()]).then(function(b){s(l(b,0));c(l(b,1));H();a.resetModified()})},H=function(){a.model.state_step="getting";angular.forEach(a.model.clients,function(a){a.status="-"});m.all([h()]).then(function(b){g(l(b,
0));F();a.model.state_step="done"})},F=function(){var b=a.model.state,c=a.model.clients;a.connectedName="";angular.forEach(c,function(c){if(c.name===b.name){switch(b.status){case "UP":c.status=x;c.connect_status="up";break;case "CONNECTING":c.status=n;c.connect_status="connecting";break;default:c.status=e,c.connect_status="down"}a.connectedName=c.name}else c.status=e});I()};t=function(){a.sel_c2s_cnt=0;angular.forEach(a.model.clients,function(b){b.checked&&a.sel_c2s_cnt++});I()};a.currPage=C.main;
a.dataReady=!1;a.currPage="main";a.sel_c2s_cnt=0;a.selOPAble="";a.connectedName="";a.gridTeleworkerOptions=app.uiGrid.generateGridOptions({rowHeight:2*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t},{field:"name",displayName:a.DICT("Teleworker_VPN_Client_Nm")},{field:"server",displayName:a.DICT("Teleworker_VPN_Client_Host"),width:180},{field:"display_startup",displayName:a.DICT("Teleworker_VPN_Client_Activate_Startup"),width:250,cellTemplate:"UG_table_checkbox_with_inline_edit.html"},
{field:"display_auth_type",displayName:a.DICT("Teleworker_VPN_Client_Authenication_Method")},{field:"group_name",displayName:a.DICT("Teleworker_VPN_Client_G_Name")},{field:"user_name",displayName:a.DICT("Teleworker_VPN_Client_U_Name")},{field:"display_backup_server",displayName:a.DICT("Teleworker_VPN_Client_Backup_Server"),cellTemplate:"UG_table_text_with_three_rows.html"},{field:"peer_timeout",displayName:a.DICT("Teleworker_VPN_Client_P_Timeout"),width:115},{field:"display_mode",displayName:a.DICT("Teleworker_VPN_Client_Mode_N"),
width:70},{field:"status",displayName:a.DICT("Teleworker_VPN_Client_Status"),fixWidth:!0,minWidth:95}]});a.change_pwd=function(){a.edit.password_changed=!0};a.change_user_pwd=function(){a.edit.user_password_changed=!0;a.edit.confirm_user_password_changed||(a.edit.confirm_user_password="",a.edit.confirm_user_password_changed=!0);a.checkUserPass()};a.change_confirm_user_pwd=function(){a.edit.confirm_user_password_changed=!0;a.edit.user_password_changed||(a.edit.user_password="",a.edit.user_password_changed=
!0);a.checkUserPass()};a.checkUserPass=function(){var b=a.edit;b.user_password_changed&&b.user_password!==b.confirm_user_password?a.teleworkerform.user_confirm.$setValidity("isnothesame",!1):a.teleworkerform.user_confirm.$setValidity("isnothesame",!0)};a.change_name=function(){var b=!1;a.edit.name?(a.edit.name.match(/^\w+$/)?a.teleworkerform.name.$setValidity("special",!0):a.teleworkerform.name.$setValidity("special",!1),angular.forEach(a.model.clients,function(c){c.name===a.edit.name&&(b=!0)}),a.teleworkerform.name.$setValidity("repeat",
!b)):(a.teleworkerform.name.$setValidity("repeat",!0),a.teleworkerform.name.$setValidity("special",!0))};a.del_clients=[];a.model={ipsec_enable:!0,enable:!1,orig_enable:!1,auto_initiation_retry:!1,orig_auto:!1,retry_interval:120,orig_interval:120,retry_limit:2,orig_limit:2,clients:[],certs:[],vlans:[],state:{},state_step:"none"};var K=function(){var b={},c=!1;a.model.orig_enable!==a.model.enable&&(b.enable=a.model.enable,c=!0);a.model.orig_auto!==a.model.auto_initiation_retry&&(b["auto-initiation-retry"]=
a.model.auto_initiation_retry,c=!0);a.model.orig_interval!==a.model.retry_interval&&(b["retry-interval"]=a.model.retry_interval,c=!0);a.model.orig_limit!==a.model.retry_limit&&(b["retry-limit"]=a.model.retry_limit,c=!0);return{has_modify:c,clients:b}},M=function(c){b.post({method:"del_teleworker_vpn",params:{"teleworker-vpn-clients":{"teleworker-vpn-client":a.del_clients}},success:function(b){"function"===$.type(c)&&c();a.success=!0},error:function(a){"function"===$.type(c)&&c()}})};a.funs={main:{autoInitRetry:function(){!1===
a.model.auto_initiation_retry&&(a.model.retry_interval=a.model.orig_interval,a.model.retry_limit=a.model.orig_limit)},save:function(){var c=K(),d=c.clients,c=c.has_modify,g=function(){b.post({method:"set_teleworker_vpn",params:{"teleworker-vpn-clients":d},success:function(b){a.model.enable&&q?N():(a.success=!0,G())},error:function(a){G()}})};a.del_clients.length?c?M(g):M(function(){a.success=!0;G()}):c&&g()},cancel:function(){G()},add:function(){a.edit=k();a.edit.checked=!0;a.orig=void 0;a.currPage=
C.edit;a.modified()},edit:function(){a.edit=void 0;angular.forEach(a.model.clients,function(b){b.checked&&(a.edit=angular.copy(b))});a.edit?(a.orig=angular.copy(a.edit),a.currPage=C.edit):Log(ERROR,"policy edit button error, checked item is not exist")},del:function(){for(var b=a.model.clients.length-1;0<=b;b--)a.model.clients[b].checked&&(a.del_clients.push({name:a.model.clients[b].name}),a.model.clients.splice(b,1))},connect:function(){var c="";angular.forEach(a.model.clients,function(a){a.checked&&
(c=a.name)});b.post({method:"action",forcedUsingPost:!0,params:{input:{name:c},rpc:"teleworker-vpn-client-connect"},success:function(){H()},error:function(){H()}})},disconnect:function(){var c="";angular.forEach(a.model.clients,function(a){a.checked&&(c=a.name)});b.post({method:"action",forcedUsingPost:!0,params:{input:{name:c},rpc:"teleworker-vpn-client-disconnect"},success:function(){H()},error:function(){H()}})}},edit:{save:function(){var c=a.edit,d=K().clients;app.TOOLS.warningAlertBox({msg:"Do you want to make this connection active when the settings are saved?<br/>(Only one connection can be active at a time.)",
btn_yes_str:"Activate Connection",btn_no_str:"Do Not Activate",cbk:function(g){c.startup=g;g={name:c.name,server:c.server,"activate-connection-on-startup":c.startup,"user-name":c.user_name,"backup-server-1":c.backup_server_1,"backup-server-2":c.backup_server_2,"backup-server-3":c.backup_server_3,"peer-timeout":c.peer_timeout};var e=[],h=function(){b.post({method:"set_teleworker_vpn",params:{"teleworker-vpn-clients":d},success:function(b){a.model.enable&&q?N():(a.success=!0,G(),a.currPage=C.main)},
error:function(b){G();a.currPage=C.main}})};c.startup&&angular.forEach(a.model.clients,function(b){a.orig&&b.name===a.orig.name||b.startup&&e.push({name:b.name,"activate-connection-on-startup":!1})});"preshare"===c.auth_type?(g["group-name"]=c.group_name,c.password_changed&&(g.password=c.password)):g.certificate=c.certificate;c.user_password_changed&&(g["user-password"]=c.user_password,g["confirm-user-password"]=c.confirm_user_password);"client"===c.mode?angular.extend(g,p.empty_type("client")):"nem"===
c.mode&&(g.vlan=c.vlan);e.push(g);d["teleworker-vpn-client"]=e;a.del_clients.length?M(h):h()}})},cancel:function(){G();a.currPage=C.main}}};a.changeEnable=function(){for(var b=0;b<a.model.c2s.length;b++)if(!0===a.model.c2s[b].enable){q=!0;break}else q=!1;a.model.enable&&q&&a.model.orig_enable!==a.model.enable&&app.TOOLS.warningAlertBox({msg:"Client-to-Site will be disabled.<br>You cannot enable Client-to-Site and Teleworker VPN Client simultaneously.<br>Click Apply to proceed.",btn_yes_str:"Apply",
btn_no_str:"Cancel"})};var N=function(){angular.forEach(a.model.c2s,function(a){!0===a.enable&&(a.enable=!1)});b.post({method:"set_client_to_site",params:{"client-to-sites":{"client-to-site":a.model.c2s}},success:function(b){a.success=!0;G();a.currPage=C.main},error:function(b){G();a.currPage=C.main}})};(function(){a.model.state_step="none";a.sel_c2s_cnt=0;a.del_clients=[];m.all([A(),z(),v(),d(),D()]).then(function(b){y(l(b,0));B(l(b,1));s(l(b,2));c(l(b,3));E(l(b,4));H();a.resetModified()})})()}]);app.controller("VPNPassthroughCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,t,m){var w,u,p,q,e,x;a.success=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var n=function(){b.post({url:resource_base+"data/ipsec_passthrough.json",method:"get_ipsec_passthrough",success:function(a){a.data&&a.data.result?l(a.data.result):l()},error:function(a){console.log("VPNPassthroughCtrl getIPSecPassthrough error: "+a.status)}})},l=function(b){b||(b=
{});b=b["ipsec-passthrough"]||{};b=void 0!==b.enable?b.enable:!1;q=a.model.ipsec=b;w=!0;d()},r=function(){b.post({url:resource_base+"data/l2tp_passthrough.json",method:"get_l2tp_passthrough",success:function(a){a.data&&a.data.result?v(a.data.result):v()},error:function(a){console.log("VPNPassthroughCtrl getL2TPPassthrough error: "+a.status)}})},v=function(b){b||(b={});b=b["l2tp-passthrough"]||{};b=void 0!==b.enable?b.enable:!1;e=a.model.l2tp=b;u=!0;d()},s=function(){b.post({url:resource_base+"data/pptp_passthrough.json",
method:"get_pptp_passthrough",success:function(a){a.data&&a.data.result?k(a.data.result):k()},error:function(a){console.log("VPNPassthroughCtrl getPPTPPassthrough error: "+a.status)}})},k=function(b){b||(b={});b=b["pptp-passthrough"]||{};b=void 0!==b.enable?b.enable:!1;x=a.model.pptp=b;p=!0;d()};u=p=w=e=x=q=!1;var d=function(){a.dataReady=w&&u&&p};a.model={ipsec:!1,pptp:!1,l2tp:!1};a.dataReady=!1;a.funs={save:function(){var c=a.model;q!==c.ipsec&&b.post({method:"set_ipsec_passthrough",params:{"ipsec-passthrough":{enable:c.ipsec}},
success:function(b){a.success=!0;n();a.resetModified()},error:function(a){}});e!==c.l2tp&&b.post({method:"set_l2tp_passthrough",params:{"l2tp-passthrough":{enable:c.l2tp}},success:function(b){a.success=!0;r();a.resetModified()},error:function(a){}});x!==c.pptp&&b.post({method:"set_pptp_passthrough",params:{"pptp-passthrough":{enable:c.pptp}},success:function(b){a.success=!0;s();a.resetModified()},error:function(a){}})},cancel:function(){n();r();s();a.resetModified()}};n();r();s()}]);app.controller("siteToSiteCtrl",["$scope","MyHttp","oneTimeLocker","wan_service","$q","$templateCache","UserSession","userAccessRight","passwordComplex","ciscosb","wan_lib","addressPoolValidate",function(a,b,t,m,w,u,p,q,e,x,n,l){a.disable_add_user_group=!1;a.disable_del_user_group=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.isErr=!1;a.repeat_conn="";a.subnetObj={};a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&p.logout();var r=app.TOOLS.getResponse,v=app.TOOLS.getVal,s=function(){return b.post({url:resource_base+
"data/ipsec_site_to_site.json",method:"get_site_to_site",error:function(a){Log(ERROR,"siteToSiteCtrl getSiteToSiteData error, status: "+a.status);k()}})},k=function(b){b||(b={});b=b["site-to-sites"]||{};var c=b["site-to-site"]||[];a.model.maxTunnel=b["max-tunnel"]||50;a.model.s2s=[];angular.forEach(c,function(b,c){a.model.s2s.push(d(b))})},d=function(b){b||(b={});var c=b["remote-endpoint"]||{},d=b["split-dns"]||{},g=b.failover||{},e=b.keepalive||{},h=b.dpd||{},k={},l=b["extended-authentication"]||
{},m=a.model.ifs,n,p,r=function(b,c){b&&(b.identifier&&angular.forEach(b.identifier,function(a,b){switch(b){case "ip":c.identifier.type=b;c.identifier.ip=a||"";break;case "interface":c.identifier.type=b;c.identifier["interface"]="";break;case "fqdn":c.identifier.type=b;c.identifier.fqdn=a||"";break;case "user-fqdn":c.identifier.type=b;c.identifier.user_fqdn=a||"";break;case "der-asn1-dn":c.identifier.type=b,c.identifier.asn1dn=a||""}}),b.group&&angular.forEach(b.group,function(b,d){switch(d){case "subnet":"0.0.0.0"===
b.ip&&"0.0.0.0"===b.netmask?c.group.type="any":(c.group.type=d,c.group.subnet_ip=b.ip||"",c.group.subnet_netmask=b.netmask||"");break;case "ip":c.group.type=d;c.group.ip=b.ip||"";break;case "ip-range":c.group.type=d;c.group.begin_ip=b["begin-ip"]||"";c.group.end_ip=b["end-ip"]||"";break;case "ip-group":c.group.type=d;c.group.ip_group=b&&b[0]||a.model.default_ip_group;break;case "tunnel":c.group.type="gre",c.group.gre_interface=b||a.model.default_gre}}))},q=function(b,c,d,g){var e="ike",h=a.model.default_cert,
k=a.model.default_ca_cert;b||(b={});g&&(h=k);d?(b["local-certificate"]&&b["local-certificate"].certificate&&(h=b["local-certificate"].certificate,e="cert"),b["remote-certificate"]&&b["remote-certificate"].certificate&&(k=b["remote-certificate"].certificate||"",e="cert"),c.remote_certificate=k):b.certificate&&(e="cert",h=b.certificate);c.method=e;c.certificate=h;c.password=v(b.password,"");c.strength_meter=v(b["strength-meter"],0);c.minimum_complexity=v(b["minimum-complexity"],!0);c.orig_password=
c.password};n=void 0;n=b["ipsec-profile"]?b["ipsec-profile"]:a.model.default_profile;p=a.model.profilesMap[n]||{};k={connection_name:v(b["connection-name"],""),editType:"",isGre:!1,type:"s2s",enable:v(b.enable,!0),"interface":v(b["interface"],m[0]&&m[0].name||""),ipsec_profile:n,ike_mode:p.ike_mode||"v2",non_rfc_compliant:v(b["non-rfc-compliant"],!1),remote_endpoint:{type:"static-ip",ip:"",fqdn:""},local_authentication:{method:"ike",show_key_in_plain:!1,enable_show_key_in_plain:!1,orig_password:"",
password:"",strength_meter:0,minimum_complexity:!0,certificate:void 0},remote_authentication:{method:"ike",show_key_in_plain:!1,enable_show_key_in_plain:!1,orig_password:"",password:"",strength_meter:0,minimum_complexity:!0,certificate:void 0},symm_authentication:{method:"ike",show_key_in_plain:!1,enable_show_key_in_plain:!1,orig_password:"",password:"",strength_meter:0,minimum_complexity:!0,certificate:void 0,remote_certificate:""},local_group:{identifier:{type:"interface",ip:"","interface":"",fqdn:"",
user_fqdn:"",asn1dn:""},group:{type:"subnet",subnet_ip:"",subnet_netmask:"",ip:"",begin_ip:"",end_ip:"",ip_group:a.model.default_ip_group,gre_interface:a.model.default_gre,gre_ip:""}},remote_group:{identifier:{type:"ip",ip:"",fqdn:"",user_fqdn:"",asn1dn:""},group:{type:"subnet",subnet_ip:"",subnet_netmask:"",ip:"",begin_ip:"",end_ip:"",ip_group:a.model.default_ip_group,gre_interface:a.model.default_gre,gre_ip:""}},aggressive_mode:v(b["aggressive-mode"],!1),compress:v(b.compress,!1),netbios_broadcast:v(b["netbios-broadcast"],
!1),multicast_passthrough:v(b["multicast-passthrough"],!1),nat_traversal:v(b["nat-traversal"],!1),keepalive:{enable:v(e.enable,!1),monitoring_interval:v(e["monitoring-interval"],10)},dpd:{enabled:v(h.enabled,!1),delay_time:v(h["delay-time"],10),detection_timeout:v(h["detection-timeout"],30),action:v(h.action,a.model.schema.dpdAction[0]&&a.model.schema.dpdAction[0].id||"")},extended_authentication:{enable:!1,type:"group",group:"",user_name:"",password:""},split_dns:{enable:v(d.enable,!1),primary_dns:v(d["primary-dns"],
""),secondary_dns:v(d["secondary-dns"],""),fqdn:[]},failover:{enable:v(g.enable,!1),remote_backup_ip:v(g["remote-backup-ip"],""),"interface":v(g["interface"],m[0]&&m[0].name||"")},selected_groups:{},grid_group_data:[],grid_group_checked:[]};a.model.auth_groups[0]&&(k.extended_authentication.group=void 0!==a.model.auth_groups[0].id?a.model.auth_groups[0].id:"");b["remote-endpoint"]&&(k.remote_endpoint.type="dynamic-ip",angular.forEach(c,function(a,b){switch(b){case "static-ip":k.remote_endpoint.type=
b;k.remote_endpoint.ip=a;break;case "fqdn":k.remote_endpoint.type=b,k.remote_endpoint.fqdn=a}}));r(b["local-group"],k.local_group);r(b["remote-group"],k.remote_group);q(b["symm-authentication"],k.symm_authentication,!0);q(b["local-authentication"],k.local_authentication);q(b["remote-authentication"],k.remote_authentication,!1,!0);"gre"===k.local_group.group.type&&(k.isGre=!0);"der-asn1-dn"===k.local_group.identifier.type&&"ASN1DN"===k.local_group.identifier.asn1dn&&(k.local_group.identifier.asn1dn=
"");"der-asn1-dn"===k.remote_group.identifier.type&&"%any"===k.remote_group.identifier.asn1dn&&(k.remote_group.identifier.asn1dn="");angular.forEach(l,function(a,b){switch(b){case "enable":k.extended_authentication.enable=void 0!==a?a:!1;break;case "group":k.extended_authentication.type=b;k.extended_authentication.group=a;break;case "user-name":k.extended_authentication.type="user";k.extended_authentication.user_name=a||"";break;case "password":k.extended_authentication.password=a||""}});for(d.fqdn&&
angular.forEach(d.fqdn,function(a,b){k.split_dns.fqdn.push({domain_name:a["domain-name"]})});6>k.split_dns.fqdn.length;)k.split_dns.fqdn.push({domain_name:""});return k},c=function(a){var b=function(b,c){switch(b.identifier.type){case "ip":c.identifier={ip:b.identifier.ip};break;case "interface":c.identifier={"interface":a["interface"]};break;case "fqdn":c.identifier={fqdn:b.identifier.fqdn};break;case "user-fqdn":c.identifier={"user-fqdn":b.identifier.user_fqdn};break;case "der-asn1-dn":c.identifier=
{"der-asn1-dn":b.identifier.asn1dn}}switch(b.group.type){case "subnet":c.group={subnet:{ip:b.group.subnet_ip,netmask:b.group.subnet_netmask}};break;case "ip":c.group={ip:{ip:b.group.ip}};break;case "ip-range":c.group={"ip-range":{"begin-ip":b.group.begin_ip,"end-ip":b.group.end_ip}};break;case "any":c.group={subnet:{ip:"0.0.0.0",netmask:"0.0.0.0"}};break;case "gre":c.group={tunnel:b.group.gre_interface};break;case "ip-group":c.group={"ip-group":[b.group.ip_group]}}},c=a&&a.split_dns||{},d={"connection-name":a.connection_name,
enable:a.enable,"interface":a["interface"],"ipsec-profile":a.ipsec_profile,"non-rfc-compliant":a.non_rfc_compliant,"remote-endpoint":{},"local-group":{},"remote-group":{},"aggressive-mode":a.aggressive_mode,compress:a.compress,"netbios-broadcast":a.netbios_broadcast,keepalive:{enable:a.keepalive.enable||!1,"monitoring-interval":a.keepalive.monitoring_interval||10},dpd:{enabled:a.dpd.enabled||!1,"delay-time":a.dpd.delay_time||10,"detection-timeout":a.dpd.detection_timeout||10,action:a.dpd.action||
"close"},"extended-authentication":{enable:a.extended_authentication.enable||!1},"split-dns":{enable:c.enable||!1,"primary-dns":c.primary_dns||"","secondary-dns":c.secondary_dns||"",fqdn:[]},failover:{enable:a.failover.enable||!1,"remote-backup-ip":a.failover.remote_backup_ip||"","interface":a.failover["interface"]||""}};!c.primary_dns&&c.secondary_dns&&(d["split-dns"]["primary-dns"]=c.secondary_dns,d["split-dns"]["secondary-dns"]="");"manual"===a.ike_mode||"v1"===a.ike_mode?(d["non-rfc-compliant"]=
!1,"ike"===a.symm_authentication.method?(d["symm-authentication"]={"minimum-complexity":a.symm_authentication.minimum_complexity},a.symm_authentication.orig_password!==a.symm_authentication.password&&angular.extend(d["symm-authentication"],{password:a.symm_authentication.password,"strength-meter":e.getStrength(a.symm_authentication.password)})):d["symm-authentication"]={"local-certificate":{certificate:a.symm_authentication.certificate},"remote-certificate":{certificate:a.symm_authentication.remote_certificate}}):
("ike"===a.local_authentication.method?(d["local-authentication"]={"minimum-complexity":a.local_authentication.minimum_complexity},a.local_authentication.orig_password!==a.local_authentication.password&&angular.extend(d["local-authentication"],{password:a.local_authentication.password,"strength-meter":e.getStrength(a.local_authentication.password)})):d["local-authentication"]={certificate:a.local_authentication.certificate},"ike"===a.remote_authentication.method?(d["remote-authentication"]={"minimum-complexity":a.remote_authentication.minimum_complexity},
a.remote_authentication.orig_password!==a.remote_authentication.password&&angular.extend(d["remote-authentication"],{password:a.remote_authentication.password,"strength-meter":e.getStrength(a.remote_authentication.password)})):d["remote-authentication"]={certificate:a.remote_authentication.certificate});if(a.remote_endpoint)switch(a.remote_endpoint.type){case "static-ip":d["remote-endpoint"]={"static-ip":a.remote_endpoint.ip};break;case "fqdn":d["remote-endpoint"]={fqdn:a.remote_endpoint.fqdn};break;
case "dynamic-ip":d["remote-endpoint"]={"dynamic-ip":null}}a.local_group.identifier.asn1dn="ASN1DN";b(a.local_group,d["local-group"]);b(a.remote_group,d["remote-group"]);"der-asn1-dn"===a.remote_group.identifier.type&&""===a.remote_group.identifier.asn1dn&&(d["remote-group"].identifier["der-asn1-dn"]="%any");if(a.extended_authentication)switch(a.extended_authentication.type){case "group":angular.extend(d["extended-authentication"],x.empty_type("group"));break;case "user":d["extended-authentication"]["user-name"]=
a.extended_authentication.user_name,a.origUserPassword!==a.extended_authentication.password&&(d["extended-authentication"].password=a.extended_authentication.password)}a.split_dns&&angular.forEach(a.split_dns.fqdn,function(a,b){a.domain_name&&d["split-dns"].fqdn.push({"domain-name":a.domain_name})});return d},h=function(){return b.post({url:resource_base+"data/gre_tunnel.json",method:"get_gre",error:function(a){g()}})},g=function(b){b||(b={});var c=[],d;b.interfaces&&b.interfaces["interface"]&&(c=
b.interfaces["interface"]||[]);a.model.greInterfaces=[];angular.forEach(c,function(b){b.name.match(/^GRE\d+$/)&&(d={id:b.name,displayName:b.name,src_ip:"",dest_ip:""},b.ipv4&&b.ipv4.address&&(d.src_ip=b.ipv4.address[0]&&b.ipv4.address[0].ip||""),b["tunnel-configuration"]&&b["tunnel-configuration"]["tunnel-destination"]&&(d.dest_ip=b["tunnel-configuration"]["tunnel-destination"]["ipv4-address"]||""),a.model.greInterfaces.push(d))});a.model.default_gre=a.model.greInterfaces[0]&&a.model.greInterfaces[0].id||
""},A=function(){return b.post({url:resource_base+"data/ipsec_enable.json",method:"get_ipsec_enable",error:function(a){Log(ERROR,"[S2S][getIPSecEnable] "+JSON.stringify(a));y()}})},y=function(b){b||(b={});b=v((b.ipsec||{}).enable,!0);a.model.ipsec_enable=b},z=function(){return b.post({url:resource_base+"data/ipsec_profiles.json",method:"get_ipsec_profile",error:function(a){Log(ERROR,"siteToSiteCtrl getProfile error, status: "+a.status)}})},B=function(b){b||(b={});b=(b["ipsec-profiles"]||{})["ipsec-profile"]||
[];var c,d,g,e,h;a.model.profiles=[];a.model.profilesMap={};a.model.default_profile="";angular.forEach(b,function(b,k){c=b["keying-mode"]||{};if(e=b["profile-name"]||"")d="auto",g="",h={},b["keying-mode"]&&(c["phase1-options"]?(d="auto",angular.forEach(c["ike-version"],function(a,b){switch(b){case "v1":g="v1";break;default:g="v2"}})):g=d="manual"),h={name:e,mode:d,ike_mode:g},a.model.profiles.push(h),a.model.profilesMap[e]=h,"Default"===e&&(a.model.default_profile=e)});a.model.default_profile||(a.model.default_profile=
a.model.profiles[0]&&a.model.profiles[0].name||"")},D=function(){return b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup",error:function(a){Log(ERROR,"siteToSiteCtrl getIPGroup error, status: "+a.status)}})},E=function(b){b||(b={});var c=[];b["ip-groups"]&&b["ip-groups"]["ip-group"]&&(c=b["ip-groups"]["ip-group"]);a.model.ipGroups=[];angular.forEach(c,function(b){a.model.ipGroups.push(C(b))});a.model.default_ip_group=a.model.ipGroups[0]&&a.model.ipGroups[0].id||""},C=function(a){var b=
{name:a.name,id:a.name,displayName:a.name,list:[]};angular.forEach(a.ips||[],function(a){angular.forEach(a.ipv4,function(a,c){switch(c){case "single":b.list.push(a);break;case "subnet":b.list.push(a.ip+"/"+app.TOOLS.netmask.inet2Int(a.netmask));break;case "range":b.list.push(a.start+" - "+a.end)}});angular.forEach(a.ipv6,function(a,c){switch(c){case "single":b.list.push(a);break;case "subnet":b.list.push(a.ip+"/"+a["prefix-length"]);break;case "range":b.list.push(a.start+" - "+a.end)}})});return b},
I=function(b){b||(b={});b=(b["certs-state"]||{}).cert||[];var c={},d;a.model.certs=[];a.model.default_cert="";angular.forEach(b,function(b,g){if((d=b.name||"")&&!c[d]&&!("imported"!==b.source&&"generated"!==b.source))a.model.certs.push({name:d,index:b.index||"",subject:app.TOOLS.cert2subject(b)}),c[d]=!0,"Default"===d&&(a.model.default_cert=d)});a.model.default_cert||(a.model.default_cert=a.model.certs[0]&&a.model.certs[0].name||"")},G=function(){return b.post({url:resource_base+"data/wan_setting1.json",
method:"get_interface",error:function(a){Log(ERROR,"siteToSiteCtrl getInterface error, status: "+a.status)}})},H=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var c=[],d=[];a.model.ifs=[];b=m.filter(b,{physical:!0,usb:!0,subinterface:!0});angular.forEach(b,function(a){-1!==a.name.indexOf("WAN")&&c.push({name:a.name,ip:"0.0.0.0",netmask:"255.255.255.0"});-1!==a.name.indexOf("USB")&&d.push({name:a.name,ip:"0.0.0.0",netmask:"255.255.255.0"})});a.model.ifs=a.model.ifs.concat(c);a.model.ifs=
a.model.ifs.concat(d)},F=function(a){return b.post({url:resource_base+"data/wan_setting_state.json",method:"get_interface_state",error:function(a){Log(ERROR,"siteToSiteCtrl getInterfaceState error, status: "+a.status)}})},K=function(b){b||(b={});var c=(b["interfaces-state"]||{})["interface"]||[],d={},g,e,h;angular.forEach(a.model.ifs,function(a,b){a.ip="0.0.0.0";a.netmask="255.255.255.0";angular.forEach(c,function(b,c){g=b.name;e=g.match(n.regexpStr.logicalIntf);h=!1;e&&(g=e[1]+e[3],h=!0);a.name===
g&&!d[g]&&(h&&(d[g]=!0),a.ip=b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].ip||"0.0.0.0",b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].netmask?a.netmask=b.ipv4.address[0].netmask:b.ipv4&&(b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0]["prefix-length"])&&(a.netmask=app.TOOLS.netmask.int2Inet(b.ipv4.address[0]["prefix-length"])))})})},M=function(){return b.post({url:resource_base+"data/ipsec_site_to_site_state.json",method:"get_site_to_site_state",error:function(a){Log(ERROR,
"siteToSiteCtrl getSiteToSiteState error, status: "+a.status)}})},N=function(b){b||(b={});b=((b["site-to-site-state"]||{}).connections||{}).connection||[];a.model.connectedTunnel=0;a.model.configTunnel=0;a.model.s2s_state=[];angular.forEach(b,function(b,c){switch(b.status){case "UP":a.model.configTunnel+=1;a.model.connectedTunnel+=1;break;default:a.model.configTunnel+=1}a.model.s2s_state.push({name:v(b.name,""),status:v(b.status,""),number:v(b.number,""),enable:v(b.enable,!1),auth:v(b.auth,""),local_group:v(b["local-group"],
""),remote_group:v(b["remote-group"],""),remote_gateway:v(b["remote-gateway"],""),ipsec_profile:v(b["ipsec-profile"],""),wan_interface:v(b["wan-interface"],""),ike_sa_time:v(b["ike-sa-time"],""),ipsec_sa_time:v(b["ipsec-sa-time"],""),tx_bytes:v(b["tx-bytes"],""),rx_bytes:v(b["rx-bytes"],""),tx_bytes:v(b["tx-packets"],""),rx_bytes:v(b["rx-packets"],"")})});V()},J=function(){return b.post({url:resource_base+"data/get_subnet.json",method:"get_subnet",error:function(a){Log(ERROR,"[S2S][getSubnetData] "+
JSON.stringify(a))}})},R=function(b){b.subnets&&b.subnets.ipv4&&(a.subnetObj=angular.copy(b.subnets))},W=function(){return b.post({url:resource_base+"data/nacm_group.json",method:"get_groups",error:function(a){S()}})},S=function(b){b||(b={});b=b.groups&&b.groups.group||[];var c;a.model.auth_groups=[];a.model.vpn2gruop={};a.model.orig_groups=angular.copy(b);angular.forEach(b,function(b){a.model.auth_groups.push(b.name);c={};angular.forEach(b["feature-rule"],function(a){"s2s-vpn"===a.service&&(c=a)});
angular.forEach(c.option,function(c){a.model.vpn2gruop[c]||(a.model.vpn2gruop[c]={});a.model.vpn2gruop[c][b.name]=!0})})},X=function(){angular.forEach(a.model.s2s,function(b){a.model.vpn2gruop[b.connection_name]&&(b.selected_groups=angular.copy(a.model.vpn2gruop[b.connection_name]))})},T=function(){var b=function(b){var c={};angular.forEach(a.model.greInterfaces,function(a){a.id===b&&(c=a)});return c},c,d=a.edit;angular.forEach(a.model.s2s,function(a){"gre"===a.remote_group.group.type&&(c=b(a.remote_group.group.gre_interface),
a.local_group.group.gre_ip=c.src_ip,a.remote_group.group.gre_ip=c.dest_ip)});d&&"gre"===d.local_group.group.type&&(c=b(d.remote_group.group.gre_interface),c.src_ip&&(d.local_group.group.gre_ip=c.src_ip,d.remote_endpoint.type="static-ip",d.remote_endpoint.ip=c.dest_ip),c.dest_ip&&(d.remote_group.group.gre_ip=c.dest_ip))},L=function(){var b=a.edit;if(b){var c=[],d;angular.forEach(a.model.auth_groups,function(a){b.selected_groups[a]||c.push({id:a,displayName:a})});b.grid_group_data=[];angular.forEach(b.selected_groups,
function(a,g){d=[{id:g,displayName:g}];d=d.concat(c);b.grid_group_data.push({checked:!1,edit:!1,group:{select:g,list:d}})});a.disable_add_user_group=c.length?!1:!0;a.gridS2SGroup.data=b.grid_group_data}},U=function(){var b=a.edit;if(b){var c=[],d;b.selected_groups={};angular.forEach(b.grid_group_data,function(a){b.selected_groups[a.group.select]=!0});angular.forEach(a.model.auth_groups,function(a){b.selected_groups[a]||c.push({id:a,displayName:a})});angular.forEach(b.grid_group_data,function(a){d=
[{id:a.group.select,displayName:a.group.select}];d=d.concat(c);a.group.list=d});a.disable_add_user_group=c.length?!1:!0}},V=function(){var b=function(b){var c,d=void 0;angular.forEach(a.model.ipGroups,function(a){a.id===b&&(c=a)});c&&(d="<div>",angular.forEach(c.list,function(a){d=d+"<div>"+a+"</div>"}),d+="</div>");return d},c,d;a.model.s2s_table=[];angular.forEach(a.model.s2s,function(g,e){c={checked:!1,idx:e,type:"s2s",action:[],name:g.connection_name,remote_gateway:"-",wan_interface:"-",ipsec_profile:"-",
status:"DOWN",local_group:{group:"-",tip:void 0},remote_group:{group:"-",tip:void 0}};angular.forEach(a.model.s2s_state,function(a,b){a.name===g.connection_name&&(angular.extend(c,{name:a.name,remote_gateway:a.remote_gateway||"-",wan_interface:a.wan_interface||"-",ipsec_profile:a.ipsec_profile||"-",status:a.status||"DOWN"}),c.local_group.group=a.local_group||"-",c.remote_group.group=a.remote_group||"-")});switch(g.local_group.group.type){case "any":c.local_group.group="0.0.0.0/0";break;case "ip-group":c.local_group.tip=
b(c.local_group.group)}switch(g.remote_group.group.type){case "any":c.remote_group.group="0.0.0.0/0";break;case "ip-group":c.remote_group.tip=b(c.remote_group.group)}c.action=[];d=a.model.profilesMap[g.ipsec_profile]||{};"UP"===c.status?c.action.push({cbk:a.funs.disconnect,className:"icon-disconnect",displayName:a.DICT("Site_to_Site_Disconnect"),disabled:"manual"===d.mode||!g.enable}):c.action.push({cbk:a.funs.connect,className:"icon-connect",displayName:a.DICT("Site_to_Site_Connect"),disabled:"manual"===
d.mode||!g.enable});a.model.s2s_table.push(c)});a.gridSite2SiteOptions.data=a.model.s2s_table;setTimeout(function(){a.gridSite2SiteOptions&&(a.gridSite2SiteOptions.gridApi&&a.gridSite2SiteOptions.gridApi.customApi&&a.gridSite2SiteOptions.gridApi.customApi.checkSelectStatus)&&a.gridSite2SiteOptions.gridApi.customApi.checkSelectStatus()},50)},P=function(){b.post({method:"get_all_cert",procBackground:!0,url:resource_base+"data/get_all_cert.json",success:function(b){b=b&&b.data&&b.data.result||{};I(b);
O(b);a.certReady=!0;Q()},error:function(b){Log(ERROR,"[S2S] get_all_cert error "+JSON.stringify(b));I();O();a.certReady=!0;Q()}})},O=function(b){b||(b={});var c=[],d,g={};b["certs-state"]&&b["certs-state"].cert&&(c=b["certs-state"].cert);a.model.ca_certs=[];angular.forEach(c,function(b){b.info&&b.info["is-ca-enabled"]&&(d={name:b.name||"",displayName:b.name||""},d.name&&!g[d.name]&&(g[d.name]=!0,a.model.ca_certs.push(d)))});a.model.default_ca_cert=a.model.ca_certs[0]&&a.model.ca_certs[0].name||""},
Q=function(){if(a.edit&&a.certReady){var b=a.edit;b.local_authentication.certificate||(b.local_authentication.certificate=a.model.default_cert);b.remote_authentication.certificate||(b.remote_authentication.certificate=a.model.default_ca_cert);b.symm_authentication.certificate||(b.symm_authentication.certificate=a.model.default_cert);b.symm_authentication.remote_certificate||(b.symm_authentication.remote_certificate=a.model.default_ca_cert);a.checkASN1DNCert();a.waitForCert=!1}},Y=function(){w.all([W(),
F(),M(),s(),h(),J()]).then(function(b){S(b[0].data&&b[0].data.result||{});K(b[1].data&&b[1].data.result||{});N(b[2].data&&b[2].data.result||{});k(b[3].data&&b[3].data.result||{});g(b[4].data&&b[4].data.result||{});R(b[5].data&&b[5].data.result||{});X();T();V();a.model.dels=[];a.edit=void 0})},aa=function(a){a||(a={});return{ip:a.ip||"",netmask:a.netmask||"",select:!0,edit:!1}},ba=function(){a.model.selects=[];angular.forEach(a.model.s2s_table,function(b,c){b.checked&&a.model.selects.push(b)})},ca=
{main:"ipsec_s2s_main.html",edit:"ipsec_s2s_edit.html",gre_edit:"ipsec_s2s_edit_gre.html"},ea=[{heading:a.DICT("Site_to_Site_Header_Basic"),templateUrl:"ipsec_s2s_edit_basic_setting.html",disabled:!1},{heading:a.DICT("Site_to_Site_Header_Advanced"),templateUrl:"ipsec_s2s_edit_advanced_setting.html",disabled:!0},{heading:a.DICT("Site_to_Site_Header_Failover"),templateUrl:"ipsec_s2s_edit_failover.html",disabled:!1}],da=function(){angular.forEach(a.model.ifs,function(b,c){b.name===a.edit["interface"]&&
(a.edit.local_group.identifier["interface"]=b.ip)})},Z=function(){angular.forEach(a.model.ifs,function(b,c){b.name===a.edit.tunnel_source&&(a.edit.local_group.identifier["interface"]=b.ip)})};a.checkEditLocalIntfState=function(){w.all([F()]).then(function(a){a[0].data&&a[0].data.result?K(a[0].data.result):K();da()})};a.checkEditLocalState=function(){w.all([F()]).then(function(a){a[0].data&&a[0].data.result?K(a[0].data.result):K();Z()})};a.tip={failover_waring:""};a.ipsecprofile_note=a.DICT("Site_to_Site_Ipsec_Profile_Note",
{"%s":"<a ng-click=\"jumpToPage('VPN_IPsec_Profiles')\">"+a.DICT("here")+"</a>"});a.success=!1;a.errForGroups=!1;a.model={ipsec_enable:!0,maxTunnel:0,connectedTunnel:0,configTunnel:0,selects:[],s2s_state:[],s2s_table:[],schema:{},profiles:[],profilesMap:{},profileInfo:"",certs:[],ca_certs:[],dels:[],ifs:[],s2s:[],greFullConfigName:"",default_profile:"",default_ip_group:"",default_cert:"",default_ca_cert:"",default_gre:"",auth_groups:[],vpn2gruop:{},orig_groups:[],ipGroups:[],greInterfaces:[],rule_list:[],
groups:[],connections:[],disable_failover:!1,show_local_ipgroup_note:!1,show_remote_ipgroup_note:!1,local_is_ipgroup:!1,remote_is_ipgroup:!1,tabUrl:"ipsec_s2s_edit_basic_setting.html"};a.tabs=[];a.edit=void 0;a.orig={};a.edit_static_routing=[];a.currPage=ca.main;a.dataReady=!1;a.certReady=!1;a.waitForCert=!1;a.gridSite2SiteOptions=app.uiGrid.generateGridOptions({IDPreifx:"s2s",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:ba,headerChangedCbk:ba},{field:"name",displayName:a.DICT("Site_to_Site_Connect_Name")},
{field:"remote_gateway",displayName:a.DICT("Site_to_Site_Remote_Endp")},{field:"wan_interface",displayName:a.DICT("Site_to_Site_Intf")},{field:"ipsec_profile",displayName:a.DICT("Site_to_Site_IPsec_Prof")},{field:"local_group",width:170,displayName:a.DICT("Site_to_Site_Local_Traffic_Selection"),cellTemplate:"s2s_group.html"},{field:"remote_group",width:185,displayName:a.DICT("Site_to_Site_Remote_Traffic_Selection"),cellTemplate:"s2s_group.html"},{field:"status",width:100,displayName:a.DICT("Site_to_Site_Status")},
{field:"action",minWidth:265,displayName:a.DICT("Site_to_Site_Actions"),cellTemplate:"UG_table_icons.html"}]});a.staticRoutingSelect=[];a.procStaticRoutingClick=function(){a.staticRoutingSelect=[];angular.forEach(a.edit.static_routing.networks,function(b,c){b.select?a.staticRoutingSelect.push(c):b.edit=!1})};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridStaticRoutingOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"select",isCheckbox:!0,changedCbk:a.procStaticRoutingClick,
headerChangedCbk:a.procStaticRoutingClick,disableChkBoxField:"disableChk"},{field:"ip",displayName:a.DICT("Site_to_Site_IP_Addr"),editRow:"edit",required:!0,id:"grestaticroutingip",validationCbk:"gridInvalidCbk",cellTemplate:u.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ng-ipv4-ip=\"grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split'\" check-ipv4-bymask=\"(grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split') ? row['entity']['netmask'] : undefined\"  \"").replace(/ng-required/,
"ng-required=\"grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split'\" ")},{field:"netmask",displayName:a.DICT("Site_to_Site_Netmask"),editRow:"edit",required:!0,id:"grestaticroutingnetmask",validationCbk:"gridInvalidCbk",cellTemplate:u.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ng-ipv4-netmask=\"grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split'\" check-mask-byipv4=\"(grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split') ? row['entity']['ip'] : undefined\"  \"").replace(/ng-required/,
"ng-required=\"grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split'\" ")}]});var ga=function(){return 50<=a.model.s2s_table.length?(a.msg="Only allow maximum of 50 entries for Site to Site. (Current Entry Number: "+a.model.s2s_table.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.procNgClick=function(b){var c=a.edit;c&&(c.grid_group_checked=[],angular.forEach(c.grid_group_data,function(a){a.checked?c.grid_group_checked.push(a):
a.edit=!1}),a.disable_del_user_group=c.grid_group_checked.length?!1:!0)};a.gridS2SGroup=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.procNgClick,headerChangedCbk:a.procNgClick},{field:"group",displayName:a.DICT("Site_to_Site_Group_Name"),minWidth:300,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html",change:U},{field:"empty",isEmpty:!0}]});var fa=function(){var b=a.edit,c;b&&(c="create"===b.editType,b.symm_authentication.enable_show_key_in_plain=
"ike"!==b.symm_authentication.method||c,b.local_authentication.enable_show_key_in_plain="ike"!==b.local_authentication.method||c,b.remote_authentication.enable_show_key_in_plain="ike"!==b.remote_authentication.method||c)};a.funs={edit:function(){var b,c;a.orig={};angular.forEach(a.model.s2s_table,function(a,c){a.checked&&(b=a.name)});angular.forEach(a.model.s2s,function(a){a.connection_name===b&&(c=a)});void 0===c?Log(ERROR,"[S2S][edit] Error no search s2s rule"):(a.tabs=angular.copy(ea),a.model.tabUrl=
"ipsec_s2s_edit_basic_setting.html",a.edit={},a.edit=angular.copy(c),a.orig=angular.copy(c),a.change_identifier_list(),a.change_ipsec_profile(),a.change_ip_type(),a.edit.editType="edit",fa(),a.edit.origUserPassword=a.edit.extended_authentication.password,L(),da(),a.check_groups(),a.currPage=ca.edit)},del:function(){var b,c;angular.forEach(a.model.s2s_table,function(d){if(d.checked){c=a.model.s2s;for(b=c.length-1;0<=b;b--)c[b].connection_name===d.name&&(a.model.dels.push(c[b]),c.splice(b,1))}});V();
ba();a.modified()},connect:function(a,c){b.post({method:"action",params:{input:{"connection-name":c.entity.name},rpc:"s2s-connect"},success:function(a){Y()},error:function(a){Log(ERROR,"siteToSiteCtrl connect RPC error : "+a.state);Y()}})},disconnect:function(a,c){b.post({method:"action",params:{input:{"connection-name":c.entity.name},rpc:"s2s-disconnect"},success:function(a){Y()},error:function(a){Log(ERROR,"siteToSiteCtrl disconnect RPC error : "+a.state);Y()}})},createS2S:function(){ga()||(a.disable_del_user_group=
!0,a.edit={},a.edit=d(),a.edit.editType="create",a.change_identifier_list(),a.change_ipsec_profile(),a.change_ip_type(),a.check_groups(),da(),L(),fa(),a.tabs=angular.copy(ea),a.model.tabUrl="ipsec_s2s_edit_basic_setting.html",a.currPage=ca.edit,a.modified())},save:function(d){var g=[];d=function(b){var c={},d=[],e="",d=!1;if(a.edit)"edit"===a.edit.editType?(e=a.edit.connection_name,b||(d=!0)):d=!0;else if(!b)return;angular.forEach(a.model.auth_groups,function(a){c[a]=[]});angular.forEach(a.model.s2s,
function(a){e!==a.connection_name&&angular.forEach(a.selected_groups,function(b,d){c[d].push(a.connection_name)})});d&&angular.forEach(a.edit.selected_groups,function(b,d){c[d].push(a.edit.connection_name)});d=angular.copy(a.model.orig_groups);angular.forEach(d,function(a){c[a.name]?angular.forEach(a["feature-rule"],function(b){"s2s-vpn"===b.service&&(b.option=c[a.name])}):Log(ERROR,"[S2S][genGroupSet] got error for groups, group name "+a.name+" is not exist")});g.push({method:"set_groups",params:{groups:{group:d}}})};
d(!0);(function(){var b=[];a.model.dels.length&&(angular.forEach(a.model.dels,function(a){"s2s"===a.type&&b.push({"connection-name":a.connection_name})}),b.length&&g.push({method:"del_site_to_site",params:{"site-to-sites":{"site-to-site":b}}}))})();a.edit&&g.push({method:"set_site_to_site",params:{"site-to-sites":{"site-to-site":[c(a.edit)]}}});d(!1);b.post({method:"set_bulk",forcedUsingPost:!0,params:g,success:function(){a.success=!0;a.currPage=ca.main;Y()},error:function(){a.success=!0;a.currPage=
ca.main;Y()}});a.resetModified()},cancel:function(b){"edit"===b&&(a.currPage=ca.main);Y();a.resetModified()},action:function(a){return function(a){}},getActionName:function(a){var b="Connect";switch(a){case "Connected":b="Disconnect"}return b},getActionEnabled:function(a){var b=!1;switch(a){case "Disable":b=!0}return b},clickTab:function(b){var c=a.model.profilesMap[a.edit.ipsec_profile]||{},d=a.edit;a.tip.failover_waring="";a.model.disable_failover=!1;if("manual"===c.mode||!d.keepalive.enable||"gre"===
d.local_group.group.type||"gre"===d.remote_group.group.type){a.model.disable_failover=!0;a.tip.failover_waring=a.DICT("Site_to_Site_Failover_Waring")+"<ul>";"manual"===c.mode&&(a.tip.failover_waring=a.tip.failover_waring+"<li>"+a.DICT("Site_to_Site_Failover_Waring_For_IPSec_Profile",{"%s":'<a ng-click="funs.clickTab(tabs[0])">'+a.DICT("Site_to_Site_Header_Basic")+"</a>"})+"</li>");d.keepalive.enable||(a.tip.failover_waring=a.tip.failover_waring+"<li>"+a.DICT("Site_to_Site_Failover_Waring_For_Keep_Alive",
{"%s":'<a ng-click="funs.clickTab(tabs[1])">'+a.DICT("Site_to_Site_Header_Advanced")+"</a>"})+"</li>");if("gre"===d.local_group.group.type||"gre"===d.remote_group.group.type)a.tip.failover_waring=a.tip.failover_waring+"<li>"+a.DICT("Site_to_Site_Failover_Waring_For_GRE_Interface",{"%s":'<a ng-click="funs.clickTab(tabs[0])">'+a.DICT("Site_to_Site_Header_Basic")+"</a>"})+"</li>";a.tip.failover_waring+="</ul>"}a.model.tabUrl=b.templateUrl;app.TOOLS.apply(a)},static_routing:{add:function(){var b=aa();
b.edit=!0;a.edit.static_routing.networks.push(b);setTimeout(function(){a.procStaticRoutingClick()},50)},edit:function(){angular.forEach(a.edit.static_routing.networks,function(b,c){b.select&&(a.edit.static_routing.networks[c].edit=!0)})},del:function(){for(var b=a.edit.static_routing.networks.length-1;0<=b;b--)a.edit.static_routing.networks[b].select&&a.edit.static_routing.networks.splice(b,1);a.procStaticRoutingClick()}},addS2SGroup:function(){var b=a.edit,c="";angular.forEach(a.model.auth_groups,
function(a){c||b.selected_groups[a]||(c=a)});b.grid_group_data.push({checked:!0,edit:!0,empty:"",group:{select:c,list:[]}});U();a.procNgClick();a.check_groups()},delS2SGroup:function(){var b=a.edit;if(b){var b=b.grid_group_data,c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);U();a.procNgClick();a.check_groups()}},editS2SGroup:function(){angular.forEach(a.edit.grid_group_data,function(a){a.checked&&(a.edit=!0)})}};a.checkConnName=function(){var b=!1;!a.edit||!a.edit.connection_name?(a.s2sform.cname.$setValidity("special",
!0),a.s2sform.cname.$setValidity("overlength",!0),a.s2sform.cname.$setValidity("repeat_name",!0)):64>=a.edit.connection_name.length?(a.s2sform.cname.$setValidity("overlength",!0),a.edit.connection_name.match(/^\w+$/)?a.s2sform.cname.$setValidity("special",!0):a.s2sform.cname.$setValidity("special",!1),angular.forEach(a.model.s2s,function(c){c.connection_name===a.edit.connection_name&&(b=!0)}),b?a.s2sform.cname.$setValidity("repeat_name",!1):a.s2sform.cname.$setValidity("repeat_name",!0)):a.s2sform.cname.$setValidity("overlength",
!1)};a.checkInterfaceName=function(){var b=!1;!a.edit||!a.edit.connection_name?(a.s2sform.ifname.$setValidity("special",!0),a.s2sform.ifname.$setValidity("overlength",!0),a.s2sform.ifname.$setValidity("repeat_name",!0)):32>=a.edit.connection_name.length?(a.s2sform.ifname.$setValidity("overlength",!0),a.edit.connection_name.match(/^\w+$/)?a.s2sform.ifname.$setValidity("special",!0):a.s2sform.ifname.$setValidity("special",!1),angular.forEach(a.model.s2s,function(c){c.connection_name===a.edit.connection_name&&
(b=!0)}),b?a.s2sform.ifname.$setValidity("repeat_name",!1):a.s2sform.ifname.$setValidity("repeat_name",!0)):a.s2sform.ifname.$setValidity("overlength",!1)};a.change_tunnel_method=function(){a.edit.display_connection_name="";"dynamic-ip"===a.edit.tunnel_destination.type?a.edit.display_connection_name="Tunnel to Dynamic IP":"static-ip"===a.edit.tunnel_destination.type&&a.edit.tunnel_destination.ip?a.edit.display_connection_name="Tunnel to "+a.edit.tunnel_destination.ip:"fqdn"===a.edit.tunnel_destination.type&&
a.edit.tunnel_destination.fqdn&&(a.edit.display_connection_name="Tunnel to "+a.edit.tunnel_destination.fqdn)};a.change_ipsec_profile_gre=function(){a.edit.ike_mode="manual"===(a.model.profilesMap[a.edit.ipsec_profile]||{}).mode?"manual":"v1"};a.change_ipsec_profile=function(){var b=a.model.profilesMap[a.edit.ipsec_profile]||{};"manual"===b.mode?(a.edit.remote_endpoint.type="static-ip",a.edit.ike_mode="manual",a.model.schema.remote_endpoint=[{id:"static-ip",displayName:a.DICT("Site_to_Site_Static_IP")}]):
(a.edit.ike_mode=b.ike_mode||"v2",a.model.schema.remote_endpoint=[{id:"static-ip",displayName:a.DICT("Site_to_Site_Static_IP")},{id:"fqdn",displayName:a.DICT("Site_to_Site_FQDN")},{id:"dynamic-ip",displayName:a.DICT("Client_to_Site_Dynamic_IP")}]);switch(a.edit.ike_mode){case "manual":a.model.profileInfo=a.DICT("Site_to_Site_Manual_Profile_Chosen");break;case "v1":a.model.profileInfo=a.DICT("Site_to_Site_IKEv1_Profile_Chosen");break;default:a.model.profileInfo=a.DICT("Site_to_Site_IKEv2_Profile_Chosen")}a.change_identifier_list()};
a.change_identifier_list=function(){var b=a.edit,c=!1,d=function(b){b?(a.model.schema.local_identifier=[{id:"interface",displayName:a.DICT("Site_to_Site_Local_WAN_IP")},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Address")},{id:"fqdn",displayName:a.DICT("Site_to_Site_Local_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Local_User_FQDN")}],"der-asn1-dn"===a.edit.local_group.identifier.type&&(a.edit.local_group.identifier.type=a.model.schema.local_identifier[0].id)):a.model.schema.local_identifier=
[{id:"interface",displayName:a.DICT("Site_to_Site_Local_WAN_IP")},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Address")},{id:"fqdn",displayName:a.DICT("Site_to_Site_Local_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Local_User_FQDN")},{id:"der-asn1-dn",displayName:a.DICT("Site_to_Site_ASN1DN")}]},g=function(b){b?(a.model.schema.remote_identifier=[{id:"ip",displayName:a.DICT("Site_to_Site_Remote_WAN_IP")},{id:"fqdn",displayName:a.DICT("Site_to_Site_Remote_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Remote_User_FQDN")}],
"der-asn1-dn"===a.edit.remote_group.identifier.type&&(a.edit.remote_group.identifier.type=a.model.schema.remote_identifier[0].id)):a.model.schema.remote_identifier=[{id:"ip",displayName:a.DICT("Site_to_Site_Remote_WAN_IP")},{id:"fqdn",displayName:a.DICT("Site_to_Site_Remote_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Remote_User_FQDN")},{id:"der-asn1-dn",displayName:a.DICT("Site_to_Site_ASN1DN")}]};if(b){Q();switch(b.ike_mode){case "manual":case "v1":c="ike"===b.symm_authentication.method?
!0:!1;break;default:c="ike"===b.local_authentication.method?!0:!1}c?(d(!0),g(!0)):(d(!1),g(!1),a.certReady||(a.waitForCert=!0));a.checkASN1DNCert()}};a.change_ip_type=function(){var b=a.edit,c=a.model.greInterfaces.length?!1:!0;a.model.schema.local_ip_type=[{id:"subnet",displayName:a.DICT("Site_to_Site_Subnet"),disable:!1},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Address"),disable:!1},{id:"ip-group",displayName:a.DICT("Site_to_Site_IP_Group"),disable:0===a.model.ipGroups.length},{id:"gre",displayName:a.DICT("Site_to_Site_Gre_Interface"),
disable:c}];a.model.schema.remote_ip_type=[{id:"subnet",displayName:a.DICT("Site_to_Site_Subnet"),disable:!1},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Address"),disable:!1},{id:"ip-group",displayName:a.DICT("Site_to_Site_IP_Group"),disable:0===a.model.ipGroups.length}];b&&("any"!==b.local_group.group.type&&"any"!==b.remote_group.group.type?(a.model.schema.local_ip_type.push({id:"any",displayName:a.DICT("Client_to_Site_Any")}),a.model.schema.remote_ip_type.push({id:"any",displayName:a.DICT("Client_to_Site_Any")})):
"any"===b.local_group.group.type?a.model.schema.local_ip_type.push({id:"any",displayName:a.DICT("Client_to_Site_Any")}):"any"===b.remote_group.group.type&&a.model.schema.remote_ip_type.push({id:"any",displayName:a.DICT("Client_to_Site_Any")}),"gre"===b.local_group.group.type?(a.model.schema.remote_ip_type=[{id:"gre",displayName:a.DICT("Site_to_Site_Gre_Interface"),disable:!1}],b.remote_group.group.type="gre",T()):"gre"===b.remote_group.group.type&&(b.remote_group.group.type=a.model.schema.remote_ip_type[0].id),
"ip-group"===b.local_group.group.type?a.model.local_is_ipgroup||(a.model.local_is_ipgroup=!0,a.model.show_local_ipgroup_note=!0,setTimeout(function(){a.model.show_local_ipgroup_note=!1;app.TOOLS.apply(a)},3E3)):a.model.local_is_ipgroup=!1,"ip-group"===b.remote_group.group.type?a.model.remote_is_ipgroup||(a.model.remote_is_ipgroup=!0,a.model.show_remote_ipgroup_note=!0,setTimeout(function(){a.model.show_remote_ipgroup_note=!1;app.TOOLS.apply(a)},3E3)):a.model.remote_is_ipgroup=!1)};a.change_pwd=function(b){var c=
a.edit;switch(b){case "symm":c.symm_authentication.enable_show_key_in_plain=!0;break;case "local":c.local_authentication.enable_show_key_in_plain=!0;break;case "remote":c.remote_authentication.enable_show_key_in_plain=!0}};a.checkASN1DNCert=function(){var b=a.edit,c=function(b){var c="";angular.forEach(a.model.certs,function(a){a.name===b&&(c=a.subject)});return c};if(b)switch(b.ike_mode){case "v1":case "manual":"cert"===b.symm_authentication.method&&(b.local_group.identifier.asn1dn=c(b.symm_authentication.certificate));
break;default:"cert"===b.local_authentication.method&&(b.local_group.identifier.asn1dn=c(b.local_authentication.certificate))}};a.check_groups=function(){a.errForGroups=!a.edit.extended_authentication.enable||"group"!==a.edit.extended_authentication.type?!1:0>=a.edit.grid_group_data.length?!0:!1};a.change_gre_interface=function(){var b=a.edit;b&&(b.remote_group.group.gre_interface=b.local_group.group.gre_interface,T())};a.checkCombineUnique=function(){a.isErr=!1;var b=a.edit.remote_endpoint.type,
c="",d=a.edit.local_group.identifier.type,g="",e=a.edit.remote_group.identifier.type,h="",k="",l="";if(void 0===c||void 0===g||void 0===h)a.isErr=!1;else{l=a.edit["interface"]+"#";"static-ip"===b?c=a.edit.remote_endpoint.ip:"fqdn"===b?c=a.edit.remote_endpoint.fqdn:"dynamic-ip"===b&&(c="dynamic-ip");"interface"===d?g="0.0.0.0":"ip"===d?g=a.edit.local_group.identifier.ip:"fqdn"===d?g=a.edit.local_group.identifier.fqdn:"user-fqdn"===d?g=a.edit.local_group.identifier.user_fqdn:"der-asn1-dn"===d&&(g="any");
l=l+b+"#"+c+"#"+d+"#"+g+"#";"ip"===e?h=a.edit.remote_group.identifier.ip:"fqdn"===e?h=a.edit.remote_group.identifier.fqdn:"user-fqdn"===e?h=a.edit.remote_group.identifier.user_fqdn:"der-asn1-dn"===e&&(h=void 0===a.edit.remote_group.identifier.asn1dn||""===a.edit.remote_group.identifier.asn1dn?"any":a.edit.remote_group.identifier.asn1dn);l=l+e+"#"+h;for(b=0;b<a.model.s2s.length;b++)if(k="",a.model.s2s[b].connection_name!==a.edit.connection_name&&(k=a.model.s2s[b]["interface"]+"#","static-ip"===a.model.s2s[b].remote_endpoint.type?
k=k+a.model.s2s[b].remote_endpoint.type+"#"+a.model.s2s[b].remote_endpoint.ip:"fqdn"===a.model.s2s[b].remote_endpoint.type?k=k+a.model.s2s[b].remote_endpoint.type+"#"+a.model.s2s[b].remote_endpoint.fqdn:"dynamic-ip"===a.model.s2s[b].remote_endpoint.type&&(k=k+a.model.s2s[b].remote_endpoint.type+"#dynamic-ip"),k+="#","interface"===a.model.s2s[b].local_group.identifier.type?k=k+a.model.s2s[b].local_group.identifier.type+"#0.0.0.0":"ip"===a.model.s2s[b].local_group.identifier.type?k=k+a.model.s2s[b].local_group.identifier.type+
"#"+a.model.s2s[b].local_group.identifier.ip:"fqdn"===a.model.s2s[b].local_group.identifier.type?k=k+a.model.s2s[b].local_group.identifier.type+"#"+a.model.s2s[b].local_group.identifier.fqdn:"user-fqdn"===a.model.s2s[b].local_group.identifier.type?k=k+a.model.s2s[b].local_group.identifier.type+"#"+a.model.s2s[b].local_group.identifier.user_fqdn:"der-asn1-dn"===a.model.s2s[b].local_group.identifier.type&&(k=k+a.model.s2s[b].local_group.identifier.type+"#any"),k+="#","ip"===a.model.s2s[b].remote_group.identifier.type?
k=k+a.model.s2s[b].remote_group.identifier.type+"#"+a.model.s2s[b].remote_group.identifier.ip:"fqdn"===a.model.s2s[b].remote_group.identifier.type?k=k+a.model.s2s[b].remote_group.identifier.type+"#"+a.model.s2s[b].remote_group.identifier.fqdn:"user-fqdn"===a.model.s2s[b].remote_group.identifier.type?k=k+a.model.s2s[b].remote_group.identifier.type+"#"+a.model.s2s[b].remote_group.identifier.user_fqdn:"der-asn1-dn"===a.model.s2s[b].remote_group.identifier.type&&(k=void 0===a.model.s2s[b].remote_group.identifier.asn1dn||
""===a.model.s2s[b].remote_group.identifier.asn1dn?k+a.model.s2s[b].remote_group.identifier.type+"#any":k+a.model.s2s[b].remote_group.identifier.type+"#"+a.model.s2s[b].remote_group.identifier.asn1dn)),k===l){a.repeat_conn=a.model.s2s[b].connection_name;a.isErr=!0;break}}};a.handleSubnetA=function(){return!0};a.handleSubnetB=function(){var b=!0,c=[],d=[],g=[],g=0,e=a.subnetObj.ipv4,d=c="";if(void 0===a.edit.remote_group.group.ip||""===a.edit.remote_group.group.ip||void 0===e)return!0;for(var g=a.edit.remote_group.group.ip.split("."),
g=(parseInt(g[0],10)<<24|parseInt(g[1],10)<<16|parseInt(g[2],10)<<8|parseInt(g[3],10))>>>0,h=0;h<e.length;h++){if("remote_traffic"!==e[h].type&&"remote_traffic"!==e[h].name)if(c=e[h]["range-start"]||"",d=e[h]["range-end"]||"",!1===b)break;else""===c||""===d||void 0===c||void 0===d?b=!0:(c=c.split("."),d=d.split("."),range_startnum=(parseInt(c[0],10)<<24|parseInt(c[1],10)<<16|parseInt(c[2],10)<<8|parseInt(c[3],10))>>>0,range_endnum=(parseInt(d[0],10)<<24|parseInt(d[1],10)<<16|parseInt(d[2],10)<<8|
parseInt(d[3],10))>>>0,g>=range_startnum&&g<=range_endnum&&(b=!1));if(!1===b)break}return b};(function(){var b;a.model.schema={};a.model.schema={remote_endpoint:[{id:"static-ip",displayName:a.DICT("Site_to_Site_Static_IP")},{id:"fqdn",displayName:a.DICT("Site_to_Site_FQDN")}],tunnel_destination:[{id:"static-ip",displayName:a.DICT("Site_to_Site_Static_IP")}],local_identifier:[{id:"interface",displayName:a.DICT("Site_to_Site_Local_WAN_IP")},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Addr")},{id:"fqdn",
displayName:a.DICT("Site_to_Site_Local_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Local_User_FQDN")}],remote_identifier:[{id:"ip",displayName:a.DICT("Site_to_Site_Remote_WAN_IP")},{id:"fqdn",displayName:a.DICT("Site_to_Site_Remote_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Remote_User_FQDN")},{id:"der-asn1-dn",displayName:a.DICT("Site_to_Site_ASN1DN")}],local_ip_type:[{id:"subnet",displayName:a.DICT("Site_to_Site_Subnet")},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Addr")}],
remote_ip_type:[{id:"subnet",displayName:a.DICT("Site_to_Site_Subnet")},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Addr")}],authentication:[{id:"md5",displayName:a.DICT("Site_to_Site_MD5")},{id:"sha1",displayName:a.DICT("Site_to_Site_SHA1")},{id:"sha2-256",displayName:a.DICT("Site_to_Site_SHA2_256")}],encryption:[{id:"esp-3des",displayName:a.DICT("Site_to_Site_3DES")},{id:"esp-aes-128",displayName:a.DICT("Site_to_Site_AES128")},{id:"esp-aes-192",displayName:a.DICT("Site_to_Site_AES192")},{id:"esp-aes-256",
displayName:a.DICT("Site_to_Site_AES256")}],dpdAction:[{id:"clear",displayName:a.DICT("Site_to_Site_Clear")},{id:"restart",displayName:a.DICT("Site_to_Site_Restart")}],staticRouting:[{id:"tunnel_all",displayName:a.DICT("Site_to_Site_Tunnel_All_Traffic")},{id:"tunnel_split",displayName:a.DICT("Site_to_Site_Do_Split_Tunneling")}]};P();app.transition.In();w.all([W(),z(),G(),F(),M(),s(),h(),J(),D(),A()]).then(function(c){S(r(c,0));B(r(c,1));E(r(c,8));H(r(c,2));K(r(c,3));g(r(c,6));N(r(c,4));k(r(c,5));
R(r(c,7));y(r(c,9));X();T();V();a.model.dels=[];a.edit=void 0;var d=t.get("IPSec_S2S");if(d)switch(Log(INFO,"Jump from VPN Status: "+JSON.stringify(d)),d.action){case "edit":b=!1;angular.forEach(a.model.s2s_table,function(a,c){a.name===d.key&&(b=a.checked=!0)});b?a.funs.edit():Log(ERROR,"[S2S][oneTimeLocker] no rule with "+JSON.stringify(d));break;case "add":a.funs.createS2S()}app.transition.Out();a.dataReady=!0})})()}]);app.controller("ssl_vpn_main",["$scope","$q","$log","MyHttp","$timeout","GridRowBasedEditingOper","$templateCache","Sets","wan_service","oneTimeLocker","UserSession","userAccessRight","addressPoolValidate","sslvpn_port_vld",function(a,b,t,m,w,u,p,q,e,x,n,l,r,v){a.model=a.model||{};a.ctx=a.ctx||{};a.loadReady=!1;a.success=!1;a.subnetObj={};a.vlanIp="";a.userAccessFlag=l.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var s=function(){var e=m.post({url:resource_base+"data/sslvpn.json",
method:"get_sslvpn",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),l=m.post({url:resource_base+"data/sslvpn_group.json",method:"get_sslvpn_group",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),n=m.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),p=m.post({url:resource_base+"data/cert2.json",method:"get_cert",
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),r=m.post({url:resource_base+"data/firewall_basic_settings.json",method:"get_firewall_basic_settings",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),q=m.post({url:resource_base+"data/get_subnet.json",method:"get_subnet",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,l,n,p,r,q,v.init()]).then(function(b){a.model={};for(var e=
0;e<b.length;e++)k(b[e]);d(b[5]);c(b[2]);h();a.schema=a.schema||{};a.schema.listClientNetmask=[{id:"255.255.255.0",displayName:"255.255.255.0"},{id:"255.255.255.128",displayName:"255.255.255.128"},{id:"255.255.255.192",displayName:"255.255.255.192"}];a.update_split_network_ctx();a.model_orig=angular.copy(a.model);a.loadReady=!0;a.gridSSLVPNGROUP.Edit=!1;w(function(){g()},100)})};s();a.resetPageVIew=function(b){"overview"==b&&(a.gridSSLVPNGROUP.Edit=!1,m.post({url:resource_base+"data/sslvpn_group.json",
method:"get_sslvpn_group",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(b){(b=b.data.result)&&(b.sslvpn&&b.sslvpn["group-policies"]&&b.sslvpn["group-policies"]["group-policy"])&&(a.model_orig.sslvpn["group-policies"]["group-policy"]=b.sslvpn["group-policies"]["group-policy"])}))};var k=function(b){if(b=b.data){b=b.result;for(var c in b)a.model[c]?q.recover_object(a.model[c],b[c]):angular.extend(a.model,b)}},d=function(b){b.data&&(b.data.result&&
b.data.result.subnets&&b.data.result.subnets.ipv4&&b.data.result.subnets.ipv6)&&(a.subnetObj=angular.copy(b.data.result.subnets))},c=function(b){b||(b={});var c=[];b.data&&(b.data.result&&b.data.result.interfaces&&b.data.result.interfaces["interface"])&&(c=b.data.result.interfaces["interface"]);angular.forEach(c,function(b){"VLAN1"===b.name&&(a.vlanIp=b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].ip||"")})},h=function(){a.use_sslvpn_sample={sslvpn:{enable:!1,"interface":"WAN1","gateway-port":443,
certificate:"Default","address-pool":"",netmask:"255.255.255.0","internal-access":!1,"domain-name":"","login-banner":"","idle-timeout":2100,"session-timeout":0,"client-dpd-timeout":300,"gateway-dpd-timeout":300,"keep-alive":30,"lease-duration":43200,"max-mtu":1406,"retry-interval":3600,"max-session":3,"group-policies":{"group-policy":[]}}};q.recover_object(a.model,a.use_sslvpn_sample);a.use_interface_sample={interfaces:{"interface":[]}};q.recover_object(a.model,a.use_interface_sample);a.use_cert_state_sample=
{"certs-state":{cert:[]}};q.recover_object(a.model,a.use_cert_state_sample);a.use_firewallsettings_sample={firewall:{}};q.recover_object(a.model,a.use_firewallsettings_sample);a.use_group_policy_sample={checked:!1,"split-tunnelling":{"split-network":[],"split-dns":[]}};a.ie_proxy_sample={ip:"",edit:!1,invalid:!1,checked:!1};var b=function(b,c){b[c]&&(q.recover_object(b[c],{"ie-proxy-exception":[]}),angular.forEach(b[c]["ie-proxy-exception"],function(b){q.recover_object(b,a.ie_proxy_sample)}))};a.network_sample=
{checked:!1,edit:!1,invalid:!1,ip:"",netmask:"255.255.255.0"};var c=function(b){b["split-tunnelling"]&&b["split-tunnelling"]["split-network"]&&angular.forEach(b["split-tunnelling"]["split-network"],function(b){q.recover_object(b,a.network_sample)})};a.dns_sample={checked:!1,edit:!1,invalid:!1,domain:""};for(var d=function(b){b["split-tunnelling"]&&b["split-tunnelling"]["split-dns"]&&angular.forEach(b["split-tunnelling"]["split-dns"],function(b){q.recover_object(b,a.dns_sample)})},g=a.model.sslvpn["group-policies"]["group-policy"],
e=g.length-1;0<=e;e--)q.recover_object(g[e],a.use_group_policy_sample),b(g[e],"auto"),b(g[e],"bypass-local"),c(g[e]),d(g[e])},g=function(){a.ctx.sslvpn_tab=a.ctx.sslvpn_tab||[{active:!1},{active:!1}];var b=x.get("SSL_VPN");if(b){Log(DEBUG,"Redirect to: "+JSON.stringify(b));var c=function(){a.ctx.sslvpn_tab[1].active=!0;switch(b.action){case "edit":angular.forEach(a.gridSSLVPNGROUP.Options.data||[],function(c,d){c.entity["policy-name"]===b.key&&(a.gridSSLVPNGROUP.Selections=[c],a.gridSSLVPNGROUP.edit())});
break;case "add":a.gridSSLVPNGROUP.add()}};w(function(){c()},0)}else a.ctx.sslvpn_tab[0].active=!0};a.update_split_network_ctx=function(){for(var b=a.model.sslvpn["group-policies"]["group-policy"],c=b.length;c--;){var d=b[c]["split-tunnelling"];d&&(d._split_type=void 0!=d["include-traffic"]?"include":void 0!=d["exclude-local-lan"]?"exclude":"include")}};a.selected=a.selected||{};a.gridSSLVPNGROUP=a.gridSSLVPNGROUP||{};a.gridIEException=a.gridIEException||{};a.gridSplitNetwork=a.gridSplitNetwork||
{};a.gridSplitDNS=a.gridSplitDNS||{};a.getItemIEType=function(a){var b;a?void 0!==a.none?b="none":void 0!==a.auto?b="auto":void 0!==a["bypass-local"]?b="bypass-local":void 0!==a.disabled&&(b="disabled"):b="disabled";return b};a.save=function(){var b=angular.copy(a.model.sslvpn);(function(a){angular.forEach(a,function(a,b){var c=a.auto,d=a["bypass-local"],g=a["split-tunnelling"];angular.isDefined(a.checked)&&delete a.checked;c&&c["ie-proxy-exception"]&&angular.forEach(c["ie-proxy-exception"],function(a,
b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableIEExceptionChk)&&delete a.disableIEExceptionChk;delete a.edit;delete a.invalid});d&&d["ie-proxy-exception"]&&angular.forEach(d["ie-proxy-exception"],function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableIEExceptionChk)&&delete a.disableIEExceptionChk;delete a.edit;delete a.invalid});g&&g._split_type&&("include"==g._split_type?(g["include-traffic"]=null,void 0!==g["exclude-local-lan"]&&delete g["exclude-local-lan"]):
"exclude"==g._split_type&&void 0!==g["include-traffic"]&&(g["exclude-local-lan"]=g["exclude-local-lan"]||!1,delete g["include-traffic"]),delete g._split_type);g&&g["split-network"]&&angular.forEach(g["split-network"],function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableSplitNetworkChk)&&delete a.disableSplitNetworkChk;delete a.edit;delete a.invalid});g&&g["split-dns"]&&angular.forEach(g["split-dns"],function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableSplitDNSChk)&&
delete a.disableSplitDNSChk;delete a.edit;delete a.invalid});c=a.ie_proxy_path;d=function(b,c){c!=b&&void 0!==a[c]&&delete a[c]};d(c,"none");d(c,"auto");d(c,"bypass-local");d(c,"disabled");"none"==c?a.none=null:"disabled"==c&&(a.disabled=null);a.ie_proxy_path&&delete a.ie_proxy_path})})(b["group-policies"]["group-policy"]);var c=function(){m.post({url:resource_base+"data/sslvpn.json",method:"set_sslvpn",params:{sslvpn:b},success:function(b){!0===a.ctx.sslvpn_tab[1].active&&x.put("SSL_VPN",{action:"overview"});
a.loadReady=!1;s();a.config_saved=!0;a.success=!0},error:function(b){a.loadReady=!1;s();Log(ERROR,"AJAX loading error: "+b.status+", URL: "+b.config.url)}})};(function(){var b=a.model_orig.sslvpn["group-policies"]["group-policy"],d=a.model.sslvpn["group-policies"]["group-policy"],g,e,h=!1,k=[],l,n,p,r={};e=d[a.ctx.ie_index];angular.forEach(b,function(a){a["policy-name"]===e["policy-name"]&&(g=a)});e&&g&&(l=a.ctx.ie_proxy_path,r={"policy-name":e["policy-name"]},n=[],g[l]&&e[l]&&(angular.forEach(g[l]["ie-proxy-exception"],
function(a){p=!1;angular.forEach(e[l]["ie-proxy-exception"],function(b){a.ip===b.ip&&(p=!0)});p||n.push({ip:a.ip})}),n.length&&(r[l]={"ie-proxy-exception":n},h=!0)),n=[],angular.forEach(g["split-tunnelling"]["split-network"],function(a){p=!1;angular.forEach(e["split-tunnelling"]["split-network"],function(b){a.ip===b.ip&&(p=!0)});p||n.push({ip:a.ip})}),n.length&&(r["split-tunnelling"]={"split-network":n},h=!0),n=[],angular.forEach(g["split-tunnelling"]["split-dns"],function(a){p=!1;angular.forEach(e["split-tunnelling"]["split-dns"],
function(b){a.domain===b.domain&&(p=!0)});p||n.push({domain:a.domain})}),n.length&&(r["split-tunnelling"]||(r["split-tunnelling"]={}),r["split-tunnelling"]["split-dns"]=n,h=!0),h&&k.push(r));angular.forEach(b,function(a){p=!1;angular.forEach(d,function(b){a["policy-name"]===b["policy-name"]&&(p=!0)});p||k.push({"policy-name":a["policy-name"]})});k.length?m.post({url:resource_base+"data/sslvpn.json",method:"del_sslvpn",params:{sslvpn:{"group-policies":{"group-policy":k}}},success:function(a){c()},
error:function(a){c();Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}):c()})();a.resetModified()};a.certFileChange=function(){var b=a.model.sslvpn.certificate;a.form.generalform.g_certfile.$setValidity("special",!0);angular.forEach(a.model["certs-state"].cert,function(c,d){c.name==b&&512>=c.info["key-encryption-length"]&&a.form.generalform.g_certfile.$setValidity("special",!1)})};a.cancel=function(){a.loadReady=!1;a.model={};s();a.resetModified()};a.poolValidation=function(){var b=
!0;return void 0===a.model.sslvpn["address-pool"]||void 0===a.model.sslvpn.netmask||""===a.model.sslvpn["address-pool"]||""===a.model.sslvpn.netmask?!0:b=r.poolMaskValidate("sslvpn","sslvpn","ipv4",a.subnetObj,a.model.sslvpn["address-pool"],a.model.sslvpn.netmask)};a.sslvpnEnable=function(b){!1===a.model.sslvpn.enable&&(a.form.generalform.g_gateway_port.$invalid&&(a.model.sslvpn["gateway-port"]=a.model_orig.sslvpn["gateway-port"]),a.form.generalform.g_cli_addr.$invalid&&(a.model.sslvpn["address-pool"]=
a.model_orig.sslvpn["address-pool"]),a.form.generalform.txt_generalclientdomain.$invalid&&(a.model.sslvpn["domain-name"]=a.model_orig.sslvpn["domain-name"]),a.form.generalform.g_login_banner.$invalid&&(a.model.sslvpn["login-banner"]=a.model_orig.sslvpn["login-banner"]),a.form.generalform.g_opt_idle_timeout.$invalid&&(a.model.sslvpn["idle-timeout"]=a.model_orig.sslvpn["idle-timeout"]),a.form.generalform.g_opt_ses_timeout.$invalid&&(a.model.sslvpn["session-timeout"]=a.model_orig.sslvpn["session-timeout"]),
a.form.generalform.g_opt_cli_dpd_timeout.$invalid&&(a.model.sslvpn["client-dpd-timeout"]=a.model_orig.sslvpn["client-dpd-timeout"]),a.form.generalform.g_opt_gw_dpd_timeout.$invalid&&(a.model.sslvpn["gateway-dpd-timeout"]=a.model_orig.sslvpn["gateway-dpd-timeout"]),a.form.generalform.g_opt_keep_alive.$invalid&&(a.model.sslvpn["keep-alive"]=a.model_orig.sslvpn["keep-alive"]),a.form.generalform.g_opt_lease_dur.$invalid&&(a.model.sslvpn["lease-duration"]=a.model_orig.sslvpn["lease-duration"]),a.form.generalform.g_opt_mtu.$invalid&&
(a.model.sslvpn["max-mtu"]=a.model_orig.sslvpn["max-mtu"]),a.form.generalform.g_opt_retry_interval.$invalid&&(a.model.sslvpn["retry-interval"]=a.model_orig.sslvpn["retry-interval"]),a.certFileChange());a.chkGwPort()};a.chkGwPort=function(){var b;a.form.generalform.g_gateway_port.$setValidity("special",!0);!1!==a.model.sslvpn.enable&&(b=v.check_ssl_port(a.model.sslvpn["gateway-port"]),b.valid||(a.form.generalform.g_gateway_port.$setValidity("special",!1),app.TOOLS.criticalAlertBox({title:a.DICT("Error"),
msg:v.get_err_html(b.err)})))}}]);app.controller("ssl_vpn_general",["$scope","$q","$log","MyHttp","$templateCache","Sets","wan_service",function(a,b,t,m,w,u,p){a.filterWANphy={physical:!0,subinterface:!0,usb:!0};a.ctx.wans_ref=p.filter(a.model.interfaces["interface"],a.filterWANphy);a.ctx.cert_ref=a.model["certs-state"].cert}]);
app.controller("ssl_vpn_group",["$scope","$q","$log","MyHttp","GridRowBasedEditingOper","$templateCache","Sets","wan_service","$timeout",function(a,b,t,m,w,u,p,q,e){var x=function(){var b=a.model.sslvpn["group-policies"]["group-policy"];b[a.ctx.ie_index]&&(b[a.ctx.ie_index][a.ctx.ie_proxy_path]||(b[a.ctx.ie_index][a.ctx.ie_proxy_path]={}),b[a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"]||(b[a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"]=[]),a.gridIEException.Options.data=b[a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"],
a.gridIEException.Selections=[])},n=function(){var b=a.model.sslvpn["group-policies"]["group-policy"];a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]&&(b[a.ctx.ie_index]["split-tunnelling"]||(b[a.ctx.ie_index]["split-tunnelling"]={}),b[a.ctx.ie_index]["split-tunnelling"]["split-network"]||(b[a.ctx.ie_index]["split-tunnelling"]["split-network"]=[]),a.gridSplitNetwork.Options.data=b[a.ctx.ie_index]["split-tunnelling"]["split-network"],a.gridSplitNetwork.Selections=[])},l=function(){var b=
a.model.sslvpn["group-policies"]["group-policy"];b[a.ctx.ie_index]&&(b[a.ctx.ie_index]["split-tunnelling"]||(b[a.ctx.ie_index]["split-tunnelling"]={}),b[a.ctx.ie_index]["split-tunnelling"]["split-dns"]||(b[a.ctx.ie_index]["split-tunnelling"]["split-dns"]=[]),a.gridSplitDNS.Options.data=b[a.ctx.ie_index]["split-tunnelling"]["split-dns"],a.gridSplitDNS.Selections=[])};a.gridSSLVPNGROUP.edit=function(){var b=a.gridSSLVPNGROUP.Selections[0],e=a.model.sslvpn["group-policies"]["group-policy"];a.ctx.ie_index=
e.indexOf(b);a.ctx.ie_type="edit";if(b&&void 0==b.ie_proxy_path){var m=a.getItemIEType(b);a.ctx.ie_proxy_path=m;b.ie_proxy_path=m}x();n();l();a.gpref=e;a.gridSSLVPNGROUP.Edit=!0};a.gridSSLVPNGROUP.remove=function(){var b,e;void 0===a.model.sslvpn||void 0===a.model.sslvpn["group-policies"]||void 0===a.model.sslvpn["group-policies"]["group-policy"]?(b=[],e=0):(b=a.model.sslvpn["group-policies"]["group-policy"],e=b.length);for(e-=1;0<=e;e--)b[e].checked&&b.splice(e,1);a.gridSSLVPNGROUP.procNgClick();
a.modified()};a.update_proxy_type=function(){var b=a.gridSSLVPNGROUP.Selections[0],e=b.ie_proxy_path,m={address:"",port:"","ie-proxy-exception":[]};if(b){switch(e){case "auto":Log(DEBUG,"== auto");void 0==b.auto&&(b.auto={},p.recover_object(b.auto,m));break;case "bypass-local":Log(DEBUG,"== bypass");void 0==b["bypass-local"]&&(b["bypass-local"]={},p.recover_object(b["bypass-local"],m));break;case "disabled":Log(DEBUG,"== disabled");break;case "none":Log(DEBUG,"== none");break;default:Log(DEBUG,"== default")}a.ctx.ie_proxy_path=
e;x();n();l()}};a.display_ie_proxy=function(a){return"auto"==a.ie_proxy_path||"bypass-local"==a.ie_proxy_path};(function(){a.gridSSLVPNGROUP.Selections=[];a.gpref;a.gridSSLVPNGROUP.procNgClick=function(b){a.gridSSLVPNGROUP.Selections=[];angular.forEach(a.model.sslvpn["group-policies"]["group-policy"],function(b,d){b.checked&&a.gridSSLVPNGROUP.Selections.push(b)})};a.gridSSLVPNGROUP.Options=app.uiGrid.generateGridOptions({IDPreifx:"sslVPNGroup",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridSSLVPNGROUP.procNgClick},
{field:"policy-name",displayName:a.DICT("SSL_VPN_Policy_Nm")},{field:"description",displayName:a.DICT("SSL_VPN_Desc")}]});a.gridSSLVPNGROUP.Options.data=a.model.sslvpn["group-policies"]["group-policy"];a.gridSSLVPNGROUP.Selections=[];var b=function(){var b=a.model.sslvpn["group-policies"]["group-policy"];return 10<=b.length?(a.msg=a.DICT("SSL_VPN_Reach_Max_Entry_For_SSL_VPN_Group",{"%d":b.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},m=function(){var b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"];
return 20<=b.length?(a.msg=a.DICT("SSL_VPN_Reach_Max_Entry_For_IE_Proxy",{"%d":b.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},p=function(){var b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"];return 30<=b.length?(a.msg=a.DICT("SSL_VPN_Reach_Max_Entry_For_Split_DNS",{"%d":b.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},k=function(){var b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"];
return 50<=b.length?(a.msg=a.DICT("SSL_VPN_Reach_Max_Entry_For_Split_Network",{"%d":b.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.gridSSLVPNGROUP.add=function(){if(!b()){var d=a.model.sslvpn["group-policies"]["group-policy"],c={"policy-name":"",enable:!1,"primary-dns-server":a.vlanIp||"","secondary-dns-server":"","primary-wins-server":"","secondary-wins-server":"",description:"description",disabled:null,"split-tunnelling":{enable:!1,"include-traffic":null,"split-network":[],
"split-dns":[]}},h;d.push(c);h=d.indexOf(c);a.gpref=d;a.gridSSLVPNGROUP.Edit=!0;e(function(){var b=a.getItemIEType(c);a.ctx.ie_proxy_path=b;c.ie_proxy_path=b;a.update_split_network_ctx();a.ctx.ie_index=h;a.ctx.ie_type="new";a.gridSSLVPNGROUP.Selections.push(c);x();n();l()},0);a.modified()}};a.ctx.ie_index=0;a.ctx.ie_type="new";a.ctx.ie_proxy_path="disabled";a.gridIEException.Selections=[];a.gridIEException.procNgClick=function(b){a.gridIEException.Selections=[];angular.forEach(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"],
function(b,d){b.checked?a.gridIEException.Selections.push(b):b.edit=!1})};a.gridIEExceptionInvalidCbk=function(a){a.row.entity.disableIEExceptionChk=a.rowInvalid};a.chkIEException=function(b,c,e){b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"];var g=b.length;angular.forEach(b,function(a){a.invalid=!1});for(c=0;c<g;c++)for(e=c+1;e<g;e++)b[c].ip===b[e].ip&&(b[c].invalid=!0,b[e].invalid=!0)};a.gridIEException.Options=app.uiGrid.generateGridOptions({IDPreifx:"ieException",
columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridIEException.procNgClick,headerChangedCbk:a.gridIEException.procNgClick,disableChkBoxField:"disableIEExceptionChk"},{field:"ip",displayName:a.DICT("SSL_VPN_IP"),id:"ieExceptionIP",validationCbk:"gridIEExceptionInvalidCbk",cellTemplate:u.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-ip"),editRow:"edit",required:!0,invalidField:"invalid",customVldCbk:"chkIEException"}]});x();a.gridIEException.add=function(){m()||
(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"].push({ip:"",edit:!1,invalid:!1,checked:!1,edit:!0,checked:!0}),a.gridIEException.Options.gridApi.customApi.scrollToLast())};a.gridIEException.edit=function(){angular.forEach(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"],function(a){a.checked&&(a.edit=!0)})};a.gridIEException.remove=function(){var b,c;void 0===a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"]?
(b=[],c=0):(b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"],c=b.length);for(c-=1;0<=c;c--)b[c].checked&&b.splice(c,1);a.gridIEException.procNgClick()};a.gridSplitNetwork.Selections=[];a.splitNetworkIpv4Cbk=function(b){b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"];var c=b.length,e=[],g,k;angular.forEach(b,function(a,b){a.invalid=!1;e[b]=app.TOOLS.validation.ipv4_getNet(a.ip,a.netmask).toString()});
for(g=0;g<c;g++)for(k=g+1;k<c;k++)e[g]===e[k]&&(b[g].invalid=!0,b[k].invalid=!0)};a.gridSplitNetwork.procNgClick=function(b){a.gridSplitNetwork.Selections=[];angular.forEach(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"],function(b,d){b.checked?a.gridSplitNetwork.Selections.push(b):b.edit=!1})};a.gridSplitNetworkInvalidCbk=function(a){a.row.entity.disableSplitNetworkChk=a.rowInvalid};a.gridSplitNetwork.Options=app.uiGrid.generateGridOptions({IDPreifx:"splitNetwork",
columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridSplitNetwork.procNgClick,headerChangedCbk:a.gridSplitNetwork.procNgClick,disableChkBoxField:"disableSplitNetworkChk"},{field:"ip",displayName:a.DICT("SSL_VPN_IP"),id:"splitNetworkIP",validationCbk:"gridSplitNetworkInvalidCbk",cellTemplate:u.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-ip required check-ipv4-bymask=\"row.entity['netmask']\""),customVldCbk:"splitNetworkIpv4Cbk",invalidField:"invalid",editRow:"edit",
required:!0},{field:"netmask",displayName:a.DICT("SSL_VPN_Netmask"),id:"splitNetworkNetmask",validationCbk:"gridSplitNetworkInvalidCbk",cellTemplate:u.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-netmask required check-mask-byipv4=\"row.entity['ip']\""),customVldCbk:"splitNetworkIpv4Cbk",invalidField:"invalid",editRow:"edit",required:!0}]});n();a.gridSplitNetwork.add=function(){var b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"],
c;c={checked:!1,edit:!1,invalid:!1,ip:"",netmask:"255.255.255.0"};k()||(c.edit=!0,c.checked=!0,b.push(c),a.gridSplitNetwork.Options.gridApi.customApi.scrollToLast())};a.gridSplitNetwork.remove=function(){var b,c;void 0===a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"]?(b=[],c=0):(b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"],c=b.length);for(c-=1;0<=c;c--)b[c].checked&&b.splice(c,1);a.gridSplitNetwork.procNgClick()};
a.gridSplitDNS.Selections=[];a.gridSplitDNS.procNgClick=function(b){a.gridSplitDNS.Selections=[];angular.forEach(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"],function(b,d){b.checked?a.gridSplitDNS.Selections.push(b):b.edit=!1})};a.chkSplitDnsFqdn=function(){var b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"],c=b.length,e,g;angular.forEach(b,function(a){a.invalid=!1});for(e=0;e<c;e++)for(g=e+1;g<
c;g++)b[e].domain===b[g].domain&&(b[e].invalid=!0,b[g].invalid=!0)};a.gridSplitDNSInvalidCbk=function(a){a.row.entity.disableSplitDNSChk=a.rowInvalid};a.gridSplitDNS.Options=app.uiGrid.generateGridOptions({IDPreifx:"splitDNS",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridSplitDNS.procNgClick,headerChangedCbk:a.gridSplitDNS.procNgClick,disableChkBoxField:"disableSplitDNSChk"},{field:"domain",displayName:a.DICT("SSL_VPN_Domain"),id:"splitDNSDomain",customVldGroup:"2",validationCbk:"gridSplitDNSInvalidCbk",
cellTemplate:u.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"fqdn required"),required:!0,customVldCbk:"chkSplitDnsFqdn",invalidField:"invalid",editRow:"edit"}]});l();a.gridSplitDNS.add=function(){p()||(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"].push({checked:!1,edit:!1,invalid:!1,domain:"",edit:!0,checked:!0}),a.gridSplitDNS.Options.gridApi.customApi.scrollToLast())};a.gridSplitDNS.edit=function(){angular.forEach(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"],
function(a){a.checked&&(a.edit=!0)})};a.gridSplitDNS.remove=function(){var b,c;void 0===a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"]?(b=[],c=0):(b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"],c=b.length);for(c-=1;0<=c;c--)b[c].checked&&b.splice(c,1);a.gridSplitDNS.procNgClick()}})()}]);app.controller("ipv6TransitionCtrl",["$scope","MyHttp","wan_service","wan_lib","$q","UserSession","userAccessRight","intf_service",function(a,b,t,m,w,u,p,q){a.success=!1;a.dataReady=!1;a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();var e={ip6in4:"ip6in4",ip6rd:"ip6rd"},x=function(a){var b="";angular.forEach(e,function(c,d){c===a&&(b=d)});return b},n=function(){return b.post({method:"get_ipv6_transition",url:resource_base+"data/wan_setting1.json",error:function(a){Log(ERROR,
"ipv6TransitionCtrl getData error Status: "+a.status)}})},l=function(){return b.post({method:"get_interface",url:resource_base+"data/wan_setting1.json",error:function(a){}})},r=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];a.model.tuns=[s({name:"TUN1"},1),s({name:"TUN2"},2)];angular.forEach(b,function(b,c){e[b.type]&&("TUN1"===b.name?a.model.tuns[0]=s(b,1):"TUN2"===b.name&&(a.model.tuns[1]=s(b,2)))});a.gridTunnelOptions.data=a.model.tuns},v=function(b){b||(b={});a.model.intfs=[];var c=
{},d,e,k,l,n,p,r;b=(b.interfaces||{})["interface"]||[];angular.forEach(a.model.intfs_state,function(a){});b=t.filter(b,{physical:!0,logical:!0});var q=RegExp(m.regexpStr.defaultIntf),s=RegExp(m.regexpStr.logicalIntf),u,v=function(a){c[a]||(c[a]={def:void 0,logical:void 0})};angular.forEach(b,function(a,b){d=a.name;if(u=d.match(q))v(d),c[d].def=a;if((u=d.match(s))&&isNaN(parseInt(u[3],10)))v(u[1]),c[u[1]].logical=a});angular.forEach(c,function(b,c){d=b.def.name;n=!1;r="";if(b.logical)switch(r=b.logical.name,
u=r.match(s),u[2]){case "PPTP":p="pptp";break;case "L2TP":p="l2tp";break;case "PPPOE":p="pppoe";break;case "BRIDGE":p="trasparent-bridge";break;default:return}else k=b.def.ipv4||{},l=k.setting||{},l.dynamic?(n=!0,p="dynamic"):p="static";e={id:d,isDHCP:n,displayName:d,logical:r,v4Proto:p};a.model.intfs.push(e)})},s=function(b,c){b||(b={});var d={name:b.name,proto:b.type?e[b.type]:e.ip6in4,description:b.description||"",index:c,enabled:void 0!==b.enabled?b.enabled:!1,use_as_default_route:!1,local_interface:a.model.intfs[0]&&
a.model.intfs[0].id||"",local_interface_is_dhcp:a.model.intfs[0]&&a.model.intfs[0].isDHCP||!0,edit:!1,empty:""},k,l=b.ipv6inipv4||{},m=b.ipv6rd||{};d.localaddr=m.localaddr||"";d.replay_addr=m["replay-addr"];k=m.ip6prefix&&m.ip6prefix.split("/")||["",""];d.ipv6={prefix:k[0],length:void 0!==k[1]?""===k[1]?"":parseInt(k[1],10):""};d.config_mode=m["config-mode"]||a.model.schema.configModeList[0].id;d.ip4prefixlen=void 0!==m.ip4prefixlen?""===m.ip4prefixlen?"":parseInt(m.ip4prefixlen,10):"";d.local_interface_is_dhcp||
(d.config_mode=a.model.schema.configModeList[0].id);d.localaddr=l.localaddr||"";d.peeraddr=l.peeraddr||"";k=l.localipv6prefix&&l.localipv6prefix.split("/")||["",""];d.localIpv6={ip:l.localv6addr||"",length:void 0!==k[1]?""===k[1]?"":parseInt(k[1],10):""};k=l.remoteipv6prefix&&l.remoteipv6prefix.split("/")||["",""];d.peerIpv6={ip:l.peer6addr||"",length:void 0!==k[1]?""===k[1]?"":parseInt(k[1],10):""};m["local-interface"]&&(d.local_interface=m["local-interface"]);l["local-interface"]&&(d.local_interface=
l["local-interface"]);d.action=[{cbk:a.funs.edit,className:"icon-edit",displayName:a.DICT("IPv6_Transition_Edit"),disabled:!1}];d.orig=angular.copy(d);return d},k=function(){q.init();w.all([l(),n(),m.get_wan_state()]).then(function(b){a.model.intfs_state=b[2];v(b[0].data&&b[0].data.result);r(b[1].data&&b[1].data.result);a.dataReady=!0})},d=function(){q.init();w.all([n()]).then(function(a){r(a[0].data&&a[0].data.result)})};a.hasErrCfg=!1;a.nameIsTheSameIdx=-1;a.model={intfs_state:[],intfs:[],tuns:[],
editTun:{},editIdx:-1};a.gridTunnelOptions=app.uiGrid.generateGridOptions({data:a.model.tuns,columnDefs:[{field:"index",width:130,displayName:a.DICT("IPv6_Transition_Tunnel_Number")},{field:"description",minWidth:400,displayName:a.DICT("IPv6_Transition_Description")},{field:"local_interface",width:100,displayName:a.DICT("IPv6_Transition_Interface")},{field:"enabled",width:100,displayName:a.DICT("IPv6_Transition_Enabled"),cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"action",width:80,
displayName:a.DICT("IPv6_Transition_Action"),cellTemplate:"UG_table_icons.html"}]});a.funs={chkIPv6Prefix:function(){!1===app.TOOLS.validation.ipv6_chkPrefixLength(a.model.editTun.ipv6.prefix,a.model.editTun.ipv6.length)?(a.form.ip6rd_ip6prefix.$setValidity("range",!1),a.form.ip6rd_ip6length.$setValidity("range",!1)):(a.form.ip6rd_ip6prefix.$setValidity("range",!0),a.form.ip6rd_ip6length.$setValidity("range",!0))},edit:function(b){a.model.editIdx!==b&&(-1!==a.model.editIdx&&(angular.extend(a.model.tuns[a.model.editIdx],
a.model.editTun),a.model.tuns[a.model.editIdx].action[0].disabled=!1),a.model.tuns[b].action[0].disabled=!0,a.model.editIdx=b,a.model.editTun=angular.copy(a.model.tuns[b]),a.model.editTun.edit=!0,c())},save:function(){var c=[],g=[],e=[],l;angular.extend(a.model.tuns[a.model.editIdx],a.model.editTun);a.model.tuns[a.model.editIdx].action[0].disabled=!1;angular.forEach(a.model.tuns,function(a,b){if(a.edit){var d={name:a.name,type:x(a.proto),description:a.description||"",enabled:a.enabled,ipv6:{setting:{"dhcp-pd-enable":!1}}};
a.orig.name!==a.name?(g.push({name:a.orig.name}),e.push(a.orig.name)):a.enabled||e.push(a.name);switch(a.proto){case "ip6in4":d.ipv6inipv4={"local-interface":a.local_interface,peeraddr:a.peeraddr,localv6addr:a.localIpv6.ip,localipv6prefix:app.TOOLS.ipv6.ipAndMask2IpPrefix(a.localIpv6.ip,a.localIpv6.length),remoteipv6prefix:app.TOOLS.ipv6.ipAndMask2IpPrefix(a.peerIpv6.ip,a.peerIpv6.length),peer6addr:a.peerIpv6.ip};break;case "ip6rd":d.ipv6rd={"local-interface":a.local_interface,"replay-addr":a.replay_addr,
ip6prefix:a.ipv6.prefix+"/"+a.ipv6.length,"config-mode":a.config_mode,ip4prefixlen:isNaN(parseInt(a.ip4prefixlen,10))?"":parseInt(a.ip4prefixlen,10)},l=a.local_interface+"_"+a.name,l=l.toLowerCase(),d.ipv6.setting["dhcp-pd-enable"]=!0,d.ipv6.setting["prefix-name"]=l}c.push(d)}});a.model.editIdx=-1;var m=function(){b.post({method:"set_ipv6_transition",params:{interfaces:{"interface":c}},success:function(b){a.success=!0;d()},error:function(a){d()}})};e.length?q.checkBeforeDel(e,function(a){a?g.length?
b.post({method:"del_ipv6_transition",params:{interfaces:{"interface":g}},success:function(a){m()},error:function(a){m()}}):m():k()}):m();a.resetModified()}};var c=function(){var b=a.model.editTun,c="";b&&b.local_interface&&(angular.forEach(a.model.intfs,function(d){d.id===b.local_interface&&(c=d.logical||d.id,b.local_interface_is_dhcp=d.isDHCP,b.local_interface_is_dhcp||(b.config_mode=a.model.schema.configModeList[0].id))}),b.localaddr="-",angular.forEach(a.model.intfs_state,function(a){c===a.name&&
a.ipv4_ip.length&&(b.localaddr=a.ipv4_ip[0].ip)}))};a.change_name=function(){w.all([m.get_wan_state()]).then(function(b){a.model.intfs_state=b[0];c()});a.hasErrCfg=!1;angular.forEach(a.model.tuns,function(b,c){c!==a.model.editIdx&&b.name===a.model.editTun.name&&(a.nameIsTheSameIdx=c,a.hasErrCfg=!0)})};a.countDiff=function(){var b=a.model.editTun.ip4prefixlen||"0",c=0;if(void 0===a.model.editTun.ip4prefixlen||void 0===a.model.editTun.ipv6.length)return!0;c=parseInt(a.model.editTun.ipv6.length||"0",
10)+32-parseInt(b,10);return 64>=c?!0:!1};a.model.schema={configModeList:[{id:"manual",displayName:a.DICT("IPv6_Transition_Manual")},{id:"auto",displayName:a.DICT("IPv6_Transition_Automatically_From_DHCP")}]};k()}]);app.controller("wan_mobile_main",["$scope","MyHttp","$q","UserSession","userAccessRight",function(a,b,t,m,w){var u=0,p=!1,q=app.TOOLS.getVal;a.destroy=!1;a.success=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.email_server_enable=!1;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var e=function(){return b.post({url:resource_base+"data/mobile_network.json",method:"get_mobile",error:function(a){x()}})},x=function(b){var c=[],d=0;a.model.mobiles=[];b&&(b.interfaces&&b.interfaces["interface"])&&
(c=b.interfaces["interface"]);angular.forEach(c,function(b,c){b.name.match(/^USB\d+$/)&&(a.model.mobiles.push(n(b,d)),d+=1)})},n=function(b,c){var d=b.mobile||{},e=d["network-setup"]||{},g="demand",h=d["bandwidth-cap"]||{};void 0!==e.keepalive&&(g="keepalive");d={id:c,name:b.name||"USB1",enabled:q(b.enabled,!1),is_hilink:!1,need_username_pw:!0,ipv4_gw:"",ipv6_gw:"",mobile:{conn_type:g,demand:q(e["connect-on-demand"],5),keepalive:q(e.keepalive,30),device_name:d["device-name"]||"",card_status:"disconnected",
card_model:"-",configure_mode:"manual"===e["configure-mode"]?"manual":"auto",service_type_changeable:!0,service_type:d["network-mode-preferred"]||a.model.schema.serviceType[0]&&a.model.schema.serviceType[0].id||"",setup:{sim_pin:e["sim-pin"]?"00000000":"",sim_pin_modify:!1},bandwidth_cap:{enable:q(h.enable,!1),monthly_renew_date:h["monthly-renew-date"]||1,monthly_bandwidth_cap:h["monthly-bandwidth-cap"]||"",trigger_email_exceed:{enable:void 0!==h["trigger-email-exceed"]?!0:!1,bandwidth_threshhold:h["trigger-email-exceed"]&&
h["trigger-email-exceed"]["bandwidth-threshhold"]||a.model.schema.bandwidthThreshold[0]&&a.model.schema.bandwidthThreshold[0].id||"50"}}}};"USB1"===d.name&&!d.mobile.device_name?d.mobile.device_name="/dev/modem1":"USB2"===d.name&&!d.mobile.device_name&&(d.mobile.device_name="/dev/modem2");$.extend(d.mobile.setup,l(e));return d},l=function(a,b){a||(a={});return{service_name:a["service-name"]||"",authentication:a.authentication||"none",maxwait:void 0!==a.maxwait?a.maxwait:b?"":20,access_point_name:a["access-point-name"]||
"",dial_number:a["dial-number"]||"",username:a.username||"",password:a.password||"",orig_password:a.password||""}},r=function(b){b||(b={});var c=[];b.output&&b.output.usbs&&(c=b.output.usbs);a.usbs={USB1:!1,USB2:!1};angular.forEach(c,function(b){var c=b.name;if(c&&!0===b.attached)switch(b["usbs-type"]){case "3g":case "4g":a.usbs[c]=!0}})},v=function(){return b.post({url:resource_base+"data/config_email.json",method:"get_email",error:function(a){s()}})},s=function(b){a.email_server_enable=b["email-server"]&&
b["email-server"]["smtp-server"]?!0:!1},k=function(){return b.post({url:resource_base+"data/usb_modem_state.json",method:"get_usb_modem_state",error:function(a){d()}})},d=function(b){b||(b={});var c=[],d,e,g,h,k;b["usb-modems-state"]&&b["usb-modems-state"]["usb-modem"]&&(c=b["usb-modems-state"]["usb-modem"]);a.model.usb_state={};angular.forEach(c,function(b){switch(b["device-name"]){case "/dev/modem1":d="USB1";break;case "/dev/modem2":d="USB2";break;default:return}e={"4G":!1,"3G":!1};angular.forEach(b["network-mode"],
function(a){e[a]=!0});k=b["card-model"]||"-";g=!1;h=!0;switch(k){case "E3372":g=!0;h=!1;break;case "E8372":h=g=!0}a.model.usb_state[d]={is_hilink:g,need_username_pw:h,device_name:b["device-name"]||"",card_model:k,manufacture:b.manufacture||"",firmware_version:b["firmware-version"]||"",sim_status:b["sim-status"]||"",imsi:b.imsi||"",carrier:b.carrier||"",network_mode:e,signal_strength:b["signal-strength"]||"",card_status:b["card-status"]||"disconnected",auto_setup:l(b["auto-setup"],!0)}})},c=function(a){return b.post({url:resource_base+
"data/wan_setting_state.json",procBackground:a&&a.procBackground||!1,isPolling:a&&a.isPolling||void 0,method:"get_interface_state",error:function(a){Log(ERROR,"getInterfaceState error: "+a.status);h()}})},h=function(b){b||(b={});var c=[],d=[],e,g,h;b["interfaces-state"]&&b["interfaces-state"]["interface"]&&(c=b["interfaces-state"]["interface"]);angular.forEach(a.model.mobiles,function(a){a.ipv4_gw="";a.ipv6_gw=""});a.model.interface_state={};angular.forEach(c,function(b){if((g=b.name)&&g.match(/^USB\d+$/))h=
{has_ipv4_ip:!1,ipv4_gw:"",has_ipv6_ip:!1,ipv6_gw:""},d=[],b.ipv4&&(b.ipv4.gateway&&(h.ipv4_gw=b.ipv4.gateway),b.ipv4.address&&(d=b.ipv4.address)),e=!1,angular.forEach(d,function(a){if(a.ip&&("number"===$.type(a["prefix-length"])||a.netmask))e=!0}),h.has_ipv4_ip=e,d=[],b.ipv6&&(b.ipv6.gateway&&(h.ipv6_gw=b.ipv6.gateway),b.ipv4.address&&(d=b.ipv6.address)),e=!1,angular.forEach(d,function(a){a.ip&&("::"!==a.ip&&"number"===$.type(a["prefix-length"]))&&(e=!0)}),h.has_ipv6_ip=e,a.model.interface_state[g]=
h,angular.forEach(a.model.mobiles,function(a){a.name===g&&(a.ipv4_gw=h.ipv4_gw,a.ipv6_gw=h.ipv6_gw)})})},g=function(){var b="connected",c,d;angular.forEach(a.model.mobiles,function(e){e.mobile.service_type_changeable=!0;e.is_hilink=!1;e.need_username_pw=!0;d=e.name;if(a.model.usb_state[d]){c=a.model.usb_state[d];e.mobile.card_model=c.card_model;c.network_mode["4G"]?(e.mobile.service_type_changeable=!1,e.mobile.service_type=a.model.schema.serviceType[0].id):c.network_mode["3G"]&&(e.mobile.service_type_changeable=
!1,e.mobile.service_type=a.model.schema.serviceType[1].id);e.is_hilink=c.is_hilink;e.need_username_pw=c.need_username_pw;b="disconnected";if(a.model.interface_state[d]&&(a.model.interface_state[d].has_ipv4_ip||a.model.interface_state[d].has_ipv6_ip))b="connected";e.mobile.card_status=b}})},A=function(){a.dataReady=!1;t.all([e(),k(),c(),v(),b.post({method:"action",params:{rpc:"usb-check-attached"}})]).then(function(b){x(b[0]&&b[0].data&&b[0].data.result||{});d(b[1]&&b[1].data&&b[1].data.result||{});
h(b[2]&&b[2].data&&b[2].data.result||{});s(b[3]&&b[3].data&&b[3].data.result||{});r(b[4]&&b[4].data&&b[4].data.result||{});g();a.model.mobiles[a.model.selected]||(a.model.selected=0);a.changeIntf(!0);y();a.dataReady=!0;setTimeout(function(){a.chk_service_type()},100)})},y=function(){0!==u&&clearTimeout(u);!p&&app.TOOLS.get_scope("wan_mobile_main")&&(u=setTimeout(function(){u=0;p=!0;t.all([c({procBackground:!0,isPolling:!0})]).then(function(b){var c=a.edit,d=c.name,e="disconnected";h(b[0]&&b[0].data&&
b[0].data.result||{});if(a.model.interface_state[d]&&(a.model.interface_state[d].has_ipv4_ip||a.model.interface_state[d].has_ipv6_ip))e="connected";c.mobile.card_status=e;p=!1;a.destroy||y()})},1E4))},z=function(c){var d=a.model.mobiles[a.model.selected];!("connect"!==c&&"disconnect"!==c)&&d&&b.post({method:"action",params:{rpc:c,input:{"interface":d.name,"ip-version":"v4"}},success:function(a){A()},error:function(a){A()}})};a.usbs={USB1:!1,USB2:!1};a.model={mobiles:[],schema:{},usb_state:{},selected:0};
a.dataReady=!1;a.funs={save:function(){var c=[];angular.forEach(a.model.mobiles,function(b,d){if(d===a.model.selected){var e=b.mobile,g={name:b.name,enabled:!0,mobile:{"network-mode-preferred":e.service_type,"network-setup":{keepalive:"","connect-on-demand":"","configure-mode":e.configure_mode,"access-point-name":e.setup.access_point_name,"service-name":"4G"===e.service_type?"":e.setup.service_name,authentication:e.setup.authentication,maxwait:e.setup.maxwait,"dial-number":"4G"===e.service_type?"":
e.setup.dial_number,username:e.setup.username},"bandwidth-cap":{enable:e.bandwidth_cap.enable,"monthly-renew-date":e.bandwidth_cap.monthly_renew_date,"monthly-bandwidth-cap":e.bandwidth_cap.monthly_bandwidth_cap,"trigger-email-exceed":{"bandwidth-threshhold":""}}},ipv4:{enabled:!0},ipv6:{enabled:!0}};"keepalive"===e.conn_type&&(g.mobile["network-setup"].keepalive=e.keepalive);"demand"===e.conn_type&&(g.mobile["network-setup"]["connect-on-demand"]=e.demand);e.setup.password!==e.setup.orig_password&&
(g.mobile["network-setup"].password=e.setup.password);e.setup.sim_pin_modify&&(g.mobile["network-setup"]["sim-pin"]=e.setup.sim_pin);e.bandwidth_cap.trigger_email_exceed.enable&&(g.mobile["bandwidth-cap"]["trigger-email-exceed"]={"bandwidth-threshhold":e.bandwidth_cap.trigger_email_exceed.bandwidth_threshhold});c.push(g)}});b.post({method:"set_mobile",params:{interfaces:{"interface":c}},success:function(b){a.success=!0;A();a.resetModified()},error:function(b){A();a.resetModified()}})},cancel:function(){A();
a.model.selected=0;a.resetModified()},changeList:function(){},connect:function(){z("connect")},disconnect:function(){z("disconnect")},oper:function(c){var d=a.model.mobiles[a.model.selected],e=!0;switch(c){case "disconnect":e=!1;break;case "connect":e=!0;break;default:return}b.post({method:"set_mobile",params:{interfaces:{"interface":[{name:d.name,enabled:e}]}},success:function(b){a.success=!0;A()},error:function(a){Log(ERROR,"wan_mobile_main oper action: "+c+" error");A()}})},open_hilink_page:function(){var b=
a.edit;b&&(console.log("--- "),window.open("http://"+b.ipv4_gw))}};a.changeIntf=function(b){a.edit=a.model.mobiles[a.model.selected];var c=a.edit,d;0===a.model.selected?(d=a.model.usb_state.USB1,c.usbattached=a.usbs.USB1):(d=a.model.usb_state.USB2,c.usbattached=a.usbs.USB2);d&&d.is_hilink&&(c.mobile.configure_mode="auto");b||a.chk_service_type();a.chk_authenticate()};a.changeMode=function(){var b=a.edit,c=a.model.usb_state[b.mobile.device_name];if(b){switch(b.mobile.configure_mode){case "auto":b.mobile.setup=
c?angular.copy(c.auto_setup):l({},!0);break;case "manual":b.mobile.setup=l({},!1);break;default:return}$.extend(b.mobile.setup,{sim_pin:"",sim_pin_modify:!0});a.chk_authenticate()}};a.modifySIMPIN=function(){a.edit.mobile.setup.sim_pin_modify=!0};a.chk_service_type=function(){a.form.servicetype.$setValidity("noselect",!0);if(a.edit){var b=!0;angular.forEach(a.model.schema.serviceType,function(c,d){c.id===a.edit.mobile.service_type&&(b=!1)});b&&a.form.servicetype.$setValidity("noselect",!1)}};a.chk_authenticate=
function(){var b=a.edit;b&&"auto"===b.mobile.configure_mode&&(b.mobile.setup.authentication="none")};a.template_config_email_setting=a.DICT("Mobile_Network_Configure_Email_Setting",{"%s1":'<a ng-click="jumpToPage(\'System_Config_Email\')" class="text-underline">'+a.DICT("Mobile_Network_Here")+"</a>"});(function(){var b;a.model.schema={bandwidthThreshold:[],serviceType:[{id:"4G",displayName:a.DICT("Mobile_Network_4G_LTE")},{id:"3G",displayName:a.DICT("Mobile_Network_HSDPA_3G_UMTS")}],authentication:[{id:"none",
displayName:a.DICT("Mobile_Network_None")},{id:"auto",displayName:a.DICT("Mobile_Network_Both")},{id:"PAP",displayName:a.DICT("Mobile_Network_PAP")},{id:"CHAP",displayName:a.DICT("Mobile_Network_CHAP")}],date:[]};for(b=50;100>=b;b+=10)a.model.schema.bandwidthThreshold.push({id:b,displayName:b+""});for(b=1;31>=b;b++)a.model.schema.date.push({id:b,displayName:10>b?"0"+b:b+""})})();a.model.selected=0;a.$on("$destroy",function(){a.destroy=!0});A()}]);app.controller("dynamicDNSCtrl",["$scope","MyHttp","$uibModal","wan_service","$q","UserSession","userAccessRight","wan_lib",function(a,b,t,m,w,u,p,q){a.success=!1;a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();var e=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_ddns",error:function(a){n();Log(ERROR,"dynamic_dns error: "+a.status)}})},x=function(){a.model.display=[];angular.forEach(a.model.ddnses,function(b,c){a.model.display.push({provider:b.provider||
"-",hostname:b.hostname||"-",name:b.name||"",update:b.hostname&&(b.reg_time?"Yes":"No")||"-",status:b.status||"-",enable:b.enable?!0:!1})});a.gridDymDNSOptions.data=a.model.display},n=function(b){var c=[],d=[],e;b&&(b.interfaces&&b.interfaces["interface"])&&(c=b.interfaces["interface"]);a.model.ddnses=[];b=m.filter(c,{usb:!0,physical:!0,subinterface:!0});angular.forEach(b,function(a,b){e=r(a);d.push(e)});a.model.ddnses=d.concat([])},l=function(){a.model.schema={providerList:[],providerPeriodically:[{id:30,
displayName:a.DICT("Dynamic_DNS_Every_30mins")},{id:1440,displayName:a.DICT("Dynamic_DNS_Every_Day")},{id:10080,displayName:a.DICT("Dynamic_DNS_Every_Week")},{id:40320,displayName:a.DICT("Dynamic_DNS_Every_Month")}]}},r=function(a){var b=a&&a.ddns||{},c=a.name||"",d=(a.ipv4||{}).setting||{},e="",k="",l="";c||Log(ERROR,"[DDNS][ERR] genDDNS error, no ifname");if(c=c.match(/^(WAN\d+)($|.\d+$)/))e=c[1],k=c[2],angular.forEach(d,function(a,b){switch(b){case "pptp":l=e+"-PPTP"+k;break;case "l2tp":l=e+"-L2TP"+
k;break;case "pppoe":l=e+"-PPPOE"+k;break;case "trasparent-bridge":l=e+"-BRIDGE"+k;break;default:l=""}});"dnsomatic.com"===b.provider&&(b.hostname="");return{name:a.name||"",logicalIfname:l,enable:b.enable||!1,provider:b.provider||"",hostname:b.hostname||"",username:b.username||"",password:b.password?"00000000":"",changed_password:!1,periodic_update_interval:b["periodic-update-interval"]||"",status:"",reg_time:"",periodic:0===b["periodic-update-interval"]?!1:!0}},v=function(b){b||(b={});var c=[],
d,e;b["interfaces-state"]&&b["interfaces-state"]["interface"]&&(c=b["interfaces-state"]["interface"]);angular.forEach(c,function(b,c){d=b.ddns&&b.ddns.status||{};e=b.name;angular.forEach(a.model.ddnses,function(a){if(!(a.logicalIfname&&a.logicalIfname!==e)&&(a.logicalIfname||a.name===e))a.status=d.state||"",a.reg_time=d["registration-time"]||""})})},s=function(b){b||(b={});var c;b.providers&&b.providers.provider&&(c=b.providers.provider[0]||"",c=c.split(" ")||[]);a.model.schema.providerList=[];angular.forEach(c,
function(b){a.model.schema.providerList.push({id:b,displayName:b})})},k=function(){t.open({animation:a.animationsEnabled,templateUrl:"edit_dynamic_dns.htm",controller:"editDynamicDNSCtrl",size:"700",backdrop:"static",resolve:{model:function(){return a.model},edit:function(){return a.edit}}}).result.then(function(b){a.edit=b;a.edit.provider||(a.edit.provider=a.model.schema.providerList[0].id);a.fun.save("edit")},function(a){})},d=function(){var b=a.edit;angular.forEach(a.model.ddnses[a.model.selectIdx],
function(c,d){switch(d){case "update":case "enable":b[d]=c||!1;break;case "status":b[d]=c||"inactive";break;case "provider":b[d]=c||a.model.schema.providerList[0].id;break;case "periodic_update_interval":b[d]=c||a.model.schema.providerPeriodically[0].id;break;case "periodic":b[d]=c||!1;break;default:b[d]=c}})},c=function(){a.dataReady=!1;w.all([b.post({url:resource_base+"data/ddns_provider.json",method:"get_ddns_provider"}),e(),b.post({url:resource_base+"data/ddns_state.json",method:"get_ddns_state"})]).then(function(b){s(b[0]&&
b[0].data&&b[0].data.result||{});n(b[1]&&b[1].data&&b[1].data.result||{});v(b[2]&&b[2].data&&b[2].data.result||{});x();a.model.selectIdx=-1;a.dataReady=!0})};a.dataReady=!1;a.model={display:[],schema:{},ddnses:[],del:[],selectIdx:-1};a.edit={};a.fun={edit:function(){d();k()},refresh:function(){l();c()},save:function(d){var e=a.edit,k={interfaces:{"interface":[]}};"edit"===d&&(d={name:e.name,ddns:{provider:e.provider,hostname:e.hostname,username:e.username,"periodic-update-interval":e.periodic?e.periodic_update_interval:
0,enable:e.enable}},"dnsomatic.com"===e.provider&&(d.ddns.hostname="all.dnsomatic.com"),e.changed_password&&(d.ddns.password=e.password),k.interfaces["interface"].push(d),b.post({method:"set_ddns",forcedUsingPost:!0,params:k,success:function(b){a.success=!0;c();a.resetModified()},error:function(b){a.resetModified()}}))},cancel:function(){c();a.resetModified()}};a.gridDymDNSOptions=app.uiGrid.generateGridOptions({columnDefs:[{name:"radio",isRadio:!0,changedCbk:function(b){a.model.selectIdx=b}},{field:"name",
displayName:a.DICT("Dynamic_DNS_Interface")},{field:"hostname",displayName:a.DICT("Dynamic_DNS_Fully_Qualified_Domain_Name")},{field:"provider",displayName:a.DICT("Dynamic_DNS_Provider")},{field:"update",displayName:a.DICT("Dynamic_DNS_Update")},{field:"status",displayName:a.DICT("Dynamic_DNS_Status")},{field:"enable",displayName:a.DICT("Dynamic_DNS_Enable"),cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});l();c()}]);
app.controller("editDynamicDNSCtrl",["$scope","$uibModalInstance","model","edit","UserSession","userAccessRight",function(a,b,t,m,w,u){a.model=t;a.edit=m;a.repeat_name="";a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();a.change_pwd=function(){a.edit.changed_password=!0};a.chk_valid=function(){var b=a.edit,m=!0;a.repeat_name="";angular.forEach(a.model.ddnses,function(e){if(!(e.name===b.name||!b.enable||!e.enable)&&e.provider===b.provider&&"dnsomatic.com"!==b.provider&&
e.hostname===b.hostname)m=!1,a.repeat_name=e.name});a.ddnseditform.ddns_provider.$setValidity("repeat",m);a.ddnseditform.ddns_fqdn&&a.ddnseditform.ddns_fqdn.$setValidity("repeat",m);a.template_note=a.DICT("Dynamic_DNS_Repeat_Name_Warning",{"%s0":"<b>"+a.DICT("Dynamic_DNS_Provider")+"</b>","%s1":"<b>"+a.DICT("Dynamic_DNS_Fully_Qualified_Domain_Name")+"</b>","%s2":"<b>"+a.repeat_name+"</b>"})};a.fun={save:function(){b.close(a.edit);a.resetModified()},cancel:function(){b.dismiss("cancel");a.resetModified()}};
a.template_note=a.DICT("Dynamic_DNS_Repeat_Name_Warning",{"%s0":"<b>"+a.DICT("Dynamic_DNS_Provider")+"</b>","%s1":"<b>"+a.DICT("Dynamic_DNS_Fully_Qualified_Domain_Name")+"</b>","%s2":"<b>"+a.repeat_name+"</b>"})}]);app.controller("hardwareDMZCtrl",["$scope","MyHttp","UserSession","userAccessRight","intf_service","modelInfo","$templateCache","subnet_lib","ipv4_lib","$q",function(a,b,t,m,w,u,p,q,e,x){var n=app.TOOLS.getResponse;a.ctx=a.ctx||{};a.ctx.HWDMZport=u.get_HWDMZport()||"LAN4";a.success=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var l=function(b){b||(b={});b=(b.subnets||{}).ipv4||[];a.model.remain_subnets=[];a.model.lan_subnets=[];angular.forEach(b,function(b){b.name&&
b.name.match(/VLAN\d+/)?a.model.lan_subnets.push(b):a.model.remain_subnets.push(b)})},r=function(){return b.post({url:resource_base+"data/hardware_dmz.json",method:"get_dmz",error:function(a){console.log("hardwareDMZCtrl getHardwareDMZData error : "+a.status);v()}})},v=function(b){b||(b={});var d={},c=[];angular.forEach(b.interfaces&&b.interfaces["interface"]||[],function(b){b.name&&b.name.match("^"+a.ctx.HWDMZport+"$")&&(d=b.dmz||{})});a.model.dmz={enable:void 0!==d.enable?d.enable:!1,type:void 0!==
d.range?"range":"subnet",dmz_ip:d["dmz-ip"]||"",netmask:"",start:d.range&&d.range.start||"",end:d.range&&d.range.end||""};d.netmask&&(c=d.netmask.split("/"),2===c.length&&(a.model.dmz.netmask=app.TOOLS.netmask.int2Inet(parseInt(c[1],10))));a.checkIpAndSubnet();a.checkRange()},s=function(){w.init();x.all([r(),b.post({url:resource_base+"data/aaa.json",method:"get_subnet"})]).then(function(b){v(n(b,0));l(n(b,1));a.dataReady=!0})};a.model={dmz:{},remain_subnets:[],lan_subnets:[]};a.ui_data={range_errstr:"",
subnet_errstr:"",dmz_msg:a.DICT("Hardware_DMZ_Msg",{"%s":a.ctx.HWDMZport})};a.dataReady=!1;a.$watch(function(){return a.model.dmz.type},function(b,d){a.checkIpAndSubnet();a.checkRange()});a.checkIpAndSubnet=function(b){var d=a.model.dmz,c,h,g;b=function(b,c){a.hddmz_form.hddmz_ip.$setValidity(b,c);a.hddmz_form.hddmz_netmask.$setValidity(b,c)};if(a.hddmz_form&&(a.hddmz_form.hddmz_ip&&a.hddmz_form.hddmz_netmask)&&(b("overlap",!0),d.enable&&!("subnet"!==d.type||!d.dmz_ip||!d.netmask)))h=app.TOOLS.netmask.inet2Int(d.netmask),
c=e.get_first_ip(d.dmz_ip,h).toString(),d=e.get_last_ip(d.dmz_ip,h).toString(),c=q.check_ipv4_range_is_overlap_with_entity({start:c,end:d},a.model.lan_subnets),c.is_overlap&&(b("overlap",!1),g="",angular.forEach(c.overlap_subnet,function(a){g&&(g+=", ");g+=a.name}),a.ui_data.subnet_errstr=g?a.DICT("Hardware_DMZ_Subnet_Is_Overlap",{"%s":g}):"")};a.checkRange=function(){var b=a.model.dmz,d,c,e,g,l=function(b,c){a.hddmz_form.hddmz_end.$setValidity(b,c);a.hddmz_form.hddmz_start.$setValidity(b,c)};a.ui_data.range_errstr=
"";a.ui_data.subnet_errstr="";if(a.hddmz_form&&(a.hddmz_form.hddmz_start&&a.hddmz_form.hddmz_end)&&(l("overlap",!0),l("out_range",!0),b.enable&&!("range"!==b.type||!b.start||!b.end))){if(b.start!==b.end){d=b.start.split(".");c=b.end.split(".");for(e=0;3>e;e++)if(d[e]!==c[e]){l("out_range",!1);return}if(parseInt(d[3],10)>=parseInt(c[3],10)){l("out_range",!1);return}}res=q.check_ipv4_range_is_overlap_with_entity({start:b.start,end:b.end},a.model.lan_subnets);res.is_overlap&&(l("overlap",!1),g="",angular.forEach(res.overlap_subnet,
function(a){g&&(g+=", ");g+=a.name}),a.ui_data.range_errstr=g?a.DICT("Hardware_DMZ_Range_Is_Overlap",{"%s":g}):"")}};a.updateViewValue=function(b){var d=function(a){b[a].$invalid&&(b[a].$setViewValue(b[a].$modelValue),b[a].$render())};d("hddmz_ip");d("hddmz_netmask");d("hddmz_start");d("hddmz_end");!0===a.model.dmz.enable?app.TOOLS.warningAlertBox({str1:a.DICT("Hardware_DMZ_Msg1",{"%s1":a.ctx.HWDMZport}),templateUrl:"hardwareDmzWarningMsg.html",title:a.DICT("Hardware_DMZ_Warning"),btn_yes_str:a.DICT("Hardware_DMZ_Yes"),
btn_no_str:a.DICT("Hardware_DMZ_No"),cbk:function(b,d){b?(a.checkRange(),a.checkIpAndSubnet()):a.model.dmz.enable=!1}}):(a.checkRange(),a.checkIpAndSubnet())};a.funs={save:function(){var e=a.model.dmz,d={enable:e.enable},c=function(){b.post({method:"set_dmz",params:{interfaces:{"interface":[{name:a.ctx.HWDMZport,dmz:d}]}},success:function(b){a.success=!0;s()},error:function(a){s()}})};switch(e.type){case "subnet":d["dmz-ip"]=e.dmz_ip;d.netmask=app.TOOLS.ipv4.ipAndMask2IpPrefix(e.dmz_ip,e.netmask);
break;case "range":d.range={start:e.start,end:e.end};break;default:console.log("Save funs error, type = "+e.type);return}!1===e.enable?w.checkBeforeDel(["DMZ"],function(b){b?c():s();a.resetModified()}):(c(),a.resetModified())},cancel:function(){s();a.resetModified()}};s()}]);app.controller("dualWANCtrl",["$scope","MyHttp","wan_service","$q","$templateCache","UserSession","userAccessRight","wan_lib",function(a,b,t,m,w,u,p,q){a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();var e=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_dual_wan",error:function(a){x();l();Log(ERROR,"dualWANCtrl getDualWanData error: "+a.status)}})},x=function(b){var c=[],d=[],e=[],g,h;a.model.ifs=[];a.model.noDWIntfList=[];b&&
(b.interfaces&&b.interfaces["interface"])&&(c=q.filter_available_interfaces(b.interfaces["interface"]),angular.forEach(c,function(b,c){if(b.name){h=b["redundant-wan"]||{};g=n(b);"WAN1"===b.name&&(a.model.weight_type=void 0!==h.weight?"percentage":"bandwidth",a.model.orig_weight_type=a.model.weight_type);if(b.name.match(/^WAN\d+/)){if(!1===g.enable){a.model.noDWIntfList.push(b.name);return}d.push(g)}b.name.match(/^USB\d+/)&&(!1===g.enable?a.model.noDWIntfList.push(b.name):e.push(g))}}),a.model.ifs=
d.concat(e),a.model.ifs.sort(function(a,b){return a.precedence-b.precedence}),a.model.origIfs=angular.copy(a.model.ifs),a.gridLoadBalanceOptions.data=a.model.ifs,a.initIntfWeightStatus(),B(),setTimeout(function(){C()},500))},n=function(a){a||(a={});var b=a["redundant-wan"]||{},c=b["net-tracker"]||{},d=c.target&&c.target[0]||{};a={"interface":{select:a.name||"",list:[{id:a.name||"",displayName:a.name||""}]},enable:void 0!==b.enable?b.enable:!0,editIntfName:!1,checked:!1,isDisable:!1,precedence:b.precedence||
1,old_precedence:b.precedence||1,weight:{percentage:b.weight||100,bandwidth:b.bandwidth||100},net_tracker:{enable:void 0!==c.enable?c.enable:!0,target:{detectDestSelect:"gateway",count:d.count||3,interval:d.interval||10,timeout:d.timeout||5,remote_host:"",dns_lookup_host:""}}};a.weight.old_percentage=a.weight.percentage;a.weight.old_bandwidth=a.weight.bandwidth;"dns-query"===d.type?(a.net_tracker.target.detectDestSelect="dns",a.net_tracker.target.dns_lookup_host=d.host||""):"gateway"===d.host?a.net_tracker.target.detectDestSelect=
"gateway":d.host&&(a.net_tracker.target.detectDestSelect="host",a.net_tracker.target.remote_host=d.host||"");return a},l=function(b){b||(b={});var c=[],d=[],e=[];b&&(b.interfaces&&b.interfaces["interface"])&&(c=q.filter_available_interfaces(b.interfaces["interface"]));a.model.outgoingIfs=[];angular.forEach(c,function(a,b){a.name&&(a.name.match(/^WAN\d+($|\.\d+$)/)&&d.push({id:a.name,displayName:a.name}),a.name.match(/^USB\d+($|\.\d+$)/)&&e.push({id:a.name,displayName:a.name}))});a.model.outgoingIfs=
d.concat(e)},r=function(){return b.post({url:resource_base+"data/services.json",method:"get_services",error:function(a){v();Log(ERROR,"dualWANCtrl getServices Error: "+a.status)}})},v=function(b){var c=[];a.model.services=[];b&&(b.services&&b.services.service)&&(c=b.services.service);angular.forEach(c,function(b,c){var d=b.name+"("+b.protocol,d=b.port_range?d+"/"+b.port_range.start+"-"+b.port_range.end+")":b.ip_type?d+"/"+b.ip_type+")":b.icmp_type?d+"/"+b.icmp_type+")":d+")";a.model.services.push({id:b.name,
displayName:d})})},s=function(){return b.post({url:resource_base+"data/policy_routing.json",method:"get_policy_routing",error:function(a){Log(ERROR,"dualWANCtrl getPolicys Error: "+a.status);d()}})},k=function(b,c){var d=b["source-ip-address"]||"",e=b["destination-ip-address"]||"";"any"===d&&(d="Any");"any"===e&&(e="Any");d={name:b.name||"rule"+(parseInt(c,10)+1),checked:!1,disableChkBox:!1,priority:c+1,idx:c,source_ip:d,dest_ip:e,outgoing_if:{select:b["interface"]||a.model.outgoingIfs[0]&&a.model.outgoingIfs[0].id||
"",list:a.model.outgoingIfs},failover:{select:void 0!==b.failover?b.failover:!0,list:a.schema.policyFail,disabled:!1},enable:void 0!==b.enable?b.enable:!0,services:{select:b.service||a.model.services[0]&&a.model.services[0].id||"",list:a.model.services},edit:!1};I({entity:d});return d},d=function(b){var c=[];b=b&&b["policy-routing"]||{};a.model.policys=[];A={"policy-routing":{entry:[]}};b.entry&&(c=b.entry);a.model.policy_basic_route=!1;void 0!==b.enable&&(a.model.policy_basic_route=b.enable);angular.forEach(c,
function(b,c){a.model.policys.push(k(b,c));A["policy-routing"].entry.push({name:b.name})});a.gridPolicyOptions.data=a.model.policys;D()};(function(){return{get:function(b){var c=void 0;angular.forEach(a.model.services,function(a,d){c||a.id===b&&(c=a)});return c}}})();t=function(b){b=a.model.policys;var c=b.length,d;for(d=a.model.policySelCnt=0;d<c;d++)b[d].checked?a.model.policySelCnt+=1:b[d].edit=!1};var c=function(b){var c=a.model.ifs,d={},e=[],g=0,h,k=!1;a.disable_add_dual=!1;a.disable_del_dual=
!0;a.disable_adv_dual=!0;angular.forEach(c,function(a){d[a["interface"].select]=!0;a.checked&&(g+=1);a.checked&&a["interface"].select.match(/^(WAN1|WAN2|USB\d+)$/)&&(k=!0)});angular.forEach(a.model.noDWIntfList,function(a){d[a]||e.push({id:a,displayName:a})});e.length||(a.disable_add_dual=!0);b&&b.entity&&(h=b.entity);angular.forEach(c,function(a){a.editIntfName&&(h&&h["interface"]&&a["interface"].select===h["interface"].select&&(a["interface"].select.match(/^USB\d+$/)?a.net_tracker.enable=!1:a.net_tracker.enable=
!0),a["interface"].list=[{id:a["interface"].select,displayName:a["interface"].select}].concat(e))});1===g&&(a.disable_adv_dual=!1);0<g&&(2<=a.model.ifs.length-g&&!k)&&(a.disable_del_dual=!1)},h={main:"dualWan_loadBalance.html",advanced:"dualWan_advanced.html"},g=function(b){a.currPage===b?Log(INFO,"changePage current page is the same, do nothing"):h[b]?a.currPage=h[b]:Log(INFO,"changePage don't have this page\""+b+'", do nothing')};a.selectIdx=-1;a.balanceErr=!1;a.success=!1;a.currPage="dualWan_loadBalance.html";
a.schema={};a.model={ifs:[],outgoingIfs:[],services:[],policys:[],policySelCnt:0,advItem:{},origItem:{},delItems:[],noDWIntfList:[],policy_basic_route:!1,weight_type:"percentage"};var A={},y=function(){a.dataReady=!1;m.all([e(),s()]).then(function(b){x(b[0].data&&b[0].data.result||{});l(b[0].data&&b[0].data.result||{});d(b[1].data&&b[1].data.result||{});c();a.dataReady=!0});a.modify_policy=!1;a.model.policySelCnt=0},z=function(b,c){var d=b.net_tracker.target,e={enable:b.enable,precedence:b.precedence};
"percentage"===a.model.weight_type?e.weight=b.weight.percentage:e.bandwidth=b.weight.bandwidth;if(c){e["net-tracker"]={enable:b.net_tracker.enable,target:[{host:"",type:"icmp-echo",count:d.count,timeout:d.timeout}]};switch(d.detectDestSelect){case "gateway":e["net-tracker"].target[0].host="gateway";break;case "host":e["net-tracker"].target[0].host=d.remote_host;break;case "dns":e["net-tracker"].target[0].host=d.dns_lookup_host,e["net-tracker"].target[0].type="dns-query"}e["net-tracker"].target[0].host||
delete e["net-tracker"].target}return e},B=function(){a.intfStyle=app.ngGrid.computeHeight(a.model.ifs.length)},D=function(){a.policyStyle=app.ngGrid.computeHeight(a.model.policys.length)},E=function(){return 100<=a.model.policys.length?(a.msg=a.DICT("Multi_WAN_Msg")+a.model.policys.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.intfStyle={};a.policy={};a.dataReady=!1;a.modify_policy=!1;a.disable_add_dual=!1;a.disable_del_dual=!0;a.disable_adv_dual=!0;a.gridCpuHeight=
function(){return app.uiGrid.computeHeight(a.gridLoadBalanceOptions)};a.funs={addDualWan:function(){var b={},d={},e,g,h=a.model.noDWIntfList,k=99,l;angular.forEach(a.model.ifs,function(a){b[a.precedence]=!0;d[a["interface"].select]=!0});for(e=1;100>=e;e++)if(!b[e]){k=e;break}l=n();g=h.length;for(e=0;e<g;e++)if(!d[h[e]]){l["interface"].select=h[e];break}l.editIntfName=!0;l.checked=!0;l.isDisable=!0;l.precedence=k;l.old_precedence=k;a.model.ifs.push(l);C();c({entity:l});B();setTimeout(function(){a.gridLoadBalanceOptions.gridApi.core.scrollTo(a.gridLoadBalanceOptions.data[a.gridLoadBalanceOptions.data.length-
1],a.gridLoadBalanceOptions.columnDefs[1])},50);a.modified()},delDualWan:function(){var b,d=a.model.ifs;for(b=d.length-1;0<=b;b--)d[b].checked&&(exist=!1,angular.forEach(a.model.noDWIntfList,function(a){d[b]["interface"].select===a&&(exist=!0)}),exist||a.model.noDWIntfList.push(d[b]["interface"].select),d.splice(b,1));for(b=d.length-1;0<=b;b--)a.checkIntfWeightStatus({entity:d[b]},!0);C();c();B();a.modified()},save:function(c){var d=!1,e,h=[],k=[],l=a.model.advItem;angular.forEach(a.model.origIfs,
function(b){d=!0;angular.forEach(a.model.ifs,function(a){a["interface"].select===b["interface"].select&&(d=!1)});!0===d&&h.push({name:b["interface"].select,"redundant-wan":{enable:!1}})});angular.forEach(a.model.ifs,function(a){e={name:a["interface"].select};e["redundant-wan"]="advanced"===c&&l["interface"].select===a["interface"].select?z(l,!0):z(a,!1);h.push(e)});policy_routing={enable:a.model.policy_basic_route};a.modify_policy&&(angular.forEach(a.model.policys,function(a,b){a.priority=b+1;k.push({name:"rule"+
parseInt(b+1,10),"source-ip-address":"Any"===a.source_ip?"any":a.source_ip,"destination-ip-address":"Any"===a.dest_ip?"any":a.dest_ip,service:a.services.select,"interface":a.outgoing_if.select,failover:a.failover.select,enable:a.enable})}),policy_routing.entry=k);b.post({method:"set_dual_wan",params:{interfaces:{"interface":h},"policy-routing":policy_routing},success:function(b){a.success=!0;y();g("main");a.resetModified()},error:function(b){y();g("main");a.resetModified()}})},cancel:function(b){"advanced"===
b?g("main"):y();a.resetModified()},edit:function(){if(!(0>=a.model.policySelCnt)){var b=a.model.policys,c=a.model.oriPolicy,d=b.length,e,g;for(e=0;e<d;e++)g=b[e],g.checked&&(g.edit=!0,c&&c[e]&&(g.priority=c[e].priority));c||(a.model.oriPolicy=angular.copy(a.model.policys));a.modify_policy=!0}},del:function(){var b=a.model.policys,c;for(c=a.model.policys.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);angular.forEach(a.model.policys,function(a,b){a.priority=b+1});D();a.modify_policy=!0;a.model.oriPolicy=
void 0;a.modified()},add:function(){if(!E()){var b=k({},a.model.policys.length);b.checked=!0;b.edit=!0;b.disableChkBox=!0;a.modify_policy=!0;a.model.policys.push(b);a.model.policySelCnt+=1;setTimeout(function(){a.gridPolicyOptions.gridApi.core.scrollTo(a.gridPolicyOptions.data[a.gridPolicyOptions.data.length-1],a.gridPolicyOptions.columnDefs[1])},50);angular.forEach(a.model.policys,function(b,c){a.model.oriPolicy&&a.model.oriPolicy[c]&&(b.priority=a.model.oriPolicy[c].priority)});D();a.modified()}},
adv:function(){var b;angular.forEach(a.model.policys,function(a,b){a.edit=!1});angular.forEach(a.model.ifs,function(a){a.checked&&(b=a)});a.model.advItem=angular.copy(b);a.model.origItem=angular.copy(b);g("advanced")}};a.initIntfWeightStatus=function(){var b=0,c,d,e={};angular.forEach(a.model.ifs,function(g){b=0;angular.forEach(a.model.ifs,function(a,c){g["interface"].select!==a["interface"].select&&g.precedence===a.precedence&&(b+=1)});0===b?(g.isDisable=!0,"bandwidth"===a.model.weight_type&&(g.weight.percentage=
100)):(d=0,b+=1,e[g.precedence]||(e[g.precedence]=!0,d=100%b),g.isDisable=!1,c=100-100%b,"bandwidth"===a.model.weight_type&&(g.weight.percentage=c/b+d))})};a.checkIntfWeightStatus=function(b,c){var d=b.entity.precedence,e=b.entity.old_precedence,g=[],h=[],k,l=!1,m,n=0,p=0,r=!1;if(d===e&&(p=0,angular.forEach(a.model.ifs,function(a){a.precedence===d&&(n+=a.weight.percentage,p+=1)}),angular.forEach(a.model.ifs,function(a){a.precedence===d&&(100===n||1===p?a.isErr=!1:(a.isErr=!0,a.errTxt="Precedence "+
d+". Summary of weight should be 100"))}),angular.forEach(a.model.ifs,function(a){!0===a.isErr&&(r=!0)}),a.balanceErr=r,!c))return;angular.forEach(a.model.ifs,function(a,c){a["interface"].select===b.entity["interface"].select?b.entity.old_precedence===b.entity.precedence&&h.push(c):(a.precedence===d&&(a.isErr=!1,g.push(c)),a.old_precedence===e&&(a.isErr=!1,h.push(c)))});k=h.length;1===k?(a.model.ifs[h[0]].isDisable=!0,a.model.ifs[h[0]].weight.percentage=100,a.model.ifs[h[0]].weight.bandwidth=100,
a.model.ifs[h[0]].isErr=!1):1<k&&(m=(100-100%k)/k,angular.forEach(h,function(b){a.model.ifs[b].isDisable=!1;a.model.ifs[b].weight.percentage=m;a.model.ifs[b].isErr=!1}));k=g.length+1;1===k?(b.entity.isDisable=!0,b.entity.weight.percentage=100,b.entity.weight.bandwidth=100):1<k&&(m=(100-100%k)/k,b.entity.isDisable=!1,b.entity.weight.percentage=m+100%k,angular.forEach(g,function(b){a.model.ifs[b].isDisable=!1;a.model.ifs[b].weight.percentage=m;a.model.ifs[b].isErr=!1}));b.entity.isErr=!1;b.entity.old_precedence=
b.entity.precedence;angular.forEach(a.model.ifs,function(a){!0===a.isErr&&(l=!0)});a.balanceErr=l};a.selectall=!1;var C=function(){a.gridLoadBalanceOptions.$gridScope&&a.gridLoadBalanceOptions.$gridScope.columns&&(a.gridLoadBalanceOptions.$gridScope.columns[2].colDef.max=a.model.ifs.length)};a.gridLoadBalanceOptions=app.uiGrid.generateGridOptions({data:a.model.ifs,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:function(a){c()}},{field:"interface",width:100,displayName:a.DICT("Multi_WAN_Interface"),
change:c,minWidth:100,editRow:"editIntfName",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"precedence",displayName:a.DICT("Multi_WAN_Precedence"),change:a.checkIntfWeightStatus,min:1,max:99,ngStyle:{width:"50px"},width:210,required:!0,cellTemplate:"UGDualWanLoadBalanceInlineText.html"},{field:"weight",displayName:a.DICT("Multi_WAN_Weight"),disableRow:"isDisable",change:a.checkIntfWeightStatus,min:1,max:100,ngStyle:{width:"50px"},hasErrorTxt:!0,minWidth:600,cellTemplate:"UGDualWanLoadBalanceWeight.html",
headerCellTemplate:"UGDualWanLoadBalanceHeader.html"}]});var I=function(a){a=a.entity||{};a.failover.disabled=!1;a.outgoing_if.select.match(/WAN\d+.\d+$/)&&(a.failover.select=!1,a.failover.disabled=!0)},G=[],H={};a.policyCbk=function(b){if(!b)return!0;var c=!0,d=[],e=[],g=a.model.policys,h=g.length,k,l,m=!0,n=!0,p,r;"delete_row"===b.type&&(m=!1);var q=function(a,b,m){if(!(0>b||b>h))if(!(0>m||m>h)){var q=a.source_ip,s=a.dest_ip;if(q&&s){q=q.toLowerCase();s=s.toLowerCase();n=!0;r=void 0;p=q+"_"+s+"_"+
a.services.select;G[m]&&(r=G[m].id,r!==p&&H[r]&&(H[r].cnts--,delete G[m]));for(k=b;k<h;k++)if((l=g[k])&&l.name!==a.name&&l.source_ip&&l.dest_ip&&l.source_ip.toLowerCase()===q&&l.dest_ip.toLowerCase()===s&&l.services.select===a.services.select)G[k]||(G[k]={id:p},void 0===H[p]&&(H[p]={cnts:0}),H[p].cnts++,d.push(k)),n=c=!1;a&&(n?G[m]&&(e.push(m),a=G[m].id,delete G[m],H[a]&&0>=H[a].cnts&&delete H[a]):G[m]||(G[m]={id:p},void 0===H[p]&&(H[p]={cnts:0}),H[p].cnts++,d.push(m)));for(k=b;k<h;k++)G[k]&&(a=G[k].id,
H[a]&&1>=H[a].cnts&&(e.push(k),delete G[k],delete H[a]))}}};if(m){if(!b.row)return!0;q(b.row.entity,0,b.row.rowIndex)}else{b=angular.copy(G);angular.copy(H);G=[];H={};for(m=0;m<h;m++)g[m]&&q(g[m],m+1,m);d=[];e=[];for(m=0;m<h;m++)b[m]&&!G[m]&&e.push(m),!b[m]&&G[m]&&d.push(m)}return{result:c,invalidRows:d,validRows:e}};a.gridInvalidCbk=function(a){a.row.entity.disableChkBox=a.rowInvalid};a.gridPolicyOptions=app.uiGrid.generateGridOptions({data:a.model.policys,columnDefs:[{field:"checked",isCheckbox:!0,
changedCbk:t,headerChangedCbk:t},{field:"priority",displayName:a.DICT("Multi_WAN_Priority"),editRow:"edit",width:80,changed:function(b,c){var d=b.entity.priority,e=b.entity.idx,g=angular.copy(a.model.policys),h=g.length,k,d=parseInt(d,10);if(isNaN(d))Log(INFO,"changePriority: priority is not a number");else{d-=1;0>d&&(Log(INFO,"changePriority: priority is out of the range (1~"+h+"), current priority is "+d+1),d=0);d>=h&&(Log(INFO,"changePriority: priority is out of the range (1~"+h+"), current priority is "+
d+1),d=h-1);k=g[e];g.splice(e,1);g.splice(d,0,k);a.model.policys=[];for(e=0;e<h;e++)g[e].priority=e+1,g[e].idx=e,a.model.policys.push(g[e]);setTimeout(function(){var a=document.getElementById("txt_priority_"+d);a?a.focus():Log(ERROR,"element txt_priority_"+d+" is not exist")},100)}},id:"priority",cellTemplate:"UG_table_text_with_inline_edit.html"},{field:"source_ip",displayName:a.DICT("Multi_WAN_Source_IP"),editRow:"edit",placeholder:"10.2.3.0/24 or Any",customVldGroup:"1",required:!0,validationCbk:"gridInvalidCbk",
cellTemplate:w.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-prefix extansion-or-reg=\"^Any$|^any$\" custom-vld custom-vld-cbk='policyCbk'")},{field:"dest_ip",displayName:a.DICT("Multi_WAN_Destination_IP"),editRow:"edit",placeholder:"10.2.3.0/24 or Any",customVldGroup:"1",required:!0,validationCbk:"gridInvalidCbk",cellTemplate:w.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-prefix extansion-or-reg=\"^Any$|^any$\" custom-vld custom-vld-cbk='policyCbk'")},
{field:"services",displayName:a.DICT("Multi_WAN_Services"),editRow:"edit",customVldGroup:"1",cellTemplate:w.get("UG_table_text_with_inline_select_edit.html").replace(/data-ng-expansion/,"custom-vld custom-vld-cbk='policyCbk'")},{field:"outgoing_if",displayName:a.DICT("Multi_WAN_Outgoing_Interface"),editRow:"edit",change:I,cellTemplate:"UG_table_text_with_inline_select_edit.html",width:150},{field:"failover",displayName:a.DICT("Multi_WAN_Failover_Backup_WAN"),editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html",
width:185},{field:"enable",displayName:a.DICT("Multi_WAN_Status"),width:70,editRow:"edit",cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});B();D();a.schema.onFail=[{id:"failover",displayName:a.DICT("Multi_WAN_Generate_System_Log_Remove")},{id:"log",displayName:a.DICT("Multi_WAN_Generate_System_Log")}];a.schema.policyFail=[{id:!0,displayName:a.DICT("Multi_WAN_On")},{id:!1,displayName:a.DICT("Multi_WAN_Off")}];(function(){a.dataReady=!1;m.all([e(),r(),s()]).then(function(b){x(b[0].data&&b[0].data.result||
{});l(b[0].data&&b[0].data.result||{});v(b[1].data&&b[1].data.result||{});d(b[2].data&&b[2].data.result||{});c();a.dataReady=!0});a.modify_policy=!1;a.model.policySelCnt=0})()}]);app.controller("WANSettingCtrl",["$scope","MyHttp","$uibModal","$q","wan_lib","UserSession","userAccessRight","intf_service",function(a,b,t,m,w,u,p,q){var e=0,x=10,n=!0,l=app.TOOLS.getResponse;a.success=!1;a.dataReady=!1;a.subnetObj={};a.reptIntf="";var r=app.TOOLS.computeWidth;a.ruFlag=p.russia();a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();var v=function(){var b={},c={dynamic:{id:"dynamic",displayName:a.DICT("WAN_Settings_DHCP"),origin:"dhcp",type:"ethernetCsmacd"},
"static":{id:"static",displayName:a.DICT("WAN_Settings_Static_IP"),origin:"static",type:"ethernetCsmacd"},pppoe:{id:"pppoe",displayName:a.DICT("WAN_Settings_PPPoE"),origin:"other",type:"pppoe"},pptp:{id:"pptp",displayName:a.DICT("WAN_Settings_PPTP"),origin:"other",type:"pptp"},l2tp:{id:"l2tp",displayName:a.DICT("WAN_Settings_L2TP"),origin:"other",type:"l2tp"},slaac:{id:"slaac",displayName:a.DICT("WAN_Settings_SLAAC"),origin:"link-layer",type:"ethernetCsmacd"},"trasparent-bridge":{id:"trasparent-bridge",
displayName:a.DICT("WAN_Settings_Bridge"),origin:"other",type:"bridge"},disabled:{id:"disabled",displayName:a.DICT("WAN_Settings_Disabled"),origin:"other",type:"disabled"}};b.get=function(a){return c[a]||c.dynamic};return b}(),s={up:"Up",down:"Down",connected:"Connected",testing:"Testing",unknown:"Unknow",dormant:"Dormant","not-present":"Not-Present","lower-layer-down":"Lower-Layer-Down"},k=function(){var b=function(b){var c=void 0;angular.forEach(a.model.ifs_state,function(a,d){a.name===b&&(c=a)});
return c},c=angular.copy(a.model.display),d=c.length,e,g,h=220,k={},l;a.model.display=[];var m={};l=b("WAN_PORT1");k.WAN1=l&&"Connected"===l.link_status||!1;l=b("WAN_PORT2");k.WAN2=l&&"Connected"===l.link_status||!1;angular.forEach(a.model.ifs,function(n,p){var q={checked:!1,name:n.name,ipv4Type:v.get(n.ipv4.connectType).displayName,ipv4Status:"",ipv4AddrMask:{ipAddrMask:"",list:[],templateUrl:""},ipv6Type:v.get(n.ipv6.connectType).displayName,ipv6Status:"",ipv6AddrMask:{ipAddrMask:"",list:[],templateUrl:""},
empty:""},t=n.name;m=void 0;for(e=0;e<d;e++)if(c[e].name===q.name){q.checked=c[e].checked;break}t&&(m=b(t));m&&(q.ipv4Status=!k[n.intf]||!m.ipv4_ip.length?s.down:s.up,m.ipv4_ip.length?(angular.forEach(m.ipv4_ip,function(a,b){q.ipv4AddrMask.list.push(a.ip+"/"+a.prefix)}),q.ipv4AddrMask.list.length&&(q.ipv4AddrMask.ipAddrMask=q.ipv4AddrMask.list[0]),2<=m.ipv4_ip.length&&(q.ipv4AddrMask.ipAddrMask+=" ...",q.ipv4AddrMask.templateUrl="popover_ip_perfixs.htm")):(q.ipv4AddrMask.list.push("-"),q.ipv4AddrMask.ipAddrMask=
"-"),q.ipv6Status=!k[n.intf]||1>=m.ipv6_ip.length?s.down:s.up,m.ipv6_ip.length?(angular.forEach(m.ipv6_ip,function(a,b){l=a.ip+"/"+a.prefix;q.ipv6AddrMask.list.push(l);g=r(l)+16;h<g&&(h=g)}),q.ipv6AddrMask.list.length&&(q.ipv6AddrMask.ipAddrMask=q.ipv6AddrMask.list[0]),2<=m.ipv6_ip.length&&(q.ipv6AddrMask.ipAddrMask+=" ...",q.ipv6AddrMask.templateUrl="popover_ip_perfixs.htm")):(q.ipv6AddrMask.list.push("-"),q.ipv6AddrMask.ipAddrMask="-"));a.model.display.push(q)});h!==a.gridDualWanOptoins.columnDefs[5]&&
(a.gridDualWanOptoins.columnDefs[5].minWidth=h,setTimeout(function(){a.gridDualWanOptoins.gridApi&&a.gridDualWanOptoins.gridApi.core.notifyDataChange&&a.gridDualWanOptoins.gridApi.core.notifyDataChange("all")},0));I();a.gridDualWanOptoins.data=a.model.display},d=function(b){a.edit={};a.edit=angular.copy(b);a.edit.ipv4.connectTypeList=new app.RadioList({radioList:{data:a.model.schema.ipv4ConnectType,style:"width: 100px"},selected:b.ipv4.connectType,provious_selected:b.ipv4.connectType,title:{str:a.DICT("connection_type"),
style:"width: 195px"}});a.edit.ipv6.connectTypeList=new app.RadioList({radioList:{data:a.model.schema.ipv6ConnectType,style:"width: 100px"},selected:b.ipv6.connectType,provious_selected:b.ipv6.connectType,title:{str:a.DICT("connection_type"),style:"width: 195px"}});"dhcp"!==a.edit.ipv4.physical&&"static"!==a.edit.ipv4.physical&&(a.edit.ipv4.physical="dhcp");a.model.opendns&&(a.edit.ipv4.setting.orig_naming_server=angular.copy(a.edit.ipv4.setting.naming_server),a.edit.ipv4.setting.orig_peerdns=angular.forEach(a.edit.ipv4.setting.peerdns),
a.edit.ipv4.setting.peerdns="opendns",a.edit.ipv4.setting.naming_server.servers=["208.67.222.222","208.67.220.220"])},c=function(){return b.post({url:resource_base+"data/aaa.json",method:"get_subnet",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},h=function(b){b||(b={});var c=b.subnets||{};b=c.ipv4||[];var c=c.ipv6||[],d;a.subnetObj={ipv4:angular.copy(b),ipv6:angular.copy(c)};for(d=b.length-1;0<=d;d--)b[d].name&&b[d].name.match(/^WAN\d+/)&&b.splice(d,1);
for(d=c.length-1;0<=d;d--)c[d].name&&c[d].name.match(/^WAN\d+/)&&c.splice(d,1);a.model.subnets={ipv4:angular.copy(b),ipv6:angular.copy(c)}},g=function(){angular.forEach(a.model.ifs_state,function(b){"WAN1"===b.name?a.model.wan1mac=b.phys_address:"WAN2"===b.name&&(a.model.wan2mac=b.phys_address)})},A=function(){return b.post({url:resource_base+"data/opendns.json",method:"get_opendns",error:function(a){console.log("umbrellaCtrl getOpendnsData error : "+a.status);y()}})},y=function(b){b=b&&b.data&&b.data.result||
{};a.model.opendns=b.opendns&&b.opendns.enabled?!0:!1},z=function(){var b;q.init();m.all([w.init({full_configure:!0}),c(),A()]).then(function(c){b=c[0][0];a.model.orig_vlans=c[0][1];a.model.mac=c[0][2].pc_mac;a.model.is_from_lan=c[0][2].is_from_lan;angular.forEach(b,function(a){a.ipv6.enabled||(a.ipv6.connectType="disabled")});a.model.ifs=b;k();h(l(c,1));y(c[2]);n=!0;C(!0);a.resetModified();a.dataReady=!0})},B=function(){0!==e&&(clearTimeout(e),e=0)},D=!1,E=!1,C=function(b){var c=5E3;if(!D||!n)B(),
app.TOOLS.get_scope("WANSettingCtrl")&&(b&&(c=0),e=setTimeout(function(){D=!0;m.all([w.get_wan_state({background:!0,isPolling:!0})]).then(function(b){D=!1;a.model.ifs_state=b[0];k();g();e=0;n&&10>x&&(x++,E?E=!1:C())})},c))},I=function(){var b=a.model.display,c=b.length,d;a.model.selects=[];for(d=0;d<c;d++)b[d].checked&&a.model.selects.push(d)};a.dataReady=!1;a.gridApi=void 0;a.model={ifs:[],orig_vlans:[],vlans:[],display:[],selects:[],delIfs:[],schema:{},ifs_state:[],addEditIdx:-1,mac:"",dmac:"",
wan1mac:"",wan2mac:"",opendns:!1,subnets:[]};a.gridDualWanOptoins=app.uiGrid.generateGridOptions({data:a.model.display,rowHeight:2*app.uiGrid.rowHeight,onRegisterApi:function(b){a.gridApi=b},columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:function(a,b){I()},headerChangedCbk:function(a){I()}},{field:"name",displayName:a.DICT("WAN_Settings_Name"),minWidth:100},{field:"ipv4AddrMask",minWidth:180,displayName:a.DICT("WAN_Settings_IPv4_Addr_Netmask"),cellTemplate:"UG_wan_settings_ip_perfix1.htm"},
{field:"ipv4Type",width:140,displayName:a.DICT("WAN_Settings_IPv4_Connection")},{field:"ipv4Status",width:110,displayName:a.DICT("WAN_Settings_IPv4_Status")},{field:"ipv6AddrMask",minWidth:220,displayName:a.DICT("WAN_Settings_IPv6_Addr_Prefix_Length"),cellTemplate:"UG_wan_settings_ip_perfix1.htm"},{field:"ipv6Type",width:140,displayName:a.DICT("WAN_Settings_IPv6_Connection")},{field:"ipv6Status",width:100,displayName:a.DICT("WAN_Settings_IPv6_Status")},{field:"empty",isEmpty:!0}]});var G=function(){t.open({animation:a.animationsEnabled,
templateUrl:"wan_settings_add_edit.htm",controller:"WANSettingEditCtrl",size:"wan-setting-edit",backdrop:"static",resolve:{model:function(){return a.model},edit:function(){return a.edit},subnetObj:function(){return a.subnetObj}}}).result.then(function(b){a.edit=b;a.funs.save("addEdit")},function(a){n=!0;C(!0)})},H=function(){var b,c;b=a.edit;-1!==a.model.addEditIdx&&(c=a.model.ifs[a.model.addEditIdx]);a.model.opendns&&(b.ipv4.setting.peerdns=b.ipv4.setting.orig_peerdns,b.ipv4.setting.naming_server=
b.ipv4.setting.orig_naming_server,delete b.ipv4.setting.orig_peerdns,delete b.ipv4.setting.orig_naming_server);b.ipv4.setting.ifname=b.intf;b.ipv6.setting.ifname=b.intf;b.ipv4.connectType=b.ipv4.connectTypeList.selected;"disabled"===b.ipv6.connectTypeList.selected?(b.ipv6.connectType="slaac",b.ipv6.enabled=!1):(b.ipv6.connectType=b.ipv6.connectTypeList.selected,b.ipv6.enabled=!0);delete b.ipv4.connectTypeList;delete b.ipv6.connectTypeList;m.all([w.set_wan_interface({orig:c,edit:b})]).then(function(b){a.success=
!0;x=1;z()})},F=function(){return 18<=(a.model.display.length||0)?(a.msg="Only allow maximum of 16 entries for wan subinterface.",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},K=function(){a.model.dmac="WAN1"===a.edit.intf?a.model.wan1mac:a.model.wan2mac};a.funs={add:function(){if(!F()){n=!1;B();var b=w.gen_wan_settings({});b.isCreateSubInterface=!0;b.ipv6.enabled||(b.ipv6.connectType="disabled");d(b);K();M();a.model.addEditIdx=-1;G();a.modified()}},edit:function(){n=!1;B();a.model.addEditIdx=
a.model.selects[0];d(a.model.ifs[a.model.addEditIdx]);K();M();G()},del:function(){var b,c=function(){var b=-1,c=-1;angular.forEach(a.model.selects,function(a,d){c<a&&(c=a,b=d)});a.model.selects.splice(b,1);return c},d,e;for(d=a.model.selects.length-1;0<=d;d--)e=c(),b=a.model.ifs[e],a.model.ifs.splice(e,1),a.model.delIfs.push(b);k();a.modified()},save:function(b){var c=[],d;angular.forEach(a.model.delIfs,function(a){c.push(a.name)});c.length?q.checkBeforeDel(c,function(c){c?m.all([w.delete_wan_interfaces({intfs:a.model.delIfs})]).then(function(c){c[0].data.result&&
c[0].data.result.code?0!==c[0].data.result.code&&(d="<div>"+a.DICT("WAN_Settings_Delete_Warning_Msg")+"</div><div>"+c[0].data.result.errstr+"</div>",app.TOOLS.criticalAlertBox({msg:d})):a.success=!0;a.model.delIfs=[];"addEdit"===b?H():z()}):(a.model.delIfs=[],z())}):"addEdit"===b&&H()},cancel:function(b){a.resetModified()},delDisable:function(){var b=!1;if(0===a.model.selects.length)return!0;angular.forEach(a.model.selects,function(c,d){switch(a.model.ifs[c].name){case "WAN1":case "WAN2":b=!0}});
return b}};var M=function(){var b="",c={};angular.forEach(a.model.ifs,function(a){"trasparent-bridge"===a.ipv4.connectType&&(c[a.ipv4.setting.ifnames]=!0)});"trasparent-bridge"===a.edit.ipv4.connectType&&(b=a.edit.ipv4.setting.ifnames);a.model.vlans=[];angular.forEach(a.model.orig_vlans,function(d){c[d.id]&&d.id!==b||a.model.vlans.push(d)});b||(a.edit.ipv4.setting.ifnames=a.model.vlans.length?a.model.vlans[0].id:void 0)};a.$on("$destroy",function(){E=!0});(function(){a.model.schema={dhcppeerdns:[{id:!0,
displayName:a.DICT("WAN_Settings_Use_DHCP_Provided_DNS_Server")},{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],staticpeerdns:[{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],l2tppeerdns:[{id:!0,displayName:a.DICT("WAN_Settings_Use_L2TP_Provided_DNS_Server")},{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],pptppeerdns:[{id:!0,displayName:a.DICT("WAN_Settings_Use_PPTP_Provided_DNS_Server")},{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],pppoepeerdns:[{id:!0,
displayName:a.DICT("WAN_Settings_Use_PPPoE_Provided_DNS_Server")},{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],bridgepeerdns:[{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],opendnspeerdns:[{id:"opendns",displayName:a.DICT("WAN_Settings_Use_Opendns_Provided_DNS_Server")}],auth_type:[{id:"auto",displayName:a.DICT("WAN_Settings_Auto_Negotiation")},{id:"PAP",displayName:a.DICT("WAN_Settings_PAP")},{id:"CHAP",displayName:a.DICT("WAN_Settings_CHAP")},{id:"MSCHAP",displayName:a.DICT("WAN_Settings_MS_CHAP")},
{id:"MSCHAP2",displayName:a.DICT("WAN_Settings_MS_CHAPv2")}],ipAssignList:[{id:"dhcp",displayName:a.DICT("WAN_Settings_DHCP")},{id:"static",displayName:a.DICT("WAN_Settings_Static_IP")}]};var b={ipv4ConnectType:[[{id:"dynamic",displayName:a.DICT("WAN_Settings_DHCP"),objid:"rdo_ipv4_dhcp"}],[{id:"static",displayName:a.DICT("WAN_Settings_Static_IP"),objid:"rdo_ipv4_static"}],[{id:"pppoe",displayName:a.DICT("WAN_Settings_PPPoE"),objid:"rdo_ipv4_pppoe"}],[{id:"trasparent-bridge",displayName:a.DICT("WAN_Settings_Bridge"),
objid:"rdo_ipv4_br"}]],ipv6ConnectType:[[{id:"slaac",displayName:a.DICT("WAN_Settings_SLAAC"),objid:"rdo_ipv6_slaac"}],[{id:"dynamic",displayName:a.DICT("WAN_Settings_DHCP"),objid:"rdo_ipv6_dhcp"}],[{id:"static",displayName:a.DICT("WAN_Settings_Static_IP"),objid:"rdo_ipv6_static"}],[{id:"pppoe",displayName:a.DICT("WAN_Settings_PPPoE"),objid:"rdo_ipv6_pppoe"}],[{id:"disabled",displayName:a.DICT("WAN_Settings_Disabled"),objid:"rdo_ipv4_disabled"}]]},c={ipv4ConnectType:[[{id:"dynamic",displayName:a.DICT("WAN_Settings_DHCP"),
objid:"rdo_ipv4_dhcp"}],[{id:"static",displayName:a.DICT("WAN_Settings_Static_IP"),objid:"rdo_ipv4_static"}],[{id:"pppoe",displayName:a.DICT("WAN_Settings_PPPoE"),objid:"rdo_ipv4_pppoe"}],[{id:"pptp",displayName:a.DICT("WAN_Settings_PPTP"),objid:"rdo_ipv4_pptp"}],[{id:"l2tp",displayName:a.DICT("WAN_Settings_L2TP"),objid:"rdo_ipv4_l2tp"}],[{id:"trasparent-bridge",displayName:a.DICT("WAN_Settings_Bridge"),objid:"rdo_ipv4_br"}]],ipv6ConnectType:[[{id:"slaac",displayName:a.DICT("WAN_Settings_SLAAC"),
objid:"rdo_ipv6_slaac"}],[{id:"dynamic",displayName:a.DICT("WAN_Settings_DHCP"),objid:"rdo_ipv6_dhcp"}],[{id:"static",displayName:a.DICT("WAN_Settings_Static_IP"),objid:"rdo_ipv6_static"}],[{id:"pppoe",displayName:a.DICT("WAN_Settings_PPPoE"),objid:"rdo_ipv6_pppoe"}],[{id:"disabled",displayName:a.DICT("WAN_Settings_Disabled"),objid:"rdo_ipv4_disabled"}]]};a.ruFlag?angular.extend(a.model.schema,b):angular.extend(a.model.schema,c)})();z()}]);
app.controller("WANSettingEditCtrl",["$scope","$uibModalInstance","model","edit","UserSession","userAccessRight","subnetObj","addressPoolValidate","ipv4_lib","ipv6_lib","subnet_lib",function(a,b,t,m,w,u,p,q,e,x,n){a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var l={dynamic:1500,"static":1500,slaac:1500,"trasparent-bridge":1500,pppoe:1492,l2tp:1460,pptp:1460},r=function(b){var d,e;b&&(d=l[b.ipv4.connectTypeList.selected],e=l[b.ipv6.connectTypeList.selected],
d="disabled"===b.ipv6.connectTypeList.selected?d:d<=e?d:e,b.mtu>d&&(b.mtu=d),"auto"===b.mtuType&&(b.mtu=d),a.max_mtu=d,a.mtu_note=a.DICT("WAN_Settings_MTU_Note",{"%d1":d,"%d2":d}))},v=function(){var b=a.edit;"pppoe"!==b.ipv4.connectTypeList.selected&&b.ipv6.setting.share_ipv4_pppoe_session&&(b.ipv6.setting.share_ipv4_pppoe_session=!1,b.ipv6.setting.username="",b.ipv6.setting.password="",b.ipv6.setting.changed_password=!0)},s=function(){var b=a.edit,d;if(a.model.opendns&&"ipv4"===a.tabSelect)b.ipv4.setting.peerdns=
"opendns";else{if("ipv4"===a.tabSelect)switch(d=b.ipv4.connectTypeList,d.selected){case "static":case "trasparent-bridge":b.ipv4.setting.peerdns=!1;break;default:switch(d.provious_selected){case "static":case "trasparent-bridge":b.ipv4.setting.peerdns=!0,b.ipv4.setting.naming_server.servers=["",""]}}else switch(d=b.ipv6.connectTypeList,d.selected){case "static":case "slaac":b.ipv6.setting.peerdns=!1;break;default:switch(d.provious_selected){case "static":case "slaac":b.ipv6.setting.peerdns=!0,b.ipv6.setting.naming_server.servers=
["",""]}}d.provious_selected=d.selected}};a.max_mtu=1500;a.model=t;a.edit=m;a.mtu_note="";a.jumpToPage=function(b){app.TOOLS.jumpToPage(b,!1,function(b){b&&a.funs.cancel()})};a.note2=a.DICT("WAN_Settings_Note2",{"%s":"<a ng-click=\"jumpToPage('WAN_Multi_WAN')\">"+a.DICT("WAN_Settings_Multi_WAN")+"</a>"});a.note3=a.DICT("WAN_Settings_Note3",{"%s":"<a ng-click=\"jumpToPage('WAN_Multi_WAN')\">"+a.DICT("WAN_Settings_Multi_WAN")+"</a>"});a.edit.ipv4.connectTypeList.change=function(){r(a.edit);s();v();
setTimeout(function(){a.chkV4GW()},200)};a.edit.ipv6.connectTypeList.change=function(){r(a.edit);s();setTimeout(function(){a.chkIPv6StaticIPGw()},100)};a.tabUrl="wan_settings_ipv4_settings.htm";a.tabSelect="ipv4";a.tabs=[{heading:a.DICT("WAN_Settings_IPv4"),templateUrl:"wan_settings_ipv4_settings.htm",name:"ipv4"},{heading:a.DICT("WAN_Settings_IPv6"),templateUrl:"wan_settings_ipv6_settings.htm",name:"ipv6"},{heading:a.DICT("WAN_Settings_Advanced"),templateUrl:"wan_settings_other_settings.htm",name:"other"}];
""===t.dmac&&setTimeout(function(){a.model.dmac="WAN1"===m.intf?t.wan1mac:t.wan2mac;a.model.dmac||(a.model.dmac="-")},1E3);a.isDefInterface=function(){return a.edit.name.match(/^WAN1$/)||a.edit.name.match(/^WAN2$/)?!0:!1};a.change_pwd=function(b){"ipv4"===b?a.edit.ipv4.setting.changed_password=!0:a.edit.ipv6.setting.changed_password=!0};a.checkEdit=function(){if(a.isDefInterface())a.vlanIdNoRepeat=!0;else{var b=a.edit.vlan_interface_settings.vlan_id,d=a.edit;a.vlanIdNoRepeat=!0;b&&(angular.forEach(a.model.ifs,
function(e,k){k!==a.model.addEditIdx&&(e.vlan_interface_settings.vlan_id===b&&d.intf===e.intf)&&(a.vlanIdNoRepeat=!1)}),a.model.dmac="WAN1"===a.edit.intf?a.model.wan1mac:a.model.wan2mac)}};a.chkAuthType=function(){if(a.edit){var b=a.edit,d=a.model.schema;b.ipv4.setting.mppe?(d.auth_type=[{id:"MSCHAP2",displayName:"MS-CHAPv2"}],b.ipv4.setting.authentication_type=d.auth_type[0].id):d.auth_type=[{id:"auto",displayName:a.DICT("WAN_Settings_Auto_Negotiation")},{id:"PAP",displayName:a.DICT("WAN_Settings_PAP")},
{id:"CHAP",displayName:a.DICT("WAN_Settings_CHAP")},{id:"MSCHAP",displayName:a.DICT("WAN_Settings_MS_CHAP")},{id:"MSCHAP2",displayName:a.DICT("WAN_Settings_MS_CHAPv2")}]}};a.chkPDName=function(){var b=a.edit,d=a.model.addEditIdx,e=!0;angular.forEach(a.model.ifs,function(a,k){k!==d&&a.ipv6.setting.dhcp_pd_enable&&a.ipv6.setting.prefix_name===b.ipv6.setting.prefix_name&&(e=!1)});return e};a.chkV4GW=function(){var b=a.edit,d=b.ipv4.address.ip||"",e=b.ipv4.address.netmask||"",k=b.ipv4.setting.gateway||
"",l=d.split("."),e=e.split("."),m=k.split("."),n=!0,p=function(b){a.wanform&&(a.wanform.v4_static_gw&&a.wanform.v4_static_gw.$setValidity("gwOutRange",b),a.wanform.txt_ipv4pptp_gw&&a.wanform.txt_ipv4pptp_gw.$setValidity("gwOutRange",b),a.wanform.txt_ipv4l2tp_gw&&a.wanform.txt_ipv4l2tp_gw.$setValidity("gwOutRange",b),a.wanform.txt_ipv4br_gw&&a.wanform.txt_ipv4br_gw.$setValidity("gwOutRange",b))},q=function(b){a.wanform&&(a.wanform.v4_static_gw&&a.wanform.v4_static_gw.$setValidity("ipGwIsTheSame",
b),a.wanform.txt_ipv4static_ipaddr&&a.wanform.txt_ipv4static_ipaddr.$setValidity("ipGwIsTheSame",b),a.wanform.txt_ipv4pptp_ipaddr&&a.wanform.txt_ipv4pptp_ipaddr.$setValidity("ipGwIsTheSame",b),a.wanform.txt_ipv4pptp_gw&&a.wanform.txt_ipv4pptp_gw.$setValidity("ipGwIsTheSame",b),a.wanform.txt_ipv4l2tp_ipaddr&&a.wanform.txt_ipv4l2tp_ipaddr.$setValidity("ipGwIsTheSame",b),a.wanform.txt_ipv4l2tp_gw&&a.wanform.txt_ipv4l2tp_gw.$setValidity("ipGwIsTheSame",b),a.wanform.txt_ipv4br_ipaddr&&a.wanform.txt_ipv4br_ipaddr.$setValidity("ipGwIsTheSame",
b),a.wanform.txt_ipv4br_gw&&a.wanform.txt_ipv4br_gw.$setValidity("ipGwIsTheSame",b))},r=function(a){angular.forEach(a,function(a){parseInt(a,10)})};p(!0);q(!0);switch(b.ipv4.connectTypeList.selected){case "static":case "trasparent-bridge":break;case "pptp":if("static"!==b.ipv4.physical)return;break;case "l2tp":if("static"!==b.ipv4.physical)return;break;default:return}4!==l.length||(4!==e.length||4!==m.length)||(d===k?q(!1):(r(l),r(e),r(m),(l[0]&e[0])!==(m[0]&e[0])&&(n=!1),(l[1]&e[1])!==(m[1]&e[1])&&
(n=!1),(l[2]&e[2])!==(m[2]&e[2])&&(n=!1),(l[3]&e[3])!==(m[3]&e[3])&&(n=!1),p(n),app.TOOLS.apply(a)))};var k=a.$watch(function(){return a.edit.intf},function(b){a.checkEdit()});a.funs={cloneMAC:function(){a.edit.mac_address=a.model.mac},save:function(){k();b.close(a.edit)},cancel:function(){k();b.dismiss("cancel");a.resetModified()},clickTab:function(b){a.tabUrl=b.templateUrl;a.tabSelect=b.name;s()}};var d=function(b,d){var e=-1,k={};"ipv6"===d?(k={flag:!1,subnetObj:{ipv4:b.ipv4||[],ipv6:[]}},angular.forEach(b.ipv6,
function(b){if(0<=b.name.search("WAN")){for(var c=0;c<a.model.ifs.length;c++)if(b.name===a.model.ifs[c].name){e=0;break}-1===e?k.flag=!0:0===e&&(k.subnetObj.ipv6.push(b),e=-1)}else k.subnetObj.ipv6.push(b)})):(k={flag:!1,subnetObj:{ipv4:[],ipv6:b.ipv6||[]}},angular.forEach(b.ipv4,function(b){if(0<=b.name.search("WAN")){for(var c=0;c<a.model.ifs.length;c++)if(b.name===a.model.ifs[c].name){e=0;break}-1===e?k.flag=!0:0===e&&(k.subnetObj.ipv4.push(b),e=-1)}else k.subnetObj.ipv4.push(b)}));return k};a.chkL2tpPptpServerVali=
function(){var b=a.edit,d=!1;if(!b)return!0;switch(b.ipv4.connectTypeList.selected){case "l2tp":case "pptp":break;default:return!0}angular.forEach(a.model.ifs,function(e,k){k!==a.model.addEditIdx&&b.ipv4.connectTypeList.selected===e.ipv4.connectType&&b.ipv4.setting.server===e.ipv4.setting.server&&(d=!0)});return!d};a.chkIPv6StaticIPGw=function(){var b=a.edit,d,e,k=!0,l,m,n,p,q=function(b){a.wanform&&(a.wanform.txt_ipv6static_ipaddr&&a.wanform.txt_ipv6static_ipaddr.$setValidity("gwOutRange",b),a.wanform.txt_ipv6static_prefixlen&&
a.wanform.txt_ipv6static_prefixlen.$setValidity("gwOutRange",b),a.wanform.txt_ipv6static_gw&&a.wanform.txt_ipv6static_gw.$setValidity("gwOutRange",b))};l=function(b){a.wanform.txt_ipv6static_ipaddr&&a.wanform.txt_ipv6static_ipaddr.$setValidity("ipGwIsTheSame",b);a.wanform.txt_ipv6static_gw&&a.wanform.txt_ipv6static_gw.$setValidity("ipGwIsTheSame",b)};q(!0);l(!0);if(b&&"static"===b.ipv6.connectTypeList.selected&&(d=app.TOOLS.ipv6.toFullV6ZPAddr(b.ipv6.address.ip),e=app.TOOLS.ipv6.prefixLen2FullAddr(b.ipv6.address.prefix_length),
b=app.TOOLS.ipv6.toFullV6ZPAddr(b.ipv6.setting.gateway),d&&e&&b))if(d===b)l(!1);else if(39!==d.length||39!==b.length)Log(DEBUG,"chkIPv6StaticIPGw Error:"),Log(DEBUG,"IP Address is : "+d),Log(DEBUG,"Gateway is : "+b),q(!0);else{for(l=0;l<e.length;l++)"0"===e[l]||":"===e[l]||(m=parseInt(d[l],16),p=parseInt(e[l],16),n=parseInt(b[l],16),(m&p)!==n&&(k=!1));q(k)}};a.ipv4Vali=function(){var b=angular.copy(a.model.subnets).ipv4,d=a.edit,g=a.model.ifs,k=!0,l,m;if(!d||!d.ipv4.address.ip||!d.ipv4.address.netmask)return k;
switch(d.ipv4.connectTypeList.selected){case "trasparent-bridge":if(!d.ipv4.setting.ifnames)return k;for(l=b.length-1;0<=l;l--)b[l].name===d.ipv4.setting.ifnames&&b.splice(l,1);break;case "static":break;case "pptp":case "l2tp":if("dhcp"===d.ipv4.physical)return k;break;default:return k}angular.forEach(g,function(a){if(d.name!==a.name){switch(a.ipv4.connectType){case "trasparent-bridge":if(!a.ipv4.setting.ifnames)break;for(l=b.length-1;0<=l;l--)b[l].name===a.ipv4.setting.ifnames&&b.splice(l,1);break;
case "static":break;case "pptp":case "l2tp":if("dhcp"===a.ipv4.physical)return;break;default:return}d.ipv4.address.ip===a.ipv4.address.ip&&(k=!1)}});if(!k)return k;m=app.TOOLS.netmask.inet2Int(d.ipv4.address.netmask);g=e.get_first_ip(d.ipv4.address.ip,m);m=e.get_last_ip(d.ipv4.address.ip,m);g&&(g=g.toString());m&&(m=m.toString());return k=!n.check_ipv4_range_is_overlap_with_entity({start:g,end:m},b).is_overlap};a.ipv6Vali=function(){var b=!0,b=angular.copy(p.ipv6),e=a.edit.intf,g="";if(void 0===a.edit.ipv6.address.ip||
""===a.edit.ipv6.address.ip||void 0===a.edit.ipv6.address.prefix_length||""===a.edit.ipv6.address.prefix_length||void 0===b)return!0;g=void 0===a.edit.vlan_interface_settings.vlan_id||""===a.edit.vlan_interface_settings.vlan_id?e:e+"."+a.edit.vlan_interface_settings.vlan_id;gapObj=d(p,"ipv6");return b=!0===gapObj.flag?q.poolValidateV6ByAddrAndPrefix("interfaces",g,"ipv6",gapObj.subnetObj,a.edit.ipv6.address.ip,a.edit.ipv6.address.prefix_length):q.poolValidateV6ByAddrAndPrefix("interfaces",g,"ipv6",
p,a.edit.ipv6.address.ip,a.edit.ipv6.address.prefix_length)};a.changeShareIPv4Session=function(){var b=a.edit;b.ipv6.setting.share_ipv4_pppoe_session?a.syncPPPoESession():(b.ipv6.setting.username="",b.ipv6.setting.password="")};a.syncPPPoESession=function(){var b=a.edit;"pppoe"===!b.ipv4.connectTypeList.selected||("pppoe"===!b.ipv6.connectTypeList.selected||!b.ipv6.setting.share_ipv4_pppoe_session)||(b.ipv6.setting.username=b.ipv4.setting.username,b.ipv6.setting.changed_password=!0,b.ipv6.setting.password=
b.ipv4.setting.changed_password?b.ipv4.setting.password:b.ipv4.setting.orig_password)};a.vlanIdNoRepeat=!0;a.checkEdit();a.chkAuthType();r(a.edit);s()}]);app.controller("wlan_wps_main",["$scope","$q","$log","MyHttp","rpcFns","$timeout","Sets","$filter","UserSession","userAccessRight","$uibModal",function(a,b,t,m,w,u,p,q,e,x,n){a.jumpToPage=app.TOOLS.jumpToPage;a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.wps=a.ctx.wps||{};a.loadReady=!1;a.forcedUsingPost=!0;var l={procBackground:!1,forcedUsingPost:a.forcedUsingPost},r=("https:"===document.location.protocol?"wss:":"ws:")+"//"+document.location.host+"/websocket",v;t=function(){v=new WebSocket(r);v.onopen=
function(a){v.send('{"type":"wps","interval":3,"timeout":1800}')};v.onclose=function(a){};v.onmessage=function(a){k(a)};v.onerror=function(a){}};var s=function(b){var c=a.DICT("WPS_Msg"),d=[],e,h,k,l,m;if(a.model_orig.wlans&&a.model_orig.wlans.ssid){for(var n=0;n<b.length;n++)l=k=0,e=b[n].substr(0,3),h=""===b[n].substr(4,1)?0:parseInt(b[n].substr(4,1)),m=!0,angular.forEach(a.model_orig.wlans.ssid,function(a,b){if(m&&("BOTH"===a.radio?(k++,l++):"WLAN1"===a.radio?k++:"WLAN2"===a.radio&&l++,"wl0"===
e&&k>h||"wl1"===e&&l>h))d.push(b),m=!1});b=d.filter(function(a,b,c){return c.indexOf(a)===b});for(n=0;n<b.length;n++){var p,q=a.model_orig.wlans.ssid,r=b[n];"BOTH"===q[r].radio?p="Both":"WLAN1"===q[r].radio?p="2.4G":"WLAN2"===q[r].radio&&(p="5G");c+=a.DICT("WPS_Msg_SSID",{"%s0":q[r].ssid,"%s1":p})}}return c},k=function(a){a=JSON.parse(a.data);a.wps_lock_status&&(a=s(a.wps_lock_status),app.TOOLS.criticalAlertBox({msg:a,cbk:function(a){if(a)return!0}}))};a.$on("$locationChangeStart",function(b,c,d){void 0===
a.wps&&v.close()});a.userAccessFlag=x.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();var d=function(){a.model={};var d=m.post({url:resource_base+"data/wlan_ssid.json",method:"get_wifi_settings",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),e=m.post({url:resource_base+"data/wlan_button_state.json",method:"get_wifi_button_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([d,e]).then(function(b){for(var d=
0;d<b.length;d++){var e=b[d].data.result,g=void 0;for(g in e)a.model[g]?p.recover_object(a.model[g],e[g]):angular.extend(a.model,e)}if((!a.wps||1!==a.wps.flag)&&a.model.wlans.ssid){b=a.model.wlans.ssid;for(d=b.length-1;0<=d;d--)(!b[d].enable||!b[d].wps.enable)&&b.splice(d,1);a.model.len=b.length}a.schema=a.schema||{};a.schema.enableStatus={"true":a.DICT("WPS_Enable"),"false":a.DICT("WPS_Disable")};c();a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.ctx.wps.ssididx=a.wps&&1===
a.wps.flag?a.wps.idx.toString():"0";a.resetModified();a.loadReady=!0})};d();void 0===a.wps&&t();a.resetPageVIew=function(b){"overview"==b&&(a.changeCurrPageTo("main"),u(function(){},100))};var c=function(){var b=a.model.wlans.ssid;b&&angular.forEach(b,function(a,b){a.radio&&(a.radio_rpc="BOTH"===a.radio?"WLAN1":a.radio)})};a.selected=a.selected||{};a.currPage="main";a.ctx.pageNav=[a.currPage];a.getCurrPage=function(){return a.currPage};a.pageMap=function(b){var c=!1;a.currPage==b&&(c=!0);return c};
a.ssid_radio_owner=function(){var b=a.model.wlans.ssid[a.ctx.wps.ssididx];if(b){var b=b.radio,c="";"BOTH"===b?c="both":"WLAN1"==b?c="2g":"WLAN2"==b?c="5g":Log(DEBUG,"Unknown Radio:"+b);return c}};a.ssid_radio_owner_rpc=function(b){var c=a.model.wlans.ssid[a.ctx.wps.ssididx];if(c)if(angular.isDefined(b))"2g"==b?c.radio_rpc="WLAN1":"5g"==b?c.radio_rpc="WLAN2":"both"==b?c.radio_rpc="WLAN1":Log(DEBUG,"Unknown newVal:"+b);else return b=c.radio_rpc,c="","BOTH"==b?c="2g":"WLAN1"==b?c="2g":"WLAN2"==b?c="5g":
Log(DEBUG,"Unknown Radio:"+b),c};a.ssid_radio_wps=function(){if(a.wps&&1===a.wps.flag)return a.wps.wps.enable;var b=a.ctx.wps.ssididx|0,b=""!==b&&a.model.wlans&&a.model.wlans.ssid?a.model.wlans.ssid[b]||"":"";return""!==b&&b.wps.enable?b.wps.enable:!1};a.ssid_radio_enable=function(){if(a.wps&&1===a.wps.flag)return a.wps.enable;var b=a.ctx.wps.ssididx|0,b=""!==b&&a.model.wlans&&a.model.wlans.ssid?a.model.wlans.ssid[b]||"":"";return""!==b&&b.enable?b.enable:!1};a.chkSecurity=function(){if(a.wps&&1===
a.wps.flag)return a.wps.security&&a.wps.security["mode-enabled"]&&("None"===a.wps.security["mode-enabled"]||"WPA2-Personal"===a.wps.security["mode-enabled"]||"WPA-WPA2-Personal"===a.wps.security["mode-enabled"])?!0:!1;var b=a.ctx.wps.ssididx|0,b=""!==b&&a.model.wlans&&a.model.wlans.ssid?a.model.wlans.ssid[b]||"":"";if(""!==b&&b.security)return b.security["mode-enabled"]&&("None"===b.security["mode-enabled"]||"WPA2-Personal"===b.security["mode-enabled"]||"WPA-WPA2-Personal"===b.security["mode-enabled"])?
!0:!1};a.getSecurity=function(){if(a.wps&&1===a.wps.flag)return a.wps.security&&a.wps.security["mode-enabled"]?a.wps.security["mode-enabled"]:"N/A";var b=a.ctx.wps.ssididx|0,b=a.model.wlans&&a.model.wlans.ssid&&a.model.wlans.ssid[b]||"";return b.security&&b.security["mode-enabled"]?b.security["mode-enabled"]:"N/A"};a.changeCurrPageTo=function(b){b!=a.currPage&&(a.ctx.pageNav.push(b),a.currPage=b);h(b)};a.changeCurrPageBack=function(){var b;1<a.ctx.pageNav.length&&(a.ctx.pageNav.pop(),b=a.ctx.pageNav[a.ctx.pageNav.length-
1],a.currPage=b,h(b));return b};var h=function(a){"main"!=a&&alert("unknown id:"+a)};a.filter_WLAN_Radio=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};a.collect_wlan_radio=function(b){return q("filter")(a.model.interfaces["interface"],a.filter_WLAN_Radio(b))};a.collect_orig_wlan_radio=function(b){return q("filter")(a.model_orig.interfaces["interface"],a.filter_WLAN_Radio(b))};a.RPC_PBC=function(a){alert("No action, RPC not defined")};a.RPC_gen_wps_pin=function(b,c){if(void 0==
b){var d=a.model.wlans.ssid[a.ctx.wps.ssididx];if(!d)return;b=d.ssid;d=d.radio_rpc}w.RPC_generic_send("generate-wps-pin",{ssid:b,radio:d,"pin-timeout":"0"===c?86401:60*c},function(b,c,d){a.ctx.wps.device_pin=d.pin?d.pin:"";a.RPC_ret_wps_pin()},void 0,l)};a.RPC_ret_wps_pin=function(){var b=a.model.wlans.ssid[a.ctx.wps.ssididx];b&&(b={ssid:b.ssid,radio:b.radio_rpc},a.resetModified(),w.RPC_generic_send("retrieve-wps-pin",b,function(b,c,d){d=d||{};a.ctx.wps.device_pin=d.pin?d.pin:"";a.ctx.wps.device_pin_status=
void 0!==d["pin-timeout"]?0<d["pin-timeout"]?"Valid":0===d["pin-timeout"]?"Expired":"N/A":d.errstr&&"Didn't set ap pin"===d.errstr?"Unconfigured":"N/A"},void 0,l))};$(function(){function a(){var b=$(this),c=b.find(".modal-dialog");b.css("display","block");c.css("margin-top",Math.max(0,($(window).height()-c.height())/2))}$(".modal").on("show.bs.modal",a);$(window).on("resize",function(){$(".modal:visible").each(a)})});a.press_wps=function(){n.open({animation:a.animationsEnabled,templateUrl:"wlan_wps_modal.htm",
controller:"presswps",size:"600",backdrop:"static",windowClass:"wps-modal",resolve:{model:function(){return a.model},ctx:function(){return a.ctx}}}).result.then(function(){})};a.register_wps_pin=function(b){n.open({animation:a.animationsEnabled,templateUrl:"wlan_wps_modal.htm",controller:"registerwps",size:"600",backdrop:"static",windowClass:"wps-modal",resolve:{model:function(){return a.model},ctx:function(){return a.ctx},pincode:function(){return b}}}).result.then(function(){})};a.save=function(){var b=
function(a){return angular.copy(a)}(a.collect_wlan_radio("^WLAN"));(function(){m.post({url:resource_base+"data/wlan_radio.json",method:"set_wifi_interfaces",params:{interfaces:{"interface":b}},success:function(b){a.resetPageVIew("overview")},error:function(b){a.resetPageVIew("overview");console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}})})();a.resetModified()};a.back=function(){a.changeCurrPageBack()};a.cancel=function(){a.loadReady=!1;a.model={};a.resetPageVIew("overview");d();
a.resetModified()};a.lifetimechk=function(){a.resetModified();if("0"===a.ctx.wps.lifetime){var b=a.DICT("WPS_Static_Pins_Security_Risk");app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})}};a.combineStr=a.DICT("WPS_Link",{"%s":"<a ng-click=\"jumpToPage('wlan_settings')\">"+a.DICT("Here")+"</a>"})}]);
app.controller("presswps",["$scope","$q","$uibModalInstance","rpcFns","model","ctx",function(a,b,t,m,w,u){a.model=w;a.ctx=u;a.funs={close:function(){t.close()}};var p={procBackground:!0,forcedUsingPost:!0};(function(){a.page=1;a.progress=0;a.response=-1;var b=100,e=setInterval(function(){b--;0<=b&&100>a.progress?a.progress++:(clearTimeout(e),a.page=0===a.response?5:1===a.response?2:3)},1200);(function(){var b=a.model.wlans.ssid[a.ctx.wps.ssididx],e=b.ssid;b&&m.RPC_generic_send("press-wps",{ssid:e,
radio:b.radio_rpc},function(b,e,m){m=m||{};Log(DEBUG,"RPC press-wps invoked");a.response=m.code;a.progress=100},void 0,p)})()})()}]);
app.controller("registerwps",["$scope","$q","$uibModalInstance","rpcFns","model","ctx","pincode",function(a,b,t,m,w,u,p){a.model=w;a.ctx=u;a.pincode=p;a.funs={close:function(){t.close()}};var q={procBackground:!0,forcedUsingPost:!0};(function(){a.page=1;a.progress=0;a.response=-1;var b=100,p=setInterval(function(){b--;0<=b&&100>a.progress?a.progress++:(clearTimeout(p),a.page=0===a.response?5:1===a.response?2:3===a.response?4:3)},1200);(function(){var b=a.model.wlans.ssid[a.ctx.wps.ssididx];b&&(b=
{ssid:b.ssid,radio:b.radio_rpc,pin:a.pincode.replace(" ","-")},m.RPC_generic_send("register-wps-device-pin",b,function(b,e,m){Log(DEBUG,"RPC register-wps-device-pin invoked");a.response=m.code;2===m.code&&""===m.errstr&&(a.response=3);a.progress=100},void 0,q))})()})()}]);var cp_delete_items=[];
app.controller("captive_portal_main",["$scope","$q","$log","MyHttp","oneTimeLocker","$timeout","GridRowBasedEditingAdv","$templateCache","Sets","wan_service","$filter","UserSession","userAccessRight",function(a,b,t,m,w,u,p,q,e,x,n,l,r){a.model=a.model||{};a.ctx=a.ctx||{};a.success=!1;a.loadReady=!1;a.userAccessFlag=r.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&l.logout();var v=function(){cp_delete_items=[];var d=m.post({url:resource_base+"data/portal_profiles.json",method:"get_portal_profile",
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),c=m.post({url:resource_base+"data/wlan_button_state.json",method:"get_wifi_button_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([d,c]).then(function(b){a.model={};for(var c=0;c<b.length;c++)s(b[c]);e.recover_object(a.model,{"portal-profiles":{"portal-profile":[]}});a.schema=a.schema||{};a.schema.enableStatus={"true":"Enable","false":"Disable"};a.schema.cpp_auth=
[{id:"auth",displayName:a.DICT("Captive_Portal_Auth")},{id:"noauth",displayName:a.DICT("Captive_Portal_No_Auth")}];a.schema.ux_font_color=[{id:"white",displayName:a.DICT("Captive_Portal_White")},{id:"red",displayName:a.DICT("Captive_Portal_Red")},{id:"green",displayName:a.DICT("Captive_Portal_Green")},{id:"gray",displayName:a.DICT("Captive_Portal_Gray")},{id:"blue",displayName:a.DICT("Captive_Portal_Blue")},{id:"magenta",displayName:a.DICT("Captive_Portal_Magenta")},{id:"cyan",displayName:a.DICT("Captive_Portal_Cyan")},
{id:"black",displayName:a.DICT("Captive_Portal_Black")}];a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.gridCPP.Options.data=a.model["portal-profiles"]["portal-profile"];a.loadReady=!0;u(function(){var b=w.get("WLAN_CP");if(b)switch(console.log("Jump from Wireless Basic Settings: "+JSON.stringify(b)),b.action){case "add":a.gridCPP.add()}},100)})};v();a.resetPageVIew=function(b){"overview"==b&&a.changeCurrPageTo("main")};var s=function(b){b=b.data.result;for(var c in b)a.model[c]?
e.recover_object(a.model[c],b[c]):angular.extend(a.model,b)};a.gridCPP={};a.currPage="main";a.ctx.pageNav=[a.currPage];a.getCurrPage=function(){return a.currPage};a.pageMap=function(b){var c=!1;a.currPage==b&&(c=!0);return c};a.changeCurrPageTo=function(b){b!=a.currPage&&(a.ctx.pageNav.push(b),a.currPage=b);k(b)};a.changeCurrPageBack=function(){var b;1<a.ctx.pageNav.length&&(a.ctx.pageNav.pop(),b=a.ctx.pageNav[a.ctx.pageNav.length-1],a.currPage=b,k(b));return b};a.redirectModeChoice=function(b){var c=
a.gridCPP.Selections[0];if(angular.isDefined(b))"redirect-auto"==b?(c["redirect-auto"]=null,c["original-url"]=void 0,c["redirect-url"]=void 0):"original-url"==b?(c["redirect-auto"]=void 0,c["original-url"]=null,c["redirect-url"]=void 0):"redirect-url"==b&&(c["redirect-auto"]=void 0,c["original-url"]=void 0,c["redirect-url"]=c["redirect-url-tmp"]);else if(c){b="";var e=c["redirect-auto"],g=c["original-url"],k=c["redirect-url"]||"";angular.isDefined(e)&&""!==e?b="redirect-auto":angular.isDefined(g)&&
""!==g?b="original-url":angular.isDefined(k)&&(b="redirect-url",c["redirect-url-tmp"]=k);return b}};a.chkDefProfile=function(b){b=a.gridCPP.Selections||"";for(var c=!1,e=0;e<b.length;e++)"Default_Portal_Profile"===b[e].name&&(c=!0);return c};a.modelRedirectUrlTmp=function(b){var c=a.gridCPP.Selections[0];if(angular.isDefined(b))c["redirect-url-tmp"]=b,c["redirect-url"]=b;else if(c)return b="",c["redirect-url-tmp"]&&(b=c["redirect-url-tmp"]),""!==c["redirect-url"]&&(b=c["redirect-url"]),b};var k=function(b){"main"==
b?a.gridCPP.Edit=!1:"ssidadd"==b?a.gridCPP.Edit=!0:"ssidedit"==b?a.gridCPP.Edit=!0:alert("unknown id:"+b)};a.save=function(){var b=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){angular.isDefined(a["redirect-url-tmp"])&&delete a["redirect-url-tmp"]});return a}(a.gridCPP.Selections),c=function(){1<a.gridCPP.Selections.length||m.post({url:resource_base+"data/portal_profiles.json",method:"set_portal_profile",params:{"portal-profiles":{"portal-profile":b}},success:function(b){a.success=
!0;a.resetPageVIew("overview");v()},error:function(b){a.resetPageVIew("overview");v();console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}})};(function(){for(var a=[],b=0;b<cp_delete_items.length;b++){var d={};d.name=cp_delete_items[b];a.push(d)}b={};0<a.length&&(b["portal-profiles"]={"portal-profile":a});angular.equals(b,{})?c():m.post({url:resource_base+"data/portal_profiles.json",method:"del_portal_profile",params:b,success:function(a){a.data&&(a.data.result&&a.data.result.code&&
0!==a.data.result.code)&&alert("Can not delete, following Tables is in use:\n"+a.data.result.errstr+"\n\n");c()},error:function(a){c();console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})();a.resetModified()};a.back=function(){a.changeCurrPageBack()};a.cancel=function(){a.loadReady=!1;a.model={};a.resetPageVIew("overview");v();a.resetModified()}}]);
app.controller("portal_profile_table",["$scope","$q","$log","MyHttp","$timeout","GridRowBasedEditingAdv","$templateCache","Sets","wan_service","$filter",function(a,b,t,m,w,u,p,q,e,x){a.gridCPP.edit=function(){a.ctx.ie_index=a.model["portal-profiles"]["portal-profile"].indexOf(a.gridCPP.Selections[0]);a.changeCurrPageTo("ssidedit")};a.gridCPP.openPortalPreview=function(a){window.open("portal/"+(a.entity.name||"")+"/login.html")};(function(){a.gridCPP.Selections=[];var b=function(){var b=a.model["portal-profiles"]["portal-profile"];
a.gridCPP.Selections=[];angular.forEach(b,function(b){b.checked&&a.gridCPP.Selections.push(b)})};a.gridCPP.Options=app.uiGrid.generateGridOptions({IDPreifx:"sslVPNGroup",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:b,headerChangedCbk:b},{field:"name",displayName:a.DICT("Captive_Portal_Porfile_Name")},{field:"redirect-url",displayName:a.DICT("Captive_Portal_Redirect_URL")},{field:"preview",displayName:"",enableSorting:!1,cellTemplate:p.get("UG_Portal_preview_button.html")}]});a.model["portal-profiles"]&&
a.model["portal-profiles"]["portal-profile"]&&(a.gridCPP.Options.data=a.model["portal-profiles"]["portal-profile"]);var e=function(a,b,e){e=e||"profile";for(var k=RegExp("^"+e+"(\\d+)"),d=0,c=a.length;c--;){var h,g;a&&(a[c]&&a[c][b])&&(h=a[c][b].match(k));h&&h[1]&&(g=parseInt(h[1]),d<g&&(d=g))}return e+(d+1)};a.gridCPP.add=function(){var b=a.model["portal-profiles"]["portal-profile"],m=e(b,"name","profile"),n={name:"",checked:!1,authentication:"auth","redirect-url":"","idle-timeout":1200,"portal-ux":{"font-color":"black",
"company-name":"","welcome-message":"","username-field":"","password-field":"","login-button-title":"",copyright:"","login-error-msg":"","login-error-msg2":"",agreement:{enable:!1,"agreement-text":"","agreement-title":"","acceptance-use-policy":""}}};angular.forEach(b,function(a){a.checked=!1});n.name=m;n.checked=!0;b.push(n);a.ctx.ie_index=b.length-1;a.gridCPP.Selections.splice(0,0,n);a.modified();w(function(){a.changeCurrPageTo("ssidadd")},45)};a.gridCPP.remove=function(){var b=a.model["portal-profiles"]["portal-profile"],
e;for(e=b.length-1;0<=e;e--)b[e].checked&&(cp_delete_items.push(b[e].name),b.splice(e,1));a.modified()};a.ctx.ie_index=0})()}]);
app.controller("portal_profile_edit",["$scope","MyHttp","Upload","$timeout",function(a,b,t,m){a.showShortName=function(a){var b="";angular.isDefined(a)&&(b=a.lastIndexOf("/"),b=0>b?a:a.substr(b+1));return b};a.bg_invalid=!1;a.logo_invalid=!1;a.chunkSize=512;var w=function(b,q,e){b.upload=t.upload({url:resource_base+"upload"+a.getReqParams(),resumeSizeUrl:q?resource_base+"upload?name22="+encodeURIComponent(b.name):null,resumeChunkSize:q?a.chunkSize:null,headers:{"optional-header":"header-value"},data:{sessionid:"EU6DJKEIWO",
pathparam:"Portal",profileparam:e.profileName||"",fileparam:e.filename,file:b}});b.upload.then(function(a){m(function(){b.result=a.data;Log(DEBUG,"web Upload done")})},function(b){0<b.status&&(a.errorMsg=b.status+": "+b.data);Log(ERROR,"do upload error")},function(a){b.progress=Math.min(100,parseInt(100*a.loaded/a.total))});b.upload.xhr(function(a){})};a.getReqParams=function(){return a.generateErrorOnServer?"?errorCode="+a.serverErrorCode+"&errorMessage="+a.serverErrorMsg:""};a.upload=function(b,
m){a.errorMsg=null;w(b,!1,m)};a.doFileUpload=function(){var b={},m=a.gridCPP.Selections[0],e=m.name;a.formUpload=!0;var t=function(l,m,n){var q=!0;null!=l&&(l.type.match(/^image\/(png|jpeg|gif|bmp)$/)?(b.filename=m+".png",b.profileName=e,a.upload(l,b),n&&n(l,b)):(alert("Unknown file type: "+l.name),q=!1));return q},n=t(a.ctx.bgPic,"bg",function(a,b){m["portal-ux"].background=m["portal-ux"].background||{};m["portal-ux"].background.uri=a.name}),t=t(a.ctx.logoPic,"logo",function(a,b){m["portal-ux"].logo=
m["portal-ux"].logo||{};m["portal-ux"].logo.uri=a.name});a.ctx.bgPic&&delete a.ctx.bgPic;a.ctx.logoPic&&delete a.ctx.logoPic;return n&&t};var u="<div>"+a.DICT("Captive_Portal_File_Format_Errstr1")+"</div><div>"+a.DICT("Captive_Portal_File_Format_Errstr2")+"</div><div>"+a.DICT("Captive_Portal_File_Format_Errstr3")+"</div>";a.bgFileFormatCheck=function(b){a.bg_invalid=!1;void 0!=b&&(a.ctx.bgPic=b,131072<parseInt(b.size)?(a.bg_invalid=!0,app.TOOLS.criticalAlertBox({msg:a.DICT("Captive_Portal_File_Size_Errstr",
{"%s":"128 kbytes"}),cbk:function(){}})):null==b.name.match(/^[0-9a-zA-Z\-\._]+(\.png|\.PNG|\.jpg|\.JPG|\.bmp|\.BMP|\.gif|\.GIF){1}$/)&&(a.bg_invalid=!0,app.TOOLS.criticalAlertBox({msg:u,cbk:function(){}})))};a.logoFileFormatCheck=function(b){a.logo_invalid=!1;void 0!=b&&(a.ctx.logoPic=b,10240<parseInt(b.size)?(a.logo_invalid=!0,app.TOOLS.criticalAlertBox({msg:a.DICT("Captive_Portal_File_Size_Errstr",{"%s":"10 kbytes"}),cbk:function(){}})):null==b.name.match(/^[0-9a-zA-Z\-\._]+(\.png|\.PNG|\.jpg|\.JPG|\.bmp|\.BMP|\.gif|\.GIF){1}$/)&&
(a.logo_invalid=!0,app.TOOLS.criticalAlertBox({msg:u,cbk:function(){}})))};a.save=function(){a.doFileUpload()?a.$parent.save():alert("File Upload fail, aborted")}}]);app.controller("wlan_adv_main",["$scope","$q","$log","MyHttp","$timeout","GridRowBasedEditingAdv","$templateCache","Sets","wan_service","$filter","UserSession","userAccessRight",function(a,b,t,m,w,u,p,q,e,x,n,l){a.model=a.model||{};a.ctx=a.ctx||{};a.model_wifi=a.model_wifi||{};a.model.radio24g=a.model.radio24g||{};a.model.radio5g=a.model.radio5g||{};a.model.transmission_rate_24G=a.model.transmission_rate_24G||{};a.model.transmission_rate_5G=a.model.transmission_rate_5G||{};a.model.rateBasic24G=[!1,
!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];a.model.rate24G=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];a.model.rateBasic5G=[!1,!1,!1,!1,!1,!1,!1,!1];a.model.rate5G=[!1,!1,!1,!1,!1,!1,!1,!1];a.model.htMCS24G=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];a.model.htMCS5G=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];a.model.trmAC1_enable=!1;a.model.trmAC2_enable=!1;a.model.trmAC3_enable=!1;a.model.trmAC4_enable=!1;a.model.trmAC1_value=
"";a.model.trmAC2_value="";a.model.trmAC3_value="";a.model.trmAC4_value="";a.success=!1;a.loadReady=!1;a.userAccessFlag=l.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var r=function(){var c=m.post({url:resource_base+"data/wlan_radio.json",method:"get_wifi_interfaces",params:{filter:"WLAN"},success:function(b){a.model_wifi=angular.copy(b.data.result);a.model.radio24g=d(a.model_wifi,"WLAN1");a.model.radio5g=d(a.model_wifi,"WLAN2");var c=a.model.radio24g.radio["transmission-rate"]["ht-mcs"]||
"",e=a.model.radio5g.radio["transmission-rate"]["ht-mcs"]||"";b=a.model.radio5g.radio["transmission-rate"]["vht-mcs"]||"";for(var g="",g="",h=0,g=a.model.radio24g.radio["transmission-rate"].rate?a.model.radio24g.radio["transmission-rate"].rate[0]||[]:[],k=a.model.radio5g.radio["transmission-rate"]["rate-basic"]?a.model.radio5g.radio["transmission-rate"]["rate-basic"][0]||[]:[],l=a.model.radio5g.radio["transmission-rate"].rate[0]?a.model.radio5g.radio["transmission-rate"].rate[0]||[]:[],m=(a.model.radio24g.radio["transmission-rate"]["rate-basic"]?
a.model.radio24g.radio["transmission-rate"]["rate-basic"][0]||[]:[]).split(" "),h=m.length,n=0;n<h;n++)switch(m[n]){case "1.0":a.model.rateBasic24G[0]=!0;break;case "2.0":a.model.rateBasic24G[1]=!0;break;case "5.5":a.model.rateBasic24G[2]=!0;break;case "6.0":a.model.rateBasic24G[3]=!0;break;case "9.0":a.model.rateBasic24G[4]=!0;break;case "11.0":a.model.rateBasic24G[5]=!0;break;case "12.0":a.model.rateBasic24G[6]=!0;break;case "18.0":a.model.rateBasic24G[7]=!0;break;case "24.0":a.model.rateBasic24G[8]=
!0;break;case "36.0":a.model.rateBasic24G[9]=!0;break;case "48.0":a.model.rateBasic24G[10]=!0;break;case "54.0":a.model.rateBasic24G[11]=!0}g=g.split(" ");h=g.length;for(n=0;n<h;n++)switch(g[n]){case "1.0":a.model.rate24G[0]=!0;break;case "2.0":a.model.rate24G[1]=!0;break;case "5.5":a.model.rate24G[2]=!0;break;case "6.0":a.model.rate24G[3]=!0;break;case "9.0":a.model.rate24G[4]=!0;break;case "11.0":a.model.rate24G[5]=!0;break;case "12.0":a.model.rate24G[6]=!0;break;case "18.0":a.model.rate24G[7]=
!0;break;case "24.0":a.model.rate24G[8]=!0;break;case "36.0":a.model.rate24G[9]=!0;break;case "48.0":a.model.rate24G[10]=!0;break;case "54.0":a.model.rate24G[11]=!0}g=parseInt(c,16).toString(2);if(24>g.length){h=24-g.length;for(n=0;n<h;n++)g="0"+g}for(n=0;24>n;n++)a.model.htMCS24G[n]="1"===g[n]?!0:!1;g=parseInt(e,16).toString(2);if(32>g.length){h=32-g.length;for(n=0;n<h;n++)g="0"+g}for(n=0;32>n;n++)a.model.htMCS5G[n]="1"===g[n]?!0:!1;c=k.split(" ");h=c.length;for(n=0;n<h;n++)switch(c[n]){case "6.0":a.model.rateBasic5G[0]=
!0;break;case "9.0":a.model.rateBasic5G[1]=!0;break;case "12.0":a.model.rateBasic5G[2]=!0;break;case "18.0":a.model.rateBasic5G[3]=!0;break;case "24.0":a.model.rateBasic5G[4]=!0;break;case "36.0":a.model.rateBasic5G[5]=!0;break;case "48.0":a.model.rateBasic5G[6]=!0;break;case "54.0":a.model.rateBasic5G[7]=!0}l=l.split(" ");h=l.length;for(n=0;n<h;n++)switch(l[n]){case "6.0":a.model.rate5G[0]=!0;break;case "9.0":a.model.rate5G[1]=!0;break;case "12.0":a.model.rate5G[2]=!0;break;case "18.0":a.model.rate5G[3]=
!0;break;case "24.0":a.model.rate5G[4]=!0;break;case "36.0":a.model.rate5G[5]=!0;break;case "48.0":a.model.rate5G[6]=!0;break;case "54.0":a.model.rate5G[7]=!0}a.model.trmAC1_value=b.s1;a.model.trmAC2_value=b.s2;a.model.trmAC3_value=b.s3;a.model.trmAC4_value=b.s4;a.model.trmAC1_enable=""===b.s1||"0"===b.s1?!1:!0;a.model.trmAC2_enable=""===b.s2||"0"===b.s2?!1:!0;a.model.trmAC3_enable=""===b.s3||"0"===b.s3?!1:!0;a.model.trmAC4_enable=""===b.s4||"0"===b.s4?!1:!0},error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}}),e=m.post({url:resource_base+"data/wlan_ssid.json",method:"get_wifi_settings",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),g=m.post({url:resource_base+"data/wlan_button_state.json",method:"get_wifi_button_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,e,g]).then(function(b){for(var c=0;c<b.length;c++)v(b[c]);s();a.schema=a.schema||{};a.schema.enableStatus={"true":"Enable",
"false":"Disable"};a.schema.basicRate_2g=[{id:"1",displayName:"1 Mbps"},{id:"5",displayName:"5.5 Mbps"},{id:"11",displayName:"11 Mbps"}];a.schema.basicRate_5g=[{id:"6",displayName:"6 Mbps"},{id:"12",displayName:"12 Mbps"},{id:"24",displayName:"24 Mbps"}];a.schema.transmitRate_2g=[{id:"1",displayName:"1 Mbps"},{id:"2",displayName:"2 Mbps"},{id:"5",displayName:"5.5 Mbps"},{id:"6",displayName:"6 Mbps"},{id:"9",displayName:"9 Mbps"},{id:"11",displayName:"11 Mbps"},{id:"12",displayName:"12 Mbps"},{id:"18",
displayName:"18 Mbps"},{id:"24",displayName:"24 Mbps"},{id:"36",displayName:"36 Mbps"},{id:"48",displayName:"48 Mbps"},{id:"54",displayName:"54 Mbps"}];a.schema.transmitRate_5g=[{id:"6",displayName:"6 Mbps"},{id:"9",displayName:"9 Mbps"},{id:"12",displayName:"12 Mbps"},{id:"18",displayName:"18 Mbps"},{id:"24",displayName:"24 Mbps"},{id:"36",displayName:"36 Mbps"},{id:"48",displayName:"48 Mbps"},{id:"54",displayName:"54 Mbps"}];a.schema.txpower=[{id:100,displayName:a.DICT("Advance_Settings_Full")},
{id:50,displayName:a.DICT("Advance_Settings_High")},{id:25,displayName:a.DICT("Advance_Settings_Medium")},{id:12,displayName:a.DICT("Advance_Settings_Low")}];a.schema.extChannel=[{id:"AboveControlChannel",displayName:a.DICT("Advance_Settings_Above_Control_Channel")},{id:"BelowControlChannel",displayName:a.DICT("Advance_Settings_Below_Control_Channel")}];a.schema.wlan2g_mode=[{name:"g",displayName:a.DICT("Advance_Settings_G_Only")},{name:"b g",displayName:a.DICT("Advance_Settings_B_G_Mixed")},{name:"g n",
displayName:a.DICT("Advance_Settings_G_N_Mixed")},{name:"b g n",displayName:a.DICT("Advance_Settings_B_G_N_Mixed")}];a.schema.wlan5g_mode=[{name:"a",displayName:a.DICT("Advance_Settings_A_Only")},{name:"n ac",displayName:a.DICT("Advance_Settings_N_AC_Mixed")},{name:"a n ac",displayName:a.DICT("Advance_Settings_A_N_AC_Mixed")}];a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.loadReady=!0;w(function(){},100)})};r();a.resetPageVIew=function(b){"overview"==b&&(a.changeCurrPageTo("main"),
w(function(){},100))};var v=function(b){b=b.data.result;for(var d in b)a.model[d]?q.recover_object(a.model[d],b[d]):angular.extend(a.model,b)},s=function(){a.use_ssid_sample={wlans:{ssid:[]}};q.recover_object(a.model,a.use_ssid_sample);a.use_wlanif_sample={radio:{enable:!0,"operating-standards":["b g n"],"operating-channel-bandwidth":"20MHz","extension-channel":"AboveControlChannel",channel:1,"uapsd-enable":!0,"beamforming-enable":!1,"frame-burst-enable":!1,"wmm-no-acknowledgement-enable":!1,"cts-protection-mode":"auto",
"beacon-interval":100,"dtim-period":1,"fragmentation-threshold":2346,"rts-threshold":2347}};var b=a.collect_wlan_radio("^WLAN");angular.forEach(b,function(b,c){q.recover_object(b,a.use_wlanif_sample)})};a.selected=a.selected||{};a.currPage="main";a.ctx.pageNav=[a.currPage];a.getCurrPage=function(){return a.currPage};a.pageMap=function(b){var d=!1;a.currPage==b&&(d=!0);return d};a.changeCurrPageTo=function(b){b!=a.currPage&&(a.ctx.pageNav.push(b),a.currPage=b);k(b)};a.changeCurrPageBack=function(){var b;
1<a.ctx.pageNav.length&&(a.ctx.pageNav.pop(),b=a.ctx.pageNav[a.ctx.pageNav.length-1],a.currPage=b,k(b));return b};var k=function(a){"main"!=a&&alert("unknown id:"+a)};a.filter_WLAN_Radio=function(a){return function(b,d,e){return b.name.match(a)?!0:!1}};a.collect_wlan_radio=function(b){return x("filter")(a.model.interfaces["interface"],a.filter_WLAN_Radio(b))};a.collect_orig_wlan_radio=function(b){return x("filter")(a.model_orig.interfaces["interface"],a.filter_WLAN_Radio(b))};var d=function(a,b){for(var d=
a.interfaces["interface"].length,e="",k={},l=0;l<d;l++)if(e=a.interfaces["interface"][l].name,e.match(b)){k=angular.copy(a.interfaces["interface"][l]);break}return k};a.getBasicRate24G=function(a){var b=[],d=0,e=0,k=0,l=0;if(""===a)return"bgn";b=a.split(" ");for(l=0;l<b.length;l++)"b"===b[l]&&(d=1),"g"===b[l]&&(e=1),"n"===b[l]&&(k=1);return 1===d&&0===e&&0===k?"b":"bgn"};a.getTrmRate24G=function(a){var b=[],d=0,e=0,k=0,l=0;if(""===a)return"bgn";b=a.split(" ");for(l=0;l<b.length;l++)"b"===b[l]&&(d=
1),"g"===b[l]&&(e=1),"n"===b[l]&&(k=1);return 1===d&&0===e&&0===k?"b":0===d&&1===e&&0===k||1===d&&1===e&&0===k?"bg":"bgn"};a.setToDefault24g=function(){var b="";a.model.radio24g=d(a.model_wifi,"WLAN1");a.model.radio24g&&(a.model.radio24g.radio&&a.model.radio24g.radio["operating-standards"])&&(b=a.model.radio24g.radio["operating-standards"].toString());a.model.rateBasic24G="g"===b||"g n"===b?[!0,!0,!0,!0,!1,!0,!0,!1,!0,!1,!1,!1]:[!0,!0,!0,!1,!1,!0,!1,!1,!1,!1,!1,!1];a.model.rate24G=[!0,!0,!0,!0,!0,
!0,!0,!0,!0,!0,!0,!0];a.model.htMCS24G=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0];a.modified()};a.setToDefault5g=function(){a.model.rateBasic5G=[!0,!1,!0,!1,!0,!1,!1,!1];a.model.rate5G=[!0,!0,!0,!0,!0,!0,!0,!0];a.model.htMCS5G=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0];a.model.trmAC1_enable=!0;a.model.trmAC2_enable=!0;a.model.trmAC3_enable=!0;a.model.trmAC4_enable=!0;a.model.trmAC1_value="fff";a.model.trmAC2_value=
"fff";a.model.trmAC3_value="fff";a.model.trmAC4_value="fff";a.modified()};a.pressGroup=function(b){switch(b){case "antenna1":!1===a.model.trmAC1_enable?(a.model.trmAC2_enable=!1,a.model.trmAC3_enable=!1,a.model.trmAC4_enable=!1,a.model.trmAC1_value="0",a.model.trmAC2_value="0",a.model.trmAC3_value="0",a.model.trmAC4_value="0"):"0"===a.model.trmAC1_value&&(a.model.trmAC1_value="fff");break;case "antenna2":!1===a.model.trmAC2_enable?(a.model.trmAC3_enable=!1,a.model.trmAC4_enable=!1,a.model.trmAC2_value=
"0",a.model.trmAC3_value="0",a.model.trmAC4_value="0"):"0"===a.model.trmAC2_value&&(a.model.trmAC2_value="fff");break;case "antenna3":!1===a.model.trmAC3_enable?(a.model.trmAC4_enable=!1,a.model.trmAC3_value="0",a.model.trmAC4_value="0"):"0"===a.model.trmAC3_value&&(a.model.trmAC3_value="fff");break;case "antenna4":!1===a.model.trmAC4_enable?a.model.trmAC4_value="0":"0"===a.model.trmAC4_value&&(a.model.trmAC4_value="fff")}};a.save=function(){for(var b="",b="",d=0,e=b="",e=[],k=[],l=[],n=[],p=function(a){return angular.copy(a)}(a.collect_wlan_radio("^WLAN")),
q=0;q<p.length;q++)if("WLAN1"===p[q].name){!0===a.model.rateBasic24G[0]&&e.push(1);!0===a.model.rateBasic24G[1]&&e.push(2);!0===a.model.rateBasic24G[2]&&e.push(5.5);!0===a.model.rateBasic24G[3]&&e.push(6);!0===a.model.rateBasic24G[4]&&e.push(9);!0===a.model.rateBasic24G[5]&&e.push(11);!0===a.model.rateBasic24G[6]&&e.push(12);!0===a.model.rateBasic24G[7]&&e.push(18);!0===a.model.rateBasic24G[8]&&e.push(24);!0===a.model.rateBasic24G[9]&&e.push(36);!0===a.model.rateBasic24G[10]&&e.push(48);!0===a.model.rateBasic24G[11]&&
e.push(54);!0===a.model.rate24G[0]&&k.push(1);!0===a.model.rate24G[1]&&k.push(2);!0===a.model.rate24G[2]&&k.push(5.5);!0===a.model.rate24G[3]&&k.push(6);!0===a.model.rate24G[4]&&k.push(9);!0===a.model.rate24G[5]&&k.push(11);!0===a.model.rate24G[6]&&k.push(12);!0===a.model.rate24G[7]&&k.push(18);!0===a.model.rate24G[8]&&k.push(24);!0===a.model.rate24G[9]&&k.push(36);!0===a.model.rate24G[10]&&k.push(48);!0===a.model.rate24G[11]&&k.push(54);b="";for(d=0;24>d;d++)b=!0===a.model.htMCS24G[d]?"1"+b:"0"+
b;b=parseInt(b,2);b=b.toString(16);e={mode:"Manual","rate-basic":e,rate:k,"ht-mcs":b};p[q].radio["transmission-rate"]=e;break}for(q=0;q<p.length;q++)if("WLAN2"===p[q].name){!0===a.model.rateBasic5G[0]&&l.push(6);!0===a.model.rateBasic5G[1]&&l.push(9);!0===a.model.rateBasic5G[2]&&l.push(12);!0===a.model.rateBasic5G[3]&&l.push(18);!0===a.model.rateBasic5G[4]&&l.push(24);!0===a.model.rateBasic5G[5]&&l.push(36);!0===a.model.rateBasic5G[6]&&l.push(48);!0===a.model.rateBasic5G[7]&&l.push(54);!0===a.model.rate5G[0]&&
n.push(6);!0===a.model.rate5G[1]&&n.push(9);!0===a.model.rate5G[2]&&n.push(12);!0===a.model.rate5G[3]&&n.push(18);!0===a.model.rate5G[4]&&n.push(24);!0===a.model.rate5G[5]&&n.push(36);!0===a.model.rate5G[6]&&n.push(48);!0===a.model.rate5G[7]&&n.push(54);b="";for(d=0;32>d;d++)b=!0===a.model.htMCS5G[d]?"1"+b:"0"+b;b=parseInt(b,2);e=b.toString(16);e={mode:"Manual","rate-basic":l,rate:n,"ht-mcs":e,"vht-mcs":{s1:a.model.trmAC1_value,s2:a.model.trmAC2_value,s3:a.model.trmAC3_value,s4:a.model.trmAC4_value}};
p[q].radio["transmission-rate"]=e;break}(function(){m.post({url:resource_base+"data/wlan_radio.json",method:"set_wifi_interfaces",params:{interfaces:{"interface":p}},success:function(b){a.success=!0;a.resetPageVIew("overview")},error:function(b){a.resetPageVIew("overview");console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}})})();a.resetModified()};a.back=function(){a.changeCurrPageBack()};a.cancel=function(){a.loadReady=!1;a.model={};a.resetPageVIew("overview");r();a.resetModified()}}]);
app.controller("wlan_radio",["$scope","$q","$log","MyHttp","$templateCache","Sets","wan_service",function(a,b,t,m,w,u,p){}]);app.controller("wlan_settings_main",["$scope","$q","$uibModal","MyHttp","oneTimeLocker","$timeout","GridRowBasedEditingOper","$templateCache","Sets","wan_service","$filter","UserSession","userAccessRight","$uibModalStack","goToPreviousPage",function(a,b,t,m,w,u,p,q,e,x,n,l,r,v,s){var k=app.TOOLS.getResponse;a.goback=s.goback;a.backbtn=!1;a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.wlanOpt=a.ctx.wlanOpt||{};a.ctx.spec=a.ctx.spec||{};a.success=!1;a.loadReady=!1;a.bulk=[];a.flags=a.flags||{};a.flags.leaflist_sep_as_space=
!1;a.show_pwd=!1;a.model.orig_groups=[];a.model.ssid2gruop={};a.model.auth_groups=[];a.model.nacm_groups=[];a.userAccessFlag=r.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&l.logout();s.isneed()&&(a.backbtn=!0);a.ctx.spec.maxVAPprofiles=4;a.ctx.spec.maxMACAddrs=66;a.ctx.wlanOpt.showExtCh=!1;a.ctx.wlanOpt.showPriCh=!0;var d=("https:"===document.location.protocol?"wss:":"ws:")+"//"+document.location.host+"/websocket",c,h=function(b){var c=a.DICT("Wlan_Basic_Settings_WPS_Lock_Msg1"),d=[],e,
g,h,k,l,m;if(a.model_orig.wlans&&a.model_orig.wlans.ssid){for(m=0;m<b.length;m++)k=h=0,e=b[m].substr(0,3),g=""===b[m].substr(4,1)?0:parseInt(b[m].substr(4,1),10),l=!0,angular.forEach(a.model_orig.wlans.ssid,function(a,b){if(l&&("BOTH"===a.radio?(h++,k++):"WLAN1"===a.radio?h++:"WLAN2"===a.radio&&k++,"wl0"===e&&h>g||"wl1"===e&&k>g))d.push(b),l=!1});b=d.filter(function(a,b,c){return c.indexOf(a)===b});for(m=0;m<b.length;m++){var n,p=a.model_orig.wlans.ssid,q=b[m];"BOTH"===p[q].radio?n=a.DICT("Wlan_Basic_Settings_Both"):
"WLAN1"===p[q].radio?n=a.DICT("Wlan_Basic_Settings_24G"):"WLAN2"===p[q].radio&&(n=a.DICT("Wlan_Basic_Settings_5G"));c+=a.DICT("Wlan_Basic_Settings_WPS_Lock_Msg2",{"%s0":p[q].ssid,"%s1":n})}}return c},g=function(b){b=JSON.parse(b.data);b.wps_ssid_status&&app.TOOLS.criticalAlertBox({msg:a.DICT("Wlan_Basic_Settings_Refreshed_Msg"),cbk:function(b){v.dismissAll();a.cancel()}});b.wps_lock_status&&(b=h(b.wps_lock_status),app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){if(a)return!0}}))};a.$on("$locationChangeStart",
function(a,b,d){c.close()});var A=function(b){b||(b={});b=b.groups&&b.groups.group||[];var c;a.model.auth_groups=[];a.model.ssid2gruop={};a.model.orig_groups=angular.copy(b);angular.forEach(b,function(b){a.model.auth_groups.push({id:b.name,displayName:b.name});c={};angular.forEach(b["feature-rule"],function(a){"ssid"===a.service&&(c=a)});angular.forEach(c.option,function(c){a.model.ssid2gruop[c]||(a.model.ssid2gruop[c]={});a.model.ssid2gruop[c][b.name]=!0})})},y=function(){a.model={};a.bulk=[];var c=
m.post({url:resource_base+"data/wlan_radio.json",method:"get_wifi_interfaces",params:{filter:"WLAN"},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),d=m.post({url:resource_base+"data/wlan_ssid.json",method:"get_wifi_settings",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),e=m.post({url:resource_base+"data/schedule.json",method:"get_schedule",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),
g=m.post({url:resource_base+"data/portal_profiles.json",method:"get_portal_profile",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),h=m.post({url:resource_base+"data/wlan_radio_state.json",method:"get_radio_state",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),l=m.post({url:resource_base+"data/wlan_vlan_list.json",method:"get_interface_list",params:{filter:"VLAN"},success:function(b){b.data&&(b.data.result&&b.data.result.interfaces&&
b.data.result.interfaces["interface"])&&(a.model.vlanlist=angular.copy(b.data.result.interfaces["interface"]))},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),n=m.post({url:resource_base+"data/wlan_button_state.json",method:"get_wifi_button_state",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),p=m.post({url:resource_base+"data/nacm_group.json",method:"get_groups",error:function(a){A()}});b.all([c,d,e,g,h,l,n,p]).then(function(b){a.model.wlans&&
(a.model.wlans.ssid=[]);a.model.interfaces&&(a.model.interfaces["interface"]=[]);D(b[0]);D(b[1]);D(b[2]);D(b[3]);D(b[4]);D(b[6]);A(k(b,7));E();I();B();a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.model["interfaces-state"]&&a.model["interfaces-state"]["interface"]&&C();a.vld.check_radio_mode();a.vld.check_ssid_wmm();a.gridWLANSSID.Options.data=a.model.wlans.ssid;a.loadReady=!0})};y();(function(){c=new WebSocket(d);c.onopen=function(a){c.send('{"type":"wps","interval":3,"timeout":1800}')};
c.onclose=function(a){};c.onmessage=function(a){g(a)};c.onerror=function(a){}})();var z=function(b){var c=angular.copy(a.use_macfilter_sample);e.recover_object(b,c);b=b["mac-filter"]["filtered-macs"];for(var c=a.ctx.spec.maxMACAddrs,d=b.length;d<c;d++)b.push(angular.copy(a.use_macaddr_sample))};a.genVapWithBlankAddr=function(){var b=angular.copy(a.use_vap_sample);z(b);return b};var B=function(){angular.forEach(a.model.interfaces["interface"],function(a,b){"WLAN1"===a.name&&void 0===a.radio["max-associated-clients"]?
a.radio["max-associated-clients"]=50:"WLAN2"===a.name&&void 0===a.radio["max-associated-clients"]&&(a.radio["max-associated-clients"]=124)})};a.resetPageVIew=function(b){"overview"==b&&a.changeCurrPageTo("main")};var D=function(b){b=b||{};b=(b.data||{}).result||{};for(var c in b)a.model[c]?e.recover_object(a.model[c],b[c]):angular.extend(a.model,b)},E=function(){a.use_ssid_sample={wlans:{ssid:[]}};e.recover_object(a.model,a.use_ssid_sample);a.use_schedule_sample={schedules:{schedule:[]}};e.recover_object(a.model,
a.use_schedule_sample);a.use_macfilter_sample={"mac-filter":{enable:!1,"filtered-macs":[]}};a.use_macaddr_sample={"mac-address":"",action:"block"};a.use_vap_sample=angular.extend({},{name:"VAP",type:"ieee80211"},a.use_macfilter_sample);a.use_wlanif_sample={radio:{enable:!0,"operating-standards":["b g n"],"operating-channel-bandwidth":"20MHz","extension-channel":"BelowControlChannel",channel:1,"uapsd-enable":!0,"beamforming-enable":!1,"frame-burst-enable":!1,"wmm-no-acknowledgement-enable":!1,"cts-protection-mode":"auto",
"beacon-interval":100,"dtim-period":1,"fragmentation-threshold":2346,"rts-threshold":2347}};var b=a.collect_wlan_radio("^WLAN");angular.forEach(b,function(b,c){e.recover_object(b,a.use_wlanif_sample)});a.use_portal_profiles_sample={"portal-profiles":{"portal-profile":[]}};e.recover_object(a.model,a.use_portal_profiles_sample)},C=function(){function b(a,c){return parseInt(a.ch)-parseInt(c.ch)}var c=[],d=[],e=/(^[0-9]+$)/,g=/(u$)/,h=/(l$)/,k=/(\/80$)/;a.schema.wlan2g_ch_dyn=[];a.schema.wlan5g_ch_dyn=
[];angular.forEach(a.model["interfaces-state"]["interface"],function(a,b){"WLAN1"===a.name&&a.radio["possible-channel"]&&a.radio["possible-channel"][0]?c=a.radio["possible-channel"][0].split(" "):"WLAN2"===a.name&&(a.radio["possible-channel"]&&a.radio["possible-channel"][0])&&(d=a.radio["possible-channel"][0].split(" "))});if(c.length){var l=[],m=[],n=[],p,q,r,s,t={ch:p,ext:q,band:r,displayName:s};p="auto";q="AB";r="20/40";s="Auto";t={ch:p,ext:q,band:r,displayName:s};a.schema.wlan2g_ch_dyn.push(t);
for(var u=0;u<c.length;u++)c[u].match(e)?(p=c[u],p=parseInt(p),q="",r="20",s="Channel "+p,t={ch:p,ext:q,band:r,displayName:s},l.push(t)):c[u].match(g)?(p=c[u].replace(/u/g,""),p=parseInt(p),q="B",r="40",s="Channel "+p,t={ch:p,ext:q,band:r,displayName:s},m.push(t)):c[u].match(h)&&(p=c[u].replace(/l/g,""),p=parseInt(p),q="A",r="40",s="Channel "+p,t={ch:p,ext:q,band:r,displayName:s},n.push(t));l.sort(b);m.sort(b);n.sort(b);Array.prototype.push.apply(a.schema.wlan2g_ch_dyn,l);Array.prototype.push.apply(a.schema.wlan2g_ch_dyn,
m);Array.prototype.push.apply(a.schema.wlan2g_ch_dyn,n)}if(d.length){l=[];m=[];n=[];t=[];p={ch:p,ext:q,band:r,displayName:s};p={ch:"auto",ext:"AB",band:"20/40/80",displayName:"Auto"};a.schema.wlan5g_ch_dyn.push(p);for(u=0;u<d.length;u++)d[u].match(e)?(p=d[u],p=parseInt(p),q="",r="20",s="Channel "+p,p={ch:p,ext:q,band:r,displayName:s},l.push(p)):d[u].match(g)?(p=d[u].replace(/u/g,""),p=parseInt(p),q="B",r="40",s="Channel "+p,p={ch:p,ext:q,band:r,displayName:s},m.push(p)):d[u].match(h)?(p=d[u].replace(/l/g,
""),p=parseInt(p),q="A",r="40",s="Channel "+p,p={ch:p,ext:q,band:r,displayName:s},n.push(p)):d[u].match(k)&&(p=d[u].replace(/\/80/g,""),p=parseInt(p),q="",r="80",s="Channel "+p,p={ch:p,ext:q,band:r,displayName:s},t.push(p));l.sort(b);m.sort(b);n.sort(b);t.sort(b);Array.prototype.push.apply(a.schema.wlan5g_ch_dyn,l);Array.prototype.push.apply(a.schema.wlan5g_ch_dyn,m);Array.prototype.push.apply(a.schema.wlan5g_ch_dyn,n);Array.prototype.push.apply(a.schema.wlan5g_ch_dyn,t)}},I=function(){a.schema=a.schema||
{};a.schema.enableStatus={"true":a.DICT("Wlan_Basic_Settings_Enable"),"false":a.DICT("Wlan_Basic_Settings_Disable")};"Always On"!==a.model.schedules.schedule[0].name&&a.model.schedules.schedule.unshift({name:"Always On"});"New ..."!==a.model["portal-profiles"]["portal-profile"][0].name&&a.model["portal-profiles"]["portal-profile"].unshift({name:"New ..."});a.schema.extChannel=[{id:"AboveControlChannel",displayName:a.DICT("Wlan_Basic_Settings_Above_Control_Channel")},{id:"BelowControlChannel",displayName:a.DICT("Wlan_Basic_Settings_Below_Control_Channel")}];
a.schema.priChannel=[{id:"AboveControlChannel",displayName:a.DICT("Wlan_Basic_Settings_Lower")},{id:"BelowControlChannel",displayName:a.DICT("Wlan_Basic_Settings_Upper")}];a.schema.wlan2g_mode=[{name:"b",displayName:a.DICT("Wlan_Basic_Settings_B_Only")},{name:"g",displayName:a.DICT("Wlan_Basic_Settings_G_Only")},{name:"n",displayName:a.DICT("Wlan_Basic_Settings_N_Only")},{name:"b g",displayName:a.DICT("Wlan_Basic_Settings_B_G_Mixed")},{name:"g n",displayName:a.DICT("Wlan_Basic_Settings_G_N_Mixed")},
{name:"b g n",displayName:a.DICT("Wlan_Basic_Settings_B_G_N_Mixed")}];a.schema.wlan5g_mode=[{name:"a",displayName:a.DICT("Wlan_Basic_Settings_A_Only")},{name:"n ac",displayName:a.DICT("Wlan_Basic_Settings_N_AC_Mixed")},{name:"a n ac",displayName:a.DICT("Wlan_Basic_Settings_A_N_AC_Mixed")}];a.schema.wlan2g_ch=[{ch:"auto",ext:"AB",band:"20/40",displayName:a.DICT("Wlan_Basic_Settings_Auto")},{ch:1,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel1")},{ch:2,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel2")},
{ch:3,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel3")},{ch:4,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel4")},{ch:5,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel5")},{ch:6,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel6")},{ch:7,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel7")},{ch:8,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel8")},{ch:9,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel9")},
{ch:10,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel10")},{ch:11,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel2")},{ch:1,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel1")},{ch:2,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel2")},{ch:3,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel3")},{ch:4,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel4")},{ch:5,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel5")},
{ch:6,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel6")},{ch:7,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel7")},{ch:5,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel5")},{ch:6,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel6")},{ch:7,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel7")},{ch:8,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel8")},{ch:9,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel9")},
{ch:10,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel10")},{ch:11,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel11")}];a.schema.wlan5g_ch=[{ch:"auto",ext:"AB",band:"20/40/80",displayName:a.DICT("Wlan_Basic_Settings_Auto")},{ch:36,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel36")},{ch:40,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel40")},{ch:44,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel44")},{ch:48,ext:"",
band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel48")},{ch:52,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel52")},{ch:56,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel56")},{ch:60,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel60")},{ch:64,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel64")},{ch:100,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel100")},{ch:104,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel104")},
{ch:108,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel108")},{ch:112,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel112")},{ch:116,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel116")},{ch:132,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel132")},{ch:136,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel136")},{ch:140,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel140")},{ch:149,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel149")},
{ch:153,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel153")},{ch:157,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel157")},{ch:161,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel161")},{ch:165,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel165")},{ch:36,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel36")},{ch:40,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel40")},{ch:44,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel44")},
{ch:48,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel48")},{ch:52,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel52")},{ch:56,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel56")},{ch:60,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel60")},{ch:64,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel64")},{ch:100,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel100")},{ch:104,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel104")},
{ch:108,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel108")},{ch:112,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel112")},{ch:132,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel132")},{ch:136,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel136")},{ch:149,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel149")},{ch:153,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel153")},{ch:157,ext:"A",band:"40",
displayName:a.DICT("Wlan_Basic_Settings_Channel157")},{ch:161,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel161")},{ch:42,ext:"",band:"80",displayName:a.DICT("Wlan_Basic_Settings_Channel42")},{ch:58,ext:"",band:"80",displayName:a.DICT("Wlan_Basic_Settings_Channel58")},{ch:106,ext:"",band:"80",displayName:a.DICT("Wlan_Basic_Settings_Channel106")},{ch:155,ext:"",band:"80",displayName:a.DICT("Wlan_Basic_Settings_Channel155")}];a.schema.ssid_secumode=[{id:"None",displayName:a.DICT("Wlan_Basic_Settings_None")},
{id:"WEP-64",displayName:a.DICT("Wlan_Basic_Settings_WEP64")},{id:"WEP-128",displayName:a.DICT("Wlan_Basic_Settings_WEP128")},{id:"WPA2-Personal",displayName:a.DICT("Wlan_Basic_Settings_WPA2_Personal")},{id:"WPA-WPA2-Personal",displayName:a.DICT("Wlan_Basic_Settings_WPA_WPA2_Personal")},{id:"WPA2-Enterprise",displayName:a.DICT("Wlan_Basic_Settings_WPA2_Enterprise")},{id:"WPA-WPA2-Enterprise",displayName:a.DICT("Wlan_Basic_Settings_WPA_WPA2_Enterprise")}];a.schema.vlanids=[];a.model.vlanlist?(angular.forEach(a.model.vlanlist,
function(b,c){b.name&&b.name.match(/^VLAN/)&&a.schema.vlanids.push(parseInt(b.name.replace(/VLAN/g,"")))}),a.schema.vlanids.sort(function(a,b){return a-b})):a.schema.vlanids.push(1)};a.vld={editable_2G_wmm:!0,editable_5G_wmm:!0,limit_2G_mode:!1,limit_5G_mode:!1,check_radio_mode:function(){var b=a.collect_wlan_radio("WLAN1")[0].radio,c=a.collect_wlan_radio("WLAN2")[0].radio,d=a.model.wlans.ssid||[],e;a.vld.editable_2G_wmm=!0;a.vld.editable_5G_wmm=!0;angular.forEach(d,function(a){a.editableWMM=!0});
console.log(b);b.enable&&"n"===b["operating-standards"][0]&&(a.vld.editable_2G_wmm=!1,angular.forEach(d,function(b){e=a.radioGetterRule(b);if(b.enable&&("2g"===e||"both"===e))b["wmm-enable"]=!0,b.editableWMM=!1}));c.enable&&"n ac"===c["operating-standards"][0]&&(a.vld.editable_5G_wmm=!1,angular.forEach(d,function(b){e=a.radioGetterRule(b);if(b.enable&&("5g"===e||"both"===e))b["wmm-enable"]=!0,b.editableWMM=!1}))},check_ssid_wmm:function(){var b=a.model.wlans.ssid||[];a.collect_wlan_radio("WLAN1");
a.collect_wlan_radio("WLAN2");var c;a.vld.limit_2G_mode=!0;a.vld.limit_5G_mode=!0;angular.forEach(b,function(b){b.editableWMM=!0;if(b.enable)switch(c=a.radioGetterRule(b),c){case "2g":a.vld.editable_2G_wmm?b["wmm-enable"]&&(a.vld.limit_2G_mode=!1):(b["wmm-enable"]=!0,b.editableWMM=!1,a.vld.limit_2G_mode=!1);break;case "5g":a.vld.editable_5G_wmm?b["wmm-enable"]&&(a.vld.limit_5G_mode=!1):(b["wmm-enable"]=!0,b.editableWMM=!1,a.vld.limit_5G_mode=!1);break;case "both":a.vld.editable_2G_wmm&&a.vld.editable_5G_wmm?
b["wmm-enable"]&&(a.vld.limit_2G_mode=!1,a.vld.limit_5G_mode=!1):(b["wmm-enable"]=!0,b.editableWMM=!1,a.vld.limit_2G_mode=!1,a.vld.limit_5G_mode=!1)}})}};a.selected=a.selected||{};a.gridWLANSSID=a.gridWLANSSID||{};a.currPage="main";a.ctx.pageNav=[a.currPage];a.getCurrPage=function(){return a.currPage};a.pageMap=function(b){var c=!1;a.currPage==b&&(c=!0);return c};a.getWorkingVapBy=function(a,b){var c;(c=a._tbl_mac2g)||Log(ERROR,"error: getWorkingVapBy() vapref not exist");return c};a.getVAPUsage=
function(b){var c=0,d=0,e=0;if(a.model.wlans&&a.model.wlans.ssid)for(var g=0;g<a.model.wlans.ssid.length;g++)"WLAN1"===a.model.wlans.ssid[g].radio?c++:"WLAN2"===a.model.wlans.ssid[g].radio?d++:"BOTH"===a.model.wlans.ssid[g].radio&&(c++,d++,e++);if("2g"==b)return c;if("5g"==b)return d;if("both"==b)return e};a.isAddMaxExceed=function(){var b=!1,c=a.getVAPUsage("2g"),d=a.getVAPUsage("5g"),e=a.ctx.spec.maxVAPprofiles;c>=e&&d>=e&&(b=!0);return b};a.filter_isKeyInused=function(b,c){return function(d,e,
g){return d!==c&&d.ssid==c.ssid&&(d=a.radioGetterRule(d),Log(DEBUG,"itemtype "+d),d==b||"both"==d&&("2g"==b||"5g"==b)||"both"==b&&("2g"==d||"5g"==d))?!0:!1}};a.radioApplyRule=function(b,c){var d=!1,e=n("filter")(a.model.wlans.ssid,a.filter_isKeyInused(c,b)),g=a.getVAPUsage(c),h=a.ctx.spec.maxVAPprofiles,k=a.radioGetterRule(b);c==k&&"both"!=k?g--:"both"==k&&g--;var l=!1;if(("2g"==c||"5g"==c)&&g>=h)l=!0;else{var g=a.getVAPUsage("2g"),m=a.getVAPUsage("5g");"2g"==k?g--:"5g"==k?m--:"both"==k&&(g--,m--);
if("both"==c&&(g>=h||m>=h))l=!0}0>=e.length&&!1==l&&(d=!0);return d};a.changeCurrPageTo=function(b){if("maclist"===b){var c=a.gridWLANSSID.Selections[0];c["mac-filter"]&&(a.macfilter_backup=angular.copy(c["mac-filter"]["filtered-macs"]))}b!=a.currPage&&(a.ctx.pageNav.push(b),a.currPage=b);G(b)};a.changeCurrPageBack=function(){var b;1<a.ctx.pageNav.length&&(a.ctx.pageNav.pop(),b=a.ctx.pageNav[a.ctx.pageNav.length-1],a.currPage=b,G(b));return b};var G=function(b){"maclist"!=b&&"wps"!=b&&("main"==b?
a.gridWLANSSID.Edit=!1:"ssidedit"==b?a.gridWLANSSID.Edit=!0:alert("unknown id:"+b))};a.filter_WLAN_Radio=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};a.collect_wlan_radio=function(b){if(a.model.interfaces&&a.model.interfaces["interface"])return n("filter")(a.model.interfaces["interface"],a.filter_WLAN_Radio(b))};a.collect_orig_wlan_radio=function(b){return n("filter")(a.model_orig.interfaces["interface"],a.filter_WLAN_Radio(b))};a.filter_w2g_channel=function(a,b,c){var d=c.replace(/^([0-9]+)[^0-9]+/,
"$1");return function(a,e,g){return(e=a.band.match(d))&&"40MHz"==c&&a.ext.match(b)||e&&"40MHz"!==c?!0:!1}};a.filter_w5g_channel=function(a,b,c){var d=c.replace(/^([0-9]+)[^0-9]+/,"$1");return function(a,e,g){return(e=a.band.match(d))&&"40MHz"==c&&a.ext.match(b)||e&&"40MHz"!==c?!0:!1}};a.getCurrChannelList=function(b,c){if(b){var d=[],d=b.radio["operating-channel-bandwidth"],e;switch(b.radio["extension-channel"]){case "BelowControlChannel":e="B";break;case "AboveControlChannel":e="A"}"w2g"==c?("20/40MHz"===
d&&(d="40MHz"),d=void 0===a.schema.wlan2g_ch_dyn||void 0===a.schema.wlan2g_ch_dyn[0]?n("filter")(a.schema.wlan2g_ch,a.filter_w2g_channel(c,e,d)):n("filter")(a.schema.wlan2g_ch_dyn,a.filter_w2g_channel(c,e,d))):d=void 0===a.schema.wlan5g_ch_dyn||void 0===a.schema.wlan5g_ch_dyn[0]?n("filter")(a.schema.wlan5g_ch,a.filter_w5g_channel(c,e,d)):n("filter")(a.schema.wlan5g_ch_dyn,a.filter_w5g_channel(c,e,d));return d}};a.updateChannel=function(a,b,c){for(var d=!0,e=100,g={},h,k=0,l=0;l<b.length;l++)if(h=
b[l],k=Math.abs(h.ch-c),0==k){d=!1;break}else k<e&&(e=k,g=h);d&&(a.radio.channel=g.ch)};a.channelGetterSetter=function(a,b){if(angular.isDefined(a))"auto"===a?(b.radio["autoChannel-enable"]=!0,b.radio.channel=""):(b.radio["autoChannel-enable"]=!1,b.radio.channel=a);else{var c;c=b.radio["autoChannel-enable"]?"auto":b.radio.channel;""==c&&(c="auto");return c}};a.w2gChannelGetterSetter=function(b){if(a.collect_wlan_radio("WLAN1")){var c=a.collect_wlan_radio("WLAN1")[0];return a.channelGetterSetter(b,
c)}};a.w5gChannelGetterSetter=function(b){if(a.collect_wlan_radio("WLAN2")){var c=a.collect_wlan_radio("WLAN2")[0];return a.channelGetterSetter(b,c)}};a.getExtChannelList=function(b){b=[];return b=a.schema.extChannel};a.isChannelBandWidthEquals=function(a,b){if(b&&b.radio&&b.radio["operating-channel-bandwidth"])return null!=b.radio["operating-channel-bandwidth"].match(a)};a.getPriChannelList=function(b){b=[];return b=a.schema.priChannel};a.radioGetterRule=function(a){a=a.radio;var b="";"BOTH"==a?
b="both":"WLAN1"==a?b="2g":"WLAN2"==a?b="5g":Log(ERROR,"Unknown Radio Combination:"+radio1+", "+radio2);return b};a.showRadioState=function(b){return{"2g":"2.4G","5g":"5G",both:"Both"}[a.radioGetterRule(b)]};a.ssid_radio_owner=function(b){var c=a.gridWLANSSID.Selections[0];if(arguments.length)"2g"==b?c.radio="WLAN1":"5g"==b?c.radio="WLAN2":"both"==b?c.radio="BOTH":Log(DEBUG,"Unknown newVal:"+b),a.vld.check_ssid_wmm();else return a.radioGetterRule(c)};a.scheduleChoice=function(b){var c=a.gridWLANSSID.Selections[0];
if(angular.isDefined(b))"Always On"==b?(c["always-on"]=null,c.schedule=void 0):(c["always-on"]=void 0,c.schedule=b);else if(c)return b="",b=c.schedule,angular.isDefined(b)&&""!==b||(c["always-on"]=null,b="Always On"),b};a.filter_mac_by_column=function(a,b){return function(c,d,e){c=Math.ceil(e.length/b);return Math.floor(d/c)==a?!0:!1}};a.collect_mac_list=function(b,c){var d=a.gridWLANSSID.Selections[0];z(d);return n("filter")(d["mac-filter"]["filtered-macs"],a.filter_mac_by_column(b,c))};a.getColLen=
function(b){return Math.ceil(a.gridWLANSSID.Selections[0]["mac-filter"]["filtered-macs"].length/b)};var H=function(c){var d,e=[];if(a.ctx.orig_ssid){var g=m.post({url:resource_base+"data/ssid_state.json",method:"get_ssid_state",params:{filter:a.ctx.orig_ssid},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([g]).then(function(a){d=k(a,0);intfs=d["interfaces-state"]&&d["interfaces-state"]["interface"]||[];e=K(intfs);c(e)}).catch(function(a){Log(ERROR,"=="+
a);c(e)})}else e=[],c(e)},F=function(){for(var b=0,c=0,d=a.gridWLANSSID.Selections[0],e=a.model.wlans.ssid,g=a.model.wlans.ssid.indexOf(d),h=0;h<g;h++)"WLAN1"===e[h].radio?b++:"WLAN2"===e[h].radio?c++:"BOTH"===e[h].radio&&(b++,c++);"WLAN1"===d.radio?(b++,c=0):"WLAN2"===d.radio?(b=0,c++):"BOTH"===d.radio?(b++,c++):c=b=0;return{"2g":0===b?"":"VAP1_"+b,"5g":0===c?"":"VAP2_"+c}},K=function(b){var c=[],d=0,e=F(),g=e["2g"]||"",h=e["5g"]||"";b||(b=[]);angular.forEach(b,function(b,e){if(""!==g&&b.name.match(g)||
""!==h&&b.name.match(h))angular.forEach(b.ssid["associated-device"]||[],function(e,g){d+=1;c.push({count:d,mac:void 0!==e["link-layer-address"]?e["link-layer-address"]:"",ip:void 0!==e.ip?e.ip:"",radio:b.ssid&&b.ssid["radio-ref"]?"WLAN1"===b.ssid["radio-ref"]?a.DICT("Wlan_Basic_Settings_24G"):a.DICT("Wlan_Basic_Settings_5G"):"",mode:void 0!==e["operating-standard"]?e["operating-standard"].toUpperCase():"",auth:void 0!==e["authentication-state"]?e["authentication-state"]?a.DICT("Wlan_Basic_Settings_TRUE"):
a.DICT("Wlan_Basic_Settings_FALSE"):"",signal:void 0!==e["signal-strength"]?e["signal-strength"]:"",noise:void 0!==e.noise?e.noise:"",time:void 0!==e["connect-time"]?e["connect-time"]:""})})});return c};a.showClientList=function(){H(function(b){t.open({animation:a.animationsEnabled,templateUrl:"show_client_list.html",controller:"showClientList",size:"wlan-client-list",backdrop:"static",resolve:{clientlist:function(){return b}}}).result.then(function(){})})};a.openWPS=function(){t.open({animation:a.animationsEnabled,
templateUrl:"wlan_wps.html",controller:"openWPS",size:"lg",backdrop:"static",resolve:{wps:function(){var b={},b=angular.copy(a.gridWLANSSID.Selections[0]);b.flag=1;b.idx=a.ctx.ie_index;return b}}}).result.then(function(){})};a.updateUserMacAddr=function(a){var b=function(a){var b=[];if(a["mac-filter"]&&a["mac-filter"]["filtered-macs"]){b=a["mac-filter"]["filtered-macs"];for(a=b.length-1;0<=a;a--)""==b[a]["mac-address"]&&b.splice(a,1)}};a._tbl_mac2g&&b(a._tbl_mac2g);a._tbl_mac5g&&b(a._tbl_mac5g)};
a.getMacFilterList=function(b){var c=[],d=[],e=0,g=0,h=function(b,c,d,e){b=b["mac-filter"]["filtered-macs"];c[e]=angular.copy(a.use_vap_sample);c[e].name=d+(e+1);var g=c[e]["mac-filter"]["filtered-macs"],h="";angular.forEach(b,function(a,b){0===b&&(h=a.action);g.push({"mac-address":a["mac-address"],action:h})})};angular.forEach(b,function(b,k){a.updateUserMacAddr(b);var l=a.radioGetterRule(b);if("2g"==l||"both"==l){var m=b._tbl_mac2g;h(m,c,"VAP1_",e);"both"==l&&(d[g]=angular.copy(c[e]),d[g].name=
"VAP2_"+(g+1),g++);e++}else"5g"==l&&(m=b._tbl_mac5g,h(m,d,"VAP2_",g),g++)});return c.concat(d)};a.updateBeamforming=function(a){a.radio.mimo&&(a.radio["beamforming-enable"]=!0)};a.chkWpsSecurity=function(){if("ssidedit"===a.currPage){var b=a.gridWLANSSID.Selections[0]||"",c=b.security["mode-enabled"]||"";!0===(b.wps.enable||"")&&("WEP-64"===c||"WEP-128"===c||"WPA-Personal"===c||"WPA-Enterprise"===c||"WPA2-Enterprise"===c||"WPA-WPA2-Enterprise"===c)?app.TOOLS.warningAlertBox({msg:"WPS will be disabled due to WPS only supports WPA2-Personal, WPA2-Personal Mixed and non-security. Are you sure you want to continue?",
cbk:function(b){b&&(a.gridWLANSSID.Selections[0].wps.enable=!1,a.chkBroadcast())}}):"None"===c?app.TOOLS.warningAlertBox({msg:"None security is a security risk. Are you sure you want to continue?",cbk:function(b){b&&a.chkBroadcast()}}):a.chkBroadcast()}else a.chkBroadcast()};a.chkBroadcast=function(){if("ssidedit"===a.currPage){var b=a.gridWLANSSID.Selections[0]||"",c=b["ssid-advertisment-enable"];!0===(b.wps.enable||"")&&!1===c?app.TOOLS.warningAlertBox({msg:"WPS will be disabled due to SSID Broadcast is disabled. Are you sure you want to continue?",
cbk:function(b){b&&(a.gridWLANSSID.Selections[0].wps.enable=!1,a.chkCpVlan())}}):a.chkCpVlan()}else if("main"===a.currPage){var d=0;angular.forEach(a.model.wlans.ssid,function(a,b){!1===a["ssid-advertisment-enable"]&&!0===a.wps.enable&&(d=1)});d?app.TOOLS.warningAlertBox({msg:"WPS will be disabled due to SSID Broadcast is disabled. Are you sure you want to continue?",cbk:function(b){b&&(angular.forEach(a.model.wlans.ssid,function(a,b){!1===a["ssid-advertisment-enable"]&&!0===a.wps.enable&&(a.wps.enable=
!1)}),a.chkCpVlan())}}):a.chkCpVlan()}else a.chkCpVlan()};a.chkCpVlan=function(){if("ssidedit"===a.currPage){var b=a.gridWLANSSID.Selections[0]||"",c=b["captive-portal"]||"",d=b.vlan_id||"",e=0,g=0,h=0;angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===d&&(e++,a["captive-portal"]!==c&&(g=1),!0===a["captive-portal-enable"]&&h++)});if(1<h&&1<e&&1===g)b=a.DICT("Wlan_Basic_Settings_SSID_Same_VLAN_Msg",{"%s0":d,"%s1":c}),app.TOOLS.warningAlertBox({msg:b,cbk:function(b){b&&(angular.forEach(a.model.wlans.ssid,
function(a,b){a.vlan_id===d&&(a["captive-portal"]=c)}),a.save())}});else{if(!0===b["captive-portal-enable"]||0===h)angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===d&&(a["captive-portal"]=c)});else{var b=a.model.wlans.ssid.indexOf(b),k=a.model_orig.wlans.ssid[b];angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===d&&(a["captive-portal"]=k["captive-portal"])})}a.save()}}else a.save()};a.chkSave=function(){a.chkWpsSecurity()};a.save=function(){for(var b=function(a){a=angular.copy(a);
angular.forEach(a,function(a,b){if(a["mac-filter"]&&a["mac-filter"]["filtered-macs"])for(var c=a["mac-filter"]["filtered-macs"],d=c.length-1;0<=d;d--)""==c[d]["mac-address"]&&c.splice(d,1)});return a}(a.collect_wlan_radio("^WLAN")),c=["1.0 2.0 5.5 6.0 11.0 12.0 24.0"],d=["1.0 2.0 5.5 11.0"],e=["1.0 2.0 5.5 6.0 9.0 11.0 12.0 18.0 24.0 36.0 48.0 54.0"],g=["6.0 12.0 24.0"],h=["6.0 9.0 12.0 18.0 24.0 36.0 48.0 54.0"],k={s1:"fff",s2:"fff",s3:"fff",s4:"fff"},l=0;l<b.length;l++)if(b[l].name&&"WLAN1"===b[l].name){if(b[l].radio&&
b[l].radio["operating-standards"]){var n=b[l].radio["operating-standards"][0]||"";if(""!==n&&a.model_orig&&a.model_orig.interfaces&&a.model_orig.interfaces["interface"]){var p=a.model_orig.interfaces["interface"];angular.forEach(p,function(a){a.name&&("WLAN1"===a.name&&a.radio&&a.radio["operating-standards"]&&n!==a.radio["operating-standards"][0])&&(b[l].radio["transmission-rate"]["rate-basic"]="g"===n||"g n"===n?angular.copy(c):angular.copy(d),b[l].radio["transmission-rate"].rate=angular.copy(e),
b[l].radio["transmission-rate"]["ht-mcs"]=angular.copy("ffffff"))})}}}else b[l].name&&"WLAN2"===b[l].name&&(b[l].radio&&b[l].radio["operating-standards"])&&(n=b[l].radio["operating-standards"][0]||"",""!==n&&(a.model_orig&&a.model_orig.interfaces&&a.model_orig.interfaces["interface"])&&(p=a.model_orig.interfaces["interface"],angular.forEach(p,function(a){a.name&&("WLAN2"===a.name&&a.radio&&a.radio["operating-standards"]&&n!==a.radio["operating-standards"][0])&&(b[l].radio["transmission-rate"]["rate-basic"]=
angular.copy(g),b[l].radio["transmission-rate"].rate=angular.copy(h),b[l].radio["transmission-rate"]["ht-mcs"]=angular.copy("ffffffff"),b[l].radio["transmission-rate"]["vht-mcs"]=angular.copy(k))})));(function(){var b=[],c,d=a.model.wlans.ssid;angular.forEach(a.model_orig.wlans.ssid,function(e){c=!1;angular.forEach(d,function(a){e.ssid===a.ssid&&(c=!0)});c||(b.push(e),a.model.ssid2gruop[e.ssid]=void 0)})})();(function(){var b=[],c,d;"ssidedit"===a.currPage&&(b=a.gridWLANSSID.Selections[0],a.model.ssid2gruop[b.ssid]||
(a.model.ssid2gruop[b.ssid]={}),c=a.model.ssid2gruop[b.ssid],angular.forEach(c,function(a,b){c[b]=!1}),angular.forEach(a.model.nacm_groups,function(a){a.group.select&&(c[a.group.select]=!0)}));b=angular.copy(a.model.orig_groups);d={};angular.forEach(a.model.auth_groups,function(a){d[a.id]=[]});angular.forEach(a.model.ssid2gruop,function(a,b){angular.forEach(a,function(a,c){d[c]&&a&&d[c].push(b)})});angular.forEach(b,function(a){angular.forEach(a["feature-rule"],function(b){"ssid"===b.service&&(b.option=
d[a.name]?d[a.name]:[])})});a.bulk.push({method:"set_groups",params:{groups:{group:b}}})})();(function(){var c=function(a){var b=function(a,b,c){c!=b&&angular.isDefined(a.security[c])&&delete a.security[c]};angular.forEach(a,function(a,c){if(a.security&&a.security["mode-enabled"]){var d=a.security["mode-enabled"];b(a,d,"None");b(a,d,"WEP-64");b(a,d,"WEP-128");b(a,d,"WPA-Personal");b(a,d,"WPA-WPA2-Personal");b(a,d,"WPA2-Personal");b(a,d,"WPA-Enterprise");b(a,d,"WPA2-Enterprise");b(a,d,"WPA-WPA2-Enterprise")}angular.isDefined(a.checked)&&
delete a.checked;angular.isDefined(a.disableChk)&&delete a.disableChk})},d=function(a){angular.forEach(a,function(a,b){a._tbl_mac2g&&delete a._tbl_mac2g;a._tbl_mac5g&&delete a._tbl_mac5g})},e=function(a){a=angular.copy(a);c(a);d(a);return a}(a.model.wlans.ssid);a.bulk.push({method:"set_wifi_interfaces",params:{interfaces:{"interface":b}}});a.bulk.push({method:"set_wifi_settings",params:{wlans:{ssid:e}}});m.post({method:"set_bulk",params:a.bulk,success:function(b){a.success=!0;a.loadReady=!1;a.resetPageVIew("overview");
y()},error:function(b){a.loadReady=!1;y()}})})();a.resetModified()};a.back=function(){a.changeCurrPageBack()};a.cancel=function(){a.loadReady=!1;a.model={};a.resetPageVIew("overview");y();a.resetModified()};a.macfilter_cancel=function(){a.gridWLANSSID.Selections[0]["mac-filter"]["filtered-macs"]=angular.copy(a.macfilter_backup);a.changeCurrPageBack()};a.set_2g_bandwidth=function(b){a.vld.check_radio_mode();if("b"===b.radio["operating-standards"][0]||"g"===b.radio["operating-standards"][0]||"b g"===
b.radio["operating-standards"][0])b.radio["operating-channel-bandwidth"]="20MHz"};a.set_5g_bandwidth=function(b){a.vld.check_radio_mode();"a"===b.radio["operating-standards"][0]&&(b.radio["operating-channel-bandwidth"]="20MHz")};a.captive_portal_chk=function(b){if(!b["captive-portal-enable"]){b=a.model.nacm_groups;var c;for(c=b.length-1;0<=c;c--)b.splice(c,1);a.checkNacmGroupList()}};a.chkJump=function(b,c){if(b&&"New ..."===b["captive-portal"])10<a.model["portal-profiles"]["portal-profile"].length?
app.TOOLS.criticalAlertBox({msg:"Maximum limit of 10 Captive Portal entries is reached.",cbk:function(a){a&&(b["captive-portal"]=c)}}):app.TOOLS.warningAlertBox({msg:'Would you like to redirect this page to "Add Captive Portal Profile"?',cbk:function(d){d?a.pageActionJump("CP","add"):b["captive-portal"]=c}});else if(b&&"main"===a.currPage){var d=b["captive-portal"]||"",e=b.vlan_id||"",g=0,h=0,k=0;angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===e&&(g++,a["captive-portal"]!==d&&(h=1),!0===
a["captive-portal-enable"]&&k++)});1<k&&1<g&&1===h?app.TOOLS.warningAlertBox({msg:"SSIDs associated with the same VLAN("+e+") must be associated with the same Captive Protal profile("+d+"). Are you sure you want to continue?",cbk:function(g){g?angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===e&&(a["captive-portal"]=d)}):b["captive-portal"]=c}}):angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===e&&(a["captive-portal"]=d)})}};a.model.nacm_groups=[];a.disableNacmGroupAddBtn=!1;
var M=function(){var b=angular.copy(a.model.auth_groups),c;angular.forEach(a.model.nacm_groups,function(a){for(c=b.length-1;0<=c;c--)b[c].id===a.group.select&&b.splice(c,1)});return b};a.checkNacmGroupList=function(){var b=M();a.disableNacmGroupAddBtn=0===b.length;angular.forEach(a.model.nacm_groups,function(a){a.group.list=[{id:a.group.select,displayName:a.group.select}];a.group.list=a.group.list.concat(b)})};a.nacmGroupSelectedCnt=0;a.nacmGroupCheckboxCbk=function(){a.nacmGroupSelectedCnt=0;angular.forEach(a.model.nacm_groups,
function(b){b.checked?a.nacmGroupSelectedCnt+=1:b.edit=!1})};a.editNacmGroup=function(){angular.forEach(a.model.nacm_groups,function(a){a.checked&&(a.edit=!0)})};a.addNacmGroup=function(){var b=M();a.model.nacm_groups.push({checked:!0,edit:!0,group:{select:b[0].id,list:[]}});a.checkNacmGroupList()};a.deleteNacmGroup=function(){var b=a.model.nacm_groups,c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);a.checkNacmGroupList()};a.gridNacmGroupOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",
isCheckbox:!0,headerChangedCbk:a.nacmGroupCheckboxCbk,changedCbk:a.nacmGroupCheckboxCbk},{field:"group",editRow:"edit",cellTemplate:"UG_table_select_with_inline_edit.html",changedCbk:a.checkNacmGroupList}]});a.pageJump=function(a){var b={CP:"captive_portal"}[a];b||alert("unknown pageId:"+a);a=document.location;document.location.href=a.protocol+"//"+a.host+a.pathname+"#/"+b};var N=function(a){return{action:a}};a.pageActionJump=function(b,c){var d={CP:{lockerID:"WLAN_CP",prepareItem_cb:N}},e=d[b].lockerID,
d=d[b].prepareItem_cb(c);w.put(e,d);a.pageJump(b)}}]);app.controller("wlan_radio",["$scope",function(a){}]);
app.controller("wlan_ssid",["$scope","$q","$uibModal","MyHttp","$timeout","GridRowBasedEditingOper","$templateCache","Sets","wan_service","$filter",function(a,b,t,m,w,u,p,q,e,x){a.gridWLANSSID.remove=function(){var b,e=a.model.wlans.ssid;for(b=e.length-1;0<=b;b--)e[b].checked&&e.splice(b,1);a.ctx.orig_ssid="";a.modified()};a.gridWLANSSID.editItem=function(){var b=a.gridWLANSSID.Selections[0];a.show_pwd=!1;a.ctx.ie_index=a.model.wlans.ssid.indexOf(b);a.ctx.orig_ssid=b.ssid;a.model.nacm_groups=[];angular.forEach(a.model.ssid2gruop[b.ssid],
function(b,e){a.model.nacm_groups.push({checked:!1,edit:!1,group:{select:e,list:[]}})});a.checkNacmGroupList();a.gridNacmGroupOptions.data=a.model.nacm_groups;a.changeCurrPageTo("ssidedit")};(function(){a.T_cellEdit=p.get("T_editWithNoFoucs_by_rowEditableState_objs.html");a.gridWLANSSID.rowEditableState=[];a.gridWLANSSID.Selections=[];a.gridWLANSSID.procNgClick=function(b){b=a.model.wlans.ssid.length||0;var e=a.model.wlans.ssid;if(b)for(var m=0;m<b;m++)void 0===a.model.wlans.ssid[m].checked&&(a.model.wlans.ssid[m].checked=
!1);a.gridWLANSSID.Selections=[];angular.forEach(e,function(b,e){b.checked&&a.gridWLANSSID.Selections.push(b)})};a.gridWLANSSID.Options=app.uiGrid.generateGridOptions({IDPreifx:"WLANSSID",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridWLANSSID.procNgClick,headerChangedCbk:a.gridWLANSSID.procNgClick,disableChkBoxField:"disableChk"},{field:"enable",displayName:a.DICT("Wlan_Basic_Settings_Enable"),width:80,cellTemplate:p.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/g,"ng-change='grid.appScope.vld.check_ssid_wmm()'")},
{field:"ssid",displayName:a.DICT("Wlan_Basic_Settings_SSID_Name"),minWidth:170},{field:"radio1",displayName:a.DICT("Wlan_Basic_Settings_Radio"),width:80,cellTemplate:p.get("UG_CellText_WL_radio_state.html")},{field:"ssid-advertisment-enable",displayName:a.DICT("Wlan_Basic_Settings_SSID_Broadcast"),width:130,cellTemplate:p.get("UG_table_checkbox_2.html")},{field:"security.mode-enabled",displayName:a.DICT("Wlan_Basic_Settings_Security_Mode"),width:160},{field:"mac-filter.enable",displayName:a.DICT("Wlan_Basic_Settings_MAC_Filter"),
width:130,cellTemplate:p.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.enableStatus[MODEL_COL_FIELD]")},{field:"vlan_id",displayName:a.DICT("Wlan_Basic_Settings_VLAN"),width:80},{field:"isolation-with-ssid",displayName:a.DICT("Wlan_Basic_Settings_Wireless_Isolation_Within_SSID"),width:220,cellTemplate:p.get("UG_table_checkbox_2.html")},{field:"wmm-enable",displayName:a.DICT("Wlan_Basic_Settings_WMM"),width:80,cellTemplate:p.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/g,
"ng-change='grid.appScope.vld.check_ssid_wmm()'; ng-disabled='!row.entity.editableWMM'")},{field:"wps.enable",displayName:a.DICT("Wlan_Basic_Settings_WPS"),width:80,cellTemplate:p.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/g,"ng-disabled=\"row['entity']['security']['mode-enabled'] === 'WEP-64' \t\t\t\t\t\t|| row['entity']['security']['mode-enabled'] === 'WEP-128' \t\t\t\t\t\t|| row['entity']['security']['mode-enabled'] === 'WPA-Personal' \t\t\t\t\t\t|| row['entity']['security']['mode-enabled'] === 'WPA-Enterprise' \t\t\t\t\t\t|| row['entity']['security']['mode-enabled'] === 'WPA2-Enterprise' \t\t\t\t\t\t|| row['entity']['security']['mode-enabled'] === 'WPA-WPA2-Enterprise'\"")},
{field:"captive-portal-enable",displayName:a.DICT("Wlan_Basic_Settings_Captive_Portal"),width:200,cellTemplate:p.get("UG_WL_CaptivePortal.html")}]});a.gridWLANSSID.add=function(){var b={ssid:"",radio:"BOTH",enable:!0,"ssid-advertisment-enable":!0,security:{"mode-enabled":"None"},"wmm-enable":!0,"isolation-with-ssid":!1,pmf:"not-required",vlan_id:1,"mac-filter":{enable:!0},wps:{enable:!1},"captive-portal":"Default_Portal_Profile"};a.model.wlans.ssid.push(b);w(function(){b&&(a.gridWLANSSID.Selections=
[],a.gridWLANSSID.Selections.push(b),a.ctx.orig_ssid="",a.model.nacm_groups=[],a.checkNacmGroupList(),a.gridNacmGroupOptions.data=a.model.nacm_groups,a.changeCurrPageTo("ssidedit"))},45);a.modified()}})()}]);
app.controller("wlan_ssid_edit",["$scope",function(a){a.input_type="password";a.showSecuMode=function(a,t){var m=!1;"wpa-psk"==t?m="WPA-Personal"==a||"WPA2-Personal"==a||"WPA-WPA2-Personal"==a:"wpa"==t?m="WPA-Enterprise"==a||"WPA2-Enterprise"==a||"WPA-WPA2-Enterprise"==a:"wep"==t&&(m="WEP-64"==a||"WEP-128"==a);return m};a.securityWarning=function(){var b=a.gridWLANSSID.Selections[0];"None"===b.security["mode-enabled"]?b.pmf="not-required":"WEP-64"===b.security["mode-enabled"]||"WEP-128"===b.security["mode-enabled"]?
(b.pmf="not-required",a.msg=a.DICT("Wlan_Basic_Settings_WEP_Authentication_Msg"),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}})):(b.pmf="capable",a.msg=a.DICT("Wlan_Basic_Settings_Msg"),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}))};a.show_pwd=function(){a.input_type="password"==a.input_type?"text":"password"}}]);
app.controller("showClientList",["$scope","clientlist","$uibModalInstance","UserSession","userAccessRight",function(a,b,t,m,w){a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();a.loadReady=!1;a.clientlist=b;a.funs={close:function(){t.close()}};a.gridClientList=app.uiGrid.generateGridOptions({data:a.clientlist,columnDefs:[{field:"count",displayName:a.DICT("Wlan_Basic_Settings_No"),resizable:!0,minWidth:65},{field:"mac",displayName:a.DICT("Wlan_Basic_Settings_MAC_Addr"),
resizable:!0,minWidth:145},{field:"ip",displayName:a.DICT("Wlan_Basic_Settings_IP_Addr"),resizable:!0,minWidth:145},{field:"radio",displayName:a.DICT("Wlan_Basic_Settings_Radio"),resizable:!0,minWidth:80},{field:"mode",displayName:a.DICT("Wlan_Basic_Settings_Mode"),resizable:!0,minWidth:80},{field:"auth",displayName:a.DICT("Wlan_Basic_Settings_Authentication"),resizable:!0,minWidth:120},{field:"signal",displayName:a.DICT("Wlan_Basic_Settings_Signal_Strength"),resizable:!0,minWidth:120},{field:"noise",
displayName:a.DICT("Wlan_Basic_Settings_Noise_Level"),resizable:!0,minWidth:120},{field:"time",displayName:a.DICT("Wlan_Basic_Settings_Time_Connected"),resizable:!0,minWidth:130}]});a.loadReady=!0}]);app.controller("openWPS",["$scope","$uibModalInstance","wps",function(a,b,t){a.wps=t;a.funs={close:function(){b.close()}}}]);
