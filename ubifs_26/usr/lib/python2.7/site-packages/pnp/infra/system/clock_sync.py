################################################################################
# Copyright (c) 2015-17 by Cisco Systems, Inc.
# All rights reserved.
#
# Author: Shaurin Desai <shaurdes@cisco.com>
################################################################################
"""System Clock Synchronization

This file provides access to the Clock Sync API implementation found in the
pnp_platform module. If the API implementation is not found, it is not
guaranteed that an HTTPS connection can be established with Server (HTTPS can
fail due to invalid system clock outside of the certificate validity period).

Note:
    This file should be the ONLY file to import from the Clock Sync API
    implementation provided by pnp_platform.infra.clock_sync. Any pnp
    files making calls to the Clock Sync API should import this file and
    redefine the imported objects, if necessary.

"""
import email.utils as eut

from pnp.infra.api.pnp_infra import PnPInfra
try:
    from pnp_platform.infra.clock_sync import ClockSync
    if not issubclass(ClockSync, PnPInfra):
        raise ImportError("ClockSync implementation does not confrom to "
                          "PnPInfra API")
except ImportError:
    from pnp.infra.api.clock_sync import ClockSync


def set_http_clock_into_system(rfc1123_clock):
    """This function takes the clock taken from an HTTP header and syncs the
    system clock.

    Args:
        rfc1123_clock (str): Clock in the RFC1123 format
            example: 'Thu, 13 Jul 2017 00:53:35 GMT'

    Returns:
        bool: True if system clock is synced successfully, False otherwise.
    """
    date_tup = eut.parsedate(rfc1123_clock)
    year, month_index, day, hour, minute, sec = date_tup[:6]
    months = ('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sept',
              'Oct', 'Nov', 'Dec')
    month = months[month_index-1]
    return ClockSync.set_system_clock(year, month, day, hour, minute, sec)

