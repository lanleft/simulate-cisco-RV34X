var resource_base="./",local_database=!1,emulator=!1,app=window.angular.module("routerApp","ngRoute ngGrid ui.bootstrap ui.grid ui.grid.treeView ui.grid.expandable ui.grid.pagination ui.grid.resizeColumns ui.grid.autoResize ui.grid.selection errorModule ngMessages chart.js ngFileUpload ngCookies ngSanitize ngDialog ngAnimate".split(" ")),DEBUG=0,INFO=1,WARN=2,ERROR=3,FATAL=4,debug=ERROR,Log=function(a,b){a>=debug&&console.log(new Date+":"+JSON.stringify(b))},webOpt={WebHTTPReqestMaxRetryCounter:3,
WebCompileWaitCounter:10,WebCompileWaitDuration:2E3};app.factory("TreeData",function(){var a;return{setTree:function(b){a=b},getTree:function(){return a}}});app.filter("DICT",["multiLanguageService",function(a){return function(b,s){return a.getString(b,s)}}]);app.filter("ngColumns_hideInMenu",function(){return function(a){return a.filter(function(a){return!a.colDef.hideInMenu})}});
app.filter("capitalize",function(){return function(a,b){null!==a&&void 0!==a&&(a=a.toLowerCase());return a.substring(0,1).toUpperCase()+a.substring(1)}});
app.factory("GridRowBasedEditingAdv",["$timeout","$q",function(a,b){var s={init:function(a){this.rowState=a.rowState;this.tbl_ref=a.tbl_ref;this.tbl_orig=a.tbl_orig;this.del_ref=a.del_ref;this.gridopt_ref=a.gridopt_ref;this.Selections=a.Selections},resetState:function(){var a=this.rowState,b=this.gridopt_ref;angular.forEach(a,function(t,m){a[m].state=0;a[m].orig_ref&&delete a[m].orig_ref;b&&b.selectItem&&b.selectItem(m,!1)});b&&b.selectAll&&b.selectAll(!1)},selRow:function(a,b){var t={rowState:this.rowState,
tbl_ref:this.tbl_ref,tbl_orig:this.tbl_orig,del_ref:this.del_ref,gridopt_ref:this.gridopt_ref,Selections:this.Selections};if("array"===$.type(a))for(var m=0;m<a.length;m++)s.internalSelRow(a[m],b,t);else s.internalSelRow(a,b,t)},internalSelRow:function(a,b,t){b=a.entity&&angular.isDefined(a.entity.checked)?a.entity.checked:a.selected;var m;if(angular.isDefined(a.rowIndex))m=a.rowIndex;else for(var q=t.gridopt_ref.ngGrid.filteredRows,e=0;e<q.length;e++)if(angular.equals(q[e].entity,a.entity)){m=e;
break}b?(t.rowState[m]=t.rowState[m]||{},t.rowState[m].orig_ref=a.entity,2!=t.rowState[m].state&&(t.rowState[m].state=1)):(t.rowState[m]=t.rowState[m]||{},t.rowState[m].state=0)},edit:function(){var a=this.rowState;angular.forEach(a,function(b,t){1==b.state&&(a[t].state=2)})},add:function(b,v,t){t=t||{createFormExists:!0,maxEntry:50,focusAddedItem:!0,Default:!0};angular.isDefined(t.focusAddedItem)||(t.focusAddedItem=!0);var m=this.rowState,q=this.tbl_ref,e=this.tbl_orig,w=this.gridopt_ref,l=q.length;
w&&(w.ngGrid&&w.ngGrid.filteredRows&&w.ngGrid.filteredRows.length)&&(l=w.ngGrid.filteredRows.length);if(l>=t.maxEntry)app.TOOLS.criticalAlertBox({msg:"Max entry "+t.maxEntry+" items are exceeded"+(t.Default?" (Default)":""),cbk:function(a){}});else{l=q.length-1;if(t.routuneBypass)b&&b(q,m);else{var h;0<=l&&!0===t.createFormExists?(h=angular.copy(q[l]),q.push(h)):b?(h=b(q),angular.isDefined(h)||Log(ERROR,"Error: add_empty_cb() no return object")):(console.log("Warning: add_empty_cb() not exist"),q.push(angular.copy(e[0])));
m[l+1]={state:2,orig_ref:h};v&&v(q)}w||console.log("Warning: self.gridopt_ref not exist");!0===t.focusAddedItem&&function(){a(function(){var a=q.indexOf(w.ngGrid.filteredRows[w.ngGrid.filteredRows.length-1].entity),u=a;angular.forEach(m,function(a,p){m[p].state=0;w&&angular.forEach(w.ngGrid.filteredRows,function(d,c){if(a.orig_ref==d.entity){var k=q.indexOf(d.entity);w.selectItem(k,!1);u=p}})});w&&w.selectItem&&(w.selectItem(a,!0),m[u].state=2)},40)}()}},remove:function(a,v,t){var m=this.rowState,
q=this.tbl_ref,e=this.del_ref,w=this.Selections,l=b.defer(),h=l.promise;if(t){var p=[];angular.forEach(this.rowState,function(a,x){1<=a.state&&p.push(a.orig_ref)});t=t(p);h=t.promise.then(t.thenFn)}else l.resolve("ok");h.then(function(){var p=[],x;angular.forEach(m,function(d,c){if(1<=d.state){a&&a(d.orig_ref,e);var k;if(w)for(var g=w.length-1;0<=g;g--)w[g]==d.orig_ref&&(w.splice(g,1),x=q.indexOf(d.orig_ref),k=q.splice(x,1));else x=q.indexOf(d.orig_ref),k=q.splice(x,1);k&&(e&&e.push(k[0]),p.push(c),
v&&v(k[0],e,q))}});for(var r=p.length-1;0<=r;r--)m.splice(p[r],1)})},get_del_item:function(a,b,t){var m=this.tbl_orig,q=this.tbl_ref,e=[],w,l,h=0,p,u,x=function(a,d,c){for(var k=0;k<a.length;k++)l=a[k],void 0!==c[l]&&(d[l]=c[l])};angular.forEach(m,function(r,d){w=!1;angular.forEach(q,function(c,d){for(var y=h=0;y<a.length;y++)l=a[y],r[l]===c[l]&&(h+=1);h==a.length&&(w=!0,p=c)});if(w){if(b){u={};var c=b(m,q,r,p);if(void 0!==c){x(a,u,r);for(var k in c)u[k]=c[k];e.push(u)}}}else u={},x(a,u,r),angular.equals(u,
{})||(e.push(u),t&&t(m,q,r,q[d],d))});return e}};return s}]);
app.factory("GridRowBasedEditingOper",["$timeout","$q",function(a,b){var s={init:function(a){return a},resetState:function(a){angular.forEach(a.rowState,function(b,t){a.rowState[t].state=0;a.rowState[t].orig_ref&&delete a.rowState[t].orig_ref;a.gridopt_ref&&a.gridopt_ref.selectItem&&a.gridopt_ref.selectItem(t,!1)});a.gridopt_ref&&a.gridopt_ref.selectAll&&a.gridopt_ref.selectAll(!1)},selRow:function(a,b,t){if("array"===$.type(b))for(var m=0;m<b.length;m++)s.internalSelRow(b[m],t,a);else s.internalSelRow(b,
t,a)},internalSelRow:function(a,b,t){b=a.entity&&angular.isDefined(a.entity.checked)?a.entity.checked:a.selected;var m;if(angular.isDefined(a.rowIndex))m=a.rowIndex;else for(var q=t.gridopt_ref.ngGrid.filteredRows,e=0;e<q.length;e++)if(angular.equals(q[e].entity,a.entity)){m=e;break}b?(t.rowState[m]=t.rowState[m]||{},t.rowState[m].orig_ref=a.entity,2!=t.rowState[m].state&&(t.rowState[m].state=1)):(t.rowState[m]=t.rowState[m]||{},t.rowState[m].state=0)},edit:function(a){angular.forEach(a.rowState,
function(b,t){1==b.state&&(a.rowState[t].state=2)})},add:function(b,v,t,m){m=m||{createFormExists:!0,maxEntry:50,Default:!0};var q=b.tbl_ref.length;b.gridopt_ref&&(b.gridopt_ref.ngGrid&&b.gridopt_ref.ngGrid.filteredRows&&b.gridopt_ref.ngGrid.filteredRows.length)&&(q=b.gridopt_ref.ngGrid.filteredRows.length);if(q>=m.maxEntry)alert("Max entry "+m.maxEntry+" items are exceeded"+(m.Default?" (Default)":""));else{q=b.tbl_ref.length-1;if(m.routuneBypass)v&&v(b.tbl_ref,b.rowState);else{var e;0<=q&&!0===
m.createFormExists?(e=angular.copy(b.tbl_ref[q]),b.tbl_ref.push(e)):v?(e=v(b.tbl_ref),angular.isDefined(e)||console.log("Error: add_empty_cb() no return object")):(console.log("Warning: add_empty_cb() not exist"),b.tbl_ref.push(angular.copy(b.tbl_orig[0])));b.rowState[q+1]={state:2,orig_ref:e};t&&t(b.tbl_ref)}b.gridopt_ref||Log(ERROR,"Warning: self.gridopt_ref not exist");b.gridopt_ref.ngGrid?a(function(){var a=b.tbl_ref.indexOf(b.gridopt_ref.ngGrid.filteredRows[b.gridopt_ref.ngGrid.filteredRows.length-
1].entity),e=a;angular.forEach(b.rowState,function(a,p){b.rowState[p].state=0;b.gridopt_ref&&angular.forEach(b.gridopt_ref.ngGrid.filteredRows,function(u,x){if(a.orig_ref==u.entity){var r=b.tbl_ref.indexOf(u.entity);b.gridopt_ref.selectItem(r,!1);e=p}})});b.gridopt_ref&&b.gridopt_ref.selectItem&&(b.gridopt_ref.selectItem(a,!0),b.rowState[e].state=2)},40):Log(WARN,"Warning: Not use ng-grid")}},remove:function(a,v,t,m){var q=b.defer(),e=q.promise;if(m){var w=[];angular.forEach(this.rowState,function(a,
b){1<=a.state&&w.push(a.orig_ref)});m=m(w);e=m.promise.then(m.thenFn)}else q.resolve("ok");e.then(function(){var b=[],h;angular.forEach(a.rowState,function(p,x){if(1<=p.state){v&&v(p.orig_ref,a.del_ref);var r;if(a.Selections)for(var d=a.Selections.length-1;0<=d;d--)a.Selections[d]==p.orig_ref&&(a.Selections.splice(d,1),h=a.tbl_ref.indexOf(p.orig_ref),r=a.tbl_ref.splice(h,1));else h=a.tbl_ref.indexOf(p.orig_ref),r=a.tbl_ref.splice(h,1);r&&(a.del_ref&&a.del_ref.push(r[0]),b.push(x),t&&t(r[0],a.del_ref,
a.tbl_ref))}});for(var p=b.length-1;0<=p;p--)a.rowState.splice(b[p],1)})},get_del_item:function(a,b,t,m){var q=a.tbl_orig,e=a.tbl_ref,w=[],l,h,p=0,u,x,r=function(a,c,k){for(var g=0;g<a.length;g++)h=a[g],void 0!==k[h]&&(c[h]=k[h])};angular.forEach(q,function(a,c){l=!1;angular.forEach(e,function(c,g){for(var k=p=0;k<b.length;k++)h=b[k],a[h]===c[h]&&(p+=1);p==b.length&&(l=!0,u=c)});if(l){if(t){x={};var k=t(q,e,a,u);if(void 0!==k){r(b,x,a);for(var g in k)x[g]=k[g];w.push(x)}}}else x={},r(b,x,a),angular.equals(x,
{})||(w.push(x),m&&m(q,e,a,e[c],c))});return w}};return s}]);app.service("sessionAPI",[function(){var a,b=function(){a||(a=app.TOOLS.get_scope("sessionCtrl"));return a};this.reset=function(){b()&&"function"===$.type(b().resetTimer)?b().resetTimer():a=void 0};this.init=function(){b()&&_.isFunction(b().getSessionTime)&&b().getSessionTime()}}]);
app.service("UserSession",["$cookies","$http",function(a,b){var s=function(a){var n={};data={jsonrpc:"2.0",method:a.method,params:a.params||""};actm="POST";n.url=local_database||emulator||!a.method?a.url||"jsonrpc":"jsonrpc";n.data=JSON.stringify(data);n.method=actm;return b(n).success(function(b,q,e,w,l){a.success&&a.success({data:b,status:q,headers:e,config:w,statusText:l})}).error(function(b,q,e,w,l){a.error&&a.error({data:b,status:q,headers:e,config:w,statusText:l})})};this.logout=function(){var b=
function(){a.remove("user");a.remove("sessionid");a.remove("blinking");a.remove("disable-startup");a.remove("redirect-admin");a.remove("config-modified");a.remove("group");a.remove("attributes");a.remove("current-page");a.remove("fwver");a.remove("model_info");a.remove("ru");a.remove("bootfail");var b=document.location;document.location.href=b.protocol+"//"+b.host};s({method:"logout",params:{sessionid:a.get("sessionid")},success:function(a){b()},error:function(a){console.log("remove cookies fail = "+
a.status);b()}})};var n=a.get("sessionid");this.SessionInit=function(){window.addEventListener("focus",function(b){b=a.get("sessionid");void 0!==b&&n!==b&&(console.log("another session established"),location.href=location.protocol+"//"+location.host+"?code=multisession")},!1)}}]);
app.service("MyHttp",["$http","$location","UserSession","sessionAPI","$rootScope",function(a,b,s,n,v){var t=resource_base+"cache/",m=function(a){var b={},m;if(b)for(m in a)b[m]=a[m];return b};this.get=function(b){b.procBackground||app.transition.In();var e=m(b.options);e.url=b.url;e.method="GET";b.isPolling||n.reset();return a(e).success(function(a,e,h,p,u){b.success&&b.success({data:a,status:e,headers:h,config:p,statusText:u});b.procBackground||app.transition.Out()}).error(function(a,e,h,p,u){b.error&&
b.error({data:a,status:e,headers:h,config:p,statusText:u});b.procBackground||app.transition.Out()})};this.post=function(b){var e=m(b.options),w="",l="",h="GET",p=!1;b.procBackground||app.transition.In();"action"===b.method&&b.popRPCResonsepAlert&&(p=!0);b.method&&(w={jsonrpc:"2.0",method:b.method,params:b.params||""});(!local_database&&b.method||!0===b.forcedUsingPost)&&!emulator?(h="POST",e.data=JSON.stringify(w)):l=emulator&&b.method?t+b.method+".json":local_database||!b.method?b.url:"jsonrpc";
l||(l="jsonrpc");e.url=l;b.timeout&&(e.timeout=b.timeout||void 0);e.method=h;b.isPolling||n.reset();return a(e).success(function(a,x,r,d,c){var k=function(){_.isFunction(b.success)&&b.success({data:a,status:x,headers:r,config:d,statusText:c})},g;b.procBackground||app.transition.Out();p?(g=a.result&&a.result.output)&&void 0!==g.code?0===g.code?(g=g.errstr||v.DICT("Success"),app.TOOLS.successAlertBox({title:v.DICT("Information"),msg:g,cbk:function(){k()}})):(g=g.errstr||v.DICT("Failure"),app.TOOLS.criticalAlertBox({title:v.DICT("Alert"),
msg:g,cbk:function(){k()}})):k():k()}).error(function(a,x,r,d,c){401===x&&s.logout();var k=function(){_.isFunction(b.error)&&b.error({data:a,status:x,headers:r,config:d,statusText:c})};b.procBackground||app.transition.Out();p?app.TOOLS.criticalAlertBox({title:v.DICT("Alert"),msg:v.DICT("Network_Error"),cbk:function(){k()}}):k()})};this.getScript=function(a,b,m){jQuery.ajax({url:a,type:"get",dataType:"script",data:void 0,success:b,error:m})}}]);
app.service("modelInfo",[function(){var a="";this.get_pid=function(){a||(a=document.getElementById("pid_version").value.toUpperCase());return a};this.get_HWDMZport=function(){var a="";switch(this.get_pid()){case "RV345":case "RV345P":a="LAN16";break;case "RV340":case "RV340W":a="LAN4";break;default:a="LAN4"}return a};this.spec_WifiSupport=function(){var a=!1;switch(this.get_pid()){case "RV340W":a=!0;break;default:a=!1}return a}}]);
app.service("deviceTime",["MyHttp","dt",function(a,b){this.get_time=function(s){var n=function(a){a||(a={});var n="";a=(a["system-state"]||{}).clock||{};a["current-datetime"]&&(a=b.parser(a["current-datetime"]),0===a.err_code&&(n=a.year+"-"+(a.month+1)+"-"+a.day+"_"+a.hour+"-"+a.minute+"-"+a.second));s(n)};a.post({url:resource_base+"data/time.json",method:"get_time",success:function(a){a.data&&a.data.result?n(a.data.result):n()},error:function(a){console.log("deviceTime get_time Error status: "+a.status)}})}}]);
app.service("ngGridCellBuilder",[function(){var a={type:"text",ngCmd:""};this.build=function(b){switch(b.type){case "checkbox":a.ngCmd='ng-model="COL_FIELD" ng-checked="COL_FIELD"';break;default:a.ngCmd='ng-model="COL_FIELD"'}angular.extend(a,b);return'<div class="ngCellText" ng-class="col.colIndex()">'+("<input type="+a.type+" "+a.ngCmd+"/>")+"</div>"}}]);
app.service("passwordComplex",[function(){var a={minLen:8,minClass:3,enable:!0};this.getStrength=function(b){var s=1,n=0,v=!1,t=!1,m=!1,q=!1,e=!1,w,l,h,p,u,x=3;b||(b={});w=b.pwd||"";l=b.customConfig||{};h=isNaN(parseInt(l.minLen,10))?a.minLen:parseInt(l.minLen,10);p=isNaN(parseInt(l.minClass,10))?a.minClass:parseInt(l.minClass,10);if(!w)return 0;l=w.length;if(0===p&&0===h)return b.qualityIndicator&&(b.qualityIndicator.length_ok=!0,b.qualityIndicator.class_ok=!0),console.log(b.qualityIndicator),0;
b.hasOwnProperty("name")&&(e=!0,x=4);a||(a={});for(u=0;u<l;u++)if("A"<=w.charAt(u)&&"Z">=w.charAt(u)&&(v=!0),"a"<=w.charAt(u)&&"z">=w.charAt(u)&&(t=!0),"0"<=w.charAt(u)&&"9">=w.charAt(u)&&(m=!0),"!"<=w.charAt(u)&&"/">=w.charAt(u)||":"<=w.charAt(u)&&"@">=w.charAt(u)||"["<=w.charAt(u)&&"`">=w.charAt(u)||"{"<=w.charAt(u)&&"~">=w.charAt(u))q=!0;v&&n++;t&&n++;m&&n++;q&&n++;n>=p&&s++;l>=h&&s++;e&&username!==w&&s++;b.qualityIndicator&&(b.qualityIndicator.length_ok=l>=h,b.qualityIndicator.class_ok=n>=p);
return s>=x?s+(l-h):0};this.update_config=function(b){b&&(void 0!==b.minimum_length&&(a.minLen=b.minimum_length),void 0!==b.minimum_number_character_classes&&(a.minClass=b.minimum_number_character_classes),void 0!==b.complex_enable&&(a.enable=b.complex_enable))};this.get_complex_enable=function(){return a.enable};this.get_config=function(){return a}}]);
app.service("oneTimeLocker",[function(){var a={};this.put=function(b,s){b||alert("oneTimeLocker error: lockerID value not exist");s||alert("oneTimeLocker error: item value not exist");a[b]=angular.copy(s)};this.get=function(b){if(a[b]){var s=angular.copy(a[b]);delete a[b];return s}}}]);
app.service("gridPrivService",function(){var a=this,b=!1;this.ugRowIsSelected=function(a,b,v){v=!1;(b=b.colDef.field||b.colDef.name||"")&&a.entity[b]&&(v=!0);a.isSelected!==v&&(a.isSelected=v);return v};this.ugInvokeCbk=function(a,b,v,t){if(_.isFunction(a)){var m;_.forEach(t.rows,function(a,e){a.uid===b.uid&&(m=e)});a(m,b,v,t)}else Log(INFO,"ugInvokeCbk is not function")};this.ugRadioInit=function(a,b,v){if(b&&b.colDef){var t=b.colDef.field||b.colDef.name||"",m;t&&_.forEach(v.rows,function(a){a.entity[t]&&
(m&&Log(ERROR,"ui-grid radio selector error, there are two or more radio are choosed, please check data"),m=a.uid)});m&&(b.colDef.radioSelectUid=m);void 0===b.colDef.radioSelectUid&&(b.colDef.radioSelectUid=-1)}};this.ugRadioClick=function(a,b,v){var t=b.colDef.field||b.colDef.name||"",m=b.colDef.disableRadioField,q=v.rows,e=void 0;m&&!0===a.entity[m]||(b.colDef.radioSelectUid=a.uid,_.forEach(q,function(a,q){a.uid===b.colDef.radioSelectUid?(e=q,t&&void 0!==a.entity[t]&&(a.entity[t]=!0)):t&&(a&&a.entity&&
void 0!==a.entity[t])&&(a.entity[t]=!1)}),_.isFunction(b.colDef.changedCbk)&&(-1===b.colDef.radioSelectUid&&(e=-1),void 0!==e?setTimeout(function(){b.colDef.changedCbk(e,a);app.TOOLS.apply(v.appScope)},0):Log(ERROR,"[Err][ugRadioClick] rowSelectIdx is undefined, radioSelectUid:"+b.colDef.radioSelectUid)))};this.ugCheckboxInit=function(a,n,v){n&&n.colDef&&(b=!1)};this.ugCheckboxClick=function(s,n,v,t){var m=n.colDef.field||n.colDef.name||"",q=n.colDef.disableChkBoxField,e=v.rows;if(!q||!(!0===s.entity[q]&&
s.entity[m]))s.entity[m]=!s.entity[m],_.forEach(e,function(a,b){a.uid===s.uid&&(rowSelectIdx=b)}),_.isFunction(n.colDef.changedCbk)&&(void 0!==rowSelectIdx?(n.colDef.changedCbk(rowSelectIdx,s),app.TOOLS.apply(v.appScope)):Log(ERROR,"[Err][ugCheckboxClick] rowSelectIdx is undefined, radioSelectUid:"+n.colDef.radioSelectUid)),a.ugHeaderCheckboxChecker(n,v),t||(b=!0)};this.ugHeaderCheckboxClick=function(a,b){var v=b.rows,t=a.colDef.field||a.colDef.name||"",m=a.colDef.hideField||"",q=a.colDef.disableChkBoxField,
e;a.colDef.allCheckboxSelected=!a.colDef.allCheckboxSelected;e=a.colDef.allCheckboxSelected;_.forEach(v,function(a){if(!(q&&!0===a.entity[q])&&(!m||!a.entity[m]))a.entity[t]=e});_.isFunction(a.colDef.headerChangedCbk)&&a.colDef.headerChangedCbk(e)};this.ugHeaderCheckboxChecker=function(a,b){var v=a.colDef.field||a.colDef.name||"",t=a.colDef.disableChkBoxField,m=0,q=!1;_.forEach(b.rows||[],function(a){t&&!0===a.entity[t]||(!0===a.entity[v]?m+=1:q=!0)});a.colDef.allCheckboxSelected=!q&&0<m?!0:!1};this.ugRowClick=
function(s,n){if(b)b=!1;else{var v=!1,t=n.columns;_.forEach(t,function(a){a.colDef.editRow&&!0===s.entity[a.colDef.editRow]&&(v=!0)});_.forEach(t,function(b){b.colDef&&!v&&(!0===b.colDef.isRadio&&(b.colDef.radioSelectUid=s.uid,n.refreshCanvas(),a.ugRadioClick(s,b,n)),!0===b.colDef.isCheckbox&&a.ugCheckboxClick(s,b,n,!0))})}};this.getSelectDisplayNameFromList=function(a,b){var v="";angular.forEach(b,function(b,m){b.id===a&&(v=b.displayName)});return v};this.headerChkBoxClick=function(a,b){var v=b.colDef.field,
t=b.colDef.allSelected,m=[],q=b.colDef.disableChkBoxField;angular.forEach(a,function(a){if(a.entity&&!(void 0===a.entity[v]||q&&!0===a.entity[q]))a.entity[v]=t,m.push(a)});b.colDef.headerChanged&&"function"===$.type(b.colDef.headerChanged)&&b.colDef.headerChanged(b.colDef.allSelected);b.colDef.changed&&"function"===$.type(b.colDef.changed)&&b.colDef.changed(m)};this.chkHeaderChkBox=function(a,b){var v=b.colDef.field,t=b.colDef.disableChkBoxField,m=!0,q=0;angular.forEach(a,function(a){if(a.entity&&
!(void 0===a.entity[v]||t&&!0===a.entity[t]))a.entity[v]||(m=!1),q+=1});0===q&&(m=!1);b.colDef.allSelected=m};this.getRowIndex=function(a,b,v){var t=-1;angular.forEach(v.rows,function(b,q){a.uid===b.uid&&(t=q)});return t};this.getColumnIndex=function(a,b){var v=-1;angular.forEach(b.columns,function(b,m){b.uid===a.uid&&(v=m)});return v}});
app.service("multiLanguageService",["MyHttp","$route",function(a,b){var s={cur_lang:"en",list:[{lang:"en",displayName:"English",version:"1.0",URL:"i18n/lang_en.js"}]},n,v,t=function(){var a=angular.element("#headerApp"),q;a&&(q=a.scope());q&&q.langOptions&&(q.langOptions.init(),b.reload())};this.getLangList=function(){if(s)return s.list};this.getCurrLang=function(){if(s)return s.cur_lang};this.change_language=function(b){var q="";v=b;s.cur_lang=b;a.post({method:"set_gui",params:{gui:{"default-language":b}},
success:function(a){},error:function(a){}});list=this.getLangList();angular.forEach(list,function(a){if(a.lang===v)return q=a.URL,!0});q&&(a.getScript(q),t())};this.init=function(){var b=this;a.getScript("./i18n/lang_en.js");Language?n=Language:console.log("[Err] languageProvider init() can't get english file");a.post({url:resource_base+"i18n/lang.json",method:"get_gui",success:function(a){a=a&&a.data&&a.data.result&&a.data.result.gui&&a.data.result.gui["default-language"]||"en";s.cur_lang=a;"en"!==
a?b.change_language(a):t()},error:function(a){console.log("[Err] languageProvider init() can't get language data")}})};this.getString=function(a,b){if(a){var e;if(!Language||!Language[a]){if(!n||!n[a])return a;e=n[a]}else e=Language[a];b&&angular.forEach(b,function(a,b){e=e.replace(RegExp(b,"g"),a)});return e}}}]);
app.service("Sets",[function(){var a={},b=null,s,n=!1,v=function(q,e){var m=["","","",""],l,h,p={},u,x,r;if(1==s||3==s){u=void 0!=q.length;x=void 0!=e.length;var d;u&&q[0].__key&&(d=q[0].__key);x&&e[0].__key&&(d=e[0].__key);if(1==s&&(u||x)&&!d)n=!0}if(3==s&&(u||x)){p=[];for(h=q.length-1;0<=h;h--)p[h]={}}for(l in q)if(r=l,1==s&&(r=u?q[l][d]:l),q.hasOwnProperty(l))if("object"!=typeof q[l]||"object"!=typeof e[l])if(l in e&&q[l]!==e[l])p[r+m[3]]=e[l];else{if(!(l in e)||q[l]!==e[l])p[r+m[1]]=e[l]||b}else if(h=
v(q[l],e[l],a))p[r+m[2]]=h;for(l in e)r=l,1==s&&(r=x?e[l][d]:l),e.hasOwnProperty(l)&&!(l in q)&&(p[r+m[0]]=e[l]);for(l in p)if(p.hasOwnProperty(l))return p;return!1},t=function(a){for(var e in a)a[e]==b?a[e]=void 0:a.hasOwnProperty(e)&&"object"==typeof a[e]&&t(a[e]);return a};this.filterNonNull=function(a){b=null;return t(angular.copy(a))};this.getDiff=function(q,e,m){n=!1;b=null;a=angular.copy(m);s=a.mode||3;q=v(q,e);n&&alert("Sets:diffSets (mode="+s+") missing '__key' to identtify Primary Key");
return q};var m=function(a,b){void 0==a&&alert("error: recover_object: target undefined");if("object"==typeof b)for(var w in b)void 0==a[w]?null===b[w]&&"object"===typeof b[w]?a[w]=null:"object"==typeof b[w]&&void 0!=b[w].length?(a[w]=[],a[w]=angular.copy(b[w])):"object"==typeof b[w]?(a[w]={},angular.extend(a[w],b[w])):a[w]=b[w]:m(a[w],b[w])};this.recover_object=function(a,b){var w=angular.copy(b);m(a,w)};this.default_result=function(a,b){a&&a.data&&a.data.result?this.recover_object(a.data.result,
b):a&&a.data?console.log("Error: procResp.data.result not exist"):a?console.log("Error: procResp.data not exist"):console.log("Error: procResp not exist")};this.getResult=function(a,b,m,l){a="";a=l&&l.source?l.source:b&&b.config&&b.data&&b.data.result?"http":"dproxy";if("dproxy"==a)return m?b[m]:b;if("http"==a)return m?b.data.result[m]:b.data.result}}]);app.value("validValueTest",{netmask:"{not_contains:'The netmask not valid.VALUE'}"});
app.config(["errorMessagesProvider",function(a){a.setErrorMessages({required:"Required",email:"Besure input a correct email",url:"Must a url format",minlength:"Too less words",maxlength:"Too many words",parse:"Parse error",not_contains:"Not in valid list"})}]);
app.config(["$controllerProvider","$provide","$compileProvider",function(a,b,s){app._controller=app.controller;app._service=app.service;app._factory=app.factory;app._value=app.value;app._directive=app.directive;app.controller=function(b,v){a.register(b,v);return this};app.service=function(a,v){b.service(a,v);return this};app.factory=function(a,v){b.factory(a,v);return this};app.value=function(a,v){b.value(a,v);return this};app.directive=function(a,b){s.directive(a,b);return this}}]);
app.config(["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";a.defaults.withCredentials=!0;app.RadioList=function(a){void 0===a&&(a={});this.selected=a.selected||"";this.radioList=a.radioList||{data:[],style:""};this.title=a.title||{str:"",style:""}};app.IPv4FormatChk=function(a){if(void 0===a.newValue||null===a.newValue)return"undefined";if(0===a.newValue.length)return"empty";a=a.newValue.split(".");if(4!==a.length)return"error";
angular.forEach(a,function(a,b){if(0===b){if(0>=a||255<a)return"error"}else if(0>a||255<a)return"error"});return"valid"};app.ngGrid={headerHeight:20,rowHeight:22,scrollHeight:13,scrollbars:{NEVER:0,ALWAYS:1},generateGridOptions:function(a){var b={};"object"===$.type(a)&&angular.extend(b,a);return b},computeHeight:function(a,b){var e=1,w=10,l,h=app.ngGrid,p=h.rowHeight,u=h.headerHeight;b&&(e=isNaN(parseInt(b.minRows,10))?1:parseInt(b.minRows,10),w=isNaN(parseInt(b.maxRows,10))?10:parseInt(b.maxRows,
10),p=isNaN(parseInt(b.rowHeight,10))?h.rowHeight:parseInt(b.rowHeight,10),u=isNaN(parseInt(b.headerHeight,10))?h.headerHeight:parseInt(b.headerHeight,10));l=parseInt(a,10);if(isNaN(l)||1>l)l=1;return{"max-height":u+2+p*w+h.scrollHeight,"min-height":u+p*e,height:u+2+p*l}},focusRow:function(a,b){if(!a||"number"!==$.type(b))return!1;var e=a.ngGrid;if(!e)return!1;setTimeout(function(){void 0!==e.rowMap[b]&&e.$viewport.scrollTop(e.rowMap[b]*e.config.rowHeight)},100);return!0},setupGridAct:function(a){var b=
this,e=a.oper;a=a.grid;b.conf={rowState:a.rowEditableState,tbl_ref:a._tbl_ref,tbl_orig:a._tbl_orig,del_ref:a._del_ref,gridopt_ref:a.Options,Selections:a.Selections};b.resetState=function(){e.resetState(b.conf)};b.selRow=function(a,l){e.selRow(b.conf,a,l)};b.edit=function(){e.edit(b.conf)};b.add=function(a,l,h){e.add(b.conf,a,l,h)};b.remove=function(a,l,h){e.remove(b.conf,a,l,h)};b.get_del_item=function(a,l,h){return e.get_del_item(b.conf,a,l,h)};return this},ngGridFlexibleHeightPlugin:function(a){var b=
this;b.grid=null;b.scope=null;b.init=function(e,w,l){b.domUtilityService=l.DomUtilityService;b.grid=w;b.scope=e;var h=function(){var p="."+b.grid.gridId+" .ngFooterPanel",p=b.grid.$topPanel.height()+$(p).height(),u=b.grid.$canvas.height(),p=28,x=app.ngGrid.rowHeight;b.grid.rowCache&&(b.grid.rowCache[0]&&b.grid.rowCache[0].config&&b.grid.rowCache[0].config.rowHeight)&&(x=b.grid.rowCache[0].config.rowHeight);var r=10*x;u>r+13&&(u=r+13);u<x&&(u=x);b.scope.naturalHeight_post_cb&&(u=b.scope.naturalHeight_post_cb(a,
u));a&&(null!=a.minHeight&&u+p<a.minHeight&&(u=a.minHeight-p-2),null!=a.maxHeight&&u+p>a.maxHeight&&(u=a.maxHeight));u+=3;if(!b.scope.baseViewportHeight||b.scope.baseViewportHeight!==u)x=u,b.grid.filteredRows&&10>b.grid.filteredRows.length?b.grid.$viewport.css("overflow-y","hidden"):(b.grid.$viewport.css("overflow-y","auto"),x+=13),b.grid.$viewport.css("height",x+"px"),b.grid.$root.css("height",u+p+"px"),b.scope.baseViewportHeight=u;b.grid.$root.css("width","100%");b.grid.$viewport.css("width","100%");
b.domUtilityService.RebuildGrid(b.scope,b.grid)};b.scope.catHashKeys=function(){var a="",u;for(u in b.scope.renderedRows)a+=b.scope.renderedRows[u].$$hashKey;return a};b.scope.$watch("catHashKeys()",h);b.scope.$watch(b.grid.config.data,function(){setTimeout(h,1)});b.scope.innerRecalcForData=h;a&&a.external_init&&a.external_init(b,a)}},sortFn:{sortString:function(a,b){var e=a.toLowerCase(),w=b.toLowerCase();return e===w?0:e<w?-1:1},sortIPv4:function(a,b){var e=app.TOOLS.ipv4.ipv4ToNum(a),w=app.TOOLS.ipv4.ipv4ToNum(b);
return e===w?0:e<w?-1:1}}};var b=-1,s=0,n=function(){-1!==b&&(clearTimeout(b),s=0);var a=function(){s+=1;4>=s?b=setTimeout(function(){$(window).resize();a()},500):($(window).resize(),b=-1,s=0)};a()},v=function(a){a.grid.appScope.$watch(function(){return a.grid.rows.length},function(b){a.customApi.checkSelectStatus()})},t=function(a){a.grid.renderContainers.body.registerViewportAdjuster(function(b){if(!a.grid||!a.grid.rows)return b;var e=a.grid;e.element.find(".ui-grid-canvas");var w=e.gridHeight-
e.renderContainers.body.headerHeight,l=e.options,h=e.rows,p=0,u=10,e=e.renderContainers.body.renderedRows.length,x=0,r=l.rowHeight,d=0;l.dynamicRowHeight&&angular.forEach(h,function(a){_.isNumber(a.offsetHeight)&&a.offsetHeight>x&&(x=a.offsetHeight);x&&(x=Math.max(x-r,0))});void 0!==l.minRowsToShow&&(_.isNumber(l.minRowsToShow)&&0<l.minRowsToShow)&&(p=l.minRowsToShow);void 0!==l.maxRowsToShow&&(_.isNumber(l.maxRowsToShow)&&0<l.maxRowsToShow)&&(u=l.maxRowsToShow);u<p&&(u=p);e<p&&(e=p);e>u&&(e=u);e&&
(d=8);b.height=b.height+(e*r+x+d)-w;return b})};app.uiGrid={headerHeight:40,rowHeight:40,scrollHeight:13,scrollbars:{NEVER:0,ALWAYS:1},sortFun:function(a,b,e){var w=1;"directiondesc"===e&&(w=-1);return void 0===a&&void 0===b?0:void 0===a?w:void 0===b?-w:a===b?0:a<b?-w:w},generateGridOptions:function(a){var b,e,w={headerRowHeight:app.uiGrid.headerHeight,rowHeight:app.uiGrid.rowHeight,minRowsToShow:0,enableSorting:!0,enableColumnMenus:!1},l=function(a,b,x,r,d,c){var k=x.grid,g=k.appScope,z=k.api.pagination;
x=g.gridFuns.getRowIndex(x,c,k);r=g.gridFuns.getRowIndex(r,c,k);c=z.getFirstRowIndex();z=z.getLastRowIndex();k=app.uiGrid.sortFun;return c>x||z<x||c>r||z<r?0:k(a,b,d)},h=function(a){return{scrollTo:function(b,x,r){_.isNumber(r)||(r=50);setTimeout(function(){var d,c,k;k=a.grid;d=k.rows;k=k.columns;if(_.isNumber(b))if(d.length<=b||0>b)Log(ERROR,"[uiGrid][customApi][scrollTo][Err] row length is "+d.length+", focus row index is "+b);else{d=d[b].entity;if(_.isNumber(x)){if(k.length<=x||0>x){Log(ERROR,
"[uiGrid][customApi][scrollTo][Err] column length is "+k.length+", focus column index is "+x);return}c=k[x].colDef}a.core.scrollTo(d,c)}else Log(ERROR,'[uiGrid][customApi][scrollTo][Err] focus row index is not number "'+b+'"')},r)},scrollToLast:function(b,x){_.isNumber(x)||(x=50);setTimeout(function(){var r,d,c,k;c=a.grid;r=c.rows;c=c.columns;k=r.length;if(0<k){r=r[k-1].entity;if(_.isNumber(b)){if(c.length<=b||0>b){Log(ERROR,"[uiGrid][customApi][scrollTo][Err] column length is "+c.length+", focus column index is "+
b);return}d=c[b].colDef}a.core.scrollTo(r,d)}else Log(DEBUG,"[uiGrid][customApi][scrollToLast] data length is "+k)},x)},selectedRowRadio:function(b){var x;setTimeout(function(){var r,d,c,k;c=a.grid;d=c.rows;_.forEach(c.columns,function(a){a.colDef.isRadio&&(r=a.colDef,k=a.colDef.field||a.colDef.name||"")});if(r&&(_.forEach(d,function(a,c){k&&(a.entity[k]=!1);c===b&&(x=a,k&&(a.entity[k]=!0))}),x||-1===b))x?r.radioSelectUid=x.uid:-1===b&&(r.radioSelectUid=b),a.core.notifyDataChange("all")},0)},enableFiltering:function(b){_.isBoolean(b)&&
(a.grid.options.enableFiltering=b,a.core.notifyDataChange("all"))},checkSelectStatus:function(){var b=a.grid,x=b.columns,r=b.rows,d="",c="",k=-1,g=0,z=!0;_.forEach(x,function(a,b){a.colDef.isCheckbox&&(c=a.field||a.name||"",k=b,d=a.colDef&&a.colDef.hideField||"")});c&&(z=r.length?!0:!1,_.forEach(r,function(a){if(!d||!a.entity[d])a.entity[c]||(z=!1),g+=1}),0===g&&(z=!1),x=x[k],x.colDef.allCheckboxSelected=z,_.isFunction(x.colDef.headerChangedCbk)&&x.colDef.headerChangedCbk(z),app.TOOLS.apply(b.appScope))}}};
"object"===$.type(a)&&(_.isFunction(a.onRegisterApi)&&(b=a.onRegisterApi,delete a.onRegisterApi),angular.extend(w,a),w.onRegisterApi=function(a){a.customApi=h(a);w.gridApi=a;_.isFunction(b)&&b(a);a.grid.options.dynamicRowHeight&&(a.grid.renderContainers.body.getVerticalScrollLength=function(){return Math.abs(this.getCanvasHeight()-this.getViewportHeight())+this.grid.scrollbarHeight});n();v(a);t(a)});_.forEach(w.columnDefs,function(a,b){if(a.isRadio)void 0===a.cellTemplate&&(a.cellTemplate="UGRadioSelectTemplate.html"),
void 0===a.width&&(a.width=25),void 0===a.displayName&&(a.displayName=""),a.enableFiltering=!1,a.enableColumnMenu=!1,a.enableSorting=!1,a.enableColumnResizing=!1;else if(a.isCheckbox)void 0===a.cellTemplate&&(a.cellTemplate="UGCheckboxSelectTemplate.html"),void 0===a.headerCellTemplate&&(a.headerCellTemplate="UGHeaderCheckboxTemplate.html"),void 0===a.width&&(a.width=25),a.enableFiltering=!1,a.enableColumnMenu=!1,a.enableSorting=!1,a.enableColumnResizing=!1;else if(a.isEmpty)a.displayName="",a.enableFiltering=
!1,a.enableColumnMenu=!1,a.enableSorting=!1,a.enableColumnResizing=!1,a.cellTemplate="UG_table_empty.html";else{a.headerClass=a.isWrapHeader?"ui-grid-wrap-header":"ui-grid-nowrap-header";if((w.paginationPageSize||w.enablePagination)&&!_.isFunction(a.sortingAlgorithm))a.sortingAlgorithm=l;_.isNumber(a.minWidth)||(e=app.uiGrid.computeHeaderWidth(a.displayName||a.field||"",!1!==a.enableSorting),_.isNumber(e)&&0<e&&(a.minWidth=e),a.fixWidth&&_.isUndefined(a.width)&&(a.width=a.minWidth));if(_.isUndefined(a.cellTooltip)||
!_.isFunction(a.cellTooltip))a.cellTooltip=function(a,b){return a.entity[b.field]}}});return w},computeHeaderWidth:function(a,b){var e=app.TOOLS.computeWidthWithStyle(a,{fontWeight:"bold",fontSize:"14px"}),e=e+16;b&&(e+=20);return e},computeHeight:function(a,b){var e=1,w=10,l=app.uiGrid,h=0,p=!1,u=l.rowHeight,x=l.headerHeight;b&&(e=isNaN(parseInt(b.minRows,10))?1:parseInt(b.minRows,10),w=isNaN(parseInt(b.maxRows,10))?10:parseInt(b.maxRows,10),u=isNaN(parseInt(b.rowHeight,10))?l.rowHeight:parseInt(b.rowHeight,
10),x=isNaN(parseInt(b.headerHeight,10))?l.headerHeight:parseInt(b.headerHeight,10));a&&a.data&&(h=parseInt(a.data.length,10),p=!0===a.enableFiltering);p&&(h+=1);if(isNaN(h)||1>h)h=1;return{"max-height":x+2+u*w+l.scrollHeight,"min-height":x+u*e,height:x+2+u*h}}};app.chart={backgroundColors:"#4BBEC5 #EAA228 #EAC228 #AAA228 #BBBDBF #ED6D79 #98AEAB #3D57B1 #EAA278 #4C4125 #A18F6A #00D08C #898CFF #FFEC16 #B1C2A3 #A3020E".split(" "),colors:{red:"#F6402C",green:"#46AF4A",yellow:"#FFB300"}}}]);
app.transition=function(){var a={},b=0,s=!1,n=void 0;a.In=function(){b+=1;n||(n=document.getElementById("global-loading-container"));n&&!s&&(n.style.display="block",s=!0)};a.Out=function(){b-=1;0>=b&&(b=0,n||(n=document.getElementById("global-loading-container")),n&&s&&(n.style.display="none",s=!1))};a.dump=function(){console.log("Count: "+b);console.log("Opened: "+s)};return a}();
app.config(["$routeProvider",function(a){a.when("/",{templateUrl:resource_base+"htm/empty.html",controller:"PageController"});a.when("/:page",{templateUrl:resource_base+"htm/empty.html",controller:"PageController"})}]).run(["$rootScope","$templateCache","MyHttp","multiLanguageService","$route","gridPrivService","modificationWarning","$location","goToPreviousPage","$q",function(a,b,s,n,v,t,m,q,e,w){a.gridFuns=t;a.languageProvider=n;a.DICT=n.getString;a.modified=m.modified;a.resetModified=m.reset;a.messagesInclUrl=
"htm/template/messages.htm";var l,h;app.TOOLS={apply:function(a){a&&a.$root&&("$apply"!=a.$root.$$phase&&"$digest"!=a.$root.$$phase)&&(a.$apply(),$(window).resize())},getVal:function(a,b){void 0===b&&(b="");return void 0!==a?a:b},getResponse:function(a,b){return a&&a[b]&&a[b].data&&a[b].data.result||{}},int2str2:function(a){return!_.isNumber(a)?"":10>a?"0"+a:""+a},str2int:function(a){if(!a)return 0;a=parseInt(a,10);isNaN(a)&&(a=0);return a},int2BinaryMask:function(a,b,x){var r="",d;if(!_.isNumber(a))return r;
_.isNumber(b)||(b=a);"L"!==x&&"H"!==x&&(x="L");for(d=0;d<a;d++)r+="1";for(d=r.length;d<b;d++)r="L"===x?"0"+r:r+"0";return r},windowResize:function(){$(window).resize()},warningAlertBox:function(a){a.type="warning";app.TOOLS.get_scope("appCtrl").openAlertBox(a)},criticalAlertBox:function(a){a.type="critical";app.TOOLS.get_scope("appCtrl").openAlertBox(a)},informationAlertBox:function(a){a.type="information";app.TOOLS.get_scope("appCtrl").openAlertBox(a)},successAlertBox:function(a){a.type="success";
app.TOOLS.get_scope("appCtrl").openAlertBox(a)},notificationBox:function(a){app.TOOLS.get_scope("appCtrl").openNotificationBox(a)},dialogBox:function(a){app.TOOLS.get_scope("appCtrl").openDialogBox(a)},wizardBox:function(a){app.TOOLS.get_scope("appCtrl").openWizardBox(a)},netmask:{int2Inet:function(a){var b="",x,r;if(!a||""===a||"number"!==typeof a||32<a||0>=a)return"";r="";for(x=0;32>x;x++)r+=0<a?"1":"0",a-=1,8===r.length&&(b=b+""+parseInt(r,2)+(31!==x?".":""),r="");return b},inet2Int:function(a){var b=
0,x=!1,r,d;if(!a||""===a)return"";a=a.split(".");if(4!==a.length)return"";angular.forEach(a,function(a,k){bytes="0000";if(!x)if(r=!1,a=parseInt(a,10),isNaN(a))x=!0;else{a=a.toString(2);for(d=a.length;8>d;d++)a="0"+a;angular.forEach(a,function(a){"1"===a.toString()?(r&&(x=!0),b+=1):r=!0})}});x&&(b="");return b},chk:function(a){}},ipv4:{ipv4ToNum:function(a){if(a&&"string"==typeof a)return a=a.split(".").map(function(a){return parseInt(a,10)}),a[0]*Math.pow(256,3)+a[1]*Math.pow(256,2)+a[2]*Math.pow(256,
1)+a[3]},numToIpv4:function(a){if(a){for(var b=a%256,x=1;3>=x;x++)a=Math.floor(a/256),b=a%256+"."+b;return b}},ipAndMask2IpPrefix:function(a,b){if(a&&b){var x,r,d,c,k="";if(x=app.TOOLS.netmask.inet2Int(b))if(r=b.split("."),d=a.split("."),!(r&&4!==r.length||d&&4!==d.length)){for(c=0;4>c;c++)k=k+(parseInt(d[c],10)&parseInt(r[c],10))+(3===c?"":".");return k+"/"+x}}}},ipv6:{toFullV6Addr:function(a){if(!a)return"";var b=a.split("::"),x,r;if(2<b.length)return"";if(2===b.length){x=b[0].split(":");r=b[1].split(":");
a=""===b[0]?"0":b[0];for(x=x.length+r.length-2;6>x;x++)a+=":0";a+=""===b[1]?":0":":"+b[1]}return a},toFullV6ZPAddr:function(a){a=this.toFullV6Addr(a);if(a){a=a.split(":");for(var b=0,b="",x=0;x<a.length;x++)b=5-a[x].length,b=0<b?b:0,b=Array(b).join("0"),a[x]=b+a[x];a=a.join(":")}else a="";return a},prefixLen2FullAddr:function(a){a=parseInt(a,10);var b="",x,r;if(isNaN(a)||128<a||0>a)return b;r="";for(x=0;x<a;x++)r+="1",0===(x+1)%4&&(b+=parseInt(r,2).toString(16),r="");for(x=a;128>x;x++)r+="0",0===
(x+1)%4&&(b+=parseInt(r,2).toString(16),r="");r=b;b="";for(x=0;x<r.length;x++)b+=r.charAt(x),0===(x+1)%4&&x+1!==r.length&&(b+=":");return b},compress:function(a){if(!a)return"";a=a.split(":");var b=[],x,r=[],d=!1,c;if(8!==a.length)return"";angular.forEach(a,function(a,g){x=parseInt("0x"+a,16).toString(16);"0"===x?!1===d?(r.push({id:g,cnt:1}),c=r.length-1,d=!0):r[c].cnt+=1:d=!1;b.push(x)});var k=-1,g;r.length&&(angular.forEach(r,function(a){k<a.cnt&&(k=a.cnt,g=a.id)}),b[g]=8===g+k||0===g?":":"",b.splice(g+
1,k-1));return b.join(":")},ipAndMask2IpPrefix:function(a,b){if(!a||!b)return"";var x=app.TOOLS.ipv6.toFullV6Addr(a),r=b;if(!x)return"";var d,c=[],k,x=x.split(":");angular.forEach(x,function(a){k="";for(d=16;0<d;d--)0<b?(k+="1",b-=1):k+="0";k="0x"+parseInt(k,2).toString(16);c.push((k&"0x"+a).toString(16))});c=app.TOOLS.ipv6.compress(c.join(":"));return c=c+"/"+r}},ipRangeCompare:function(a,b){var x=!0,r="",d=[],c=[],k=[],g=[],z=[],y=[],A=0,B=0,h=0,D=0,e=0,l=1,m=0,l=e=0,w="";if(a&&b)if(0<=a.indexOf(".")&&
0<=b.indexOf("."))w="ipv4";else if(0<=a.indexOf(":")&&0<=b.indexOf(":"))w="ipv6";else return{ret:!1,errstr:"protocol_error",type:""};if(!a||!b)x=!1,r="data_error";else if("ipv4"===w){d=a.split(".");c=b.split(".");for(e=0;4>e;e++)if(k[e]=parseInt(d[e],10),g[e]=parseInt(c[e],10),g[e]>k[e]){x=!0;break}else if(g[e]<k[e]){x=!1;r="data_incorrect";break}}else if("ipv6"===w){d=a.split(":");c=b.split(":");e=d.length-1;l=c.length-1;""===d[0]&&(d[0]="0");""===c[0]&&(c[0]="0");""===d[e]&&(d[e]="0");""===c[l]&&
(c[l]="0");for(e=0;e<d.length;e++)if(""===d[e]){A=1;h=e;m=8-d.length;break}if(1===A)for(e=0;e<d.length;e++)if(e===h){z[e]="0";for(l=1;l<=m;l++)z[h+l]="0"}else e>h?z[e+m]=d[e]:z[e]=d[e];for(e=m=0;e<c.length;e++)if(""===c[e]){B=1;D=e;m=8-c.length;break}if(1===B)for(e=0;e<c.length;e++)if(e===D){y[e]="0";for(l=1;l<=m;l++)y[D+l]="0"}else e>D?y[e+m]=c[e]:y[e]=c[e];for(e=0;8>e;e++)if(parseInt(y[e],16)>parseInt(z[e],16)){x=!0;break}else if(parseInt(y[e],16)<parseInt(z[e],16)){x=!1;r="data_incorrect";break}}else x=
!1;return{ret:x,errstr:r,type:w}},validation:{ipv4_prefix:function(a){var b=a.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)\/(\d+)$/);if(!a||!b)return!1;a=parseInt(b[5],10);if(0>=a||32<a)return!1;a=app.TOOLS.netmask.int2Inet(a).split(".");b=b.splice(1,4);if(!b||4!==b.length)return!1;var x=!0,r,d,c;for(r=0;4>r;r++)if(d=parseInt(b[r],10),c=parseInt(a[r],10),isNaN(d)||0>d||255<d||(d&c)!==d)x=!1;return x},ipv4_chkIPMask:function(a,b){if(!a||!b)return!1;var x=!0,r=app.TOOLS.validation.ipv4_getNet(a,b),d=a.split("."),
c=Array(4),k;for(k=0;k<d.length;k++)if(255<parseInt(d[k],10))return!1;for(k=0;k<d.length;k++)void 0!==d[k]&&""!==d[k]&&(c[k]=parseInt(d[k],10),c[k]=c[k].toString(10));d=Array(4);for(k=0;k<r.length;k++)void 0===r[k]||""===r[k]?x=!1:(d[k]=c[k]&(255^r[k]),0!==d[k]&&(x=!1)),k===r.length-1&&"0"===c[k]&&"255.255.255.255"===b&&(x=!1);return x},ipv4_getNet:function(a,b){var x=Array(4);if(!a||!b)return x;var r=b.split("."),d=Array(4),c;for(c=0;c<r.length;c++)void 0!==r[c]&&""!==r[c]&&(d[c]=parseInt(r[c],10),
d[c]=d[c].toString(10));var r=a.split("."),k=Array(4);for(c=0;c<r.length;c++)void 0===r[c]||""===r[c]?valid=!1:(k[c]=parseInt(r[c],10),k[c]=k[c].toString(10));for(c=0;4>c;c++)x[c]=d[c]&k[c];return x},ipv4_chkMulticastIP:function(a){if(!a)return!1;var b=function(a){a=a.split(".");for(var c=0,b=0;4>b;b++)c*=256,c+=parseInt(a[b],10);return c},x=b("224.0.0.0"),r=b("239.255.255.255");a=b(a);return 0!==a&&(a<x||a>r)},ipv6_getNet:function(a,b){var x=Array(8);if(!a||!b)return x;var r="",d,c;for(d=0;8>d;d++){for(c=
0;16>c;c++)r+=b>16*d+c?"1":"0";r+=":"}var k=Array(8);c=Array(8);r=r.split(":");for(d=0;8>d;d++)k[d]=parseInt(r[d],2),c[d]=k[d].toString(10);r=app.TOOLS.ipv6.toFullV6Addr(a).split(":");k=Array(8);for(d=0;8>d;d++)void 0!==r[d]&&""!==r[d]&&(k[d]=parseInt(r[d],16),k[d]=k[d].toString(10));for(d=0;8>d;d++)x[d]=c[d]&k[d];return x},ipv6_chkPrefixLength:function(a,b){if(!a||!b)return!1;var x=!0,r=app.TOOLS.ipv6.toFullV6Addr(a),d=r.split(":"),c=Array(8),k;for(k=0;8>k;k++)void 0!==d[k]&&""!==d[k]&&(c[k]=parseInt(d[k],
16),c[k]=c[k].toString(10));r=app.TOOLS.validation.ipv6_getNet(r,b);d=Array(8);for(k=0;k<r.length;k++)void 0===r[k]||""===r[k]?x=!1:(d[k]=c[k]&(65535^r[k]),0!==d[k]&&(x=!1)),k===r.length-1&&0===(c[k]&15)&&128===b&&(x=!1);return x}},is_safari:function(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("safari")&&-1===a.indexOf("chrome")?!0:!1},download_save_to:function(a,b,x){var r="text",d;if(!a||!a.length)return d;b||(b="file.txt");x||(x="text/plain");if("undefined"!==typeof safari)return app.TOOLS.get_scope("appCtrl").openSafariDownPage(a),
d;switch(x){case "text/xml":case "application/xml":d=$.ajax({url:a,dataType:"xml",success:function(){4===d.readyState&&download(d.responseText,b,x)}});break;default:d=$.ajax({url:a,dataType:r,success:download.bind(!0,x,b)})}return d},download_save_to2:function(a,b,x){var r=w.defer(),d=new XMLHttpRequest;d.open("GET",document.location.origin+"/"+a,!0);d.responseType="blob";d.onload=function(a){200===d.status?(download(d.response,b,x),r.resolve({status:this.status,event:a})):r.reject({status:this.status,
event:a})};d.send(null);return r.promise},download_binary:function(a){if(!document.getElementById("download_iframe")){var b=document.createElement("iframe"),x=document.createAttribute("id"),r=document.createAttribute("style");x.value="download_iframe";r.value="display:none;";b.setAttributeNode(x);b.setAttributeNode(r);document.body.appendChild(b)}document.getElementById("download_iframe")&&(document.getElementById("download_iframe").src=a)},get_scope:function(a){if(a)return angular.element("[ng-controller="+
a+"]").scope()},computeWidth:function(a){l||(l=document.getElementById("compute_width"));if(!a)return 0;l.innerHTML=a;return l.clientWidth},computeWidthWithStyle:function(a,b){h||(h=document.getElementById("compute_width_style"));if(!a)return 0;_.forEach(b,function(a,b){_.isUndefined(h.style[b])||(h.style[b]=a)});h.innerHTML=a;return h.clientWidth},sortingInterfaceFn:function(a){var b=function(a){var b=0,d=0;a=a.name.match(/^([A-zA-Z_]+)([0-9]*)/);b="LAN"==a[1]?100:"LAG"==a[1]?200:"WAN_PORT"==a[1]?
300:"WAN"==a[1]?400:"USB"==a[1]?500:"TUN"==a[1]?600:"VLAN"==a[1]?1E4:"DMZ"==a[1]?15E3:900;d=a[2]||0;return b+parseInt(d,10)};a=!a?1:-1;return function(h,r){h.name.match(/^VLAN/)&&r.name.match(/^VLAN/);var d=b(h),c=b(r);return a*((d>c)-(c>d))}},sortingDHCPInterfaceFn:function(a){var b=function(a){var b=0,d=0;a=a["interface"].match(/^([A-zA-Z_]+)([0-9]*)/);b="VLAN"==a[1]?1E4:900;d=a[2]||0;return b+parseInt(d,10)};a=!a?1:-1;return function(h,r){var d=b(h),c=b(r);return a*((d>c)-(c>d))}},get_del_item:function(a,
b,h,r,d){var c=[],k,g,z=0,y,A,B=function(a,b,c){for(var d=0;d<a.length;d++)g=a[d],void 0!==c[g]&&(b[g]=c[g])};angular.forEach(a,function(e,D){k=!1;angular.forEach(b,function(a,b){for(var c=z=0;c<h.length;c++)g=h[c],e[g]===a[g]&&(z+=1);z==h.length&&(k=!0,y=a)});if(k){if(r){A={};var l=r(a,b,e,y);if(void 0!==l){B(h,A,e);for(var m in l)A[m]=l[m];c.push(A)}}}else A={},B(h,A,e),angular.equals(A,{})||(c.push(A),d&&d(a,b,e,b[D],D))});return c},calcValidState2:function(a,b,h,r){h=a.length;for(var d,c=0,k;c<
h;c++){k=a[c];d=!1;for(var g=0,z;g<h;g++)z=a[g],c!==g&&r(z,k)&&(d=!0);k[b]=d}},get2Digits:function(a,b){void 0===b&&(b="");return!_.isNumber(a)?b:Math.floor(100*a)/100},jumpToPage:function(b,h,x){m.check(function(r){_.isFunction(x)&&x(r);r&&setTimeout(function(){h||e.invoke();q.url(b+"/");app.TOOLS.apply(a)},50)})},cert2subject:function(a,b){var h=function(a,b,g){g&&"-"!==g&&(a&&(a+=", "),a=a+b+g);return a},r,d;b||(b="");if(!a)return b;d=a.info&&a.info.subject||{};r=h("","CN=",d["common-name"]);r=
h(r,"C=",d.country);r=h(r,"ST=",d["state-province"]);r=h(r,"L=",d.locality);r=h(r,"O=",d.organization);r=h(r,"OU=",d["organization-unit"]);return(r=h(r,"emailAddress=",d.email))||b},divide:function(a,b,h){void 0===h&&(h=0);return!_.isNumber(a)||!_.isNumber(b)||0===b?h:a/b},divide_floor:function(a,b,h){_.isNumber(h)||(h=0);return!_.isNumber(a)||!_.isNumber(b)||0===b?h:(a-a%b)/b},MBpkt2String:function(a,b){_.isNumber(b)||(b=2);0>b&&(b=2);var h=Math.pow(10,b);return 1048576<=a?Math.floor(a/1048576*h)/
h+" TB":1024<=a?Math.floor(a/1024*h)/h+" GB":a+" MB"},cpuPercentageNum:function(a,b,h,r){_.isNumber(h)||(h=0);_.isBoolean(r)||(r=!1);if(!_.isNumber(a)||!_.isNumber(b)||0===b)return 0;h=Math.pow(10,h);var d=h/2,c=app.TOOLS.divide;r||(d=0);a=(100*c(a,b)+d)*h;return c(Math.floor(a),h)}}}]);app.getLink="";app.skipOnce=!1;
app.controller("PageController",["$scope","$http","$route","$routeParams","$compile","TreeData","$location","MyHttp","$cookies","oneTimeLocker","modificationWarning",function(a,b,s,n,v,t,m,q,e,w,l){var h,p,u=resource_base+"htm/empty.html",x=void 0,r={};b=app.TOOLS.get_scope("menuCtrl");t=t.getTree();var d=function(a,b){var c;for(c=0;c<a.length;c++){if(a[c].link===b)return p=a[c],u=a[c].templateUrl,x=a[c].scripts,!0;if(a[c].children&&0<a[c].children.length&&d(a[c].children,b))return!0}return!1};m=
function(a){if(0<a.length){for(a=a[0];a&&0<a.children.length;)a=a.children[0];p=a;u=a.templateUrl;x=a.scripts}};if(t&&0<t.length){n.page?(h="#/"+n.page,d(t,h)):m(t);h===app.getLink?app.skipOnce=!0:(app.skipOnce=!1,app.getLink=h);e.put("current-page",h.replace(/#\//,""));x&&0<x.length&&angular.forEach(x,function(a){r[a]=0});p&&(p.children&&0<p.children.length)&&(u=p.children[0].templateUrl,x=p.children[0].scripts);b&&"function"===$.type(b.expand)&&app.TOOLS.get_scope("menuCtrl").expand(h);var c=0,
k=function(){q.get({url:u,success:function(b){var c=b.data,d=webOpt.WebCompileWaitCounter;if(!c||""===c)c="<div></div>";(function(){var b=app.TOOLS.get_scope("headerCtrl"),g=app.TOOLS.get_scope("layoutCtrl");0===d?(console.log("Timeout for getScript skip this request"),console.log("downloadCnts: 0 [ "+JSON.stringify(r)+"]"),app.skipOnce=!1,app.getLink=""):app.skipOnce?app.skipOnce=!1:setTimeout(function(){s.current.templateUrl=u;l.resetForm();$("#views").html(v(c)(a));app.transition.Out();app.getLink=
"";b&&b.changeHelpUrlByChangePage&&b.changeHelpUrlByChangePage();l.reset();setTimeout(function(){app.TOOLS.apply(a);g&&_.isFunction(g.check_window_width)&&g.check_window_width()},1E3)},50)})()},error:function(a){c>=webOpt.WebHTTPReqestMaxRetryCounter?console.log("Error for getHTML, retry 3 times but fail"):(k(),c+=1)}})};k()}}]);
app.directive("customDatepicker",["dt",function(a){return{restrict:"A",require:["^?uibDatepicker","^?uibDaypicker"],link:function(b,s,n,v){var t,m=function(a){b.year=a.getFullYear();b.years=[];for(t=b.year-3;t<b.year+4;t++)b.years.push({id:t,displayName:t})};b.weeks=a.dayWeekab;b.months=a.month;b.month=b.datepicker.activeDate.getMonth();b.year;b.years=[];m(b.datepicker.activeDate);b.changeMonth=function(){b.datepicker.activeDate.setMonth(b.month);b.datepicker._refreshView()};b.moveMonth=function(a){b.month+=
a;0>b.month&&(b.month=11,b.year-=1);11<b.month&&(b.month=0,b.year+=1)};b.changeYear=function(){void 0!==b.year&&(b.datepicker.activeDate.setFullYear(b.year),b.datepicker._refreshView())};b.$watch(function(){return b.datepicker.activeDate},function(a){b.month=b.datepicker.activeDate.getMonth();m(b.datepicker.activeDate)})}}}]);
app.directive("confirmsave",["modificationWarning",function(a){var b,s=function(){b||(b=app.TOOLS.get_scope("headerCtrl"));return b};return{restrict:"E",templateUrl:"cc_confirm_save.html",require:"^?ngModel",scope:{ngShow:"="},link:function(b,v,t,m){b.$watch("ngShow",function(b){!0===b&&(a.reset(),"function"===$.type(s().enable_save_warning)&&s().enable_save_warning())})}}}]);
app.directive("ngModification",["modificationWarning",function(a){return{restrict:"A",require:"^?ngModel",link:function(b,s,n,v){var t,m=n.name,q=function(){t&&t();t=b.$watch(function(){return b[m].$dirty},function(b,m){b&&a.modified()})};n.ngModification?b.$watch(n.ngModification,function(a,b){a?q():t&&t()}):q();a.setForm(b[m])}}}]);
app.directive("zeromin",function(){return{restrict:"A",require:"ngModel",link:function(a,b,s,n){b=function(b){var t=a.$eval(s.zeromin)||0;if(!angular.isUndefined(b)&&!(""===b||null===b)&&b<t&&0!==b)n.$setValidity("zeromin",!1);else return n.$setValidity("zeromin",!0),b};n.$parsers.push(b);n.$formatters.push(b)}}});
app.directive("option150",function(){return{restrict:"A",require:"ngModel",link:function(a,b,s,n){a=function(a){var b=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),m=/^(^0.0.0.0|1.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,q=/[^\x00-\u00ff]$/;if(""===a)return n.$setValidity("option150",!0),a;if(!angular.isUndefined(a)&&!(""===a||null===a)){var e=a.split(","),w;for(w in e)if(!e[w].match(b)||e[w].match(m)||e[w].match(q)){n.$setValidity("option150",
!1);return}}n.$setValidity("option150",!0);return a};n.$parsers.push(a);n.$formatters.push(a)}}});app.directive("pgLine1",function(){return{restrict:"E",template:"<hr class='line1' align='center' width='99%' size='1' style='margin-top:5px;margin-button: 5px'></hr>"}});
app.directive("pgListRadio",function(){return{restrict:"EC",scope:{obj:"=obj",ngClass:"=ngClass"},transclude:!0,compile:function(a,b,s,n){return{pre:function(a,b,m,q){a.obj=a.obj||{};a.obj.title=a.obj.title||{str:"",style:""};a.obj.radioList=a.obj.radioList||{data:[],style:""};a.obj.selected=a.obj.selected||""}}},templateUrl:"T_list_radio.html"}});
app.directive("ipv4SubnetPrefix",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,s,n){if(n&&s.ipv4SubnetNetmask){a.$watch(s.ngModel,function(){v()});a.$watch(s.ipv4SubnetNetmask,function(){v()});a.$watch(s.ipv4SubnetPrefix,function(a){a?v():n.$setValidity("ipv4SubnetPrefix",!0)});var v=function(){var b=n.$viewValue,m=a.$eval(s.ipv4SubnetNetmask),b=app.TOOLS.validation.ipv4_chkIPMask(b,m);n.$setValidity("ipv4SubnetPrefix",b)}}}}});
app.directive("compareIpRangeInlandhcp",function(){return{require:"ngModel",scope:{otherModelValue:"=compareIpRangeInlandhcp"},link:function(a,b,s,n){n.$validators.compareIpRangeInlandhcp=function(b){"function"==typeof a.stateRef&&a.stateRef();var t=!0,m=[],q=[],e=[],w=[],l=[],h=[];if(void 0===a.otherModelValue||void 0===b)t=!0;else{m=a.otherModelValue.split(".");q=b.split(".");l=document.location.host.split(".");for(b=0;4>b;b++)e[b]=parseInt(m[b],10),w[b]=parseInt(q[b],10),h[b]=parseInt(l[b],10);
for(b=0;4>b;b++)if(w[b]>e[b]){t=!0;break}else if(w[b]<e[b]){t=!1;break}h[0]===e[0]&&h[0]===w[0]&&h[1]===e[1]&&h[1]===w[1]&&h[2]===e[2]&&h[2]===w[2]&&h[3]>=e[3]&&h[3]<=w[3]&&(t=!1)}return t};a.$watch("otherModelValue",function(){n.$validate()})}}});
app.directive("compareIpRangeBytype",function(){return{require:"ngModel",scope:{otherModelValue:"=compareIpRangeBytype",stateRef:"&validRefTo"},link:function(a,b,s,n){n.$validators.compareIpRangeBytype=function(b){var t=!0,m=[],q=[],e=[],w=[],l=[],h=[],p=0,u=0,x=0,r=0,d=0,c=1,k=0,c=d=0,q=m=q="";a.otherModelValue&&(q=a.otherModelValue.split("#"),m=q[0].toLowerCase(),q=q[1]);if(!a.otherModelValue||!b||!m||!q)t=!0;else if("ipv4"===m){m=q.split(".");q=b.split(".");for(d=0;4>d;d++)if(e[d]=parseInt(m[d],
10),w[d]=parseInt(q[d],10),w[d]>e[d]){t=!0;break}else if(w[d]<e[d]){t=!1;break}}else if("ipv6"===m){m=q.split(":");q=b.split(":");d=m.length-1;c=q.length-1;""===m[0]&&(m[0]="0");""===q[0]&&(q[0]="0");""===m[d]&&(m[d]="0");""===q[c]&&(q[c]="0");for(d=0;d<m.length;d++)if(""===m[d]){p=1;x=d;k=8-m.length;break}if(1===p)for(d=0;d<m.length;d++)if(d===x){l[d]="0";for(c=1;c<=k;c++)l[x+c]="0"}else d>x?l[d+k]=m[d]:l[d]=m[d];for(d=k=0;d<q.length;d++)if(""===q[d]){u=1;r=d;k=8-q.length;break}if(1===u)for(d=0;d<
q.length;d++)if(d===r){h[d]="0";for(c=1;c<=k;c++)h[r+c]="0"}else d>r?h[d+k]=q[d]:h[d]=q[d];for(d=0;8>d;d++)if(parseInt(h[d],16)>parseInt(l[d],16)){t=!0;break}else if(parseInt(h[d],16)<parseInt(l[d],16)){t=!1;break}}else t=!1;return t};a.$watch("otherModelValue",function(){n.$validate()})}}});
app.directive("compareIpRange",function(){return{require:"ngModel",scope:{otherModelValue:"=compareIpRange",stateRef:"&validRefTo"},link:function(a,b,s,n){n.$validators.compareIpRange=function(b){"function"==typeof a.stateRef&&a.stateRef();var t=!0,m=[],q=[],e=[],w=[];if(void 0===a.otherModelValue||void 0===b)t=!0;else{m=a.otherModelValue.split(".");q=b.split(".");for(b=0;4>b;b++)e[b]=parseInt(m[b],10),w[b]=parseInt(q[b],10);for(b=0;4>b;b++)if(w[b]>e[b]){t=!0;break}else if(w[b]<e[b]){t=!1;break}}return t};
a.$watch("otherModelValue",function(){n.$validate()})}}});
app.directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo",stateRef:"&validRefTo",ngCompare:"="},link:function(a,b,s,n){var v=!0;n.$validators.compareTo=function(b){var m=!1,q=!0;if(!v)return!0;"function"==typeof a.stateRef&&(q=a.stateRef(),void 0===q&&(q=!0));if(!1===q||q&&b==a.otherModelValue)m=!0;return m};s.ngCompare&&a.$watch("ngCompare",function(a){v=a?!0:!1;n.$validate()});a.$watch("otherModelValue",function(){n.$validate()})}}});
app.directive("compareIpBymask",function(){return{require:"ngModel",scope:{otherModelValue:"=compareIpBymask",stateRef:"&validRefTo"},link:function(a,b,s,n){n.$validators.compareIpBymask=function(b){var t=!0;"function"==typeof a.stateRef&&(t=a.stateRef()||!0);if(!1===t)return!0;var t=!0,m=a.otherModelValue,q;if(void 0===b||void 0===m||null===m||""===b||""===m)return!0;if("number"==typeof m||"string"==typeof m&&!m.indexOf("."))m=app.TOOLS.netmask.int2Inet(parseInt(m,10));b=b.split(".");if(4>b.length||
""===b[3])return!1;m=m.split(".");if(4>m.length)return!1;var e=Array(4);for(q=0;q<m.length;q++)""!==m[q]&&(e[q]=parseInt(m[q],10).toString(2));q=e.toString();for(m=m=0;35>m&&"0"!=q[m];m++);e=Array(4);for(q=0;q<b.length;q++)if(""!==b[q]){e[q]=parseInt(b[q],10).toString(2);for(var w=e[q].length;8>w;w++)e[q]="0"+e[q]}b=e.toString();for(e=q=0;35>m;m++)"0"==b[m]?e++:"1"==b[m]&&q++;if(0===e||0===q)t=!1;return t};a.$watch("otherModelValue",function(){n.$validate()})}}});
app.directive("checkIpv4Bymask",function(){return{require:"ngModel",scope:{otherModelValue:"=checkIpv4Bymask",stateRef:"&validRefTo"},link:function(a,b,s,n){n.$validators.checkIpv4Bymask=function(b){var t=!0;"function"==typeof a.stateRef&&(t=a.stateRef()||!0);if(!1===t)return!0;t=!0;t=a.otherModelValue;return void 0===b||void 0===t||null===t||""===b||""===t?!0:b===t&&"0.0.0.0"!==b&&"0.0.0.0"!==t?!1:"0.0.0.0"===b&&"0.0.0.0"===t?!0:"0.0.0.0"===b&&"0.0.0.0"!==t||"0.0.0.0"!==b&&"0.0.0.0"===t?!1:t=app.TOOLS.validation.ipv4_chkIPMask(b,
t)};a.$watch("otherModelValue",function(){n.$validate()})}}});
app.directive("checkMaskByipv4",function(){return{require:"ngModel",scope:{otherModelValue:"=checkMaskByipv4",stateRef:"&validRefTo"},link:function(a,b,s,n){n.$validators.checkMaskByipv4=function(b){var t=!0;"function"==typeof a.stateRef&&(t=a.stateRef()||!0);if(!1===t)return!0;t=!0;t=a.otherModelValue;return void 0===t||void 0===b||null===b||""===t||""===b?!0:t===b&&"0.0.0.0"!==t&&"0.0.0.0"!==b?!1:"0.0.0.0"===t&&"0.0.0.0"===b?!0:"0.0.0.0"===t&&"0.0.0.0"!==b||"0.0.0.0"!==t&&"0.0.0.0"===b?!1:t=app.TOOLS.validation.ipv4_chkIPMask(t,
b)};a.$watch("otherModelValue",function(){n.$validate()})}}});app.directive("checkIpv4Multicast",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,s,n){if(n){a.$watch(s.ngModel,function(){v()});s.$observe("checkIpv4Multicast",function(a){v()});var v=function(){var a=n.$viewValue,b=!1,b="0.0.0.0"===a?!0:app.TOOLS.validation.ipv4_chkMulticastIP(a);n.$setValidity("checkIpv4Multicast",b)}}}}});
app.directive("chkIpv6Bylength",function(){return{require:"ngModel",scope:{otherModelValue:"=chkIpv6Bylength",stateRef:"&validRefTo",disabled:"=disalbedIpv6Bylength"},link:function(a,b,s,n){var v,t=!1;n.$validators.chkIpv6Bylength=function(b){var q=!0;"function"==typeof a.stateRef&&(q=a.stateRef()||!0);if(!1===q||t)return!0;var q=!0,q=a.otherModelValue,e="";if(void 0===b||void 0===q||null===q||""===b||""===q)return!0;for(e=app.TOOLS.ipv6.toFullV6Addr(b);0<=e.search(":");)e=e.replace(":","");return q=
0===parseInt(e,16)&&0===parseInt(q,16)?!0:app.TOOLS.validation.ipv6_chkPrefixLength(b,q)};_.isBoolean(a.disabled)&&(v=a.$watch(function(){return a.disabled},function(a){a!==t&&(t=a,n.$validate())}));a.$watch("otherModelValue",function(){n.$validate()});a.$on("$destroy",function(){v&&v()})}}});
app.directive("chkLengthByipv6",function(){return{require:"ngModel",scope:{otherModelValue:"=chkLengthByipv6",stateRef:"&validRefTo"},link:function(a,b,s,n){n.$validators.chkLengthByipv6=function(b){var t=!0;"function"==typeof a.stateRef&&(t=a.stateRef()||!0);if(!1===t)return!0;var t=!0,t=a.otherModelValue,m="";if(void 0===t||void 0===b||null===b||""===t||""===b)return!0;for(m=app.TOOLS.ipv6.toFullV6Addr(t);0<=m.search(":");)m=m.replace(":","");return t=0===parseInt(m,16)&&0===parseInt(b,16)?!0:app.TOOLS.validation.ipv6_chkPrefixLength(t,
b)};a.$watch("otherModelValue",function(){n.$validate()})}}});app.directive("notequal",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,s,n){if(n){a.$watch(s.ngModel,function(){v()});s.$observe("notequal",function(a){v()});var v=function(){var a=n.$viewValue,b=s.notequal;n.$setValidity("notequal",!a||!b||a!=b)}}}}});
app.directive("checkspace",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,s,n){if(n){a.$watch(s.ngModel,function(){v()});s.$observe("checkspace",function(a){v()});var v=function(){var a=n.$viewValue,b=!1,b=/^[^\s]*$/,q=/[^\x00-\u00ff]$/,b=void 0===a?!0:a.match(b)&&!a.match(q)?!0:!1;n.$setValidity("checkspace",b)}}}}});
app.directive("checkpassword",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,s,n){if(n){a.$watch(s.ngModel,function(){v()});s.$observe("checkpassword",function(a){v()});var v=function(){var a=n.$viewValue,b=!1,b=/(^.*$)/,q=/(^[^%&\\"'\s]*$)/,e=/[^\x00-\u00ff]$/,b=void 0===a?!0:a.match(b)&&a.match(q)&&!a.match(e)?!0:!1;n.$setValidity("checkpassword",b)}}}}});
app.directive("checkinterport",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,s,n){if(n){a.$watch(s.ngModel,function(){v()});s.$observe("checkinterport",function(a){"check"===a?v():n.$setValidity("checkinterport",!0)});var v=function(){var a=!1,a="8008"===n.$viewValue?!1:!0;n.$setValidity("checkinterport",a)}}}}});
app.directive("pgToggle",function(){return{restrict:"E",scope:{value:"=ngModel",style:"@style",ngStyle:"=ngStyle",ngClass:"=ngClass","class":"@class"},compile:function(a,b,s,n){var v={"true":"themes/img/icon/on.png","false":"themes/img/icon/off.png"};return{pre:function(a,b,q,e){void 0===a.value&&(a.value="false");a.icon=v}}},templateUrl:"Dir_toggle.html"}});
app.directive("pgPwd",["passwordComplex",function(a){return{restrict:"E",require:"^?ngModel",replace:!0,scope:{model:"=ngModel",required:"=ngRequired",isplain:"=ngIsPlain",complexity:"=ngNeedComplexity",disabled:"=ngDisabled",maxLength:"=ngMaxlength",legalChar:"=ngLegalChar"},link:function(b,s,n,v){b.invalid=!1;b.isplain=void 0!==b.isplain?b.isplain:!1;b.required=void 0!==b.required?b.required:!1;b.complexity=void 0!==b.complexity?b.complexity:!1;b.disabled=void 0!==b.disabled?b.disabled:!1;b.legalChar=
void 0!==b.legalChar?b.legalChar:!1;b.placeholder=n.placeholder?n.placeholder:"";b.pwd=b.model||"";b.id=n.id?"_"+n.id:"";b.name="sub_pwd"+(n.name?"_"+n.name:"");var t=function(a,e){var w=b.name,l=!0,h=!0;switch(a){case "required":l=e;break;case "complexity":h=e;break;case "noinvalid":case "invalid":break;default:return}b.invalid=!1;b[w]&&(b[w].pwd_encry.$setValidity("required",l),b[w].pwd_plain.$setValidity("required",l),b[w].pwd_encry.$setValidity("complexity",h),b[w].pwd_plain.$setValidity("complexity",
h));b.invalid=!e},m=function(){if(b.disabled)return t("noinvalid",!0),!0;if(void 0===b.pwd||null===b.pwd)return t("invalid",!1),!1;if(b.required&&0===b.pwd.length)return t("required",!1),!1;if(b.complexity&&0===a.getStrength({pwd:b.pwd}))return t("complexity",!1),!1;t("noinvalid",!0);return!0};b.change=function(){v&&(v.$setViewValue(b.pwd),v.$commitViewValue());n.ngChange&&b.$eval(n.ngChange);m()};b.$watch(function(){return b.isplain},function(a){m()});b.$watch(function(){return b.required},function(a){m()});
b.$watch(function(){return b.complexity},function(a){m()});b.$watch(function(){return b.disabled},function(a){m()});b.$watch(function(){return b.legalChar},function(a){m()});m()},templateUrl:"T_input_pwd.html"}}]);
app.directive("ngHeaderCheckboxChk",["modificationWarning",function(a){return{restrict:"A",replace:!0,require:"?ngModel",link:function(b,s,n,v){var t=[],m=!1;b.col.clickHeaderChk=!1;b.col.colDef.allSelected=!1;var q=function(){b.$watch(function(){return t.length},function(e,w){w>e&&!0!==b.col.colDef.skipModified&&a.modified();b.gridFuns.chkHeaderChkBox(t,b.col)});b.$watch(function(){return b.col.colDef.allSelected},function(a){var w=[];!0===b.col.clickHeaderChk&&(b.col.clickHeaderChk=!1,angular.forEach(t,
function(a,b){w.push({entity:a,rowIndex:b})}),b.gridFuns.headerChkBoxClick(w,b.col))})};b.$watch(function(){return b.$eval(b.col.colDef.data)},function(a){a&&(t=b.$eval(b.col.colDef.data),m||(q(),m=!0))})}}}]);
app.directive("ngCheckboxChk",[function(){return{restrict:"A",replace:!0,require:"?ngModel",link:function(a,b,s,n){var v=a.$eval("col"),t=a.$eval("row"),m=a.$eval("renderedRows");v.colDef&&v.colDef.data&&(b=a.$eval(v.colDef.data),m=[],angular.forEach(b,function(a,b){m.push({rowIndex:b,entity:a})}));a.$watch(function(){return t.entity[v.field]},function(){a.gridFuns.chkHeaderChkBox(m,v);v&&v.colDef.changed&&v.colDef.changed(t)})}}}]);
app.directive("noDirty",function(){return{require:"ngModel",link:function(a,b,s,n){n.$setDirty=angular.noop}}});
app.controller("mainCtrl",["$scope","MyHttp","$templateCache","ciscoDesign","modelInfo","passwordComplex","userAccessRight","dt",function(a,b,s,n,v,t,m,q){a.languageProvider.init();n.refactory();a.normal_show=!0;a.loading_message=a.DICT("Page_Loading_Msg");a.custom_loading_message="";var e=function(a){webOpt=a||{WebHTTPReqestMaxRetryCounter:3,WebCompileWaitCounter:10,WebCompileWaitDuration:1E3}};b.get({url:resource_base+"config/config.json",success:function(a){e(a&&a.data)},error:function(a){e()}});
b.post({url:resource_base+"data/aaa.json",method:"get_password_complexity",procBackground:!0,success:function(a){a.data&&a.data.result&&(a=(a.data.result["password-complex-setting"]||{})["password-complex"]||void 0)&&t.update_config({minimum_length:a["minimum-length"],minimum_number_character_classes:a["minimum-number-character-classes"],complex_enable:a["complex-enable"]})}});b.post({url:resource_base+"data/time.json",method:"get_time",procBackground:!0,success:function(a){var b="",h={};a.data&&
a.data.result&&(h=a.data.result);h.system&&(h.system.clock&&h.system.clock["timezone-name"])&&(b=h.system.clock["timezone-name"]);q.setTimezoneName(b)},error:function(){}})}]);
app.controller("Controller_USB_list",["$scope","rpcFns",function(a,b){a.usblist_init=function(){a.usb_sel_file_ctx.usb_dev=a.usb_sel_file_ctx.usbDevList[0];a.get_usblist();a.usblist_reset_path()};a.usblist_reset_path=function(){a.usb_sel_file_ctx.path=[]};a.get_usblist=function(){var s=a.usb_sel_file_ctx,n=!1;if(s&&s.selitem&&(s.selitem[0]&&!1==s.selitem[0].directory||1<s.selitem.length))n=!0;if(!n)if(n=a.usb_sel_file_ctx.usb_dev){var v=!1,t="",m="";s&&(s.file&&s.selitem&&s.selitem[0]&&s.selitem[0].directory)&&
(t=s.file["file-name"],"back"===s.file.FN?s.path.pop():s.path.push(t),m=s.path.join("/"),0<s.path.length&&(v=!0));b.RPC_usblist(n,m).then(function(b){(b=b["file-names"])?(v&&b.unshift({"file-name":"(To Upper Directory)",directory:!0,FN:"back"}),a.ctx.USB_list=b):(s.path.pop(),Log(ERROR,"Get USB List error, file path: "+m))})}else a.ctx.USB_list=[]};a.filename_rule=function(a){var b=a["file-name"];return!0===a.directory&&angular.isUndefined(a.FN)?b+"/":b};a.udpate_selected_file=function(a){var b=a.selitem;
1===b.length?b[0].directory?a.file=b[0]:(a.file=b[0],b="",0<a.path.length&&(b=a.path.join("/")+"/"),a.file["full-file-name"]=b+a.file["file-name"]):a.file=void 0}}]);app.controller("safariCtrl",["$scope","$uibModalInstance","url",function(a,b,s){a.url=s;a.close=function(){b.close()}}]);app.controller("delIntfAlertCtrl",["$scope","$uibModalInstance","obj",function(a,b,s){a.model=s;a.ok=function(){b.close()};a.cancel=function(){b.dismiss("cancel")}}]);
app.service("userAccessRight",["$cookies",function(a){var b="",s=!1;this.get=function(){b=a.get("attributes");if(local_database||emulator)b="RW";return b};this.russia=function(){return s="1"===a.get("ru")}}]);app.config([function(){var a=function(a){return"string"===typeof a?a.replace(/-/g,"_"):a},b=function(a){return"string"===typeof a?a.replace(/_/g,"-"):a},s=function(a,b,m,q){b||(b="array"==q?[]:{});m||console.error("obj_key_rename: renameFn not defined");var e,w=void 0,l;for(l in a){var w=q=e=a[l],h=Object.prototype.toString.call(e);"[object Object]"===h?q=s(e,w,m):"[object Array]"===h&&(q=s(e,w,m,"array"));e=m(l)||l;b[e]=q;e!==l&&void 0!==b[l]&&delete b[l]}return b},n=function(b,n){n||(n=a);return s(b,
b,n)};app.modelhelper={};app.modelhelper.obj_rename_inplace=n;app.modelhelper.obj_key_rename=s;app.modelhelper.db2webFn=function(b){b="string"!==typeof b?angular.copy(b):JSON.parse(b);return b=n(b,a)};app.modelhelper.web2dbFn=function(a){return a=n(a,b)};app.modelhelper.add=function(a,b,m,q){q=q||{createFormExists:!0,maxEntry:50,Default:!0};var e=a.length;q.gridopt_ref&&(q.gridopt_ref.ngGrid&&q.gridopt_ref.ngGrid.filteredRows&&q.gridopt_ref.ngGrid.filteredRows.length)&&(e=q.gridopt_ref.ngGrid.filteredRows.length);
if(e>=q.maxEntry)alert("Max entry "+q.maxEntry+" items are exceeded"+(q.Default?" (Default)":""));else{if(b)var w=b(a);else console.log("Warning: add_empty_cb() not exist");m&&m(a,{newItem:w})}};app.modelhelper.del=function(a,b,m,q,e){e=function(){for(var e=[],h=a.length-1,p;0<=h;h--)p=a[h],app.rshelper.rs_get(p).isChecked&&(b&&b(p,a),p=a.splice(h,1),m&&m(p[0],e,a))};if(q){var w=[];angular.forEach(a,function(a,b){app.rshelper.rs_get(a).isChecked&&w.push(a)});q(w,e)}else e()}}]);
app.config([function(){var a=new function(){this.rs_set=function(a,s){var n=a.$$rowstate;s&&(void 0!==s.isChecked&&(n.isChecked=s.isChecked),void 0!==s.isEdit&&(n.isEdit=s.isEdit))};this.rs_get=function(a){a=a.$$rowstate;return!a?{isChecked:!1,isEdit:!1}:{isChecked:a.isChecked,isEdit:a.isEdit}};this.rs_clean=function(a){for(var s=0,n;s<a.length;s++)n=a[s],n.$$rowstate&&delete n.$$rowstate};this.rs_event_trig=function(a,s,n){if("UNCHECK_LIST_EVENT"==s)if(n){s=0;for(var v;s<n.length;s++){v=n[s];if(a=
v.$$rowstate)a.isChecked=!1,a.isEdit=!1;!0===v.checked&&(v.checked=!1)}}else console.error("UNCHECK_LIST_EVENT: missing arrRef");else a||console.error("rs_event_trig: item not exist"),a.$$rowstate=a.$$rowstate||{},a=a.$$rowstate,"ADD_ITEM_EVENT"==s?(a.isChecked=!0,a.isEdit=!0):"SEL_ITEM_EVENT"==s?a.isChecked=!0:"DESEL_ITEM_EVENT"==s?(a.isChecked=!1,a.isEdit=!1):"EDIT_ITEM_EVENT"==s?(a.isChecked=!0,a.isEdit=!0):"VIEW_ITEM_EVENT"==s?a.isEdit=!1:"DEL_ITEM_EVENT"==s?(a.isChecked=!1,a.isEdit=!1):console.error("rs_event_trig: unknown EVENT:"+
s)};return this};app.rshelper=a}]);app.controller("layoutCtrl",["$scope","$window",function(a,b){var s;a.collapsed=!1;a.windowWidth=b.innerWidth;var n=function(){s||(s=app.TOOLS.get_scope("headerCtrl"));return s};a.toggle_nav=function(b){a.collapsed=!a.collapsed;b||n().compute_width_by_zoom()};var v=function(){a.windowWidth!==b.innerWidth&&a.check_window_width()};a.check_window_width=function(){a.windowWidth=b.innerWidth;a.collapsed?1035<a.windowWidth&&a.toggle_nav(!0):934>a.windowWidth&&a.toggle_nav(!0);n().compute_width_by_zoom()};
angular.element(b).on("resize",v);a.$on("$destroy",function(){angular.element(b).off("resize",v)})}]);app.controller("backgroundAppCtrl",["$scope","MyHttp","$q",function(a,b,s){a.firmware_lib=function(){var a={fwAUAvailableVersion:"",fwAULastCheckTime:"",fwsVersion:"",signAUAvailableVersion:"",signAULastCheckTime:"",signVersion:"",ddAUAvailableVersion:"",ddAULastCheckTime:"",ddsBuildinVersion:""},v=!1,t=0,m=function(){return b.post({method:"action",procBackground:!0,params:{rpc:"check-latest-version"},error:function(a){console.log("check latest version error "+a.status);v=!1;h(v,"check latest version error")}})},
q=function(){return b.post({url:resource_base+"data/automatic_updates.json",method:"get_auto_update",procBackground:!0,error:function(a){console.log("get auto update error "+a.status);t=0}})},e=function(a){a||(a={});var b={},h=a["firmware-state"]||{},d=((a.firmware||{})["auto-update"]||{}).notify||!1,c=a["signature-state"]||{},k=((a.signature||{})["auto-update"]||{}).notify||!1,g=a["dongle-driver-state"]||{};a=((a["dongle-driver"]||{})["auto-update"]||{}).notify||!1;b.fwAUAvailableVersion=h["available-version"]||
"";b.fwAULastCheckTime=void 0!==h["last-check-time"]?h["last-check-time"]:"";b.fwsVersion=h.version||"";b.fwNotify=d;b.signAUAvailableVersion=c["available-version"]||"";b.signAULastCheckTime=void 0!==c["last-check-time"]?c["last-check-time"]:"";b.signVersion=c.version||"";b.signNotify=k;b.ddAUAvailableVersion=g["available-version"]||"";b.ddAULastCheckTime=void 0!==g["last-check-time"]?g["last-check-time"]:"";b.ddsBuildinVersion=g["buildin-version"]||"";b.ddNotify=a;return b},w=function(){!0===v&&
s.all([q()]).then(function(b){b=e(b[0]&&b[0].data&&b[0].data.result||{});console.log("edit: "+b.fwAULastCheckTime+" orig: "+a.fwAULastCheckTime);b.fwAULastCheckTime&&b.fwAULastCheckTime!==a.fwAULastCheckTime?b.fwAUAvailableVersion&&b.fwAUAvailableVersion!==a.fwsVersion&&(t=0,l(!0,"Alert"),p()):t=setTimeout(w,1E4)})},l=function(a,b){var h=app.TOOLS.get_scope("headerCtrl");h&&"function"===$.type(h.enable_alert_waring)&&h.enable_alert_waring({tip_info:"New Firmware is available on Cisco.com, click to go to File Management page to upgrade",
jumpto:"#/Admin_File_Management",display_name:b||"Alert",isCurrentInfo:a})},h=function(a,b){var h=app.TOOLS.get_scope("admin_filemanage_main");h||(h=app.TOOLS.get_scope("automaticUpdateCtrl"));h&&(h.invokeCheckingSuccessCbk&&"function"===$.type(h.invokeCheckingSuccessCbk))&&h.invokeCheckingSuccessCbk(a,b)},p=function(a){var b=app.TOOLS.get_scope("automaticUpdateCtrl");b&&"function"===$.type(b.hasNewVersionCbk)&&b.hasNewVersionCbk(a)};return{check_firmware:function(){var b=!1;0!==t&&clearTimeout(t);
s.all([q(),m()]).then(function(x){a=e(x[0]&&x[0].data&&x[0].data.result||{});x=(x=x[1]&&x[1].data&&x[1].data.result||{})&&x.output||{};var r=x.errstr;v=0===x.code?!0:!1;h(v,r);a.fwAUAvailableVersion&&a.fwsVersion&&a.fwAUAvailableVersion!==a.fwsVersion?(p(!0),l(!0,"Alert"),b=!1):b=!0;b&&w()});return"start"},stop_polling:function(){0!==t&&(clearTimeout(t),t=0)}}}()}]);app.controller("appCtrl",["$scope","$uibModal","ngDialog",function(a,b,s){var n;a.openSafariDownPage=function(n){b.open({animation:a.animationsEnabled,templateUrl:"safari_download.html",controller:"safariCtrl",size:"lg",backdrop:"static",resolve:{url:function(){return n}}})};a.openDelInftAlertPage=function(v){v?(n=b.open({animation:a.animationsEnabled,templateUrl:"del_intf_alert.html",controller:"delIntfAlertCtrl",size:"lg",backdrop:"static",resolve:{obj:function(){return v}}}),n.result.then(function(){"function"===
typeof v.cbk&&v.cbk(!0)},function(a){"function"===typeof v.cbk&&v.cbk(!1)})):Log(ERROR,"openDelInftAlertPage is failure obj is "+JSON.stringify(v))};a.openDialogBox=function(a){if(!a||!a.msg)Log(ERROR,"openDialogBox is failure obj is "+JSON.stringify(a));else{var b=void 0;if(_.isNumber(a.width)||_.isString(a.width))b=a.width;s.open({template:"dialogBox.html",closeByDocument:!1,width:b,resolve:{obj:function(){return a}},controller:"dialogBoxCtrl",preCloseCallback:function(b){var q;_.isFunction(a.cbk)&&
("$closeButton"===b&&(q=!1),a.cbk(q,b))}})}};a.openAlertBox=function(a){if(!a||!a.msg&&!a.templateUrl)Log(ERROR,"openAlertBox is failure obj is "+JSON.stringify(a));else{var b=void 0;if(_.isNumber(a.width)||_.isString(a.width))b=a.width;s.open({template:"alertBox.html",closeByDocument:!1,width:b,resolve:{obj:function(){return a}},controller:"alertBoxCtrl",preCloseCallback:function(b){var q=b;_.isFunction(a.cbk)&&("$closeButton"===b&&(q=!1),a.cbk(q,b))}})}};a.openNotificationBox=function(a){if(!a||
!a.msg)Log(ERROR,"openNotificationBox is failure obj is "+JSON.stringify(a));else{var b=void 0;if(_.isNumber(a.width)||_.isString(a.width))b=a.width;s.open({template:"notificationBox.html",closeByDocument:!1,width:b,resolve:{obj:function(){return a}},controller:"notificationBoxCtrl",preCloseCallback:function(b){var q;_.isFunction(a.cbk)&&("$closeButton"===b&&(q=!1),a.cbk(q,b))}})}};a.openWizardBox=function(a){!a||!a.list||!a.title||!a.model?Log(ERROR,"openWizardBox is failure obj is "+JSON.stringify(a)):
s.open({template:"wizard.html",width:"70%",closeByDocument:!1,resolve:{obj:function(){return a}},controller:"wizardCtrl",preCloseCallback:function(b){_.isFunction(a.cbk)&&a.cbk("$closeButton"===b||"close"===b?!1:!0,b)}})}}]);app.controller("sessionCtrl",["$scope","$uibModal","$location","UserSession","MyHttp","userAccessRight","$cookies",function(a,b,s,n,v,t,m){var q,e=0,w=0,l=18E5,h=177E4,p="guest";"RW"===t.get()&&(p="admin");var u=function(b){b||(b={});b=b["web-session-timeout"]||{};var d=18E5;_.isNumber(b[p])&&(d=6E4*b[p]);l=d;h=d-3E4;0>h&&(h=0);a.resetTimer()};a.getSessionTime=function(a){v.post({url:resource_base+"data/aaatrans_web_session_timeout.json",procBackground:a,method:"get_web_session_timeout",success:function(b){a||
u(b&&b.data&&b.data.result)},error:function(b){a||u()}})};var x=function(){n.logout();m.put("session_timeout","true");Log(DEBUG,location.protocol+"//"+location.host);location.href=location.protocol+"//"+location.host};a.dump=function(){Log(ERROR,"[session timeout] active time (ms): "+((new Date).getTime()-q));Log(ERROR,"[session timeout] pop warning dialog time (s): "+h/1E3);Log(ERROR,"[session timeout] timeout time (s): "+l/1E3);Log(ERROR,"[session timeout] sessionTimeoutId : "+e);Log(ERROR,"[session timeout] sessionRemainTimeoutId : "+
w)};a.resetTimer=function(){void 0!==e&&(clearTimeout(e),e=void 0);void 0!==w&&(clearTimeout(w),w=void 0);0===h?Log(DEBUG,"[session timeout] session timeout is zero, keep webpage"):(q=(new Date).getTime(),e=setTimeout(function(){Log(DEBUG,"[session timeout] time(sec) : popWarningbox"+parseInt(((new Date).getTime()-q)/1E3,10));a.openSessionTimeoutWarningBox();e=void 0},h))};a.openSessionTimeoutWarningBox=function(){b.open({templateUrl:"session_timeout.html",controller:"sessionAlertCtrl",size:"550",
backdrop:"static",resolve:{countdownTimeSec:function(){return Math.floor(30)}}}).result.then(function(b){switch(b.action){case "resume":a.getSessionTime(!0);break;case "cancel":w=setTimeout(function(){x()},1E3*b.remainTime);break;default:x()}},function(a){x()})};a.getSessionTime();a.$on("$destroy",function(){void 0!==e&&(clearTimeout(e),e=void 0)})}]);
app.controller("sessionAlertCtrl",["$scope","$uibModalInstance","countdownTimeSec",function(a,b,s){var n=void 0;a.countdownTimeSec=s;a.note=a.DICT("Session_Timeout_Note",{"%s":a.countdownTimeSec});a.reset=function(){n&&clearInterval(n);b.close({action:"resume"})};a.cancel=function(){n&&clearInterval(n);b.close({action:"cancel",remainTime:a.countdownTimeSec})};n=setInterval(function(){a.countdownTimeSec-=1;0===a.countdownTimeSec&&(n&&clearInterval(n),b.close({action:"timeout"}));a.note=a.DICT("Session_Timeout_Note",
{"%s":a.countdownTimeSec});app.TOOLS.apply(a)},1E3)}]);app.controller("headerCtrl",["$scope","$cookies","UserSession","$route","$window","modelInfo","MyHttp","$q","$location","userAccessRight",function(a,b,s,n,v,t,m,q,e,w){var l=app.TOOLS.getVal,h=app.TOOLS.getResponse,p=0,u=w.russia(),x=t.get_pid(),r;a.user_style={"max-width":"315px"};a.title_style={"max-width":"300px"};a.multiLang_style={};a.jumpToPage=app.TOOLS.jumpToPage;a.langOptions={list:[],select:void 0,displayName:"",change:function(){d();a.languageProvider.change_language(this.select)},init:function(){this.list=
a.languageProvider.getLangList();this.select=a.languageProvider.getCurrLang();d()}};var d=function(){a.langOptions.displayName="";angular.forEach(a.langOptions.list,function(b){b.lang===a.langOptions.select&&(a.langOptions.displayName=b.displayName)})},c=function(b){b||(b={});a.hostname=(b.system||{}).hostname||""};b.put("model_info",x);a.langOptions.init();var k=function(a){a||(a={});var c={version:""};a=a["image-state"]&&a["image-state"].firmware||{};a=a.images&&a.images.image||[];for(var g=0;g<
a.length;g++)if("active"===a[g].active){c.version=a[g].version||"";break}b.put("fwver",c.version);return c};t=function(a){a||(a={});this.enable=l(a.enable,!1);this.tip_info=l(a.tip_info,"");this.title=l(a.title,"");this.display=l(a.display,!0);this.jumpto=l(a.jumpto,"");this.blinking=!0;this.width=void 0!==a.width?a.width:"0px";this.focus=!1;this.class_name=l(a.class_name,"")};var g=function(){0!==p&&clearTimeout(p);angular.forEach(a.warnings,function(a){a.enable&&a.blinking&&(a.display=!a.display)});
"$apply"!=a.$root.$$phase&&"$digest"!=a.$root.$$phase&&a.$apply();p=setTimeout(g,1E3)},z=function(){var b=!0;angular.forEach(a.warnings,function(a){a.enable&&a.blinking&&(b=!1)});b?0!==p&&(clearTimeout(p),p=0):0===p&&g()},y=function(b){if(b){var c,g=!1;if(!a.warnings[b]||a.warnings[b].blinking)angular.forEach(a.warnings,function(a,d){d===b&&(c=a);!0===a.enable&&d!==b&&(g=a.display)}),Log(DEBUG,JSON.stringify(c)),c.display=g}};a.title="";a.hostname="";a.title_width=0;var A=function(){var b=a.hostname?
"-"+a.hostname:"";if(u)switch(x){case "RV340W":a.title="RV340W"+b;document.title="RV340W Dual WAN Gigabit Router with Wireless";break;case "RV340":a.title="RV340"+b;document.title="RV340 Dual WAN Gigabit Router";break;case "RV345":a.title="RV345"+b;document.title="RV345 Dual WAN Gigabit Router";break;case "RV345P":a.title="RV345P"+b;document.title="RV345P Dual WAN Gigabit Router with PoE";break;default:a.title="RV340"+b,document.title="RV340 Dual WAN Gigabit Router",Log(ERROR,'PID Error use default title "'+
a.title+'"')}else switch(x){case "RV340W":a.title="RV340W"+b;document.title="RV340W Dual WAN Gigabit VPN Router with Wireless";break;case "RV340":a.title="RV340"+b;document.title="RV340 Dual WAN Gigabit VPN Router";break;case "RV345":a.title="RV345"+b;document.title="RV345 Dual WAN Gigabit VPN Router";break;case "RV345P":a.title="RV345P"+b;document.title="RV345P Dual WAN Gigabit VPN Router with PoE";break;default:a.title="RV340"+b,document.title="RV340 Dual WAN Gigabit VPN Router",Log(ERROR,'PID Error use default title "'+
a.title+'"')}a.title_width=app.TOOLS.computeWidthWithStyle(a.title,{fontSize:"19px"});a.compute_width_by_zoom()};a.warnings={warning:new t({enable:!1,jumpto:"Admin_File_Management",class_name:"header-icon icon-warning",title:a.DICT("Alert"),width:"45px"}),save:new t({enable:!1,jumpto:"Admin_Config_Management",class_name:"header-icon icon-save",title:a.DICT("Header_Save_Note"),width:"45px"})};var B=void 0;a.compute_width_by_zoom=function(){var b=a.collapsed,c=v.innerWidth,g,d=!1;a.warnings.warning.width=
"45px";a.warnings.save.width="45px";g=c;b||(g-=250);1E3<=c?(g-=512,d=!0):g=930<=c?g-320:780<=c?g-238:g-148;_.isUndefined(a.user_style.display)||delete a.user_style.display;d?(b=a.title_width+a.user_width,b<g?(a.title_style["max-width"]=a.title_width+"px",a.user_style["max-width"]=a.user_width+"px"):a.title_width<g?(a.title_style["max-width"]=a.title_width,a.user_style["max-width"]=g-a.title_width,75>a.user_style["max-width"]&&(a.user_style.display="none")):(a.title_style["max-width"]=g,a.user_style.display=
"none")):a.title_style["max-width"]=g;B&&clearTimeout(B);B=setTimeout(function(){app.TOOLS.apply(a);B=void 0},0)};a.enable_alert_waring=function(b){b||(b={});a.warnings.warning.enable=!0;a.warnings.warning.focus=!1;a.warnings.warning.title=a.DICT("Alert");a.warnings.warning.tip_info="";a.warnings.warning.jumpto="Admin_File_Management";b.jumpto&&(a.warnings.warning.jumpto=b.jumpto);b.tip_info&&(a.warnings.warning.tip_info=b.tip_info,a.warnings.warning.title="");y("warning");g()};a.disable_alert_warning=
function(b){!1!==a.warnings.warning.enable&&(a.warnings.warning.enable=!1,z())};a.enable_save_warning=function(){if(!0!==a.warnings.save.enable){var c="0"!==b.get("blinking");a.warnings.save.enable=!0;a.warnings.save.focus=!1;a.warnings.save.blinking=c;y("save");g()}};a.disable_save_warning=function(){!1!==a.warnings.save.enable&&(a.warnings.save.enable=!1,z())};a.check_save_blinking=function(){if(!1!==a.warnings.save.enable){var c="1"===b.get("blinking");c||(a.warnings.save.display=!0);a.warnings.save.blinking=
c;y("warning");g()}};a.disable_header_warning=function(){0!==p&&(clearTimeout(p),p=0);angular.forEach(a.list,function(a){a.enable&&(a.enable=!1)})};a.logout=function(){s.logout()};a.asd_notify={firmware:!1,dongle:!1,signature:!1};a.check_auto_update=function(b,c){b||(b={});var g=b.headers,d=b.data&&b.data.result||{},k=d.image&&d.image.firmware||{},z=0;a.asd_notify={firmware:!1,dongle:!1,signature:!1};k["auto-update"]&&void 0!==k["auto-update"].notify&&(a.asd_notify.firmware=k["auto-update"].notify);
if(a.asd_notify.firmware){if(g&&(g=g("Cookie")))(g=g.match(/\.*(auto-update=(\d+|-\d+))\.*/))&&(z=g[2]);z=parseInt(z,10);isNaN(z)&&(z=0);var g="<div>",y,B,A,h,k=!1;if(a.asd_notify.firmware)switch(y=d["image-state"]&&d["image-state"].firmware||{},B=y["latest-version"]||"",A=y["last-check-time"]||"",h=y["latest-update-time"]||"",y=y["available-version"]||"",z){case 1:y&&(B&&y!==B)&&(g=g+"A new firmware update, version "+y+", was available and detected at "+A+". ",k=!0);break;case 2:g=g+"A new firmware update, version "+
B+", was applied at "+h+". "}if(a.asd_notify.dongle)switch(y=d["dongle-driver-state"]||{},B=y.version||"",A=y["last-check-time"]||"",h=y["latest-update-time"]||"",y=y["available-version"]||"",z){case 1:y&&(B&&y!==B)&&(g=g+"A new dongle driver update, version "+y+", was available and detected at "+A+". ",k=!0);break;case 2:g=g+"A new dongle driver update, version "+B+", was applied at "+h+". "}if(a.asd_notify.signature)switch(y=d["signature-state"]||{},B=y.version||"",A=y["last-check-time"]||"",h=
y["latest-update-time"]||"",y=y["available-version"]||"",z){case 1:y&&(B&&y!==B)&&(g=g+"A new signature update, version "+y+", was available and detected at "+A+". ",k=!0);break;case 2:g=g+"A new signature update, version "+B+", was applied at "+h+". "}Log(DEBUG,"cookies auto-update: "+z);switch(z){case -1:a.enable_alert_waring({tip_info:a.DICT("Header_Download_Firmare_Fail"),jumpto:"Admin_File_Management"});break;case 0:a.disable_alert_warning();break;case 1:c&&(d=function(a){a&&(m.post({method:"action",
procBackground:!0,params:{rpc:"file-copy",input:{fileType:"firmware",source:{"location-url":"http://cisco.com/"},destination:{"firmware-state":"inactive"},"firmware-option":{"reboot-type":"none"}}}}),e.url("Admin_File_Management/"))},k&&app.TOOLS.warningAlertBox({msg:g+"The release note for this version is available for download from <a href='http://www.cisco.com/c/en/us/support/routers/small-business-rv-series-routers/products-release-notes-list.html' target=\"_blank\">here</a>.</div>",title:"Information",
cbk:d,btn_yes_str:"Upgrade Now",btn_no_str:"Cancel"}));a.enable_alert_waring({tip_info:a.DICT("Header_New_Firmware_Is_Available"),jumpto:"Admin_File_Management"});break;case 2:c&&(g+="</div>",app.TOOLS.informationAlertBox({msg:g,cbk:function(a){m.post({method:"action",params:{rpc:"clear_auto_update_notify"}})},btn_no_str:"OK"}))}}else a.disable_alert_warning()};a.update_asd_notify=function(b){a.check_auto_update(b)};a.login={user:b.get("user")||"AAAAAAAAAAAA AB",sessionid:b.get("sessionid")||"",group:b.get("group")||
""};a.user_info=a.login.user+(a.login.group?" ("+a.login.group+")":"");a.user_width=app.TOOLS.computeWidthWithStyle(a.user_info,{fontSize:"19px"})+15+1;""===a.login.sessionid&&(!local_database&&!emulator)&&s.logout();"1"===b.get("config-modified")&&a.enable_save_warning();var C=0;a.remain_session_time=0;a.clean_remain_session_interval=function(){0!==C&&(clearInterval(C),C=0)};s.SessionInit();var D={Status_System_Stats:"c_system_summary.html",Status_TCP_IP:"c_tcp-ip_services.html",Status_Port_Traffic:"c_port_traffic.html",
Status_WAN_QoS:"c_wan_qos_statistics.html",Status_Application_stats:"Status_Application_stats.html",Status_ARP_Table:"c_arp_table.html",Status_Routing_status:"c_routing_table.html",Status_DHCP_binding:"c_dhcp_bindings.html",Status_Mobile_Network:"c_mobile_network.html",Status_VPN:"c_vpn_status.html",Status_View_Logs:"t_view_logs.html",captive_portal_status:"t_captive_portal_status.html",Admin_Reboot:"t_reboot.html",Admin_Schedule_Reboot:"t_schedule_reboot.html",Admin_File_Management:"t_file_management.html",
Admin_Diagnostic:"t_diagnostic.html",Admin_License:"g_license.html",Admin_Certificate:"c_certificate.html",Admin_Config_Management:"c_config_management.html",System_Config_Setup:"t_initial_setup_wizard.html",System_Config_System:"t_system.html",System_Config_Time:"t_time.html",System_Config_Log:"t_log.html",System_Config_Email:"t_email.html",System_Config_User_Accounts:"t_user_accounts.html",System_Config_User_Groups:"t_user_groups.html",System_Config_IP_Address:"t_ip_address_groups.html",System_Config_SNMP:"t_snmp.html",
System_Config_Discovery_Bonjour:"t_discovery-bonjour.html",System_Config_LLDP:"t_lldp.html",System_Config_Automatic_Updates:"t_automatic_updates.html",System_Config_Service_Management:"t_service_management.html",System_Config_Schedules:"t_schedules.html",System_Config_PnP:"t_pnp.html",WAN_Settings:"t_wan_settings.html",WAN_Multi_WAN:"t_multi_wan.html",WAN_Mobile_Network:"t_mobile_network.html",WAN_Dynamic_DNS:"t_dynamic_dns.html",WAN_Hardware_DMZ:"t_hardware_dmz.html",WAN_IPv6_Transition:"t_ipv6_transition.html",
QoS_Traffic_Classes:"t_traffic_classes.html",QoS_WAN_Queuing:"t_wan_queuing.html",QoS_WAN_Policing:"t_wan_policing.html",QoS_WAN_Bandwidth:"t_wan_bandwidth_management.html",QoS_Switch_Classification:"t_switch_classification.html",QoS_Switch_Queuing:"t_switch_queuing.html",LAN_Port_Settings:"t_port_settings.html",LAN_VLAN:"t_vlan_settings.html",LAN_VLAN_Settings:"t_vlan_settings.html",LAN_DHCP_Settings:"t_lan_dhcp_settings.html",LAN_Static_DHCP:"t_static_dhcp.html","LAN_802.1X":"t_802_1x_configuration.html",
LAN_DNS:"t_dns_local_database.html",LAN_Router_Ad:"t_router_advertisement.html",lan_poe_settings:"t_poe_settings.html",wlan_settings:"t_basic_settings.html",wlan_adv:"t_advanced_settings.html",captive_portal:"t_captive_portal.html",wlan_wps:"t_wps.html",Routing_IGMP_Proxy:"t_igmp_proxy.html",Routing_RIP:"t_rip.html",Routing_Static_Routing:"t_static_routing.html",Firewall_Basic_Settings:"t_basic_settings.html",Firewall_Access_Rules:"t_access_rules.html",Firewall_NAT:"t_network_address_translation.html",
Firewall_Static_NAT:"t_static_nat.html",Firewall_port_forwarding:"t_port_forwarding.html",Firewall_Port_triggering:"t_port_triggering.html",Firewall_Session_timeout:"t_session_timeout.html",Firewall_DMZ_host:"t_dmz_host.html",VPN_Setup:"t_vpn_setup_wizard.html",VPN_IPsec_Profiles:"t_ipsec_profiles.html",VPN_Site_to_Site:"t_site-to-site.html",VPN_Client_to_Site:"t_client_to_site.html",VPN_Teleworker:"t_teleworker_vpn_client.html",VPN_Gre_Tunnel:"t_gre_tunnel.html",VPN_PPTP_Server:"t_pptp_server.html",
VPN_L2TP_Server:"t_l2tp_server.html",VPN_SSL:"t_ssl_vpn.html",VPN_Passthrough:"t_vpn_passthrough.html",Security_App_Control_Wizard:"t_settings.html",Security_Application_Controller:"t_settings.html",Security_Web_Filtering:"t_web_filtering.html",Security_Content_Filter:"t_content_filter.html",Security_IP_Source_Guard:"t_ip_source_guard.html",app_statistics:"c_application_statistics.html",client_statistics:"t_client_statistics.html",Security_Umbrella:"t_cisco_umbrella.html",Security_Threat_Ips_Status:"t_status.html",
Security_Anti_Threat:"t_antivirus.html",Ips:"t_ips.html",Configuration_Wizards:"g_configuration_wizards.html"};switch(x){case "RV340W":D.Firewall_Basic_Settings="t_basic_settings_2.html"}a.help_url="./help/help/index.html";a.changeHelpUrlByChangePage=function(){var b="";n&&(n.current&&n.current.params&&n.current.params.page&&D[n.current.params.page])&&(b="?"+D[n.current.params.page]);a.help_url="./help/help/index.html"+b};a.toogle_nav=function(){r||(r=app.TOOLS.get_scope("layoutCtrl"));r.toogle_nav()};
(function(){m.post({method:"get_sys_info",url:resource_base+"data/sys_system.json",success:function(a){c(a.data&&a.data.result||{});A()},error:function(a){c();A();Log(ERROR,"[headerCtrl][getSystemInfo][Err] "+JSON.stringify(a))}})})();q.all([function(){return m.post({url:resource_base+"data/automatic_updates.json",method:"get_auto_update",procBackground:!0,error:function(a){Log(ERROR,"get auto update error "+a.status);pollingTimeId=0}})}()]).then(function(c){if("1"===b.get("bootfail")){var g=h(c,
0),d="";angular.forEach(g["image-state"]&&g["image-state"].firmware&&g["image-state"].firmware.images&&g["image-state"].firmware.images.image||[],function(a){"active"===a.active&&(d=a.version)});app.TOOLS.criticalAlertBox({msg:"Image failover occurred, device booted currently with firmware version: "+d+". Please check and upload the correct firmware if necessary.",title:a.DICT("Warning"),btn_no_str:"OK",cbk:function(b){b&&(a.check_auto_update(c[0],!0),k(c[0]&&c[0].data&&c[0].data.result||{}))}})}else a.check_auto_update(c[0],
!0),k(c[0]&&c[0].data&&c[0].data.result||{})});a.changeHelpUrlByChangePage();A()}]);app.controller("dialogBoxCtrl",["$scope","obj",function(a,b){a.model=b;a.btn_yes_str=a.DICT("Alert_Box_Yes");a.btn_no_str=a.DICT("Alert_Box_No");a.title="";a.msg=b.msg;a.templateUrl=b.templateUrl||"";a.iconClass="";a.type=b.type;a.msg&&(a.templateUrl="");switch(b.type){case "warning":break;case "critical":case "information":case "success":a.btn_yes_str="";a.btn_no_str=a.DICT("Alert_Box_Ok");break;default:a.type="warning"}b.btn_yes_str&&(a.btn_yes_str=b.btn_yes_str);b.btn_no_str&&(a.btn_no_str=b.btn_no_str);
a.title=b.title?b.title:a.DICT("Information");a.iconClass={warning:"icon-warning",critical:"icon-critical",information:"icon-information",success:"icon-success"}[a.type];a.yes=function(){a.closeThisDialog(!0)};a.no=function(){a.closeThisDialog(!1)}}]);
app.controller("alertBoxCtrl",["$scope","obj",function(a,b){a.model=b;a.btn_yes_str="";a.btn_no_str="";a.title="";a.msg=b.msg||"";a.templateUrl=b.templateUrl||"";a.iconClass="";a.type=b.type;switch(b.type){case "critical":a.title=a.DICT("Alert");a.btn_no_str=a.DICT("Alert_Box_Ok");break;case "information":a.title=a.DICT("Information");a.btn_no_str=a.DICT("Alert_Box_Ok");break;case "success":a.title=a.DICT("Information");a.btn_no_str=a.DICT("Alert_Box_Ok");break;default:a.title=a.DICT("Warning"),a.btn_yes_str=
a.DICT("Alert_Box_Yes"),a.btn_no_str=a.DICT("Alert_Box_No"),a.type="warning"}b.btn_yes_str&&(a.btn_yes_str=b.btn_yes_str);b.btn_no_str&&(a.btn_no_str=b.btn_no_str);b.title&&(a.title=b.title);a.iconClass={warning:"icon-warning",critical:"icon-critical",information:"icon-information",success:"icon-success"}[a.type];a.yes=function(){a.closeThisDialog(!0)};a.no=function(){a.closeThisDialog(!1)}}]);
app.controller("notificationBoxCtrl",["$scope","obj",function(a,b){a.model=b;a.btn_yes_str=a.DICT("Alert_Box_Yes");a.btn_no_str=a.DICT("Alert_Box_No");a.title="";a.msg=b.msg;a.iconClass="";a.type=b.type;switch(b.type){case "warning":case "critical":case "information":case "success":break;default:a.type="warning"}b.btn_yes_str&&(a.btn_yes_str=b.btn_yes_str);b.btn_no_str&&(a.btn_no_str=b.btn_no_str);b.title&&(a.title=b.title);a.iconClass={warning:"icon-warning",critical:"icon-critical",information:"icon-information",
success:"icon-success"}[a.type]}]);
app.controller("wizardCtrl",["$scope","obj",function(a,b){var s=function(b){a.show_skip_btn=b.canSkip?!0:!1;a.show_submit_btn=a.current_step===a.step_list.length-1?!0:!1};a.step_list=b.list||[];a.title=b.title||"";a.current_step=0;a.show_skip_btn=!1;a.show_submit_btn=!1;a.model=b.model;a.validation=b.validation;a.next=function(){a.current_step<a.step_list.length&&(a.current_step+=1,s(a.step_list[a.current_step]))};a.back=function(){0<a.current_step&&(a.current_step-=1,s(a.step_list[a.current_step]))};
a.skip=function(){var b=a.step_list[a.current_step];a.current_step<a.step_list.length&&(_.isFunction(b.skipCbk)&&b.skipCbk(a.current_step),a.current_step+=1,s(a.step_list[a.current_step]))};a.submit=function(){a.closeThisDialog(a.model)};a.cancel=function(){a.closeThisDialog("close")};s(a.step_list[0])}]);app.controller("waitRebootCtrl",["$scope","$uibModalInstance",function(a,b){}]);app.controller("menuCtrl",["$scope","MyHttp","TreeData","$route","$location","modelInfo","$cookies","oneTimeLocker","modificationWarning","goToPreviousPage","$q",function(a,b,s,n,v,t,m,q,e,w,l){var h=app.TOOLS.getResponse,p=app.TOOLS.divide_floor,u,x="1"===m.get("disable-startup"),r,d=!1,c=m.get("redirect-admin"),k="1"===c||"2"===c,g={Getting_Started:"icon-getting-start",Status_Statistics:"icon-status",System_Configuration:"icon-system",WAN:"icon-wan",LAN:"icon-lan",Wireless:"icon-wifi",Security:"icon-security",
Routing:"icon-routing",Firewall:"icon-firewall",VPN:"icon-vpn",QoS:"icon-qos",Administration:"icon-admin",Configuration_Wizards:"icon-wizard",License:"icon-license"},z=function(){var b=s.getTree(),y=function(b){var c="fa-cogs",d;angular.forEach(b,function(b){b.displayName=a.DICT(b.name);b.displayNameHeight=-1;b.subMenuHeight=-1;b.displayNameWidth=app.TOOLS.computeWidthWithStyle(b.displayName,{fontSize:"16px",fontWeight:"normal"});d=b.name;g[d]&&(c=g[d]);b.expanded=!1;b.selected=!1;b.iconClass=c;b.children&&
0<b.children.length&&y(b.children)})},z=function(a){var b,c=function(a,b){var g=0,d=188;2<=b&&(d-=10*(b-1));angular.forEach(a,function(a){a.displayNameHeight=20*(p(a.displayNameWidth,d)+1)+21;-1!==g&&(g=a.displayNameHeight+g);a.children.length?(a.subMenuHeight=c(a.children,b+1),g=-1):a.subMenuHeight=0});return g};angular.forEach(a,function(a){a.displayNameHeight=20*(p(a.displayNameWidth,188)+1)+21;b=c(a.children,1);a.subMenuHeight=-1===b?-1:b})};b&&(y(b),z(b,0),a.treedata=b,r=m.get("user"),k&&r?(q.put("USER_ACCOUNT",
{username:r,forceChangePW:!0,redirect_admin:c}),v.url("System_Config_User_Accounts/")):d?(D(),q.put("WIZARDS","setup_wizard"),v.url("Configuration_Wizards/")):x?v.url(b[1].children[0].link.replace("#/","")+"/"):(a.selected=b[0],v.url(b[0].link.replace("#/","")+"/")));w.reset()};a.treedata=[];a.opts={dirSelectable:!1};a.expand=function(b){var c=function(a){var g=!1,d=!1;angular.forEach(a,function(a){a.expanded=!1;a.selected=!1;if(a.children.length){if(g=c(a.children))a.selected=g,a.expanded=g,d=!0}else a.link===
b&&(d=g=a.selected=!0)});return d};c(a.treedata)};a.onNodeToggle=function(b,c){b!==u&&(u=b,a.selected=b.children[0],v.url(b.children[0].link+"/"),w.reset())};a.showSelected=function(b){a.selectedNode===b&&n.reload();a.selectedNode=b};a.reload=function(b){a.click(b,!0)};a.click=function(a,b){var c=a.link.replace("#/","")+"/";e.check(function(a){a&&(app.transition.In(),v.url(c),w.reset())})};var y=function(a){var b=0;a.children.length&&angular.forEach(a.children,function(c){c.children.length&&c.expanded&&
(b+=y(c));b+=a.displayNameHeight});return b};a.genStyle=function(a){return{height:(!a.expanded||!a.children.length?a.displayNameHeight:-1!==a.subMenuHeight?a.subMenuHeight+41:y(a)+41)+"px"}};a.selected="";var A=2,B=function(){var a="data/menu.json";switch(t.get_pid()){case "RV340W":a="data/tree_rv340w.json";break;case "RV345P":a="data/tree_rv345p.json";break;default:a="data/menu.json"}return b.post({url:resource_base+a,method:"get_model_tree"})},C=function(a){""!==a?(s.setTree(a),z()):(A-=1,E())},
D=function(){b.post({forcedUsingPost:!0,method:"set_gui",params:{gui:{"hide-initial-setup":!0}},success:function(){},error:function(){}})},E=function(){0!==A&&l.all([B(),b.post({method:"get_gui",url:resource_base+"data/get_gui.json"})]).then(function(a){var b=h(a,1);b||(b={});if(!1===(b.gui||{})["hide-initial-setup"])d=!0;local_database?C(a[0]&&a[0].data):C(h(a,0))},function(a){(A-=1)?E():(Log(ERROR,"[menuCtrl] init() error"),Log(ERROR,a))})};E()}]);app.controller("ScheduleRebootCtrl",["$scope","MyHttp","UserSession","userAccessRight","$q","modelInfo",function(a,b,s,n,v,t){v=app.TOOLS.int2str2;var m=app.TOOLS.getVal,q=t.spec_WifiSupport();a.ruFlag=n.russia();a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var e=function(){var b={},b={},e=a.recovery,b={hours:e.hour,minutes:e.minute};switch(e.frequency){case "weekday":b["week-day"]=e.weekday;break;case "month":b["month-day"]=e.day;break;default:b["every-day"]=
null}return b={"recurring-schedule-reboot":{enable:e.enable,action:e.action,frequency:b}}},w=function(b){b=b["recurring-schedule-reboot"]||{};var e=b.frequency||{},l=a.recovery;l.enable=m(b.enable,!1);l.action=m(b.action,"system-reboot");l.weekday=m(e["week-day"],"Sun");l.day=m(e["month-day"],1);l.hour=m(e.hours,0);l.minute=m(e.minutes,0);l.frequency=void 0!==e["month-day"]?"month":void 0!==e["week-day"]?"weekday":"day";q||(l.action="system-reboot")},l=function(){b.post({url:resource_base+"data/schedule_reboot.json",
method:"get_schedule_reboot",success:function(b){w(b&&b.data&&b.data.result);a.dataReady=!0;a.resetModified()},error:function(b){w({});a.dataReady=!0;a.resetModified()}})};a.dataReady=!1;a.success=!1;a.frequencys=[{id:"day",name:a.DICT("Schedule_Reboot_EveryDay")},{id:"weekday",name:a.DICT("Schedule_Reboot_Week")},{id:"month",name:a.DICT("Schedule_Reboot_Month")}];a.weekdays=[{id:"Mon",name:a.DICT("Schedule_Reboot_Monday")},{id:"Tue",name:a.DICT("Schedule_Reboot_Tuesday")},{id:"Wed",name:a.DICT("Schedule_Reboot_Wednesday")},
{id:"Thu",name:a.DICT("Schedule_Reboot_Thursday")},{id:"Fri",name:a.DICT("Schedule_Reboot_Friday")},{id:"Sat",name:a.DICT("Schedule_Reboot_Saturday")},{id:"Sun",name:a.DICT("Schedule_Reboot_Sunday")}];a.recover_opts=[{id:"system-reboot",name:a.DICT("Schedule_Reboot_Router")}];q&&a.recover_opts.push({id:"wireless-only",name:a.DICT("Schedule_Reboot_Wifi")});a.hours=[];a.minutes=[];a.days=[];a.months=[];for(s=0;24>s;s++)a.hours.push({id:s,name:v(s)});for(s=0;60>s;s++)a.minutes.push({id:s,name:v(s)});
for(s=1;31>=s;s++)a.days.push({id:s,name:v(s)});for(s=1;12>=s;s++)a.months.push({id:s,name:v(s)});a.recovery={enable:!1,action:"system-reboot",frequency:"weekday",day:1,month:1,weekday:"Sun",hour:0,minute:0};a.funs={save:function(){var h=function(){b.post({forcedUsingPost:!0,method:"set_schedule_reboot",params:e(),success:function(b){l();a.success=!0},error:function(a){l()}})},p=function(){q&&a.recovery.enable?app.TOOLS.warningAlertBox({msg:a.DICT("Schedule_Reboot_Note_1"),cbk:function(a){a?h():l()}}):
h()},u=!1;if(a.recovery.enable&&"month"===a.recovery.frequency)switch(a.recovery.day){case 29:case 30:case 31:u=!0}u?app.TOOLS.informationAlertBox({msg:"<div ng-bind=\"DICT('Schedule_Reboot_Note_2')\"></div><br><div ng-bind=\"DICT('Schedule_Reboot_Note_3')\"></div>",cbk:function(a){p()}}):p()},cancel:function(){l()}};l()}]);app.controller("admin_filemanage_main",["$scope","$q","$uibModal","$timeout","rpcFns","MyHttp","Upload","UserSession","modelInfo","userAccessRight","factory_to_default","dt","goToPreviousPage",function(a,b,s,n,v,t,m,q,e,w,l,h,p){a.model={};a.ctx={};a.displayDownloadResult=!1;a.dynamic=0;a.showBarMsg=!1;a.checkProgressResult=!0;a.disableUpgradeBn=!1;a.chunkSize=512;a.pcFileInvalid=!1;a.pcFile=void 0;a.config_modified=!1;a.back_btn=!1;var u=void 0,x=app.TOOLS.get_scope("headerCtrl");x&&(x.warnings&&
x.warnings.save.enable)&&(a.config_modified=!0);p.isneed()&&(a.back_btn=!0);var r=app.TOOLS.get_scope("mainCtrl"),d={fileType:"",source:{"location-url":""},"firmware-option":{"reboot-type":"none"},destination:{}};a.model={device_model:e.get_pid()||"",pid:"",vid:"","image-state":{firmware:{"active-version":"","latest-version":"","latest-update-time":"","available-version":"N/A","last-check-time":"N/A"}},"signature-state":{version:"","latest-update-time":"","available-version":"N/A","last-check-time":"N/A"},
"dongle-driver-state":{version:"","latest-update-time":"","available-version":"N/A","last-check-time":"N/A"},"language-state":{version:"","latest-update-time":"","available-version":"N/A","last-check-time":"N/A"},checking_status:"none"};a.ctx={filetype:"firmware",source:"cisco",reset_default:!1,dest_usb_name:"NONE",return_code:void 0,urlX:"",from_usb:{},reboot:{newHost:""}};var c="",k="",g=!1,z="",y="",A="",B=!1,C="",D=[{code:10,errstr:a.DICT("File_Management_Flash_Errcode_10")},{code:11,errstr:a.DICT("File_Management_Flash_Errcode_11")},
{code:12,errstr:a.DICT("File_Management_Flash_Errcode_12")},{code:13,errstr:a.DICT("File_Management_Flash_Errcode_13")},{code:14,errstr:a.DICT("File_Management_Flash_Errcode_14")},{code:15,errstr:a.DICT("File_Management_Flash_Errcode_15")}],E=function(a){for(var b=D.length,c="Unknown message",g=0;g<b;g++)if(a===D[g].code){c=D[g].errstr;break}return c};a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&q.logout();var I=function(){var c=t.post({url:resource_base+"data/admin_filemanage.json",
method:"get_file_management",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,function(){return t.post({url:resource_base+"data/downloadstatus.json",method:"get_downloadstatus",procBackground:!0,error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})}()]).then(function(b){F(b[0]);app.TOOLS.get_scope("headerCtrl").update_asd_notify(b[0]);b=b[1];var c={},g=-1,c=0;b&&(b.data&&b.data.result)&&(c=b.data.result,g=c.status,c=c.percentage,
a.dynamic=c,1===g&&100>a.dynamic&&(a.disableUpgradeBn=!0,a.showBarMsg=!0,setTimeout(N,3E3)));a.RPC_check_USB_attached();a.loadReady=!0})},F=function(b){var c={},g=[],d={},y={},k={},z={},B={},A="";b&&(b.data&&b.data.result)&&(c=b.data.result,g=c["image-state"]&&c["image-state"].firmware&&c["image-state"].firmware.images&&c["image-state"].firmware.images.image||[],d=c["system-state"]&&c["system-state"].platform||{},y=c["image-state"]&&c["image-state"].firmware||{},k=c["ciscosb-security:signature-state"],
z=c["dongle-driver-state"]||{},B=c["language-state"]||{},k||(k=c["ciscosb-avc:signature-state"]),k||(k={}),angular.forEach(g,function(a){"active"===a.active&&(A=a.version)}),a.model={device_model:e.get_pid()||"",pid:d.pid||"",vid:d.vid||"","image-state":{firmware:{"active-version":A||"N/A","latest-version":y["latest-version"]||"N/A","latest-update-time":W(y["latest-update-time"]),"available-version":y["available-version"]||"N/A","last-check-time":W(y["last-check-time"])}},"signature-state":{version:k.version||
"N/A","latest-update-time":W(k["latest-update-time"]),"available-version":k["available-version"]||"N/A","last-check-time":W(k["last-check-time"])},"dongle-driver-state":{version:z.version||"N/A","latest-update-time":W(z["latest-update-time"]),"available-version":z["available-version"]||"N/A","last-check-time":W(z["last-check-time"])},"language-state":{version:B.version||"N/A","latest-update-time":W(B["latest-update-time"]),"available-version":B["available-version"]||"N/A","last-check-time":W(B["last-check-time"])}})};
a.go_back=p.goback;a.RPC_check_USB_attached=function(b){"true"===b&&(a.showBarMsg=!1,a.checkProgressResult=!1,a.ctx.return_code=void 0,a.displayDownloadResult=!1);return v.RPC_generic_send("usb-check-attached",void 0,function(b,c,g){g=g||{};b=g.usbs||[];g=a.ctx.from_usb;g.usbDevList=[];for(c=0;c<b.length;c++)b[c].attached&&"mass-storage"===b[c]["usbs-type"]&&g.usbDevList.push(b[c].name);1<=g.usbDevList.length&&(a.ctx.dest_usb_name=g.usbDevList[0]);1>g.usbDevList.length&&"usb"==a.ctx.source&&(a.ctx.source=
"pc")},void 0,{procBackground:!1,forcedUsingPost:!1})};var H=function(b){var c=document.location,c=c.protocol+"//"+c.host+"/";b=b||0;a.ctx.reboot.newHost=c;t.post({url:c+"login.html"+(a.ctx.urlX||""),procBackground:!0,error:function(a){Log(DEBUG,"AJAX loading error: "+a.status+", URL: "+a.config.url);Log(DEBUG,JSON.stringify(a))}}).then(function(a){b+=1})["catch"](function(a){b=0;Log(DEBUG,"get login data failed, retry")});3>b?n(function(){H(b)},5E3):(J(),G(),q.logout())};a.isReadyToUpgrade=function(b){return"pc"==
b.source&&a.pcFile||"usb"==b.source&&b.from_usb&&b.from_usb.file&&void 0!=b.from_usb.file["file-name"]||"cisco"==b.source?!0:!1};a.resetFormatCheck=function(){a.pcFileInvalid=!1;"pc"==a.ctx.source&&"firmware"==a.ctx.filetype&&a.pcFileFormatCheck(a.pcFile)};a.pcFileFormatCheck=function(b){a.pcFileInvalid=!1;void 0!=b&&(a.pcFile=b,"pc"==a.ctx.source&&"firmware"==a.ctx.filetype&&(104857600<parseInt(b.size,10)?a.pcFileInvalid=!0:b.name.toLowerCase().match(/(\.img){1}$/)||(a.pcFileInvalid=!0)))};a.getReqParams=
function(){return a.generateErrorOnServer?"?errorCode="+a.serverErrorCode+"&errorMessage="+a.serverErrorMsg:""};a.waitRebootTimer=void 0;a.waitRebootModalInstance=void 0;a.openWaitRebootModal=function(){a.waitRebootModalInstance=s.open({animation:a.animationsEnabled,templateUrl:"wait_reboot_modal.htm",controller:"waitRebootCtrl",size:"600-radius-20",backdrop:"static"});a.waitRebootModalInstance.result.then(function(){a.waitRebootModalInstance=void 0},function(b){a.waitRebootModalInstance=void 0});
G();a.waitRebootTimer=setTimeout(function(){J()},3E5)};var G=function(){void 0!==a.waitRebootTimer&&(clearTimeout(a.waitRebootTimer),a.waitRebootTimer=void 0)},J=function(){a.waitRebootModalInstance&&(a.waitRebootModalInstance.close(),a.waitRebootTimer=void 0)},L=function(b,c,g){b=g.errstr;switch(g.code){case 0:a.dynamic=100;Log(DEBUG,"rpcCallBackDownToUSB() RPC success.");a.ctx.return_code=!0;app.TOOLS.successAlertBox({msg:b,cbk:function(){}});break;default:Log(ERROR,"rpcCallBackDownToUSB() RPC fail: "+
b),a.ctx.return_code=!1,app.TOOLS.criticalAlertBox({msg:a.DICT("File_Management_Download_Failed"),cbk:function(){}}),a.checkProgressResult=!1}a.displayDownloadResult=!0;a.disableUpgradeBn=!1},N=function(){app.TOOLS.get_scope("admin_filemanage_main")&&void 0===a.ctx.return_code&&t.post({url:resource_base+"data/downloadstatus.json",method:"get_downloadstatus",procBackground:!0,success:function(a){M(a)},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},M=function(b){var c=
{},g=-1,c=0;if(b&&b.data&&b.data.result)switch(c=b.data.result||{},g=void 0!==c.status?c.status:-100,c=void 0!==c.percentage?c.percentage:0,a.dynamic=c,g){case -100:a.showBarMsg=!1;void 0===a.ctx.return_code&&setTimeout(N,3E3);break;case 1:a.showBarMsg=!0;a.checkProgressResult=!0;K("down_in_progress");void 0===a.ctx.return_code&&setTimeout(N,3E3);break;case 0:a.showBarMsg=!0;a.checkProgressResult=!0;a.disableUpgradeBn=!1;K("down_success");"firmware"===k&&(!1!==a.ctx.return_code&&"user_trigger_upgrade"===
C)&&app.transition.In();break;default:switch(g){case -2:b=a.DICT("File_Management_There_Is_No_File");break;case -3:b=a.DICT("File_Management_Network_Issue");break;default:b=a.DICT("File_Management_Download_Failed")}"user_trigger_upgrade"!==C&&app.TOOLS.criticalAlertBox({msg:b,cbk:function(){}});a.showBarMsg=!0;a.checkProgressResult=!1;a.disableUpgradeBn=!1;K("down_fail")}},P=function(){var b=A,c=B;u.upload=m.upload({url:resource_base+"upload"+a.getReqParams(),resumeSizeUrl:c?resource_base+"upload?name22="+
encodeURIComponent(u.name):null,resumeChunkSize:c?a.chunkSize:null,headers:{"optional-header":"header-value"},data:{sessionid:"EU6DJKEIWO",pathparam:b,fileparam:"file001",file:u}});u.upload.then(function(a){n(function(){u.result=a.data;Log(DEBUG,"upload success");K("upload_success")})},function(b){0<b.status&&(a.errorMsg=b.status+": "+b.data);Log(ERROR,"upload fail");K("upload_fail");app.TOOLS.criticalAlertBox({msg:a.DICT("File_Management_Upload_Failed"),cbk:function(){}})},function(a){u.progress=
Math.min(100,parseInt(100*a.loaded/a.total,10))});u.upload.xhr(function(a){})},U=function(){v.RPC_generic_send("file-copy",d,function(b,c,g){b=g.errstr;c=k;switch(g.code){case 0:a.ctx.reset_default&&l.reset();Log(ERROR,"doStateDownloadFromCisco() RPC success.");K("flash_success");a.ctx.return_code=!0;if(!a.rebootFlag){if(!b)switch(c){case "firmware":b=a.DICT("File_Management_Upgrade_Firmware_From_Cisco_Success");break;case "signature":b=a.DICT("File_Management_Upgrade_Signature_From_Cisco_Success");
break;case "3g-4g-driver":b=a.DICT("File_Management_Upgrade_USB_Dongle_From_Cisco_Success");break;case "language-pack":b=a.DICT("File_Management_Upgrade_Language_From_Cisco_Success")}app.TOOLS.successAlertBox({msg:b,cbk:function(){}})}break;default:Log(ERROR,"doStateDownloadFromCisco() RPC fail: "+b);app.transition.Out();a.ctx.return_code=!1;K("flash_fail");if(!b)switch(c){case "firmware":b=a.DICT("File_Management_Upgrade_Firmware_From_Cisco_Failure");break;case "signature":b=a.DICT("File_Management_Upgrade_Signature_From_Cisco_Failure");
break;case "3g-4g-driver":b=a.DICT("File_Management_Upgrade_USB_Dongle_From_Cisco_Failure");break;case "language-pack":b=a.DICT("File_Management_Upgrade_Language_From_Cisco_Failure")}app.TOOLS.criticalAlertBox({msg:b,cbk:function(){}})}},void 0,{forcedUsingPost:!0});setTimeout(N,5E3)},Q=function(){"firmware"===k&&(r.normal_show=!1,r.custom_loading_message="<table><tr><td ng-bind=\"DICT('File_Management_Flash_Note1')\"></td></tr><tr><td ng-bind=\"DICT('File_Management_Flash_Note2')\"></td></tr><tr><td ng-bind=\"DICT('File_Management_Flash_Note3')\"></td></tr></table>");
v.RPC_generic_send("file-copy",d,function(b,c,g){b=g.code;g=g.errstr;switch(b){case 0:Log(DEBUG,"doStateFlash() RPC success.");a.ctx.return_code=!0;K("flash_success");a.rebootFlag||app.TOOLS.successAlertBox({msg:g,cbk:function(){}});break;default:""===g&&(g=E(b)),a.ctx.return_code=!1,app.transition.Out(),K("doStateFlash() flash_fail"),Log(DEBUG,"RPC fail: "+g),app.TOOLS.criticalAlertBox({msg:g,cbk:function(){}})}"firmware"===k&&(r.normal_show=!0)},void 0,{forcedUsingPost:a.forcedUsingPost})},V=function(){a.rebootFlag?
function(){app.transition.Out();Log(DEBUG,"Upgrade success, Device rebooting, try url loading..(30000)");a.openWaitRebootModal();n(function(){a.ctx.reboot.userControlPanel=!0;H()},3E4)}():I();a.disableUpgradeBn=!1;u=void 0;K("finish")},R=function(){a.disableUpgradeBn=!1;u=void 0;K("finish")},K=function(a){switch(a){case "trigger_upload":P();break;case "trigger_flash":Q();break;case "trigger_download":U();break;case "upload_success":Q();break;case "upload_fail":R();break;case "flash_success":V();break;
case "flash_fail":R()}},S=function(){d.source["location-url"]="http://cisco.com/";switch(k){case "firmware":a.rebootFlag=!0;g?(d["firmware-option"]["reboot-type"]="factory-default-config-certificate",app.TOOLS.warningAlertBox({msg:a.DICT("File_Management_Upgrade_and_factory_Note"),cbk:function(b){b?K("trigger_download"):a.disableUpgradeBn=!1}})):K("trigger_download");break;case "signature":case "3g-4g-driver":K("trigger_download");break;case "language-pack":a.disableUpgradeBn=!1}},T=function(){d.destination["firmware-state"]=
"inactive";switch(k){case "firmware":A="Firmware";d.source["location-url"]="FILE://"+A+"/file001";a.rebootFlag=!0;g?(d["firmware-option"]["reboot-type"]="factory-default-config-certificate",app.TOOLS.warningAlertBox({msg:a.DICT("File_Management_Upgrade_and_factory_Note"),cbk:function(b){b?K("trigger_upload"):a.disableUpgradeBn=!1}})):K("trigger_upload");break;case "signature":A="Signature";d.source["location-url"]="FILE://"+A+"/file001";K("trigger_upload");break;case "3g-4g-driver":A="3g-4g-driver";
d.source["location-url"]="FILE://"+A+"/file001";K("trigger_upload");break;case "language-pack":a.disableUpgradeBn=!1}},O=function(){y=a.ctx.from_usb.file["file-name"];d.source["location-url"]="FILE://"+z+"/"+y;d.destination["firmware-state"]="inactive";switch(k){case "firmware":a.rebootFlag=!0;g?(d["firmware-option"]["reboot-type"]="factory-default-config-certificate",app.TOOLS.warningAlertBox({msg:a.DICT("File_Management_Upgrade_and_factory_Note"),cbk:function(b){b?K("trigger_flash"):a.disableUpgradeBn=
!1}})):K("trigger_flash");break;case "signature":case "3g-4g-driver":K("trigger_flash");break;case "language-pack":a.disableUpgradeBn=!1}};a.triggerUpgrade=function(b){var h="",e=!1,r=function(){a.ctx.return_code=void 0;switch(c){case "cisco":S();break;case "pc":T();break;case "usb":O()}};b&&(u=b);c=a.ctx.source;k=a.ctx.filetype;g=a.ctx.reset_default;z=a.ctx.dest_usb_name||"";y=u&&u.name||"";A="";B=!1;C="user_trigger_upgrade";d={fileType:k,source:{"location-url":""},"firmware-option":{"reboot-type":"none"},
destination:{}};a.showBarMsg=!1;a.checkProgressResult=!1;a.disableUpgradeBn=!0;a.rebootFlag=!1;a.displayDownloadResult=!1;b&&b.progress&&(b.progress=-1);"pc"===c&&!b?a.disableUpgradeBn=!1:"firmware"===k?(h=a.DICT("File_Management_Upgrade_Firmware_Note"),a.config_modified&&!g&&(e=!1,h=a.DICT("File_Management_Upgrade_Firmware_With_Modified_Configure_Note")),app.TOOLS.warningAlertBox({title:a.DICT("Confirm"),msg:h,cbk:function(b){b?e?t.post({method:"action",forcedUsingPost:!0,params:{rpc:"file-copy",
input:{fileType:"configuration",source:{"config-type":"config-running"},destination:{"config-type":"config-startup"}}},success:function(a){r()},error:function(b){app.TOOLS.warningAlertBox({msg:a.DICT("File_Management_Save_Configure_Failure"),cbk:function(a){a&&r()}})}}):r():a.disableUpgradeBn=!1}})):r()};a.triggerDownload=function(){"language-pack"!==a.ctx.filetype&&(a.displayDownloadResult=!1,a.checkProgressResult=!1,a.ctx.return_code=void 0,a.disableUpgradeBn=!0,a.showBarMsg=!1,c=a.ctx.source,k=
a.ctx.filetype,g=a.ctx.reset_default,z=a.ctx.dest_usb_name||"",C="usb",B=A=y=void 0,d={fileType:k,source:{"location-url":"http://cisco.com/"},destination:{"location-url":"FILE://"+z+"/"}},v.RPC_generic_send("file-copy",d,L,void 0,{procBackground:!0,forcedUsingPost:!0}),setTimeout(N,5E3))};a.switchRadioBn=function(b){a.showBarMsg=!1;a.displayDownloadResult=!1;b&&b.progress&&(b.progress=-1)};var W=function(a){return h.genTimeStrByTimeStamp(a,"N/A")};a.checkNow=function(){a.disableUpgradeBn=!0;var b=
app.TOOLS.get_scope("backgroundAppCtrl");b&&(b.firmware_lib&&"function"===$.type(b.firmware_lib.check_firmware))&&"start"===b.firmware_lib.check_firmware()&&(a.model.checking_status="checking")};a.invokeCheckingSuccessCbk=function(b,c){a.disableUpgradeBn=!1;a.model.checking_status="finish";a.errstr=c;I()};I()}]);app.controller("smart_license_main",["$scope","$q","$uibModal","$log","MyHttp","$http","$timeout","$templateCache","Sets","userAccessRight","UserSession","goToPreviousPage",function(a,b,s,n,v,t,m,q,e,w,l,h){var p=!1;a.model=a.model||{};a.env=a.env||{};a.ctx=a.ctx||{};a.env.modalList=a.env.modalList||[];a.loadReady=!1;a.env.success=!1;a.backbtn=!1;a.ui_data={note1:a.DICT("License_Login_To_Account",{"%s":'<a target="_blank" href="https://software.cisco.com/#SmartLicensing-Inventory">'+a.DICT("License_Here")+
"</a>"})};a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&l.logout();h.isneed()&&(a.backbtn=!0);a.go_back=h.goback;a.env.supportDB=!0;var u=function(b,d){return v.post({url:resource_base+(b||"data/smart_license.json"),method:"get_smart_license",options:{transformResponse:app.modelhelper.db2webFn},procBackground:!0,success:function(b){angular.extend(a.model,b.data.result);x();a.schema=a.schema||{};a.schema.exportMap={"true":a.DICT("License_Allowed"),"false":a.DICT("License_Not_Allowed")};
a.schema.statusMap={"true":a.DICT("License_Succeed"),"false":a.DICT("License_Failed")};a.schema.RegMap={"license-registration-registrated":a.DICT("License_Registered"),"license-registration-unregistrated":a.DICT("License_Unregistered"),"license-registration-registration-expired":a.DICT("License_Reg_Expired"),"license-registration-failed":a.DICT("License_Unreg_Failed"),"license-registration-inprogress":a.DICT("License_Unreg_Pending"),"license-registration-retry-inprogress":a.DICT("License_Unreg_In_Progress")};
a.schema.AuthMap={"license-authorization-status-authorized":a.DICT("License_Authorized"),"license-authorization-status-evaluation":a.DICT("License_Evaluation_Mode"),"license-authorization-status-evaluation-period-expired":a.DICT("License_Evaluation_Expired"),"license-authorization-status-out-of-compliance":a.DICT("License_Out_Compliance"),"license-authorization-status-authorization-expired":a.DICT("License_Auth_Expired"),"license-authorization-status-invalid":a.DICT("License_Error_Invalid"),"license-authorization-status-init":a.DICT("License_Not_In_Use"),
"license-authorization-status-waiting":a.DICT("License_Pending"),"license-authorization-status-overage":a.DICT("License_Overage"),"license-authorization-status-disabled":a.DICT("License_Disabled"),"license-authorization-status-no-in-use":a.DICT("License_No_License_In_Use"),"license-authorization-status-invalidtag":a.DICT("License_Invalid_Tag")};a.schema.FeatureMap={"license-feature-status-authorized":a.DICT("License_Authorized"),"license-feature-status-evaluation":a.DICT("License_Evaluation_Mode"),
"license-feature-status-evaluation-period-expired":a.DICT("License_Evaluation_Expired"),"license-feature-status-out-of-compliance":a.DICT("License_Out_Compliance"),"license-feature-status-authorization-expired":a.DICT("License_Auth_Expired"),"license-feature-status-invalid":a.DICT("License_Error_Invalid"),"license-feature-status-init":a.DICT("License_Not_In_Use"),"license-feature-status-waiting":a.DICT("License_Pending"),"license-feature-status-overage":a.DICT("License_Overage"),"license-feature-status-disabled":a.DICT("License_Disabled"),
"license-feature-status-invalidtag":a.DICT("License_Invalid_Tag"),"license-feature-status-no-in-use":a.DICT("License_No_License_In_Use")};a.schema.RegState={"license-registration-registrated,renewOK":{template:"T_License_reg_popover_Registrated_renewOK.htm",imgsrc:"themes/img/icon/Status_success_icon.png"},"license-registration-registrated,renewFailed":{template:"T_License_reg_popover_Registrated_renewFailed.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-registration-unregistrated":{template:"T_License_reg_popover_Unregistrated.htm",
imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-registration-registration-expired":{template:"T_License_reg_popover_Registration_Expired.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-registration-failed":{template:"T_License_reg_popover_Registration_Failed.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-registration-inprogress":{template:"T_License_reg_popover_Registration_Inprogress.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},
"license-registration-retry-inprogress":{template:"T_License_reg_popover_Registration_Retry_Inprogress.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"}};a.schema.AuthState={"license-authorization-status-authorized,renewOK":{template:"T_License_auth_popover_Authorized_renewOK.htm",imgsrc:"themes/img/icon/Status_success_icon.png"},"license-authorization-status-authorized,renewFailed":{template:"T_License_auth_popover_Authorized_renewFailed.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},
"license-authorization-status-evaluation":{template:"T_License_auth_popover_Evaluation.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-authorization-status-evaluation-period-expired":{template:"T_License_auth_popover_Evaluation_Period_Expired.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-authorization-status-out-of-compliance":{template:"T_License_auth_popover_Out_of_Compliance.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-authorization-status-expired":{template:"T_License_auth_popover_Authorization_Expired.htm",
imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-authorization-status-authorization-expired":{template:"T_License_auth_popover_Authorization_Expired.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-authorization-status-invalid":{template:"T_License_auth_popover_Authorization_Invalid.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-authorization-status-init":{template:"T_License_auth_popover_Authorization_NotInUse.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},
"license-authorization-status-waiting":{template:"T_License_auth_popover_Authorization_Waiting.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-authorization-status-overage":{template:"T_License_auth_popover_Authorization_Overage.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-authorization-status-disabled":{template:"T_License_auth_popover_Authorization_Disabled.htm",imgsrc:"themes/img/icon/Status_success_icon.png"},"license-authorization-status-no-in-use":{template:"T_License_auth_popover_Authorization_NoInUse.htm",
imgsrc:"themes/img/icon/Status_success_icon.png"},"license-authorization-status-invalidtag":{template:"T_License_auth_popover_Authorization_Invalidtag.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"}};a.schema.FeaState={"license-feature-status-authorized":{template:"T_License_fea_popover_Authorized_renewOK.htm",imgsrc:"themes/img/icon/Status_success_icon.png"},"license-feature-status-evaluation":{template:"T_License_fea_popover_Evaluation.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},
"license-feature-status-evaluation-period-expired":{template:"T_License_fea_popover_Evaluation_Period_Expired.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-out-of-compliance":{template:"T_License_fea_popover_Out_of_Compliance.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-expired":{template:"T_License_fea_popover_Expired.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-authorization-expired":{template:"T_License_fea_popover_Expired.htm",
imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-invalid":{template:"T_License_fea_popover_Invalid.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-init":{template:"T_License_fea_popover_NotInUse.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-feature-status-waiting":{template:"T_License_fea_popover_Waiting.htm",imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-feature-status-overage":{template:"T_License_fea_popover_Overage.htm",
imgsrc:"themes/img/icon/Status_warning_icon.gif"},"license-feature-status-disabled":{template:"T_License_fea_popover_Disabled.htm",imgsrc:"themes/img/icon/Status_success_icon.png"},"license-feature-status-invalidtag":{template:"T_License_fea_popover_Invalidtag.htm",imgsrc:"themes/img/icon/Status_ciriticalerror_icon.png"},"license-feature-status-no-in-use":{template:"T_License_auth_popover_Authorization_NoInUse.htm",imgsrc:"themes/img/icon/Status_success_icon.png"}};a.model_orig=angular.copy(a.model);
a.$watch("model.license_state.registration.status",function(b,c){b!=c&&(Log(DEBUG,"watch: "+b),a.Fns.refreshStatusText("registration"))});a.$watch("model.license_state.authorization.authorization_status.status",function(b,c){b!=c&&(Log(DEBUG,"watch: "+b),a.Fns.refreshStatusText("authorization"))});r();angular.forEach(a.model.license.features,function(a){a.display_name=a.name});a.lsref=a.model.license_state;a.lref=a.model.license;a.gridLicense.Options.data=a.model.license.features;a.loadReady=!0},
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);x()}})};u();var x=function(){a.flag_errLicenseModel=!1;a.model.license_state||(a.flag_errLicenseModel=!0);e.recover_object(a.model,{license:{token:"",features:[]}});e.recover_object(a.model,{license_state:{enable:!0,registration:{status:"license-registration-unregistrated"},authorization:{authorization_status:{time:"--",status:"license-authorization-status-no-in-use"}},smart_account:"-",virtual_account:"-",pid:"-",
export_controlled:"-",features:[]}});a.model.license_state.enable=!0;angular.forEach(a.model.license_state.features,function(a,b){void 0==a.status&&!0!==a.enable&&(a.status="license-feature-status-no-in-use")});a.flag_errLicenseModel&&alert("License data request failed, database in No data")},r=function(){angular.forEach(a.model.license.features,function(b,d){angular.forEach(a.model.license_state.features,function(a,d){b.name==a.name&&(b._ref=a)})})};a.gridLicense=a.gridLicense||{};a.gridLicense.Selections=
[];a.gridLicense.OptionsShow=!0;a.gridLicense.filterRowsByEnable=function(a){var b=[];angular.forEach(a,function(a){!0===a.entity.enable&&b.push(a)});return b};a.gridLicense.Options=app.uiGrid.generateGridOptions({onRegisterApi:function(b){a.gridLicense.Options.gridApi.core.registerRowsProcessor(a.gridLicense.filterRowsByEnable,200)},columnDefs:[{field:"display_name",displayName:a.DICT("License_Name"),cellClass:function(a,b,g){if(b&&b.entity&&b.entity._ref&&!1===b.entity._ref.enable)return"_greyout"}},
{field:"description",displayName:a.DICT("License_Desc"),cellClass:function(a,b,g){if(b&&b.entity&&b.entity._ref&&!1===b.entity._ref.enable)return"_greyout"}},{field:"count",displayName:a.DICT("License_Count"),width:80,cellTemplate:q.get("UG_License_feature_count_display.html").replace(/ARGS1/,q.get("UG_CellText_float_left.html"))},{field:"_ref.status",displayName:a.DICT("License_Status"),cellTemplate:q.get("UG_License_feature_status_with_popover.html").replace(/ARGS1/g,q.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,
"grid.appScope.schema.FeatureMap[MODEL_COL_FIELD]"))}]});a.gridLicense.Options2=app.uiGrid.generateGridOptions({columnDefs:[{field:"enable",displayName:a.DICT("License_Enable"),width:80,cellTemplate:q.get("UG_table_checkbox_2.html")},{field:"display_name",displayName:a.DICT("License_Name_V")},{field:"description",displayName:a.DICT("License_Desc")},{field:"count",displayName:a.DICT("License_Count"),width:100,cellTemplate:q.get("UG_License_feature_count.html").replace(/data-ng-expansion/,"required min=\"{{ grid.appScope.Fns.featureSpecRule(row.entity, 'minCount') }}\" max=\"{{ grid.appScope.Fns.featureSpecRule(row.entity, 'maxCount') }}\"")}]});
a.calcRemainTime=function(a){a=a.replace(/\+\d+:\d+/,"");a=Date.parse(a);var b=Date.parse((new Date).toJSON());a-=b;if(0<a){a/=1E3;var b=Math.floor(a/86400),g=Math.floor((a-86400*b)/3600);return[b,g,Math.floor((a-86400*b-3600*g)/60)]}return[]};a.reg_last_attempt_exist=function(a){return void 0==a.registration.last_renewal_attempt?!1:!(void 0==a.registration.last_renewal_attempt.time||""==a.registration.last_renewal_attempt.time)};a.shortTimeFormat=function(a,b){function g(a){return 10>a?"0"+a:a}var d=
a.replace(/:\*\*/,":30").replace(/([-+])(\d+):(\d+)$/,"$1$2$3"),y=/([-+])(\d+)$/;d.match(y);var d=d.replace(y,""),A=new Date(d),d=A.getUTCFullYear(),y="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[A.getUTCMonth()],B=A.getUTCDate();if("datetime"==b){var h=g(A.getUTCHours()),e=g(A.getUTCMinutes()),A=g(A.getUTCSeconds());return y+" "+B+", "+d+" "+h+":"+e+":"+A+""}return y+" "+B+", "+d};a.display_reg_attempt=function(b){var d;b.registration.last_renewal_attempt&&(d=b.registration.last_renewal_attempt.time);
var g="";void 0==d||""==d?b.registration.initial_registration&&b.registration.initial_registration.time&&(b=b.registration.initial_registration.time,g=a.shortTimeFormat(b)):(b=b.registration.last_renewal_attempt.time,g=a.shortTimeFormat(b));return g};a.display_auth_status_msg=function(b,d){var g="";a.display_auth_expired_status(d)?(g=b.authorization.authorization_status.time,g=a.shortTimeFormat(g)):b.authorization.last_communication_attempt&&void 0!==b.authorization.last_communication_attempt.time&&
(g=b.authorization.last_communication_attempt.time,g=a.shortTimeFormat(g));return g};a.display_reg_status=function(a){var b=!1;switch(a.reg_stat){case "license-registration-inprogress":case "license-registration-failed":case "license-registration-retry-inprogress":case "license-registration-registrated":case "license-registration-registrated-expired":b=!0}return b};a.display_reg_init_status=function(a){var b=!1;switch(a.reg_stat){case "license-registration-inprogress":b=!0}return b};a.display_reg_retry_status=
function(a){var b=!1;switch(a.reg_stat){case "license-registration-failed":case "license-registration-retry-inprogress":b=!0}return b};a.display_reg_renew_status=function(a){var b=!1;switch(a.reg_stat){case "license-registration-registrated":b=!0}return b};a.display_auth_renew_status=function(a){var b=!1;switch(a.auth_stat){case "license-authorization-status-authorized":case "license-authorization-status-out-of-compliance":b=!0}return b};a.display_auth_eval_status=function(a){return"license-authorization-status-evaluation"==
a.auth_stat};a.display_auth_expired_status=function(a){var b=!1;switch(a.auth_stat){case "license-authorization-status-evaluation-period-expired":case "license-authorization-status-expired":b=!0}return b};a.testRpc=function(a){alert(a);resource_base=a};a.Fns={featureSpecRule:function(a,b){var g=!1,d=0,y=127;switch(a.name.toLowerCase()){case "anyconnectvpn":g=!0,d=2,y=50}if("mark"==b)return g;if("minCount"==b)return d;if("maxCount"==b)return y;Log(DEBUG,"featureSpecRule: else")},gridRedraw:function(){Log(DEBUG,
"== redraw ==");a.gridLicense.OptionsShow=!1;m(function(){a.gridLicense.OptionsShow=!0},50)},isRegistered:function(){return"license-registration-registrated"==a.model.license_state.registration.status||"license-registration-registration-expired"==a.model.license_state.registration.status},renewReg:function(c,k){d.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",rpcname:"license-renew-registeration-cert"},{error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);
k("errComm")}}).then(function(a){d.ret_code_handler(a,{"0":function(a){g()},"default":function(a,b,c){console.log((b||"default:")+" ret_code_handler: Internal error code="+a);k("LicenseError",a,c)}},"license-renew-registeration-cert")});var g=function(c){c=c||0;var y=b.defer(),A=y.promise;0==c?(Log(DEBUG,"renewRegdo retry(wait 20s), retryCount="+c),m(function(){Log(DEBUG,"renewRegdo retry(20s exceed), retryCount="+c);d.fetchModelResult(y)},2E4)):d.fetchModelResult(y);A.then(function(b){var y=void 0;
b&&(b.license_state&&b.license_state.registration&&b.license_state.registration.last_renewal_attempt)&&(y=b.license_state.registration.last_renewal_attempt);Log(DEBUG,"newValue=> "+JSON.stringify(y));b=a.model.license_state.registration.last_renewal_attempt;!angular.isDefined(y)||y.time==b.time?d.doRetry("renewReg",c,8,g,function(){k("errTimeout")}):!1==y.status?(Log(DEBUG,"newValue Failed"),k("errComm")):(Log(DEBUG,"newValue updated"),k("renewOK"))})}},renewAuth:function(c,k){d.doSyncRPC({url:resource_base+
"data/exec_smart_license_regOK.json",rpcname:"license-renew-authorization"},{error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);k("errComm")}}).then(function(a){d.ret_code_handler(a,{"0":function(a){g()},"default":function(a,b,c){console.log((b||"default:")+" ret_code_handler: Internal error code="+a);k("LicenseError",a,c)}},"license-renew-authorization")});var g=function(c){c=c||0;var y=b.defer(),A=y.promise;0==c?(Log(DEBUG,"renewAuthdo retry(wait 20s), retryCount="+
c),m(function(){Log(DEBUG,"renewAuthdo retry(20s exceed), retryCount="+c);d.fetchModelResult(y)},2E4)):d.fetchModelResult(y);A.then(function(b){b=b.license_state.authorization.last_communication_attempt;Log(DEBUG,"newValue "+JSON.stringify(b));b.time==a.model.license_state.authorization.last_communication_attempt.time?d.doRetry("renewAuth",c,8,g,function(){k("errTimeout")}):!1==b.status?(Log(DEBUG,"newValue Failed"),k("errComm")):(Log(DEBUG,"newValue updated"),k("renewOK"))})}},doAuthorize:function(c,
k,g){var z={name:c.name.split(" ")[0],count:c.count};!1===c.count_based&&delete z.count;d.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",input:z,rpcname:"license-authorize"},{error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);k("errComm")}}).then(function(a){d.ret_code_handler(a,{"0":function(a){B()},"default":function(a,b){console.log((b||"default:")+" ret_code_handler: Internal error code="+a);k("errComm")}},"license-authorize")});var y=function(a,
b){var c;angular.forEach(a,function(a,g){a.name==b.name&&(c=a)});return c},A=function(b){b=b.license_state.features;var g=y(a.model.license_state.features,c);angular.forEach(b,function(b,d){b.name==c.name&&angular.forEach(a.model.license.features,function(a,d){void 0==g&&a.name==c.name&&(a._ref=b)})})},B=function(z){z=z||0;var k=b.defer(),h=k.promise;if(0==z){var e=c.name;Log(DEBUG,e+"do retry(wait 20s), retryCount="+z);m(function(){Log(DEBUG,e+"Refresh(wait 3s)");var c=b.defer();a.Fns.fetchModel().then(function(b){a.Fns.getElemResult(b,
c)});c.promise.then(function(a){Log(DEBUG,e+"Refresh(wait 3s) exceed");A(a)})},3E3);m(function(){Log(DEBUG,e+"do retry(20s exceed), retryCount="+z);d.fetchModelResult(k)},2E4)}else d.fetchModelResult(k);h.then(function(b){var k=a.model.license_state.features,A=!1,h=!1;angular.forEach(b.license_state.features,function(a,b){var d=!1,z=y(k,c);void 0!=z&&(d=!0);void 0==a.count&&Log(DEBUG,"itemNew.count undef");void 0==z&&Log(DEBUG,"matchOrig undef");z&&void 0==z.count&&Log(DEBUG,"matchOrig.count undef");
a.name==c.name&&("license-feature-status-waiting"!=a.status&&z&&(a.count!=z.count||a.status!=z.status)?(g.resolve(c.name),A=!0,h=!1):h=!0);!d&&(a.name==c.name&&"license-feature-status-waiting"!=a.status)&&(g.resolve(c.name),A=!0,h=!1)});(!A||h)&&d.doRetry(c.name,z,20,B,function(){g.reject(c.name)})})}},doDeauthorize:function(a,b,g){d.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",input:{name:a.name},rpcname:"license-deauthorize"},{error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url);b("errComm")}}).then(function(b){d.ret_code_handler(b,{"0":function(b){g.resolve(a.name)},8:function(b){console.log(name+" ret_code_handler: as resolve case, Internal error code="+b);g.resolve(a.name)},"default":function(b,d){console.log((d||"default:")+" ret_code_handler: Internal error code="+b);g.reject(a.name)}},"license-deauthorize")})},doAuthRenewCount:function(a,k,g){var z=b.defer(),y=b.defer();d.doDeauthorize(a,k,z);z.promise.then(function(b){d.doAuthorize(a,
k,y);m(function(){d.refreshModelData().then(function(a){d.gridRedraw()})},4E3)}).catch(function(b){g.reject(a.name)}).finally(function(){console.log(JSON.stringify(a))});y.promise.then(function(b){g.resolve(a.name)}).catch(function(b){g.reject(a.name)}).finally(function(){console.log(JSON.stringify(a))})},chooseLicense:function(){a.gridLicense.Options2Show=!1;d.openModal("ChooseSmartLicenses","lg");m(function(){a.gridLicense.Options2Show=!0},100)},refreshModelData:function(a){return u(a)},getRPCResult:function(a,
b){if(a.data.result&&a.data.result.output){var g=a.data.result.output;return b?g[b]:g}console.log("Error: getRPCResult, data.result not exist")},doSyncRPC:function(a,b){var g={};a.input&&(g.input=a.input);g.rpc=a.rpcname||"";return v.post({url:a.url||"",method:"action",params:g,procBackground:!0,success:function(a){b&&b.success&&b.success(a)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);b&&b.error&&b.error(a)}})},ret_code_handler:function(a,b,g){var z=d.getRPCResult(a,
"code");a=d.getRPCResult(a,"errstr");a={code:z,errstr:a};z=parseInt(z);b&&!b["default"]&&(g=g||"default:",b["default"]=function(a,b){console.log(b+" ret_code_handler: Default, unknown code="+a)});if(b[z])b[z](z,g,a);else b["default"](z,g,a)},fetchModel:function(){return v.post({url:resource_base+"data/smart_license.json",method:"get_smart_license",options:{transformResponse:app.modelhelper.db2webFn},procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},
getElemResult:function(a,b){var g;a.data&&a.data.result?(g=a.data.result,b.resolve(g)):b.reject("AJAX result expected JSON element not exist")},doRetry:function(a,b,g,d,y){a=a+":"||"unnamed:";b++;b<=g?m(function(){Log(DEBUG,a+"do retry(5s exceed), retryCount="+b);d(b)},5E3):(Log(DEBUG,a+"retry Timout"),y&&y())},fetchModelResult:function(b){a.Fns.fetchModel().then(function(d){a.Fns.getElemResult(d,b);r()})},refreshStatusText:function(b){a.lsref[b].recent_state=a.lsref[b].recent_state||0;a.ctx=a.ctx||
{};var d="";switch(a.lsref[b].recent_state){case 1:d="renewFailed";a.lsref[b].recent_state_msg="Failed";break;default:d="renewOK",a.lsref[b].recent_state_msg="Succeeded"}"registration"==b?(a.ctx.reg_stat=a.lsref[b].status,a.ctx.reg_sobj="license-registration-registrated"==a.ctx.reg_stat?a.schema.RegState[a.ctx.reg_stat+","+d]:a.schema.RegState[a.ctx.reg_stat]):"authorization"==b&&(a.ctx.auth_stat=a.lsref[b].authorization_status.status,a.ctx.auth_sobj="license-authorization-status-authorized"==a.ctx.auth_stat?
a.schema.AuthState[a.ctx.auth_stat+","+d]:a.schema.AuthState[a.ctx.auth_stat])},refreshFeatureStatusText:function(b){return{fea_sobj:a.schema.FeaState[b]}},openModal:function(b,d){p||s.open({animation:a.animationsEnabled,templateUrl:"smart_license_modal.htm",controller:"smart_license_sl_modal_ctrl",size:d,backdrop:"static",resolve:{model:function(){return a.model},modalID:function(){return b},gridLicense:function(){return a.gridLicense},Fns:function(){return a.Fns},env:function(){return a.env}}}).result.then(function(a){},
function(a){})}};var d=a.Fns;a.env.timer_license_state_polling=void 0;a.$on("$destroy",function(){a.env.timer_license_state_polling&&m.cancel(a.env.timer_license_state_polling);p=!0})}]);
app.controller("smart_license_sl_modal_ctrl",["$scope","$uibModalInstance","$q","model","modalID","gridLicense","Fns","env","MyHttp","$timeout",function(a,b,s,n,v,t,m,q,e,w){a.model=n;a.env=q;a.gridLicense=t;a.Fns=m;a.ctx=a.ctx||{};a.env.modalList.push({id:v,inst:b});var l={save:function(){b.close(a.model)},cancel:function(){var h=a.env.modalList.length-1;0<=h&&(a.env.modalList&&a.env.modalList[h]&&a.env.modalList[h].inst&&a.env.modalList[h].id==v)&&a.env.modalList.pop();b.dismiss("cancel")},enabledLic:function(){a.model.license_state.enable=
!0},disabledLic:function(){l.deregister();a.model.license_state.enable=!1},register:function(){a.model.license_state.registration.status="license-registration-registrated"},deregister:function(){a.model.license_state.registration.status="license-registration-unregistrated"},isRegistered:function(){return m.isRegistered()},showCommBox:function(b){a.uiref.commCtx.show=b},setCommBoxAndClose:function(b,e,u){a.uiref.commCtx.state=b;w(function(){u?u():l.showCommBox(!1)},e)},openModal:function(b,e,l){if(l&&
l.closePrevDialog){var x=a.env.modalList.length-1;0<=x&&(a.env.modalList&&a.env.modalList[x]&&a.env.modalList[x].inst&&a.env.modalList[x].id==l.closePrevDialog)&&a.env.modalList[x].inst.dismiss("cancel")}m.openModal(b,e)}};a.UIEvents={runRenewReg:function(b){m.renewReg("RenewReg",function(e,u,x){u="errComm"==e;var r="errTimeout"==e,d="LicenseError"==e;"renewOK"==e?(a.env.supportDB&&m.refreshModelData(),l.setCommBoxAndClose("success",2E3,function(){b?b():l.cancel()})):u?(a.uiref=a.modal_db.RegistrationRenewalFailed,
a.tref=a.modal_db.RegistrationRenewalFailed):r?(a.uiref=a.modal_db.RegistrationRenewalTimeout,a.tref=a.modal_db.RegistrationRenewalTimeout):d?(a.uiref=a.modal_db.LicenseError,a.tref=a.modal_db.LicenseError,a.uiref.resp_obj=x||{code:"code Not Found"},a.uiref.action_str="renewal license registration"):alert("Unknown UI statue: "+e)})},runRenewAuth:function(b){m.renewAuth("RenewAuth",function(e,u,x){u="errComm"==e;var r="errTimeout"==e,d="LicenseError"==e;"renewOK"==e?(a.env.supportDB&&m.refreshModelData(),
l.setCommBoxAndClose("success",2E3,function(){b?b():l.cancel()})):u?(a.uiref=a.modal_db.LicenseAuthorizationRenewalFailed,a.tref=a.modal_db.LicenseAuthorizationRenewalFailed):r?(a.uiref=a.modal_db.LicenseAuthorizationRenewalTimeout,a.tref=a.modal_db.LicenseAuthorizationRenewalTimeout):d?(a.uiref=a.modal_db.LicenseError,a.tref=a.modal_db.LicenseError,a.uiref.resp_obj=x||{code:"code Not Found"},a.uiref.action_str="renewal license authorization"):alert("Unknown UI statue: "+e)})}};a.modal_db={ConfigureLicense:{template:"ConfigureLicense.htm",
funs:{cancel:l.cancel,init:function(){a.uiref.commCtx={show:!1,state:"ongoing",msg:"Configure product for Smart Licensing",success:"Update successfully"};a.ctx.call_home=angular.copy(a.model.call_home)},save:function(){var b=function(b,h,e){h="saveFailed"==b;var r="errComm"==b,d="errTimeout"==b,c="LicenseError"==b;a.uiref.errToken=!1;a.uiref.errComm=!1;"saveOK"==b?(l.showCommBox(!0),l.setCommBoxAndClose("success",2E3,function(){l.cancel()})):h?(a.uiref.errToken=!0,l.showCommBox(!1)):r?(a.uiref.errComm=
!0,l.showCommBox(!1)):d?(a.uiref.errTimeout=!0,l.showCommBox(!1)):c?(a.uiref=a.modal_db.LicenseError,a.tref=a.modal_db.LicenseError,a.uiref.resp_obj=e||{code:"code Not Found"},a.uiref.action_str="configure license"):alert("Unknown UI statue: "+b)};(function(){a.model.call_home=angular.copy(a.ctx.call_home);var l=app.modelhelper.web2dbFn({call_home:a.model.call_home});e.post({url:resource_base+"data/smart_license.json",method:"set_smart_license",params:l,procBackground:!0,success:function(e){b("saveOK");
a.env.success=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);b("saveFailed")}})})()}}},ProductRegistration:{template:"ProductRegistration.htm",funs:{cancel:l.cancel,init:function(){a.uiref.commCtx={show:!1,state:"ongoing",msg:"Registering product for Smart Licensing",success:"Registeration completed successfully"};this.register()},register:function(){l.showCommBox(!0);var b=function(b,d,c){!a.env.supportDB&&a.env.flag_tokenOK&&(b="regOK");d="regFailed"==
b;var k="errComm"==b,g="errTimeout"==b,z="LicenseError"==b;a.uiref.errToken=!1;a.uiref.errComm=!1;"regOK"==b?(l.setCommBoxAndClose("success",2E3,function(){l.cancel()}),a.env.supportDB?m.refreshModelData():l.register()):d?(l.showCommBox(!1),a.uiref=a.modal_db.ProductRegistrationFail,a.tref=a.modal_db.ProductRegistrationFail):k?(l.showCommBox(!1),a.uiref=a.modal_db.ProductRegistrationErrComm,a.tref=a.modal_db.ProductRegistrationErrComm):g?(l.showCommBox(!1),a.uiref=a.modal_db.ProductRegistrationTimeout,
a.tref=a.modal_db.ProductRegistrationTimeout):z?(a.uiref=a.modal_db.LicenseError,a.tref=a.modal_db.LicenseError,a.uiref.resp_obj=c||{code:"code Not Found"},a.uiref.action_str="finish registration"):alert("Unknown UI statue: "+b)},e=function(b,d,c){void 0===d&&(d=0);void 0===c&&(c="");a.env.timer_license_state_polling=w(function(){var k=s.defer();k.promise.then(function(g){angular.extend(a.model.license_state,g.license_state);b--;0<b&&e(b,d,c)});m.fetchModelResult(k)},5E3)},u=s.defer();u.promise.then(function(b){angular.extend(a.model.license_state,
b.license_state)});m.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",rpcname:"license-register",input:{token:a.model.license.token}},{error:function(a){Log(DEBUG,"Stage comm error");b("errComm")}}).then(function(a){m.ret_code_handler(a,{"0":function(a){x()},"default":function(a,c){console.log((c||"default:")+" ret_code_handler: Internal error code="+a);w(function(){m.fetchModelResult(u)},2E3);b("errComm")}},"license-register")});var x=function(a){a=a||0;var d=s.defer(),c=d.promise;
0==a?(Log(DEBUG,"registerdo retry(wait 20s), retryCount="+a),w(function(){Log(DEBUG,"registerdo retry(20s exceed), retryCount="+a);m.fetchModelResult(d)},2E4)):m.fetchModelResult(d);c.then(function(c){c=c.license_state.registration.status;switch(c){case "license-registration-inprogress":case "license-registration-retry-inprogress":case "license-registration-unregistrated":m.doRetry("register",a,20,x,function(){b("errTimeout")});break;case "license-registration-failed":Log(DEBUG,"registering Failed");
b("regFailed");break;case "license-registration-registrated":case "license-registration-registration-expired":Log(DEBUG,"regOK");w(function(){m.fetchModelResult(u);w(function(){m.gridRedraw();e(24)},1E3);b("regOK")},4E3);break;default:alert("Unknown status id: "+c),b("errComm")}w(function(){m.fetchModelResult(u);w(function(){m.gridRedraw()},1E3)},4E3)})}}}},ProductRegistrationFail:{template:"ProductRegistrationFail.htm",funs:{ok:function(){l.cancel()}}},ProductRegistrationErrComm:{template:"ProductRegistrationErrComm.htm",
funs:{ok:function(){l.cancel()}}},ProductRegistrationTimeout:{template:"ProductRegistrationTimeout.htm",funs:{ok:function(){l.cancel()}}},ProductDeregister:{template:"ProductDeregister.htm",funs:{cancel:l.cancel,init:function(){a.uiref.commCtx={show:!1,state:"ongoing",msg:"Deregistering product from Smart Software Licensing",success:"Deregisteration completed successfully"}},deregister:function(){l.showCommBox(!0);e.post({url:resource_base+"data/exec_smart_license_regOK.json",method:"action",params:{rpc:"license-deregister"},
procBackground:!0,success:function(a){},error:function(b){console.log("AJAX loading error: "+b.status+", URL: "+b.config.url);a.uiref=a.modal_db["ManualRemovalRequired-2"];a.tref=a.modal_db["ManualRemovalRequired-2"]}}).then(function(b){m.ret_code_handler(b,{"0":function(b){a.env.supportDB?m.refreshModelData():l.deregister();l.setCommBoxAndClose("success",2E3,function(){l.cancel()})},"default":function(b,e,h){console.log(e+" ret_code_handler: Default, unknown code="+b);a.uiref=a.modal_db.LicenseError;
a.tref=a.modal_db.LicenseError;a.uiref.resp_obj=h||{code:"code Not Found"};a.uiref.action_str="finish deregistration"}},"license-deregister")})}}},EnableLicense:{template:"MiniModalBoxOverride.htm",funs:{cancel:l.cancel,init:function(){a.uiref.commCtx={show:!1,state:"ongoing",msg:"Enabling Smart Software Licensing",success:"Enabling Smart Software Licensing complete"};l.showCommBox(!0);m.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",rpcname:"license-enable"},{success:function(b){m.ret_code_handler(b,
{"0":function(b){l.setCommBoxAndClose("success",1E3,function(){l.cancel()});a.env.supportDB?m.refreshModelData():l.enabledLic()},"default":function(b,e,h){console.log(e+" ret_code_handler: Default, unknown code="+b);a.uiref=a.modal_db.LicenseError;a.tref=a.modal_db.LicenseError;a.uiref.resp_obj=h||{code:"code Not Found"}}},"license-enable")},error:function(b){a.uiref=a.modal_db.EnableLicenseFailed;a.tref=a.modal_db.EnableLicenseFailed}})}}},DisableLicense:{template:"DisableLicense.htm",funs:{cancel:l.cancel,
init:function(){a.uiref.commCtx={show:!1,state:"ongoing",msg:"Deregistering product from Smart Software Licensing",success:"Smart Software Licensing disabled"}},disableLicense:function(){a.model.license_state.enable?(l.showCommBox(!0),m.doSyncRPC({url:resource_base+"data/exec_smart_license_regOK.json",rpcname:"license-disable"},{success:function(b){m.ret_code_handler(b,{"0":function(b){a.env.supportDB?m.refreshModelData():l.disabledLic();l.setCommBoxAndClose("success",2E3,function(){l.cancel()})},
"default":function(b,e){a.uiref=a.modal_db.ManualRemovalRequired;a.tref=a.modal_db.ManualRemovalRequired}},"license-disable")},error:function(b){console.log("AJAX loading error: "+b.status+", URL: "+b.config.url);a.uiref=a.modal_db.LicenseError;a.tref=a.modal_db.LicenseError}})):(a.env.supportDB?m.refreshModelData():l.disabledLic(),l.cancel())}}},RenewAuth:{template:"MiniModalBoxOverride.htm",funs:{init:function(){a.uiref.commCtx={show:!1,state:"ongoing",hideMiniBackdrop:!0,msg:"Renewing Smart Software Licensing Authorization",
success:"Authorization Renewal complete"};l.showCommBox(!0);a.UIEvents.runRenewAuth()}}},RenewReg:{template:"MiniModalBoxOverride.htm",funs:{init:function(){a.uiref.commCtx={show:!1,state:"ongoing",hideMiniBackdrop:!0,msg:"Renewing Smart Software Licensing Registration",success:"Registration Renewal complete"};l.showCommBox(!0);a.UIEvents.runRenewReg()}}},RenewRegAuth:{template:"MiniModalBoxOverride.htm",funs:{init:function(){var b=s.defer(),e=s.defer();b.resolve("p1_done");b.promise.then(function(){a.uiref.commCtx=
{show:!1,state:"ongoing",hideMiniBackdrop:!0,msg:"Renewing Smart Software Licensing Registration",success:"Registration Renewal complete"};l.showCommBox(!0);a.UIEvents.runRenewReg(function(){e.resolve("p2_done")})});e.promise.then(function(){a.uiref.commCtx={show:!1,state:"ongoing",hideMiniBackdrop:!0,msg:"Renewing Smart Software Licensing Authorization",success:"Authorization Renewal complete"};l.showCommBox(!0);a.UIEvents.runRenewAuth(function(){l.cancel()})})}}},EnableLicenseFailed:{template:"EnableLicenseFailed.htm",
funs:{ok:function(){l.cancel()}}},LicenseError:{template:"LicenseError.htm",funs:{ok:function(){l.cancel()}}},ManualRemovalRequired:{template:"ManualRemovalRequired.htm",funs:{ok:function(){a.env.supportDB?m.refreshModelData():l.disabledLic();l.cancel()}}},"ManualRemovalRequired-2":{template:"ManualRemovalRequired.htm",funs:{ok:function(){a.env.supportDB?m.refreshModelData():l.deregister();l.cancel()}}},RegistrationRenewalFailed:{template:"RegistrationRenewalFailed.htm",funs:{ok:function(){l.cancel()}}},
RegistrationRenewalTimeout:{template:"RegistrationRenewalTimeout.htm",funs:{ok:function(){l.cancel()}}},LicenseAuthorizationNoticeAuthOnPending:{template:"LicenseAuthorizationNoticeAuthOnPending.htm",funs:{init:function(){Log(DEBUG,"pend init");(function(){a.ctx=a.ctx||{};var b=a.ctx;b.countDownStop=!1;b.countDownSec=10;var e=function(){b.countDownStop||w(function(){1<b.countDownSec?(b.countDownSec-=1,e()):1>=b.countDownSec&&l.cancel()},1E3)};e()})()},countDownReset:function(){var b=a.ctx;b.countDownStop=
!1;b.countDownSec=5},ok:function(){l.cancel()}}},LicenseAuthorizationRenewalOK:{template:"LicenseAuthorizationRenewalOK.htm",funs:{ok:function(){l.cancel()}}},LicenseAuthorizationRenewalFailed:{template:"LicenseAuthorizationRenewalFailed.htm",funs:{ok:function(){l.cancel()}}},LicenseAuthorizationRenewalTimeout:{template:"LicenseAuthorizationRenewalTimeout.htm",funs:{ok:function(){l.cancel()}}},ChooseSmartLicenses:{template:"ChooseSmartLicenses.htm",funs:{cancel:l.cancel,isRegistered:l.isRegistered,
init:function(){a.features_copy=angular.copy(a.model.license.features);a.gridLicense.Options2.data=a.features_copy;a.uiref.commCtx={show:!1,state:"ongoing",msg:"Renewing Smart Software Licensing Authorization",success:"Authorization Renewal complete"}},save:function(){var b=function(){var b=angular.copy(a.features_copy);angular.forEach(b,function(a,b){for(var g in a)"name"==g||("enable"==g||"count"==g)||delete a[g]});b=app.modelhelper.web2dbFn({license:{features:b}});e.post({url:resource_base+"data/smart_license.json",
method:"set_smart_license",forcedUsingPost:!0,params:b,procBackground:!0,success:function(a){},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},p=function(){var d=angular.copy(a.model.license.features);a.model.license.features=angular.copy(a.features_copy);a.gridLicense.Options.data=a.model.license.features;angular.forEach(d,function(b,d){var g=!1;angular.forEach(a.model.license.features,function(a,d){b.name==a.name&&(g=!0,a.count=b.count)});!g&&itemB.count&&
(itemB.count=void 0)});b()},u=function(){a.state_features_copy=angular.copy(a.model.license_state.features);a.model.license.features=angular.copy(a.features_copy);a.gridLicense.Options.data=a.model.license.features;angular.forEach(a.model.license_state.features,function(b,c){angular.forEach(a.state_features_copy,function(a,c){b.name==a.name&&(b.status=a.status)})})},x=function(a){"renewOK"==a?w(function(){m.refreshModelData();m.gridRedraw();l.openModal("LicenseAuthorizationRenewalOK","",{closePrevDialog:"LicenseAuthorizationNoticeAuthOnPending"})},
2E3):"gridRedraw"==a?m.gridRedraw():"dialogClose"==a?(l.cancel(),m.openModal("LicenseAuthorizationNoticeAuthOnPending","")):"dialogAuthOnPending"!=a&&("errComm"==a?l.openModal("LicenseAuthorizationRenewalFailed",""):"errTimeout"==a?l.openModal("LicenseAuthorizationRenewalTimeout",""):alert("unknown UI state: "+a))},r=function(b){var c,k=[],g=[],z={success:[],fail:[]},y=function(a,c,y){var A=s.defer();c=A.promise;k.push(c);g.push(A);A.ctx={name:a.name};a.enable&&y&&"renewCount"==y.mode?(A.ctx.action=
"AuthRenewCount",m.doAuthRenewCount(a,b,A)):a.enable?(A.ctx.action="Request",m.doAuthorize(a,b,A)):a.enable||(A.ctx.action="Release",m.doDeauthorize(a,b,A));c.then(function(a){z.success.push({name:a,action:A.ctx.action})}).catch(function(a){z.fail.push({name:a,action:A.ctx.action})}).finally(function(){console.log(JSON.stringify(z))})};angular.forEach(a.features_copy,function(b,c){var g=!1,d=void 0;angular.forEach(a.model.license.features,function(a,c){a.name==b.name&&a.enable!==b.enable&&(g=!0);
a.name==b.name&&(a.count!==b.count&&!0==b.enable)&&(g=!0,d={mode:"renewCount"})});g?y(b,c,d):Log(DEBUG,"skip item:"+b.name)});var A=function(a){c||(c=!0,w(function(){console.log("Some of features update Timeout, detail as follows: "+JSON.stringify(z));b("errTimeout");m.refreshModelData()},50))};s.all(k).then(function(a){b("renewOK");c=!0},A);w(function(){c||(Log(DEBUG,"Hard Limit, time exceed"),angular.forEach(g,function(a,b){a.reject(a.ctx.name)}),A())},125E3)};a.env.supportDB?(r(x),p()):u();x("dialogClose")}}}};
a.uiref=a.modal_db[v];a.tref=a.modal_db[v]}]);app.controller("configManagementCtrl",["$scope","MyHttp","usb_lib","Upload","userAccessRight","$q","UserSession","$cookies","modelInfo","deviceTime","dt",function(a,b,s,n,v,t,m,q,e,w,l){a.success=!1;a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var h=function(){return b.post({url:resource_base+"data/config_state.json",method:"get_config_state",error:function(a){console.log("configManagementCtrl getConfigMgtData Error status: "+a.status)}})},p=function(b){b||
(b={});b=b["config-state"]||{};a.model.running_upt=l.genTimeStrByTimeStamp(b["running-update-time"],"N/A");a.model.startup_upt=l.genTimeStrByTimeStamp(b["startup-update-time"],"N/A");a.model.mirror_upt=l.genTimeStrByTimeStamp(b["mirror-update-time"],"N/A");a.model.backup_upt=l.genTimeStrByTimeStamp(b["backup-update-time"],"N/A")},u=function(b){b||(b={});a.model.usbs={};a.schema.srcOps=angular.copy(c);angular.forEach(b,function(b,c){b&&(a.model.usbs[c]=!0,a.schema.srcOps.push({id:c,displayName:"Upload File from "+
c}))})},x=function(){var c="FILE://"+a.model.source+"/";angular.forEach(a.model.usb_file_path,function(a){c=c+a+"/"});b.post({method:"action",params:{rpc:"file-list",input:{source:{"location-url":c}}},success:function(b){r(b&&b.data&&b.data.result||{});a.model.sel_usb_file=a.model.usb_file_list[0]&&a.model.usb_file_list[0].id||"";a.chk_usbfile();a.srcIsUsb=!0},error:function(a){r()}})},r=function(b){b||(b={});b=(b.output||{})["file-names"]||[];a.model.usb_file_list=[];a.model.usb_file_path.length&&
a.model.usb_file_list.push({id:"/BackKey",displayName:a.DICT("Config_Management_Up_One_Level"),isBack:!0});angular.forEach(b,function(b){b["file-name"]&&a.model.usb_file_list.push({id:b["file-name"],displayName:b["file-name"]+(b.directory?"/":""),isDirectroy:!0===b.directory})})},d=function(a,c,g){b.post({method:"action",popRPCResonsepAlert:!0,params:a,success:function(a){"function"===$.type(c)&&c(a);g&&y()},error:function(a){"function"===$.type(c)&&c(a);g&&y()}})},c=[{id:"config-running",displayName:a.DICT("Config_Management_Running_Configuration_N")},
{id:"config-startup",displayName:a.DICT("Config_Management_Startup_Configuration_N")},{id:"config-backup",displayName:a.DICT("Config_Management_Backup_Configuration_N")},{id:"config-mirror",displayName:a.DICT("Config_Management_Mirror_Configuration_N")},{id:"pc-upload",displayName:a.DICT("Config_Management_Upload_File_From_PC")}],k=[{id:"config-running",displayName:a.DICT("Config_Management_Running_Configuration_N")},{id:"config-startup",displayName:a.DICT("Config_Management_Startup_Configuration_N")},
{id:"config-backup",displayName:a.DICT("Config_Management_Backup_Configuration_N")}],g=function(){var b=!0,c,g=angular.copy(k);for(c=g.length-1;0<=c;c--)a.model.source===g[c].id&&g.splice(c,1);a.schema.destOps=g;switch(a.model.source){case "config-running":case "config-startup":case "config-backup":case "config-mirror":a.schema.destOps.push({id:"download_to_pc",displayName:a.DICT("Config_Management_Download_To_PC")});angular.forEach(a.model.usbs,function(b,c){a.schema.destOps.push({id:c,displayName:a.DICT("Config_Management_Save_To")+
c})});break;default:a.model.source.match(/(^pc-upload$|^USB\d+$)/)&&(a.schema.destOps=[{id:"config-running",displayName:a.DICT("Config_Management_Running_Configuration_N")}],a.model.destOps="config-running")}angular.forEach(a.schema.destOps,function(c){a.model.dest===c.id&&(b=!1)});b&&(a.model.dest=a.schema.destOps[0].id)},z=function(){a.dataReady=!1;t.all([h(),s.usbs_avaiable()]).then(function(b){a.model.save_icon_blinking="1"===q.get("blinking");p(b[0]&&b[0].data&&b[0].data.result||{});u(b[1]||
{});a.model.source=a.schema.srcOps[0].id;g();a.model.dest=a.schema.destOps[0].id;a.check_ops(!0);a.dataReady=!0})},y=function(){t.all([h(),s.usbs_avaiable()]).then(function(b){a.model.save_icon_blinking="1"===q.get("blinking");p(b[0]&&b[0].data&&b[0].data.result||{});u(b[1]||{})})};a.schema={srcOps:angular.copy(c),destOps:angular.copy(k),StatusMap:{"true":a.DICT("Config_Management_Enable"),"false":a.DICT("Config_Management_Disable")}};a.dataReady=!1;a.save_disable=!1;a.sel_file_is_invalid=!1;a.srcIsUsb=
!1;a.pcFile=void 0;a.displayRPCInfo=!1;a.rpcResult=!0;a.rpcStr="";a.file_format_note=a.DICT("Config_Management_File_Format",{"%s":5});a.model={running_upt:"",startup_upt:"",mirror_upt:"",backup_upt:"",usbs:[],usb_file_list:[],usb_file_path:[],source:"",dest:"",save_icon_blinking:!1,sel_usb_file:"",uploadId:void 0};a.check_ops=function(b){b&&(g(),a.srcIsUsb=!1,a.sel_file_is_invalid=!1,a.model.source.match(/^USB\d+$/)&&(a.model.usb_file_path=[],x()));a.displayRPCInfo=!1;a.save_disable=a.model.source===
a.model.dest||a.sel_file_is_invalid;"pc-upload"===a.model.source&&!a.pcFile&&(a.save_disable=!0);a.srcIsInvalid=!1;switch(a.model.source){case "config-running":"N/A"===a.model.running_upt&&(a.srcIsInvalid=!0);break;case "config-startup":"N/A"===a.model.startup_upt&&(a.srcIsInvalid=!0);break;case "config-backup":"N/A"===a.model.backup_upt&&(a.srcIsInvalid=!0);break;case "config-mirror":"N/A"===a.model.mirror_upt&&(a.srcIsInvalid=!0)}};a.pcFileInvalid=!1;a.resetFormatCheck=function(b){a.pcFileInvalid=
!1;"pc-upload"===a.model.source&&a.pcFileFormatCheck(a.pcfile);a.check_ops(!0)};a.pcFileFormatCheck=function(b){a.pcFileInvalid=!1;if(void 0!=b){a.pcfile=b;if("pc-upload"===a.model.source){if(5242880<parseInt(b.size,10)){a.pcFileInvalid=!0;return}if(!b.name.toLowerCase().match(/(\.xml){1}$/)){a.pcFileInvalid=!0;return}}a.pcFile=b;a.check_ops()}};a.sync_file_sel=function(b){a.pcFile=b;a.check_ops()};a.chk_usbfile=function(){a.sel_file_is_invalid=!1;a.model.sel_usb_file||(a.sel_file_is_invalid=!0);
angular.forEach(a.model.usb_file_list,function(b){a.model.sel_usb_file===b.id&&(b.isDirectroy&&(a.sel_file_is_invalid=!0),b.isBack&&(a.sel_file_is_invalid=!0))});a.check_ops()};a.click_usbfile=function(){var b={};angular.forEach(a.model.usb_file_list,function(c){a.model.sel_usb_file===c.id&&(b=c)});b.isBack?(a.model.usb_file_path.splice(a.model.usb_file_path.length-1,1),x()):(Log(DEBUG,"---"+JSON.stringify(b)),b.isDirectroy&&(a.model.usb_file_path.push(b.id),x()))};a.funs={save:function(){var c=a.model.source,
g=a.model.dest,y="file-copy",z={fileType:"configuration"},k=function(a){a=a.data&&a.data.result&&a.data.result.output||{};switch(void 0!==a.code?a.code:void 0){case 0:("config-running"===c&&"config-startup"===g||"config-startup"===c&&"config-running"===g)&&app.TOOLS.get_scope("headerCtrl").disable_save_warning()}};switch(c){case "config-running":case "config-startup":case "config-backup":case "config-mirror":switch(g){case "config-running":case "config-startup":case "config-backup":y="file-copy";
angular.extend(z,{source:{"config-type":c},destination:{"config-type":g}});d({rpc:y,input:z},k,!0);return;case "download_to_pc":var h,y="file-download";angular.extend(z,{"config-type":c});b.post({method:"action",params:{rpc:y,input:z},success:function(b){var c=b&&b.data&&b.data.result||{};b=c.output&&c.output.errstr||"";var g=c.output&&c.output["download-url"]||"";0===(c.output&&void 0!==c.output.code?c.output.code:void 0)&&g?(b||(b=a.DICT("Config_Management_Configure_Download_Success")),h=g.split("/"),
c=h[h.length-1],app.TOOLS.download_save_to(g,c,"text/xml"),app.TOOLS.successAlertBox({title:a.DICT("Information"),msg:b,cbk:function(){}})):(b||(b=a.DICT("Config_Management_Configure_Has_Error")),app.TOOLS.criticalAlertBox({titile:a.DICT("Alert"),msg:b,cbk:function(){}}))},error:function(a){console.log("Error for file download status: "+a.status)}});break;default:w.get_time(function(a){a=(e.get_pid()||"nullFileName")+"_configuration_"+a+".xml";y="file-copy";angular.extend(z,{source:{"config-type":c},
destination:{"location-url":"FILE://"+g+"/"+a}});d({rpc:y,input:z},k)})}break;case "pc-upload":a.model.errconfig=!1;a.model.validconfig=!1;y="file-upload";app.transition.In();a.model.uploadId=n.upload({url:resource_base+"upload",headers:{"optional-header":"header-value"},data:{sessionid:q.get("sessionid"),pathparam:"Configuration",fileparam:"Configuration",file:a.pcFile}}).then(function(a){y="file-copy";angular.extend(z,{source:{"location-url":"FILE://Configuration/Configuration"},destination:{"config-type":g}});
d({rpc:y,input:z},void 0,!0);app.transition.Out()},function(b){app.transition.Out();app.TOOLS.criticalAlertBox({title:a.DICT("Alert"),msg:a.DICT("Config_Management_Upload_Failure"),cbk:function(){}});Log(DEBUG,"err for upload "+b.status)});break;default:if(c.match(/^USB\d+$/)){a.model.errconfig=!1;a.model.validconfig=!1;var r="FILE://"+c+"/",y="file-copy";angular.forEach(a.model.usb_file_path,function(a){r=r+a+"/"});r+=a.model.sel_usb_file;angular.extend(z,{source:{"location-url":r},destination:{"config-type":g}});
d({rpc:y,input:z},void 0,!0)}else console.log("Error source "+c)}},cancel:function(){z()},blinking:function(){a.model.save_icon_blinking=!0===a.model.save_icon_blinking?!1:!0;(function(){b.post({url:resource_base+"data/config_management.json",method:"set_gui",params:{gui:{"save-icon-blinking":a.model.save_icon_blinking}},success:function(b){a.success=!0;!1===a.model.save_icon_blinking?q.put("blinking","0"):q.put("blinking","1");app.TOOLS.get_scope("headerCtrl").check_save_blinking()},error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}})})()}};z()}]);var app_cert_data={counrtylist:[{id:"AD",displayName:"Andorra"},{id:"AE",displayName:"United Arab Emirates"},{id:"AF",displayName:"Afghanistan"},{id:"AG",displayName:"Antiqua And Barb"},{id:"AI",displayName:"Anguilla"},{id:"AL",displayName:"Albania"},{id:"AM",displayName:"Armenia"},{id:"AN",displayName:"Netherlands Antilles"},{id:"AO",displayName:"Angola"},{id:"AQ",displayName:"Antarctica"},{id:"AR",displayName:"Argentina"},{id:"AS",displayName:"American Samoa"},{id:"AT",displayName:"Austria"},{id:"AU",
displayName:"Australia"},{id:"AW",displayName:"Aruba"},{id:"AZ",displayName:"Azerbaijan"},{id:"BA",displayName:"Bosnia and Herzegovina"},{id:"BB",displayName:"Barbados"},{id:"BD",displayName:"Bangladesh"},{id:"BE",displayName:"Belgium"},{id:"BF",displayName:"Burkina Faso"},{id:"BG",displayName:"Bulgaria"},{id:"BH",displayName:"Bahrain"},{id:"BI",displayName:"Burundi"},{id:"BJ",displayName:"Benin"},{id:"BM",displayName:"Bermuda"},{id:"BN",displayName:"Brunei Darussalam"},{id:"BO",displayName:"Bolivia"},
{id:"BR",displayName:"Brazil"},{id:"BS",displayName:"Bahamas"},{id:"BT",displayName:"Bhutan"},{id:"BV",displayName:"Bouvet Islands"},{id:"BW",displayName:"Botswana"},{id:"BZ",displayName:"Belize"},{id:"CA",displayName:"Canada"},{id:"CC",displayName:"Cocos (Keeling) Islands"},{id:"CF",displayName:"Central African Republic"},{id:"CH",displayName:"Switzerland"},{id:"CI",displayName:"Cote D'Ivoire (Ivory Coast)"},{id:"CK",displayName:"Cook Islands"},{id:"CL",displayName:"Chile"},{id:"CM",displayName:"Cameroon"},
{id:"CN",displayName:"China"},{id:"CO",displayName:"Colombia"},{id:"CR",displayName:"Costa Rica"},{id:"CU",displayName:"Cuba"},{id:"CV",displayName:"Cape Verde"},{id:"CX",displayName:"Chrismas Island"},{id:"CY",displayName:"Cyprus"},{id:"CZ",displayName:"Czech Republic"},{id:"DE",displayName:"Germany"},{id:"DE",displayName:"Djibouti"},{id:"DK",displayName:"Denmark"},{id:"DM",displayName:"Dominica"},{id:"DO",displayName:"Dominican Republic"},{id:"DZ",displayName:"Algeria"},{id:"EC",displayName:"Ecuador"},
{id:"EE",displayName:"Estonia"},{id:"EG",displayName:"Egypt"},{id:"EH",displayName:"Western Sahara"},{id:"ER",displayName:"Eritrea"},{id:"ES",displayName:"Spain"},{id:"ET",displayName:"Ethiopia"},{id:"FI",displayName:"Finland"},{id:"FJ",displayName:"Fiji"},{id:"FK",displayName:"Falkland Islands (Malvinas)"},{id:"FM",displayName:"Micronesia"},{id:"FO",displayName:"Faroe Islands"},{id:"FR",displayName:"France"},{id:"FX",displayName:"France, Metropolitan"},{id:"GA",displayName:"Gabon"},{id:"GB",displayName:"Great Britain (UK)"},
{id:"GD",displayName:"Grenada"},{id:"GE",displayName:"Georgia"},{id:"GF",displayName:"French Guiana"},{id:"GG",displayName:"Guernsey"},{id:"GH",displayName:"Ghana"},{id:"GI",displayName:"Gibraltar"},{id:"GL",displayName:"Greenland"},{id:"GM",displayName:"Gambia"},{id:"GN",displayName:"Guinea"},{id:"GP",displayName:"Guadeloupe"},{id:"GQ",displayName:"Equatorial Guinea"},{id:"GR",displayName:"Greece"},{id:"GS",displayName:"S. Georgia and S. Sandwich Isls."},{id:"GT",displayName:"Guatemala"},{id:"GU",
displayName:"Guam"},{id:"GW",displayName:"Guinea-Bissau"},{id:"GY",displayName:"Guyana"},{id:"HK",displayName:"Hong Kong"},{id:"HM",displayName:"Heard and McDonald Islands"},{id:"HN",displayName:"Honduras"},{id:"HR",displayName:"Croatia (Hrvatska)"},{id:"HT",displayName:"Haiti"},{id:"HU",displayName:"Hungary"},{id:"ID",displayName:"Indonesia"},{id:"IE",displayName:"Ireland"},{id:"IL",displayName:"Israel"},{id:"IM",displayName:"Isle of Man"},{id:"IN",displayName:"India"},{id:"IO",displayName:"British Indian Ocean Territory"},
{id:"IS",displayName:"Iceland"},{id:"IT",displayName:"Italy"},{id:"JE",displayName:"Jersey"},{id:"JM",displayName:"Jamaica"},{id:"JM",displayName:"Jordan"},{id:"JP",displayName:"Japan"},{id:"KE",displayName:"Kenya"},{id:"KG",displayName:"Kyrgyzstan"},{id:"KG",displayName:"Cambodia"},{id:"KI",displayName:"Kiribati"},{id:"KM",displayName:"Comoros"},{id:"KN",displayName:"Saint Kitts and Nevis"},{id:"KR",displayName:"Korea (South)"},{id:"KW",displayName:"Kuwait"},{id:"KY",displayName:"Cayman Islands"},
{id:"KZ",displayName:"Kazakhstan"},{id:"LA",displayName:"Laos"},{id:"LB",displayName:"Lebanon"},{id:"LC",displayName:"Saint Lucia"},{id:"LI",displayName:"Liechtenstein"},{id:"LK",displayName:"Sri Lanka"},{id:"LS",displayName:"Lesotho"},{id:"LT",displayName:"Lithuania"},{id:"LU",displayName:"Luxembourg"},{id:"LV",displayName:"Latvia"},{id:"LY",displayName:"Libya"},{id:"MA",displayName:"Morocco"},{id:"MC",displayName:"Monaco"},{id:"MD",displayName:"Moldova"},{id:"ME",displayName:"Montenegro"},{id:"MG",
displayName:"Madagascar"},{id:"MH",displayName:"Marshall Islands"},{id:"MK",displayName:"Macedonia"},{id:"ML",displayName:"Mali"},{id:"MM",displayName:"Myanmar"},{id:"MN",displayName:"Mongolia"},{id:"MO",displayName:"Macau"},{id:"MP",displayName:"Northern Mariana Islands"},{id:"MQ",displayName:"Martinique"},{id:"MR",displayName:"Mauritania"},{id:"MS",displayName:"Montserrat"},{id:"MT",displayName:"Malta"},{id:"MU",displayName:"Mauritius"},{id:"MV",displayName:"Maldives"},{id:"MW",displayName:"Malawi"},
{id:"MX",displayName:"Mexico"},{id:"MY",displayName:"Malaysia"},{id:"MZ",displayName:"Mozambique"},{id:"NA",displayName:"Namibia"},{id:"NC",displayName:"New Caledonia"},{id:"NE",displayName:"Niger"},{id:"NF",displayName:"Norfolk Island"},{id:"NG",displayName:"Nigeria"},{id:"NI",displayName:"Nicaragua"},{id:"NL",displayName:"Netherlands"},{id:"NO",displayName:"Norway"},{id:"NP",displayName:"Nepal"},{id:"NR",displayName:"Nauru"},{id:"NT",displayName:"Neutral Zone"},{id:"NU",displayName:"Niue"},{id:"NZ",
displayName:"New Zealand (Aotearoa)"},{id:"OM",displayName:"Oman"},{id:"PA",displayName:"Panama"},{id:"PE",displayName:"Peru"},{id:"PF",displayName:"French Polynesia"},{id:"PG",displayName:"Papua New Guinea"},{id:"PH",displayName:"Philippines"},{id:"PK",displayName:"Pakistan"},{id:"PL",displayName:"Poland"},{id:"PM",displayName:"St. Pierre and Miquelon"},{id:"PN",displayName:"Pitcairn"},{id:"PR",displayName:"Puerto Rico"},{id:"PT",displayName:"Portugal"},{id:"PW",displayName:"Palau"},{id:"PY",displayName:"Paraguay"},
{id:"QA",displayName:"Qatar"},{id:"RE",displayName:"Reunion"},{id:"RO",displayName:"Romania"},{id:"RS",displayName:"Serbia"},{id:"RU",displayName:"Russian Federation"},{id:"RW",displayName:"Rwanda"},{id:"SA",displayName:"Saudi Arabia"},{id:"SB",displayName:"Solomon Islands"},{id:"SC",displayName:"Seychelles"},{id:"SD",displayName:"Sudan"},{id:"SE",displayName:"Sweden"},{id:"SG",displayName:"Singapore"},{id:"SH",displayName:"St. Helena"},{id:"SI",displayName:"Slovenia"},{id:"SJ",displayName:"Svalbard and Jan Mayen Islands"},
{id:"SK",displayName:"Slovak Republic"},{id:"SL",displayName:"Sierra Leone"},{id:"SM",displayName:"San Marino"},{id:"SN",displayName:"Senegal"},{id:"SR",displayName:"Suriname"},{id:"ST",displayName:"Sao Tome and Principe"},{id:"SV",displayName:"El Salvador"},{id:"SY",displayName:"Syria"},{id:"SZ",displayName:"Swaziland"},{id:"TC",displayName:"Turks And Caicos Island"},{id:"TD",displayName:"Chad"},{id:"TF",displayName:"French Southern Territories"},{id:"TG",displayName:"Togo"},{id:"TH",displayName:"Thailand"},
{id:"TJ",displayName:"Tajikistan"},{id:"TK",displayName:"Tokelau"},{id:"TM",displayName:"Turkmenistan"},{id:"TN",displayName:"Tunisia"},{id:"TO",displayName:"Tonga"},{id:"TP",displayName:"East Timor"},{id:"TR",displayName:"Turkey"},{id:"TT",displayName:"Trinidad and Tobago"},{id:"TV",displayName:"Tuvalu"},{id:"TW",displayName:"Taiwan"},{id:"TZ",displayName:"Tanzania"},{id:"UA",displayName:"Ukraine"},{id:"UG",displayName:"Uganda"},{id:"UM",displayName:"US Minor Outlying Islands"},{id:"US",displayName:"United States"},
{id:"UY",displayName:"Uruguay"},{id:"UZ",displayName:"Uzbekistan"},{id:"VA",displayName:"Vatican City State (Holy See)"},{id:"VC",displayName:"Saint Vincent and the Grenadines"},{id:"VE",displayName:"Venezuela"},{id:"VG",displayName:"Virgin Islands (British)"},{id:"VI",displayName:"Virgin Islands (U.S.)"},{id:"VN",displayName:"Viet Nam"},{id:"VU",displayName:"Vanuatu"},{id:"WF",displayName:"Wallis and Futura Islands"},{id:"WS",displayName:"Samoa"},{id:"YE",displayName:"Yemen"},{id:"YT",displayName:"Mayotte"},
{id:"ZA",displayName:"South Africa"},{id:"ZM",displayName:"Zambia"}]};app.controller("diagnostic_main",["$scope","$q","MyHttp","$templateCache","UserSession","usb_lib","$uibModal","userAccessRight","Sets","rpcFns","$timeout","modificationWarning","$cookies",function(a,b,s,n,v,t,m,q,e,w,l,h,p){a.model=a.model||{};a.usbs_avaiable=void 0;a.success=!1;a.loadReady=!1;a.animationsEnabled=!0;a.forcedUsingPost=!1;var u={procBackground:!0,forcedUsingPost:a.forcedUsingPost},x={procBackground:!1,forcedUsingPost:a.forcedUsingPost};a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&
"RO"!==a.userAccessFlag&&v.logout();var r=function(){a.loadReady=!1;a.rpc_ping={active_id:0,err_str:"",dest_ip:"",src:"auto",size:32,echo_count:4};a.rpc_traceroute={active_id:0,err_str:"",max_ttl:30,target:""};a.rpc_dnslookup={active_id:0,err_str:"",target:""};a.rpc_export_to_pc={};a.rpc_export_to_usb={dest:""};a.rpc_email_to={email:""};a.rpc_usb_state={usbDevList:[]};p.remove("ping_focused_id");p.remove("traceroute_focused_id");p.remove("dnslookup_focused_id");b.all({}).then(function(b){a.model=
{};a.schema={};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.loadReady=!0})["catch"](function(a){Log(DEBUG,"=="+a)})},d=function(b,c){c=c||0;var z=function(){l(function(){var y=parseInt(p.get("ping_focused_id")||0);b===a.rpc_ping.active_id&&b===y&&(20>c?d(b,c):Log(DEBUG,"------------------------------------------------------------\r\n(No more response text, retry count: "+c+" times, aborted)"))},2E3)};a.rpc_ping.errstr=
"";return w.RPC_generic_send("utility_ping_status",{},function(b,d,k){k&&(b=k.code,0===b||"0"===b?(k.text?(c=0,a.rpc_ping.console_text=k.text):c++,!1===k.is_final?z():p.remove("ping_focused_id")):(Log(DEBUG,"Error: utility_ping_status, RPC = "+JSON.stringify(k)),a.rpc_ping.errstr=k.errstr))},function(b){a.rpc_ping.errstr="RPC utility_ping_status request failed"},u)};a.RPC_ping_start=function(){var b=a.rpc_ping,b={echo_count:b.echo_count,size:b.size,"interface":"auto"!==b.src?b.src:void 0,target:a.model.ping_traceroute_target};
a.rpc_ping.console_text="";a.rpc_ping.active_id+=1;a.rpc_ping.errstr="";p.put("ping_focused_id",a.rpc_ping.active_id);a.rpc_traceroute.console_text=void 0;a.rpc_traceroute.errstr="";a.rpc_traceroute.active_id+=1;return w.RPC_generic_send("utility_ping_start",b,function(b,c,y){if(y)if(b=y.code,0===b||"0"===b){var k=a.rpc_ping.active_id;l(function(){d(k)},1E3)}else Log(ERROR,"Error: utility_ping_start, RPC = "+JSON.stringify(y)),a.rpc_ping.console_text=y.errstr,a.rpc_ping.errstr=y.errstr},function(b){a.rpc_ping.errstr=
"RPC utility_ping_start request failed"},u)};a.RPC_ping_stop=function(){a.rpc_ping.active_id+=1;a.rpc_ping.errstr="";p.remove("ping_focused_id");return w.RPC_generic_send("utility_ping_stop",{},function(b,c,d){d&&(b=d.code,0===b||"0"===b||(Log(DEBUG,"Error: utility_ping_stop, RPC = "+JSON.stringify(d)),a.rpc_ping.errstr=d.errstr))},function(b){a.rpc_ping.errstr="RPC utility_ping_stop request failed"},u)};var c=function(b,g){g=g||0;var d=function(){l(function(){var d=parseInt(p.get("traceroute_focused_id")||
0);b===a.rpc_traceroute.active_id&&b===d&&(20>g?c(b,g):Log(DEBUG,"------------------------------------------------------------\r\n(No more response text, retry count: "+g+" times, aborted)"))},2E3)};a.rpc_traceroute.errstr="";return w.RPC_generic_send("utility_traceroute_status",{},function(b,c,k){k&&(b=k.code,0===b||"0"===b?(k.text?(g=0,a.rpc_traceroute.console_text=k.text):g++,!1===k.is_final?d():p.remove("traceroute_focused_id")):(Log(DEBUG,"Error: utility_traceroute_status, RPC = "+JSON.stringify(k)),
a.rpc_traceroute.errstr=k.errstr))},function(b){a.rpc_traceroute.errstr="RPC utility_traceroute_status request failed"},u)};a.RPC_traceroute_start=function(){var b=a.rpc_traceroute,b={target:a.model.ping_traceroute_target,initial_ttl:b.initial_ttl,max_ttl:b.max_ttl};a.rpc_traceroute.console_text="";a.rpc_traceroute.active_id+=1;a.rpc_traceroute.errstr="";p.put("traceroute_focused_id",a.rpc_traceroute.active_id);a.rpc_ping.console_text=void 0;a.rpc_ping.errstr="";a.rpc_ping.active_id+=1;return w.RPC_generic_send("utility_traceroute_start",
b,function(b,d,y){if(y)if(b=y.code,0===b||"0"===b){var k=a.rpc_traceroute.active_id;l(function(){c(k)},1E3)}else Log(DEBUG,"Error: utility_traceroute_start, RPC = "+JSON.stringify(y)),a.rpc_traceroute.errstr=y.errstr},function(b){a.rpc_traceroute.errstr="RPC utility_traceroute_start request failed"},u)};a.RPC_traceroute_stop=function(){a.rpc_traceroute.active_id+=1;a.rpc_traceroute.errstr="";p.remove("traceroute_focused_id");return w.RPC_generic_send("utility_traceroute_stop",{},function(b,c,d){d&&
(b=d.code,0===b||"0"===b||(Log(DEBUG,"Error: utility_traceroute_stop, RPC = "+JSON.stringify(d)),a.rpc_traceroute.errstr=d.errstr))},function(b){a.rpc_traceroute.errstr="RPC utility_traceroute_stop request failed"},u)};a.RPC_dnslookup_start=function(){var b={target:a.model.lookup_target};a.rpc_dnslookup.console_text="";a.rpc_dnslookup.active_id+=1;a.rpc_dnslookup.errstr="";p.put("dnslookup_focused_id",a.rpc_dnslookup.active_id);return w.RPC_generic_send("utility-dnslookup",b,function(b,c,d){c=(b.data.result||
{}).output||{};if(-1===c.code)a.rpc_dnslookup.console_text=c.errstr;else if(b=c.responses,c="Server:"+c.server+"\nAddress: "+c.target+"\n\n",b){for(d=0;d<b.length;d++)c+="Name:  "+b[d].name+"\nAddress: "+b[d].value+"\n";a.rpc_dnslookup.console_text=c}},function(b){a.rpc_dnslookup.errstr="RPC utility_dnslookup_start request failed"},{procBackground:!0,forcedUsingPost:a.forcedUsingPost})};a.RPC_dnslookup_stop=function(){a.rpc_dnslookup.active_id+=1;a.rpc_dnslookup.errstr="";p.remove("dnslookup_focused_id");
return w.RPC_generic_send("utility_dnslookup_stop",{},function(b,c,d){d&&(b=d.code,0===b||"0"===b||(Log(DEBUG,"Error: utility_dnslookup_stop, RPC = "+JSON.stringify(d)),a.rpc_dnslookup.errstr=d.errstr))},function(b){a.rpc_dnslookup.errstr="RPC utility_dnslookup_stop request failed"},u)};a.RPC_export_to_pc=function(){var b=0,c=function(y){if(y){var A=y.split("/");app.TOOLS.download_save_to2(y,A[A.length-1],"application/octet-stream").then(function(a){},function(A){2<=b?d(a.DICT("Diagnostic_Download_File_Failure_By_Retry")):
l(function(){b++;c(y)},1E3)})}else d($scon.DICT("Diagnostic_Download_Url_Is_Unknow"))},d=function(a){app.TOOLS.criticalAlertBox({msg:a,cbk:function(a){}})};w.RPC_generic_send("file-download",{fileType:"tech-report"},function(b,k,B){b=B.code;var e=B.errstr;switch(b){case 0:var h=B["download-url"]||void 0;l(function(){c(h)},1E3);break;default:e||(e=a.DICT("Diagnostic_Download_Failure")),d(e),Log(DEBUG,k+": RPC done. got unknown code: "+b+" errstr= "+e)}},function(b){a.rpc_export_to_pc.errstr="RPC export_to_pc request failed"},
x)};a.RPC_check_USB_attached=function(){var b=a.rpc_usb_state;return w.RPC_generic_send("usb-check-attached",void 0,function(c,d,y){c=y.usbs||[];b.usbDevList=[];for(d=0;d<c.length;d++)y=c[d],!0===y.attached&&b.usbDevList.push(y.name);a.rpc_export_to_usb.dest=b.usbDevList[0]},void 0,x)};a.RPC_export_to_usb=function(){w.RPC_generic_send("file-copy",{fileType:"tech-report",destination:{"location-url":"FILE://"+a.rpc_export_to_usb.dest+"/"+a.rpc_export_to_usb.filename}},function(b,c,d){if(d){b=d.code;
c=d.errstr;var y="";0===b||"0"===b?(a.console_text="Success",y=a.DICT("Diagnostic_Export_Technical_Support_Report_Success"),app.TOOLS.successAlertBox({msg:y,cbk:function(a){}})):(c||(c=a.DICT("Diagnostic_Export_To_Usb_Failure")),app.TOOLS.criticalAlertBox({msg:c,cbk:function(a){}}),Log(DEBUG,"Error: export_to_usb, RPC = "+JSON.stringify(d)),a.rpc_export_to_usb.errstr=d.errstr)}},function(b){a.rpc_export_to_usb.errstr="RPC export_to_usb request failed"},x)};a.report_to_usb=function(){var c=function(){m.open({animation:a.animationsEnabled,
templateUrl:"tech_report_export_to_usb.html",controller:"report_to_usb_ctrl",size:"sm",resolve:{usbs_avaiable:function(){return a.usbs_avaiable},usb_name:function(){return""}}}).result.then(function(b){var c=function(a){return 10>parseInt(a,10)?"0"+a:a.toString()},d=new Date;d.getYear();c(d.getMonth()+1);c(d.getDate());c(d.getHours());c(d.getMinutes());c(d.getSeconds());a.rpc_export_to_usb.dest=b;a.rpc_export_to_usb.filename="";a.RPC_export_to_usb()},function(){Log(DEBUG,"do nothing")})};b.all([t.usbs_avaiable()]).then(function(b){a.usbs_avaiable=
b[0];c()})};a.RPC_email_to=function(){w.RPC_generic_send("file-copy",{fileType:"tech-report",destination:{"location-url":a.rpc_email_to.email}},function(b,c,d){d&&(b=d.code,c="",0===b||"0"===b?(a.console_text="Success",c=a.DICT("Diagnostic_Mail_Sended"),app.TOOLS.successAlertBox({msg:c,cbk:function(a){}})):(Log(ERROR,"Error: email_to, RPC = "+JSON.stringify(d)),a.rpc_email_to.errstr=d.errstr,c="Abnormal:"+d.errstr))},function(b){a.rpc_email_to.errstr="RPC email_to request failed"},x)};a.report_to_email=
function(){(function(){m.open({animation:a.animationsEnabled,templateUrl:"tech_report_export_to_email.html",controller:"report_to_email_ctrl",size:"",resolve:{}}).result.then(function(b){a.rpc_email_to.email=b.email;a.RPC_email_to()},function(){Log(DEBUG,"do nothing")})})()};a.export_toggle=function(b){a[b]=!a[b];"fg_email_to"===b?a.fg_export_usb=!1:("fg_export_usb"!==b&&(a.fg_export_usb=!1),a.fg_email_to=!1);a.console_text=""};a.cancel=function(){r();a.resetModified()};r()}]);
app.controller("report_to_usb_ctrl",["$scope","$uibModalInstance","usbs_avaiable",function(a,b,s,n){a.usbs_avaiable=s;a.usb_name=n;a.save=function(){b.close(a.usb_name)};a.cancel=function(){b.dismiss()}}]);app.controller("report_to_email_ctrl",["$scope","$uibModalInstance",function(a,b){a.param={email:""};a.save=function(){b.close(a.param)};a.cancel=function(){b.dismiss()}}]);app.controller("rebootCtrl",["$scope","MyHttp","$uibModal","$timeout","UserSession","userAccessRight","factory_to_default","$cookies",function(a,b,s,n,v,t,m,q){q=app.TOOLS.get_scope("headerCtrl");a.msg="";a.config_modified=!1;q&&(q.warnings&&q.warnings.save.enable)&&(a.config_modified=!0);var e=["1.0.00","1.0.01"];a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var w=function(){b.post({url:resource_base+"data/automatic_updates.json",method:"get_image",success:function(a){a.data&&
a.data.result?l(a.data.result):l()},error:function(a){Log(ERROR,"rebootCtrl getFirmwareData error: "+a.status);l()}})},l=function(b){b||(b={});var e=[];b=b["image-state"]&&b["image-state"].firmware||{};b.images&&b.images.image&&(e=b.images.image);a.model.images=[];a.sel_image="";a.orig_sel_image="";e.length?angular.forEach(e,function(b,d){"active"===b.active?(a.sel_image=b.name,a.model.images.push({id:b.name,active:!0,version:b.version||"",displayName:a.DICT("Reboot_Active_Image")+" - "+b.version})):
a.model.images.push({id:b.name,version:b.version||"",active:!1,displayName:a.DICT("Reboot_Inactive_Image")+" - "+b.version})}):(a.model.images.push({id:"@noListFirmware",version:"",active:!0,displayName:a.DICT("Reboot_Active_Image")}),a.sel_image=a.model.images[0].id);!a.sel_image&&a.model.images.length&&(a.sel_image=a.model.images[0].id);a.orig_sel_image=a.sel_image};a.reboot_opt="none";a.sel_image="";a.model={images:[]};a.ctx=a.ctx||{};a.funs={rebootConfirm:function(b){var h=!1;angular.forEach(a.model.images,
function(b){b.id===a.sel_image&&angular.forEach(e,function(a){b.version.match(a)&&(h=!0)})});if(h)a.msg=a.DICT("Reboot_Downgraded_Note");else switch(a.reboot_opt){case "none":a.msg=a.config_modified?a.DICT("Reboot_Reboot_With_Modified_Configure_Note"):a.DICT("Reboot_Reboot_Note");break;case "factory-default-config":a.msg=a.DICT("Reboot_Reboot_Factory_To_Default_Note");break;case "factory-default-config-certificate":a.msg=a.DICT("Reboot_Reboot_Factory_To_Default_Certificate_Note");break;default:return}app.TOOLS.warningAlertBox({msg:a.msg,
cbk:function(b){b&&a.funs.reboot()}})},tryIsDeviceReady:function(e){e=e||0;var l=document.location;a.ctx.reboot.newHost=l.protocol+"//"+l.host+"/";b.post({url:a.ctx.reboot.newHost+"login.html",procBackground:!0,error:function(a){Log(DEBUG,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(a){e+=1;Log(DEBUG,"get login resp. (successCount="+e+")")})["catch"](function(a){e=0;Log(DEBUG,"get login data failed, retry")});3>e?n(function(){a.funs.tryIsDeviceReady(e)},5E3):(h(),p(),v.logout())},
reboot:function(e){var h=function(b,c,k){switch(b){case 0:switch(a.reboot_opt){case "factory-default-config":case "factory-default-config-certificate":m.reset()}Log(DEBUG,"Device rebooting, try url loading..(3000)");a.ctx.reboot=a.ctx.reboot||{};a.openWaitRebootModal();n(function(){a.ctx.reboot.userControlPanel=!0;a.funs.tryIsDeviceReady()},3E3);break;default:Log(DEBUG,"Upgradeing process return failed")}},r=function(){var d="active";"@noListFirmware"!==a.sel_image&&angular.forEach(a.model.images,
function(b){a.sel_image===b.id&&(d=b.active?"active":"inactive")});b.post({method:"action",params:{rpc:"system-reboot",input:{"firmware-state":d,option:a.reboot_opt}},procBackground:!0,success:function(a){if(a.data&&a.data.result&&a.data.result.output){a=a.data.result.output;Log(DEBUG,a);var b=a.code;(0===b||"0"===b)&&h(b,"rebooting",a.errstr)}},error:function(a){Log(ERROR,"Reboot request failed");w()}})};e?b.post({method:"action",forcedUsingPost:!0,params:{rpc:"file-copy",input:{fileType:"configuration",
source:{"config-type":"config-running"},destination:{"config-type":"config-startup"}}},success:function(a){r()},error:function(b){app.TOOLS.warningAlertBox({msg:a.DICT("Reboot_Save_Configure_Failure"),cbk:function(a){a&&r()}})}}):r()}};a.waitRebootTimer=void 0;a.waitRebootModalInstance=void 0;a.openWaitRebootModal=function(){a.waitRebootModalInstance=s.open({animation:a.animationsEnabled,templateUrl:"wait_reboot_modal.htm",controller:"waitRebootCtrl",size:"600-radius-20",backdrop:"static"});a.waitRebootModalInstance.result.then(function(){a.waitRebootModalInstance=
void 0},function(b){a.waitRebootModalInstance=void 0});h();a.waitRebootTimer=setTimeout(function(){p()},3E5)};var h=function(){void 0!==a.waitRebootTimer&&(clearTimeout(a.waitRebootTimer),a.waitRebootTimer=void 0)},p=function(){a.waitRebootModalInstance&&(a.waitRebootModalInstance.close(),a.waitRebootTimer=void 0)};w()}]);app.service("certService",["$rootScope","Sets","dt",function(a,b,s){var n=a.DICT,v=function(a){a=a||{};var b=[],e="",e=function(a,e){angular.isDefined(e)&&b.push(a+"="+e)};e("C",a.country);e("ST",a["state-province"]);e("L",a.locality);e("O",a.organization);e("OU",a["organization-unit"]);e("CN",a["common-name"]);e("E",a.email);return e=b.join(", ")},t=function(a,b){var e="",e=v(a),w=v(b);return e=!b||!b["common-name"]||"-"===b["common-name"]?"-":e===w?n("Certificate_Self_Signed"):angular.isDefined(b["common-name"])?
b["common-name"]:"-"};this.combind_DN=v;this.genSignedbyStr=t;this.genCertType=function(){return{local:n("Certificate_Local_Certificate"),"ca-certification":n("Certificate_CA_Certificate"),"certification-sign-request":n("Certificate_Certificate_Signing_Request"),ambiguous:n("Certificate_Type_Is_Ambiguous")}};this.prepareCertCtx=function(a){if(a.info&&a.info.duration){var b=a.info.duration,e=b.end;b.start_str=s.genTimeStrByTimeStamp(b.start,"");b.end_str=s.genTimeStrByTimeStamp(e,"")}a["signed-by"]=
a.info&&a.info.subject&&a.info.issuer?t(a.info.subject,a.info.issuer):"-";a.info&&(!a.info.issuer||!a.info.duration)?a.type="certification-sign-request":a.info&&!0===a.info["is-ca-enabled"]?a.type="ca-certification":a.info&&!1===a.info["is-ca-enabled"]?a.type="local":a.type?Log(DEBUG,"By Pass, use RPC response of 'type'"):a.type="ambiguous"}}]);
app.controller("cert_main",["$scope","$uibModal","$log","$timeout","$q","rpcFns","MyHttp","certService","DSService","Upload","$templateCache","Sets","userAccessRight","UserSession",function(a,b,s,n,v,t,m,q,e,w,l,h,p,u){var x={source:"http",getResult:function(a,b,c){return h.getResult(this,a,b,c)},genProxy:e.genProxy};a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.rpc_genCert={};a.ctx.rpc_importCert={};a.loadReady=!1;a.pcFile=void 0;a.success=!1;a.forcedUsingPost=!0;var r={popRPCResonsepAlert:!0,procBackground:!1,
forcedUsingPost:a.forcedUsingPost};a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&u.logout();var d=function(){var a=v.defer();m.post({url:resource_base+"data/cert2.json",method:"get_cert",success:function(b){a.resolve(b)},error:function(b){Log(ERROR,"AJAX loading error: "+b.status+", URL: "+b.config.url);a.reject(b)}});return a.promise},c=function(){var a=v.defer();m.post({url:resource_base+"data/cert_preinstaled.json",method:"get_ca_cert",params:{filter:{source:["pre-installed"]}},
success:function(b){a.resolve(b)},error:function(b){Log(ERROR,"AJAX loading error: "+b.status+", URL: "+b.config.url);a.reject(b)}});return a.promise},k=function(){v.all({cert:d()}).then(function(b){a.model={};a.model["certs-state"]=x.getResult(b.cert,"certs-state")||{};h.recover_object(a.model,{"certs-state":{cert:[]}});h.recover_object(a.ctx,{rpc_export:{password:"",format:"pkcs12",dest:"pc"}});g();z();angular.forEach(a.model["certs-state"].cert,function(a,b){a.gui_idx=b+1});a.gridCERT.Options.data=
a.model["certs-state"].cert;a.loadReady=!0;a.ctx.currPage="main_cert.htm";a.ctx.rpc_importCert={};angular.extend(a.ctx.rpc_importCert,{type:"local",name:"",password:void 0});a.ctx.importFrom="pc";setTimeout(function(){a.gridCERT.Options&&(a.gridCERT.Options.gridApi&&a.gridCERT.Options.gridApi.customApi&&a.gridCERT.Options.gridApi.customApi.checkSelectStatus)&&a.gridCERT.Options.gridApi.customApi.checkSelectStatus()},50)});a.resetModified();a.gridCERT.Selections.splice(0);a.gridCERT.notPrimaryCert=
!0},g=function(){angular.forEach(a.model["certs-state"].cert,function(b,c){q.prepareCertCtx(b);b.checked=!1;b.detail=[{cbk:a.gridCERT.detail,displayName:a.DICT("Certificate_Detail"),className:"icon-detail"}];b.actions=[{cbk:a.gridCERT.exportCert,disabled:!a.isExportable(b),displayName:a.DICT("Certificate_Export"),className:"grid-btn-export-s"}];a.isImportCSR(b)&&b.actions.push({cbk:a.importCertCSR,displayName:a.DICT("Certificate_Import"),className:"grid-btn-import-s"})})},z=function(){a.schema=a.schema||
{};a.schema.certType=q.genCertType();a.schema.genCertType=[{id:"local",displayName:a.DICT("Certificate_Self_Signing_Certificate")},{id:"certification-sign-request",displayName:a.DICT("Certificate_Certificate_Signing_Request")}];a.schema.importCertType=[{id:"local",displayName:a.DICT("Certificate_Local_Certificate")},{id:"ca-certification",displayName:a.DICT("Certificate_CA_Certificate")},{id:"pkcs12",displayName:a.DICT("Certificate_PKCS_Encoded")}];a.schema.genCertSubjectAltType=[{id:"ip",displayName:a.DICT("Certificate_IP_Addr")},
{id:"fqdn",displayName:a.DICT("Certificate_DNS")},{id:"email",displayName:a.DICT("Certificate_Email")}];a.schema.genCertKeyLenType=[{id:"512",displayName:"512"},{id:"1024",displayName:"1024"},{id:"2048",displayName:"2048"}];a.schema.genCertCA=[];(function(){angular.forEach(a.model["certs-state"].cert,function(b,c){b["has-private-key"]&&a.schema.genCertCA.push({id:b.name,displayName:b.name})})})();a.schema.genCertCountryName=app_cert_data.counrtylist;a.ctx.rpc_genCert={};angular.extend(a.ctx.rpc_genCert,
{type:"local","subject-alternative-type":"ip-type",country:a.schema.genCertCountryName[0].id,"key-encryption-length":"2048","valid-duration":360})};a.T_cellEdit=l.get("T_editWithNoFoucs_by_rowEditableState_objs.html");l.get("T_table_input_text.html");l.get("T_CellText.html");a.selected=a.selected||{};a.gridCERT=a.gridCERT||{};a.gridCERT.rowEditableState=[];a.gridCERT.Selections=[];a.gridCERT.notPrimaryCert=!0;s=function(){a.gridCERT.Selections=[];a.gridCERT.notPrimaryCert=!0;angular.forEach(a.model["certs-state"].cert,
function(b){b.checked&&a.gridCERT.Selections.push(b)});1===a.gridCERT.Selections.length&&(a.gridCERT.Selections[0]&&!0===a.gridCERT.Selections[0]["has-private-key"])&&(a.gridCERT.notPrimaryCert=!1)};a.gridCERT.Options=app.uiGrid.generateGridOptions({IDPreifx:"certificate",rowHeight:1.5*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:s,headerChangedCbk:s},{field:"gui_idx",displayName:a.DICT("Certificate_Index"),width:70},{field:"name",displayName:a.DICT("Certificate")},{field:"used-by",
displayName:a.DICT("Certificate_Used_By"),cellTemplate:l.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"MODEL_COL_FIELD.join(', ')")},{field:"type",displayName:a.DICT("Certificate_Type"),cellTemplate:l.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.certType[MODEL_COL_FIELD]")},{field:"signed-by",displayName:a.DICT("Certificate_Signed_By")},{field:"info.duration",displayName:a.DICT("Certificate_Duration"),width:230,cellTemplate:l.get("T_cert_duration.html")},{field:"detail",
displayName:a.DICT("Certificate_Details"),cellTemplate:"UG_table_icons.html",enableSorting:!1,width:80},{field:"actions",displayName:a.DICT("Certificate_Actions"),cellTemplate:"UG_table_icons.html",enableSorting:!1,width:80}]});var y=function(b){var c=v.defer();b=a.DICT("Certificate_Delete_Certificate",{"%d":b.length});app.TOOLS.criticalAlertBox({title:a.DICT("Certificate_Alert"),msg:b,btn_yes_str:a.DICT("Certificate_Yes"),btn_no_str:a.DICT("Certificate_No"),cbk:function(a){a?c.resolve():c.reject()}});
return c.promise};a.gridCERT.deleteCert=function(){var b=a.gridCERT.Selections,c=b.length-1;if(b&&b[0]){var d=function(b,g){var y=b[g],z=y.info||{},B=z.issuer||{},y={name:y.name,type:y.type};if(!z["is-ca-enabled"]&&(!B["common-name"]||"-"===B["common-name"]))y.isCsr=!0;a.ctx.RPC_delete(y,c===g)["finally"](function(a){b[g+1]?d(b,g+1):k()})};y(b).then(function(){d(b,0)})}};a.selectCertFile=function(b){a.pcFile=b};a.gridCERT.exportCert=function(b,c){a.open(["",c.entity,"exportCert"])};a.gridCERT.selectAsPrimaryCert=
function(){var b="",c=[];a.gridCERT.Selections[0]&&a.gridCERT.Selections[0].name&&(b=a.gridCERT.Selections[0].name);b&&(c.push({method:"set_restconf",params:{"ciscosb-restconf":{transport:{https:{cert:b}}}}}),c.push({method:"set_netconf",params:{"ciscosb-netconf":{transport:{ssh:{cert:b}}}}}),c.push({method:"set_firewall_basic_settings",params:{firewall:{"remote-web-management":{cert:b}}}}),m.post({forcedUsingPost:!0,method:"set_bulk",params:c,success:function(c){result=c&&c.data&&c.data.result||
{};0===result.code?app.TOOLS.successAlertBox({templateUrl:"set_cert_as_primary_success.html",cert:b,cbk:function(a){k()}}):app.TOOLS.criticalAlertBox({title:a.DICT("Certificate_Alert"),templateUrl:"set_cert_as_primary_failure.html",cert:b,cbk:function(a){k()}})},error:function(){app.TOOLS.criticalAlertBox({title:a.DICT("Certificate_Alert"),templateUrl:"set_cert_as_primary_failure.html",cert:b})}}))};a.gridCERT.detail=function(b,c){a.open(["lg",c.entity,"detail"])};a.isExportable=function(a){var b=
!1;a["allow-export"]&&(b=!0);return b};a.isImportCSR=function(a){var b=!1;"certification-sign-request"===a.type&&(b=!0);return b};a.isDeleteable=function(){for(var b=a.gridCERT.Selections,c=!1,d=0,g;d<b.length;d++)g=b[d],"Default"===g.name?c=!0:g["used-by"]&&0<g["used-by"].length&&(g=g["used-by"][0],""!==g&&"-"!==g&&(c=!0));return c};a.save=function(){};a.RPC_check_USB_attached=function(){var b=a.ctx.rpc_importCert;return t.RPC_generic_send("usb-check-attached",void 0,function(c,d,g){c=g.usbs||[];
b.usbDevList=[];for(d=0;d<c.length;d++)!0===c[d].attached&&b.usbDevList.push(c[d].name);1>b.usbDevList.length&&"usb"==a.ctx.importFrom&&(a.ctx.importFrom="pc")},void 0,{procBackground:!1,forcedUsingPost:a.forcedUsingPost})};a.openGenCert=function(){a.warningCheck()||(a.ctx.currPage="gen_cert.htm",a.modified())};a.updCertTypeState=function(){var b="";switch(a.ctx.rpc_genCert.type){case "local":b="SSC";break;case "ca-certification":b="CA";break;case "certification-sign-request":b="CSR";break;case "certification-signed-by-ca":b=
a.ctx.rpc_genCert.ext_csr?"CSByCA,EXT":"CSByCA,LOCAL"}a.ctx.gen_cert_state=b};a.isCertTypeState=function(b){a.ctx.gen_cert_state||a.updCertTypeState();return"CSByCA"===b?0<=a.ctx.gen_cert_state.search("^"+b):a.ctx.gen_cert_state===b};a.generateCertCsr=function(){a.updCertTypeState();var b=angular.copy(a.ctx.rpc_genCert),c=a.ctx.gen_cert_state,d=function(){return{request:{name:b.name,format:"pem","valid-duration":b["valid-duration"],info:{subject:{country:b.country,"state-province":b["state-province"],
locality:b.locality,organization:b.organization,"organization-unit":b["organization-unit"],"common-name":b["common-name"],email:b.email},"subject-alternative-name":b["subject-alternative-name"],"subject-alternative-type":b["subject-alternative-type"],"key-encryption-length":b["key-encryption-length"],"is-self-signed":"SSC"===c||"CA"===c,"is-ca-enabled":0<=c.search(/(^CA$|^CSByCA)/),"ca-file":b["ca-file"]}}}},g=function(){t.RPC_generic_send("generate-csr",{request:{name:b.name,format:"pem",info:{subject:{country:b.country,
"state-province":b["state-province"],locality:b.locality,organization:b.organization,"organization-unit":b["organization-unit"],"common-name":b["common-name"],email:b.email},"subject-alternative-name":b["subject-alternative-name"],"subject-alternative-type":b["subject-alternative-type"],"key-encryption-length":b["key-encryption-length"]}}},function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");k();a.ctx.currPage="main_cert.htm";break;default:Log(DEBUG,c+": RPC done. got unknown code: "+
b)}},void 0,r)},y=function(b){t.RPC_generic_send("generate-cert",b,function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");k();a.ctx.currPage="main_cert.htm";break;default:Log(DEBUG,c+": RPC done. got unknown code: "+b)}},void 0,r)},z=function(){var a=d();delete a.request.info;a.request.file={csr:{"csr-name":"EXT_CSR_001"},"ca-file":b["ca-file"]};y(a)};"CSByCA,EXT"===c?(Log(DEBUG,"Upload case"),z()):"CSR"===c?g():(g=d(),y(g))};a.ctx.RPC_delete=function(b,c){return t.RPC_generic_send("file-delete",
b.isCsr?{fileType:"csr",source:{csr:{"csr-name":b.name}}}:{fileType:"certificate",source:{"certificate-name":b.name}},function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");a.ctx.currPage="main_cert.htm";break;default:Log(DEBUG,c+": RPC done. got unknown code: "+b)}},void 0,{popRPCResonsepAlert:c})};a.ctx.RPC_export2WEB=function(b,c){var d;d=c.isCsr?{fileType:"csr",csr:{"csr-name":b}}:{fileType:"certificate","certificate-name":b,format:c.format};"pkcs12"==c.format&&
(d.password=c.password);return t.RPC_generic_send("file-download",d,function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");a.ctx.currPage="main_cert.htm";break;default:Log(DEBUG,c+": RPC done. got unknown code: "+b)}},void 0,r)};a.ctx.RPC_cert_export2USB=function(b){var c={fileType:"certificate",source:{"certificate-name":b.name,format:a.ctx.rpc_export.format},destination:{"location-url":"FILE://"+b.dest+"/"+b.filename}};"pkcs12"==c.source.format&&(c.source.password=
b.password);return t.RPC_generic_send("file-copy",c,function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");n(function(){a.cancel()},1E3);break;default:Log(DEBUG,c+": RPC done. got unknown code: "+b)}},void 0,r)};a.RPC_upload=function(b){var c;switch(a.ctx.rpc_importCert.type){case "pkcs12":c="pkcs12";break;default:c="pem"}return t.RPC_generic_send("file-copy",{fileType:"certificate",source:{"location-url":"FILE://"+b.source+"/"+b.fileparam},destination:{"certificate-name":b.name,
format:c,password:a.ctx.rpc_importCert.password}},function(b,c,d){b=d.code;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");a.ctx.currPage="main_cert.htm";k();break;default:Log(DEBUG,c+": RPC done. got unknown code: "+b)}},void 0,r)};a.warningCheck=function(){var b=a.model["certs-state"].cert;return 100<=b.length?(a.msg=a.DICT("Certificate_Only_Allow_Maximum",{"%d0":100,"%d1":b.length}),app.TOOLS.criticalAlertBox({title:a.DICT("Certificate_Alert"),msg:a.msg,cbk:function(a){}}),!0):
!1};a.importCert=function(){a.warningCheck()||(a.ctx.certType="cert",a.ctx.currPage="import_cert.htm",a.RPC_check_USB_attached())};a.importCertCSR=function(b,c){a.ctx.certType="CSR";a.ctx.currPage="import_cert.htm";a.ctx.forceCert=c.entity};a.chunkSize=512;var A=function(b,c){var d=B(a.ctx.importFrom);d.fileparam="cert001";b.upload=w.upload({url:resource_base+"upload"+a.getReqParams(),resumeSizeUrl:c?resource_base+"upload?name22="+encodeURIComponent(b.name):null,resumeChunkSize:c?a.chunkSize:null,
headers:{"optional-header":"header-value"},data:{sessionid:"EU6DJKEIWO",pathparam:"Certificate",fileparam:"cert001",file:b}});b.upload.then(function(c){n(function(){b.result=c.data;Log(DEBUG,"do rpc Upload");a.RPC_upload(d)})},function(b){0<b.status&&(a.errorMsg=b.status+": "+b.data);Log(DEBUG,"do rpc Upload");a.RPC_upload(d);Log(ERROR,"do upload error")},function(a){b.progress=Math.min(100,parseInt(100*a.loaded/a.total,10))});b.upload.xhr(function(a){})},B=function(b){var c={},d=a.gridCERT.Selections;
"pc"===b?c.source="Certificate":"usb"===b&&(c.source=a.ctx.rpc_importCert.usb_dev,c.fileparam=a.ctx.rpc_importCert.file["full-file-name"]);c.name=a.ctx.rpc_importCert.name;d&&d[0]&&(c.type=d[0].type);return c};a.uploadCert=function(b){"pc"==a.ctx.importFrom?(a.formUpload=!0,b&&a.upload(b)):"usb"==a.ctx.importFrom&&(b=B(a.ctx.importFrom),a.RPC_upload(b))};a.upload=function(b){a.errorMsg=null;A(b,!1)};a.getReqParams=function(){return a.generateErrorOnServer?"?errorCode="+a.serverErrorCode+"&errorMessage="+
a.serverErrorMsg:""};var C=a.pic={showPreinstalledCerts:function(){var b=function(){return x.genProxy({ref_arr:a.model.pi_cert,data_typical_path_fn:c,data_cache_path_fn:function(a){return{"certs-state":{cert:a}}}})};a.model.pi_cert?C.openModal():v.all({pi_cert:b()}).then(function(b){b=x.getResult(b.pi_cert,"certs-state")||{};a.model.pi_cert=b.cert||[];C.prepareCertCtx(a.model.pi_cert);C.openModal()})},prepareCertCtx:function(a){angular.forEach(a,function(a,b){q.prepareCertCtx(a);a.checked=!1})},openModal:function(){a.open(["dynamic",
null,"show_preinstalled"])}};a.cancel=function(){k()};a.open=function(c){var d,g,y=c[2];"exportCert"==y?(d="modal_export_cert.htm",g="exportCert_ModalInstanceCtrl"):"detail"==y?(d="modal_cert_detail.htm",g="certDetail_ModalInstanceCtrl"):"show_preinstalled"==y&&(d="modal_cert_preinstalled.htm",g="certPreinstalled_ModalInstanceCtrl");b.open({templateUrl:d,controller:g,size:c[0],backdrop:"static",resolve:{model:function(){return a.model},ctx:function(){return a.ctx},cert:function(){return c[1]}}}).result.then(function(a){},
function(){Log(DEBUG,"Modal dismissed at: "+new Date)})};k()}]);
app.controller("certPreinstalled_ModalInstanceCtrl",["$scope","$uibModalInstance","$templateCache","model","$uibModal","certService",function(a,b,s,n,v,t){a.model=n||{};a.schema={};a.schema.certType=t.genCertType();a.gridPIC={};a.gridPIC.Selections=[];a.gridPIC.Options=app.uiGrid.generateGridOptions({IDPreifx:"pi_certificate",rowHeight:1.5*app.uiGrid.rowHeight,columnDefs:[{field:"gui_idx",displayName:a.DICT("Certificate_Index"),width:70},{field:"name",displayName:a.DICT("Certificate")},{field:"used-by",
displayName:a.DICT("Certificate_Used_By"),cellTemplate:s.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"MODEL_COL_FIELD.join(', ')")},{field:"type",displayName:a.DICT("Certificate_Type"),cellTemplate:s.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.certType[MODEL_COL_FIELD]")},{field:"signed-by",displayName:a.DICT("Certificate_Signed_By")},{field:"info.duration",displayName:a.DICT("Certificate_Duration"),width:230,cellTemplate:s.get("T_cert_duration.html")},{field:"detail",
displayName:a.DICT("Certificate_Details"),cellTemplate:"UG_table_icons.html",enableSorting:!1,width:80}]});a.gridPIC.detail=function(b,q){a.open(["lg",q.entity,"detail"])};a.open=function(b){var q,e;"detail"==b[2]&&(q="modal_cert_detail.htm",e="certDetail_ModalInstanceCtrl");v.open({templateUrl:q,controller:e,size:b[0],backdrop:"static",resolve:{model:function(){return a.model},ctx:function(){return a.ctx},cert:function(){return b[1]}}}).result.then(function(a){},function(){Log(DEBUG,"Modal dismissed at: "+
new Date)})};a.cancel=function(){b.dismiss("cancel")};angular.forEach(a.model.pi_cert,function(b,q){b.gui_idx=q+1;b.detail=[{cbk:a.gridPIC.detail,displayName:a.DICT("Certificate_Detail"),className:"icon-detail"}]});a.gridPIC.Options.data=a.model.pi_cert}]);
app.controller("certDetail_ModalInstanceCtrl",["$scope","$uibModalInstance","model","cert","certService",function(a,b,s,n,v){a.selected=a.selected||{};a.cert=n||{};a.cert.subject_str=v.combind_DN(n.info.subject);a.cert.issuer_str=v.combind_DN(n.info.issuer);a.combind_DN=v.combind_DN;a.cancel=function(){b.dismiss("cancel")}}]);
app.controller("exportCert_ModalInstanceCtrl",["$scope","$window","$timeout","$uibModalInstance","model","ctx","cert","rpcFns",function(a,b,s,n,v,t,m,q){a.selected=a.selected||{};a.cert=m||{};a.ctx=t;a.ctx.usbDev=a.ctx.usbDev||{};a.forcedUsingPost=!1;var e={procBackground:!1,forcedUsingPost:a.forcedUsingPost};angular.extend(a.ctx.rpc_export,{password:"",password_confirm:"",dest:"pc",rpc_msg_text:void 0});m.type&&("certification-sign-request"==m.type?(a.ctx.rpc_export.format="pem",a.ctx.rpc_export.pkcs12_support=
!1):a.ctx.rpc_export.pkcs12_support=!0);a.download=function(){var b={},e;a.ctx.rpc_export.rpc_msg_text=void 0;var h=function(b){Log(DEBUG,"download invoked");var e=a.ctx.RPC_export2WEB(m.name,b),h=m.name+b.ext;e.then(function(b){var c=b.data.result,k=c.output;k||(k=c);a.ctx.rpc_export.url=k&&k["download-url"]?k["download-url"]:location.protocol+"//"+location.host+"/download/certificate/"+h;app.TOOLS.download_binary(a.ctx.rpc_export.url);a.ctx.rpc_export.rpc_msg_text="OK"==b.statusText?"Success":b.statusText;
a.ctx.rpc_export.rpc_msg_type="OK"==b.statusText?"success":"fail";"OK"==b.statusText&&s(function(){a.cancel()},2E3)})},p=function(b){b.filename=m.name+b.ext;a.ctx.RPC_cert_export2USB(b)};if(m.name){e=m.info&&m.info.issuer||{};b.ext="pkcs12"==a.ctx.rpc_export.format?".p12":".pem";b.type=m.type;b.name=m.name;b.isCsr=!1;b.dest=a.ctx.rpc_export.dest||"pc";b.format=a.ctx.rpc_export.format;b.password=a.ctx.rpc_export.password;if(!e["common-name"]||"-"===e["common-name"])b.isCsr=!0;"pc"==b.dest?h(b):p(b);
a.ctx.export_btn_cancel="Close"}};a.downloadable=function(){var b=a.ctx.rpc_export.format,e="pkcs12"==b&&a.form.$valid;return!("pem"==b||e)};a.RPC_check_USB_attached=function(){var b=a.ctx.usbDev;b.stateReady=!1;var l=a.ctx.rpc_export;return q.RPC_generic_send("usb-check-attached",void 0,function(a,e,u){a=u.usbs||[];e=!1;b.usbDevList=[];for(u=0;u<a.length;u++)!0===a[u].attached&&a[u]["usbs-type"].match(/mass-storage/)&&(l.dest==a[u].name&&(e=!0),b.usbDevList.push(a[u].name));e||(l.dest="pc");b.stateReady=
!0},void 0,e)};a.cancel=function(){n.dismiss("cancel")}}]);(function(a,b){var s=angular.module("errorModule",[]);s.directive("validationErrors",function(a){return{restrict:"A",scope:{errors:"=",errorClass:"@",validationErrors:"@"},template:'<div ng-class="buildErrorClass()" ng-repeat="(errorKey, isError) in errors track by $index" ng-show="isError">{{errorFor(errorKey)}}</div>',controller:function(b,t,m){var q=a.getError();b.validationErrors&&angular.extend(q,b.$eval(b.validationErrors));b.errorFor=function(a){return q[a]};b.buildErrorClass=function(){return this.errorClass||
'inline-help text-error"'}}}});s.provider("errorMessages",function(){this.errorMessages={};this.$get=function(){var a=this.errorMessages;return{getError:function(){return a}}};this.setErrorMessages=function(a){this.errorMessages=a}})})(window,jQuery);app.controller("sessionTimeoutCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,s,n){a.success=!1;a.dataReady=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var v=function(){b.post({url:resource_base+"data/firewall_session_timeout.json",method:"get_session_timeout",success:function(b){b=b.data.result;var m=b["session-timeout-entry"]||{};a.model.sessions={tcp_session_timeout:m["tcp-session-timeout"]||"",udp_session_timeout:m["udp-session-timeout"]||
"",icmp_session_timeout:m["icmp-session-timeout"]||"",current_connections:(b["sessions-state"]||{})["current-connections"]||"",max_concurrent_connections:m["max-concurrent-connections"]||""};a.dataReady=!0},error:function(b){console.log("sessionTimeoutCtrl Error get data status: "+b.status);a.dataReady=!0}})};a.model={sessions:{}};a.funs={save:function(){var n=a.model.sessions;b.post({method:"set_session_timeout",params:{"session-timeout-entry":{"tcp-session-timeout":n.tcp_session_timeout,"udp-session-timeout":n.udp_session_timeout,
"icmp-session-timeout":n.icmp_session_timeout,"current-connections":n.current_connections,"max-concurrent-connections":n.max_concurrent_connections}},success:function(b){a.success=!0;v();a.resetModified()},error:function(a){}})},cancel:function(){v();a.resetModified()},clear:function(){b.post({method:"action",params:{rpc:"clear-connections"},success:function(b){v();a.resetModified()},error:function(a){}})}};v()}]);app.controller("policyNatCtrl",["$scope","MyHttp","wan_service","$q","UserSession","userAccessRight",function(a,b,s,n,v,t){var m="";a.success=!1;a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var q=function(){return b.post({url:resource_base+"data/services.json",method:"get_services",error:function(a){Log(ERROR,"policyNatCtrl getServices error: "+a.status)}})},e=function(){return b.post({url:resource_base+"data/firewall_policy_nat.json",method:"get_policy_nat",
error:function(a){Log(ERROR,"policyNatCtrl getData error: "+JSON.stringify(a))}})},w=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",error:function(a){Log(ERROR,"policyNatCtrl getInterface error: "+a.status)}})},l=function(){var b={};a.model.display=[];angular.forEach(a.model.nat,function(c){b={checked:!1,name:c.name,enabled:c.enabled?a.DICT("Policy_Nat_Enabled"):a.DICT("Policy_Nat_Disabled"),interface_from:c.interface_from,interface_to:c.interface_to,src_enabled:c.src.enabled,
osa:c.src["original-ip"],ota:c.src["interface"]?c.src["interface"]:c.src.ipgroup,dst_enabled:c.dst.enabled,dsa:c.dst["original-ip"],dta:c.dst["interface"]?c.dst["interface"]:c.dst.ipgroup,sve_enabled:c.service.enabled,original_service:c.service.original_service,translated_service:c.service.translated_service};a.model.display.push(b)})},h=function(b){a.model.nat=[];b["policy-nat-rules"]&&(angular.forEach((b["policy-nat-rules"]||{})["policy-nat-rule"]||[],function(b){a.model.nat.push(b)}),a.model.nat_ori=
angular.copy(a.model.nat),l())},p=function(b){a.model.services=[];var c=[];b.services&&b.services.service&&(c=b.services.service);angular.forEach(c,function(b,c){a.model.services.push({id:b.name,displayName:b.name})})},u=function(b){a.model.ifs=[];var c=[],d=[],g,k,e,h={},r=s.filter(b.interfaces["interface"],{usb:!0,physical:!0,dmz:!0,ipv6transition:!0,subinterface:!0});angular.forEach(b.interfaces["interface"],function(a){if(g=a.name.match(/^(WAN\d+)-(BRIDGE)($|.\d+$)/))h[g[1]+g[3]]=!0,a.ipv4&&(a.ipv4.setting&&
a.ipv4.setting["trasparent-bridge"])&&(k=a.ipv4.setting["trasparent-bridge"],e=k.ifnames&&k.ifnames[0]&&k.ifnames[0].split(" ")||[],angular.forEach(e,function(a){h[a]=!0}))});angular.forEach(r,function(a,b){!h[a.name]&&!(a.name.match(/^USB\d+$/)&&!1===a.enabled||a.name.match(/^DMZ$/)&&!1===a.enabled||a.name.match(/^TUN\d+$/)&&!1===a.enabled)&&c.push({id:a.name,displayName:a.name})});angular.forEach(b.interfaces["interface"],function(a,b){a.name.match(/^VLAN/)&&!h[a.name]&&d.push({id:a.name,displayName:a.name})});
a.model.scheme.addrListTra=c.concat(d);d.push({id:"any",displayName:a.DICT("Policy_Nat_Any")});a.model.ifs=c.concat(d)},x=function(){a.model.scheme={addrListOri:[{id:"any",displayName:a.DICT("Policy_Nat_Any")}],addrListTra:[]}},r=function(){return b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup",error:function(a){console.log("ipGroupCtrl getIPGroupData error "+a.status)}})},d=function(b){b||(b={});a.model.ipgroups=[];b["ip-groups"]&&b["ip-groups"]["ip-group"]&&(a.model.ipgroups=
b["ip-groups"]["ip-group"]);angular.forEach(a.model.ipgroups,function(b){a.model.scheme.addrListOri.push({id:b.name,displayName:b.name});a.model.scheme.addrListTra.push({id:b.name,displayName:b.name})})},c={main:"policy_nat.html",edit:"edit_policy_nat.html"},k=function(){n.all([q(),w(),e(),r()]).then(function(b){p(b[0].data.result||{});u(b[1].data.result||{});h(b[2].data.result||{});d(b[3].data.result||{});a.dataReady=!0});a.model.nat_select=[];a.model.nat_del=[];a.currPage=c.main};a.dataReady=!1;
a.currPage=c.main;a.model={ifs:[],services:[],nat:[],nat_select:[],nat_ori:[],nat_del:[],ipgroups:[],edit:{},scheme:{}};a.gridPolicyNat={IDPreifx:"policy_nat_table",data:"model.display",enableColumnResize:!0,multiSelect:!0,enableRowSelection:!1,enableSorting:!1,keepLastSelected:!1,selectWithCheckboxOnly:!0,plugins:[new app.ngGrid.ngGridFlexibleHeightPlugin],columnDefs:[{field:"checked",displayName:"",width:25,changed:function(){return function(b){a.model.nat_select=[];angular.forEach(a.model.display,
function(b,c){b.checked&&a.model.nat_select.push(b)})}}(),cellTemplate:"ngCheckboxTemplate.html",headerCellTemplate:"ngHeaderCheckboxTemplate.html",data:"model.display"},{field:"name",displayName:a.DICT("Policy_Nat_Name")},{field:"enabled",displayName:a.DICT("Policy_Nat_Status")},{field:"interface_from",displayName:a.DICT("Policy_Nat_From")},{field:"interface_to",displayName:a.DICT("Policy_Nat_To")},{field:"osa",displayName:a.DICT("Policy_Nat_Original_Source_Addr")},{field:"ota",displayName:a.DICT("Policy_Nat_Original_Destination_Addr")},
{field:"original_service",displayName:a.DICT("Policy_Nat_Original_Service")},{field:"dsa",displayName:a.DICT("Policy_Nat_Translated_Source_Addr")},{field:"dta",displayName:a.DICT("Policy_Nat_Translated_Destination_Addr")},{field:"translated_service",displayName:a.DICT("Policy_Nat_Translated_Service")}]};var g=function(b){b=a.model.nat.length;return 200<=b?(a.msg=a.DICT("Policy_Nat_Max_Entries",{"%d":b}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.funs={save:function(c){var d=
{},g=function(){b.post({method:"set_policy_nat",params:{"policy-nat-rules":{"policy-nat-rule":a.model.nat}},success:function(b){a.success=!0;x();k();a.resetModified()},error:function(b){x();k();a.resetModified()}})};if("main"!==c&&"edit"===c)if("add"===m)d={name:a.model.edit.name,enabled:a.model.edit.enabled,interface_from:a.model.edit.interface_from,interface_to:a.model.edit.interface_to,src:{enabled:a.model.edit.src_enabled,"original-ip":a.model.edit.osa,"interface":"any"},dst:{enabled:a.model.edit.dst_enabled,
"original-ip":a.model.edit.dsa,"interface":"any"},service:{enabled:a.model.edit.sve_enabled,original_service:a.model.edit.original_service,translated_service:a.model.edit.translated_service}},a.model.nat.push(d);else if("edit"===m){c="";for(var B=0;B<a.model.nat.length;B++)if(a.model.edit.name===a.model.nat[B].name){for(var d={name:a.model.edit.name,enabled:a.model.edit.enabled,interface_from:a.model.edit.interface_from,interface_to:a.model.edit.interface_to,src:{enabled:a.model.edit.src_enabled,
"original-ip":a.model.edit.osa},dst:{enabled:a.model.edit.dst_enabled,"original-ip":a.model.edit.dsa},service:{enabled:a.model.edit.sve_enabled,original_service:a.model.edit.original_service,translated_service:a.model.edit.translated_service}},e=0;e<a.model.ipgroups.length;e++)if(a.model.edit.ota===a.model.ipgroups[e].name){c="ipgroup";break}""===c?d.src["interface"]=a.model.edit.ota:"ipgroup"===c&&(d.src.ipgroup=a.model.edit.ota);c="";for(e=0;B<a.model.ipgroups.length;e++)if(a.model.edit.dta===a.model.ipgroups[e].name){c=
"ipgroup";break}""===c?d.dst["interface"]=a.model.edit.dta:"ipgroup"===c&&(d.dst.ipgroup=a.model.edit.dta);a.model.nat[B]=angular.copy(d);break}}0<a.model.nat_del.length?b.post({method:"del_policy_nat",params:{"policy-nat-rules":{"policy-nat-rule":a.model.nat_del}},success:function(a){g()},error:function(a){g()}}):g()},add:function(){g()||(m="add",a.model.edit={checked:!1,name:"",enabled:!1,interface_from:"any",interface_to:"any",src_enabled:!1,osa:"any",ota:"WAN1",dst_enabled:!1,dsa:"any",dta:"WAN1",
sve_enabled:!1,original_service:"All Traffic",translated_service:"All Traffic"},a.currPage=c.edit,a.modified())},edit:function(b){if(1===a.model.nat_select.length){m="edit";for(b=0;b<a.model.nat.length;b++)if(a.model.nat[b].name===a.model.nat_select[0].name){a.model.edit={checked:a.model.nat[b].checked,name:a.model.nat[b].name,enabled:a.model.nat[b].enabled,interface_from:a.model.nat[b].interface_from,interface_to:a.model.nat[b].interface_to,src_enabled:a.model.nat[b].src.enabled,osa:a.model.nat[b].src["original-ip"],
ota:a.model.nat[b].src["interface"]?a.model.nat[b].src["interface"]:a.model.nat[b].src.ipgroup,dst_enabled:a.model.nat[b].dst.enabled,dsa:a.model.nat[b].dst["original-ip"],dta:a.model.nat[b].dst["interface"]?a.model.nat[b].dst["interface"]:a.model.nat[b].dst.ipgroup,sve_enabled:a.model.nat[b].service.enabled,original_service:a.model.nat[b].service.original_service,translated_service:a.model.nat[b].service.translated_service};break}a.currPage=c.edit}},del:function(){for(var b=0,c=0,b=a.model.nat.length-
1;0<=b;b--)for(c=0;c<a.model.nat_select.length;c++)if(a.model.nat[b].name===a.model.nat_select[c].name){a.model.nat_del.push({name:a.model.nat[b].name});a.model.nat.splice(b,1);break}l();a.modified()},cancel:function(){a.currPage=c.main;x();k();a.resetModified()},enable:function(){for(var b=0;b<a.model.nat_select.length;b++){a.model.nat_select[b].enabled=!0;for(var c=0;c<a.model.nat.length;c++)if(a.model.nat_select[b].name===a.model.nat[c].name){a.model.nat[c].enabled=!0;break}for(c=0;c<a.model.nat.length;c++)if(a.model.nat_select[b].name===
a.model.display[c].name){a.model.display[c].enabled=!0;break}}},disable:function(){for(var b=0;b<a.model.nat_select.length;b++){a.model.nat_select[b].enabled=!1;for(var c=0;c<a.model.nat.length;c++)if(a.model.nat_select[b].name===a.model.nat[c].name){a.model.nat[c].enabled=!1;break}for(c=0;c<a.model.nat.length;c++)if(a.model.nat_select[b].name===a.model.display[c].name){a.model.display[c].enabled=!1;break}}}};x();k()}]);app.controller("port_triggering_main",["$scope","$q","$location","MyHttp","$filter","GridRowBasedEditingAdv","$templateCache","Sets","wan_service","UserSession","userAccessRight",function(a,b,s,n,v,t,m,q,e,w,l){a.model=a.model||{};a.success=!1;a.dataReady=!1;a.services=[];a.interfaces=[];a.userAccessFlag=l.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var h=function(){var e=n.post({url:resource_base+"data/port_triggering.json",method:"get_port_triggering",error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}}),h=n.post({url:resource_base+"data/service_management.json",method:"get_services",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,h]).then(function(b){a.model={};angular.extend(a.model,b[0].data.result);angular.extend(a.model,b[1].data.result);p();a.schema=a.schema||{};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};a.model_orig=angular.copy(a.model);a.services=[];a.interfaces=[];angular.forEach(a.model.interfaces["interface"],
function(b){a.interfaces.push({id:b.name,displayName:b.name})});angular.forEach(a.getTCPUDPService(),function(b){a.services.push({id:b.name,displayName:b.name})});angular.forEach(a.model["port-triggering-rules"]["port-triggering-entry"],function(b){b.trigger_service={select:b["trigger-service"],list:a.services};b.incoming_service={select:b["incoming-service"],list:a.services};b.interface_t={select:b["interface"],list:a.interfaces}});a.gridPortTrig.Selections=[];a.gridPortTrig.Options.data=a.model["port-triggering-rules"]["port-triggering-entry"];
a.dataReady=!0})};h();var p=function(){a.model["port-triggering-rules"]||angular.extend(a.model,{"port-triggering-rules":{"port-triggering-entry":[]}});a.triggering_sample={checked:!1,invalid:!1,edit:!1};angular.forEach(a.model["port-triggering-rules"]["port-triggering-entry"],function(b){q.recover_object(b,a.triggering_sample)});a.filterWAN_WANsub={physical:!0,subinterface:!0,usb:!0};a.model.interfaces["interface"]=e.filter(a.model.interfaces["interface"],a.filterWAN_WANsub)},u=function(a,b,d){return a.protocol.match(/^(TCP|UDP|TCP_UDP|ALL)$/)?
!0:!1};a.getTCPUDPService=function(){return v("filter")(a.model.services.service,u)};a.jumpToServcieManagement=function(a){app.TOOLS.jumpToPage("System_Config_Service_Management")};a.T_cellEdit=m.get("T_editWithNoFoucs_by_rowEditableState_objs.html");a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridPortTrig=a.gridPortTrig||{};a.gridPortTrig.totalServerItems=0;a.gridPortTrig.Selections=[];a.gridPortTrig.procNgClick=function(b){a.gridPortTrig.Selections=[];angular.forEach(a.model["port-triggering-rules"]["port-triggering-entry"],
function(b,d){b.checked?a.gridPortTrig.Selections.push(b):b.edit=!1})};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridCheckName=function(){var b=a.gridPortTrig.Options.data,e=b.length,d,c;angular.forEach(b,function(a){a.invalid=!1});for(d=0;d<e;d++)for(c=d+1;c<e;c++)b[d].name===b[c].name&&(b[d].invalid=!0,b[c].invalid=!0)};a.gridPortTrig.Options=app.uiGrid.generateGridOptions({IDPreifx:"porttriggering_table",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridPortTrig.procNgClick,
disableChkBoxField:"disableChk",headerChangedCbk:a.gridPortTrig.procNgClick},{field:"status",displayName:a.DICT("Port_Triggering_Enable"),width:70,editRow:"edit",cellTemplate:m.get("UG_table_checkbox_with_inline_edit.html")},{field:"name",displayName:a.DICT("Port_Triggering_Application_Name"),validationCbk:"gridInvalidCbk",editRow:"edit",customVldCbk:"gridCheckName",invalidField:"invalid",cellTemplate:m.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"required legal-char maxlength='63' "),
id:"porttriggering_table_name"},{field:"trigger_service",displayName:a.DICT("Port_Triggering_Trigger_Service"),editRow:"edit",cellTemplate:m.get("UG_table_text_with_inline_select_edit.html"),id:"porttriggering_table_service"},{field:"incoming_service",displayName:a.DICT("Port_Triggering_Incoming_Service"),editRow:"edit",cellTemplate:m.get("UG_table_text_with_inline_select_edit.html"),id:"porttriggering_table_incoming"},{field:"interface_t",displayName:a.DICT("Port_Triggering_Interfaces"),editRow:"edit",
cellTemplate:m.get("UG_table_text_with_inline_select_edit.html"),id:"porttriggering_table_interface"}]});a.ifNamed=function(a){return function(b,d,c){return b.name.match(a)?!0:!1}};a.add=function(){100<=a.gridPortTrig.Options.data.length?(a.msg=a.DICT("Port_Triggering_Reach_Max_Entry",{"%d":100}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}})):(a.gridPortTrig.Options.data.push({checked:!0,invalid:!0,edit:!0,name:"","trigger-service":"All Traffic","incoming-service":"FTP","interface":"WAN1",
status:!0,trigger_service:{select:"All Traffic",list:a.services},incoming_service:{select:"FTP",list:a.services},interface_t:{select:"WAN1",list:a.interfaces}}),a.gridPortTrig.Options.gridApi.customApi.scrollTo(a.gridPortTrig.Options.data.length-1,1),a.gridCheckName(),a.modified())};a.del=function(){var b,e;void 0===a.model["port-triggering-rules"]||void 0===a.model["port-triggering-rules"]["port-triggering-entry"]?(b=[],e=0):(b=a.model["port-triggering-rules"]["port-triggering-entry"],e=b.length);
for(e-=1;0<=e;e--)b[e].checked&&b.splice(e,1);a.modified()};a.edit=function(){angular.forEach(a.gridPortTrig.Options.data,function(a){a.checked&&(a.edit=!0)})};a.save=function(){var b=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.invalid)&&delete a.invalid;angular.isDefined(a.disableChk)&&delete a.disableChk;angular.isDefined(a.edit)&&delete a.edit;angular.isDefined(a.interface_t)&&(a["interface"]=a.interface_t.select,
delete a.interface_t);angular.isDefined(a.trigger_service)&&(a["trigger-service"]=a.trigger_service.select,delete a.trigger_service);angular.isDefined(a.incoming_service)&&(a["incoming-service"]=a.incoming_service.select,delete a.incoming_service)});return a}(a.model["port-triggering-rules"]["port-triggering-entry"]),e=function(){n.post({url:resource_base+"data/port_triggering.json",method:"set_port_triggering",params:{"port-triggering-rules":{"port-triggering-entry":b}},success:function(b){a.success=
!0;h();a.config_saved=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);h()}})};(function(){var b=a.model["port-triggering-rules"]["port-triggering-entry"],c=[],k;angular.forEach(a.model_orig["port-triggering-rules"]["port-triggering-entry"],function(a){k=!1;angular.forEach(b,function(b){a.name===b.name&&(k=!0)});k||c.push({name:a.name})});c.length?n.post({url:resource_base+"data/port_triggering.json",method:"del_port_triggering",params:{"port-triggering-rules":{"port-triggering-entry":c}},
success:function(a){e()},error:function(a){e();console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}):e()})();a.resetModified()};a.cancel=function(){h();a.resetModified()}}]);app.controller("dmzHostCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,s,n){a.success=!1;a.dataReady=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var v=function(){b.post({url:resource_base+"data/firewall_dmz_host.json",method:"get_dmz_host",success:function(b){b=b.data.result["dmz-host-entry"]||{};a.model={enable:b.enable||!1,dmz_host_ip_address:b["dmz-host-ip-address"]||""};a.dataReady=!0},error:function(b){console.log("dmzHostCtrl getData error, status: "+
b.status);a.dataReady=!0}})};a.model={enable:"false",dmz_host_ip_address:""};a.funs={save:function(){var n={"dmz-host-entry":{enable:a.model.enable}};a.model.enable&&(n["dmz-host-entry"]["dmz-host-ip-address"]=a.model.dmz_host_ip_address);b.post({method:"set_dmz_host",forcedUsingPost:!0,params:n,success:function(b){a.success=!0;v();a.resetModified()},error:function(a){}})},cancel:function(){v();a.resetModified()}};v()}]);app.controller("StaticNATCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","$templateCache",function(a,b,s,n,v,t){var m=app.TOOLS.getVal,q=app.TOOLS.getResponse,e="",w="";a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var l=function(){app.TOOLS.apply(a)};a.test;var h=function(){return b.post({url:resource_base+"data/static_nat.json",method:"get_static_nat",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},p=
function(b){b||(b={});b=b["static-nat-rules"]&&b["static-nat-rules"]["static-nat-entry"]||[];a.model.nats=[];angular.forEach(b,function(b){a.model.nats.push(u(b))})},u=function(b){b||(b={});return{checked:!1,edit:!1,private_invalid:!1,public_invalid:!1,service_invalid:!1,interface_invalid:!1,disable_checkbox:!1,service:{select:m(b.service,e),list:a.model.services},interfaces:{select:m(b["interface"],w),list:a.model.interfaces},private_ip:m(b["private-ip"],""),public_ip:m(b["public-ip"],""),range_length:m(b["range-length"],
1),enabled:m(b.status,!0)}},x=function(b){b||(b={});b=b.interfaces&&b.interfaces["interface"]||[];var c,d=[],g=[];a.model.interfaces=[];angular.forEach(b,function(a){c=a.name;c.match(/^WAN\d+($|\.\d+$)/)&&d.push({id:c,displayName:c});c.match(/^USB\d+$/)&&g.push({id:c,displayName:c})});a.model.interfaces=d.concat(g);w=a.model.interfaces[0]&&a.model.interfaces[0].id||""},r=function(){return b.post({url:resource_base+"data/service_management.json",method:"get_services",error:function(a){Log(ERROR,"AJAX loading error: "+
a.status+", URL: "+a.config.url)}})},d=function(b){b||(b={});b=b.services&&b.services.service||[];a.model.services=[];e="";angular.forEach(b,function(b){a.model.services.push({id:b.name,displayName:b.name});e||(e=b.name)})},c=function(){s.all([h(),r()]).then(function(b){x(q(b,0));d(q(b,1));p(q(b,0));a.model.orig_nats=angular.copy(a.model.nats);a.gridStaticNATOption.data=a.model.nats;a.ui.data_ready=!0;a.gridStaticNATOption.gridApi&&setTimeout(function(){a.gridStaticNATOption.gridApi.customApi.checkSelectStatus()},
50);a.resetModified()})},k=function(){var b=a.model.nats,c=[],d;angular.forEach(a.model.orig_nats,function(a){d=!1;angular.forEach(b,function(b){a.service.select===b.service.select&&(a.interfaces.select===b.interfaces.select&&a.public_ip===b.public_ip&&a.private_ip===b.private_ip)&&(d=!0)});d||c.push({service:a.service.select,"interface":a.interfaces.select,"public-ip":a.public_ip,"private-ip":a.private_ip})});return c},g=function(){var b=[];angular.forEach(a.model.nats,function(a){b.push({service:a.service.select,
"interface":a.interfaces.select,"private-ip":a.private_ip,"public-ip":a.public_ip,"range-length":a.range_length,status:a.enabled})});return b};a.funs={save:function(){var d=k(),y=g(),e=[];d.length&&e.push({method:"del_static_nat",params:{"static-nat-rules":{"static-nat-entry":d}}});y.length&&e.push({method:"set_static_nat",params:{"static-nat-rules":{"static-nat-entry":y}}});e.length?b.post({method:"set_bulk",params:e,success:function(b){a.ui.success=!0;c()},error:function(a){Log(ERROR,"AJAX loading error: "+
a.status+", URL: "+a.config.url);c()}}):(a.ui.success=!0,c())},cancel:function(){c()},edit:function(){angular.forEach(a.model.nats,function(a){a.checked&&(a.edit=!0)});l()},add:function(){if(50<=a.model.nats.length){var b=a.DICT("Static_NAT_Reach_Max_Entry",{"%d":50});app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})}else b=u(),b.checked=!0,b.enabled=!0,b.edit=!0,a.model.nats.push(b),a.gridStaticNATOption.gridApi.customApi.scrollToLast(),a.modified(),l()},del:function(){var b,c=a.model.nats;for(b=
c.length-1;0<=b;b--)c[b].checked&&c.splice(b,1);a.modified();l()},jumpToServiceMgnt:function(){app.TOOLS.jumpToPage("System_Config_Service_Management")}};a.ui={data_ready:!1,success:!1,selected_cnt:0};a.model={nats:[],orig_nats:[],services:[],interfaces:[]};n=function(b){a.ui.selected_cnt=0;angular.forEach(a.model.nats,function(b){b.checked&&(a.ui.selected_cnt=a.ui.select_cnt+1)})};a.gridInvalidCbk=function(a){a.row.entity.disable_checkbox=a.rowInvalid};a.gridCheckNAT=function(){var b=a.model.nats,
c=b.length,d,g,e;angular.forEach(b,function(a){a.private_invalid=!1;a.public_invalid=!1;a.service_invalid=!1;a.interface_invalid=!1});for(d=0;d<c;d++)for(g=d+1;g<c;g++)e=!1,b[d].service.select===b[g].service.select&&b[d].interfaces.select===b[g].interfaces.select&&(b[d].private_ip&&b[g].private_ip&&b[d].private_ip===b[g].private_ip&&(e=!0,b[d].private_invalid=!0,b[g].private_invalid=!0),b[d].public_ip&&(b[g].public_ip&&b[d].public_ip===b[g].public_ip)&&(e=!0,b[d].public_invalid=!0,b[g].public_invalid=
!0),e&&(b[d].service_invalid=!0,b[g].service_invalid=!0,b[d].interface_invalid=!0,b[g].interface_invalid=!0));setTimeout(function(){l()},50)};a.gridStaticNATOption=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:n,headerChangedCbk:n},{field:"enabled",displayName:a.DICT("Static_NAT_Enable"),width:70,editRow:"edit",cellTemplate:"UG_table_checkbox_with_inline_edit.html",id:"staticnat_table_status"},{field:"private_ip",displayName:a.DICT("Static_NAT_Private_IP_Range_Begin"),
validationCbk:"gridInvalidCbk",width:183,cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-ip"),invalidField:"private_invalid",change:a.gridCheckNAT,editRow:"edit",id:"staticnat_table_privateip",required:!0},{field:"public_ip",displayName:a.DICT("Static_NAT_Public_IP_Range_Begin"),validationCbk:"gridInvalidCbk",width:178,cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-ip"),invalidField:"public_invalid",change:a.gridCheckNAT,
editRow:"edit",id:"staticnat_table_publicip",required:!0},{field:"range_length",displayName:a.DICT("Static_NAT_Range_Length"),validationCbk:"gridInvalidCbk",width:127,cellTemplate:t.get("UG_table_text_with_inline_number_edit.html"),editRow:"edit",id:"staticnat_table_range",required:!0,min:1,max:50},{field:"service",displayName:a.DICT("Static_NAT_Services"),cellTemplate:t.get("UG_table_text_with_inline_select_edit.html"),editRow:"edit",id:"staticnat_table_service",change:a.gridCheckNAT,invalidField:"service_invalid"},
{field:"interfaces",displayName:a.DICT("Static_NAT_Interfaces"),width:135,cellTemplate:t.get("UG_table_text_with_inline_select_edit.html"),editRow:"edit",id:"staticnat_table_interface",change:a.gridCheckNAT,invalidField:"interface_invalid"}]});c()}]);app.controller("firewallBasicSettingsCtrl",["$scope","MyHttp","$templateCache","UserSession","userAccessRight","$q","sslvpn_port_vld",function(a,b,s,n,v,t,m){var q=app.TOOLS.getVal;a.success=!1;a.dataReady=!1;a.disable_exception=!1;a.ruFlag=v.russia();a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var e=a.DICT("Basic_Settings_Remote_Web_Management_Name"),w=a.ruFlag?a.DICT("Basic_Settings_LAN_Web_Management_HTTP_Name"):a.DICT("Basic_Settings_LAN_VPN_Web_Management_HTTP_Name"),
l=a.ruFlag?a.DICT("Basic_Settings_LAN_Web_Management_HTTPS_Name"):a.DICT("Basic_Settings_LAN_VPN_Web_Management_HTTPS_Name"),h=a.DICT("Basic_Settings_Restconf_Port_Name"),p=a.DICT("Basic_Settings_Netconf_Port_Name"),u=function(){return b.post({url:resource_base+"data/firewall_basic_settings.json",method:"get_firewall_basic_settings",error:function(b){console.log("dynamic_dns error: "+status);a.dataReady=!0}})},x=function(b){b=(b.result||{}).firewall||{};var c=b["remote-web-management"]||{},d=b["lan-vpn-web-management"]||
{},g=b["allowed-remote-ip-addresses"]||{},e=b.block||{},k=(b["trusted-domains"]||{})["trusted-domain-entry"]||[];a.model.firewall={enable:q(b.enable,!1),dos_attack:q(b["dos-attack"],!1),block_wan_request:q(b["block-wan-request"],!1),remote_management:{enable:void 0!==c.enable?c.enable:!1,port:c.port,http_port:c.http?c.port:80,https_port:c.https?c.port:443,selected:c.http?"http":"https"},sip_alg:q(b["sip-alg"],!1),upnp:q(b.upnp,!1),lan_vpn_web_management:{http:q(d.http,!1),http_port:q(d["http-port"],
80),https:!0,https_port:q(d["https-port"],443)},allowed_remote_ip_addresses:{selected:g["start-address"]||g["end-address"]?"range":"any",start_address:g["start-address"]||"",end_address:g["end-address"]||""},ftp_alg_port:b["ftp-alg-port"]||21,block:{java:q(e.java,!1),cookies:q(e.cookies,!1),activex:q(e.activex,!1),access_http_proxy_servers:q(e["access-http-proxy-servers"],!1)},exception:q(b.exception,!1),trusted_domains:[]};angular.forEach(k,function(b,c){a.model.firewall.trusted_domains.push({checked:!1,
disableChk:!1,domainName:b["domain-name"],empty:"",id:c,edit:!1})});a.selects=[];a.model.firewall.orig_trusted_domains=angular.copy(a.model.firewall.trusted_domains);a.gridTrustedDomainOptions.data=a.model.firewall.trusted_domains;a.chk_exception()};n=function(){a.selects=[];angular.forEach(a.model.firewall.trusted_domains,function(b,c){b.checked?a.selects.push(b):b.edit=!1})};var r=function(){return 50<=a.model.firewall.trusted_domains.length?(a.msg=a.DICT("Basic_Settings_Max_Domains",{"%d":a.model.firewall.trusted_domains.length}),
app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},d=function(){return b.post({url:resource_base+"data/restconf.json",method:"get_restconf",error:function(a){Log(ERROR,"[Firewall Basic Setting] getRestconf Error "+JSON.stringify(a));c()}})},c=function(b){b||(b={});b=b["ciscosb-restconf"]||{};var c=b["restconf-zone"]||[],d=b.transport&&b.transport.https||{};a.model.restconf.enabled=q(b.enabled,!1);a.model.restconf.rootResource=q(b.rootResource,"");a.model.restconf.https.enabled=q(d.enabled,
!1);a.model.restconf.https.port=q(d.port,443);angular.forEach(a.model.restconf.restconf_zone,function(b,c){a.model.restconf.restconf_zone[c]=!1});angular.forEach(c,function(b){switch(b){case "wan":a.model.restconf.restconf_zone.wan=!0}});a.model.restconf.restconf_zone["lan-vpn"]=!0},k=function(){return b.post({url:resource_base+"data/netconf.json",method:"get_netconf",error:function(a){Log(ERROR,"[Firewall Basic Setting] getNetconf Error "+JSON.stringify(a));g()}})},g=function(b){b||(b={});b=b["ciscosb-netconf"]||
{};var c=b["netconf-zone"]||[],d=b.transport&&b.transport.ssh||{};a.model.netconf.enabled=q(b.enabled,!1);a.model.netconf.ssh.enabled=q(d.enabled,!1);a.model.netconf.ssh.ip=q(d.ip,"0.0.0.0");a.model.netconf.ssh.port=q(d.port,830);angular.forEach(a.model.restconf.restconf_zone,function(b,c){a.model.netconf.netconf_zone[c]=!1});angular.forEach(c,function(b){switch(b){case "wan":a.model.netconf.netconf_zone.wan=!0}});a.model.netconf.netconf_zone["lan-vpn"]=!0},z=function(){t.all([u(),d(),k(),m.init()]).then(function(b){x(b[0]&&
b[0].data&&b[0].data);c(b[1]&&b[1].data&&b[1].data.result);g(b[2]&&b[2].data&&b[2].data.result);a.dataReady=!0;setTimeout(function(){a.gridTrustedDomainOptions.gridApi&&a.gridTrustedDomainOptions.gridApi.customApi.checkSelectStatus()},50)})};a.errstr={lvwm_http:"",lvwm_https:"",rmt:"",netconf:"",restconf:""};a.model={firewall:{trusted_domains:[]},restconf:{enabled:!1,rootResource:"",restconf_zone:{wan:!1,"lan-vpn":!0},https:{enabled:!1,port:443}},netconf:{enabled:!1,netconf_zone:{wan:!1,"lan-vpn":!0},
ssh:{enabled:!1,ip:"",port:830}}};a.selects=[];a.model.httpPortPattern="^(80|102[5-9]|10[3-9][0-9]|1[1-9][0-9][0-9]|[2-9][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9]|6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9])$";a.model.httpsPortPattern="^(443|102[5-9]|10[3-9][0-9]|1[1-9][0-9][0-9]|[2-9][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9]|6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9])$";a.model.netconfPortPattern="^(830|102[5-9]|10[3-9][0-9]|1[1-9][0-9][0-9]|[2-9][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9]|6553[0-5]|655[0-2][0-9]|65[0-4][0-9][0-9]|6[0-4][0-9][0-9][0-9]|[1-5][0-9][0-9][0-9][0-9])$";
a.funs={save:function(){var c=a.model.firewall,d=[],d=[];(function(){var b=!0,c=[];angular.forEach(a.model.firewall.orig_trusted_domains,function(d){b=!0;angular.forEach(a.model.firewall.trusted_domains,function(a){d.domainName===a.domainName&&(b=!1)});b&&c.push({"domain-name":d.domainName})});c.length&&d.push({method:"del_firewall_basic_settings",params:{firewall:{"trusted-domains":{"trusted-domain-entry":c}}}})})();(function(){var a=c.remote_management.http_port&&""!==c.remote_management.http_port?
c.remote_management.http_port:80,b=c.remote_management.https_port&&""!==c.remote_management.https_port?c.remote_management.https_port:443,g={firewall:{enable:c.enable,"dos-attack":c.dos_attack,"block-wan-request":c.block_wan_request,"remote-web-management":{enable:c.remote_management.enable,port:"http"===c.remote_management.selected?a:b},"sip-alg":c.sip_alg,upnp:c.upnp,"lan-vpn-web-management":{http:c.lan_vpn_web_management.http,https:c.lan_vpn_web_management.https,"http-port":c.lan_vpn_web_management.http_port,
"https-port":c.lan_vpn_web_management.https_port},"ftp-alg-port":c.ftp_alg_port,block:{java:c.block.java,cookies:c.block.cookies,activex:c.block.activex,"access-http-proxy-servers":c.block.access_http_proxy_servers},exception:c.exception,"trusted-domains":{"trusted-domain-entry":[]}}};"http"===c.remote_management.selected?angular.extend(g.firewall["remote-web-management"],{http:!0,https:!1}):angular.extend(g.firewall["remote-web-management"],{http:!1,https:!0});g.firewall["allowed-remote-ip-addresses"]=
"any"===c.allowed_remote_ip_addresses.selected?{any:null}:{"start-address":c.allowed_remote_ip_addresses.start_address,"end-address":c.allowed_remote_ip_addresses.end_address};angular.forEach(c.trusted_domains,function(a){g.firewall["trusted-domains"]["trusted-domain-entry"].push({"domain-name":a.domainName})});d.push({method:"set_firewall_basic_settings",params:g})})();(function(){var b=a.model.netconf,c=_.isNumber(b.ssh.port)?b.ssh.port:830,g;g={enabled:b.enabled,"netconf-zone":[],transport:{ssh:{enabled:b.ssh.enabled,
ip:b.ssh.ip,port:c}}};angular.forEach(b.netconf_zone,function(a,b){a&&g["netconf-zone"].push(b)});d.push({method:"set_netconf",params:{"ciscosb-netconf":g}})})();(function(){var b=a.model.restconf,c=_.isNumber(b.https.port)?b.https.port:443,g;g={enabled:b.enabled,"restconf-zone":[],transport:{https:{enabled:b.https.enabled,port:c}}};angular.forEach(b.restconf_zone,function(a,b){a&&g["restconf-zone"].push(b)});d.push({method:"set_restconf",params:{"ciscosb-restconf":g}})})();b.post({method:"set_bulk",
forcedUsingPost:!0,params:d,success:function(b){a.success=!0;z();a.resetModified()},error:function(b){z();a.resetModified()}})},cancel:function(){z();a.resetModified()},add:function(){r()||(a.model.firewall.trusted_domains.push({checked:!0,disableChk:!0,domainName:"",idx:a.model.firewall.trusted_domains.length,edit:!0}),a.gridTrustedDomainOptions.gridApi.customApi.scrollTo(a.model.firewall.trusted_domains.length-1,1),a.modified())},edit:function(){angular.forEach(a.model.firewall.trusted_domains,
function(a,b){a.checked&&(a.edit=!0)})},del:function(){for(var b=a.model.firewall.trusted_domains,c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);a.selects=[];a.modified()},changeHttpHttps:function(){a.model.firewall.remote_management.http_port=80;a.model.firewall.remote_management.https_port=443;a.check_firewall_port()},cleanInterPort:function(){var b=a.model.firewall.remote_management;!1===b.enable&&"http"===b.selected&&8008===b.http_port&&(b.http_port=80);!1===b.enable&&"https"===b.selected&&
8008===b.https_port&&(b.https_port=443);a.check_firewall_port()}};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridTrustedDomainOptions=app.uiGrid.generateGridOptions({IDPreifx:"trusted_domains_table",data:a.model.firewall.trusted_domains,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:n,headerChangedCbk:n,disableChkBoxField:"disableChk"},{field:"domainName",displayName:a.DICT("Basic_Settings_Domain_Name"),editRow:"edit",required:!0,width:400,validationCbk:"gridInvalidCbk",
cellTemplate:s.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"legal-char domain-name maxlength=253"),id:"trusted_domains_table"},{field:"empty",displayName:"",isEmpty:!0}]});a.chk_exception=function(){var b=a.model.firewall.block;!b.java&&!b.cookies&&!b.activex&&!b.access_http_proxy_servers?(a.model.firewall.exception=!1,a.disable_exception=!0):a.disable_exception=!1};a.chk_range=function(){var b=function(b){a.form&&(a.form.start_ip&&a.form.end_ip)&&(a.form.start_ip.$setValidity("rangeInvalid",
b),a.form.end_ip.$setValidity("rangeInvalid",b))};if(!a.model.firewall.enable||"range"!==a.model.firewall.allowed_remote_ip_addresses.selected)b(!0);else{var c=a.model.firewall.allowed_remote_ip_addresses.start_address,d=a.model.firewall.allowed_remote_ip_addresses.end_address;!c||!d?b(!0):(c=app.TOOLS.ipRangeCompare(c,d),b(c.ret))}};a.check_firewall_ports_overlap=function(){var b=function(b,c){a.form[b]&&a.form[b].$setValidity&&a.form[b].$setValidity("duplicate",c)},c=a.model.firewall,d=a.errstr,
g=c.remote_management,k=-1,z=-2,c=c.lan_vpn_web_management,r=-3,x=-4,u=a.model.restconf,G=-5,m=-6,q=a.model.netconf,n=-7,M=-8;g.enable&&("http"===g.selected&&_.isNumber(g.http_port)?k=g.http_port:"https"===g.selected&&_.isNumber(g.https_port)&&(z=g.https_port));c.http&&c.http_port&&(r=c.http_port);x=c.https_port;u.enabled&&u.https.port&&(u.restconf_zone.wan&&(G=u.https.port),m=u.https.port);q.enabled&&q.ssh.port&&(q.netconf_zone.wan&&(n=q.ssh.port),M=q.ssh.port);a.errstr.lvwm_http=[];a.errstr.lvwm_https=
[];a.errstr.rmt=[];a.errstr.netconf=[];a.errstr.restconf=[];b("lvwm_http_port",!0);b("lvwm_https_port",!0);b("rmt_http_port",!0);b("rmt_https_port",!0);b("netconf_port",!0);b("restconf_port",!0);r===x&&(d.lvwm_http.push(l),d.lvwm_https.push(w),b("lvwm_http_port",!1),b("lvwm_https_port",!1));G===k&&(d.rmt.push(h),d.restconf.push(e),b("restconf_port",!1),b("rmt_http_port",!1));G===z&&(d.rmt.push(h),d.restconf.push(e),b("restconf_port",!1),b("rmt_https_port",!1));m===r&&(d.restconf.push(w),d.lvwm_http.push(h),
b("lvwm_http_port",!1),b("restconf_port",!1));n===k&&(d.netconf.push(e),d.rmt.push(p),b("netconf_port",!1),b("rmt_http_port",!1));n===z&&(d.netconf.push(e),d.rmt.push(p),b("netconf_port",!1),b("rmt_https_port",!1));M===r&&(d.netconf.push(w),d.lvwm_https.push(p),b("netconf_port",!1),b("lvwm_http_port",!1));M===x&&(d.netconf.push(l),d.lvwm_https.push(p),b("netconf_port",!1),b("lvwm_https_port",!1));if(G===n||m===M)d.restconf.push(p),d.netconf.push(h),b("restconf_port",!1),b("netconf_port",!1);d.lvwm_http=
a.DICT("Basic_Settings_Duplicate",{"%s":d.lvwm_http.join(", ")});d.lvwm_https=a.DICT("Basic_Settings_Duplicate",{"%s":d.lvwm_https.join(", ")});d.rmt=a.DICT("Basic_Settings_Duplicate",{"%s":d.rmt.join(", ")});d.netconf=a.DICT("Basic_Settings_Duplicate",{"%s":d.netconf.join(", ")});d.restconf=a.DICT("Basic_Settings_Duplicate",{"%s":d.restconf.join(", ")})};a.check_firewall_port=function(){var b=function(b,c){a.form[b]&&a.form[b].$setValidity&&a.form[b].$setValidity("overlap",c)},c=function(b){app.TOOLS.criticalAlertBox({title:a.DICT("Error"),
msg:b})},d=a.model.firewall,g=a.model.restconf,e=a.model.netconf,k=d.remote_management,d=d.lan_vpn_web_management,h=[],z;b("rmt_http_port",!0);b("rmt_https_port",!0);b("lvwm_https_port",!0);b("lvwm_http_port",!0);b("netconf_port",!0);b("restconf_port",!0);if(d.http)z=m.check_firewall_port_lan(d.http_port),z.valid||(h=h.concat(z.err),b("lvwm_http_port",!1));else if(!d.http_port||!_.isNumber(d.http_port))d.http_port=80;g.enabled?_.isNumber(g.https.port)&&(z=g.restconf_zone.wan?m.check_firewall_port_wan(g.https.port):
m.check_firewall_port_lan(g.https.port),z.valid||(h=h.concat(z.err),b("restconf_port",!1))):_.isNumber(g.https.port)||(g.https.port=443);e.enabled?_.isNumber(e.ssh.port)&&(z=e.netconf_zone.wan?m.check_firewall_port_wan(e.ssh.port):m.check_firewall_port_lan(e.ssh.port),z.valid||(h=h.concat(z.err),b("netconf_port",!1))):_.isNumber(e.ssh.port)||(e.ssh.port=830);if(d.https)z=m.check_firewall_port_lan(d.https_port),z.valid||(h=h.concat(z.err),b("lvwm_https_port",!1));else if(!d.https_port||!_.isNumber(d.https_port))d.https_port=
443;k.enable?("http"===k.selected&&(z=m.check_firewall_port_wan(k.http_port),z.valid||(h=h.concat(z.err),b("rmt_http_port",!1))),"https"===k.selected&&(z=m.check_firewall_port_wan(k.https_port),z.valid||(h=h.concat(z.err),b("rmt_https_port",!1)))):(_.isNumber(k.http_port)||(k.http_port=80),_.isNumber(k.https_port)||(k.https_port=443));h.length&&c(m.get_err_html(h));a.check_firewall_ports_overlap()};z()}]);app.controller("accessRulesCtrl",["$scope","MyHttp","$uibModal","$location","wan_service","$q","ciscosb","pgWindow","UserSession","userAccessRight","oneTimeLocker",function(a,b,s,n,v,t,m,q,e,w,l){var h=0,p=0;a.success=!1;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();var u=function(){return b.post({url:resource_base+"data/services.json",method:"get_services",error:function(a){Log(ERROR,"accessRulesCtrl getServices error: "+a.status)}})},x=function(){return b.post({url:resource_base+
"data/schedule.json",method:"get_schedule",error:function(a){Log(ERROR,"accessRulesCtrl getSchedule error: "+a.status)}})},r=function(){return b.post({url:resource_base+"data/firewall_access_rules.json",method:"get_acl",error:function(a){Log(ERROR,"accessRulesCtrl getData error: "+JSON.stringify(a))}})},d=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",error:function(a){Log(ERROR,"accessRulesCtrl getInterface error: "+a.status)}})},c=function(b,c){var d=
b["interface"]||{},g=b["source-ip"]||{},e=b.action||{},k=b["destination-ip"]||{},h={checked:!0,rule_id:b["rule-id"],priority:b.priority,enable:void 0!==b.enable?b.enable:!0,action:!0,service:b.service||a.model.services[0].id,ip_type:c||"IPv4",log:void 0!==b.log?b.log:!0,"interface":{},source_ip:{type:"any",single_ip:"",start:"",end:"",subnet_ip:"",subnet_prefix:""},destination_ip:{type:"any",single_ip:"",start:"",end:"",subnet_ip:"",subnet_prefix:""},schedule:b.schedule||a.model.schedules[0].id,default_value:void 0===
b["default"]?!1:b["default"]};(function(){var a=function(a,b){angular.forEach(a,function(a,c){switch(c){case "source-any":b.type="any";break;case "ipv4":case "ipv6":angular.forEach(a,function(a,c){b.type=c;switch(c){case "single":b.single_ip=a;break;case "range":b.start=a.start;b.end=a.end;break;case "subnet":b.subnet_ip=a.ip||"";b.subnet_prefix=a["prefix-length"]||"";break;default:Log(ERROR,"ACL procData error, source_ip type is undefined: '"+c+"'")}})}})};angular.forEach(e,function(a,b){switch(b){case "allow":h.action=
!0;break;case "deny":h.action=!1}});a(g,h.source_ip);a(k,h.destination_ip)})();!0===b["default"]?(h["interface"].source=d["source-name"]?d["source-name"]:d["source-interface"]||a.model.ifs[0].id,h["interface"].destination=d["destination-name"]?d["destination-name"]:d["destination-interface"]||a.model.ifs[0].id):(d["source-name"]&&d["source-name"].match(/^any$/i)?h["interface"].source="any":h["interface"].source=d["source-interface"]||a.model.ifs[0].id,d["destination-name"]&&d["destination-name"].match(/^any$/i)?
h["interface"].destination="any":h["interface"].destination=d["destination-interface"]||a.model.ifs[0].id);return h},k=function(){var b=[],c,d,g=!1,e=!1;a.model.ipv4_display=[];a.model.ipv6_display=[];var k=function(b){switch(b){case "any":return a.DICT("Any")}return b},h=function(b,c){switch(b.type){case "any":return a.DICT("Any");case "single":return b.single_ip;case "range":return c?g=!0:e=!0,b.start+" - "+b.end;case "subnet":return b.subnet_ip+"/"+b.subnet_prefix}return""},A=function(g,e){var A=
1;b=[];angular.forEach(g,function(c,d){if(c){var g={checked:!1,rule_id:c.rule_id,orig_idx:d,priority:c.priority,gui_priority:{priority:A,info:""},enable:c.enable,action:c.action?a.DICT("Access_Rules_Allowed"):a.DICT("Access_Rules_Denied"),service:c.ip_type+": "+c.service,source_intf:k(c["interface"].source),destination_intf:k(c["interface"].destination),schedule:c.schedule,source:h(c.source_ip,"IPv4"===c.ip_type),destination:h(c.destination_ip,"IPv4"===c.ip_type),default_value:void 0===c.default_value?
!1:c.default_value},e;e=g.default_value;var z=c.ip_type;e=e?[]:[{cbk:a.funs.table.up(z),displayName:a.DICT("Access_Rules_Up"),disabled:e,className:"grid-btn-caret-up"},{cbk:a.funs.table.down(z),displayName:a.DICT("Access_Rules_Down"),disabled:e,className:"grid-btn-caret-down"},{cbk:a.funs.table.jumpto(z),displayName:a.DICT("Access_Rules_Jump"),disabled:e,className:"grid-btn-sort"}];g.configure=e;g.default_value?(g.gui_priority.priority=g.rule_id,g.gui_priority.info=1E3<=g.rule_id&&2E3>g.rule_id?a.DICT("Access_Rules_Port_Forward_Hint"):
2E3<=g.rule_id&&3E3>g.rule_id?a.DICT("Access_Rules_Static_NAT_Hint"):a.DICT("Access_Rules_System_Hint")):A++;b[c.priority]&&(b[c.priority],Log(ERROR,"There are two priority at Confd database, priority is "+b[c.priority].priority),Log(INFO,b[c.priority]),Log(INFO,g));b[c.priority]=g}});c=b.length;for(d=0;d<c;d++)b[d]&&e.push(b[d])};A(a.model.ipv4_acls,a.model.ipv4_display);A(a.model.ipv6_acls,a.model.ipv6_display);a.gridIPv4ACLOptions.rowHeight=g?1.5*app.uiGrid.rowHeight:app.uiGrid.rowHeight;a.gridIPv6ACLOptions.rowHeight=
e?1.5*app.uiGrid.rowHeight:app.uiGrid.rowHeight;a.gridIPv4ACLOptions.data=a.model.ipv4_display;a.gridIPv6ACLOptions.data=a.model.ipv6_display;a.gridIPv4ACLOptions.gridApi&&a.gridIPv4ACLOptions.gridApi.core.notifyDataChange("all");a.gridIPv6ACLOptions.gridApi&&a.gridIPv6ACLOptions.gridApi.core.notifyDataChange("all")},g=function(b){var d=b["firewall-acl-rules"]||{};b=d.ipv4||{};var d=d.ipv6||{},g;a.model.ipv4_acls=[];a.model.ipv6_acls=[];a.model.ipv4_defaults=[];a.model.ipv6_defaults=[];p=h=0;b=b["firewall-acl-rule"]||
[];angular.forEach(b,function(b,d){!0===b["default"]?a.model.ipv4_defaults.push(c(b,"IPv4")):(g=c(b,"IPv4"),g.priority>h&&(h=g.priority),a.model.ipv4_acls.push(g))});b=d["firewall-acl-rule"]||[];angular.forEach(b,function(b,d){!0===b["default"]?a.model.ipv6_defaults.push(c(b,"IPv6")):(g=c(b,"IPv6"),g.priority>p&&(p=g.priority),a.model.ipv6_acls.push(g))});a.model.ipv4_acls.sort(function(a,b){return a.priority-b.priority});a.model.ipv6_acls.sort(function(a,b){return a.priority-b.priority});a.model.ipv4_acls=
a.model.ipv4_acls.concat(a.model.ipv4_defaults);a.model.ipv6_acls=a.model.ipv6_acls.concat(a.model.ipv6_defaults);a.model.origIPv4Acls=angular.copy(a.model.ipv4_acls);a.model.origIPv6Acls=angular.copy(a.model.ipv6_acls);k()},z=function(b){a.model.services=[];var c=[];b.services&&b.services.service&&(c=b.services.service);angular.forEach(c,function(b,c){a.model.services.push({id:b.name,displayName:b.name})})},y=function(b){a.model.schedules=[];var c=[];b.schedules&&b.schedules.schedule&&(c=b.schedules.schedule);
angular.forEach(c,function(b){a.model.schedules.push({id:b.name,displayName:a.DICT(b.name)})})},A=function(b){a.model.ifs=[];var c=[],d=[],g=[],e,k,h,A={},z=v.filter(b.interfaces["interface"],{gre:!0,usb:!0,physical:!0,dmz:!0,ipv6transition:!0,subinterface:!0});angular.forEach(b.interfaces["interface"],function(a){if(e=a.name.match(/^(WAN\d+)-(BRIDGE)($|.\d+$)/))A[e[1]+e[3]]=!0,a.ipv4&&(a.ipv4.setting&&a.ipv4.setting["trasparent-bridge"])&&(k=a.ipv4.setting["trasparent-bridge"],h=k.ifnames&&k.ifnames[0]&&
k.ifnames[0].split(" ")||[],angular.forEach(h,function(a){A[a]=!0}))});angular.forEach(z,function(a,b){a.name.match(/^GRE\d+$/)?!1!==a.enabled&&g.push({id:a.name,displayName:a.name}):!A[a.name]&&!(a.name.match(/^USB\d+$/)&&!1===a.enabled||a.name.match(/^DMZ$/)&&!1===a.enabled||a.name.match(/^TUN\d+$/)&&!1===a.enabled)&&c.push({id:a.name,displayName:a.name})});angular.forEach(b.interfaces["interface"],function(a,b){a.name.match(/^VLAN/)&&!A[a.name]&&d.push({id:a.name,displayName:a.name})});d.push({id:"any",
displayName:"Any"});a.model.ifs=c.concat(g).concat(d)},B=function(b){a.model.addEditItem={};a.model.addEditItem=angular.copy(b)};e=function(b){return function(c){"IPv4"===b?(a.model.ipv4_selects=[],angular.forEach(a.model.ipv4_display,function(b,c){b.checked&&a.model.ipv4_selects.push(b)})):(a.model.ipv6_selects=[],angular.forEach(a.model.ipv6_display,function(b,c){b.checked&&a.model.ipv6_selects.push(b)}))}};var C={main:"access_rules.html",edit:"edit_access_rule.html"},D=-1,E=function(){t.all([u(),
d(),x(),r()]).then(function(b){z(b[0].data.result||{});A(b[1].data.result||{});y(b[2].data.result||{});g(b[3].data.result||{});b=l.get("backFromSchedule");var c=l.get("prevACLCache"),d,e,k=!1;b&&c&&(d=c.addEditItem,e=c.addEditIdx,-1===e?(b="IPv4"===d.ip_type?(a.model.ipv4_acls.length-a.model.ipv4_defaults.length||0)+1:(a.model.ipv6_acls.length-a.model.ipv6_defaults.length||0)+1,d.rule_id=b,a.model.addEditItem=d,D=-1,k=!0):(angular.forEach("IPv4"===d.ip_type?a.model.ipv4_acls:a.model.ipv6_acls,function(a,
b){a.rule_id===d.rule_id&&e===b&&(k=!0)}),k&&(a.model.addEditItem=d,D=e)),k&&(a.currPage=C.edit));a.dataReady=!0;setTimeout(function(){a.gridIPv4ACLOptions.gridApi&&a.gridIPv4ACLOptions.gridApi.customApi.checkSelectStatus();a.gridIPv6ACLOptions.gridApi&&a.gridIPv6ACLOptions.gridApi.customApi.checkSelectStatus()},50)});a.currPage=C.main};a.dataReady=!1;a.currPage=C.main;a.model={ifs:[],services:[],schedules:[],ipv4_acls:[],ipv6_acls:[],ipv4_selects:[],ipv6_selects:[],origIPv4Acls:[],origIPv6Acls:[],
addEditItem:{},scheme:{},defaults:[]};a.gridIPv4ACLOptions=app.uiGrid.generateGridOptions({IDPreifx:"ipv4_accessrule_table",data:a.model.ipv4_display,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:e("IPv4"),headerChangedCbk:e("IPv4"),hideField:"default_value"},{field:"gui_priority",displayName:a.DICT("Access_Rules_Priority"),width:80,cellTemplate:"access_priority.html"},{field:"enable",displayName:a.DICT("Access_Rules_Enable"),width:80,cellTemplate:"UG_table_checkbox_with_inline_edit.html"},
{field:"action",displayName:a.DICT("Access_Rules_Action"),width:80},{field:"service",displayName:a.DICT("Access_Rules_Services")},{field:"source_intf",displayName:a.DICT("Access_Rules_Source_Interface")},{field:"source",displayName:a.DICT("Access_Rules_Source"),minWidth:160,cellTemplate:"UG_table_text_with_wrap.html"},{field:"destination_intf",displayName:a.DICT("Access_Rules_Destination_Interface"),minWidth:160},{field:"destination",displayName:a.DICT("Access_Rules_Destination"),minWidth:160,cellTemplate:"UG_table_text_with_wrap.html"},
{field:"schedule",displayName:a.DICT("Access_Rules_Schedule")},{field:"configure",displayName:a.DICT("Access_Rules_Configure"),cellTemplate:"UG_table_icons.html",id:"accessrule_table"}]});a.gridIPv6ACLOptions=app.uiGrid.generateGridOptions({IDPreifx:"ipv6_accessrule_table",data:a.model.ipv6_display,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:e("IPv6"),headerChangedCbk:e("IPv6"),hideField:"default_value"},{field:"gui_priority",displayName:a.DICT("Access_Rules_Priority"),width:80,cellTemplate:"access_priority.html"},
{field:"enable",displayName:a.DICT("Access_Rules_Enable"),width:80,cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"action",displayName:a.DICT("Access_Rules_Action"),width:80},{field:"service",displayName:a.DICT("Access_Rules_Services")},{field:"source_intf",displayName:a.DICT("Access_Rules_Source_Interface")},{field:"source",displayName:a.DICT("Access_Rules_Source"),minWidth:160},{field:"destination_intf",displayName:a.DICT("Access_Rules_Destination_Interface"),minWidth:160},{field:"destination",
displayName:a.DICT("Access_Rules_Destination")},{field:"schedule",displayName:a.DICT("Access_Rules_Schedule"),minWidth:160},{field:"configure",displayName:a.DICT("Access_Rules_Configure"),cellTemplate:"UG_table_icons.html",id:"accessrule_table"}]});var I=function(b,c){var d,g,e=1,k;if("IPv4"===b){if(65532>h&&!c)return;k=a.model.ipv4_acls}else if("IPv6"===b){if(65532>p&&!c)return;k=a.model.ipv6_acls}else return;e=1;d=k.length;for(g=0;g<d;g++)k[g]&&!k[g].default_value&&("IPv4"===b?h=e:p=e,k[g].priority=
e,e++)},F=function(b){b=a.model.ipv4_acls.length+a.model.ipv6_acls.length;return 200<=b?(a.msg=a.DICT("Access_Rules_Max_Entries",{"%d":b}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.funs={save:function(c){var d,g,e=!1,k,h,A=function(a,b,c){b=b?"ipv4":"ipv6";var d={};d[b]={};switch(a.type){case "any":d=c?m.empty_type("destination-any"):m.empty_type("source-any");break;case "single":d[b].single=a.single_ip;break;case "range":d[b].range={start:a.start,end:a.end};break;case "subnet":d[b].subnet=
{},d[b].subnet.ip=a.subnet_ip,d[b].subnet["prefix-length"]=a.subnet_prefix}return d},z=function(a){var b={"rule-id":a.rule_id,priority:a.priority,enable:a.enable,service:a.service,log:a.log,"interface":{},"source-ip":A(a.source_ip,"IPv4"===a.ip_type,!1),"destination-ip":A(a.destination_ip,"IPv4"===a.ip_type,!0),schedule:a.schedule,"default":void 0===a.default_value?!1:a.default_value};"any"==a["interface"].source?b["interface"]["source-name"]="any":b["interface"]["source-interface"]=a["interface"].source;
"any"==a["interface"].destination?b["interface"]["destination-name"]="any":b["interface"]["destination-interface"]=a["interface"].destination;b.action=a.action?m.empty_type("allow"):m.empty_type("deny");return b},B=function(){d={};k=[];h=[];angular.forEach(a.model.ipv4_acls,function(a){!1===a.default_value&&k.push(z(a))});angular.forEach(a.model.ipv6_acls,function(a){!1===a.default_value&&h.push(z(a))});k.length&&(d.ipv4={"firewall-acl-rule":k});h.length&&(d.ipv6={"firewall-acl-rule":h});b.post({method:"set_access_rules",
params:{"firewall-acl-rules":d},success:function(b){a.success=!0;E();a.resetModified()},error:function(b){E();a.resetModified()}})};"addEdit"===c&&(c=a.model.addEditItem,-1===D?"IPv4"===c.ip_type?a.model.ipv4_acls.push(c):a.model.ipv6_acls.push(c):"IPv4"===c.ip_type?a.model.ipv4_acls[D]=angular.extend(c):a.model.ipv6_acls[D]=angular.extend(c));d={};k=[];h=[];angular.forEach(a.model.origIPv4Acls,function(b){!1===b.default_value&&(g=!0,angular.forEach(a.model.ipv4_acls,function(a){b.rule_id===a.rule_id&&
(g=!1)}),g&&k.push({"rule-id":b.rule_id}))});angular.forEach(a.model.origIPv6Acls,function(b){!1===b.default_value&&(g=!0,angular.forEach(a.model.ipv6_acls,function(a){b.rule_id===a.rule_id&&(g=!1)}),g&&h.push({"rule-id":b.rule_id}))});k.length&&(e=!0,d.ipv4={"firewall-acl-rule":k});h.length&&(e=!0,d.ipv6={"firewall-acl-rule":h});e?b.post({method:"del_access_rules",params:{"firewall-acl-rules":d},success:function(a){B()},error:function(a){B()}}):B()},add:function(b){if(!F(b)){var d={},g,e,k;I(b);
"IPv4"===b?(g=a.model.ipv4_acls,h++,k=h):(g=a.model.ipv6_acls,p++,k=p);angular.forEach(g,function(a){d[a.rule_id]=!0});for(g=1;200>=g;g++)if(!d[g]){e=g;break}B(c({"rule-id":e,priority:k},b));D=-1;a.currPage=C.edit;a.modified()}},edit:function(b){var c,d;"IPv4"===b?(b=a.model.ipv4_acls,c=a.model.ipv4_selects):(b=a.model.ipv6_acls,c=a.model.ipv6_selects);1===c.length&&(d=c[0].rule_id,angular.forEach(b,function(a,b){a.rule_id===d&&(D=b,B(a))}),a.currPage=C.edit)},del:function(b){var c,d={};"IPv4"===
b?(b=a.model.ipv4_acls,c=a.model.ipv4_selects):(b=a.model.ipv6_acls,c=a.model.ipv6_selects);angular.forEach(c,function(a){d[a.rule_id]=!0});for(c=b.length-1;0<=c;c--)d[b[c].rule_id]&&b.splice(c,1);k();a.modified()},restoreToDefault:function(){var c={},d=[],g=[],e=a.DICT("Access_Rules_Confirm");q.confirm(e)&&(angular.forEach(a.model.origIPv4Acls,function(a){!1===a.default_value&&d.push({"rule-id":a.rule_id})}),angular.forEach(a.model.origIPv6Acls,function(a){!1===a.default_value&&g.push({"rule-id":a.rule_id})}),
d.length&&(c.ipv4={"firewall-acl-rule":d}),g.length&&(c.ipv6={"firewall-acl-rule":g}),b.post({method:"del_access_rules",params:{"firewall-acl-rules":c},success:function(b){a.success=!0;E();a.resetModified()},error:function(b){E();a.resetModified()}}))},serviceManagement:function(){Log(INFO,"serviceManagement");app.TOOLS.jumpToPage("System_Config_Service_Management")},cancel:function(b){a.currPage=C.main;a.resetModified()},table:{up:function(b){return function(c){var d,g;d="IPv4"===b?a.model.ipv4_acls:
a.model.ipv6_acls;0!==c&&(g=d[c-1].priority,d[c-1].priority=d[c].priority,d[c].priority=g,g=d[c-1],d[c-1]=d[c],d[c]=g,k())}},down:function(b){return function(c){var d,g;d="IPv4"===b?a.model.ipv4_acls:a.model.ipv6_acls;!(c+1>=d.length)&&!0!==d[c+1].default_value&&(g=d[c+1].priority,d[c+1].priority=d[c].priority,d[c].priority=g,g=d[c+1],d[c+1]=d[c],d[c]=g,k())}},edit:function(b){return function(c){var d;d="IPv4"===b?a.model.ipv4_acls:a.model.ipv6_acls;D=c;B(d[c]);a.currPage=C.edit}},del:function(b){return function(c){("IPv4"===
b?a.model.ipv4_acls:a.model.ipv6_acls).splice(c,1);k()}},jumpto:function(b){return function(c){var d,g,e;"IPv4"===b?(d=a.model.ipv4_acls,g=a.model.ipv4_defaults):(d=a.model.ipv6_acls,g=a.model.ipv6_defaults);s.open({animation:a.animationsEnabled,templateUrl:"access_rule_jump.htm",controller:"jumpCtrl",size:"sm",backdrop:"static",resolve:{max:function(){return d.length-g.length},type:function(){return b},id:function(){return c}}}).result.then(function(a){e=d[c].priority;d[c].priority=d[a-1].priority;
d[a-1].priority=e;e=d[c];d.splice(c,1);d.splice(a-1,0,e);I(b,!0);k()},function(a){})}}}};a.jumpToSchedule=function(){l.put("prevACLCache",{addEditItem:angular.copy(a.model.addEditItem),addEditIdx:D});l.put("jumpFromACL",{});n.url("System_Config_Schedules/")};a.model.scheme={actionList:[{id:!0,displayName:a.DICT("Access_Rules_Allow")},{id:!1,displayName:a.DICT("Access_Rules_Deny")}],logList:[{id:!1,displayName:a.DICT("Access_Rules_Never")},{id:!0,displayName:a.DICT("Access_Rules_True")}],addrTypeList:[{id:"any",
displayName:a.DICT("Access_Rules_Any")},{id:"single",displayName:a.DICT("Access_Rules_Single_IP")},{id:"range",displayName:a.DICT("Access_Rules_IP_Range")},{id:"subnet",displayName:a.DICT("Access_Rules_Subnet")}]};E()}]);
app.controller("jumpCtrl",["$scope","$uibModalInstance","UserSession","userAccessRight","max","type","id",function(a,b,s,n,v,t,m){a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();a.jump="";a.max=v;a.id=m;a.funs={save:function(){b.close(a.jump)},cancel:function(){b.dismiss("cancel")}}}]);app.controller("port_forwarding_main",["$scope","$q","$location","rpcFns","MyHttp","$timeout","$filter","GridRowBasedEditingOper","$templateCache","Sets","wan_service","UserSession","userAccessRight","sslvpn_port_vld",function(a,b,s,n,v,t,m,q,e,w,l,h,p,u){a.model=a.model||{};a.ctx=a.ctx||{};a.success=!1;a.dataReady=!1;a.services=[];a.interfaces=[];a.origRules=[];a.forcedUsingPost=!0;var x={procBackground:!1,forcedUsingPost:a.forcedUsingPost};a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==
a.userAccessFlag&&h.logout();var r=function(){var c=v.post({url:resource_base+"data/port_forwarding.json",method:"get_port_forwarding",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),e=v.post({url:resource_base+"data/service_management.json",method:"get_services",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,e,u.init()]).then(function(b){a.model={};a.interfaces=[];a.services=[];angular.extend(a.model,b[0].data.result);
angular.extend(a.model,b[1].data.result);d();a.schema=a.schema||{};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};angular.forEach(a.model.interfaces["interface"],function(b){a.interfaces.push({id:b.name,displayName:b.name})});angular.forEach(a.getTCPUDPService(),function(b){a.services.push({id:b.name,displayName:b.name})});angular.forEach(a.model["port-forwarding-rules"]["port-forwarding-entry"],function(b){b.external_service={select:b["external-service"],list:angular.copy(a.services)};
b.internal_service={select:b["internal-service"],list:angular.copy(a.services)};b.interface_t={select:b["interface"],list:angular.copy(a.interfaces)}});a.gridPortFW.Options.data=a.model["port-forwarding-rules"]["port-forwarding-entry"];a.gridUpnpPortFW.Options.data=a.model["upnp-port-forwarding-rules"]["upnp-port-forwarding-entry"];a.origRules=angular.copy(a.model["port-forwarding-rules"]["port-forwarding-entry"]);a.gridPortFW.Selections=[];a.gridUpnpPortFW.Selections=[];setTimeout(function(){a.gridPortFW.Options.gridApi&&
a.gridPortFW.Options.gridApi.customApi&&a.gridPortFW.Options.gridApi.customApi.checkSelectStatus()},10);a.dataReady=!0;a.resetModified()})};r();var d=function(){a.model["port-forwarding-rules"]||angular.extend(a.model,{"port-forwarding-rules":{"port-forwarding-entry":[]}});a.model["upnp-port-forwarding-rules"]||angular.extend(a.model,{"upnp-port-forwarding-rules":{"upnp-port-forwarding-entry":[]}});a.port_sample={invalid:!1,service_invalid_d:!1,service_invalid:!1,checked:!1,edit:!1};angular.forEach(a.model["port-forwarding-rules"]["port-forwarding-entry"],
function(b){w.recover_object(b,a.port_sample)});a.upnp_sample={checked:!1};angular.forEach(a.model["upnp-port-forwarding-rules"]["upnp-port-forwarding-entry"],function(b){w.recover_object(b,a.upnp_sample)});a.filterWAN_WANsub={physical:!0,subinterface:!0,usb:!0};a.model.interfaces["interface"]=l.filter(a.model.interfaces["interface"],a.filterWAN_WANsub);a.model.interfaces["interface"].unshift({name:"Any"})};a.jumpToServcieManagement=function(){app.TOOLS.jumpToPage("System_Config_Service_Management")};
var c=function(a,b,c){return a.protocol.match(/^(TCP|UDP|TCP_UDP|ALL)$/)?!0:!1};a.getTCPUDPService=function(){return m("filter")(a.model.services.service,c)};a.T_cellEdit=e.get("T_editWithNoFoucs_by_rowEditableState_objs.html");a.selected=a.selected||{};a.gridPortFW=a.gridPortFW||{};a.gridPortFW.Selections=[];a.gridPortFW.refresh=!0;a.gridUpnpPortFW=a.gridUpnpPortFW||{};a.gridUpnpPortFW.Selections=[];a.idTrue=!0;a.idFalse=!1;a.gridPortFW.procNgClick=function(b){a.gridPortFW.Selections=[];a.model["port-forwarding-rules"]&&
angular.forEach(a.model["port-forwarding-rules"]["port-forwarding-entry"],function(b,c){b.checked?a.gridPortFW.Selections.push(b):b.edit=!1})};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};var k=function(b){b=b.entity;var c;b.service_invalid_d=!1;b.invalid||(b.service_invalid=!1);b.status&&(c=u.check_port_forwarding_service(b.external_service.select),c.valid||(b.service_invalid_d=!0,b.service_invalid=!0,b=u.get_err_html(c.err),app.TOOLS.criticalAlertBox({title:a.DICT("Error"),
msg:b})))};a.gridPortFW.Options=app.uiGrid.generateGridOptions({IDPreifx:"portforwarding_table",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridPortFW.procNgClick,disableChkBoxField:"disableChk",headerChangedCbk:a.gridPortFW.procNgClick},{field:"status",displayName:a.DICT("Port_Forwarding_Enable"),width:70,editRow:"edit",cellTemplate:e.get("UG_table_checkbox_with_inline_edit.html"),changedCbk:function(a,b){k(b)}},{field:"external_service",displayName:a.DICT("Port_Forwarding_External_Service"),
editRow:"edit",invalidField:"service_invalid",customVldCbk:"gridPortFW.keyValidCbk",validationCbk:"gridInvalidCbk",cellTemplate:e.get("UG_table_text_with_inline_select_edit.html"),change:k,id:"portforwarding_table_exts",customVldGroup:"1"},{field:"internal_service",displayName:a.DICT("Port_Forwarding_Internal_Service"),editRow:"edit",cellTemplate:e.get("UG_table_text_with_inline_select_edit.html"),id:"portforwarding_table_ins"},{field:"ipaddress",displayName:a.DICT("Port_Forwarding_Internal_IP_Addr"),
validationCbk:"gridInvalidCbk",editRow:"edit",cellTemplate:e.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"required ipv4-ip"),required:!0,id:"portforwarding_table_ipaddr"},{field:"interface_t",displayName:a.DICT("Port_Forwarding_Interfaces"),editRow:"edit",invalidField:"invalid",customVldCbk:"gridPortFW.keyValidCbk",validationCbk:"gridInvalidCbk",cellTemplate:e.get("UG_table_text_with_inline_select_edit.html"),id:"portforwarding_table_infs"}]});a.gridUpnpPortFW.procNgClick=
function(b){a.gridUpnpPortFW.Selections=[];angular.forEach(a.model["upnp-port-forwarding-rules"]["upnp-port-forwarding-entry"],function(b,c){b.checked?a.gridUpnpPortFW.Selections.push(b):b.edit=!1})};a.gridUpnpPortFW.Options=app.uiGrid.generateGridOptions({IDPreifx:"upnpforwarding_table",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridUpnpPortFW.procNgClick},{field:"external-service",displayName:a.DICT("Port_Forwarding_External_Service")},{field:"internal-service",displayName:a.DICT("Port_Forwarding_Internal_Service")},
{field:"ipaddress",displayName:a.DICT("Port_Forwarding_Internal_IP_Addr")},{field:"interface",displayName:a.DICT("Port_Forwarding_Interfaces")},{field:"status",displayName:a.DICT("Port_Forwarding_Status"),cellTemplate:e.get("UG_table_checkbox_with_inline_edit.html")}]});a.gridUpnpPortFW.selRow=function(b,c){a.gridUpnpPortFW.operations.selRow(b,c)};a.gridPortFW.selRow=function(b,c){a.gridPortFW.operations.selRow(b,c)};a.gridPortFW.keyValidCbk=function(b,c,d){var e=a.gridPortFW.Options.data,k=e.length,
h,r;c=function(a,b,c){if(!(0>b||b>k))if(!(0>c||c>k))for(h=b;h<k;h++)if((r=e[h])&&r!==a&&r.external_service.select===a.external_service.select&&r.interface_t.select===a.interface_t.select)r.invalid=!0,a.invalid=!0,r.service_invalid=!0};angular.forEach(e,function(a){a.invalid=!1;a.service_invalid_d||(a.service_invalid=!1)});for(b=0;b<k;b++)e[b]&&c(e[b],b+1,b)};a.ifNamed=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};a.add=function(){if(100<=a.gridPortFW.Options.data.length)a.msg=
a.DICT("Port_Forwarding_Reach_Max_Entry",{"%d":100}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}});else{var b={checked:!0,invalid:!1,service_invalid_d:!1,service_invalid:!1,"external-service":"All Traffic","interface":"WAN1",ipaddress:"","internal-service":"All Traffic",edit:!0,status:!0,interface_t:{select:"WAN1",list:angular.copy(a.interfaces)},internal_service:{select:"All Traffic",list:angular.copy(a.services)},external_service:{select:"All Traffic",list:angular.copy(a.services)}};
a.gridPortFW.Options.data.push(b);a.gridPortFW.Options.gridApi.customApi.scrollTo(a.gridPortFW.Options.data.length-1);a.gridPortFW.keyValidCbk();a.modified()}};a.gridPortFW.post_remove_cb=function(b,c,d){t(function(){a.gridPortFW.refresh=!0},0)};a.gridPortFW.remove=function(){var b,c;a.gridPortFW.refresh=!1;void 0===a.model["port-forwarding-rules"]||void 0===a.model["port-forwarding-rules"]["port-forwarding-entry"]?(b=[],c=0):(b=a.model["port-forwarding-rules"]["port-forwarding-entry"],c=b.length);
for(c-=1;0<=c;c--)b[c].checked&&b.splice(c,1);t(function(){a.gridPortFW.refresh=!0},0);a.gridPortFW.keyValidCbk();a.modified()};a.gridPortFW.edit=function(){angular.forEach(a.gridPortFW.Options.data,function(a){a.checked&&(a.edit=!0)})};a.RPC_delete_upnp=function(){var b=function(a,b,c){a=c.code;switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");break;default:console.log(b+": RPC done. got unknown code: "+a)}},c,d=a.gridUpnpPortFW.Selections?a.gridUpnpPortFW.Selections.length:0,e={};
for(c=0;c<d;c++)e=a.gridUpnpPortFW.Selections[c]||{},n.RPC_generic_send("delete-upnp-rule",{"external-service":e["external-service"],"internal-service":e["internal-service"],ipaddress:e.ipaddress},b,void 0,x)};a.save=function(){var b=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){angular.isDefined(a.internal_service)&&(a["internal-service"]=a.internal_service.select,delete a.internal_service);angular.isDefined(a.external_service)&&(a["external-service"]=a.external_service.select,delete a.external_service);
angular.isDefined(a.interface_t)&&(a["interface"]=a.interface_t.select,delete a.interface_t);angular.isDefined(a.invalid)&&delete a.invalid;angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.edit)&&delete a.edit;angular.isDefined(a.disableChk)&&delete a.disableChk});return a}(a.model["port-forwarding-rules"]["port-forwarding-entry"]),c=function(){v.post({url:resource_base+"data/port_forwarding.json",method:"set_port_forwarding",params:{"port-forwarding-rules":{"port-forwarding-entry":b}},
success:function(b){a.success=!0;r();a.config_saved=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);r()}})};(function(){var b=a.model["port-forwarding-rules"]["port-forwarding-entry"],d=[],g;angular.forEach(a.origRules,function(a){g=!1;angular.forEach(b,function(b){a.external_service.select===b.external_service.select&&a.interface_t.select===b.interface_t.select&&(g=!0)});g||d.push({"external-service":a.external_service.select,"interface":a.interface_t.select})});
d.length?v.post({url:resource_base+"data/port_forwarding.json",method:"del_port_forwarding",params:{"port-forwarding-rules":{"port-forwarding-entry":d}},success:function(a){c()},error:function(a){c();console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}):c()})()};a.cancel=function(){r()}}]);app.controller("networkAddressTranslationCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,s,n){a.success=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var v=function(){b.post({url:resource_base+"data/wan_setting1.json",method:"get_nat",success:function(a){t(a.data.result)},error:function(a){t();console.log("networkAddressTranslationCtrl Error Status: "+a.status)}})},t=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var q=
[],e=[];a.model.ifs=[];angular.forEach(b,function(a,b){void 0===a.name||(void 0===a.nat||void 0===a.nat.enable)||(a.name.match(/^WAN\d+($|\.\d+$)/)&&q.push({edit:!0,name:a.name,nat:a.nat.enable,orig_nat:a.nat.enable}),a.name.match(/^USB\d+/)&&e.push({edit:!0,name:a.name,nat:a.nat.enable,orig_nat:a.nat.enable}))});a.model.ifs=q.concat(e);a.gridNATOptions.data=a.model.ifs;a.dataReady=!0};a.dataReady=!1;a.model={ifs:[]};a.fun={save:function(){var m={interfaces:{"interface":[]}},q=[];angular.forEach(a.model.ifs,
function(a,b){m.interfaces["interface"].push({name:a.name,nat:{enable:a.nat}});a.nat&&!a.orig_nat&&q.push({name:a.name,enabled:!1,passive:!0})});q.length&&b.post({method:"set_rip",params:{routing:{"routing-instance":[{name:"local","routing-protocols":{"routing-protocol":[{type:"ripv1",name:"rip",rip:{ripv1:{interfaces:{"interface":q}}}},{type:"ripv2",name:"rip",rip:{ripv2:{interfaces:{"interface":q}}}}]}}]}}});b.post({method:"set_nat",params:m,success:function(b){a.success=!0;v();a.resetModified()},
error:function(b){v();a.resetModified()}})},cancel:function(){v();a.resetModified()}};a.gridNATOptions=app.uiGrid.generateGridOptions({data:a.model.ifs,columnDefs:[{field:"name",displayName:a.DICT("Network_Address_Translation_Interface")},{field:"nat",displayName:a.DICT("Network_Address_Translation_Enable_NAT"),id:"nattable",cellTemplate:"UG_table_checkbox_with_inline_edit.html",editRow:"edit"}]});v()}]);app.controller("poeCtrl",["$scope","MyHttp","$q","$uibModal","UserSession","userAccessRight","modelInfo",function(a,b,s,n,v,t,m){a.success=!1;var q="";0<=m.get_pid().search("RV345P")&&(q="POE");a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var e=function(){return b.post({url:resource_base+"data/poe.json",method:"get_poe",error:function(a){Log(ERROR,"poeCtrl getPoESettingData error status: "+a.status);w()}})},w=function(b){var c=/^LAN(\d+)$/;b||(b={});var d=
[],g=b["global-poe-setting"]||{},e=[],k;a.model.poe_setting={legacy:void 0!==g.legacy?g.legacy:!1,snmp_trap_enable:void 0!==g["snmp-trap-enable"]?g["snmp-trap-enable"]:!1,power_mode:g["power-mode"]||"port-limit",power_trap_thread:g["power-trap-thread"]||95};a.model.ori_poe_setting=angular.copy(a.model.poe_setting);b.interfaces&&b.interfaces["interface"]&&(d=b.interfaces["interface"]);a.model.lans=[];angular.forEach(d,function(a,b){if(a.name&&a["poe-setting"]&&(k=c.exec(a.name)))b=parseInt(k[1],10),
isNaN(b)||(e[b]=l(a))});a.model.ori=[];angular.forEach(e,function(b,c){a.model.ori.push(b)});"POE"===q?angular.forEach(e,function(b,c){switch(c){case 1:case 2:case 3:case 4:case 9:case 10:case 11:case 12:a.model.lans.push(b)}}):angular.forEach(e,function(b,c){a.model.lans.push(b)});a.gridPortLimitOptions.data=a.model.lans;a.gridClassLimitOptions.data=a.model.lans},l=function(a){a||(a={});var b=a["poe-setting"]||{},c={name:a.name||"",enable:!1,type:"port-limit",priority:"low",administration_power_allocation:3E4,
state:u()};angular.forEach(b,function(a,b){switch(b){case "enable":c.enable=!0===a;break;case "class-limit":c.type="class-limit";break;case "administration-power-allocation":c.type="port-limit";c.administration_power_allocation=isNaN(parseInt(a,10))?3E4:parseInt(a,10);break;case "priority-level":c.priority=a;break;default:Log(INFO,"poeCtrl genPoEIntfSetting, no process leaf: "+b+" , value: "+a)}});c.state.enable=c.enable?"Enable":"Disable";return c},h=function(){return b.post({url:resource_base+"data/poe_state.json",
method:"get_poe_state",error:function(a){Log(ERROR,"poeCtrl getPoEStateData Error Status "+a.status);p()}})},p=function(b){b||(b={});var c=[],d=b["poe-state"]||{},g="";d.microsemi&&"vop"===d.microsemi["error-code"]&&(g="*");a.model.poe_state=[{operation_status:function(a){var b="";"normal"===a?b="Normal":"fault"===a&&(b="Fault");return b}(d["operation-status"])+g,nominal_power:(d["nominal-power"]||0)+"w",consumed_power:(d["consumed-power"]||0)+"w",allocated_power:(d["allocated-power"]||0)+"w",available_power:(d["available-power"]||
0)+"w"}];a.gridProperiesOptions.data=a.model.poe_state;b["interfaces-state"]&&b["interfaces-state"]["interface"]&&(c=b["interfaces-state"]["interface"]);a.model.poe_lan_state={};angular.forEach(c,function(b){b.name&&(a.model.poe_lan_state[b.name]=u(b))})},u=function(a){a||(a={});a=a["poe-state"]||{};return{administration_power_allocation:void 0!==a["administration-power-allocation"]?a["administration-power-allocation"]:0,"class":void 0!==a["class"]?a["class"]:0,max_power:void 0!==a["max-power"]?a["max-power"]:
0,consumed_power:void 0!==a["consumed-power"]?a["consumed-power"]:0,overload_counter:void 0!==a["overload-counter"]?a["overload-counter"]:0,absent_counter:void 0!==a["absent-counter"]?a["absent-counter"]:0,short_counter:void 0!==a["short-counter"]?a["short-counter"]:0,denied_counter:void 0!==a["denied-counter"]?a["denied-counter"]:0,invalid_signature_counter:void 0!==a["invalid-signature-counter"]?a["invalid-signature-counter"]:0,poe_standard:a["poe-standard"]||"802.3AT"}},x=function(){angular.forEach(a.model.lans,
function(b){a.model.poe_lan_state[b.name]&&angular.extend(b.state,a.model.poe_lan_state[b.name])})},r=function(){s.all([e(),h()]).then(function(b){w(b[0]&&b[0].data&&b[0].data.result);p(b[1]&&b[1].data&&b[1].data.result);x();a.dataReady=!0})},d={main:"main","class":"class",port:"port"},c=function(){n.open({animation:a.animationsEnabled,templateUrl:"edit_port_limit.htm",controller:"editPortClassCtrl",backdrop:"static",resolve:{model:function(){return a.model},edit:function(){return a.edit}}}).result.then(function(b){a.edit=
b;a.funs.apply("edit_port")},function(a){})},k=function(){n.open({animation:a.animationsEnabled,templateUrl:"edit_class_limit.htm",controller:"editPortClassCtrl",backdrop:"static",resolve:{model:function(){return a.model},edit:function(){return a.edit}}}).result.then(function(b){a.edit=b;a.funs.apply("edit_class")},function(a){})},g=function(){a.edit=angular.copy(a.model.lans[a.model.selectIdx]);a.edit.state.enable="Enable"===a.edit.state.enable?!0:!1;var b=a.edit;angular.forEach(a.model.lans[a.model.selectIdx],
function(a,c){b[c]=a})};v=function(b){a.model.selectIdx=b};a.dataReady=!1;a.currPage=d.main;a.schema={};a.model={selectIdx:-1,lans:[],poe_setting:{},poe_state:[],poe_lan_state:{},ori:[],ori_poe_setting:[]};a.gridApi={port_limit:null,class_limit:null,main:null};a.success=!1;a.edit={};a.gridProperiesOptions=app.uiGrid.generateGridOptions({minRowsToShow:1,enableSorting:!1,enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,onRegisterApi:function(b){a.gridApi.main=b},columnDefs:[{field:"operation_status",
displayName:a.DICT("PoE_Settings_Operational_Status")},{field:"nominal_power",displayName:a.DICT("PoE_Settings_Nominal_Power")},{field:"consumed_power",displayName:a.DICT("PoE_Settings_Consumed_Power")},{field:"allocated_power",displayName:a.DICT("PoE_Settings_Allocated_Power")},{field:"available_power",displayName:a.DICT("PoE_Settings_Available_Power")}]});a.gridPortLimitOptions=app.uiGrid.generateGridOptions({enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,onRegisterApi:function(b){a.gridApi.port_limit=
b},columnDefs:[{name:"radio",isRadio:!0,cellTemplate:"UGRadioSelectTemplate.html",width:25,changedCbk:v},{field:"name",displayName:a.DICT("PoE_Settings_Port_N")},{field:"enable",displayName:a.DICT("PoE_Settings_Enable"),editable:!0,cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"priority",displayName:a.DICT("PoE_Settings_Power_Priority_Level_N")},{field:"state.administration_power_allocation",displayName:a.DICT("PoE_Settings_Administrative_Power_Allocation_MW")},{field:"state.max_power",
displayName:a.DICT("PoE_Settings_Max_Power_Allocation_MW")},{field:"state.consumed_power",displayName:a.DICT("PoE_Settings_Power_Consumption_MW")},{field:"state.class",displayName:a.DICT("PoE_Settings_Class_N")}]});a.gridClassLimitOptions=app.uiGrid.generateGridOptions({enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,onRegisterApi:function(b){a.gridApi.class_limit=b},columnDefs:[{name:"radio",isRadio:!0,cellTemplate:"UGRadioSelectTemplate.html",width:25,changedCbk:v},{field:"name",displayName:a.DICT("PoE_Settings_Port_N")},
{field:"enable",displayName:a.DICT("PoE_Settings_Enable"),editable:!0,cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"priority",displayName:a.DICT("PoE_Settings_Power_Priority_Level_N")},{field:"state.max_power",displayName:a.DICT("PoE_Settings_Max_Power_Allocation_MW")},{field:"state.consumed_power",displayName:a.DICT("PoE_Settings_Power_Consumption_MW")},{field:"state.class",displayName:a.DICT("PoE_Settings_Class_N")}]});a.funs={goTo:function(b){d[b]?(a.success=!1,a.currPage=d[b]):
a.currPage=d.main},apply:function(c){var d,g,e,k,h=a.DICT("PoE_Settings_Confirm"),l=function(){switch(c){case "main":d=[];e={};angular.forEach(a.model.lans,function(a){e[a.name]=a});"class-limit"===a.model.poe_setting.power_mode?angular.forEach(a.model.ori,function(a){k={name:a.name,"poe-setting":{"class-limit":null}};e[a.name]&&(k["poe-setting"].enable=e[a.name].enable);d.push(k)}):angular.forEach(a.model.ori,function(a){k={name:a.name,"poe-setting":{"administration-power-allocation":a.administration_power_allocation}};
e[a.name]&&(k["poe-setting"].enable=e[a.name].enable);d.push(k)});g={"global-poe-setting":{legacy:a.model.poe_setting.legacy,"snmp-trap-enable":a.model.poe_setting.snmp_trap_enable,"power-mode":a.model.poe_setting.power_mode,"power-trap-thread":a.model.poe_setting.power_trap_thread},interfaces:{"interface":d}};break;case "edit_port":"class-limit"===a.model.ori_poe_setting.power_mode?(d=[],angular.forEach(a.model.ori,function(b){b.name===a.edit.name?d.push({name:a.edit.name,"poe-setting":{enable:a.edit.enable,
"administration-power-allocation":a.edit.administration_power_allocation,"priority-level":a.edit.priority}}):d.push({name:b.name,"poe-setting":{enable:b.enable,"administration-power-allocation":b.administration_power_allocation}})}),g={"global-poe-setting":{"power-mode":"port-limit"},interfaces:{"interface":d}}):(d=[],angular.forEach(a.model.lans,function(b){b.name===a.edit.name?d.push({name:a.edit.name,"poe-setting":{enable:a.edit.enable,"administration-power-allocation":a.edit.administration_power_allocation,
"priority-level":a.edit.priority}}):d.push({name:b.name,"poe-setting":{enable:b.enable}})}),g={interfaces:{"interface":d}});break;case "edit_class":"port-limit"===a.model.ori_poe_setting.power_mode?(d=[],angular.forEach(a.model.ori,function(b){b.name===a.edit.name?d.push({name:a.edit.name,"poe-setting":{enable:a.edit.enable,"class-limit":null,"priority-level":a.edit.priority}}):d.push({name:b.name,"poe-setting":{"class-limit":null,enable:b.enable}})}),g={"global-poe-setting":{"power-mode":"class-limit"},
interfaces:{"interface":d}}):(d=[],angular.forEach(a.model.lans,function(b){b.name===a.edit.name?d.push({name:a.edit.name,"poe-setting":{enable:a.edit.enable,"class-limit":null,"priority-level":a.edit.priority}}):d.push({name:b.name,"poe-setting":{enable:b.enable}})}),g={interfaces:{"interface":d}})}g&&b.post({url:resource_base+"data/poe.json",method:"set_poe",params:g,success:function(b){a.success=!0;r();a.resetModified()},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url);
r()}})};a.model.poe_setting.power_mode!==a.model.ori_poe_setting.power_mode?app.TOOLS.warningAlertBox({msg:h,cbk:function(b){b?l():a.model.poe_setting.power_mode=a.model.ori_poe_setting.power_mode}}):l()},cancel:function(b){a.currPage=d.main;r();a.resetModified()},edit:function(b){a.success=!1;"port"==b?(g(),c()):"class"==b&&(g(),k())}};a.switchRadio=function(){a.model.selectIdx=-1};a.schema={power_mode:[{id:"port-limit",displayName:a.DICT("PoE_Settings_Port_Limit")},{id:"class-limit",displayName:a.DICT("PoE_Settings_Class_Limit")}]};
r()}]);app.controller("editPortClassCtrl",["$scope","$uibModalInstance","model","edit",function(a,b,s,n){a.model=s;a.edit=n;a.funs={save:function(){b.close(a.edit)},cancel:function(){b.dismiss("cancel")}}}]);app.controller("lan_dns_db_main",["$scope","$rootScope","$log","MyHttp","$http","ngGridCellBuilder","GridRowBasedEditingAdv","$templateCache","UserSession","userAccessRight","Sets",function(a,b,s,n,v,t,m,q,e,w,l){a.model={dns:{dns:[]}};a.success=!1;a.loadReady=!1;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();var h=function(){n.post({url:resource_base+"data/lan_dns_db.json",method:"get_dns_db",success:function(b){p(b);a.loadReady=!0},error:function(b){console.log("AJAX loading error: "+
b.status+", URL: "+b.config.url);a.loadReady=!0}});a.resetModified()};h();var p=function(b){angular.extend(a.model,b.data.result);a.model.dns||angular.extend(a.model,{dns:{enable:!1,dns:[]}});a.model.dns&&!a.model.dns.dns&&angular.extend(a.model.dns,{dns:[]});a.use_dns_sample={edit:!1,invalid:!1,host:"",ip:"",checked:!1};angular.forEach(a.model.dns.dns,function(b){l.recover_object(b,a.use_dns_sample)});a.gridDNSDB.Options.data=a.model.dns.dns;a.model_orig=angular.copy(a.model)};a.gridDNSDB=a.gridDNSDB||
{};a.gridDNSDB.Selections=[];a.gridDNSDB.procNgClick=function(b){a.gridDNSDB.Selections=[];angular.forEach(a.model.dns.dns,function(b,e){b.checked?a.gridDNSDB.Selections.push({rowIndex:e,entity:b}):b.edit=!1})};a.checkHostNameIsRepeat=function(){var b=a.model.dns.dns,e=b.length,h,d;angular.forEach(b,function(a){a.invalid=!1});for(h=0;h<e;h++)for(d=h+1;d<e;d++)b[h].host===b[d].host&&(b[h].invalid=!0,b[d].invalid=!0)};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridDNSDB.Options=
app.uiGrid.generateGridOptions({IDPreifx:"DNSLocalDB",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridDNSDB.procNgClick,disableChkBoxField:"disableChk",headerChangedCbk:a.gridDNSDB.procNgClick},{field:"host",displayName:a.DICT("DNS_Local_Database_Host_Name"),id:"DNSLocalDBHostName",validationCbk:"gridInvalidCbk",customVldCbk:"checkHostNameIsRepeat",editRow:"edit",invalidField:"invalid",required:!0,cellTemplate:q.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/g,'required host-name-num maxlength="63"')},
{field:"ip",displayName:a.DICT("DNS_Local_Database_Addr"),id:"DNSLocalDBIP",validationCbk:"gridInvalidCbk",cellTemplate:q.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/g,"required ip "),editRow:"edit",required:!0}]});a.gridDNSDB.add=function(){var b=a.model.dns.dns,e;100<=b.length?(b=a.DICT("DNS_Local_Reach_Max_Entry",{"%d":100}),app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})):(e={checked:!1,edit:!1,invalid:!1,host:"",ip:"",checked:!0,edit:!0},b.push(e),a.gridDNSDB.Options.gridApi.customApi.scrollToLast(),
a.modified())};a.gridDNSDB.edit=function(){angular.forEach(a.model.dns.dns,function(a){a.checked&&(a.edit=!0)})};a.gridDNSDB.del=function(){var b=a.model.dns.dns,e;if(b){e=b.length;for(e-=1;0<=e;e--)b[e].checked&&b.splice(e,1);a.checkHostNameIsRepeat();a.modified()}};a.save=function(){var b=[],e=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableChk)&&delete a.disableChk;delete a.edit;delete a.invalid});return a};
(function(){var e=a.model.dns.dns,d=!1,c=[];angular.forEach(a.model_orig.dns.dns,function(a){d=!1;angular.forEach(e,function(b){b.host===a.host&&(d=!0)});d||c.push({host:a.host})});c.length&&b.push({method:"del_dns_db",params:{dns:{dns:c}}})})();(function(){var h=e(a.model.dns.dns);b.push({method:"set_dns_db",params:{dns:{dns:h}}})})();n.post({url:resource_base+"data/lan_dhcp_static.json",method:"set_bulk",params:b,success:function(b){a.success=!0;h()},error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url);h()}})};a.cancel=function(){h()}}]);app.controller("lan_dhcp_settings_main",["$scope","$rootScope","$uibModal","$log","$q","MyHttp","GridRowBasedEditingAdv","$templateCache","$filter","Sets","$timeout","UserSession","userAccessRight",function(a,b,s,n,v,t,m,q,e,w,l,h,p){var u={source:"http",getResult:function(a,b,c){return w.getResult(this,a,b,c)}};a.model=a.model||{};a.ctx=a.ctx||{};a.fns=a.fns||{};a.success=!1;a.loadReady=!1;a.subnetObj={};a.spec=a.spec||{OPENDNS_SUPPORT:!0};a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==
a.userAccessFlag&&h.logout();var x=function(){var a=v.defer(),b={interfaces:{"interface":[]},"dhcp-pool":{"dhcp-interfaces":[],"dhcp-option82":[]},"dhcp-pools":{pool:[]}};t.post({url:resource_base+"data/lan_dhcp_settings.json",method:"get_dhcp_settings",success:function(c){w.default_result(c,b);a.resolve(c)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});return a.promise},r=function(){var a=v.defer(),b={"dns-servers":{ipv4:[]}};t.post({url:resource_base+"data/dns_from_isp.json",
method:"get_dns_from_isp",success:function(c){w.default_result(c,b);a.resolve(c)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});return a.promise},d=function(){var a=v.defer(),b={subnets:{ipv4:[],ipv6:[]}};t.post({url:resource_base+"data/get_subnet.json",method:"get_subnet",success:function(c){w.default_result(c,b);a.resolve(c)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});return a.promise},c=function(){var b=v.defer(),
c={opendns:{enabled:!1,v4dnsip:["208.67.222.222","208.67.220.220"]}};if(!0!==a.spec.OPENDNS_SUPPORT)return b.resolve(c),b.promise;t.post({url:resource_base+"data/opendns.json",method:"get_opendns",success:function(a){w.default_result(a,c);b.resolve(a)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});return b.promise},k=function(){v.all({DHCPSettings:x(),StateDns:r(),StateSubnet:d(),OpenDNS:c()}).then(function(b){var c=u.getResult(b.DHCPSettings,"interfaces");
a.model.interfaces={"interface":c["interface"]};c=u.getResult(b.DHCPSettings,"dhcp-pool");a.model["dhcp-pool"]={"dhcp-interfaces":c["dhcp-interfaces"],"dhcp-option82":c["dhcp-option82"]};c=u.getResult(b.DHCPSettings,"dhcp-pools");a.model["dhcp-pools"]={pool:c.pool};c=u.getResult(b.StateDns,"dns-servers");a.model["dns-servers"]={ipv4:c.ipv4,ipv6:c.ipv6};c=u.getResult(b.StateSubnet,"subnets");c&&(c.ipv4&&c.ipv6)&&(a.subnetObj=angular.copy(c));b=u.getResult(b.OpenDNS,"opendns");a.model.opendns={enabled:b.enabled,
v4dnsip:b.v4dnsip};g();a.schema=a.schema||{};z();a.model_del["dhcp-pool"]["dhcp-interfaces"].splice(0);a.model_del["dhcp-pool"]["dhcp-option82"].splice(0);a.model_del["dhcp-pools"].pool.splice(0);delete a.model_del.interfaces;delete a.model_del.dhcp_ref;a.gridDHCP.Selections=[];a.gridDHCP.Options.data=a.model.dhcp_ref;a.loadReady=!0})["catch"](function(a){console.log("=="+a)})},g=function(){a.use_dhcp_pool_sample={"dhcp-pool":{"dhcp-interfaces":[],"dhcp-option82":[]}};w.recover_object(a.model,a.use_dhcp_pool_sample);
a.use_dhcp_pools_sample={"dhcp-pools":{pool:[]}};w.recover_object(a.model,a.use_dhcp_pools_sample);if(a.model["dhcp-pools"]){var b=function(b){angular.forEach(a.model["dhcp-pools"].pool,function(a,c){a[b].dns&&!a[b].dns["static-dns-servers"]?angular.extend(a[b].dns,{"static-dns-servers":[]}):a[b].dns||(a[b].dns={"static-dns-servers":[]});a[b]["dhcp-mode"]||(a[b]["dhcp-mode"]="disable");a[b]["dns-server-type"]||(a[b]["dns-server-type"]="dns-server-proxy");"ipv4"===b&&!a[b]["network-boot"]&&(a[b]["network-boot"]=
{enabled:!1,"next-server":"","boot-file":""})})};b("ipv4");b("ipv6")}a.use_dns_from_isp_sample={"dns-servers":{ipv4:[]}};w.recover_object(a.model,a.use_dns_from_isp_sample);a.ctx.dnsFromIspRef=a.model["dns-servers"]},z=function(){var b=function(a){if(a["subnet-mask"]){var b=a["subnet-mask"].split("/")[1],b=app.TOOLS.netmask.int2Inet(parseInt(b,10));a._ctx_netmask=b}},c=app.TOOLS.sortingDHCPInterfaceFn(!1),d=a.model["dhcp-pool"]["dhcp-interfaces"],d=d.sort(c);a.model.dhcp_ref=[];angular.forEach(d,
function(b,c){angular.forEach(a.model["dhcp-pools"].pool,function(c,d){b["server-mode"]["dhcp-pool"]==c["pool-id"]&&(b._poolref=a.model["dhcp-pools"].pool[d])});b.iftype=6;b.checked=!1;a.model.dhcp_ref.push(b)});angular.forEach(a.model["dhcp-pool"]["dhcp-option82"],function(c,d){angular.forEach(a.model["dhcp-pools"].pool,function(b,d){c["dhcp-pool"]==b["pool-id"]&&(c._poolref=a.model["dhcp-pools"].pool[d])});b(c);c.iftype=7;c.checked=!1;a.model.dhcp_ref.push(c)});a.model_orig=angular.copy(a.model);
a.model_del=angular.copy(a.model)},y=function(a,b,c){return a.name.match(/^(VLAN)/)?!0:!1};a.fns.collect_VLAN_list=function(){return e("filter")(a.model.interfaces["interface"],y)};a.fns.refreshInuseVLANList=function(){a.ctx.inuseVLANList=[];angular.forEach(a.model["dhcp-pool"]["dhcp-interfaces"],function(b,c){a.ctx.inuseVLANList.push(b["interface"])})};a.fns.collect_unused_VLAN_list=function(b){var c;b&&b.sel_if&&(c=b.sel_if);var d=a.fns.collect_VLAN_list()||[];b=d;b=e("filter")(d,function(b,d,g){a.ctx.inuseVLANList||
a.fns.refreshInuseVLANList();return!(c&&b.name==c)&&a.ctx.inuseVLANList&&-1<a.ctx.inuseVLANList.indexOf(b.name)?!1:!0});d=app.TOOLS.sortingInterfaceFn(!1);return b=b.sort(d)};a.getVLANref=function(b){var c=a.fns.collect_VLAN_list(),d;angular.forEach(c,function(a,c){a.name==b&&(d=a)});return d};a.displayPrefixLen=function(b,c){var d="";if(6==b.iftype){var g=a.getVLANref(b["interface"]);g&&(g[c]&&g[c].address&&g[c].address[0]&&g[c].address[0]["prefix-length"])&&(d=g[c].address[0]["prefix-length"])}else b["subnet-mask"]&&
(d=b["subnet-mask"].split("/")[1]);return d};a.displayDNS=function(b,c){var d="",g=b.iftype,e=b._poolref[c]["dns-server-type"];if("dns-server-proxy"==e)if(6==g){if((g=a.getVLANref(b["interface"]))&&g[c]&&g[c].address&&g[c].address[0]&&g[c].address[0].ip)d=g[c].address[0].ip}else d=b["ip-address"];else"dns-server-provided-isp"==e?a.ctx.dnsFromIspRef&&(a.ctx.dnsFromIspRef[c]&&"function"==typeof a.ctx.dnsFromIspRef[c].join)&&(d=a.ctx.dnsFromIspRef[c].join(" ")):d=b._poolref[c].dns["static-dns-servers"].join(" ");
return d};a.fns.reachDHCPmaxcount=function(){var b=0,b=a.model["dhcp-pool"]["dhcp-interfaces"].length;return 32<=b?!0:!1};a.fns.reachOpt82maxcount=function(){var b=0,b=a.model["dhcp-pool"]["dhcp-option82"].length;return 50<=b?!0:!1};var A=function(){return a.fns.reachDHCPmaxcount()&&a.fns.reachOpt82maxcount()?(a.msg="Only allow maximum of Option82(50 entries) and DHCP(32 entries) for LAN/DHCP Settings.",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.selected=a.selected||{};a.gridDHCP=
a.gridDHCP||{};a.gridDHCP.Selections=[];a.gridDHCP.add=function(){A()||a.open(["",""])};a.gridDHCP.edit=function(){var b;angular.forEach(a.model.dhcp_ref,function(a,c){a.checked&&(b=c)});_.isNumber(b)?a.open(["",b]):Log(ERROR,"[LAN][DHCP Settings] edit item get error for checked index")};a.gridDHCP.procNgClick=function(b){a.gridDHCP.Selections=[];angular.forEach(a.model.dhcp_ref,function(b,c){b.checked&&a.gridDHCP.Selections.push(b)})};a.gridDHCP.Options=app.uiGrid.generateGridOptions({IDPreifx:"lanDHCP",
rowHeight:2*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridDHCP.procNgClick,headerChangedCbk:a.gridDHCP.procNgClick},{field:"interface",displayName:a.DICT("LAN_DHCP_Settings_Interface_Circuit_ID"),minWidth:320,cellTemplate:q.get("UG_Interface_CircuitID.htm")},{field:"_poolref",displayName:a.DICT("LAN_DHCP_Settings_DHCP_Mode"),minWidth:220,cellTemplate:q.get("UG_DHCP_mode.htm")},{field:"_poolref",displayName:a.DICT("LAN_DHCP_Settings_Range_Relay_Server"),cellTemplate:q.get("UG_IP_Range.htm")}]});
a.gridDHCP.remove=function(){var b=a.model.dhcp_ref,c=a.model["dhcp-pool"]["dhcp-interfaces"],d=a.model["dhcp-pool"]["dhcp-option82"],g=a.model["dhcp-pools"].pool,e=b.length,k;a.gridDHCP.Selections=[];for(e-=1;0<=e;e--)if(b[e].checked){if(void 0!==b[e]["interface"]){for(k=c.length-1;0<=k;k--)b[e]["interface"]===c[k]["interface"]&&c.splice(k,1);for(k=g.length-1;0<=k;k--)b[e]._poolref["pool-id"]===g[k]["pool-id"]&&g.splice(k,1)}if(void 0!==b[e]["circuit-id"]){for(k=d.length-1;0<=k;k--)b[e]["circuit-id"]===
d[k]["circuit-id"]&&d.splice(k,1);for(k=g.length-1;0<=k;k--)b[e]._poolref["pool-id"]===g[k]["pool-id"]&&g.splice(k,1)}b.splice(e,1)}a.fns.refreshInuseVLANList();a.modified()};a.showIPRange=function(a,b,c){c=["ipv4","ipv6"][c];if(!a)return"err";if("server"==a[c]["dhcp-mode"])return(a[c]["range-start"]||"")+"-"+(a[c]["range-end"]||"");if("relay"==a[c]["dhcp-mode"]){var d;b.entity&&(b.entity["relay-mode"]&&b.entity["relay-mode"]["relay-ipv4-address"])&&(d=b.entity["relay-mode"]["relay-ipv4-address"]);
return d||"(Relay IP undefined)"}return""};a.save=function(){function b(a){a=angular.copy(a);var c,d,g;angular.forEach(a,function(a,b){if(6==a.iftype){c="description circuit-id bitmask ip-address subnet-mask dhcp-pool".split(" ");for(d=0;d<c.length;d++)for(g in a)g==c[d]&&delete a[g]}else if(7==a.iftype){c=["interface","server-mode","relay-mode"];for(d=0;d<c.length;d++)for(g in a)g==c[d]&&delete a[g];angular.isDefined(a.bitmask)||(a.bitmask="")}a._poolref&&(a._poolref=void 0);a.iftype&&(a.iftype=
void 0);a._ctx_netmask&&(a._ctx_netmask=void 0);angular.isDefined(a.checked)&&delete a.checked});return a}var c=b(a.model["dhcp-pool"]["dhcp-interfaces"]),d=b(a.model["dhcp-pool"]["dhcp-option82"]),g=angular.copy(a.model["dhcp-pools"].pool);angular.forEach(g,function(a){a.ipv4["network-boot"].enabled||(a.ipv4["network-boot"]["boot-file"]="",a.ipv4["network-boot"]["next-server"]="")});var e=function(){t.post({url:resource_base+"data/lan_dhcp_settings.json",method:"set_dhcp_settings",params:{"dhcp-pool":{"dhcp-interfaces":c,
"dhcp-option82":d},"dhcp-pools":{pool:g}},success:function(b){a.success=!0;Log(DEBUG,"set_data() is ok, then getting up-to-date model data");a.config_saved=!0;k()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);console.log("Commnucation error: action set aborted");alert("Commnucation error: Action set aborted")}})};(function(){var b=a.model["dhcp-pool"]["dhcp-interfaces"],c=a.model["dhcp-pool"]["dhcp-option82"],d=a.model_orig["dhcp-pool"]["dhcp-option82"],g=
a.model["dhcp-pools"].pool,k=a.model_orig["dhcp-pools"].pool,h,A=!1,r={},y=[],z=[],B=[];angular.forEach(a.model_orig["dhcp-pool"]["dhcp-interfaces"],function(a){h=!1;angular.forEach(b,function(b){a["interface"]===b["interface"]&&(h=!0)});h||y.push({"interface":a["interface"]})});angular.forEach(d,function(a){h=!1;angular.forEach(c,function(b){console.log(a["circuit-id"]+" "+b["circuit-id"]);a["circuit-id"]===b["circuit-id"]&&(h=!0)});h||(console.log("---"),z.push({"circuit-id":a["circuit-id"]}))});
angular.forEach(k,function(a){h=!1;angular.forEach(g,function(b){a["pool-id"]===b["pool-id"]&&(h=!0)});h||B.push({"pool-id":a["pool-id"]})});if(y.length||z.length)r["dhcp-pool"]={},y.length&&(r["dhcp-pool"]["dhcp-interfaces"]=y),z.length&&(r["dhcp-pool"]["dhcp-option82"]=z),A=!0;B.length&&(r["dhcp-pools"]={pool:B},A=!0);A?t.post({url:resource_base+"data/lan_dhcp_settings.json",method:"del_dhcp_settings",params:r,success:function(a){l(function(){e()},50)},error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url);console.log("Commnucation error: action del aborted");alert("Commnucation error: Action del aborted")}}):e()})();a.resetModified()};a.cancel=function(){k();a.resetModified()};a.open=function(b){s.open({templateUrl:"modal_dhcp_edit.htm",controller:"DHCP_ModalInstanceCtrl",size:b[0],windowClass:"large-Modal",backdrop:"static",resolve:{model:function(){return a.model},index:function(){return b[1]},subnetObj:function(){return a.subnetObj},fns:function(){return a.fns}}}).result.then(function(b){a.model=
b[0];a.modified()},function(){n.info("Modal dismissed at: "+new Date)})};k()}]);
app.controller("DHCP_ModalInstanceCtrl",["$scope","$uibModalInstance","model","index","dhcpEditService","UserSession","userAccessRight","addressPoolValidate","subnetObj","fns","$timeout",function(a,b,s,n,v,t,m,q,e,w,l){a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();a.selected=a.selected||{};a.selected.tabid=0;a.selected.show_ok_btn=!1;a.selected.show_back_btn=!1;a.selected.is_edit=!1;a.data_ready=!1;a.subnetObj=e||{};a.fns=w||{};a.foucs_tab=function(b){a.selected.tabid=
b;a.selected.save=a.tabs[b].savecb;a.selected.chk_page_operator_btn()};a.selected.ok=function(){if(!a.selected.save())return 0;b.close([a.model]);return!0};a.selected.chk_page_operator_btn=function(){a.selected.show_ok_btn=!1;a.selected.show_back_btn=!0;var b=a.selected.dhcp.iftype;switch(a.selected.tabid){case 0:a.selected.show_back_btn=!1;break;case 1:a.selected.is_edit&&(a.selected.show_back_btn=!1);break;case 2:7===b&&(a.selected.show_ok_btn=!0);break;case 3:6===b&&"server"!=a.selected.dhcp._poolref.ipv6["dhcp-mode"]&&
(a.selected.show_ok_btn=!0);break;case 4:a.selected.show_ok_btn=!0}};a.selected.next=function(){var b=a.selected.tabid,e=a.selected.dhcp.iftype,l;l=b+1;switch(b){case 1:6===e&&"server"!==a.selected.dhcp._poolref.ipv4["dhcp-mode"]&&(l=b+2)}a.tabs[l].active=!0;a.foucs_tab(l)};a.selected.back=function(){var b=a.selected.tabid,e=a.selected.dhcp.iftype,l;l=b-1;switch(b){case 3:6===e&&"server"!==a.selected.dhcp._poolref.ipv4["dhcp-mode"]&&(l=b-2)}a.tabs[l].active=!0;a.foucs_tab(l)};a.selected.post_save=
function(){b.close([a.model])};a.update_subnet_mask=function(){var b=app.TOOLS.netmask.inet2Int(a.selected.dhcp._ctx_netmask);a.selected.dhcp["subnet-mask"]="0.0.0.0/"+b};a.hideByDNSType=function(a,b){return a.dhcp._poolref&&a.dhcp._poolref[b]&&("dns-server-provided-isp"==a.dhcp._poolref[b]["dns-server-type"]||"dns-server-proxy"==a.dhcp._poolref[b]["dns-server-type"])?!0:!1};a.fns.checkIfVLANExistFn=function(b){if(!arguments.length){var e=void 0,l=a.fns.collect_unused_VLAN_list({sel_if:a.selected.dhcp["interface"]})||
[];angular.forEach(l,function(b,h){b.name==a.selected.dhcp["interface"]&&(e="VLAN name exist")});return e}};a.cancel=function(){b.dismiss("cancel")};a.poolValidation=function(){var b=!0;a.tabs[2].form["range-start"].$setValidity("range",!0);a.tabs[2].form["range-end"].$setValidity("range",!0);a.tabs[2].form["range-start"].$setValidity("subnet",!0);a.tabs[2].form["range-end"].$setValidity("subnet",!0);Log(DEBUG," $scope.selected.dhcp.iftype   "+a.selected.dhcp.iftype);if(6===a.selected.dhcp.iftype){if(void 0===
a.selected.dhcp["interface"]||""===a.selected.dhcp["interface"]||void 0===a.selected.dhcp._poolref.ipv4["range-start"]||void 0===a.selected.dhcp._poolref.ipv4["range-end"]||""===a.selected.dhcp._poolref.ipv4["range-start"]||""===a.selected.dhcp._poolref.ipv4["range-end"])return!0;b=q.compareIpRange(a.selected.dhcp._poolref.ipv4["range-start"],a.selected.dhcp._poolref.ipv4["range-end"]);!1===b?(a.tabs[2].form["range-start"].$setValidity("range",!1),a.tabs[2].form["range-end"].$setValidity("range",
!1)):(b=q.poolValidateInRange("interfaces",a.selected.dhcp["interface"],"ipv4",a.subnetObj,a.selected.dhcp._poolref.ipv4["range-start"],a.selected.dhcp._poolref.ipv4["range-end"]),!1===b&&(a.tabs[2].form["range-start"].$setValidity("subnet",!1),a.tabs[2].form["range-end"].$setValidity("subnet",!1)))}else{if(void 0===a.selected.dhcp._poolref.ipv4["range-start"]||void 0===a.selected.dhcp._poolref.ipv4["range-end"]||""===a.selected.dhcp._poolref.ipv4["range-start"]||""===a.selected.dhcp._poolref.ipv4["range-end"])return!0;
b=q.compareIpRange(a.selected.dhcp._poolref.ipv4["range-start"],a.selected.dhcp._poolref.ipv4["range-end"]);!1===b&&(a.tabs[2].form["range-start"].$setValidity("range",!1),a.tabs[2].form["range-end"].$setValidity("range",!1))}return b};a.poolValidationV6=function(){var b=!0;a.tabs[4].form["range-start"].$setValidity("range",!0);a.tabs[4].form["range-end"].$setValidity("range",!0);a.tabs[4].form["range-start"].$setValidity("subnet",!0);a.tabs[4].form["range-end"].$setValidity("subnet",!0);if(void 0===
a.selected.dhcp._poolref.ipv6["range-start"]||void 0===a.selected.dhcp._poolref.ipv6["range-end"]||""===a.selected.dhcp._poolref.ipv6["range-start"]||""===a.selected.dhcp._poolref.ipv6["range-end"])return!0;b=q.compareIpRangeV6(a.selected.dhcp._poolref.ipv6["range-start"],a.selected.dhcp._poolref.ipv6["range-end"]);!1===b?(a.tabs[4].form["range-start"].$setValidity("range",!1),a.tabs[4].form["range-end"].$setValidity("range",!1)):(b=q.poolValidateInRangeV6("interfaces",a.selected.dhcp["interface"],
"ipv6",a.subnetObj,a.selected.dhcp._poolref.ipv6["range-start"],a.selected.dhcp._poolref.ipv6["range-end"]),!1===b&&(a.tabs[4].form["range-start"].$setValidity("subnet",!1),a.tabs[4].form["range-end"].$setValidity("subnet",!1)));return b};null!==n&&(a.model=s,n=parseInt(n));l(function(){var b=0;isNaN(n)||(a.selected.is_edit=!0,b=1);a.tabs[b].active=!0;a.foucs_tab(b);a.data_ready=!0},10);v.setModelSource(s);v.setSelectedSource(a,a.selected);v.run(n)}]);
app.controller("lan_dhcp_settings_dialog",["$scope",function(a){Log(DEBUG,"== Dialog");a.bitmask_len=0;a.bitmask_invalid=!1;a.selected.t_cid_mode=[{id:"ASCII"},{id:"HEX"}];a.selected.cid_mode=a.selected.t_cid_mode[0].id;a.fill_up_bitmask=function(b,s){b=b||"";var n=0;"HEX"===a.selected.cid_mode&&(s?(a.selected.dhcp["circuit-id"]="0x",n=0):(n=b&&b.length?b.length-2:0,0>n&&(n=0)),a.bitmask_len=n);a.selected.dhcp.bitmask=Array(n+1).join("F");a.chk_bitmask_len()};a.chk_bitmask_len=function(){if(a.tabs||
a.tabs[0])a.bitmask_invalid=!1,a.tabs[0].invalid=!1,"HEX"===a.selected.cid_mode&&(a.selected.dhcp.bitmask&&a.selected.dhcp.bitmask.length!==a.bitmask_len)&&(a.bitmask_invalid=!0,a.tabs[0].invalid=!0)};a.selected.t_dns_server_type=[{id:"dns-server-static",displayName:"dns-server-static"},{id:"dns-server-provided-isp",displayName:"dns-server-provided-isp"},{id:"dns-server-proxy",displayName:"dns-server-proxy"}];a.selected.t_dns_mode=[{id:"manual"},{id:"auto"}]}]);
app.service("dhcpEditService",function(){var a,b={};this.setModelSource=function(b){a=b};this.setSelectedSource=function(a,n){b=a;b.selected=n||{}};this.run=function(s){if(isNaN(s)){var n=function(){for(var b=1,e=1,w=0,l;w<a.dhcp_ref.length;w++)l=a.dhcp_ref[w],6==l.iftype?e=parseInt(l["server-mode"]&&l["server-mode"]["dhcp-pool"])||1:7==l.iftype&&(e=parseInt(l["dhcp-pool"])||1),b<e&&(b=e);for(w=0;w<a["dhcp-pools"].pool.length;w++)l=a["dhcp-pools"].pool[w],e=parseInt(l["pool-id"])||1,b<e&&(b=e);return parseInt(b)+
1}();console.assert(n,"newpoolid undefined");var v=void 0,t=b.fns.collect_unused_VLAN_list();t&&(t[0]&&t[0].name)&&(v=t[0].name);t=b.fns.reachDHCPmaxcount()?7:6;b.selected.dhcp=angular.extend({},{"interface":v,"circuit-id":"","server-mode":{"dhcp-pool":n},"relay-mode":{"relay-ipv4-address":"","relay-ipv6-address":""},"dhcp-pool":n,checked:!0,iftype:t,_poolref:{"pool-id":n,ipv4:{"lease-time":1440,"dns-server-type":"dns-server-proxy",dns:{"static-dns-servers":[]},"dhcp-mode":"server","range-start":"",
"range-end":"","wins-server":"","network-boot":{enabled:!1,"next-server":"","boot-file":""},"dhcp-options":{option43:"",option66:"",option67:"",option150:""}},ipv6:{"lease-time":1440,"dns-server-type":"dns-server-proxy","dhcp-mode":"disable",dns:{"static-dns-servers":[]},"range-start":"","range-end":""}}})}else b.selected.dhcp=angular.copy(a.dhcp_ref[s]);b.selected.index=s;b.selected.iftype_desc_t={6:"IPv4",7:"Option 82"};b.selected.iftype_desc=function(){return b.selected.iftype_desc_t[b.selected.dhcp.iftype]};
var m=function(a,e){var w=b.selected.dhcp["dhcp-pool"]||b.selected.dhcp["server-mode"]["dhcp-pool"],l=b.selected.dhcp.iftype,h=-1;void 0==w&&console.log("error: dhcp_poolid="+w);angular.forEach(a,function(a,b){6==l&&w&&w==a["dhcp-pool"]?h=b:7==l&&(w&&w==a["server-mode"]["dhcp-pool"])&&(h=b)});if(-1<h){var p=a.splice(h,1);e.push(p[0])}};b.selected.step1_next=function(){Log(DEBUG,"== step1_next");var q=b.selected.dhcp["dhcp-pool"];void 0==q&&b.selected.dhcp["server-mode"]&&(q=b.selected.dhcp["server-mode"]["dhcp-pool"]);
b.selected.dhcp["dhcp-pool"]=q;switch(b.selected.dhcp.iftype){case 6:b.selected.dhcp["circuit-id"]="";b.selected.dhcp["server-mode"]=b.selected.dhcp["server-mode"]||{};b.selected.dhcp["server-mode"]["dhcp-pool"]=q;break;case 7:b.selected.dhcp["interface"]=""}if(isNaN(s)){q=angular.copy(b.selected.dhcp);a.dhcp_ref.push(q);var e=a;e["dhcp-pools"].pool.push(q._poolref);6==q.iftype?e["dhcp-pool"]["dhcp-interfaces"].push(q):7==q.iftype&&e["dhcp-pool"]["dhcp-option82"].push(q);b.fns.refreshInuseVLANList()}else angular.extend(a.dhcp_ref[s]._poolref,
b.selected.dhcp._poolref),delete b.selected.dhcp._poolref,angular.extend(a.dhcp_ref[s],b.selected.dhcp),6==b.selected.dhcp.iftype?m(a["dhcp-pool"]["dhcp-option82"],a["dhcp-pool"]["dhcp-interfaces"]):7==b.selected.dhcp.iftype&&m(a["dhcp-pool"]["dhcp-interfaces"],a["dhcp-pool"]["dhcp-option82"]);return!0};b.displayTabTitle=function(a,e){var w="",l="vlan";6==b.selected.dhcp.iftype&&(l="vlan");7==b.selected.dhcp.iftype&&(l="opt82");switch(a){case 0:w="1. Role";break;case 1:"vlan"==l&&(w="2. Configure");
"opt82"==l&&(w="2. Configure");break;case 2:"vlan"==l&&(w="2.1 Detail");"opt82"==l&&(w="2.1 Detail");break;case 3:"vlan"==l&&(w="3. Configure (IPv6)");"opt82"==l&&(w="");break;case 4:"vlan"==l&&(w="3.1 Detail (IPv6)");"opt82"==l&&(w="");break;default:w=""+a+" "+e}return w};b.tabs=[{title:"Step1",tmpl:"dhcp_edit_step1.htm",disabled:!0,form:null,active:!0,savecb:b.selected.step1_next},{title:"Step2",tmpl:"dhcp_edit_step2.htm",disabled:!0,form:null,active:!1,savecb:b.selected.step1_next},{title:"Step2_1",
tmpl:"dhcp_edit_step2_1.htm",disabled:!0,form:null,active:!1,savecb:b.selected.step1_next},{title:"Step3",tmpl:"dhcp_edit_step3.htm",disabled:!0,form:null,active:!1,savecb:b.selected.step1_next},{title:"Step3_1",tmpl:"dhcp_edit_step3_1.htm",disabled:!0,form:null,active:!1,savecb:b.selected.step1_next}];b.check_ok=function(a){var e,w=b.selected.tabid;a[0].form&&(e=a[w].form.$valid,0===b.selected.tabid&&a[w].invalid&&(e=!1));return e}}});app.controller("lan_vlan_membership_main",["$scope","$location","$timeout","$q","MyHttp","$templateCache","$filter","wan_service","Sets","UserSession","userAccessRight","DHCP_PD","addressPoolValidate","modelInfo",function(a,b,s,n,v,t,m,q,e,w,l,h,p,u){var x={source:"dproxy",getResult:function(a,b,c){return e.getResult(this,a,b,c)}};a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.flagPortEditable=!1;a.func_flag=a.func_flag||{ipv6_pd_with_6rd:!1,ipv6_layout:"DESIGN_0",ipv6_min_prefixlen:16,ipv6_addr1:!1,ipv6_ip_prefer_isp:!1};
a.success=!1;a.loadReady=!1;a.userAccessFlag=l.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var r={"ethernetCsmacd,lan":"LAN","ethernetCsmacd,wan":"WAN","svi,vlan":"VLAN","l2vlan,vlan":"VLAN"},d=a.fop={get_ip:function(a){return a.ip},set_ip:function(a,b){a.ip=b},get_prefixlen:function(a){return a.prefix_length},set_prefixlen:function(a,b){a.prefix_length=b},get_origin_mode:function(a){var b;a&&null===a["static"]?b="STATIC":a&&a.isp&&(b="ISP");return b},set_origin_mode:function(a,
b,c){"STATIC"===b?(a["static"]=null,a.isp=void 0):angular.isDefined(c.wan_ifname)?"ISP"===b&&(a["static"]=void 0,a.isp={"interface":c.wan_ifname,prefix_name:c.prefix_name}):(a["static"]=null,a.isp=void 0)},get_identifier:function(a){var b;a&&null===a.eui_64?b="EUI_64":a&&a.user_define&&(b="USER_DEFINE");return b},set_identifier:function(b){var c=b._type_if_ident,d=a.func_flag.ipv6_min_prefixlen||16,g=function(a,b){angular.isDefined(a)||(a="");a.match(/::/)||(a="::"+a);var c=app.TOOLS.validation.ipv6_getNet("ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff",
b),d="",d=A.parseIpaddr(a);if(!1===d)d="";else{for(var g=angular.copy(d),e=0,k;7>=e;e++)k=d.parts[e],g.parts[e]=k&~c[e];d=g.toString();d="::"===d.substr(0,2)?d.substr(2):d}return d};"ISP"===b._type?(c=b&&b._ip_pd_prx2,d=b&&b._ip_pd_prx.split("/")[1]||d,g=g(c,d),b.eui_64=void 0,b.user_define=g):"EUI_64"===c?(b.eui_64=null,b.user_define=void 0):"USER_DEFINE"===c&&(c=b&&b._if_ident,d=b&&b.prefix_length||d,g=g(c,d),b.eui_64=void 0,b.user_define=g)},get_inter_vlan_routing:function(a){return a.vlan_inter_vlan_routing},
set_inter_vlan_routing:function(a,b){a.vlan_inter_vlan_routing=b},get_vlan_id:function(a){return a.vlan_id},set_vlan_id:function(a,b){a.vlan_id=b},get_vlan_untagged_vlan_id:function(a){return a.vlan_untagged_vlan_id},set_vlan_untagged_vlan_id:function(a,b){a.vlan_untagged_vlan_id=b},get_vlan_tagged_vlan_id:function(a){return a.vlan_tagged_vlan_id},set_vlan_tagged_vlan_id:function(a,b){a.vlan_tagged_vlan_id=b},clean_vlan_tagged_vlan_id:function(a){a.vlan_tagged_vlan_id.splice(0)},push_vlan_tagged_vlan_id:function(a,
b){return a.vlan_tagged_vlan_id.push(b)},pop_vlan_tagged_vlan_id:function(a){return a.vlan_tagged_vlan_id.pop()},dhcp_dp:{get_dhcp_pd_prefix:function(a){if(a&&a.ipv6&&a.ipv6.dhcp_pd_prefix)return a.ipv6.dhcp_pd_prefix},get_dhcp_pd_prefix_full:function(a){if(a&&a.ipv6&&a.ipv6.dhcp_pd_prefix_full)return a.ipv6.dhcp_pd_prefix_full},get_dhcp_pd_wanname:function(a){if(a&&a._WANname)return a._WANname}}},c=function(){a.loadReady=!1;n.defer();n.defer();n.defer();var b=function(a){var b=app.TOOLS.sortingInterfaceFn(!1);
a.sort(b)};n.all({INTF:function(){return v.post({url:resource_base+"data/lan_vlan_membership.json",method:"get_vlan_membership",success:function(b){b&&(b.data&&""===b.data.result)&&(b.data.result={});var c={};W.vlan_t_db_to_cfg(b.data.result,c);c=c.interfaces;b.data.result={vlan:m("filter")(c,a.ifNamed("^VLAN")),lan:m("filter")(c,a.ifNamed("^LAN")),lag:m("filter")(c,a.ifNamed("^LAG")),wan:m("filter")(c,a.ifNamed("^WAN[0-9]($|.[0-9]+$)"))}},error:function(a){console.log("AJAX loading error: "+a.status+
", URL: "+a.config.url+" method: "+this.method)}})}(),INTF_state:function(){return v.post({url:resource_base+"data/system_summary.json",method:"get_interface_state",params:{filter:"VLAN"},options:{transformResponse:app.modelhelper.db2webFn},success:function(a){a&&(a.data&&""===a.data.result)&&(a.data.result={});e.default_result(a,{"interfaces-state":{"interface":[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),WAN_IPv6:function(){return v.post({url:resource_base+
"data/get_wan_ipv6_prefix.json",method:"get_wan_ipv6_prefix",options:{transformResponse:app.modelhelper.db2webFn},success:function(a){a&&(a.data&&""===a.data.result)&&(a.data.result={});e.default_result(a,{interfaces_state:{"interface":[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),StateSubnet:function(){return v.post({url:resource_base+"data/get_subnet.json",method:"get_subnet",success:function(a){a&&(a.data&&""===a.data.result)&&
(a.data.result={});e.default_result(a,{subnets:{ipv4:[],ipv6:[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}()}).then(function(c){a.model={};a.model.vlan_interfaces=x.getResult(c.INTF,"vlan");a.model.lan_interfaces=x.getResult(c.INTF,"lan");a.model.lag_interfaces=x.getResult(c.INTF,"lag");a.model.wan_interfaces=x.getResult(c.INTF,"wan");a.model.vlan_ifstate=x.getResult(c.INTF_state,"interfaces_state");g();a.model.wan_ifstate=
x.getResult(c.WAN_IPv6,"interfaces_state");a.func_flag.ipv6_pd_with_6rd&&k(c.cdb_IP6RD);b(a.model.vlan_interfaces);b(a.model.lan_interfaces);b(a.model.lag_interfaces);a.collect_wan_dhcp_pd();c=c.StateSubnet;c.data&&(c.data.result&&c.data.result.subnets&&c.data.result.subnets.ipv4&&c.data.result.subnets.ipv6)&&(a.subnetObj=angular.copy(c.data.result.subnets));a.gridVLAN.Options.data=a.model.vlan_interfaces;a.schema=a.schema||{};a.schema.StatusMap={"true":a.DICT("VLAN_membership_Enabled"),"false":a.DICT("VLAN_membership_Disabled")};
a.schema.portmodes=[{id:"U",displayName:a.DICT("VLAN_membership_Untagged")},{id:"T",displayName:a.DICT("VLAN_membership_Tagged")},{id:"X",displayName:a.DICT("VLAN_membership_Excluded")}];a.schema.portmodesHash={U:a.DICT("VLAN_membership_Untagged"),T:a.DICT("VLAN_membership_Tagged"),X:a.DICT("VLAN_membership_Excluded")};a.schema.ipv6_addr_sample={ip:"fec0:0001:0000:0000::",prefix_length:64};a.schema.TYPE_STATIC="STATIC";a.schema.TYPE_ISP="ISP";a.ctx.HWDMZport=u.get_HWDMZport()||"LAN4";a.ctx.HWDMZenableCount=
0;c=a.model.vlan_interfaces.concat(a.model.lan_interfaces).concat(a.model.lag_interfaces);for(var e=c.length-1,h;0<e;e--)if(h=c[e],h.name.match(/^LAN|^LAG/)){h.role="lan";null==d.get_vlan_tagged_vlan_id(h)&&d.set_vlan_tagged_vlan_id(h,[]);var l=h,A=d.get_vlan_tagged_vlan_id(l);if(A&&(A=angular.copy(A[0]))&&A.split){d.clean_vlan_tagged_vlan_id(l);for(var A=A.split(" "),r=A.length;r--;)void 0!=A[r]&&d.push_vlan_tagged_vlan_id(l,parseInt(A[r]))}h.name.match("^"+a.ctx.HWDMZport+"$")&&(h.dmz&&!0==h.dmz.enabled)&&
(a.ctx.HWDMZenable=!0,a.ctx.HWDMZenableCount=1)}else"VLAN"==h.name.substr(0,4)?(h.role="vlan",h.vlan_tagged_vlan_id&&delete h.vlan_tagged_vlan_id,h.vlan_untagged_vlan_id&&delete h.vlan_untagged_vlan_id):h.name.match(/^WAN\d+$|^WAN\d+\.\d+$/)?h.role="wan":h.name.match(/^DMZ/)&&c.splice(e,1);y();a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.loadReady=!0})["catch"](function(a){console.log("=="+a)})},k=function(b){b=b.data.result.interfaces||[];b.length&&(a.model.ip6rd=[],angular.forEach(b,
function(b,c){b.name.match(/^TUN/)&&("ip6rd"==b.type&&!0==b.enabled)&&a.model.ip6rd.push(b)}))},g=function(){a.use_interfaces_sample={interfaces:[]};e.recover_object(a.model,a.use_interfaces_sample);a.use_wan_interfaces_state_sample={wan_ifstate:{"interface":[]}};e.recover_object(a.model,a.use_wan_interfaces_state_sample);a.use_ipv6ra_prefix_list_sample={ipv6_ra:{prefixes:[]}};angular.forEach(a.model.vlan_interfaces,function(a,b){"VLAN"==a.name.substr(0,4)&&e.recover_object(a,{"vlan-interface-settings":{"inter-vlan-routing":!1,
"enable-management":!1}});if("VLAN"==a.name.substr(0,4)){var c={editVlanId:!1,edit:!1,editEnableManagement:!1,invalid:!1,checked:!1,ipv4:{enabled:!0,mtu:1400,address:[{ip:"",prefix_length:null}]},ipv6:{enabled:!0,mtu:1400,address:[{ip:"",prefix_length:null}]}};c.info=!1==a.vlan_enable_management?E:"";e.recover_object(a,c)}});angular.forEach(a.model.lan_interfaces,function(a,b){("LAN"==a.name.substr(0,3)||"LAG"==a.name.substr(0,3))&&e.recover_object(a,{vlan_tagged_vlan_id:[],vlan_untagged_vlan_id:""})})},
z=function(a,b){var c=a[b].address[0];a[b].enabled=""!=c.ip&&void 0!=c.ip&&null!=c.prefix_length&&0!=c.prefix_length?!0:!1},y=function(b){b=m("filter")(a.model.vlan_interfaces,C);angular.forEach(b,function(b,c){if(b.ipv6&&b.ipv6.address){var d=b.ipv6.address;d[0]&&(a.refreshIPv6Ctx(b,0),a.init_origin_type(d[0],b,!0));d[1]&&(a.refreshIPv6Ctx(b,1),a.init_origin_type(d[1],b,!0),d[1].enabled=!0)}})},A={ipaddr:createIpAddr(),parseIpaddr:function(a){return!A.ipaddr.IPv6.isValid(a)?!1:A.ipaddr.parse(a)}},
B=function(a,b){var c=A.parseIpaddr(a);if(!(!1===c||0<!parseInt(b,10))){for(var d=angular.copy(c),g=angular.copy(c),e=0,k=128,h,l;0<k;)h=16<b?16:b,b-=h,0>b&&(b=0),l=65535^(1<<16-h)-1,h=(1<<16-h)-1,d.parts[e]=c.parts[e]&l,g.parts[e]=c.parts[e]&h,k-=16,e++;return{prefix_obj:d,prefix_str:d.toString(),prefix_norm_str:d.toNormalizedString(),suffix_obj:g,suffix_str:g.toString(),suffix_norm_str:g.toNormalizedString()}}};a.refreshIPv6Ctx=function(b,c){if(b.ipv6&&b.ipv6.address&&b.ipv6.address[c]&&b.ipv6.address[c].ip){var g=
b.ipv6.address[c],e=g.ip,k=parseInt(g.prefix_length);if(k=B(e,k))g._ip_prefix=app.TOOLS.ipv6.compress(k.prefix_norm_str),g._if_ident=k.suffix_str.replace(/^::/,""),g._ip_pd_prx=k.prefix_norm_str.toLowerCase()+"/"+g.prefix_length;a.func_flag.ipv6_ip_prefer_isp?g._ip_pd_prx2=g.user_define:"ISP"===d.get_origin_mode(g)&&(g._ip_pd_prx2=g._if_ident);a.PD_source?angular.forEach(a.PD_source,function(a,b){var c=d.dhcp_dp.get_dhcp_pd_prefix(a);if(c&&"function"===typeof c.split){var k=c.split("/"),c=k[0],k=
k[1]&&parseInt(k[1],10)||0,k=B(e,k),h=k.prefix_norm_str.toLowerCase();app.TOOLS.ipv6.toFullV6Addr(c).toLowerCase()===h&&(g.isp&&g.isp["interface"]===d.dhcp_dp.get_dhcp_pd_wanname(a))&&(g._ip_pd_obj=a,c=k.suffix_str.toLowerCase().replace(/^::/,""),g._ip_pd_prx2=c)}}):Log(ERROR,"Error: PD_source not exist")}};a.update_ip_enable_status=function(a,b){z(a.entity,b)};a.collect_port_list=function(){var b=m("filter")(a.model.lan_interfaces,function(a,b,c){return a.name.match(/^LAN/)?!0:!1}),c=m("filter")(a.model.lag_interfaces,
function(a,b,c){return a.name.match(/^LAG/)?!0:!1});return b.concat(c)};a.sync_vlanid=function(b,c){var g=d.get_vlan_id(c.entity)||"??",e="",k=!1,h;angular.forEach(a.model.vlan_interfaces,function(a,c){b===c?h=a:a.vlan_id===g&&(k=!0)});"??"===g||k?(e="(Invalid)",h.invalid=!0):(e=r["l2vlan,vlan"]+g,h.invalid=!1);c.entity.name=e;a.update_v6_local_pd_ip(c.entity.ipv6.address[0],c.entity,!0);var e=c.rowIndex,A=c.entity,l,y,z=a.collect_port_list();if(null!=d.get_vlan_id(A))for(var B=z.length;B--;)l=z[B],
y=B,a.update_port_vlan_model(e,y,A,l)};a.ifNamed=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};var C=function(a,b,c){return a.name.match(/^(VLAN)/)?!0:!1};a.collect_svi_ref_list=function(){return m("filter")(a.model.vlan_interfaces,C)};a.update_v6_prefix_disabled=function(b){var c=!1;b._type!=a.schema.TYPE_STATIC&&(c=!1);b=b._type==a.schema.TYPE_STATIC&&"EUI_64"==b._type_if_ident;return c||b};a.get_min_v6_prefixlen=function(b){var c=a.func_flag.ipv6_min_prefixlen,d=c;b._type==
a.schema.TYPE_ISP&&b._ip_pd_prx&&(b=b._ip_pd_prx.split("/")[1]||c,d=parseInt(b));return Math.max(c,d)};a.update_v6_pd_obj=function(b,c){for(var g=d.get_vlan_id(c)||1,e=a.model.vlan_interfaces,k=0,h;k<e.length;k++)if(h=e[k],(h=h.ipv6&&h.ipv6.address&&h.ipv6.address[0])&&h._ip_pd_prx2)(h=h._ip_pd_prx2.split(":").reverse()[4])&&g===parseInt(h,16)&&(g+=1);g=g.toString(16).toUpperCase();b._ip_pd_prx2=b._ip_pd_prx2||g+":0:0:0:1";g=d.dhcp_dp.get_dhcp_pd_prefix_full(b._ip_pd_obj);b._ip_pd_prx=g?g:void 0;
a.update_v6_local_pd_ip(b,c,!1)};a.update_v6_local_pd_ip=function(b,c,g,e){var k=d.get_vlan_id(c);if(k){if(!g||!b._ip_pd_prx_local)b._ip_pd_prx_local=!1;if(b._ip_pd_prx_local){k=d.get_vlan_id(c);g=new F;var h=g.ipv6ToNumber("fec0:0000::"),A="";h.parts[1]=parseInt(k);A=g.numToIpv6Normal(h);b._ip_pd_prx=A+"/64"}}e?a.update_v6ip(b,c,void 0,{userDefPrefix:!0}):a.update_v6ip(b,c)};a.update_v6ip=function(b,c,g,e){var k=!1;e&&angular.isDefined(e.userDefPrefix)&&(k=e.userDefPrefix);var h=!0,l=!1,r=function(){y.parts.length!==
x.parts.length&&console.log("Error: preview_v6ip, IPv6 part not correct");var c=angular.copy(x),g;if(b._type==a.schema.TYPE_ISP){var e=d.dhcp_dp.get_dhcp_pd_prefix(b._ip_pd_obj);e?(e=e.split("/"),g=64,0<e.length&&(g=e[1]),g=parseInt(g)):g=64}else g=b.prefix_length;for(e=0;e<c.parts.length;e++)16<=g?(c.parts[e]=0,g-=16):(c.parts[e]&=(1<<16-g)-1>>>0,g=0);g=angular.copy(y);for(e=0;e<y.parts.length;e++)g.parts[e]=y.parts[e]|c.parts[e];return g.toString()};g=function(b){b._ip_pd_prx2="";if("USER_DEFINE"==
b._type_if_ident){y=A.parseIpaddr(b._ip_prefix);x=A.parseIpaddr("::"+b._if_ident);if(!1==y||!1==x)h=!1;h&&(b.ip=r())}else if("EUI_64"==b._type_if_ident){b.prefix_length=64;for(var c=m("filter")(a.model.vlan_ifstate["interface"],a.ifNamed("^VLAN")),d=0;d<c.length;d++){var g=c[d];if(g.name.match(/^VLAN/)&&void 0!=g.phys_address){var e=b,g=g.phys_address.replace(/:/g,""),g=g.substr(0,4)+":"+g.substr(4,2)+"FF:FE"+g.substr(6,2)+":"+g.substr(8,4),k=parseInt(g.substr(0,2),16),k=0==(k&2)?k|2:k&253,g=k.toString(16)+
g.substr(2),g=ipaddr.parse("::"+g).toString().toLowerCase();e._suffix_eui64=g}}b._if_ident="";b._ip_pd_prx="";y=A.parseIpaddr(b._ip_prefix);x=A.parseIpaddr(b._suffix_eui64);if(!1==y||!1==x)h=!1;h&&(b.ip=r().toLowerCase())}};e=function(){b._ip_pd_prx=b._ip_pd_prx||"";b._suffix_eui64="";var a=b._ip_pd_prx.split("/")[0];k||(b._ip_pd_prx.split("/"),b.prefix_length=64);y=A.parseIpaddr(a);x=A.parseIpaddr("::"+b._ip_pd_prx2);if(!1==y||!1==x)h=!1;h&&(b.ip=r().toLowerCase());""===b._ip_pd_prx&&b.orig_ip&&
(b.ip=b.orig_ip,l=!0);if(a=B(b.ip,b.prefix_length))b._ip_prefix=app.TOOLS.ipv6.compress(a.prefix_norm_str),"EUI_64"===d.get_identifier(b)?b._if_ident="":b._if_ident=a.suffix_str.replace(/^::/,"")};var y,x;b._type==a.schema.TYPE_STATIC?(g(b),d.set_origin_mode(b,"STATIC")):b._type==a.schema.TYPE_ISP&&(e(b),d.set_origin_mode(b,"ISP",{wan_ifname:b._ip_pd_obj&&b._ip_pd_obj._WANname||void 0}));d.set_identifier(b);if(h||l){var p=angular.copy(b.ip);b.ip="";s(function(){b.ip=p;z(c,"ipv6");a.gridVLAN.chkIpv6Ip()},
0)}else b.ip="",z(c,"ipv6"),a.gridVLAN.chkIpv6Ip()};a.ipv6_addr_create_elem=function(b,c,d,g){if(g=!0===g?!0:!1){var e=b[c]=angular.copy(a.schema.ipv6_addr_sample);e.ip="";e.isp={"interface":"WAN1"};e._type=a.schema.TYPE_ISP;e._ip_pd_obj=a.collect_wan_dhcp_pd()[0];a.update_v6_pd_obj(e,d)}else b[c]=void 0;b[c]&&(b[c].enabled=g)};a.init_origin_type=function(b,c,g){angular.isDefined(b._type)||("ISP"===d.get_origin_mode(b)?b._type=a.schema.TYPE_ISP:b._type=a.schema.TYPE_STATIC,!0!==g&&s(function(){a.update_v6ip(b,
c)},0));a.init_type_if_ident(b)};a.init_type_if_ident=function(a){angular.isDefined(a._type_if_ident)||(a._type_if_ident="USER_DEFINE")};a.intf_key_handler=function(a,b){b=parseInt(b);var c=!1,g=d.get_vlan_id(a);a&&("l2vlan"==a.type&&g==b)&&(c=!0);return c};a.isExistUnnamedVLANID=function(a){var b=function(a,b,c){a=d.get_vlan_id(a.entity);return angular.isDefined(a)?!1:!0},c=[];a&&(a.Options&&a.Options.ngGrid&&a.Options.ngGrid.filteredRows)&&(c=m("filter")(a.Options.ngGrid.filteredRows,b));return 0<
c.length};(function(){var b=a.func_flag.ipv6_layout,c={editRowH:6*(app.uiGrid.headerRowHeight||32),width:750,editableCellTemplate:t.get("T_vlan_membership_ipv6_address_edit.html")};"DESIGN_2"===b&&(c={editRowH:7*(app.uiGrid.headerRowHeight||32),width:800,editableCellTemplate:t.get("T_vlan_membership_ipv6_address_edit_DESIGN_2.html")});return c})();a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridVLAN=a.gridVLAN||{};a.gridVLAN.Selections=[];a.gridVLAN.stateObj={editCount:0,editList:[]};
a.gridVLAN.procNgClick=function(b){var c=0,d=[];a.gridVLAN.Selections.splice(0);angular.forEach(a.model.vlan_interfaces,function(b,g){b.checked?a.gridVLAN.Selections.push(b):(b.edit=!1,b.editVlanId=!1,b.editEnableManagement=!1);b.edit&&(c++,d.push(g))});a.gridVLAN.stateObj.editCount=c;a.gridVLAN.stateObj.editList=d;a.gridVLAN.check_remove_condition()};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};var D=function(a,b,c,d,g){for(var e=a.length,k,h=0,A;h<e;h++){A=a[h];k=!1;for(var l=
0,r;l<e;l++)r=a[l],h!==l&&d&&d(r,A,g)&&(k=!0);!k&&c&&(k=c(A));A[b]=k}};a.gridVLAN.chkIpv6Ip=function(){var b=V,c=R,d=a.collect_svi_ref_list();D(d,"isDupIpv6a0",b,c,{v6_addrx:0});D(d,"isDupIpv6a1",b,c,{v6_addrx:1})};a.gridVLAN.chkIpv4Ip=function(){var b=M,c=P,d=a.collect_svi_ref_list();D(d,"isDupIpv4",b,c)};var E=u.spec_WifiSupport()?a.DICT("VLAN_membership_Device_Management_Note_1"):a.DICT("VLAN_membership_Device_Management_Note_2");a.gridVLAN.Options=app.uiGrid.generateGridOptions({IDPreifx:"VLANMembership",
rowHeight:a.func_flag.ipv6_addr1?2*app.uiGrid.rowHeight:3*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridVLAN.procNgClick,headerChangedCbk:a.gridVLAN.procNgClick,disableChkBoxField:"disableChk"},{field:"vlan_id",displayName:a.DICT("VLAN_membership_VLAN_ID"),id:"VLANMembershipID",validationCbk:"gridInvalidCbk",min:1,max:4093,required:!0,changedCbk:a.sync_vlanid,editRow:"editVlanId",width:90,invalidField:"invalid",cellTemplate:t.get("UG_table_text_with_inline_number_edit.html")},
{field:"name",displayName:a.DICT("VLAN_membership_Name"),width:90},{field:"vlan_inter_vlan_routing",displayName:a.DICT("VLAN_membership_Inter_VLAN_Routing"),id:"VLANMembershipRouting",cellTemplate:t.get("UG_table_checkbox_with_inline_edit.html"),editRow:"edit",width:155},{field:"vlan_enable_management",displayName:a.DICT("VLAN_membership_Device_Managemenet"),id:"VLANMembershipEnableManagement",cellTemplate:t.get("UG_table_checkbox_with_inline_edit.html"),editRow:"editEnableManagement",width:160,infoField:"info"},
{field:"ipv4.address",displayName:a.DICT("VLAN_membership_IPv4_Addr_Mask"),id:"VLANMembershipIPv4",validationCbk:"gridInvalidCbk",cellTemplate:t.get("T_vlan_membership_ipv4_address_edit.html"),editRow:"edit",minWidth:250,width:250},{field:"ipv6.address",displayName:a.DICT("VLAN_membership_IPv6_Addr_Mask"),id:"VLANMembershipIPv6",validationCbk:"gridInvalidCbk",cellTemplate:t.get("T_vlan_membership_ipv6_address_edit.html"),editRow:"edit",minWidth:600}]});var I=function(b,c){var g=m("filter")(a.model.lan_interfaces,
a.ifNamed("^LAN|^LAG"));angular.forEach(g,function(a,g){var e=d.get_vlan_tagged_vlan_id(a);if(e){var k=d.get_vlan_id(b),k=void 0!==k||null!==k?k:"",h=e.indexOf(k);-1==h?"add"==c&&e.push(k):"remove"==c&&e.splice(h,1)}})},F=function(){var a=this,b=createIpAddr();a.ipaddr=b;a.addrObj=void 0;a.parseIpv6addr=function(a){return!b.IPv6.isValid(a)?!1:b.parse(a)};a.ipv6ToNumber=function(b){b=a.parseIpv6addr(b);return a.addrObj=b};a.numToIpv6=function(b){if(b)return b.toString().toLowerCase();if(a.addrObj)return a.addrObj.toString().toLowerCase()};
a.numToIpv6Normal=function(b){if(b)return b.toNormalizedString().toLowerCase();if(a.addrObj)return a.addrObj.toNormalizedString().toLowerCase()};return a},H=function(){var b=32-a.ctx.HWDMZenableCount,c=a.collect_svi_ref_list().length||0,d=a.DICT("VLAN_membership_Vlan_Intf");return c>=b?(a.msg=a.DICT("VLAN_membership_DMZ_Max",{"%s0":a.ctx.HWDMZenableCount?a.DICT("VLAN_membership_DMZ_Enabled"):"","%s1":b,"%s2":d}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.gridVLAN.add=function(){if(!H()){var b=
a.model.vlan_interfaces;a.collect_svi_ref_list();var c;c={name:"VLAN0",type:"l2vlan",enabled:!0,vlan_id:0,editVlanId:!0,edit:!0,editEnableManagement:!0,vlan_inter_vlan_routing:!0,vlan_enable_management:!1,ipv4:{enabled:!0,mtu:1400,address:[{ip:"",subnet:"",prefix_length:null}]},ipv6:{enabled:!0,forwarding:!1,address:[angular.copy(a.schema.ipv6_addr_sample)],setting:{dhcp_pd_enable:!0}},ipv6_ra:{max_rtr_adv_interval:30},dot1x:{enable:!0,authorized_mode:"auto"},checked:!0,info:E};var g=new F;if(c.ipv6&&
c.ipv6.address&&c.ipv6.address[0]&&c.ipv6.address[0].ip){var e=c.ipv6.address[0],k=g.ipv6ToNumber(e.ip);T(c.ipv6.address[0],["^_"],!0);k.parts[1]+=b.length%65535;e._ip_prefix=g.numToIpv6(k);e._if_ident="1"}c._db_exist&&delete c._db_exist;c.vlan_ref&&delete c.vlan_ref;d.set_vlan_id(c,"");c.name=r["l2vlan,vlan"]+"";b.push(c);I(c,"add");a.init_origin_type(c.ipv6.address[0],c);a.gridVLAN.Options.gridApi.customApi.scrollToLast();a.modified()}};a.gridVLAN.edit=function(){for(var b=a.gridVLAN.Options.data,
c=0,d=[],g=b.length-1,e;0<=g;g--)e=b[g],e.checked&&(e.edit=!0,e.info=E,"VLAN1"!==e.name&&(e.editEnableManagement=!0),c++,d.push(g));a.gridVLAN.stateObj.editList=d;s(function(){a.gridVLAN.stateObj.editCount=c},0)};a.gridVLAN.VLAN1Exsit=!1;a.gridVLAN.check_remove_condition=function(){var b=!1,c=a.gridVLAN.Selections;a.gridVLAN.VLAN1Exsit=!1;angular.forEach(c,function(c,d){"VLAN1"==c.name&&(b=!0,a.gridVLAN.VLAN1Exsit=!0)});return b};a.gridVLAN.remove=function(){var b=[];angular.forEach(a.model.vlan_interfaces,
function(a){a.checked&&b.push(a)});a.gridVLAN.checking_before_remove(b,function(){var b=a.model.vlan_interfaces,c;for(c=b.length-1;0<=c;c--)b[c].checked&&(I(b[c],"remove"),b.splice(c,1),G());a.modified()})};var G=function(){var b=function(b){angular.forEach(b,function(a,b){var c=a[".ctx"].port_vlan_map,d;for(d in c)"U"!==c[d]&&(c[d]="U")});var c,g,e=a.collect_port_list();angular.forEach(b,function(b,k){if(null!=d.get_vlan_id(b))for(var h=e.length;h--;)c=e[h],g=h,a.update_port_vlan_model(k,g,b,c)})},
c=a.collect_svi_ref_list();1>=c.length&&b(c);a.gridVLAN.chkIpv4Ip();a.gridVLAN.chkIpv6Ip();a.gridVLAN.procNgClick()};a.gridVLAN.checking_before_remove=function(b,c){a.ctx_delref=a.ctx_delref||{};a.ctx_teleworker=a.ctx_teleworker||{};a.ctx_accessrules=a.ctx_accessrules||{};var d=function(d){var g=!0;d="";for(var e=[{dispStr:"DHCP Settings",refctx:a.ctx_delref["dhcp-pool"]["dhcp-interfaces"],chk_cb:function(a,b){return a.name==b["interface"]}},{dispStr:"Teleworker VPN Client",refctx:a.ctx_teleworker["teleworker-vpn-clients"]["teleworker-vpn-client"],
chk_cb:function(a,b){return a.name=="VLAN"+b.vlan}},{dispStr:"Firewall ACL Rules",refctx:a.ctx_accessrules["firewall-acl-rules"].ipv4["firewall-acl-rule"],chk_cb:function(a,b){return b["interface"]&&b["interface"]["source-interface"]&&a.name==b["interface"]["source-interface"]}}],k=function(a,b,c){angular.forEach(a.refctx,function(d,e){b&&(b.checked&&a.chk_cb(b,d))&&(c.push(a.dispStr),g=!1)})},h=b.length;h--;){var A=[];k(e[0],b[h],A);k(e[1],b[h],A);k(e[2],b[h],A);0<A.length&&(d+="<div>"+a.DICT("VLAN_membership_VLAN_In_Use",
{"%s1":b[h].name,"%s2":"</br>"+A.join("\n")})+"</div></br>")}""!==d&&app.TOOLS.criticalAlertBox({title:a.DICT("Error"),msg:d});g&&c()};if(a.ctx_delref["dhcp-pool"])d();else{var g=function(a,b){a&&(a.data&&a.data.result)&&e.recover_object(a.data.result,b)};n.all({dhcp:function(){return v.post({url:resource_base+"data/lan_dhcp_settings.json",method:"get_dhcp_settings",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),teleworker:function(){return v.post({url:resource_base+
"data/telework_vpn_clients.json",method:"get_teleworker_vpn",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),accessrules:function(){return v.post({url:resource_base+"data/firewall_access_rules.json",method:"get_access_rules",error:function(a){Log(ERROR,"accessRulesCtrl getData error: "+JSON.stringify(a))}})}()}).then(function(b){g(b.dhcp,{"dhcp-pool":{"dhcp-interfaces":[],"dhcp-option82":[]}});g(b.teleworker,{"teleworker-vpn-clients":{"teleworker-vpn-client":[]}});
g(b.accessrules,{"firewall-acl-rules":{ipv4:{"firewall-acl-rule":[]}}});angular.extend(a.ctx_delref,b.dhcp.data.result);angular.extend(a.ctx_teleworker,b.teleworker.data.result);angular.extend(a.ctx_accessrules,b.accessrules.data.result)}).then(function(){d()})}};a.tag_status=function(a,b,c,g){var e=d.get_vlan_id(a),k="?";if(d.get_vlan_untagged_vlan_id(b)==e)k="U";else{var h=!1,k="X";(a=d.get_vlan_tagged_vlan_id(b))&&angular.forEach(a,function(a,b){a==e?(k="T",h=!0):h||(k="X")})}return k};a.filter_LAN=
function(b,c,d){return b.name.match(/^LAN/)?(void 0!==b.lag_ref&&(a.ctx.inused_lag.push(b.lag_ref),b._greyout=!0),!0):!1};a.filter_LAG=function(b,c,d){return b.name.match(/^LAG/)&&!1!=b.enabled?(0<=a.ctx.inused_lag.indexOf(b.name)||(b._greyout=!0),!0):!1};a.collect_vlan_port_ref_list=function(){a.ctx.inused_lag=[];var b=m("filter")(a.model.lan_interfaces,a.filter_LAN),c=m("filter")(a.model.lag_interfaces,a.filter_LAG);return b.concat(c)};a.collect_wan=function(){a.filterWANphy={physical:!0,subinterface:!0};
return q.filter(a.model.wan_ifstate["interface"],a.filterWANphy)};a.collect_wan_dhcp_pd=function(){var b=a.model.wan_interfaces,c=a.model.wan_ifstate["interface"];a.PD_source||(a.PD_source=h.get_pd_interfaces(b,c));return a.PD_source};a.pd_dispStr=function(a){var b="unavailable",c=d.dhcp_dp.get_dhcp_pd_prefix(a);c&&(b=c);return b+" - ("+a._WANname+")"};a.pd_disableCond=function(a){return void 0==d.dhcp_dp.get_dhcp_pd_prefix(a)};a.showLagOwnerStatus=function(b,c){if(c[".ctx"]&&c[".ctx"].port_vlan_map){for(var d=
b.lag_ref,g=4,e=a.collect_vlan_port_ref_list(),k=0,h;k<e.length;k++)h=e[k]&&e[k].name,h==d&&(g=k);return a.schema.portmodesHash[c[".ctx"].port_vlan_map[g]]||"(Member of "+d+", but LAG not found)"}};a.update_port_vlan_model=function(b,c,g,e){var k=a.collect_svi_ref_list();"U"==g[".ctx"].port_vlan_map[c]&&(angular.forEach(k,function(a,b){a.name!=g.name&&"U"==a[".ctx"].port_vlan_map[c]&&(a[".ctx"].port_vlan_map[c]="T")}),d.set_vlan_untagged_vlan_id(e,d.get_vlan_id(g)));var h=!1;d.set_vlan_tagged_vlan_id(e,
[]);angular.forEach(k,function(a,b){var g=a[".ctx"].port_vlan_map[c];"T"==g?d.push_vlan_tagged_vlan_id(e,d.get_vlan_id(a)):"U"==g&&(h=!0)});!1==h&&d.set_vlan_untagged_vlan_id(e,"");"ieee8023adLag"==e.type&&J(b,c,g,e)};var J=function(b,c,d,g){for(var e=a.collect_vlan_port_ref_list(),k=d[".ctx"].port_vlan_map[c],h=0;h<e.length;h++)c=e[h],"ethernetCsmacd"==c.type&&c.lag_ref==g.name&&(d[".ctx"].port_vlan_map[h]=k,a.update_port_vlan_model(b,h,d,c))},L=function(a){for(var b=a%256,c=1;3>=c;c++)a=Math.floor(a/
256),b=a%256+"."+b;return b},N=function(a,b){var c=a.split("."),d=32-b,c=(c[0]<<24|c[1]<<16|c[2]<<8|c[3])>>>0>>d<<d>>>0;return{beg:c,end:(c|(1<<d)-1)>>>0}},M=function(b){var c=!1;if(b&&b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].ip&&b.ipv4.address[0].prefix_length){var d=b.ipv4.address[0],g=N(d.ip,d.prefix_length),d=L(g.beg),g=L(g.end);!1===p.poolValidate("interfaces",b.name,"ipv4",a.subnetObj,d,g,{skipCond:[{type:"interfaces",name:/^VLAN/}]})&&(c=!0)}return c},P=function(a,b){var c=
!1;if(a&&b&&a.ipv4&&b.ipv4&&a.ipv4.address&&b.ipv4.address&&a.ipv4.address[0]&&b.ipv4.address[0]&&a.ipv4.address[0].ip&&b.ipv4.address[0].ip&&a.ipv4.address[0].prefix_length&&b.ipv4.address[0].prefix_length){var d=b.ipv4.address[0],g=a.ipv4.address[0],e=N(d.ip,d.prefix_length),d=e.beg,e=e.end,k=N(g.ip,g.prefix_length),g=k.beg,k=k.end,h=!0;d<=g&&e>=k?h=!1:d<=g&&e>=g?h=!1:d<=k&&e>=k?h=!1:d>=g&&e<=k&&(h=!1);!1==h&&(c=!0)}return c},U=function(a){if(8!==a.length)console.log("error: ip6part.length = "+
a.length);else{for(var b,c=[],d=0;7>=d;d++)b=a[d]||0,c.push(b.toString(16));return c.join(":")}},Q=function(a,b){for(var c=app.TOOLS.validation.ipv6_getNet(a,b),d=angular.copy(c),g=[0,0,0,0,0,0,0,0],e=128-b,k=7;0<e;)16<=e?(g[k]=65535,e-=16):(g[k]|=(1<<e)-1>>>0,e=0),k--;for(k=0;k<d.length;k++)d[k]|=g[k];return{beg:c,end:d}},V=function(b){var c=!1;if(b&&b.ipv6&&b.ipv6.address&&b.ipv6.address[0]&&b.ipv6.address[0].ip&&b.ipv6.address[0].prefix_length){var d=b.ipv6.address[0],g=Q(d.ip,d.prefix_length),
e=U(g.beg).toLowerCase(),g=U(g.end).toLowerCase();b=p.poolValidateV6("interfaces",b.name,"ipv6",a.subnetObj,e,g,{skipCond:[{type:"interfaces",name:/^VLAN/}]});var k=!1,d=app.TOOLS.ipv6.toFullV6Addr(d.ip).toLowerCase();if(e==d||g==d)k=!0;if(!1===b||!0===k)c=!0}return c},R=function(a,b,c){var d=!1,g=!1,e=!1,k=function(a,b){if(a&&b&&a.ip&&b.ip&&a.prefix_length&&b.prefix_length){var c=Q(a.ip,a.prefix_length),d=U(c.beg).toLowerCase(),c=U(c.end).toLowerCase(),d=app.TOOLS.ipv6.toFullV6ZPAddr(d).toLowerCase(),
c=app.TOOLS.ipv6.toFullV6ZPAddr(c).toLowerCase(),g=Q(b.ip,b.prefix_length),e=U(g.beg).toLowerCase(),g=U(g.end).toLowerCase(),e=app.TOOLS.ipv6.toFullV6ZPAddr(e).toLowerCase(),g=app.TOOLS.ipv6.toFullV6ZPAddr(g).toLowerCase(),k=!1;d<=e&&c>=g?k=!0:d<=e&&c>=e?k=!0:d<=g&&c>=g?k=!0:d>=e&&c<=g&&(k=!0);return k}return!1};a&&(b&&a.ipv6&&b.ipv6&&a.ipv6.address&&b.ipv6.address)&&(e=!0);b&&(b.ipv6&&b.ipv6.address&&1<b.ipv6.address.length)&&(g=!0);!d&&g&&(rowE_addrs=b.ipv6.address,!0===k(rowE_addrs[0],rowE_addrs[1])&&
(d=!0));if(!d&&e&&(rowE_addrs=b.ipv6.address,item_addrs=a.ipv6.address,b=c&&c.v6_addrx||0,a=k(rowE_addrs[b],item_addrs[0]),k=k(rowE_addrs[b],item_addrs[1]),!0===a||!0===k))d=!0;return d},K=function(b,c){return function(b){if(!b)return!0;a.collect_svi_ref_list();return{result:!0,invalidRows:[],validRows:[]}}};a.poolValidation=function(a){var b;"ipv6"==a?(a=V,b=R):(a=M,b=P);return K(a,b)};var S=function(a,b,c,d){var g=[],e;angular.forEach(a,function(a,k){e=!1;angular.forEach(b,function(b,g){d?d(a[c],
b[c])&&(e=!0):a[c]===b[c]&&(e=!0)});if(!e){var h={};h[c]=a[c];g.push(h)}});return g},T=function(a,b,c){for(var d=0;d<b.length;d++)if(c)for(var g in a)g.match(b[d])&&delete a[g];else for(g in a)g==b[d]&&delete a[g]},O=function(a,b){if(a[b]&&a[b].address&&a[b].address[0]){var c=a[b].address[0];T(c,["^_"],!0);null==c.prefix_length&&(c.prefix_length="")}};a.save=function(){var g=a.model.vlan_interfaces.concat(a.model.lan_interfaces).concat(a.model.lag_interfaces),k=angular.copy(g);angular.forEach(k,function(b,
c){T(b,["vlan_ref",".ctx","role"]);if(b.ipv6&&b.ipv6.address)for(var g=b.ipv6.address,k=0;k<g.length;k++){var h=g[k];if(h){var l="",r="",y=h._type;if("ISP"===y){for(var l=A.parseIpaddr(h.ip),r=h.prefix_length,z=0;z<l.parts.length;z++)16<=r?r-=16:1<r&&16>r?(l.parts[z]&=65535-((1<<16-r)-1)>>>0,r=0):l.parts[z]=0;l=l.toString();r=h.prefix_length}else"STATIC"===y&&(l=h._ip_prefix,r=h.prefix_length);y&&l&&(e.recover_object(b,a.use_ipv6ra_prefix_list_sample),l=b.ipv6_ra.prefixes.push({prefix_ip:l,prefix_length:r,
preferred_lifetime:3600,valid_lifetime:7200}),d.set_origin_mode(b.ipv6_ra.prefixes[l-1],y,{wan_ifname:h.isp&&h.isp["interface"]||void 0}))}}O(b,"ipv4");O(b,"ipv6");void 0!=b._greyout&&delete b._greyout;void 0!=b.dmz&&delete b.dmz;angular.isDefined(b.checked)&&delete b.checked;angular.isDefined(b.disableChk)&&delete b.disableChk;angular.isDefined(b.info)&&delete b.info;if("http"===x.source){if(g=d.get_vlan_tagged_vlan_id(b))g=angular.copy(g),d.set_vlan_tagged_vlan_id(b,[g.join(" ")])}else(g=d.get_vlan_tagged_vlan_id(b))&&
0===g.length&&d.set_vlan_tagged_vlan_id(b,[""])});var h=S(a.model_orig.vlan_interfaces,a.model.vlan_interfaces,"name"),l=function(a,b){var c=A.parseIpaddr(a),d=A.parseIpaddr(b);return angular.equals(c,d)},g=function(b,c){angular.forEach(a.model.vlan_interfaces,function(d,g){angular.forEach(a.model_orig.vlan_interfaces,function(a,g){if(d.name==a.name&&d[b]&&d[b].address&&0<d[b].address.length&&a[b]&&a[b].address&&0<a[b].address.length){var e=void 0,k=[];"ipv6"==b&&(e=l);k=S(a[b].address,d[b].address,
"ip",e);0<k.length&&(k[0]&&""!=k[0].ip)&&(e={name:d.name},e[b]={address:k},c.push(e))}})})},r=[];g("ipv4",r);g("ipv6",r);var y=function(a,b){var c;angular.forEach(a,function(a,d){b==a.name&&(c=a)});return c},z=function(c,d){var g=y(k,c).ipv4.address[0].ip,e=b.absUrl().replace(d,g),h=function(){s(function(){window.location=e},1E3)};app.TOOLS.criticalAlertBox({msg:"Attempting to redirect to the URL: "+e,btn_yes_str:a.DICT("Click_to_Redirecting"),btn_no_str:a.DICT("Cancel"),cbk:function(a){h();app.transition.In()}});
app.transition.Out()},B=!1,p,u,G=function(){var a={redir_flag:!1};u=b.host();if(r[0]&&r[0].ipv4&&r[0].ipv4.address&&r[0].ipv4.address[0]&&r[0].ipv4.address[0].ip){var c=r[0].ipv4.address[0].ip;p=r[0].name;u==c&&(B=!0,c=y(k,p).ipv4.address[0].ip,a.redir_flag=!0,a.admin_if_name=p,a.currIp=u,a.newIp=c)}return a},w=[],M=function(){var a={};W.vlan_t_cfg_to_db({interfaces:k},a);a.interfaces["interface"].concat([]);w.push({method:"set_vlan_membership",params:a})},q=function(){var b=function(){!0==B?z(p,
u):(c(),a.reset_state());a.resetModified()},d=function(){var a=2,b=m("filter")(k,C).length||0,a=a+(1*(h.length||0)+(3*b+0*((k.length||0)-b)));return 1E3*a};0<h.length&&w.push({method:"del_interface",params:{interfaces:{"interface":h}}});M();(function(){v.post({url:resource_base+"data/rpc_result.json",method:"set_bulk",params:w,timeout:B?d():void 0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method);0===a.status&&b()}}).then(function(c){c.data.result&&
c.data.result.code&&0!==c.data.result.code?(B=!1,c="Can not delete, following Tables is in use:<br/>"+c.data.result.errstr+"<br/><br/>",app.TOOLS.criticalAlertBox({msg:c+"Apply failed, and reloading settings from device",cbk:function(a){b()}})):(a.success=!0,b())})})()};(function(){var b=G();if(b.redir_flag){var c="Notice: This device's management IP address "+b.admin_if_name+"("+b.currIp+") is requested to change.<br/><br/>",c=c+"Please update Browser's location bar with new IP address "+(" <em>"+
b.newIp+"</em> "),c=c+" when your networking environment is ready.<br/>",c=c+" Continue?";app.TOOLS.warningAlertBox({msg:c,cbk:function(a){a&&q()},btn_yes_str:a.DICT("VLAN_membership_Click_to_Redirect"),btn_no_str:a.DICT("Cancel")})}else q()})()};a.reset_state=function(){a.ctx_delref={};a.ctx.flagPortEditable=!1};a.cancel=function(){c();a.reset_state();a.resetModified()};var W=new data_transform_vlan_MR05({Sets:e});c()}]);
var data_transform_vlan_MR05=function(a){if(!b||!b.VERSION)var b={each:angular.forEach,assign:$.extend,defaults:function(b,n){a.Sets.recover_object(b,n);return b}};this.vlan_t_db_to_cfg=function(a,n){var v=(a.interfaces||{})["interface"]||[];n=n||{};var t=n.interfaces=[],m=!1,q=function(a,b){void 0!==a["static"]&&(b["static"]=a["static"]);a.isp&&(b["static"]={})},e=function(a,e){if(a["ipv6-router-advertisements"]){var h=a["ipv6-router-advertisements"],p=e.ipv6_ra={enabled:h["send-advertisements"],
mode:h.mode,max_rtr_adv_interval:h["max-rtr-adv-interval"],managed_flag:h["managed-flag"],other_config_flag:h["other-config-flag"],router_preference:h["router-preference"],link_mtu:h["link-mtu"],default_lifetime:h["default-lifetime"]};if(h["prefix-list"]&&h["prefix-list"].prefix){var h=h["prefix-list"].prefix,u=p.prefixes=[];b.each(h,function(a){var b=a["prefix-spec"].split("/"),b=u.push({prefix_ip:b[0],prefix_length:b[1],preferred_lifetime:a["preferred-lifetime"],valid_lifetime:a["valid-lifetime"]||
7200});q(a,u[b-1])})}}};(function(){for(var a=0,l;a<v.length;a++){l=v[a];var h={name:l.name,type:l.type,enabled:l.enabled};m="VLAN1"===l.name?!0:!1;if(l["vlan-interface-settings"]){var p=l["vlan-interface-settings"];h.vlan_id=p["vlan-id"];h.vlan_inter_vlan_routing=p["inter-vlan-routing"];h.vlan_enable_management=void 0!==p["enable-management"]?p["enable-management"]:m}l["vlan-settings"]&&(p=l["vlan-settings"],h.vlan_untagged_vlan_id=p["untagged-vlan-id"]||"",p["tagged-vlans"]&&(h.vlan_tagged_vlan_id=
p["tagged-vlans"]["vlan-id"]||[]));if(l.ipv4){var p=l.ipv4,u=h.ipv4={enabled:p.enabled};if(p.address){var x=p.address,r=u.address=[];b.each(x,function(a){r.push({ip:a.ip,prefix_length:a["prefix-length"]})})}}l.ipv6&&(p=l.ipv6,u=h.ipv6={enabled:p.enabled},p.address&&(x=p.address,r=u.address=[],b.each(x,function(a){var b=r.push({ip:a.ip,orig_ip:a.ip,prefix_length:a["prefix-length"]});q(a,r[b-1]);b=r[b-1];void 0!==a["eui-64"]&&(b.eui_64=a["eui-64"]);a["user-define"]&&(b.user_define=a["user-define"])})),
p.setting&&(x=p.setting,u.setting={dhcp_pd_enable:x["dhcp-pd-enable"],prefix_name:x["prefix-name"]}),e(p,h));l["lag-ref"]&&(h.lag_ref=l["lag-ref"]);l.dmz&&(p=l.dmz,u=h.dmz={enabled:p.enable});t.push(h)}})()};this.vlan_t_cfg_to_db=function(a,n){var v=a.interfaces||[];b.assign(n,{interfaces:{"interface":[]}});var t=n.interfaces.interface,m=function(a,b){void 0!==a["static"]&&(b["static"]=a["static"]);a.isp&&(b.isp={"interface":a.isp["interface"]})},q=function(a,b){void 0!==a.eui_64&&(b["eui-64"]=a.eui_64);
a.user_define&&(b["user-define"]=a.user_define)},e=function(a,e){if(a.ipv6_ra){var h=a.ipv6_ra;e=b.defaults(e,{ipv6:{}});var p=e.ipv6["ipv6-router-advertisements"]={"send-advertisements":h.enabled,mode:h.mode,"max-rtr-adv-interval":h.max_rtr_adv_interval,"managed-flag":h.managed_flag,"other-config-flag":h.other_config_flag,"router-preference":h.router_preference,"link-mtu":h.link_mtu,"default-lifetime":h.default_lifetime};if(h.prefixes){var h=h.prefixes,p=p["prefix-list"]={prefix:[]},u=p.prefix;b.each(h,
function(a){var b=u.push({"prefix-spec":a.prefix_ip+"/"+a.prefix_length,"preferred-lifetime":a.preferred_lifetime,"valid-lifetime":a.valid_lifetime});m(a,u[b-1])})}}};(function(){b.each(v,function(a){var l={name:a.name};a.type&&b.assign(l,{type:a.type,enabled:a.enabled});void 0!==a.vlan_id&&(l["vlan-interface-settings"]={"vlan-id":a.vlan_id,"inter-vlan-routing":a.vlan_inter_vlan_routing,"enable-management":a.vlan_enable_management});b.defaults(l,{"vlan-settings":{}});var h=l["vlan-settings"];h["untagged-vlan-id"]=
void 0!==a.vlan_untagged_vlan_id?a.vlan_untagged_vlan_id:"";if(a.vlan_tagged_vlan_id){b.defaults(l,{"vlan-settings":{"tagged-vlans":{}}});for(h=0;h<a.vlan_tagged_vlan_id.length;h++)a.vlan_tagged_vlan_id[h]+="";h=l["vlan-settings"];h["tagged-vlans"]["vlan-id"]=a.vlan_tagged_vlan_id}if(a.ipv4){var p=a.ipv4,h=l.ipv4={enabled:p.enabled};if(p.address){var p=p.address,u=h.address=[];b.each(p,function(a){u.push({ip:a.ip,"prefix-length":a.prefix_length})})}}if(a.ipv6&&(p=a.ipv6,h=l.ipv6={enabled:p.enabled},
p.address))for(var p=p.address,u=h.address=[],h=0,x;h<p.length;h++)if(x=p[h]){var r=u.push({ip:x.ip,"prefix-length":x.prefix_length});m(x,u[r-1]);q(x,u[r-1])}e(a,l);a.lag_ref&&(l["lag-ref"]=a.lag_ref);t.push(l)})})()};return this};app.controller("LanVlanSettingsCtrl",["$scope","$location","$timeout","$q","MyHttp","$templateCache","$filter","wan_service","Sets","UserSession","userAccessRight","DHCP_PD","addressPoolValidate","modelInfo",function(a,b,s,n,v,t,m,q,e,w,l,h,p,u){var x={source:"dproxy",getResult:function(a,b,c){return e.getResult(this,a,b,c)}};a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.flagPortEditable=!1;a.func_flag=a.func_flag||{ipv6_pd_with_6rd:!1,ipv6_layout:"DESIGN_0",ipv6_min_prefixlen:16,ipv6_addr1:!1,ipv6_ip_prefer_isp:!1,
ipv6_pd_undetermined_allow:!0};a.success=!1;a.loadReady=!1;a.userAccessFlag=l.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var r={"ethernetCsmacd,lan":"LAN","ethernetCsmacd,wan":"WAN","svi,vlan":"VLAN","l2vlan,vlan":"VLAN"},d=a.fop={get_ip:function(a){return a.ip},set_ip:function(a,b){a.ip=b},get_prefixlen:function(a){return a.prefix_length},set_prefixlen:function(a,b){a.prefix_length=b},get_origin_mode:function(a){var b;a&&a["static"]?b="STATIC":a&&a.isp&&(a._ip_pd_subnetid=
a.isp.suffix,b="ISP");return b},set_origin_mode:function(a,b,c){"STATIC"===b?(a["static"]=null,a.isp=void 0):angular.isDefined(c.wan_ifname)?"ISP"===b&&(a["static"]=void 0,a.isp={"interface":c.wan_ifname,prefix_name:c.wan_username,suffix:c.subnetid}):(a["static"]=null,a.isp=void 0)},get_identifier:function(a){var b;a&&a.eui_64?b="EUI_64":a&&a.user_define&&(b="USER_DEFINE");return b},set_identifier:function(b){var c=b._type_if_ident,d=a.func_flag.ipv6_min_prefixlen||16,g=function(a,b){angular.isDefined(a)||
(a="");a.match(/::/)||(a="::"+a);var c=app.TOOLS.validation.ipv6_getNet("ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff",b),d="",d=A.parseIpaddr(a);if(!1===d)d="";else{for(var g=angular.copy(d),e=0,k;7>=e;e++)k=d.parts[e],g.parts[e]=k&~c[e];d=g.toString();d="::"===d.substr(0,2)?d.substr(2):d}return d};"ISP"===b._type?(c=b&&b._ip_pd_prx2,d=b&&b._ip_pd_prx.split("/")[1]||d,g=g(c,d),b.eui_64=void 0,b.user_define=g):"EUI_64"===c?(b.eui_64=null,b.user_define=void 0):"USER_DEFINE"===c&&(c=b&&b._if_ident,d=b&&
b.prefix_length||d,g=g(c,d),b.eui_64=void 0,b.user_define=g)},get_inter_vlan_routing:function(a){return a.vlan_inter_vlan_routing},set_inter_vlan_routing:function(a,b){a.vlan_inter_vlan_routing=b},get_vlan_id:function(a){return a.vlan_id},set_vlan_id:function(a,b){a.vlan_id=b},get_vlan_untagged_vlan_id:function(a){return a.vlan_untagged_vlan_id},set_vlan_untagged_vlan_id:function(a,b){a.vlan_untagged_vlan_id=b},get_vlan_tagged_vlan_id:function(a){return a.vlan_tagged_vlan_id},set_vlan_tagged_vlan_id:function(a,
b){a.vlan_tagged_vlan_id=b},clean_vlan_tagged_vlan_id:function(a){a.vlan_tagged_vlan_id.splice(0)},push_vlan_tagged_vlan_id:function(a,b){return a.vlan_tagged_vlan_id.push(b)},pop_vlan_tagged_vlan_id:function(a){return a.vlan_tagged_vlan_id.pop()},dhcp_dp:{get_dhcp_pd_prefix:function(a){if(a&&a.ipv6&&a.ipv6.dhcp_pd_prefix)return a.ipv6.dhcp_pd_prefix},get_dhcp_pd_prefix_full:function(a){if(a&&a.ipv6&&a.ipv6.dhcp_pd_prefix_full)return a.ipv6.dhcp_pd_prefix_full}}},c=function(){a.loadReady=!1;n.defer();
n.defer();n.defer();var b=function(a){var b=app.TOOLS.sortingInterfaceFn(!1);a.sort(b)};n.all({INTF:function(){return v.post({url:resource_base+"data/lan_vlan_membership.json",method:"get_vlan_membership",success:function(b){b&&(b.data&&""===b.data.result)&&(b.data.result={});var c={};O.vlan_t_db_to_cfg(b.data.result,c);c=c.interfaces;b.data.result={vlan:m("filter")(c,a.ifNamed("^VLAN")),lan:m("filter")(c,a.ifNamed("^LAN")),lag:m("filter")(c,a.ifNamed("^LAG")),wan:m("filter")(c,a.ifNamed("^WAN[0-9]($|.[0-9]+$)"))}},
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),INTF_state:function(){return v.post({url:resource_base+"data/system_summary.json",method:"get_interface_state",params:{filter:"VLAN"},options:{transformResponse:app.modelhelper.db2webFn},success:function(a){a&&(a.data&&""===a.data.result)&&(a.data.result={});e.default_result(a,{"interfaces-state":{"interface":[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+
a.config.url+" method: "+this.method)}})}(),WAN_IPv6:function(){return v.post({url:resource_base+"data/get_wan_ipv6_prefix.json",method:"get_wan_ipv6_prefix",options:{transformResponse:app.modelhelper.db2webFn},success:function(a){a&&(a.data&&""===a.data.result)&&(a.data.result={});e.default_result(a,{interfaces_state:{"interface":[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),StateSubnet:function(){return v.post({url:resource_base+
"data/get_subnet.json",method:"get_subnet",success:function(a){a&&(a.data&&""===a.data.result)&&(a.data.result={});e.default_result(a,{subnets:{ipv4:[],ipv6:[]}})},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}()}).then(function(c){a.model={};a.model.vlan_interfaces=x.getResult(c.INTF,"vlan");a.model.lan_interfaces=x.getResult(c.INTF,"lan");a.model.lag_interfaces=x.getResult(c.INTF,"lag");a.model.wan_interfaces=x.getResult(c.INTF,
"wan");a.model.vlan_ifstate=x.getResult(c.INTF_state,"interfaces_state");g();a.model.wan_ifstate=x.getResult(c.WAN_IPv6,"interfaces_state");a.func_flag.ipv6_pd_with_6rd&&k(c.cdb_IP6RD);b(a.model.vlan_interfaces);b(a.model.lan_interfaces);b(a.model.lag_interfaces);a.collect_wan_dhcp_pd();c=c.StateSubnet;c.data&&(c.data.result&&c.data.result.subnets&&c.data.result.subnets.ipv4&&c.data.result.subnets.ipv6)&&(a.subnetObj=angular.copy(c.data.result.subnets));a.gridVLAN.Options.data=a.model.vlan_interfaces;
a.schema=a.schema||{};a.schema.StatusMap={"true":a.DICT("VLAN_membership_Enabled"),"false":a.DICT("VLAN_membership_Disabled")};a.schema.portmodes=[{id:"U",displayName:a.DICT("VLAN_membership_Untagged")},{id:"T",displayName:a.DICT("VLAN_membership_Tagged")},{id:"X",displayName:a.DICT("VLAN_membership_Excluded")}];a.schema.portmodesHash={U:a.DICT("VLAN_membership_Untagged"),T:a.DICT("VLAN_membership_Tagged"),X:a.DICT("VLAN_membership_Excluded")};a.schema.ipv6_addr_sample={ip:"fec0:0001:0000:0000::",
prefix_length:64};a.schema.TYPE_STATIC="STATIC";a.schema.TYPE_ISP="ISP";a.ctx.HWDMZport=u.get_HWDMZport()||"LAN4";a.ctx.HWDMZenableCount=0;c=a.model.vlan_interfaces.concat(a.model.lan_interfaces).concat(a.model.lag_interfaces);for(var e=c.length-1,h;0<e;e--)if(h=c[e],h.name.match(/^LAN|^LAG/)){h.role="lan";null==d.get_vlan_tagged_vlan_id(h)&&d.set_vlan_tagged_vlan_id(h,[]);var A=h,l=d.get_vlan_tagged_vlan_id(A);if(l&&(l=angular.copy(l[0]))&&l.split){d.clean_vlan_tagged_vlan_id(A);for(var l=l.split(" "),
r=l.length;r--;)void 0!=l[r]&&d.push_vlan_tagged_vlan_id(A,parseInt(l[r]))}h.name.match("^"+a.ctx.HWDMZport+"$")&&(h.dmz&&!0==h.dmz.enabled)&&(a.ctx.HWDMZenable=!0,a.ctx.HWDMZenableCount=1)}else"VLAN"==h.name.substr(0,4)?(h.role="vlan",h.vlan_tagged_vlan_id&&delete h.vlan_tagged_vlan_id,h.vlan_untagged_vlan_id&&delete h.vlan_untagged_vlan_id):h.name.match(/^WAN\d+$|^WAN\d+\.\d+$/)?h.role="wan":h.name.match(/^DMZ/)&&c.splice(e,1);y();a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);
a.loadReady=!0})["catch"](function(a){console.log("=="+a)})},k=function(b){b=b.data.result.interfaces||[];b.length&&(a.model.ip6rd=[],angular.forEach(b,function(b,c){b.name.match(/^TUN/)&&("ip6rd"==b.type&&!0==b.enabled)&&a.model.ip6rd.push(b)}))},g=function(){a.use_interfaces_sample={interfaces:[]};e.recover_object(a.model,a.use_interfaces_sample);a.use_wan_interfaces_state_sample={wan_ifstate:{"interface":[]}};e.recover_object(a.model,a.use_wan_interfaces_state_sample);a.use_ipv6ra_prefix_list_sample=
{ipv6_ra:{prefixes:[]}};angular.forEach(a.model.vlan_interfaces,function(a,b){"VLAN"==a.name.substr(0,4)&&e.recover_object(a,{"vlan-interface-settings":{"inter-vlan-routing":!1,"enable-management":!1}});"VLAN"==a.name.substr(0,4)&&e.recover_object(a,{editVlanId:!1,info:D,edit:!1,editEnableManagement:!1,invalid:!1,checked:!1,ipv4:{enabled:!0,mtu:1400,address:[{ip:"",prefix_length:null}]},ipv6:{enabled:!0,mtu:1400,address:[{ip:"",prefix_length:null}]}})});angular.forEach(a.model.lan_interfaces,function(a,
b){("LAN"==a.name.substr(0,3)||"LAG"==a.name.substr(0,3))&&e.recover_object(a,{vlan_tagged_vlan_id:[],vlan_untagged_vlan_id:""})})},z=function(a,b){var c=a[b].address[0];a[b].enabled=""!=c.ip&&void 0!=c.ip&&null!=c.prefix_length&&0!=c.prefix_length?!0:!1},y=function(b){b=m("filter")(a.model.vlan_interfaces,B);angular.forEach(b,function(b,c){if(b.ipv6&&b.ipv6.address){var d=b.ipv6.address;d[0]&&(a.refreshIPv6Ctx(b,0),a.init_origin_type(d[0],b,!0));d[1]&&(a.refreshIPv6Ctx(b,1),a.init_origin_type(d[1],
b,!0),d[1].enabled=!0)}})},A={ipaddr:createIpAddr(),parseIpaddr:function(a){return!A.ipaddr.IPv6.isValid(a)?!1:A.ipaddr.parse(a)}};a.refreshIPv6Ctx=function(b,c){if(b.ipv6&&b.ipv6.address&&b.ipv6.address[c]&&b.ipv6.address[c].ip){for(var g=b.ipv6.address[c],e=g.ip,k=parseInt(g.prefix_length),e=A.parseIpaddr(e),h=angular.copy(e),l=angular.copy(e),r=0,y=128,z,B;0<y;)z=16<k?16:k,k-=z,0>k&&(k=0),B=65535^(1<<16-z)-1,z=(1<<16-z)-1,h.parts[r]=e.parts[r]&B,l.parts[r]=e.parts[r]&z,y-=16,r++;g._ip_prefix=h.toString();
g._if_ident=l.toString().substr(2);var e=A.parseIpaddr(g._ip_prefix),p=e.toNormalizedString().toLowerCase();g._ip_pd_prx=e.toNormalizedString().toLowerCase()+"/"+g.prefix_length;g._ip_pd_prx2=g._if_ident;a.PD_source?angular.forEach(a.PD_source,function(b,c){if(a.func_flag.ipv6_pd_undetermined_allow)b._WANname&&(g.isp&&g.isp["interface"]&&g.isp["interface"]===b._WANname)&&(g._ip_pd_obj=b);else{var e=d.dhcp_dp.get_dhcp_pd_prefix(b);e&&"function"===typeof e.split&&(e=e.split("/")[0],app.TOOLS.ipv6.toFullV6Addr(e).toLowerCase()==
p&&(g._ip_pd_obj=b))}}):Log(ERROR,"Error: PD_source not exist")}};a.update_ip_enable_status=function(a,b){z(a.entity,b)};a.collect_port_list=function(){var b=m("filter")(a.model.lan_interfaces,function(a,b,c){return a.name.match(/^LAN/)?!0:!1}),c=m("filter")(a.model.lag_interfaces,function(a,b,c){return a.name.match(/^LAG/)?!0:!1});return b.concat(c)};a.sync_vlanid=function(b,c){var g=d.get_vlan_id(c.entity)||"??",e="",k=!1,h;angular.forEach(a.model.vlan_interfaces,function(a,c){b===c?h=a:a.vlan_id===
g&&(k=!0)});"??"===g||k?(e="(Invalid)",h.invalid=!0):(e=r["l2vlan,vlan"]+g,h.invalid=!1);c.entity.name=e;a.update_v6_local_pd_ip(c.entity.ipv6.address[0],c.entity,!0);var e=c.rowIndex,l=c.entity,A,y,z=a.collect_port_list();if(null!=d.get_vlan_id(l))for(var B=z.length;B--;)A=z[B],y=B,a.update_port_vlan_model(e,y,l,A)};a.ifNamed=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};var B=function(a,b,c){return a.name.match(/^(VLAN)/)?!0:!1};a.collect_svi_ref_list=function(){return m("filter")(a.model.vlan_interfaces,
B)};a.update_v6_prefix_disabled=function(b){var c=!1;b._type!=a.schema.TYPE_STATIC&&(c=!1);b=b._type==a.schema.TYPE_STATIC&&"EUI_64"==b._type_if_ident;return c||b};a.pd_uallow=function(){return a.func_flag.ipv6_pd_undetermined_allow?!0:!1};a.pd_select_state=function(b){return b._type===a.schema.TYPE_STATIC?"static":"isp"};a.if_ident_disabled=function(b){return b._type==a.schema.TYPE_STATIC&&"EUI_64"==b._type_if_ident||!a.func_flag.ipv6_pd_undetermined_allow&&b._type!=a.schema.TYPE_STATIC?!0:!1};a.get_min_v6_prefixlen=
function(b){var c=a.func_flag.ipv6_min_prefixlen;if(a.func_flag.ipv6_pd_undetermined_allow)return c;var d=c;b._type==a.schema.TYPE_ISP&&b._ip_pd_prx&&(b=b._ip_pd_prx.split("/")[1]||c,d=parseInt(b));return Math.max(c,d)};a.update_v6_pd_obj=function(b,c){var g=d.dhcp_dp.get_dhcp_pd_prefix_full(b._ip_pd_obj);b._ip_pd_prx=g?g:void 0;a.update_v6_local_pd_ip(b,c,!1)};a.update_v6_local_pd_ip=function(b,c,g,e){var k=!1;if(a.func_flag.ipv6_pd_undetermined_allow)k=!1;else if(void 0==b._ip_pd_prx||""==b._ip_pd_prx)k=
!0;var h=d.get_vlan_id(c);if(h){if(!g||!b._ip_pd_prx_local)k?b._ip_pd_prx_local=!0:k||(b._ip_pd_prx_local=!1);if(b._ip_pd_prx_local){h=d.get_vlan_id(c);g=new I;var k=g.ipv6ToNumber("fec0:0000::"),l="";k.parts[1]=parseInt(h);l=g.numToIpv6Normal(k);b._ip_pd_prx=l+"/64"}}e?a.update_v6ip(b,c,void 0,{userDefPrefix:!0}):a.update_v6ip(b,c)};a.update_v6ip=function(b,c,g,e){var k=!1;e&&angular.isDefined(e.userDefPrefix)&&(k=e.userDefPrefix);var h=!0,l=function(c){c.parts.length!==y.parts.length&&console.log("Error: preview_v6ip, IPv6 part not correct");
var g=angular.copy(y),e;if(b._type==a.schema.TYPE_ISP){var k=d.dhcp_dp.get_dhcp_pd_prefix(b._ip_pd_obj);k?(k=k.split("/"),e=64,0<k.length&&(e=k[1]),e=parseInt(e)):e=64}else e=b.prefix_length;for(k=0;k<g.parts.length;k++)16<=e?(g.parts[k]=0,e-=16):(g.parts[k]&=(1<<16-e)-1>>>0,e=0);e=angular.copy(c);for(k=0;k<c.parts.length;k++)e.parts[k]=c.parts[k]|g.parts[k];return e.toString()};g=function(b){b._ip_pd_prx2="";if("USER_DEFINE"==b._type_if_ident){r=A.parseIpaddr(b._ip_prefix);y=A.parseIpaddr("::"+b._if_ident);
if(!1==r||!1==y)h=!1;h&&(b.ip=l(r),b.preview_ip=angular.copy(b.ip))}else if("EUI_64"==b._type_if_ident){b.prefix_length=64;for(var c=m("filter")(a.model.vlan_ifstate["interface"],a.ifNamed("^VLAN")),d=0;d<c.length;d++){var g=c[d];if(g.name.match(/^VLAN/)&&void 0!=g.phys_address){var e=b,g=g.phys_address.replace(/:/g,""),g=g.substr(0,4)+":"+g.substr(4,2)+"FF:FE"+g.substr(6,2)+":"+g.substr(8,4),k=parseInt(g.substr(0,2),16),k=0==(k&2)?k|2:k&253,g=k.toString(16)+g.substr(2),g=ipaddr.parse("::"+g).toString().toLowerCase();
e._suffix_eui64=g}}b._if_ident="";b._ip_pd_prx="";r=A.parseIpaddr(b._ip_prefix);y=A.parseIpaddr(b._suffix_eui64);if(!1==r||!1==y)h=!1;h&&(b.ip=l(r).toLowerCase(),b.preview_ip=angular.copy(b.ip))}};e=function(){b._ip_pd_prx=b._ip_pd_prx||"";b._suffix_eui64="";var c=0;a.func_flag.ipv6_pd_undetermined_allow?c=a.func_flag.ipv6_min_prefixlen:b._if_ident="";var d=b._ip_pd_prx.split("/")[0],g=b._ip_pd_prx.split("/")[1]||c;if(a.func_flag.ipv6_pd_undetermined_allow){var e=b._ip_pd_subnetid,z=b.prefix_length-
1,c=A.parseIpaddr("::"),B=z>>4,e=parseInt(e,16)<<15-z%16>>>0;c.parts[B]=e;B=0;for(e=7;0<=e;e--)c.parts[e]+=B,B=Math.floor(c.parts[e]>>>16),c.parts[e]=0===e&&65536<=c.parts[e]?65535:c.parts[e]%65536;d=A.parseIpaddr(d)||c;B=angular.copy(c);e=A.parseIpaddr(app.TOOLS.ipv6.prefixLen2FullAddr(parseInt(g)));g=A.parseIpaddr(app.TOOLS.ipv6.prefixLen2FullAddr(b.prefix_length));y=A.parseIpaddr("::"+b._if_ident);if(!1==c||!1==g||!1==d||!1==y)h=!1;if(h){for(z=0;z<g.parts.length;z++)g.parts[z]^=e.parts[z];for(e=
0;e<B.parts.length;e++)B.parts[e]&=g.parts[e];for(g=0;g<d.parts.length;g++)d.parts[g]|=B.parts[g];b.ip=l(c).toLowerCase();b.preview_ip=l(d).toLowerCase()}}else{k||(b.prefix_length=64);y=A.parseIpaddr("::"+b._ip_pd_prx2);if(!1==r||!1==y)h=!1;h&&(b.ip=l(r).toLowerCase(),b.preview_ip=l(r).toLowerCase())}};var r,y;b._type==a.schema.TYPE_STATIC?(g(b),d.set_origin_mode(b,"STATIC")):b._type==a.schema.TYPE_ISP&&(e(b),d.set_origin_mode(b,"ISP",{wan_ifname:b._ip_pd_obj&&b._ip_pd_obj._WANname||void 0,wan_username:b._ip_pd_obj&&
b._ip_pd_obj.name||void 0,subnetid:b._ip_pd_subnetid}));d.set_identifier(b);if(h){var B=angular.copy(b.ip);b.ip="";s(function(){b.ip=B;z(c,"ipv6");a.gridVLAN.chkIpv6Ip()},0)}else b.ip="",z(c,"ipv6"),a.gridVLAN.chkIpv6Ip()};a.ipv6_addr_create_elem=function(b,c,d,g){if(g=!0===g?!0:!1){var e=b[c]=angular.copy(a.schema.ipv6_addr_sample);e.ip="";e.isp={"interface":"WAN1"};e._type=a.schema.TYPE_ISP;e._ip_pd_obj=a.collect_wan_dhcp_pd()[0];a.update_v6_pd_obj(e,d)}else b[c]=void 0;b[c]&&(b[c].enabled=g)};
a.init_origin_type=function(b,c,g){angular.isDefined(b._type)||("ISP"===d.get_origin_mode(b)?b._type=a.schema.TYPE_ISP:b._type=a.schema.TYPE_STATIC,!0!==g&&s(function(){a.update_v6ip(b,c)},0));a.init_type_if_ident(b)};a.init_type_if_ident=function(a){null===a.eui_64&&(a._type_if_ident="EUI_64");angular.isDefined(a._type_if_ident)||(a._type_if_ident="USER_DEFINE")};a.intf_key_handler=function(a,b){b=parseInt(b);var c=!1,g=d.get_vlan_id(a);a&&("l2vlan"==a.type&&g==b)&&(c=!0);return c};a.isExistUnnamedVLANID=
function(a){var b=function(a,b,c){a=d.get_vlan_id(a.entity);return angular.isDefined(a)?!1:!0},c=[];a&&(a.Options&&a.Options.ngGrid&&a.Options.ngGrid.filteredRows)&&(c=m("filter")(a.Options.ngGrid.filteredRows,b));return 0<c.length};(function(){var b=a.func_flag.ipv6_layout,c={editRowH:6*(app.uiGrid.headerRowHeight||32),width:750,editableCellTemplate:t.get("T_vlan_membership_ipv6_address_edit.html")};"DESIGN_2"===b&&(c={editRowH:7*(app.uiGrid.headerRowHeight||32),width:800,editableCellTemplate:t.get("T_vlan_membership_ipv6_address_edit_DESIGN_2.html")});
return c})();a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridVLAN=a.gridVLAN||{};a.gridVLAN.Selections=[];a.gridVLAN.stateObj={editCount:0,editList:[]};a.gridVLAN.procNgClick=function(b){var c=0,d=[];a.gridVLAN.Selections.splice(0);angular.forEach(a.model.vlan_interfaces,function(b,g){b.checked?a.gridVLAN.Selections.push(b):(b.edit=!1,b.editVlanId=!1,b.editEnableManagement=!1);b.edit&&(c++,d.push(g))});a.gridVLAN.stateObj.editCount=c;a.gridVLAN.stateObj.editList=d;a.gridVLAN.check_remove_condition()};
a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};var C=function(a,b,c,d,g){for(var e=a.length,k,h=0,l;h<e;h++){l=a[h];k=!1;for(var r=0,A;r<e;r++)A=a[r],h!==r&&d&&d(A,l,g)&&(k=!0);!k&&c&&(k=c(l));l[b]=k}};a.gridVLAN.chkIpv6Ip=function(){var b=Q,c=V,d=a.collect_svi_ref_list();C(d,"isDupIpv6a0",b,c,{v6_addrx:0});C(d,"isDupIpv6a1",b,c,{v6_addrx:1})};a.gridVLAN.chkIpv4Ip=function(){var b=N,c=M,d=a.collect_svi_ref_list();C(d,"isDupIpv4",b,c)};var D=u.spec_WifiSupport()?a.DICT("VLAN_membership_Device_Management_Note_1"):
a.DICT("VLAN_membership_Device_Management_Note_2");a.gridVLAN.Options=app.uiGrid.generateGridOptions({IDPreifx:"VLANMembership",rowHeight:a.func_flag.ipv6_addr1?2*app.uiGrid.rowHeight:3*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridVLAN.procNgClick,headerChangedCbk:a.gridVLAN.procNgClick,disableChkBoxField:"disableChk"},{field:"vlan_id",displayName:a.DICT("VLAN_membership_VLAN_ID"),id:"VLANMembershipID",validationCbk:"gridInvalidCbk",min:1,max:4093,required:!0,changedCbk:a.sync_vlanid,
editRow:"editVlanId",width:90,invalidField:"invalid",cellTemplate:t.get("UG_table_text_with_inline_number_edit.html")},{field:"name",displayName:a.DICT("VLAN_membership_Name"),width:90},{field:"vlan_inter_vlan_routing",displayName:a.DICT("VLAN_membership_Inter_VLAN_Routing"),id:"VLANMembershipRouting",cellTemplate:t.get("UG_table_checkbox_with_inline_edit.html"),editRow:"edit",width:155},{field:"vlan_enable_management",displayName:a.DICT("VLAN_membership_Device_Managemenet"),id:"VLANMembershipEnableManagement",
cellTemplate:t.get("UG_table_checkbox_with_inline_edit.html"),editRow:"editEnableManagement",width:160,infoField:"info"},{field:"ipv4.address",displayName:a.DICT("VLAN_membership_IPv4_Addr_Mask"),id:"VLANMembershipIPv4",validationCbk:"gridInvalidCbk",cellTemplate:t.get("T_vlan_membership_ipv4_address_edit.html"),editRow:"edit",minWidth:250,width:250},{field:"ipv6.address",displayName:a.DICT("VLAN_membership_IPv6_Addr_Mask"),id:"VLANMembershipIPv6",validationCbk:"gridInvalidCbk",cellTemplate:t.get("T_vlan_membership_ipv6_address_edit.html"),
editRow:"edit",minWidth:600}]});var E=function(b,c){var g=m("filter")(a.model.lan_interfaces,a.ifNamed("^LAN|^LAG"));angular.forEach(g,function(a,g){var e=d.get_vlan_tagged_vlan_id(a);if(e){var k=d.get_vlan_id(b),k=void 0!==k||null!==k?k:"",h=e.indexOf(k);-1==h?"add"==c&&e.push(k):"remove"==c&&e.splice(h,1)}})},I=function(){var a=this,b=createIpAddr();a.ipaddr=b;a.addrObj=void 0;a.parseIpv6addr=function(a){return!b.IPv6.isValid(a)?!1:b.parse(a)};a.ipv6ToNumber=function(b){b=a.parseIpv6addr(b);return a.addrObj=
b};a.numToIpv6=function(b){if(b)return b.toString().toLowerCase();if(a.addrObj)return a.addrObj.toString().toLowerCase()};a.numToIpv6Normal=function(b){if(b)return b.toNormalizedString().toLowerCase();if(a.addrObj)return a.addrObj.toNormalizedString().toLowerCase()};return a},F=function(){var b=32-a.ctx.HWDMZenableCount,c=a.collect_svi_ref_list().length||0,d=a.DICT("VLAN_membership_Vlan_Intf");return c>=b?(a.msg=a.DICT("VLAN_membership_DMZ_Max",{"%s0":a.ctx.HWDMZenableCount?a.DICT("VLAN_membership_DMZ_Enabled"):
"","%s1":b,"%s2":d}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.gridVLAN.add=function(){if(!F()){var b=a.model.vlan_interfaces;a.collect_svi_ref_list();var c;c={name:"VLAN0",type:"l2vlan",enabled:!0,vlan_id:0,editVlanId:!0,edit:!0,editEnableManagement:!0,vlan_inter_vlan_routing:!1,vlan_enable_management:!1,ipv4:{enabled:!0,mtu:1400,address:[{ip:"",subnet:"",prefix_length:null}]},ipv6:{enabled:!0,forwarding:!1,address:[angular.copy(a.schema.ipv6_addr_sample)],setting:{dhcp_pd_enable:!0}},
ipv6_ra:{max_rtr_adv_interval:30},dot1x:{enable:!0,authorized_mode:"auto"},checked:!0,info:D};var g=new I;if(c.ipv6&&c.ipv6.address&&c.ipv6.address[0]&&c.ipv6.address[0].ip){var e=c.ipv6.address[0],k=g.ipv6ToNumber(e.ip);S(c.ipv6.address[0],["^_"],!0);k.parts[1]+=b.length%65535;e._ip_prefix=g.numToIpv6(k);e._if_ident="1"}c._db_exist&&delete c._db_exist;c.vlan_ref&&delete c.vlan_ref;d.set_vlan_id(c,"");c.name=r["l2vlan,vlan"]+"";b.push(c);E(c,"add");a.init_origin_type(c.ipv6.address[0],c);a.gridVLAN.Options.gridApi.customApi.scrollToLast();
a.modified()}};a.gridVLAN.edit=function(){for(var b=a.gridVLAN.Options.data,c=0,d=[],g=b.length-1,e;0<=g;g--)e=b[g],e.checked&&(e.edit=!0,"VLAN1"!==e.name&&(e.editEnableManagement=!0),c++,d.push(g));a.gridVLAN.stateObj.editList=d;s(function(){a.gridVLAN.stateObj.editCount=c},0)};a.gridVLAN.VLAN1Exsit=!1;a.gridVLAN.check_remove_condition=function(){var b=!1,c=a.gridVLAN.Selections;a.gridVLAN.VLAN1Exsit=!1;angular.forEach(c,function(c,d){"VLAN1"==c.name&&(b=!0,a.gridVLAN.VLAN1Exsit=!0)});return b};
a.gridVLAN.remove=function(){var b=[];angular.forEach(a.model.vlan_interfaces,function(a){a.checked&&b.push(a)});a.gridVLAN.checking_before_remove(b,function(){var b=a.model.vlan_interfaces,c;for(c=b.length-1;0<=c;c--)b[c].checked&&(E(b[c],"remove"),b.splice(c,1),H());a.modified()})};var H=function(){var b=function(b){angular.forEach(b,function(a,b){var c=a[".ctx"].port_vlan_map,d;for(d in c)"U"!==c[d]&&(c[d]="U")});var c,g,e=a.collect_port_list();angular.forEach(b,function(b,k){if(null!=d.get_vlan_id(b))for(var h=
e.length;h--;)c=e[h],g=h,a.update_port_vlan_model(k,g,b,c)})},c=a.collect_svi_ref_list();1>=c.length&&b(c);a.gridVLAN.chkIpv4Ip();a.gridVLAN.chkIpv6Ip();a.gridVLAN.procNgClick()};a.gridVLAN.checking_before_remove=function(b,c){a.ctx_delref=a.ctx_delref||{};a.ctx_teleworker=a.ctx_teleworker||{};a.ctx_accessrules=a.ctx_accessrules||{};var d=function(d){var g=!0;d="";for(var e=[{dispStr:"DHCP Settings",refctx:a.ctx_delref["dhcp-pool"]["dhcp-interfaces"],chk_cb:function(a,b){return a.name==b["interface"]}},
{dispStr:"Teleworker VPN Client",refctx:a.ctx_teleworker["teleworker-vpn-clients"]["teleworker-vpn-client"],chk_cb:function(a,b){return a.name=="VLAN"+b.vlan}},{dispStr:"Firewall ACL Rules",refctx:a.ctx_accessrules["firewall-acl-rules"].ipv4["firewall-acl-rule"],chk_cb:function(a,b){return b["interface"]&&b["interface"]["source-interface"]&&a.name==b["interface"]["source-interface"]}}],k=function(a,b,c){angular.forEach(a.refctx,function(d,e){b&&(b.checked&&a.chk_cb(b,d))&&(c.push(a.dispStr),g=!1)})},
h=b.length;h--;){var l=[];k(e[0],b[h],l);k(e[1],b[h],l);k(e[2],b[h],l);0<l.length&&(d+="<div>"+a.DICT("VLAN_membership_VLAN_In_Use",{"%s1":b[h].name,"%s2":"</br>"+l.join("\n")})+"</div></br>")}""!==d&&app.TOOLS.criticalAlertBox({title:a.DICT("Error"),msg:d});g&&c()};if(a.ctx_delref["dhcp-pool"])d();else{var g=function(a,b){a&&(a.data&&a.data.result)&&e.recover_object(a.data.result,b)};n.all({dhcp:function(){return v.post({url:resource_base+"data/lan_dhcp_settings.json",method:"get_dhcp_settings",
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),teleworker:function(){return v.post({url:resource_base+"data/telework_vpn_clients.json",method:"get_teleworker_vpn",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method)}})}(),accessrules:function(){return v.post({url:resource_base+"data/firewall_access_rules.json",method:"get_access_rules",error:function(a){Log(ERROR,"accessRulesCtrl getData error: "+
JSON.stringify(a))}})}()}).then(function(b){g(b.dhcp,{"dhcp-pool":{"dhcp-interfaces":[],"dhcp-option82":[]}});g(b.teleworker,{"teleworker-vpn-clients":{"teleworker-vpn-client":[]}});g(b.accessrules,{"firewall-acl-rules":{ipv4:{"firewall-acl-rule":[]}}});angular.extend(a.ctx_delref,b.dhcp.data.result);angular.extend(a.ctx_teleworker,b.teleworker.data.result);angular.extend(a.ctx_accessrules,b.accessrules.data.result)}).then(function(){d()})}};a.tag_status=function(a,b,c,g){var e=d.get_vlan_id(a),k=
"?";if(d.get_vlan_untagged_vlan_id(b)==e)k="U";else{var h=!1,k="X";(a=d.get_vlan_tagged_vlan_id(b))&&angular.forEach(a,function(a,b){a==e?(k="T",h=!0):h||(k="X")})}return k};a.filter_LAN=function(b,c,d){return b.name.match(/^LAN/)?(void 0!==b.lag_ref&&(a.ctx.inused_lag.push(b.lag_ref),b._greyout=!0),!0):!1};a.filter_LAG=function(b,c,d){return b.name.match(/^LAG/)&&!1!=b.enabled?(0<=a.ctx.inused_lag.indexOf(b.name)||(b._greyout=!0),!0):!1};a.collect_vlan_port_ref_list=function(){a.ctx.inused_lag=[];
var b=m("filter")(a.model.lan_interfaces,a.filter_LAN),c=m("filter")(a.model.lag_interfaces,a.filter_LAG);return b.concat(c)};a.collect_wan=function(){a.filterWANphy={physical:!0,subinterface:!0};return q.filter(a.model.wan_ifstate["interface"],a.filterWANphy)};a.collect_wan_dhcp_pd=function(){var b=a.model.wan_interfaces,c=a.model.wan_ifstate["interface"];a.PD_source||(a.PD_source=h.get_pd_interfaces(b,c));return a.PD_source};a.pd_dispStr=function(a){var b="unavailable",c=d.dhcp_dp.get_dhcp_pd_prefix(a);
c&&(b=c);return a._WANPrefixName+" ("+a._WANname+") - "+b};a.pd_disableCond=function(b){if(a.func_flag.ipv6_pd_undetermined_allow)return!1;d.dhcp_dp.get_dhcp_pd_prefix(b);return!0};a.showLagOwnerStatus=function(b,c){if(c[".ctx"]&&c[".ctx"].port_vlan_map){for(var d=b.lag_ref,g=4,e=a.collect_vlan_port_ref_list(),k=0,h;k<e.length;k++)h=e[k]&&e[k].name,h==d&&(g=k);return a.schema.portmodesHash[c[".ctx"].port_vlan_map[g]]||"(Member of "+d+", but LAG not found)"}};a.update_port_vlan_model=function(b,c,
g,e){var k=a.collect_svi_ref_list();"U"==g[".ctx"].port_vlan_map[c]&&(angular.forEach(k,function(a,b){a.name!=g.name&&"U"==a[".ctx"].port_vlan_map[c]&&(a[".ctx"].port_vlan_map[c]="T")}),d.set_vlan_untagged_vlan_id(e,d.get_vlan_id(g)));var h=!1;d.set_vlan_tagged_vlan_id(e,[]);angular.forEach(k,function(a,b){var g=a[".ctx"].port_vlan_map[c];"T"==g?d.push_vlan_tagged_vlan_id(e,d.get_vlan_id(a)):"U"==g&&(h=!0)});!1==h&&d.set_vlan_untagged_vlan_id(e,"");"ieee8023adLag"==e.type&&G(b,c,g,e)};var G=function(b,
c,d,g){for(var e=a.collect_vlan_port_ref_list(),k=d[".ctx"].port_vlan_map[c],h=0;h<e.length;h++)c=e[h],"ethernetCsmacd"==c.type&&c.lag_ref==g.name&&(d[".ctx"].port_vlan_map[h]=k,a.update_port_vlan_model(b,h,d,c))},J=function(a){for(var b=a%256,c=1;3>=c;c++)a=Math.floor(a/256),b=a%256+"."+b;return b},L=function(a,b){var c=a.split("."),d=32-b,c=(c[0]<<24|c[1]<<16|c[2]<<8|c[3])>>>0>>d<<d>>>0;return{beg:c,end:(c|(1<<d)-1)>>>0}},N=function(b){var c=!1;if(b&&b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].ip&&
b.ipv4.address[0].prefix_length){var d=b.ipv4.address[0],g=L(d.ip,d.prefix_length),d=J(g.beg),g=J(g.end);!1===p.poolValidate("interfaces",b.name,"ipv4",a.subnetObj,d,g,{skipCond:[{type:"interfaces",name:/^VLAN/}]})&&(c=!0)}return c},M=function(a,b){var c=!1;if(a&&b&&a.ipv4&&b.ipv4&&a.ipv4.address&&b.ipv4.address&&a.ipv4.address[0]&&b.ipv4.address[0]&&a.ipv4.address[0].ip&&b.ipv4.address[0].ip&&a.ipv4.address[0].prefix_length&&b.ipv4.address[0].prefix_length){var d=b.ipv4.address[0],g=a.ipv4.address[0],
e=L(d.ip,d.prefix_length),d=e.beg,e=e.end,k=L(g.ip,g.prefix_length),g=k.beg,k=k.end,h=!0;d<=g&&e>=k?h=!1:d<=g&&e>=g?h=!1:d<=k&&e>=k?h=!1:d>=g&&e<=k&&(h=!1);!1==h&&(c=!0)}return c},P=function(a){if(8!==a.length)console.log("error: ip6part.length = "+a.length);else{for(var b,c=[],d=0;7>=d;d++)b=a[d]||0,c.push(b.toString(16));return c.join(":")}},U=function(a,b){for(var c=app.TOOLS.validation.ipv6_getNet(a,b),d=angular.copy(c),g=[0,0,0,0,0,0,0,0],e=128-b,k=7;0<e;)16<=e?(g[k]=65535,e-=16):(g[k]|=(1<<
e)-1>>>0,e=0),k--;for(k=0;k<d.length;k++)d[k]|=g[k];return{beg:c,end:d}},Q=function(b){var c=!1;if(b&&b.ipv6&&b.ipv6.address&&b.ipv6.address[0]&&b.ipv6.address[0].ip&&b.ipv6.address[0].prefix_length){var d=b.ipv6.address[0],g=U(d.ip,d.prefix_length),e=P(g.beg).toLowerCase(),g=P(g.end).toLowerCase();b=p.poolValidateV6("interfaces",b.name,"ipv6",a.subnetObj,e,g,{skipCond:[{type:"interfaces",name:/^VLAN/}]});var k=!1,d=app.TOOLS.ipv6.toFullV6Addr(d.ip).toLowerCase();if(e==d||g==d)k=!0;if(!1===b||!0===
k)c=!0}return c},V=function(a,b,c){var d=!1,g=!1,e=!1,k=function(a,b){if(a&&b&&a.ip&&b.ip&&a.prefix_length&&b.prefix_length){var c=U(a.ip,a.prefix_length),d=P(c.beg).toLowerCase(),c=P(c.end).toLowerCase(),d=app.TOOLS.ipv6.toFullV6ZPAddr(d).toLowerCase(),c=app.TOOLS.ipv6.toFullV6ZPAddr(c).toLowerCase(),g=U(b.ip,b.prefix_length),e=P(g.beg).toLowerCase(),g=P(g.end).toLowerCase(),e=app.TOOLS.ipv6.toFullV6ZPAddr(e).toLowerCase(),g=app.TOOLS.ipv6.toFullV6ZPAddr(g).toLowerCase(),k=!1;d<=e&&c>=g?k=!0:d<=
e&&c>=e?k=!0:d<=g&&c>=g?k=!0:d>=e&&c<=g&&(k=!0);return k}return!1};a&&(b&&a.ipv6&&b.ipv6&&a.ipv6.address&&b.ipv6.address)&&(e=!0);b&&(b.ipv6&&b.ipv6.address&&1<b.ipv6.address.length)&&(g=!0);!d&&g&&(rowE_addrs=b.ipv6.address,!0===k(rowE_addrs[0],rowE_addrs[1])&&(d=!0));if(!d&&e&&(rowE_addrs=b.ipv6.address,item_addrs=a.ipv6.address,b=c&&c.v6_addrx||0,a=k(rowE_addrs[b],item_addrs[0]),k=k(rowE_addrs[b],item_addrs[1]),!0===a||!0===k))d=!0;return d},R=function(b,c){return function(b){if(!b)return!0;a.collect_svi_ref_list();
return{result:!0,invalidRows:[],validRows:[]}}};a.poolValidation=function(a){var b;"ipv6"==a?(a=Q,b=V):(a=N,b=M);return R(a,b)};var K=function(a,b,c,d){var g=[],e;angular.forEach(a,function(a,k){e=!1;angular.forEach(b,function(b,g){d?d(a[c],b[c])&&(e=!0):a[c]===b[c]&&(e=!0)});if(!e){var h={};h[c]=a[c];g.push(h)}});return g},S=function(a,b,c){for(var d=0;d<b.length;d++)if(c)for(var g in a)g.match(b[d])&&delete a[g];else for(g in a)g==b[d]&&delete a[g]},T=function(a,b){if(a[b]&&a[b].address&&a[b].address[0]){var c=
a[b].address[0];S(c,["^_"],!0);null==c.prefix_length&&(c.prefix_length="")}};a.save=function(){var g=a.model.vlan_interfaces.concat(a.model.lan_interfaces).concat(a.model.lag_interfaces),k=angular.copy(g);angular.forEach(k,function(b,c){S(b,["vlan_ref",".ctx","role"]);if(b.ipv6&&b.ipv6.address)for(var g=b.ipv6.address,k=0;k<g.length;k++){var h=g[k];if(h){var l="",r="",y=h._type;if("ISP"===y){for(var l=A.parseIpaddr(h.ip),r=h.prefix_length,z=0;z<l.parts.length;z++)16<=r?r-=16:1<r&&16>r?(l.parts[z]&=
65535-((1<<16-r)-1)>>>0,r=0):l.parts[z]=0;l=l.toString();r=h.prefix_length}else"STATIC"===y&&(l=h._ip_prefix,r=h.prefix_length);y&&l&&(e.recover_object(b,a.use_ipv6ra_prefix_list_sample),l=b.ipv6_ra.prefixes.push({prefix_ip:l,prefix_length:r,preferred_lifetime:3600}),d.set_origin_mode(b.ipv6_ra.prefixes[l-1],y,{wan_ifname:h.isp&&h.isp["interface"]||void 0,wan_username:h._ip_pd_obj&&h._ip_pd_obj.name||void 0,subnetid:h._ip_pd_subnetid}))}}T(b,"ipv4");T(b,"ipv6");void 0!=b._greyout&&delete b._greyout;
void 0!=b.dmz&&delete b.dmz;angular.isDefined(b.checked)&&delete b.checked;angular.isDefined(b.disableChk)&&delete b.disableChk;angular.isDefined(b.info)&&delete b.info;if("http"===x.source){if(g=d.get_vlan_tagged_vlan_id(b))g=angular.copy(g),d.set_vlan_tagged_vlan_id(b,[g.join(" ")])}else(g=d.get_vlan_tagged_vlan_id(b))&&0===g.length&&d.set_vlan_tagged_vlan_id(b,[""])});var h=K(a.model_orig.vlan_interfaces,a.model.vlan_interfaces,"name"),l=function(a,b){var c=A.parseIpaddr(a),d=A.parseIpaddr(b);
return angular.equals(c,d)},g=function(b,c){angular.forEach(a.model.vlan_interfaces,function(d,g){angular.forEach(a.model_orig.vlan_interfaces,function(a,g){if(d.name==a.name&&d[b]&&d[b].address&&0<d[b].address.length&&a[b]&&a[b].address&&0<a[b].address.length){var e=void 0,k=[];"ipv6"==b&&(e=l);k=K(a[b].address,d[b].address,"ip",e);0<k.length&&(k[0]&&""!=k[0].ip)&&(e={name:d.name},e[b]={address:k},c.push(e))}})})},r=[];g("ipv4",r);g("ipv6",r);var y=function(a,b){var c;angular.forEach(a,function(a,
d){b==a.name&&(c=a)});return c},z=function(c,d){var g=y(k,c).ipv4.address[0].ip,e=b.absUrl().replace(d,g),h=function(){s(function(){window.location=e},1E3)};app.TOOLS.criticalAlertBox({msg:"Attempting to redirect to the URL: "+e,btn_yes_str:a.DICT("Click_to_Redirecting"),btn_no_str:a.DICT("Cancel"),cbk:function(a){h();app.transition.In()}});app.transition.Out()},p=!1,u,G,q=function(){var a={redir_flag:!1};G=b.host();if(r[0]&&r[0].ipv4&&r[0].ipv4.address&&r[0].ipv4.address[0]&&r[0].ipv4.address[0].ip){var c=
r[0].ipv4.address[0].ip;u=r[0].name;G==c&&(p=!0,c=y(k,u).ipv4.address[0].ip,a.redir_flag=!0,a.admin_if_name=u,a.currIp=G,a.newIp=c)}return a},M=[],w=function(){var a={};O.vlan_t_cfg_to_db({interfaces:k},a);a.interfaces["interface"].concat([]);M.push({method:"set_vlan_membership",params:a})},D=function(){var b=function(){!0==p?z(u,G):(c(),a.reset_state());a.resetModified()},d=function(){var a=2,b=m("filter")(k,B).length||0,a=a+(1*(h.length||0)+(3*b+0*((k.length||0)-b)));return 1E3*a};0<h.length&&M.push({method:"del_interface",
params:{interfaces:{"interface":h}}});w();(function(){v.post({forcedUsingPost:!0,url:resource_base+"data/rpc_result.json",method:"set_bulk",params:M,timeout:p?d():void 0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url+" method: "+this.method);0===a.status&&b()}}).then(function(c){c.data.result&&c.data.result.code&&0!==c.data.result.code?(p=!1,c="Can not delete, following Tables is in use:<br/>"+c.data.result.errstr+"<br/><br/>",app.TOOLS.criticalAlertBox({msg:c+
"Apply failed, and reloading settings from device",cbk:function(a){b()}})):(a.success=!0,b())})})()};(function(){var b=q();if(b.redir_flag){var c="Notice: This device's management IP address "+b.admin_if_name+"("+b.currIp+") is requested to change.<br/><br/>",c=c+"Please update Browser's location bar with new IP address "+(" <em>"+b.newIp+"</em> "),c=c+" when your networking environment is ready.<br/>",c=c+" Continue?";app.TOOLS.warningAlertBox({msg:c,cbk:function(a){a&&D()},btn_yes_str:a.DICT("VLAN_membership_Click_to_Redirect"),
btn_no_str:a.DICT("Cancel")})}else D()})()};a.reset_state=function(){a.ctx_delref={};a.ctx.flagPortEditable=!1};a.cancel=function(){c();a.reset_state();a.resetModified()};var O=new data_transform_vlan({Sets:e});c()}]);
var data_transform_vlan=function(a){if(!b||!b.VERSION)var b={each:angular.forEach,assign:$.extend,defaults:function(b,n){a.Sets.recover_object(b,n);return b}};this.vlan_t_db_to_cfg=function(a,n){var v=(a.interfaces||{})["interface"]||[];n=n||{};var t=n.interfaces=[],m=!1,q=function(a,b){void 0!==a["static"]&&(b["static"]=a["static"]);if(a.isp){var e=a.isp,p=e.suffix&&e.suffix.toString(16).toUpperCase();b.isp={"interface":e["interface"],prefix_name:e["prefix-name"],suffix:p||"0"}}},e=function(a,e){if(a["ipv6-router-advertisements"]){var h=
a["ipv6-router-advertisements"],p=e.ipv6_ra={enabled:h["send-advertisements"],mode:h.mode,max_rtr_adv_interval:h["max-rtr-adv-interval"],managed_flag:h["managed-flag"],other_config_flag:h["other-config-flag"],router_preference:h["router-preference"],link_mtu:h["link-mtu"],default_lifetime:h["default-lifetime"]};if(h["prefix-list"]&&h["prefix-list"].prefix){var h=h["prefix-list"].prefix,u=p.prefixes=[];b.each(h,function(a){var b=a["prefix-spec"].split("/"),b=u.push({prefix_ip:b[0],prefix_length:b[1],
preferred_lifetime:a["preferred-lifetime"]});q(a,u[b-1])})}}};(function(){for(var a=0,l;a<v.length;a++){l=v[a];var h={name:l.name,type:l.type,enabled:l.enabled};m="VLAN1"===l.name?!0:!1;if(l["vlan-interface-settings"]){var p=l["vlan-interface-settings"];h.vlan_id=p["vlan-id"];h.vlan_inter_vlan_routing=p["inter-vlan-routing"];h.vlan_enable_management=void 0!==p["enable-management"]?p["enable-management"]:m}l["vlan-settings"]&&(p=l["vlan-settings"],h.vlan_untagged_vlan_id=p["untagged-vlan-id"]||"",
p["tagged-vlans"]&&(h.vlan_tagged_vlan_id=p["tagged-vlans"]["vlan-id"]||[]));if(l.ipv4){var p=l.ipv4,u=h.ipv4={enabled:p.enabled};if(p.address){var x=p.address,r=u.address=[];b.each(x,function(a){r.push({ip:a.ip,prefix_length:a["prefix-length"]})})}}l.ipv6&&(p=l.ipv6,u=h.ipv6={enabled:p.enabled},p.address&&(x=p.address,r=u.address=[],b.each(x,function(a){var b=r.push({ip:a.ip,preview_ip:a.ip,prefix_length:a["prefix-length"]});q(a,r[b-1]);b=r[b-1];void 0!==a["eui-64"]&&(b.eui_64=a["eui-64"]);a["user-define"]&&
(b.user_define=a["user-define"])})),p.setting&&(x=p.setting,u.setting={dhcp_pd_enable:x["dhcp-pd-enable"],prefix_name:x["prefix-name"]}),e(p,h));l["lag-ref"]&&(h.lag_ref=l["lag-ref"]);l.dmz&&(p=l.dmz,u=h.dmz={enabled:p.enable});t.push(h)}})()};this.vlan_t_cfg_to_db=function(a,n){var v=a.interfaces||[];b.assign(n,{interfaces:{"interface":[]}});var t=n.interfaces.interface,m=function(a,b){void 0!==a["static"]&&(b["static"]=a["static"]);if(a.isp){var e=a.isp,p=e.suffix&&parseInt(e.suffix,16);b.isp={"interface":e["interface"],
suffix:p}}},q=function(a,b){void 0!==a.eui_64&&(b["eui-64"]=a.eui_64);a.user_define&&(b["user-define"]=a.user_define)},e=function(a,e){if(a.ipv6_ra){var h=a.ipv6_ra;e=b.defaults(e,{ipv6:{}});var p=e.ipv6["ipv6-router-advertisements"]={"send-advertisements":h.enabled,mode:h.mode,"max-rtr-adv-interval":h.max_rtr_adv_interval,"managed-flag":h.managed_flag,"other-config-flag":h.other_config_flag,"router-preference":h.router_preference,"link-mtu":h.link_mtu,"default-lifetime":h.default_lifetime};if(h.prefixes){var h=
h.prefixes,p=p["prefix-list"]={prefix:[]},u=p.prefix;b.each(h,function(a){var b=u.push({"prefix-spec":a.prefix_ip+"/"+a.prefix_length,"preferred-lifetime":a.preferred_lifetime});m(a,u[b-1])})}}};(function(){b.each(v,function(a){var l={name:a.name};a.type&&b.assign(l,{type:a.type,enabled:a.enabled});void 0!==a.vlan_id&&(l["vlan-interface-settings"]={"vlan-id":a.vlan_id,"inter-vlan-routing":a.vlan_inter_vlan_routing,"enable-management":a.vlan_enable_management});b.defaults(l,{"vlan-settings":{}});var h=
l["vlan-settings"];h["untagged-vlan-id"]=void 0!==a.vlan_untagged_vlan_id?a.vlan_untagged_vlan_id:"";if(a.vlan_tagged_vlan_id){b.defaults(l,{"vlan-settings":{"tagged-vlans":{}}});for(h=0;h<a.vlan_tagged_vlan_id.length;h++)a.vlan_tagged_vlan_id[h]+="";h=l["vlan-settings"];h["tagged-vlans"]["vlan-id"]=a.vlan_tagged_vlan_id}if(a.ipv4){var p=a.ipv4,h=l.ipv4={enabled:p.enabled};if(p.address){var p=p.address,u=h.address=[];b.each(p,function(a){u.push({ip:a.ip,"prefix-length":a.prefix_length})})}}if(a.ipv6&&
(p=a.ipv6,h=l.ipv6={enabled:p.enabled},p.address))for(var p=p.address,u=h.address=[],h=0,x;h<p.length;h++)if(x=p[h]){var r=u.push({ip:x.ip,"prefix-length":x.prefix_length});m(x,u[r-1]);q(x,u[r-1])}e(a,l);a.lag_ref&&(l["lag-ref"]=a.lag_ref);t.push(l)})})()};return this};app.controller("VLANSettingsCtrl",["$scope","MyHttp","DHCP_PD","ipv6_lib","ipv4_lib","subnet_lib","$q","UserSession","userAccessRight","modelInfo","$templateCache",function(a,b,s,n,v,t,m,q,e,w,l){var h=app.TOOLS.getResponse,p=app.TOOLS.getVal,u=app.TOOLS.str2int,x=app.TOOLS.netmask.int2Inet,r=app.TOOLS.netmask.inet2Int,d=createIpAddr(),c=app.TOOLS.int2BinaryMask,k=w.spec_WifiSupport()?a.DICT("VLAN_membership_Device_Management_Note_1"):a.DICT("VLAN_membership_Device_Management_Note_2"),g,z=function(){g&&
clearTimeout(g);g=setTimeout(function(){app.TOOLS.apply(a);g=void 0},50)};a.userAccessFlag=e.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&q.logout();var y=function(){return b.post({url:resource_base+"data/lan_vlan_membership.json",method:"get_vlan_membership",error:function(a){Log(ERROR,"[VLANSettingsCtrl] getVLANMembership() error:"+JSON.stringify(a))}})},A=function(b){b||(b={});var c=M(),d=!1,g=b["vlan-interface-settings"]||{},d="VLAN1"===b.name?!0:!1,d={checked:!1,edit:!1,edit_mgnt:!1,
edit_new:!1,is_new:!1,vld:{invalid:!1,id:!1,v4RANSubS:!1,v4RANSubE:!1,v4RANIP:!1,v6RANSubS:!1,v6RANSubE:!1,v6RANIP:!1,v4OverlapWithOtherVlans:!1,v6OverlapWithOtherVlans:!1,v4OverlapWithOtherFeatrues:!1,v6OverlapWithOtherFeatrues:!1},tags:D(),name:p(b.name,""),description:p(b.description,""),enabled:p(b.enabled,!0),info:k,if_setting:{vlan_id:p(g["vlan-id"],""),inter_vlan_routing:p(g["inter-vlan-routing"],!0),enable_management:p(g["enable-management"],d)},pool_id:"",ipv4:{},ipv6:{},empty:""};(function(a,
b){var d=b.ipv4||{},d=d.address&&d.address[0]||{},d={enabled:!0,ip:p(d.ip,""),prefix_len:u(p(d["prefix-length"],24)),netmask:"",last_ip:"",first_ip:"",display:[],dhcp:c.ipv4};0===d.prefix_len&&(d.prefix_len=24);d.ip&&_.isNumber(d.prefix_len)&&(d.last_ip=v.get_last_ip(d.ip,d.prefix_len).toString(),d.first_ip=v.get_first_ip(d.ip,d.prefix_len).toString());d.netmask=x(d.prefix_len);a.ipv4=d})(d,b);(function(a,b){var d=b.ipv6||{},g=d.address&&d.address[0]||{},e=d["ipv6-router-advertisements"]||{},d={enabled:p(d.enabled,
!0),preview:"",max_rtr_adv_interval:p(e["max-rtr-adv-interval"],30),type:"static",prefix:"",prefix_len:u(p(g["prefix-length"],64)),sub_prefix:"",wan_pd:"",suffix_type:"static",suffix:p(g["user-define"],"1"),last_ip:"",first_ip:"",display:[],dhcp:c.ipv6};if(g.isp)(e=p(g.isp.suffix,""))&&(e=u(e).toString(16)),d.type="isp",d.sub_prefix=e+"",d.wan_pd=p(g.isp["interface"],"");else if(e=p(g.ip,""))if(e=n.parse(e))d.prefix=n.get_prefix(e,d.prefix_len).toString();g.hasOwnProperty("eui-64")&&(d.suffix_type=
"eui64");if("static"===d.suffix_type&&(void 0===g["user-define"]&&g.ip)&&(g=n.parse(g.ip)))g=n.get_suffix(g,d.prefix_len),g=g.toString().replace("::",""),d.suffix=g;a.ipv6=d})(d,b);a.ipv6.updatePreview(d);d.ipv6.preview&&aa(d);return d},B=function(b){b||(b={});b=b.interfaces&&b.interfaces["interface"]||[];a.model.vlans=[];angular.forEach(b,function(b){b.name.match(/^VLAN\d+$/)&&a.model.vlans.push(A(b))});angular.forEach(a.model.vlans,function(a){"isp"===a.ipv6.type&&W(a)});a.model.vlans.sort(function(a,
b){return a.if_setting.vlan_id-b.if_setting.vlan_id})},C=function(b){b||(b={});b=b.interfaces&&b.interfaces["interface"]||[];var c,d,g=[],e=[],k;a.model.tag_lan_list=[];a.model.utagged_vlanid2Lan={};a.model.tagged_vlanid2Lan={};a.model.dmz_port="";a.model.lagname_2_lans={};a.model.vlanname_to_lag={};angular.forEach(b,function(b){if(b.name.match(/^(LAN\d+|LAG\d+)$/)){if(b.name.match(/^LAN\d+$/)){if(b["lag-ref"]){a.model.lagname_2_lans[b["lag-ref"]]||(a.model.lagname_2_lans[b["lag-ref"]]=[]);a.model.lagname_2_lans[b["lag-ref"]].push(b.name);
a.model.vlanname_to_lag[b.name]=b["lag-ref"];return}g.push(b.name)}else if(b.enabled)e.push(b.name);else return;c=b["vlan-settings"]||{};void 0!==c["untagged-vlan-id"]&&(a.model.utagged_vlanid2Lan[c["untagged-vlan-id"]]||(a.model.utagged_vlanid2Lan[c["untagged-vlan-id"]]={}),a.model.utagged_vlanid2Lan[c["untagged-vlan-id"]][b.name]=!0);c["tagged-vlans"]&&(d=c["tagged-vlans"]["vlan-id"]||[],angular.forEach(d,function(c){k=parseInt(c,10);a.model.tagged_vlanid2Lan[k]||(a.model.tagged_vlanid2Lan[k]={});
a.model.tagged_vlanid2Lan[k][b.name]=!0}));b.dmz&&b.dmz.enable&&(a.model.dmz_port=b.name)}});g=g.sort(function(a,b){var c=a.match(/^(LAN)(\d+)$/),d=b.match(/^(LAN)(\d+)$/);if(!c||!d)return 0;c=u(c[2]);d=u(d[2]);return c>d?1:-1});e=e.sort(function(a,b){var c=a.match(/^(LAG)(\d+)$/),d=b.match(/^(LAG)(\d+)$/);if(!c||!d)return 0;c=u(c[2]);d=u(d[2]);return c>d?1:-1});a.model.tag_lan_list=g.concat(e)},D=function(){var b={},c=a.model.dmz_port;angular.forEach(a.model.tag_lan_list,function(a){b[a]={value:a===
c?"E":"T",is_dmz:a===c}});return b},E=function(){return b.post({url:resource_base+"data/system_summary.json",method:"get_interface_state",params:{filter:"VLAN"},error:function(a){Log(ERROR,"[VLANSettingsCtrl] getInterfaceState() error:"+JSON.stringify(a))}})},I=function(b){b||(b={});b=b["interfaces-state"]&&b["interfaces-state"]["interface"]||[];a.model.ifs_state={};angular.forEach(b,function(b){"VLAN1"===b.name&&(a.model.mac=p(b["phys-address"],""));a.model.ifs_state[b.name]={name:p(b.name,""),phys_addr:p(b["phys-address"],
"")}})},F=function(b){b||(b={});var c=b.subnets||{};b=c.ipv4||[];var c=c.ipv6||[],d;for(d=b.length-1;0<=d;d--)b[d].name.match(/^VLAN\d+/)&&b.splice(d,1);for(d=c.length-1;0<=d;d--)c[d].name.match(/^VLAN\d+/)&&c.splice(d,1);a.model.remain_subnets={ipv4:b,ipv6:c}},H=function(b,c){b||(b=[]);c||(c=[]);var d=s.get_pd_list(b.interfaces&&b.interfaces["interface"]||[],c["interfaces-state"]&&c["interfaces-state"]["interface"]||[]);a.model.pd_list=[{id:"",prefix_name:"",display_name:a.DICT("VLAN_membership_Prefix_From_DHCP_PD"),
pd_prefix:"",prefix_len:"",prefix:""}];a.model.pd_list=a.model.pd_list.concat(d)},G=function(){return b.post({url:resource_base+"data/get_wan_ipv6_prefix.json",method:"get_wan_ipv6_prefix",error:function(b){Log(ERROR,"[VLANSettingsCtrl] getWANIPv6Prefix() error:"+JSON.stringify(b));b={};a.model.pd_list=s.update_pd_state(a.model.pd_list,b["interfaces-state"]&&b["interfaces-state"]["interface"]||[])}})},J=function(){return b.post({url:resource_base+"data/opendns.json",method:"get_opendns",error:function(a){Log(ERROR,
"[VLANSettingsCtrl] getOpendns() error:"+JSON.stringify(a));L({})}})},L=function(b){b||(b={});a.model.opendns=p((b.opendns||{}).enabled,!1)},N=function(){return b.post({url:resource_base+"data/lan_dhcp_settings.json",method:"get_dhcp_settings",error:function(a){Log(ERROR,"[VLANSettingsCtrl] getDHCPPools() error:"+JSON.stringify(a))}})},M=function(b){b||(b={});var c=b.ipv4||{},d=b.ipv6||{},g=c["dhcp-options"]||{},e=c["network-boot"]||{},k=function(a){var b;if(2>a.length)for(b=a.length;2>b;b++)a.push("")};
b={pool_id:p(b["pool-id"],""),ipv4:{lease_time:p(c["lease-time"],1440),dns_type:p(c["dns-server-type"],"dns-server-proxy"),dns:[],dhcp_mode:p(c["dhcp-mode"],"disable"),range_start:p(c["range-start"],""),range_end:p(c["range-end"],""),wins_server:p(c["wins-server"],""),relay_ip:"",enable_network_boot:p(e.enabled,!1),next_server:p(e["next-server"],""),boot_file:p(e["boot-file"],""),option43:p(g.option43,""),option66:p(g.option66,""),option67:p(g.option67,""),option150:p(g.option150,"")},ipv6:{lease_time:p(d["lease-time"],
1440),dns_type:p(d["dns-server-type"],"dns-server-proxy"),dns:[],dhcp_mode:p(d["dhcp-mode"],"disable"),relay_ip:"",range_start:p(d["range-start"],""),range_start_prefix:"",range_start_suffix:"",range_end:p(d["range-end"],""),range_end_prefix:"",range_end_suffix:"",prefix:p(d.prefix,"")}};a.model.opendns?(b.ipv4.dns_type="opendns",b.ipv4.dns=["208.67.222.222","208.67.220.220"]):(c=c.dns&&c.dns["static-dns-servers"]||[],k(c),b.ipv4.dns=c);c=d.dns&&d.dns["static-dns-servers"]||[];k(c);b.ipv6.dns=c;return b},
P=function(b){b||(b={});var c=b["dhcp-pool"]&&b["dhcp-pool"]["dhcp-interfaces"]||[],d=b["dhcp-pools"]&&b["dhcp-pools"].pool||[];b=b["dhcp-pool"]&&b["dhcp-pool"]["dhcp-option82"]||[];var g,e,k;a.model.dhcp_pools={};a.model.vlan_to_pool={};a.model.dhcp_option82={};a.model.dhcp_opt82_pools={};a.model.resetOption82=!1;angular.forEach(c,function(b){g=p(b["server-mode"]["dhcp-pool"],"");k=e="";b["relay-mode"]&&b["relay-mode"]["relay-ipv4-address"]&&(e=b["relay-mode"]["relay-ipv4-address"]);b["relay-mode"]&&
b["relay-mode"]["relay-ipv6-address"]&&(k=b["relay-mode"]["relay-ipv6-address"]);a.model.vlan_to_pool[b["interface"]]={pool_id:g,relay_ipv4_address:e,relay_ipv6_address:k}});angular.forEach(b,function(b){g=b["dhcp-pool"];5E3>g&&(a.model.resetOption82=!0);a.model.dhcp_option82[g]=angular.copy(b)});angular.forEach(d,function(b){g=b["pool-id"];a.model.dhcp_option82[g]?a.model.dhcp_opt82_pools[g]=angular.copy(b):a.model.dhcp_pools[g]=M(b)})},U=function(){var b=document.location.hostname,c=d.IPv4.isValid(b),
g=d.IPv6.isValid(b.replace("[","").replace("]","")),e;a.model.used_vlan_link={vlan_name:"",isIPv4:!0};g?(a.model.used_vlan_link.isIPv4=!1,e=n.parse(b.replace("[","").replace("]",""))):e=v.parse(b);angular.forEach(a.model.vlans,function(d){Q(d);e&&(c?d.ipv4.ip===b&&(a.model.used_vlan_link.vlan_name=d.name):e.toNormalizedString()===d.ipv6.preview&&(a.model.used_vlan_link.vlan_name=d.name))})},Q=function(b){var c=b.ipv4,d=b.ipv6,g,e,k,h,r;c.display=[];d.display=[];a.ipv6.updatePreview(b);c.ip&&(c.display.push(c.ip+
"/"+c.prefix_len),c.display.push(c.netmask));g="-";switch(c.dhcp.dhcp_mode){case "server":g=a.DICT("LAN_DHCP_Settings_DHCP_Server")+" "+c.dhcp.range_start+"-"+c.dhcp.range_end;break;case "disable":g=a.DICT("LAN_DHCP_Settings_DHCP_Disabled");break;case "relay":g=a.DICT("LAN_DHCP_Settings_DHCP_Relay")+" "+c.dhcp.relay_ip}c.display.push(g);g="-";c="";e=void 0;d.preview&&(r=n.parse(d.preview));h=k="N/A";switch(d.type){case "static":r&&(g=r.toString(),g=g+"/"+d.prefix_len);(tmp=n.parse(d.dhcp.range_start))&&
(k=n.combined_two_ip(r,tmp,d.prefix_len));(tmp=n.parse(d.dhcp.range_end))&&(h=n.combined_two_ip(r,tmp,d.prefix_len));d.display.push(g);break;case "isp":angular.forEach(a.model.pd_list,function(a){a.id===d.wan_pd&&(e=a)});if(!e||!r){Log(ERROR,"[VLANSettingsCtrl] VLAN "+b.description+" PD is not existed at PD List");Log(ERROR,"[VLANSettingsCtrl] IPv6 Preview "+r);break}e.prefix?(c=r.toString()+"/"+d.prefix_len,(tmp=n.parse(d.dhcp.range_start))&&(k=n.combined_two_ip(r,tmp,d.prefix_len)),(tmp=n.parse(d.dhcp.range_end))&&
(h=n.combined_two_ip(r,tmp,d.prefix_len))):(c=e.prefix_name+"("+e.id+") + "+d.sub_prefix+" + ::"+d.suffix+"/"+d.prefix_len,k=e.prefix_name+"("+e.id+") + "+d.sub_prefix+" + ::"+d.dhcp.range_start_suffix,h=e.prefix_name+"("+e.id+") + "+d.sub_prefix+" + ::"+d.dhcp.range_end_suffix);d.display.push(c)}g="-";switch(d.dhcp.dhcp_mode){case "server":g=a.DICT("LAN_DHCP_Settings_DHCP_Server")+" "+k+" - "+h;break;case "disable":g=a.DICT("LAN_DHCP_Settings_DHCP_Disabled");break;case "relay":g=a.DICT("LAN_DHCP_Settings_DHCP_Relay")+
" "+d.dhcp.relay_ip}d.display.push(g)},V=function(){var b=a.model.utagged_vlanid2Lan,c=a.model.tagged_vlanid2Lan,d=a.model.dmz_port,g;angular.forEach(a.model.vlans,function(e){g=e.if_setting.vlan_id;angular.forEach(e.tags,function(a,b){e.tags[b].is_dmz=d===b?!0:!1;e.tags[b].value="E"});b[g]&&angular.forEach(b[g],function(a,b){a&&b!==d&&(e.tags[b].value="U")});c[g]&&angular.forEach(c[g],function(b,c){c!==a.model.dmz_port&&(e.tags[c].value="T")})})},R=function(){angular.forEach(a.model.vlans,function(a){K(a)})},
K=function(b){var c,d,g,e,k=b.ipv6;d=a.model.vlan_to_pool[b.name];void 0!==d?(c=a.model.dhcp_pools[d.pool_id]?a.model.dhcp_pools[d.pool_id]:M(),c.ipv4.relay_ip=d.relay_ipv4_address,c.ipv6.relay_ip=d.relay_ipv6_address):c=M();"isp"===k.type?(e="N/A",angular.forEach(a.model.pd_list,function(a){a.id===k.wan_pd&&(e=a.prefix_name)}),d=e+" + "+k.sub_prefix,g=e+" + "+k.sub_prefix):g=d=k.prefix;c.ipv6.range_start_prefix=d;c.ipv6.range_end_prefix=g;c.ipv6.range_start&&(e=n.parse(c.ipv6.range_start))&&(d=n.get_suffix(e,
k.prefix_len).toString().replace("::",""));c.ipv6.range_end&&(e=n.parse(c.ipv6.range_end))&&(g=n.get_suffix(e,k.prefix_len).toString().replace("::",""));c.ipv6.range_start_suffix=d;c.ipv6.range_end_suffix=g;b.pool_id=c.pool_id;b.ipv4.dhcp=angular.copy(c.ipv4);b.ipv6.dhcp=angular.copy(c.ipv6)},S=function(){m.all([y(),G(),N(),J(),E(),b.post({url:resource_base+"data/aaa.json",method:"get_subnet"})]).then(function(b){H(h(b,0),h(b,1));P(h(b,2));L(h(b,3));I(h(b,4));C(h(b,0));B(h(b,2));F(h(b,5));T();R();
U();V();O();a.checkUntaggedPort();a.model.edit_tag=!1;a.model.orig_vlans=angular.copy(a.model.vlans);a.gridVLANSettingOptions.data=a.model.vlans;a.gridTagsOptions.data=a.model.vlans;a.ui_data.data_ready=!0;a.resetModified();setTimeout(function(){a.gridVLANSettingOptions.gridApi&&a.gridVLANSettingOptions.gridApi.core.notifyDataChange("all");app.TOOLS.apply(a)},50)})},T=function(){if(!a.gridTagsOptions){var b=[{field:"if_setting.vlan_id",width:65,displayName:a.DICT("VLAN_membership_VLAN_ID"),enableSorting:!1}],
c="",d,g=a.model.lagname_2_lans;angular.forEach(a.model.tag_lan_list,function(a){c="";d=app.uiGrid.computeHeaderWidth(a,!1);g[a]&&(c=g[a].join(", "),d+=25);b.push({field:"tags."+a,width:d,enableSorting:!1,lagLanGroup:c,displayName:a,headerCellTemplate:"UG_vlan_setting_tags_header.html",cellTemplate:"UG_vlan_setting_tags.html"})});b.push({field:"empty",isEmpty:!0});a.gridTagsOptions=app.uiGrid.generateGridOptions({columnDefs:b})}},O=function(){a.ui_data.vlan_selected_cnt=0;a.ui_data.vlan1_is_selected=
!1;angular.forEach(a.model.vlans,function(b){b.checked?(a.ui_data.vlan_selected_cnt+=1,"VLAN1"===b.name&&(a.ui_data.vlan1_is_selected=!0)):(Q(b),b.edit=!1,b.edit_new=!1,b.edit_mgnt=!1)});z()};a.ui_data={data_ready:!1,success:!1,vlan_selected_cnt:0,vlan1_is_selected:!1,untagged_is_invalid:!1};a.schema={dns_server:[{id:"dns-server-proxy",display_name:a.DICT("VLAN_membership_DNS_Server_Proxy")},{id:"dns-server-provided-isp",display_name:a.DICT("VLAN_membership_DNS_Server_Provided_ISP")},{id:"dns-server-static",
display_name:a.DICT("VLAN_membership_DNS_Server_Static")}],opendns_dns_server:[{id:"opendns",display_name:a.DICT("VLAN_membership_DNS_Server_Provided_Opendns")}],tags_list:[{id:"U",display_name:"U",popover:a.DICT("VLAN_membership_Untagged")},{id:"T",display_name:"T",popover:a.DICT("VLAN_membership_Tagged")},{id:"E",display_name:"E",popover:a.DICT("VLAN_membership_Excluded")}]};a.model={pd_list:[],vlans:[],used_vlan_link:{},dmz_port:"",edit_tag:!1,tag_lan_list:[],utagged_vlanid2Lan:{},tagged_vlanid2Lan:{},
vlanname_to_lag:{},lagname_2_lans:{},isp_dns:{ipv4:[],ipv6:[]},ifs_state:{},mac:"",dhcp_pools:{},vlan_to_pool:{},dhcp_option82:{},dhcp_opt82_pools:{},orig_vlans:[],opendns:!1,remain_subnets:{ipv4:[],ipv6:[]}};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridVLANSettingOptions=app.uiGrid.generateGridOptions({dynamicRowHeight:!0,rowHeight:76,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:O,headerChangedCbk:O,disableChkBoxField:"disableChk"},{field:"if_setting.vlan_id",
displayName:a.DICT("VLAN_membership_VLAN_ID"),editRow:"edit_new",invalidField:"vld.id",validationCbk:"gridInvalidCbk",id:"VLANMembershipID",min:1,max:4093,required:!0,changedCbk:function(b,c,d,g){var e=c.entity;angular.forEach(a.model.vlans,function(a){a.vld.id=!1});angular.forEach(a.model.vlans,function(a,c){b!==c&&e.if_setting.vlan_id===a.if_setting.vlan_id&&(e.vld.id=!0,a.vld.id=!0)});e.vld.id||!_.isNumber(e.if_setting.vlan_id)?e.description="VLAN":e.description="VLAN"+e.if_setting.vlan_id},width:90,
cellTemplate:l.get("UG_table_text_with_inline_number_edit.html").replace(/data-ng-expansion/,'size="4" maxlength="4" minlength="1"')},{field:"description",displayName:a.DICT("VLAN_membership_Name"),width:90,enableSorting:!1,cellTemplate:"UG_table_text_with_inline_edit.html"},{field:"if_setting.inter_vlan_routing",displayName:a.DICT("VLAN_membership_Inter_VLAN_Routing"),id:"VLANMembershipRouting",enableSorting:!1,cellTemplate:l.get("UG_table_checkbox_with_inline_edit.html"),editRow:"edit",width:65,
minWidth:65,isWrapHeader:!0},{field:"if_setting.enable_management",displayName:a.DICT("VLAN_membership_Device_Managemenet"),id:"VLANMembershipEnableManagement",cellTemplate:l.get("UG_table_checkbox_with_inline_edit.html"),editRow:"edit_mgnt",infoField:"info",enableSorting:!1,isWrapHeader:!0,width:105,minWidth:105},{field:"ipv4",displayName:a.DICT("VLAN_membership_IPv4_Addr_Mask"),id:"VLANMembershipIPv4",validationCbk:"gridInvalidCbk",invalidField:{"vld.v4_range_subnet":"dnValidSubnet","vld.v4_ip_range":"dnIpRange"},
enableSorting:!1,editRow:"edit",cellTemplate:"UG_vlan_setting_ipv4_settings.html",width:350,minWidth:350},{field:"ipv6",displayName:a.DICT("VLAN_membership_IPv6_Addr_Mask"),id:"VLANMembershipIPv6",validationCbk:"gridInvalidCbk",editRow:"edit",cellTemplate:"UG_vlan_setting_ipv6_settings.html",minWidth:500,enableSorting:!1}]});a.gridTagsOptions=void 0;var W=function(b){var c="",d=1,g=a.model.vlans,e=b.ipv6.prefix_len,k=!1;_.isNumber(e)||(e=64);for(_.isNumber(b.if_setting.vlan_id)&&(c="fec0:"+b.if_setting.vlan_id+
"::");!k&&!(angular.forEach(g,function(a){!k&&a.ipv6.preview&&_.isNumber(a.ipv6.prefix_len)&&n.vld.is_overlap_between_prefixs(c+"/"+e,a.ipv6.preview+"/"+a.ipv6.prefix_len)&&(c="")}),c?k=!0:c="fec0:"+d+"::",d+=1,4093<d););b.ipv6.prefix=c},Y=function(b){for(var c=2,d=a.model.vlans,g=!1;4093>=c;){g=!0;angular.forEach(d,function(a){c===a.if_setting.vlan_id&&(g=!1)});if(g)break;c+=1}b.description="VLAN"+c;b.if_setting.vlan_id=c},X=function(b){var c="",d=a.model.vlans,g=1,e=b.ipv4.prefix_len,k=a.model.remain_subnets,
h,r=!1;_.isNumber(e)||(e=24);_.isNumber(b.if_setting.vlan_id)&&(c="192.168."+b.if_setting.vlan_id+".1",h={start:v.get_first_ip(c,e).toString(),end:v.get_last_ip(c,e).toString()});for(;!r&&!(t.check_ipv4_range_is_overlap_with_entity(h,k.ipv4).is_overlap?c="":angular.forEach(d,function(a){!r&&a.ipv4.ip&&_.isNumber(a.ipv4.prefix_len)&&v.vld.is_overlap_between_subnets(c+"/"+e,a.ipv4.ip+"/"+a.ipv4.prefix_len)&&(c="")}),c?r=!0:(c="192.168."+g+".1",h={start:v.get_first_ip(c,e).toString(),end:v.get_last_ip(c,
e).toString()}),g+=1,4093<g););b.ipv4.ip=c},da=function(a){Y(a);X(a);W(a);return a};a.funs={add:function(){var b=32;a.model.dmz_port&&(b-=1);a.model.vlans.length>=b?(b=a.DICT("VLAN_membership_DMZ_Max",{"%s0":a.model.dmz_port?a.DICT("VLAN_membership_DMZ_Enabled"):"","%s1":b,"%s2":a.DICT("VLAN_membership_Vlan_Intf")}),app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})):(b=A(),b.checked=!0,b.edit=!0,b.is_new=!0,b.edit_new=!0,b.edit_mgnt=!0,b=da(b),Q(b),a.modified(),a.model.vlans.push(b))},edit:function(){angular.forEach(a.model.vlans,
function(b){b.checked&&(b.edit=!0,b.is_new&&(b.edit_new=!0),"VLAN1"!==b.name&&(b.edit_mgnt=!0),a.ipv6.updatePreview(b))});z()},edit_tag:function(){a.model.edit_tag=!0},del:function(){if(!a.ui_data.vlan1_is_selected){var b=a.model.vlans;for(i=b.length-1;0<=i;i--)b[i].checked&&b.splice(i,1);a.checkTags();a.modified()}},checkAndSave:function(){var b=a.model.used_vlan_link.isIPv4,c=a.model.used_vlan_link.vlan_name,d=a.model.vlans,g,e=!1,k,h;angular.forEach(a.model.orig_vlans,function(a){a.name===c&&(g=
a)});g?(angular.forEach(d,function(d){d.name="VLAN"+d.if_setting.vlan_id;d.name===c&&(b?g.ipv4.ip!==d.ipv4.ip&&(k='<ul class="vlan-redirect"><li>'+a.DICT("VLAN_membership_Change_Address_Warning_1",{"%s1":c,"%s2":g.ipv4.ip})+"</li>",k=k+"<li>"+a.DICT("VLAN_membership_Change_Address_Warning_2")+"</li>",e=!0):g.ipv6.preview!==d.ipv6.preview&&((h=n.parse(g.ipv6.preview))||(h="-"),k="<ul><li>"+a.DICT("VLAN_membership_Change_Address_Warning_1",{"%s1":c,"%s2":h.toString()})+"</li>",h=n.parse(d.ipv6.preview),
k=k+"<li>"+a.DICT("VLAN_membership_Change_Address_Warning_2")+"</li>",e=!0))}),e?(k=k+"<li>"+a.DICT("VLAN_membership_Change_Address_Warning_3")+"</li></ul>",k=k+"<div></div><div>"+a.DICT("VLAN_membership_Change_Address_Warning_4")+"</div>",app.TOOLS.warningAlertBox({msg:k,width:720,cbk:function(b){b&&a.funs.save()}})):a.funs.save()):a.funs.save()},save:function(){var c=[],d=a.model.vlans,g=a.model.orig_vlans,e=a.model.dhcp_option82,k={},h,r=function(){var b={},c={},g=[],e,k,h=a.model.lagname_2_lans;
angular.forEach(a.model.tag_lan_list,function(a){b[a]="";c[a]=[]});angular.forEach(d,function(a){angular.forEach(a.tags,function(d,g){switch(d.value){case "U":b[g]=a.if_setting.vlan_id;break;case "T":c[g].push(a.if_setting.vlan_id)}})});angular.forEach(b,function(b,d){d!==a.model.dmz_port&&(e={name:d,"vlan-settings":{"untagged-vlan-id":b,"tagged-vlans":{"vlan-id":c[d]||[]}}},g.push(e),h[d]&&angular.forEach(h[d],function(a){k=angular.copy(e);k.name=a;g.push(k)}))});return g};angular.forEach(d,function(a){a.name=
"VLAN"+a.if_setting.vlan_id;_.isNumber(a.pool_id)&&(k[a.pool_id]=!0);a.pool_id=a.if_setting.vlan_id;k[a.if_setting.vlan_id]=!1});a.model.resetOption82&&(h=5E3,angular.forEach(e,function(b,c){k[c]=!0;a.model.dhcp_opt82_pools[c]["pool-id"]=h;b["dhcp-pool"]=h;h+=1;k[h]=!1}));(function(){var a,b=[],e=[];angular.forEach(g,function(c){a=!1;angular.forEach(d,function(b){c.name===b.name&&(a=!0)});a||(_.isNumber(c.pool_id)&&(k[c.pool_id]=!0),e.push({"interface":c.name}),b.push({name:c.name}))});b.length&&
(c.push({method:"del_dhcp_settings",params:{"dhcp-pool":{"dhcp-interfaces":e}}}),c.push({method:"del_interface",params:{interfaces:{"interface":b}}}))})();(function(){var b,g,e,k,h,l,A,y=[],z=r();angular.forEach(d,function(c){g={enabled:!0,address:[{ip:c.ipv4.ip,"prefix-length":c.ipv4.prefix_len}]};l="static"===c.ipv6.suffix_type?s.parse_user_identifier(c.ipv6.suffix):s.gen_eui64_ip(a.model.mac);switch(c.ipv6.type){case "isp":A=s.get_pd_preview(void 0,c.ipv6.sub_prefix,l.toString().replace("::",""),
c.ipv6.prefix_len);k={ip:A.toString(),isp:{"interface":c.ipv6.wan_pd,suffix:parseInt(c.ipv6.sub_prefix,16)}};A=s.get_pd_preview(void 0,c.ipv6.sub_prefix,"0",c.ipv6.prefix_len);h={"prefix-spec":A.toString()+"/"+c.ipv6.prefix_len,isp:{"interface":c.ipv6.wan_pd,suffix:parseInt(c.ipv6.sub_prefix,16)}};break;default:A=s.get_pd_preview(c.ipv6.prefix+"/"+c.ipv6.prefix_len,"0",l.toString().replace("::",""),c.ipv6.prefix_len),k={ip:A.toString(),"static":null},h={"prefix-spec":c.ipv6.prefix+"/"+c.ipv6.prefix_len,
"static":null}}angular.extend(k,{"prefix-length":c.ipv6.prefix_len});angular.extend(h,{"preferred-lifetime":3600});"static"===c.ipv6.suffix_type?angular.extend(k,{"user-define":c.ipv6.suffix}):angular.extend(k,{"eui-64":null});e={enabled:!0,address:[k],"ipv6-router-advertisements":{"max-rtr-adv-interval":c.ipv6.max_rtr_adv_interval,"prefix-list":{prefix:[h]}}};b={name:c.name,description:c.description,type:"l2vlan",enabled:!0,ipv4:g,ipv6:e,"vlan-interface-settings":{"vlan-id":c.if_setting.vlan_id,
"inter-vlan-routing":c.if_setting.inter_vlan_routing,"enable-management":c.if_setting.enable_management}};y.push(b)});c.push({method:"set_vlan_membership",params:{interfaces:{"interface":y.concat(z)}}})})();(function(){var a=[];angular.forEach(k,function(b,c){b&&a.push({"pool-id":c})});a.length&&c.push({method:"del_dhcp_settings",params:{"dhcp-pools":{pool:a}}})})();(function(){var b=[],g=[],r=[],l,A,y,z,B,p,x,u,G;a.model.resetOption82&&(h=5E3,angular.forEach(e,function(b,c){k[c]=!0;k[h]=!1;l=a.model.dhcp_opt82_pools[c];
l["pool-id"]=h;b["dhcp-pool"]=h;h+=1;g.push(b)}));angular.forEach(a.model.dhcp_opt82_pools,function(a){r.push(a)});angular.forEach(d,function(a){_.isNumber(a.pool_id)&&(k[a.pool_id]=!0);a.pool_id=a.if_setting.vlan_id;h=a.pool_id;k[a.pool_id]=!1;y={"interface":a.name,"server-mode":{"dhcp-pool":h}};p=a.ipv4.dhcp;x=a.ipv6.dhcp;if("relay"===p.dhcp_mode||"relay"===x.dhcp_mode)y["relay-mode"]={},"relay"===p.dhcp_mode&&(y["relay-mode"]["relay-ipv4-address"]=p.relay_ip),"relay"===x.dhcp_mode&&(y["relay-mode"]["relay-ipv6-address"]=
x.relay_ip);b.push(y);if(5>p.lease_time||43200<p.lease_time)p.lease_time=1440;if(5>x.lease_time||43200<x.lease_time)x.lease_time=1440;z={"lease-time":p.lease_time,"dns-server-type":p.dns_type,"dhcp-mode":p.dhcp_mode};switch(p.dhcp_mode){case "server":"dns-server-static"===p.dns_type&&(z.dns={"static-dns-servers":[]},p.dns[0]&&z.dns["static-dns-servers"].push(p.dns[0]),p.dns[1]&&z.dns["static-dns-servers"].push(p.dns[1])),u=p.next_server,G=p.boot_file,p.enable_network_boot||(G=u=""),angular.extend(z,
{"range-start":p.range_start,"range-end":p.range_end,"wins-server":p.wins_server,"network-boot":{enabled:p.enable_network_boot,"next-server":u,"boot-file":G},"dhcp-options":{option43:p.option43,option66:p.option66,option67:p.option67,option150:p.option150}})}B={"lease-time":x.lease_time,"dns-server-type":x.dns_type,"dhcp-mode":x.dhcp_mode};switch(x.dhcp_mode){case "server":"dns-server-static"===x.dns_type&&(B.dns={"static-dns-servers":[]},x.dns[0]&&B.dns["static-dns-servers"].push(x.dns[0]),x.dns[1]&&
B.dns["static-dns-servers"].push(x.dns[1])),"static"===a.ipv6.type?angular.extend(B,{"range-start":x.range_start,"range-end":x.range_end}):angular.extend(B,{"range-start":"::"+x.range_start_suffix,"range-end":"::"+x.range_end_suffix})}y={"pool-id":h,ipv4:z,ipv6:B};r.push(y)});A={"dhcp-pool":{"dhcp-interfaces":b},"dhcp-pools":{pool:r}};g.length&&(A["dhcp-pool"]["dhcp-option82"]=g);c.push({method:"set_dhcp_settings",params:A})})();b.post({forcedUsingPost:!0,method:"set_bulk",params:c,success:function(){S();
a.ui_data.success=!0},error:function(a){S()}})},cancel:function(){S()}};a.ipv4={int2Inet:function(b,c){var d=b.entity.ipv4;_.isNumber(d.prefix_len)?d.netmask=x(d.prefix_len):d.netmask="";a.ipv4.changeDHCPRange(b);a.ipv4.checkSubnetVld(b,c);z()},inet2Int:function(b,c){var d=b.entity.ipv4;d.prefix_len=void 0!==d.netmask?r(d.netmask):"";a.ipv4.changeDHCPRange(b);a.ipv4.checkSubnetVld(b,c);z()},changeIP:function(b,c){a.ipv4.changeDHCPRange(b);a.ipv4.checkSubnetVld(b,c);z()},changeDHCPMode:function(b){a.ipv4.changeDHCPRange(b);
z()},changeDHCPRange:function(a){a=a.entity.ipv4;var b=a.ip,d=a.prefix_len,g,e;if(b&&(_.isNumber(d)&&"server"===a.dhcp.dhcp_mode)&&(b=v.parse(b)))e=32-d,24>=d&&b?(g=v.get_prefix(b,24),b=v.get_prefix(b,24),g.octets[3]=100,b.octets[3]=149):(g=v.get_prefix(b,d),b=v.get_prefix(b,d),g.octets[3]|=1,b.octets[3]=27>d?b.octets[3]|50:b.octets[3]|parseInt(c(e-1,e,"H"),2)),a.dhcp.range_start=g.toString(),a.dhcp.range_end=b.toString(),z()},checkDHCPRange:function(a){var b=a.entity;a=b.vld;var c=b.ipv4,d=c.prefix_len,
g=c.ip,b=c.dhcp.range_start,c=c.dhcp.range_end,e=!1,k;a.v4RANSubS=!1;a.v4RANSubE=!1;a.v4RANIP=!1;b&&(c&&g&&_.isNumber(d))&&(g=v.parse(g),b=v.parse(b),c=v.parse(c),g&&(b&&c)&&(g=v.get_prefix(g,d),k=v.get_prefix(b,d),d=v.get_prefix(c,d),g&&(k&&d)&&(g.toString()!==k.toString()&&(e=a.v4RANSubS=!0),g.toString()!==d.toString()&&(e=a.v4RANSubE=!0),!e&&v.to_int(b)>v.to_int(c)&&(a.v4RANIP=!0))))},checkSubnetVld:function(b){b=b.entity;var c=b.ipv4,d=b.vld;b=a.model.vlans;var g=b.length;d.v4OverlapWithOtherVlans=
!1;d.v4OverlapWithOtherFeatrues=!1;c.first_ip="";c.last_ip="";c.ip&&c.netmask&&(c.first_ip=v.get_first_ip(c.ip,c.prefix_len).toString(),c.last_ip=v.get_last_ip(c.ip,c.prefix_len).toString(),is_overlap=t.check_ipv4_range_is_overlap_with_entity({start:c.first_ip,end:c.last_ip},a.model.remain_subnets.ipv4).is_overlap,d.v4OverlapWithOtherFeatrues=is_overlap,Log(DEBUG,"ipv4.checkSubnetVld() "+is_overlap+" ## "+JSON.stringify(c)+" ## "+JSON.stringify(a.model.remain_subnets.ipv4)));angular.forEach(b,function(a){a.vld.v4OverlapWithOtherVlans=
!1});for(c=0;c<g;c++)if(b[c].ipv4.first_ip&&b[c].ipv4.last_ip)for(d=c+1;d<g;d++)if(b[d].ipv4.first_ip&&b[d].ipv4.last_ip){if(is_overlap=v.vld.is_overlap_between_ranges({start:b[c].ipv4.first_ip,end:b[c].ipv4.last_ip},{start:b[d].ipv4.first_ip,end:b[d].ipv4.last_ip}))b[c].vld.v4OverlapWithOtherVlans=is_overlap,b[d].vld.v4OverlapWithOtherVlans=is_overlap;Log(DEBUG,"ipv4.checkSubnetVld() "+c+" "+d+": "+is_overlap+" ## "+JSON.stringify(b[c])+" ## "+JSON.stringify(b[d]))}}};a.ipv6={changeType:function(b){a.ipv6.updatePreview(b.entity);
a.ipv6.checkSubnetVld(b);a.ipv6.changeDHCPRange(b);z()},changeSuffixType:function(b,c){a.ipv6.updatePreview(b.entity);a.ipv6.changeDHCPRange(b);z()},changeDHCPMode:function(b){a.ipv6.updatePreview(b.entity);a.ipv6.changeDHCPRange(b);z()},changeDHCPRange:function(b){var d=b.entity.ipv6,g=d.preview;b=d.prefix_len;var e,k,h;if(g&&(_.isNumber(b)&&"server"===d.dhcp.dhcp_mode)&&(g=n.parse(g)))"isp"===d.type?(h="-",angular.forEach(a.model.pd_list,function(a){a.id===d.wan_pd&&(h=a.prefix_name)}),d.dhcp.range_start_prefix=
h+" + "+d.sub_prefix,d.dhcp.range_end_prefix=h+" + "+d.sub_prefix):(d.dhcp.range_start_prefix=d.prefix,d.dhcp.range_end_prefix=d.prefix),k=128-b,120>b?(e=n.get_prefix(g,120),g=n.get_prefix(g,120),e.parts[7]|=1,g.parts[7]|=254):(e=n.get_prefix(g,b),g=n.get_prefix(g,b),e.parts[7]|=1,g.parts[7]|=parseInt(c(k-1,k,"H"),2)),d.dhcp.range_start=e.toString(),d.dhcp.range_end=g.toString(),h=n.parse("0::0"),e=n.combined_two_ip(h,e,b),d.dhcp.range_start_suffix=e.toString().replace("::",""),e=n.combined_two_ip(h,
g,b),d.dhcp.range_end_suffix=e.toString().replace("::","")},updateDHCPServer:function(b){a.ipv6.updatePreview(b.entity);a.ipv6.checkSubnetVld(b);a.ipv6.changeDHCPRange(b)},updatePreview:function(b){var c=b.ipv6,d,g,e;c.preview="";if(_.isNumber(c.prefix_len)){b=c.prefix_len;switch(c.type){case "static":if(!c.prefix)return;g="0";d=c.prefix+"/"+b;break;case "isp":d="0::/0";angular.forEach(a.model.pd_list,function(a){a.id===c.wan_pd&&(d=a.pd_prefix)});g=c.sub_prefix.toString();if(!g)return;break;default:return}switch(c.suffix_type){case "static":e=
c.suffix;if(!e)return;break;case "eui64":e=a.model.ifs_state.VLAN1&&a.model.ifs_state.VLAN1.phys_addr||"";if(!e){Log(ERROR,"[VLANSettingsCtrl] updatePreview() eui64, there is not mac at VLAN1 interface state");return}e=s.gen_eui64_ip(e).replace("::","");break;default:return}c.preview=s.get_pd_preview(d,g,e,b).toNormalizedString()}},checkDHCPRange:function(a){var b=a.entity;a=b.vld;var c=b.ipv6,d=c.prefix_len,g=c.preview,b="::"+c.dhcp.range_start_suffix,e="::"+c.dhcp.range_end_suffix,k=!1;a.v6RANSubS=
!1;a.v6RANSubE=!1;a.v6RANIP=!1;b&&(e&&g&&_.isNumber(d))&&(g=n.parse(g),b=n.parse(b),e=n.parse(e),g&&(b&&e)&&(b=n.combined_two_ip(g,b,d),e=n.combined_two_ip(g,e,d),c.dhcp.range_start=b.toString(),c.dhcp.range_end=e.toString(),c=n.get_prefix(g,d),g=n.get_prefix(b,d),d=n.get_prefix(e,d),c&&(g&&d)&&(c.toString()!==g.toString()&&(k=a.v6RANSubS=!0),c.toString()!==d.toString()&&(k=a.v6RANSubE=!0),!k&&!n.vld.ip_range_is_valid(b,e)&&(a.v6RANIP=!0))))},checkSubnetVld:function(b){var c=a.model.vlans,d=c.length;
b=b.entity;var g=b.vld,e=b.ipv6,k,h;g.v6OverlapWithOtherVlans=!1;g.v6OverlapWithOtherFeatrues=!1;aa(b);e.preview&&"static"===e.type&&(b=t.check_ipv6_range_is_overlap_with_entity({start:e.first_ip,end:e.last_ip},a.model.remain_subnets.ipv6).is_overlap,g.v6OverlapWithOtherFeatrues=b,Log(DEBUG,"ipv6.checkSubnetVld() "+b+" "+JSON.stringify(e)));angular.forEach(c,function(a){a.vld.v6OverlapWithOtherVlans=!1});for(g=0;g<d;g++)if(k=c[g].ipv6,k.first_ip&&k.last_ip)for(e=g+1;e<d;e++)if(h=c[e].ipv6,h.first_ip&&
h.last_ip&&k.type===h.type&&!("isp"===k.type&&k.wan_pd!==h.wan_pd)){if(b=n.vld.is_overlap_between_ranges({start:k.first_ip,end:k.last_ip},{start:h.first_ip,end:h.last_ip}))c[g].vld.v6OverlapWithOtherVlans=b,c[e].vld.v6OverlapWithOtherVlans=b;Log(DEBUG,"ipv6.checkSubnetVld() "+b+" "+JSON.stringify(k)+" "+JSON.stringify(h))}}};var aa=function(a){a=a.ipv6;var b=a.preview;a.first_ip="";a.last_ip="";b&&"isp"===a.type&&(b=s.get_pd_preview(void 0,a.sub_prefix,"0",a.prefix_len).toNormalizedString());b&&(a.first_ip=
n.get_first_ip(b,a.prefix_len).toString(),a.last_ip=n.get_last_ip(b,a.prefix_len).toString())};a.checkTags=function(b,c,d){var g=a.model.vlans,e={};angular.forEach(a.model.tag_lan_list,function(a){e[a]=""});angular.forEach(g,function(a){angular.forEach(a.tags,function(b,c){"U"===b.value&&(e[c]=a.if_setting.vlan_id)})});angular.forEach(e,function(a,b){""===a&&!g[0].tags[b].is_dmz&&(g[0].tags[b].value="U")});a.checkUntaggedPort()};a.checkForEditTags=function(b,c,d){var g=c.entity,e=a.model.vlans,k=
d.colDef.field.replace("tags.","");c=[k];d=a.model.lagname_2_lans;var h=a.model.vlanname_to_lag;k.match(/^LAG\d+$/)?d[k]&&(c=c.concat(d[k])):(lagname=h[k]||"",d[lagname]&&(c=[lagname],c=c.concat(d[lagname])));"U"===g.tags[k].value?angular.forEach(c,function(a){g.tags[a]&&(g.tags[a].value="U");angular.forEach(e,function(c,d){d!==b&&(c.tags[a]&&"U"===c.tags[a].value)&&(c.tags[a].value="T")})}):angular.forEach(c,function(a){g.tags[a]&&(g.tags[a].value=g.tags[k].value)});a.checkUntaggedPort()};a.checkUntaggedPort=
function(){var b=a.model.vlans,c,d=!1;angular.forEach(a.model.tag_lan_list,function(a){c=!1;angular.forEach(b,function(b){"U"===b.tags[a].value&&(c=!0);b.tags[a].is_dmz&&(c=!0)});c||(d=!0)});a.ui_data.untagged_is_invalid=d};S()}]);app.controller("lan_8021x_main",["$scope","$q","MyHttp","$templateCache","$filter","Sets","UserSession","userAccessRight","modelInfo",function(a,b,s,n,v,t,m,q,e){a.LAGUNASSIGN="unassign";a.jumpToPage=app.TOOLS.jumpToPage;a.model=a.model||{};a.ctx=a.ctx||{};a.success=!1;a.loadReady=!1;a.lags=[];a.lans=[];a.ctx.HWDMZport=e.get_HWDMZport()||"LAN4";a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var w=function(){b.all([function(){return s.post({url:resource_base+
"data/lan_8021x.json",method:"get_8021x",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})}()]).then(function(b){a.model={};for(var e=0;e<b.length;e++)angular.extend(a.model,b[e].data.result);h();angular.forEach(a.model.interfaces["interface"],function(b,d){a.model["interfaces-state"]&&angular.forEach(a.model["interfaces-state"]["interface"],function(a,d){b.name==a.name&&angular.extend(b,{s_ref:a})})});a.collects_dot1x_avail_if();a.grid8021X.Options.data=a.lans;
a.loadReady=!0})},l=function(){angular.forEach(a.model.interfaces["interface"],function(b,e){b.name.match(/^LAN/)&&(t.recover_object(b,a.use_portset_sample),void 0==b["lag-ref"]&&(b["lag-ref"]="unassign"));b.name.match("^"+a.ctx.HWDMZport+"$")&&b.dmz&&!0===b.dmz.enable&&(b["lag-ref"]="unassign")})},h=function(){a.use_8021x_sample={dot1x:{enable:!1}};t.recover_object(a.model,a.use_8021x_sample);a.use_if_8021x_sample={dot1x:{enable:!1,"authorized-mode":"auto"}};angular.forEach(a.model.interfaces["interface"],
function(b,e){b.name.match(/^LAN|^LAG/)&&(void 0==b.dot1x&&t.recover_object(b,a.use_if_8021x_sample),b.edit=!0,b.dot1x_auth={select:b.dot1x["authorized-mode"],list:a.schema.auth_modes})});l()},p=function(a,b){1<a.length&&(a=a.sort(function(a,d){var c="",e="",c=0<=a.name.search(b)?a.name.replace(b,""):"0",e=0<=d.name.search(b)?d.name.replace(b,""):"0",c=parseInt(c,10),e=parseInt(e,10);return c>e?1:-1}));return a};a.filter_LAN=function(a,b,e){return a.name.match(/^LAN/)?!0:!1};a.filter_LAG=function(a,
b,e){return a.name.match(/^LAG/)?!0:!1};a.collects_dot1x_avail_if=function(){a.ctx.inused_lag=[];var b=v("filter")(a.model.interfaces["interface"],a.filter_LAN),e=v("filter")(a.model.interfaces["interface"],a.filter_LAG);angular.forEach(b,function(b){b.name===a.ctx.HWDMZport&&(b.dmz&&!0===b.dmz.enable)&&(b.edit=!1);void 0!==b["lag-ref"]&&a.ctx.inused_lag.push(b["lag-ref"])});b=p(b,"LAN");a.lags=e;a.lans=b};a.authmode_change=function(b,e,h,d){b=e.entity;e=b["lag-ref"];h=a.lans;d=a.lags;var c;if("unassign"!==
e){for(c=0;c<h.length;c++)"unassign"!=h[c]["lag-ref"]&&h[c]["lag-ref"]==e&&(h[c].dot1x_auth.select=b.dot1x_auth.select);for(c=0;c<d.length;c++)d[c].name==e&&(d[c].dot1x=d[c].dot1x||{},d[c].dot1x_auth.select=b.dot1x_auth.select)}};a.selected=a.selected||{};a.grid8021X=a.grid8021X||{};a.link_str={"false":"Link Down","true":"Link Up"};a.grid8021X.Options=app.uiGrid.generateGridOptions({columnDefs:[{field:"name",displayName:a.DICT("802.1X_Configuration_Port_Name"),width:150},{field:"dot1x_auth",displayName:a.DICT("802.1X_Configuration_Administrative_Status"),
id:"8021XStatus",cellTemplate:n.get("UG_table_select_with_inline_edit.html"),changedCbk:a.authmode_change,editRow:"edit"},{field:"s_ref.dot1x",displayName:a.DICT("802.1X_Configuration_Port_Status"),cellTemplate:n.get("T_8021x_PortStatus.html")}]});a.selRow=function(b,e){a.selected.index=b.rowIndex};a.save=function(){for(var b=a.lans.concat(a.lags),b=angular.copy(b),e=a.model.dot1x.enable,h=b.length;h--;){delete b[h].s_ref;delete b[h].edit;void 0!==b[h].dot1x_auth&&(b[h].dot1x["authorized-mode"]=b[h].dot1x_auth.select,
delete b[h].dot1x_auth);if(angular.isUndefined(b[h]["lag-ref"])||"unassign"==b[h]["lag-ref"])b[h]["lag-ref"]="";for(var d in b[h])switch(d){case "name":case "lag-ref":break;case "dot1x":b[h].name===a.ctx.HWDMZport&&(angular.isDefined(b[h][d]["authorized-mode"])&&b[h].dmz&&!0===b[h].dmz.enable)&&delete b[h][d]["authorized-mode"];b[h][d].enable=e;break;default:delete b[h][d]}}s.post({url:resource_base+"data/lan_8021x.json",method:"set_8021x",params:{dot1x:a.model.dot1x,interfaces:{"interface":b}},success:function(b){a.success=
!0;w();a.resetModified()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})};a.cancel=function(){w();a.resetModified()};a.template_note=a.DICT("802.1X_Configuration_Note_8021X",{"%s":"<a ng-click=\"jumpToPage('System_Config_User_Accounts')\">"+a.DICT("802.1X_Configuration_User_Account")+"</a>"});(function(){a.schema={};a.schema.auth_modes=[{id:"force",displayName:a.DICT("802.1X_Configuration_Force_Authorized")},{id:"auto",displayName:a.DICT("802.1X_Configuration_Auto")}];
a.schema.auth_str={"force-authorized":"Force Authorized","force-unauthorized":"Force Unauthorized",authFailed:"Authenticating Failed",authenticating:"Authenticating",authorized:"Authorized"};a.schema.link_status=function(b){var e="";switch(b){case "down":case "NotConnected":e=a.DICT("802.1X_Configuration_Link_Down");break;case "up":case "Connected":e=a.DICT("802.1X_Configuration_Link_Up");break;case "Disabled":e=a.DICT("802.1X_Configuration_Disabled");break;default:e=b}return e}})();w()}]);app.controller("port_settings_main",["$scope","$rootScope","$log","MyHttp","$http","ngGridCellBuilder","$filter","$timeout","$templateCache","Sets","UserSession","userAccessRight","modelInfo",function(a,b,s,n,v,t,m,q,e,w,l,h,p){a.LAGUNASSIGN="unassign";a.flags=a.flags||{};a.flags.LAG_PMMonPort_MutualExclusive=!1;a.flags.LAG_AutoMode_spcific_dealwith=!1;a.flags.showWANPortSetting=!0;p.get_pid().match("^RV340")?a.flags.LAN1notSupportLAG=!0:a.flags.LAN1notSupportLAG=!1;var u;u=a.flags.showWANPortSetting?
/^LAN|^LAG|^WAN\d+$/:/^LAN|^LAG/;a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.HWDMZport=p.get_HWDMZport()||"LAN4";a.success=!1;a.loadReady=!1;a.PMdestRefresh=!1;a.userAccessFlag=h.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&l.logout();var x=function(a){a=a.sort(function(a){var b=function(a){var b=0,c=0;a=a.name.match(/^([A-zA-Z_]+)([0-9]*)/);b="LAN"==a[1]?100:"LAG"==a[1]?200:"WAN_PORT"==a[1]?300:"WAN"==a[1]?400:"USB"==a[1]?500:"TUN"==a[1]?600:"VLAN"==a[1]||"DMZ"==a[1]?1E4:900;c=a[2]||0;return b+
parseInt(c,10)};a=!a?1:-1;return function(c,d){var e=b(c),k=b(d);return a*((e>k)-(k>e))}}(!1))},r=function(){n.post({url:resource_base+"data/lan_port_settings.json",method:"get_port_settings",success:function(b){a.model={};angular.extend(a.model,b.data.result);x(a.model.interfaces["interface"]);d();for(var c=a.model.interfaces["interface"].length-1;0<=c;c--)b=a.model.interfaces["interface"][c],b.name.match(u)||a.model.interfaces["interface"].splice(c,1);a.schema=a.schema||{};a.schema.ethmodes=[{id:"mode-auto",
desc:a.DICT("Port_Settings_Auto_Negotiation")},{id:"mode-10m-half",desc:a.DICT("Port_Settings_Half_10")},{id:"mode-10m-full",desc:a.DICT("Port_Settings_Full_10")},{id:"mode-100m-half",desc:a.DICT("Port_Settings_Half_100")},{id:"mode-100m-full",desc:a.DICT("Port_Settings_Full_100")}];b=a.schema;for(var c=a.schema.ethmodes,e=["desc"],h={},l,r,p,m,q=0;q<c.length;q++){l=c[q];r=l.id;for(var w=0;w<e.length;w++)p=e[w],m=l[p],h[r]={},h[r][p]=m}b.ethmodesHash=h;a.schema.linkstatus=[{id:0,displayName:a.DICT("Port_Settings_Down")},
{id:1,displayName:a.DICT("Port_Settings_Up")},{id:2,displayName:"-"}];a.schema.alwaysTrue=!0;a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);b=a.model_del["port-mirror"];for(var n in b)switch(n){case "tx-monitors-ports":case "rx-monitors-ports":break;default:delete b[n]}a.model_del["port-mirror"]["tx-monitors-ports"].splice(0);a.model_del["port-mirror"]["rx-monitors-ports"].splice(0);n=a.model.interfaces["interface"];b=a.model_orig.interfaces["interface"];for(c=0;c<n.length;c++)n[c]._old=
b[c];a.init_if_mirror_status("tx");a.init_if_mirror_status("rx");a.gridPort.Options.data=a.model.interfaces["interface"];a.loadReady=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})};r();var d=function(){a.use_portmirror_sample={"port-mirror":{enable:!1,"tx-dst-port":"LAN4","tx-monitors-ports":[],"rx-dst-port":"LAN4","rx-monitors-ports":[]}};w.recover_object(a.model,a.use_portmirror_sample);a.use_portset_sample={edit:!0,editEEE:!0,eee:!0,"flow-control":!0,
"port-mode":"mode-100m-full"};angular.forEach(a.model.interfaces["interface"],function(b,c){b.name.match(/^LAN|^WAN\d+$/)&&(w.recover_object(b,a.use_portset_sample),void 0==b["lag-ref"]&&(b["lag-ref"]="unassign"));a.flags.showWANPortSetting&&b.name.match(/^WAN\d+$/)&&(b.editEEE=!1,b.eee=!0);b.name.match(/^LAN4/)&&b.dmz&&!0===b.dmz.enable&&(b["lag-ref"]="unassign")});angular.forEach(a.model.interfaces["interface"],function(a,b){if(a.name.match(/^VLAN/))for(var c in a)switch(c){case "name":case "type":case "vlan-interface-settings":break;
default:delete a[c]}})};a.filter_LAN_only=function(a,b,c){return a.name.match(/^LAN/)?!0:!1};a.collect_port_list=function(){return m("filter")(a.model.interfaces["interface"],a.filter_LAN_only)};a.LAN_exclude_lagref_HWDMZ=function(a,b,c){b="unassign"==a["lag-ref"];return a.name.match(/^LAN/)&&b?a.dmz&&!0===a.dmz.enable?!1:!0:!1};a.collect_destport_list=function(b){var c=m("filter")(a.model.interfaces["interface"],a.LAN_exclude_lagref_HWDMZ);if(!a.PMdestRefresh){!0===a.flags.LAG_PMMonPort_MutualExclusive&&
1>=c.length&&(a.model["port-mirror"].enable=!1);for(var d=!1,e=0;e<c.length;e++)a.model["port-mirror"]["tx-dst-port"]==c[e].name&&(d=!0);d||(a.model["port-mirror"]["tx-dst-port"]=c[0].name,b&&!0===b.destChangeNotice&&app.TOOLS.criticalAlertBox({msg:"The Destination Port of Port Mirror will change to '"+c[0].name+"'",cbk:function(a){}}));a.PMdestRefresh=!0}return c};a.filter_LAN_specific_rule=function(b,c,d){return a.flags.LAN1notSupportLAG&&b.name.match(/^LAN1$/)?!1:b.name.match(/^LAN/)?!0:!1};a.collect_lag_port_list=
function(){return m("filter")(a.model.interfaces["interface"],a.filter_LAN_specific_rule)};a.save=function(){var b=function(a,b,c){return a.name.match(/^VLAN/)?!0:!1},c=m("filter")(a.model.interfaces["interface"],function(a,b,c){return a.name.match(u)?!0:!1});(function(c){var d=m("filter")(a.model.interfaces["interface"],b),g=[];angular.forEach(d,function(a,b){if(a["vlan-interface-settings"]&&a["vlan-interface-settings"]["vlan-id"]){var c=a["vlan-interface-settings"]["vlan-id"];1!=c&&g.push(c)}});
var e=function(a){a["vlan-settings"]={"untagged-vlan-id":1,"tagged-vlans":{"vlan-id":g.join(" ")}}},h={};angular.forEach(c,function(b,c){var d=a.model.interfaces["interface"].indexOf(b),d=a.model_orig.interfaces["interface"][d],g={};b.name.match(/^LAG/)&&(g={intf:b,flag_lag_updated:!1},d&&d.enabled!=b.enabled?(e(b),g.flag_lag_updated=!0):d||cLog(DEBUG,"Error: not found origItem named "+b.name));h[b.name]=g});angular.forEach(c,function(b,c){var d=a.model.interfaces["interface"].indexOf(b),d=a.model_orig.interfaces["interface"][d];
b.name.match(/^LAN/)&&"unassign"!=d["lag-ref"]&&"unassign"==b["lag-ref"]?e(b):b.name.match(/^LAN/)&&"unassign"!=b["lag-ref"]&&(d=h[b["lag-ref"]].intf,angular.isDefined(d)&&(b["vlan-settings"]=angular.copy(d["vlan-settings"])))})})(c);var d=function(b){var c=angular.copy(b);(function(){for(var b=m("filter")(c,a.ifNamed("^LAG")),d=0;d<b.length;d++){b[d]._old.enabled!==b[d].enabled&&(b[d].dot1x=b[d].dot1x||{},b[d].dot1x["authorized-mode"]="force",Log(DEBUG,"set authorized-mode "+b[d].dot1x["authorized-mode"]));
var g=b[d].name;angular.forEach(c,function(a,c){a.name.match(/^LAN/)&&a["lag-ref"]==g?(a.dot1x=a.dot1x||{},a.dot1x["authorized-mode"]=b[d].dot1x["authorized-mode"]):a.name.match(/^LAN/)&&("unassign"!==a._old["lag-ref"]&&"unassign"==a["lag-ref"])&&(a.dot1x=a.dot1x||{},a.dot1x["authorized-mode"]="force")})}})();angular.forEach(c,function(b,c){a.flags.showWANPortSetting&&b.name.match(/^WAN\d+$/)&&delete b.eee;if(b._monitorVal||!1===b._monitorVal)b._monitorVal=void 0;"unassign"==b["lag-ref"]&&(b["lag-ref"]=
"");void 0!==b.dmz&&delete b.dmz;void 0!==b._old&&delete b._old;delete b.edit;delete b.editEEE});return c}(c);(function(){n.post({url:resource_base+"data/lan_port_settings.json",method:"set_port_settings",params:{interfaces:{"interface":d},"port-mirror":a.model["port-mirror"]},success:function(b){a.success=!0;a.config_saved=!0;r()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);r()}})})();a.resetModified()};a.cancel=function(){r();a.resetModified()};var c=function(a,
b){var c={};"tx"==a?(c.keypath1="tx-dst-port",c.keypath2="tx-monitors-ports",c.keyname2="tx-monitors-port",c.fname=b||"_monitorVal"):"rx"==a&&(c.keypath1="rx-dst-port",c.keypath2="rx-monitors-ports",c.keyname2="rx-monitors-port",c.fname=b||"_monitorVal");return c};a.init_if_mirror_status=function(b,d){var e=a.model["port-mirror"],h=c(b,d),l=h.keypath2,r=h.keyname2;d=h.fname;h=m("filter")(a.model.interfaces["interface"],{type:"ethernetCsmacd"});angular.forEach(h,function(a,b){angular.forEach(e[l],
function(b,c){a.name==b[r]&&(a[d]=!0)})})};a.update_port_mirror_status=function(b,d){var e=a.model["port-mirror"],h=a.model_del["port-mirror"],l=c(b,d),r=l.keypath2,p=l.keyname2;d=l.fname;l=m("filter")(a.model.interfaces["interface"],{type:"ethernetCsmacd"});angular.forEach(l,function(a,b){if(!0===a[d]){var c,k;for(k=e[r].length-1;0<=k;k--)e[r][k][p]==a.name&&(c=!0);c||(k={},k[p]=a.name,e[r].push(k));for(k=h[r].length-1;0<=k;k--)h[r][k][p]==a.name&&h[r].splice(k,1)}else{c=-1;for(k=e[r].length-1;0<=
k;k--)e[r][k][p]==a.name&&(c=k);-1!=c&&(k=e[r].splice(c,1),h[r].push(k[0]))}})};a.update_txrx_port_routine=function(b){a.model["port-mirror"]["tx-dst-port"]=b;a.model["port-mirror"]["rx-dst-port"]=b};a.update_monitorDestTx=function(b){var c=a.model["port-mirror"]["tx-dst-port"];b=m("filter")(a.model.interfaces["interface"],{type:"ethernetCsmacd"});angular.forEach(b,function(b,d){c==b.name&&(b._monitorVal=!1,q(function(){a.update_port_mirror_status("tx")},100))})};a.update_monitorDestRx=function(b){var c=
a.model["port-mirror"]["rx-dst-port"];b=m("filter")(a.model.interfaces["interface"],{type:"ethernetCsmacd"});angular.forEach(b,function(b,d){c==b.name&&(b._monitorVal=!1,q(function(){a.update_port_mirror_status("rx")},100))})};a.showPortName=function(a){return a.name};a.disablePort=function(b){var c;if(b.name==a.model["port-mirror"]["tx-dst-port"]||!a.model["port-mirror"].enable||a.ctx.HWDMZport==b.name&&b.dmz&&b.dmz.enable)c=!0;return c};a.gridPort=a.gridPort||{};a.gridPort.Options=app.uiGrid.generateGridOptions({onRegisterApi:function(a){a.core.registerRowsProcessor(function(a){var b=
[];angular.forEach(a,function(a){a.entity.name.match(/^[LW]AN/)&&b.push(a)});return b},10)},columnDefs:[{field:"name",displayName:a.DICT("Port_Settings_Port")},{field:"description",displayName:a.DICT("Port_Settings_Port_Label"),id:"portLabel",cellTemplate:e.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"legal-char maxlength='32'"),editRow:"edit"},{field:"enabled",displayName:a.DICT("Port_Settings_Enabled"),id:"portEnabled",cellTemplate:e.get("UG_table_checkbox_with_inline_edit.html"),
editRow:"edit"},{field:"eee",displayName:a.DICT("Port_Settings_EEE"),id:"portEEE",editRow:"editEEE",cellTemplate:e.get("UG_table_checkbox_with_inline_edit.html")},{field:"flow-control",displayName:a.DICT("Port_Settings_Flow_Control"),id:"portFlowCtrl",cellTemplate:e.get("UG_table_checkbox_with_inline_edit.html"),editRow:"edit"},{field:"port-mode",displayName:a.DICT("Port_Settings_Mode"),minWidth:210,cellTemplate:e.get("UG_genericSelect.html").replace(/NGOPTIONS/,"mode.id as mode.desc for mode in grid.appScope.get_availPortMode(row.entity) ").replace(/data-ng-expansion/,
"id=\"{{'slct_portMode_'+row.rowIndex}}\" ng-change=\"grid.appScope.portmode_change(row.entity, '{{MODEL_COL_FIELD}}')\"").replace(/ng-style="[^\"]+"/,"")}]});a.get_availPortMode=function(b){var c="unassign"==b["lag-ref"];return m("filter")(a.schema.ethmodes,function(a,b,d){return!c&&a.id.match(/-half/)?!1:!0})};a.ifNamed=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};a.portmode_change=function(b,c){for(var d=b["lag-ref"],e=m("filter")(a.model.interfaces["interface"],a.ifNamed("^LAN")),
h=0;h<e.length;h++)"unassign"!=e[h]["lag-ref"]&&(e[h]["lag-ref"]==d&&null!=b["port-mode"])&&(!1==a.flags.LAG_AutoMode_spcific_dealwith?e[h]["port-mode"]=b["port-mode"]:!0==a.flags.LAG_AutoMode_spcific_dealwith&&("mode-auto"!=e[h]["port-mode"]&&"mode-auto"!=b["port-mode"])&&(e[h]["port-mode"]=b["port-mode"]))};a.disableLagSelection=function(b,c){for(var d=!1,e=a.collect_lag_port_list(),h=b.name,l=0,r=0;r<e.length;r++)e[r]["lag-ref"]==h&&(e[r].dmz&&!0!=e[r].dmz.enable||!angular.isDefined(e[r].dmz))&&
l++;8<=l&&c["lag-ref"]!=b.name&&(d=!0);return d};a.update_lag_enable=function(b,c,d){for(var e=m("filter")(a.model.interfaces["interface"],a.ifNamed("^LAG")),h=m("filter")(a.model.interfaces["interface"],a.ifNamed("^LAN")),l=function(b,c,d){var g=!1;b["lag-ref"]==d&&b["port-mode"].match(/-half$/)&&(g=a.schema.ethmodesHash[b["port-mode"]].desc,alert("Mode '"+g+"' on '"+b.name+"' are not allow, change to 'Full-Duplex' mode to be a LAG member"),g=!0);c&&b["lag-ref"]==d&&(b["port-mode"]!=c?(g=a.schema.ethmodesHash[b["port-mode"]].desc,
alert("Mode '"+g+"' on '"+b.name+"' are not consistency with LAG member"),g=!0):b["port-mode"]!=c&&Log(DEBUG,"DEFAULT"));return g},r,p,x=0;x<e.length;x++){var u=e[x].name,w=!1;r=void 0;for(var n=0;n<h.length;n++)if(h[n]["lag-ref"]==u){h[n]!=b&&(w=!0);!0===a.flags.LAG_PMMonPort_MutualExclusive&&(h[n]._monitorVal=!1);if(h[n]!=b&&!r&&(!1==a.flags.LAG_AutoMode_spcific_dealwith||!0==a.flags.LAG_AutoMode_spcific_dealwith&&"mode-auto"!=h[n]["port-mode"]))r=h[n]["port-mode"];h[n].dot1x&&h[n].dot1x["authorized-mode"]&&
(h[n]!=b&&!p)&&(p=h[n].dot1x["authorized-mode"])}l(b,r,u)?(""==c&&(c="unassign"),q(function(){b["lag-ref"]=c;b["port-mode"]=d},40)):b["lag-ref"]==u&&(w=!0);a.update_port_mirror_status("tx");a.update_port_mirror_status("rx");a.PMdestRefresh=!1;a.collect_destport_list({destChangeNotice:!0});e[x].enabled=w?!0:!1;e[x].dot1x=e[x].dot1x||{}}}}]);app.controller("p_lan_dhcp_static_main",["$scope","$q","MyHttp","$templateCache","UserSession","userAccessRight","Sets",function(a,b,s,n,v,t,m){var q={source:"http",getResult:function(a,b,d){return m.getResult(this,a,b,d)}},e=app.rshelper;a.model=a.model||{};a.success=!1;a.loadReady=!1;a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var w=function(){a.loadReady=!1;var e={DHCPStatic:b.defer()};b.all({DHCPStatic:function(){var a={static_dhcp:{entry:[]}};return"dproxy"==
q.source?(proxy.DHCPStatic.init(function(){var a=proxy.DHCPStatic.get_config();m.recover_object(a,{static_dhcp:{entry:[]}});e.DHCPStatic.resolve(a)}),e.DHCPStatic.promise):s.post({url:resource_base+"data/lan_dhcp_static.json",method:"get_dhcp_static",options:{transformResponse:app.modelhelper.db2webFn},success:function(b){m.default_result(b,a)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})}()}).then(function(b){a.model={};a.model.static_dhcp=q.getResult(b.DHCPStatic,
"static_dhcp");l();a.model_orig=angular.copy(a.model);a.gridDHCPStatic.Options.data=a.model.static_dhcp.entry;a.loadReady=!0})};w();var l=function(){a.use_static_dhcp_sample={name:"",edit:!1,ip_address:"",mac:"",enable:!0,checked:!1};angular.forEach(a.model.static_dhcp.entry,function(b){m.recover_object(b,a.use_static_dhcp_sample)});a.model.StatusMap={"true":"Enabled","false":"Disabled"}};a.T_cellEdit=n.get("T_editWithNoFoucs_by_inner_rs_objs.html").replace(/RSNAME/g,"$$$$rowstate");a.selected=a.selected||
{};a.gridDHCPStatic=a.gridDHCPStatic||{};a.gridDHCPStatic.rowEditableState=[];var h=function(a,b,d,c){if(!a)return!0;var e=!0,g=[],h=[],l=b.length,A,p,u=[],m=!0;"delete_row"===a.type&&(m=!1);var q=function(a,g,h){var z;h=!0;var x;if(!(0>g||g>l)){d&&d(a)&&(e=h=!1);for(A=g;A<l;A++)if(p=b[A])p===a?(z=p,x=A):c(p,a)?(u[A]="x",h=e=!1):u[A]="v";z&&(u[x]=h?"v":"x")}};if(m){if(!a.row)return!0;q(a.row.entity,0,a.row.rowIndex)}else for(a=0;a<l;a++)b[a]&&q(b[a],a,a);(function(a){h=[];g=[];for(var b=0,c;b<a.length;b++)c=
a[b],"v"==c?h.push(b):"x"==c&&g.push(b)})(u);return{result:e,invalidRows:g,validRows:h}};a.gridDHCPStatic.nameCbk=function(b){return h(b,a.model.static_dhcp.entry,void 0,function(a,b){var c=!1;a.name==b.name&&(c=!0);return c})};a.gridDHCPStatic.ipv4Cbk=function(b){return h(b,a.model.static_dhcp.entry,void 0,function(a,b){var c=!1;if(b.enable&&a.enable&&(a.ip_address===b.ip_address||a.mac===b.mac)||a.ip_address===b.ip_address&&a.mac===b.mac)c=!0;return c})};var p=function(a,b,d){var c,e,g;g=a.length;
angular.forEach(a,function(a){a[d]=!1});for(c=0;c<g;c++)for(e=c+1;e<g;e++)a[c][b]===a[e][b]&&(a[c][d]=!0,a[e][d]=!0)};a.gridDHCPStatic.chkName=function(){a.model.static_dhcp&&p(a.model.static_dhcp.entry,"name","isDupName")};a.gridDHCPStatic.chkIPv4=function(b){a.model.static_dhcp&&p(a.model.static_dhcp.entry,"ip_address","isDupIpv4")};a.gridDHCPStatic.chkMac=function(){a.model.static_dhcp&&p(a.model.static_dhcp.entry,"mac","isDupMac")};a.gridDHCPStatic.Selections=[];a.gridDHCPStatic.procNgClick=function(b){a.gridDHCPStatic.Selections=
[];angular.forEach(a.model.static_dhcp.entry,function(b,d){b.checked?a.gridDHCPStatic.Selections.push(b):b.edit=!1})};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridDHCPStatic.Options=app.uiGrid.generateGridOptions({IDPreifx:"lanDHCPStatic",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridDHCPStatic.procNgClick,headerChangedCbk:a.gridDHCPStatic.procNgClick,disableChkBoxField:"disableChk"},{field:"name",displayName:a.DICT("Static_DHCP_Name"),id:"lanDHCPStaticName",
validationCbk:"gridInvalidCbk",invalidField:"isDupName",invalidName:"isDupName",editRow:"edit",required:!0,cellTemplate:n.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/g,'static-dhcp-name maxlength="64"'),change:a.gridDHCPStatic.chkName},{field:"ip_address",displayName:a.DICT("Static_DHCP_IPv4_Addr"),id:"lanDHCPStaticIP",validationCbk:"gridInvalidCbk",invalidField:"isDupIpv4",invalidName:"isDupIpv4",editRow:"edit",required:!0,cellTemplate:n.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/g,
"ipv4-ip"),change:a.gridDHCPStatic.chkIPv4},{field:"mac",displayName:a.DICT("Static_DHCP_MAC_Addr"),id:"lanDHCPStaticMAC",validationCbk:"gridInvalidCbk",invalidField:"isDupMac",invalidName:"isDupMac",editRow:"edit",required:!0,cellTemplate:n.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/g,'mac-address maxlength="17"'),change:a.gridDHCPStatic.chkMac},{field:"enable",displayName:a.DICT("Static_DHCP_Enabled"),id:"lanDHCPStaticEnable",cellTemplate:n.get("UG_table_checkbox_with_inline_edit.html"),
editRow:"edit",changedCbk:a.gridDHCPStatic.chkIPv4}]});a.gridDHCPStatic.selRow=function(a,b){};a.gridDHCPStatic.add=function(){100<=a.model.static_dhcp.entry.length?app.TOOLS.criticalAlertBox({msg:a.DICT("Static_DHCP_Reach_Max_Entry",{"%d":100}),ckb:function(){}}):(a.gridDHCPStatic.Options.data.push({name:"",ip_address:"",mac:"",enable:!0,edit:!1,checked:!0,edit:!0}),a.gridDHCPStatic.Options.gridApi.customApi.scrollToLast(),a.modified())};a.gridDHCPStatic.edit=function(){angular.forEach(a.gridDHCPStatic.Options.data,
function(a){a.checked&&(a.edit=!0)})};a.gridDHCPStatic.del=function(){var b=a.model.static_dhcp.entry,e;if(b){e=b.length;for(e-=1;0<=e;e--)b[e].checked&&b.splice(e,1);a.modified();a.gridDHCPStatic.chkIPv4();a.gridDHCPStatic.chkName()}};var u=function(a,b,d){var c=[],e;angular.forEach(a,function(a,h){e=!1;angular.forEach(b,function(b,c){a[d]===b[d]&&(e=!0)});if(!e){var l={};l[d]=a[d];c.push(l)}});return c};a.save=function(){var b=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){angular.isDefined(a.checked)&&
delete a.checked;angular.isDefined(a.edit)&&delete a.edit;angular.isDefined(a.disableChk)&&delete a.disableChk;angular.isDefined(a.isDupName)&&delete a.isDupName;angular.isDefined(a.isDupIpv4)&&delete a.isDupIpv4;angular.isDefined(a.isDupMac)&&delete a.isDupMac});e.rs_clean(a);return a}(a.model.static_dhcp.entry),h=function(){var c=app.modelhelper.web2dbFn({static_dhcp:{entry:b}});s.post({url:resource_base+"p_data/rpc_result.json",method:"set_dhcp_static",params:c,success:function(b){a.success=!0;
a.config_saved=!0;w()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);w()}})},d=u(a.model_orig.static_dhcp.entry,a.model.static_dhcp.entry,"name"),c=app.modelhelper.web2dbFn({static_dhcp:{entry:d}}),k=function(){s.post({url:resource_base+"p_data/rpc_result.json",method:"del_dhcp_static",params:c,success:function(b){h();a.resetModified()},error:function(b){h();a.resetModified();console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}})};"dproxy"==
q.source?(d={},d.static_dhcp=b,proxy.DHCPStatic.set_config(d),a.result=proxy.DHCPStatic.commit({cbk:function(){a.success=!0;w()}})):0<d.length?k():h();a.resetModified()};a.cancel=function(){w();a.resetModified()}}]);app.controller("lan_ra_main",["$scope","$q","MyHttp","Sets","$templateCache","$filter","GridRowBasedEditingAdv","$timeout","UserSession","userAccessRight","DHCP_PD","ipv6_lib",function(a,b,s,n,v,t,m,q,e,w,l,h){a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.pd_list=[];a.func_flag=a.func_flag||{ipv6_addr1:!1,ipv6ra_prefix_spec_type_prefer_isp:!0};a.selected=a.selected||{};a.selected.vlan_index=0;a.success=!1;a.loadReady=!1;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();
var p=a.fop={get_origin_mode:function(a){var b="STATIC";a&&a.isp&&(b="ISP");return b},set_origin_mode:function(a,b,c){"STATIC"===b?(a["static"]=null,a.isp=void 0):angular.isDefined(c.wan_ifname)?"ISP"===b&&(b=parseInt(c.sub_prefix,16),a["static"]=void 0,a.isp={"interface":c.wan_ifname,suffix:b}):(a["static"]=null,a.isp=void 0)}};createIpAddr();var u=function(){var e=s.post({url:resource_base+"data/lan_ra.json",method:"get_interface",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+
a.config.url)}}),h=s.post({url:resource_base+"data/system_summary.json",method:"get_interface_state",params:{filter:"VLAN"},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),p=s.post({url:resource_base+"data/get_wan_ipv6_prefix.json",method:"get_wan_ipv6_prefix",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,h,p]).then(function(b){angular.extend(a.model,b[0].data.result.interfaces);angular.extend(a.model,b[1].data.result);
a.model["interface"]=a.sort_vlan_interface(a.model["interface"]);c();r(b[2]);d(b[0]);k();a.ctx.pd_list=l.get_pd_list(a.model.interfaces["interface"],a.model["interfaces-state"]["interface"]);a.model_orig=angular.copy(a.model);g();a.arrVLANv6=a.collect_vlan_v6_valid_ref();0<a.arrVLANv6.length?(a.arrVLANv6[a.selected.vlan_index]||(a.selected.vlan_index=0),a.selected.vlanif=a.arrVLANv6[a.selected.vlan_index],a.update_ra_ref(),a.gridShow=!0,a.noIpv6Vlan=!1):(a.selected.vlanif={},a.noIpv6Vlan=!0);a.selected.vlanif_ra["prefix-list"].prefix.sort(function(a,
b){return b.ref.auto_gen&&!a.ref.auto_gen?1:a.ref.auto_gen&&!b.ref.auto_gen?-1:0});a.gridRA.Options.data=a.selected.vlanif_ra["prefix-list"].prefix;a.loadReady=!0;setTimeout(function(){a.resetModified()},50)})},x=function(a,b,c){return a.name.match(/^VLAN/)&&a.ipv6&&!0===a.ipv6.enabled?!0:!1};u();var r=function(b){(b=b.data.result)&&(b["interfaces-state"]&&b["interfaces-state"]["interface"])&&angular.forEach(b["interfaces-state"]["interface"],function(b,c){a.model["interfaces-state"]["interface"].push(b)})},
d=function(b){(b=b.data.result)&&(b.interfaces&&b.interfaces["interface"])&&angular.forEach(b.interfaces["interface"],function(b,c){a.model.interfaces["interface"].push(b)})},c=function(){a.use_interfaces_state_sample={"interfaces-state":{"interface":[]}};n.recover_object(a.model,a.use_interfaces_state_sample);a.model.interfaces=a.model.interfaces||{};a.model.interfaces["interface"]=angular.copy(a.model["interface"]);var b=[],c;angular.forEach(a.model["interface"],function(a,c){a.name.match(/^VLAN/)||
(b.push(c),Log(DEBUG,a.name),Log(DEBUG,"=="+a.type+" = "+c))});for(c=b.length-1;0<=c;c--)Log(DEBUG,"DEL=="+b[c]),a.model["interface"].splice(b[c],1);angular.forEach(a.model["interface"],function(a,b){a.name.match(/^VLAN/)&&(a.ipv6||(a.ipv6={}),n.recover_object(a.ipv6,{"ipv6-router-advertisements":{mode:"unsolicited-multicast","max-rtr-adv-interval":30,"router-preference":"high","link-mtu":1500,"default-lifetime":3600,"prefix-list":{prefix:[]}}}),a.ipv6&&(a.ipv6["ipv6-router-advertisements"]&&1280>
a.ipv6["ipv6-router-advertisements"]["link-mtu"])&&(a.ipv6["ipv6-router-advertisements"]["link-mtu"]=1500))})},k=function(){var b=[{id:"unicast",displayName:a.DICT("Router_Advertisement_Unicast")},{id:"unsolicited-multicast",displayName:a.DICT("Router_Advertisement_Unsolicited_Multicast")}],c=[{id:"high",displayName:a.DICT("Router_Advertisement_High")},{id:"medium",displayName:a.DICT("Router_Advertisement_Medium")},{id:"low",displayName:a.DICT("Router_Advertisement_Low")}];a.schema=a.schema||{};a.schema.ra_modes=
b;a.schema.router_pref=c},g=function(b){var c=function(a,b){if(!a.ipv6||!a.ipv6.address)return!1;for(var c=!1,d=a.ipv6.address,g=0;g<d.length;g++){var e=d[g];if(e){var c=!1,k=e["prefix-length"],e=app.TOOLS.validation.ipv6_getNet(e.ip,k),h=b.split("/"),l=h[1],h=app.TOOLS.validation.ipv6_getNet(h[0],l);k==l&&angular.equals(e,h)&&(c=!0);c=c?!0:!1}else c=!1;if(c)break}return c},d=function(b,d){var g=d["prefix-spec"],e=g.indexOf("/");d.checked=!1;d.ref={};var k=c(b,g);angular.extend(d.ref,{prx:g.substring(0,
e),len:parseInt(g.substring(e+1),10),type:!0===a.func_flag.ipv6ra_prefix_spec_type_prefer_isp?p.get_origin_mode(d)||"STATIC":"STATIC",pd:"WAN1",pd_prx:g.substring(0,e),pd_prx2:"",userdef_prx:g.substring(0,e),auto_gen:k});!0===a.func_flag.ipv6ra_prefix_spec_type_prefer_isp&&(g=function(b){var c;angular.forEach(a.ctx.pd_list,function(a,c){b["interface"]===a.id&&(d.ref.pd_prx1=a.id,d.ref._ip_pd_obj=a)});c=parseInt(b.suffix,10);isNaN(c)?(Log(ERROR,'[LAN RA] renew_pd_setting_by_isp_interface() got error, sub prefix is not number "'+
b.suffix+'"'),Log(ERROR,"[LAN RA] ERR: "+JSON.stringify(d))):d.ref.pd_prx2=c.toString(16);a.update_pdprx(d.ref,{entity:d})},d.isp&&d.isp["interface"]&&g(d.isp));"ISP"===d.ref.type&&d.ref._ip_pd_obj&&(g=d.ref._ip_pd_obj,g.pd_prefix||(d.ref.prx=g.prefix_name+"("+g.id+") + "+d.ref.pd_prx2))};b=a.collect_vlan_v6_valid_ref();angular.forEach(b,function(a,b){angular.forEach(a.ipv6["ipv6-router-advertisements"]["prefix-list"].prefix,function(b,c){b.isDupIpv6raps=!1;d(a,b)})})};a.update_ra_ref=function(){a.selected.vlanif_ra=
a.selected.vlanif.ipv6["ipv6-router-advertisements"];a.selected.vlan_index=a.model["interface"].indexOf(a.selected.vlanif);a.selected.vlanif_ra["prefix-list"].prefix.sort(function(a,b){return b.ref.auto_gen&&!a.ref.auto_gen?1:a.ref.auto_gen&&!b.ref.auto_gen?-1:0});a.gridRA.Options.data=a.selected.vlanif_ra["prefix-list"].prefix};a.collect_wan_dhcp_pd=function(){return a.ctx.pd_list};a.update_ipv6_prx=function(a,b,c){var d=createIpAddr();c=!0;var g;a=!d.IPv6.isValid(a)?!1:d.parse(a);!1===a&&(c=!1);
b=!d.IPv6.isValid(b)?!1:d.parse(b);!1===b&&(c=!1);if(c){a.parts.length!==b.parts.length&&console.log("Error: preview_v6ip, IPv6 part not correct");g=angular.copy(a);for(c=0;c<a.parts.length;c++)g.parts[c]=a.parts[c]|b.parts[c];g=g.toString()}return g};a.update_userdef_prx=function(b,c){var d=c.entity.ref.len;b.prx=a.update_ipv6_prx(b.userdef_prx,"::",d);b.prx&&(c.entity["prefix-spec"]=b.prx+"/"+d);p.set_origin_mode(c.entity,"STATIC");a.gridRA.chkIpv6Ip()};a.update_pdprx=function(b,c){var d=c.entity.ref.len,
g,e=b._ip_pd_obj,k;e&&(b.pd_prx1=e.pd_prefix);if(!_.isNumber(d)||!b.pd_prx2||!e)Log(DEBUG,"[LAN RA] update_pdprx() prxlen: "+d+", prx1: "+b.pd_prx1+", prx2: "+b.pd_prx2);else{g=l.get_pd_preview(b.pd_prx1,b.pd_prx2,"0",d);g=g.toNormalizedString();b.prx=g;if(b.prxPreview=g){if((e=e.id.match(/^(WAN|TUN)(\d+)($|\.\d+$)/))&&!b.auto_gen)k=parseInt(e[2],10),"TUN"===e[1]&&(k+=2),k<<=12,e[3]&&(k|=parseInt(e[3].replace(".",""),10)),k=k.toString(16)+"::/16";c.entity["prefix-spec"]=l.get_pd_preview(k,b.pd_prx2,
"0",d).toString()+"/"+d}b._ip_pd_obj&&!b._ip_pd_obj.pd_prefix&&(b.prx=b._ip_pd_obj.prefix_name+"("+b._ip_pd_obj.id+") + "+b.pd_prx2);p.set_origin_mode(c.entity,"ISP",{wan_ifname:b._ip_pd_obj&&b._ip_pd_obj.id,sub_prefix:b.pd_prx2});a.gridRA.chkIpv6Ip()}};a.update_prx_len=function(b,c){"STATIC"===c.entity.ref.type?a.update_userdef_prx(c.entity.ref,c):a.update_pdprx(c.entity.ref,c)};a.sort_vlan_interface=function(a){a=t("filter")(a,x)||[];if(0<a.length){var b=app.TOOLS.sortingInterfaceFn(!1);a=a.sort(b)}return a};
a.collect_vlan_v6_valid_ref=function(){return t("filter")(a.model["interface"],x)||[]};a.T_cellEdit=v.get("T_editWithNoFoucs_by_rowEditableState_objs.html");a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridRA=a.gridRA||{};a.gridRA.Selections=[];a.gridRA.warningCheck=function(){return 10<=a.selected.vlanif_ra["prefix-list"].prefix.length?(a.msg="Only allow maximum of 10 entries for Prefix. (Current Entry Number: "+a.selected.vlanif_ra["prefix-list"].prefix.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,
cbk:function(a){}}),!0):!1};a.gridRA.checkProtectCondition=function(){var b=!1;angular.forEach(a.selected.vlanif_ra["prefix-list"].prefix,function(a,c){!0===a.checked&&(a.ref&&!0===a.ref.auto_gen)&&(b=!0)});return b};a.gridRA.add=function(){if(!a.gridRA.warningCheck()){var b=a.selected.vlanif_ra["prefix-list"].prefix,c;c={checked:!0,edit:!1,"prefix-spec":"","preferred-lifetime":3600,ref:{prx:"",len:64,type:"STATIC",pd:"WAN1",pd_prx:""}};var d=a.ctx.pd_list;c.edit=!0;c.ref._ip_pd_obj=d[0];b.push(c);
a.gridRA.Options.gridApi.customApi.scrollToLast()}};a.gridRA.procNgClick=function(b){a.gridRA.Selections=[];angular.forEach(a.selected.vlanif_ra["prefix-list"].prefix,function(b,c){b.checked?a.gridRA.Selections.push(b):b.edit=!1})};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridRA.Options=app.uiGrid.generateGridOptions({IDPreifx:"PrefixTable",rowHeight:2*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridRA.procNgClick,disableChkBoxField:"disableChk",
headerChangedCbk:a.gridRA.procNgClick},{field:"ref",displayName:a.DICT("Router_Advertisement_IPv6_Prefix"),validationCbk:"gridInvalidCbk",minWidth:800,cellTemplate:v.get("UG_prefix_ref.html").replace(/data-ng-expansion/,'placeholder="IPv6 Prefix(e.g. fc01::0)"'),editRow:"edit"},{field:"ref.len",displayName:a.DICT("Router_Advertisement_Prefix_Length"),id:"txt_PrefixTablePrefixlen",validationCbk:"gridInvalidCbk",min:32,max:128,changedCbk:a.update_prx_len,editRow:"edit",invalidField:"isDupIpv6raps",
cellTemplate:"UG_table_text_with_inline_number_edit.html"},{field:"preferred-lifetime",displayName:a.DICT("Router_Advertisement_Lifetime"),id:"slct_PrefixTableLifetime",validationCbk:"gridInvalidCbk",cellTemplate:v.get("UG_table_text_with_inline_number_edit.html"),min:10,max:9E3,editRow:"edit"}]});var z=function(a,b){var c=!1,d=!1,g=function(a){var b=a["prefix-spec"];a=a.ref;var c=a._ip_pd_obj,d;if("ISP"!==a.type||!a.auto_gen||!c||!b)return b;if(a=c.id.match(/^(WAN|TUN)(\d+)($|\.\d+$)/))d=parseInt(a[2],
10),"TUN"===a[1]&&(d+=2),d<<=12,a[3]&&(d|=parseInt(a[3].replace(".",""),10)),d=d.toString(16)+"::",d=h.parse(d);d&&(a=h.CIDR(b))&&(b=h.combined_two_ip(d,a[0],16).toString()+"/"+a[1]);return b},e=function(a,b){var c=!1,d=g(b),e=g(a);d&&e&&(c=h.vld.is_overlap_between_prefixs(d,e));return c};a&&(b&&a["prefix-spec"]&&b["prefix-spec"])&&(d=!0);!c&&d&&(rowE_addrs=b,item_addrs=a,!0===e(rowE_addrs,item_addrs)&&(c=!0));return c};a.gridRA.chkIpv6Ip=function(){if(a.selected&&a.selected.vlanif_ra&&a.selected.vlanif_ra["prefix-list"]&&
a.selected.vlanif_ra["prefix-list"].prefix){var b=a.selected.vlanif_ra["prefix-list"].prefix,c={},d=b.length,g=!1,e,k;for(e=0;e<d;e++)k=b[e],k.isDupIpv6raps=!1;for(e=0;e<d;e++)if(k=b[e],!0!==k.isDupIpv6raps){for(var g=!1,h=e+1,l;h<d;h++)l=b[h],z&&z(l,k,c)&&(g=!0,l.isDupIpv6raps=g);g&&(k.isDupIpv6raps=!0)}}};a.gridRA.edit=function(){angular.forEach(a.selected.vlanif_ra["prefix-list"].prefix,function(a){a.checked&&(a.edit=!0)})};a.gridRA.remove=function(){var b=a.selected.vlanif_ra["prefix-list"].prefix,
c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1)};a.save=function(){var b=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){a.ipv6&&angular.forEach(a.ipv6["ipv6-router-advertisements"]["prefix-list"].prefix,function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableChk)&&delete a.disableChk;a.ref=void 0;delete a.edit;delete a.isDupIpv6raps})});return a}(a.collect_vlan_v6_valid_ref());t("filter")(a.model_orig["interface"],x);(function(){s.post({url:resource_base+
"data/lan_ra.json",forcedUsingPost:!0,method:"set_ra",params:{interfaces:{"interface":b}},success:function(b){a.success=!0;a.config_saved=!0;u()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})();a.resetModified()};a.cancel=function(){u();a.resetModified()}}]);app.factory("ciscosb",function(){return{empty_type:function(a,b){var s={};s[a]=null;return s}}});app.service("meta_data_service",[function(){this.generate=function(a,b){var s=a.groups&&a.groups.group||[],n=a.categories&&a.categories.category||[],v=a.applications&&a.applications.application||[],t={},m,q={},e={},w={},l;angular.forEach(a.behaviours&&a.behaviours.behaviour||[],function(a){w[a.id]={name:a.name||"",id:a.id||"",description:a.description||"",checked:!1,action:"log"}});angular.forEach(v,function(a){m=a.behaviors&&a.behaviors[0]&&a.behaviors[0].split(" ")||[];q[a.id]={name:a.name,id:a.id,
previous:a.parent,action:"null",checked:!1,expanded:!1,child:"behaviors",behaviors:{}};l=!1;angular.forEach(m,function(b){"-1"!==b&&w[b]&&(q[a.id].behaviors[b]=angular.copy(w[b]),l=!0)});!l&&b&&delete q[a.id]});angular.forEach(n,function(a){m=a.applications&&a.applications.application&&a.applications.application[0]&&a.applications.application[0].split(" ")||[];e[a.id]={name:a.name,id:a.id,checked:!1,action:"null",expanded:!1,child:"applications",description:a.description,applications:{}};l=!1;angular.forEach(m,
function(b){"-1"!==m&&q[b]&&(e[a.id].applications[b]=angular.copy(q[b]),l=!0)});!l&&b&&delete e[a.id]});angular.forEach(s,function(a){m=a.categories&&a.categories.categores&&a.categories.categores[0]&&a.categories.categores[0].split(" ")||[];t[a.id]={name:a.name,id:a.id,checked:!1,expanded:!1,action:"null",child:"categories",categories:{}};l=!1;angular.forEach(m,function(b){"-1"!==b&&e[b]&&(t[a.id].categories[b]=angular.copy(e[b]),l=!0)});!l&&b&&delete t[a.id]});return t}}]);app.factory("customUIGrid",["$templateCache",function(a){return{refactory:function(){a.put("ui-grid/expandableRowHeader",'<div class="ui-grid-row-header-cell ui-grid-expandable-buttons-cell"><div class="ui-grid-cell-contents"> <i ng-class="{ \'ui-grid-icon-plus-squared\' : !row.isExpanded, \'ui-grid-icon-minus-squared\' : row.isExpanded }" id="icon_plus_{{rowRenderIndex}}" ng-click="grid.api.expandable.toggleRowExpansion(row.entity)"></i></div></div>');a.put("ui-grid/expandableTopRowHeader",'<div class="ui-grid-row-header-cell ui-grid-expandable-buttons-cell"><div class="ui-grid-cell-contents"> <i ng-class="{ \'ui-grid-icon-plus-squared\' : !grid.expandable.expandedAll, \'ui-grid-icon-minus-squared\' : grid.expandable.expandedAll }" id="icon_top_plus" ng-click="grid.api.expandable.toggleAllRows()"></i></div></div>');
a.put("ui-grid/selectionRowHeaderButtons",'<input type="checkbox" ng-checked="row.isSelected" style="margin: 3px 0px" ng-click="selectButtonClick(row, $event)"></input>');a.put("ui-grid/selectionSelectAllButtons",'<input type="checkbox" ng-checked="grid.selection.selectAll" ng-click="headerButtonClick($event)"></input>');a.put("ui-grid/uiGridViewport",'<div role="rowgroup" class="ui-grid-viewport" ng-style="colContainer.getViewportStyle()">\x3c!-- tbody --\x3e<div class="ui-grid-canvas"><div ng-repeat="(rowRenderIndex, row) in rowContainer.renderedRows track by $index"class="ui-grid-row" ng-style="Viewport.rowStyle(rowRenderIndex)" pg-row><div role="row" ui-grid-row="row" row-render-index="rowRenderIndex" ></div></div></div></div>');
a.put("ui-grid/ui-grid-header",'<div role="rowgroup" class="ui-grid-header">\x3c!-- theader --\x3e<div class="ui-grid-top-panel"><div class="ui-grid-header-viewport"><div class="ui-grid-header-canvas"><div class="ui-grid-header-cell-wrapper" ng-style="colContainer.headerCellWrapperStyle()"><div role="row" class="ui-grid-header-cell-row"><div class="ui-grid-header-cell ui-grid-clearfix" ng-repeat="col in colContainer.renderedColumns track by col.uid" ui-grid-header-cell col="col" render-index="$index"></div></div></div><div class="ui-grid-header-seperator"></div></div></div></div></div>');
a.put("ui-grid/uiGridHeaderCell",'<div role="columnheader" ng-class="[col.colDef.headerClass, { \'sortable\': sortable }]" ui-grid-one-bind-aria-labelledby-grid="col.uid + \'-header-text \' + col.uid + \'-sortdir-text\'"aria-sort="{{col.sort.direction == asc ? \'ascending\' : ( col.sort.direction == desc ? \'descending\' : (!col.sort.direction ? \'none\' : \'other\'))}}"><div role="button" tabindex="0" class="ui-grid-cell-contents ui-grid-header-cell-primary-focus" col-index="renderIndex" title="TOOLTIP"><table class="ui-grid-header-custom-cell"><tr><td style="width: auto"><span class="ui-grid-header-cell-label" ui-grid-one-bind-id-grid="col.uid + \'-header-text\'">{{ col.displayName CUSTOM_FILTERS }}</span></td><td><span ui-grid-one-bind-id-grid="col.uid + \'-sortdir-text\'" ui-grid-visible="col.sort.direction || sortable" aria-label="{{getSortDirectionAriaLabel()}}"><i ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction && !sortable, \'ui-grid-icon-sort-dir\': !col.sort.direction && sortable }" title="{{isSortPriorityVisible() ? i18n.headerCell.priority + \' \' + ( col.sort.priority + 1 )  : null}}" aria-hidden="true"></i> <sub ui-grid-visible="isSortPriorityVisible()" class="ui-grid-sort-priority-number">{{col.sort.priority + 1}}</sub></span></td></tr></table></div><div role="button" tabindex="0" ui-grid-one-bind-id-grid="col.uid + \'-menu-button\'" class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" ng-click="toggleMenu($event)" ng-class="{\'ui-grid-column-menu-button-last-col\': isLastCol}" ui-grid-one-bind-aria-label="i18n.headerCell.aria.columnMenuButtonLabel" aria-haspopup="true"><i class="ui-grid-icon-angle-down" aria-hidden="true">&nbsp;</i></div><div ui-grid-filter></div></div>')}}}]);
app.factory("customNgGrid",["$templateCache",function(a){return{refactory:function(){a.put("rowTemplate.html",'<div ng-style="{ \'cursor\': row.cursor }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}">\r\n\t<div ng-cell></div>\r\n</div>')}}}]);
app.factory("customUIBootstrapTpls",["$templateCache",function(a){return{refactory:function(){a.put("uib/template/datepicker/day.html",'<table role="grid" class="cisco-datepicker"aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}" custom-datepicker>\n  <thead>\n    <tr>\n      <th><img src="themes/img/icon/drawerTriangleCollapsedLeft.png" ng-click="move(-1); moveMonth(-1)" tabindex="-1"></img></th>\n      <th colspan="7" style="text-align:center">           <select ng-model="month" ng-options="m.id as m.displayName for m in months" ng-change="changeMonth()"></select>           <input type="number" style="width: 65px;" max="2037" min="1970" ng-model="year" ng-maxlength="4" ng-minlength="4" ng-change="changeYear()"></select>      </th>\n      <th><img src="themes/img/icon/drawerTriangleCollapsed.gif" ng-click="move(1); moveMonth(1)" tabindex="-1"></img></th>\n    </tr>\n    <tr>\n      <th></th>\n      <th ng-repeat="m in weeks track by $index" class="text-center"><small aria-label="{{::label.full}}" ng-bind="m.displayName"></small></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td></td>\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{::dt.uid}}" ng-class="::dt.customClass">\n        <button type="button" style="min-width:100%;" class="cisco-datepicker-day" ng-class="{\'cisco-btn-day-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="::{\'text-muted\': dt.secondary, \'text-info\': dt.current}">{{::dt.label}}</span></button>\n      </td>\n      <td></td>\n    </tr>\n  </tbody>\n</table>\n');a.put("uib/template/datepicker/popup.html",
'<ul class="dropdown-menu" dropdown-nested ng-if="isOpen" style="display: block; padding: 0px;"        ng-style="{top: position.top+\'px\', left: position.left+\'px\'}" ng-keydown="keydown($event)" ng-click="$event.stopPropagation()">\n\t<li ng-transclude></li>\n</ul>\n');a.put("uib/template/modal/window.html",'<div modal-render="{{$isRendered}}" tabindex="-1" role="dialog" class="modal"\n    uib-modal-animation-class="fade"\n    modal-in-class="in"\n    ng-style="{\'z-index\': 1050 + index*10, display: \'block\'}">\n    <div class="modal-dialog" ng-class="size ? \'modal-\' + size : \'\'"><div class="modal-content" uib-modal-transclude></div></div>\n</div>\n')}}}]);
app.factory("ciscoDesign",["customUIBootstrapTpls","customUIGrid","customNgGrid",function(a,b,s){return{refactory:function(){a.refactory();b.refactory();s.refactory()}}}]);app.directive("pgRow",[function(){return{restrict:"A",link:function(a,b,s){var n;n=a.$watch(function(){var n=b.height();a.row.offsetHeight=n});a.$on("$destroy",function(){n&&n()})}}}]);app.service("DHCP_PD",["MyHttp","wan_service","$filter","ipv6_lib","$rootScope",function(a,b,s,n,v){var t=function(a,b,l){return a.ipv6&&a.ipv6.setting&&a.ipv6.setting.prefix_name?!0:!1},m={physical:!0,subinterface:!0,ipv6transition:!0},q={get_pd_list:function(a,w){a||(a=[]);w||(w=[]);var l=[],h,p;a=b.filter(a,m);angular.forEach(a,function(a){h=a.ipv6&&a.ipv6.setting||{};p=a.name.match(/^TUN\d+/)?!0:!1;h["dhcp-pd-enable"]&&l.push({id:a.name,prefix_name:h["prefix-name"]||"",display_name:"",is_tun:p,
prefix:"",prefix_len:0,pd_prefix:""})});return l=q.update_pd_state(l,w)},update_pd_state:function(a,b){a||(a=[]);b||(b=[]);var l={},h,p=createIpAddr(),u;angular.forEach(b,function(a){l[a.name]=a});angular.forEach(a,function(a){a.is_tun?(h=a.prefix_name.toUpperCase(),h=h.replace("_","-")):h=a.prefix_name+"_PD";l[h]&&l[h].ipv6&&l[h].ipv6["dhcp-pd-prefix"]?(u=p.parseCIDR(l[h].ipv6["dhcp-pd-prefix"]),a.prefix_len=u[1],a.prefix=u[0].toNormalizedString(),a.pd_prefix=l[h].ipv6["dhcp-pd-prefix"],a.display_name=
a.prefix_name+"("+a.id+") - "+a.pd_prefix):(a.prefix_len=0,a.prefix="",a.pd_prefix="",a.display_name=a.prefix_name+"("+a.id+") - "+v.DICT("Unavailable"))});return a},get_pd_interfaces:function(a,q,l){a=b.filter(a,m);var h=s("filter")(a,t),p=createIpAddr(),u;q=s("filter")(q,function(a,b,d){var c=!1;return!a||!a.name?c:(b=a.name.match(/_PD$/))?(angular.forEach(h,function(b,d){var e=b.ipv6.setting.prefix_name;a.name==e+"_PD"&&(c=!0,a._WANname=b.name,a._WANPrefixName=e,a.ipv6&&a.ipv6.dhcp_pd_prefix&&
(e=a.ipv6.dhcp_pd_prefix.split("/"),u=p.parse(e[0]),a.ipv6.dhcp_pd_prefix_full=u.toNormalizedString().toLowerCase()+"/"+e[1]))}),c):(b=a.name.match(/^(WAN\d+)-(TUN\d+)/))?(c=!0,a._WANname=b[2],a._WANPrefixName=b[1].toLowerCase()+"_"+b[2].toLowerCase(),a.ipv6&&a.ipv6.dhcp_pd_prefix&&(b=a.ipv6.dhcp_pd_prefix.split("/"),u=p.parse(b[0]),a.ipv6.dhcp_pd_prefix_full=u.toNormalizedString().toLowerCase()+"/"+b[1]),c):!1});l&&(l=s("filter")(l,function(a,b,d){b=!1;a.name.match(/^TUN/)&&("ip6rd"==a.type&&!0===
a.enabled&&a.ipv6rd&&a.ipv6rd.ip6prefix&&"auto"==a.ipv6rd.config_mode)&&(b=!0);return b?(a.ipv6=a.ipv6||{},b=a.ipv6rd.ip6prefix.split("/"),u=p.parse(b[0]),a.ipv6.dhcp_pd_prefix=a.ipv6rd.ip6prefix,a.ipv6.dhcp_pd_prefix_full=u.toNormalizedString().toLowerCase()+"/"+b[1],a._WANname="Tunnel for IPv6 6RD",!0):!1}),q=q.concat(l));return q},get_pd_preview:function(a,b,l,h){var p=createIpAddr(),u,m,r;if((l=q.parse_user_identifier(l))&&_.isString(b)){a&&(u=p.IPv6.parseCIDR(a));u?(a=u[1],u=n.get_prefix(u[0],
a)):(a=0,u=p.IPv6.parse("0::0"));p=parseInt(b,16).toString(2);r=h-a;if(r>p.length)for(i=p.length;i<r;i++)p="0"+p;Log(DEBUG,"[DHCP_PD] get_pd_preview() pd-prefix-length: "+a+", pd-prefix-ip: "+u.toNormalizedString());Log(DEBUG,"[DHCP_PD] get_pd_preview() sub-prefix: "+b+", pd-prefix-ip: "+u.toNormalizedString()+", subPrefixBinary: "+p);b=Math.floor(a/16);r=Math.floor(h/16)+(h%16?1:0);Log(DEBUG,"[DHCP_PD] get_pd_preview() start: "+b+", end: "+r);for(i=r-1;i>=b;i--)r=m=0,base=16*i,tmp=a-base,0<tmp&&
(m=tmp),tmp=h-base,16<tmp?r=16:0<tmp&&(r=tmp),u.parts[i]&=(1<<m)-1<<16-m,0<r&&(m=r-m,tmp=p.substr(p.length-m,p.len),tmp=parseInt(tmp,2),p=p.substr(0,p.length-m),u.parts[i]|=tmp<<16-r);Log(DEBUG,"[DHCP_PD] get_pd_preview() response ip: "+u.toNormalizedString()+", identifierIpaddr: "+l.toNormalizedString());return n.combined_two_ip(u,l,h)}},parse_user_identifier:function(a){var b=void 0,l=createIpAddr();if(!a||!_.isString(a)||a.match("::")||39<a.length)return b;a=34>=a.length?"::"+a:a;return!l.IPv6.isValid(a)?
b:b=l.IPv6.parse(a)},gen_eui64_ip:function(a){var b=createIpAddr();a=a.replace(/:/g,"");a=a.substr(0,4)+":"+a.substr(4,2)+"FF:FE"+a.substr(6,2)+":"+a.substr(8,4);var l=parseInt(a.substr(0,2),16);a=(0===(l&2)?l|2:l&253).toString(16)+a.substr(2);return b.IPv6.parse("::"+a).toString().toLowerCase()}};this.get_pd_list=q.get_pd_list;this.get_pd_preview=q.get_pd_preview;this.get_pd_interfaces=q.get_pd_interfaces;this.parse_user_identifier=q.parse_user_identifier;this.gen_eui64_ip=q.gen_eui64_ip;this.update_pd_state=
q.update_pd_state}]);app.service("wan_lib",["MyHttp","$q","wan_service",function(a,b,s){var n=!1,v="upstream",t="percentage",m="auto",q=[],e={},w=[],l=[],h=[],p=[],u=[],x="",r=!1,d=this,c=function(c){b.defer();return a.post({url:resource_base+"data/pc_mac.json",method:"get_pc_mac",error:function(a){k();Log(ERROR,"WANSettingCtrl error: getPCMac"+a.status)}})},k=function(a){a||(a={});x=a.mac||"";r=a["interface-name"]&&a["interface-name"].match(/^VLAN\d+/)?!0:!1},g=function(b){return a.post({url:resource_base+"data/wan_setting1.json",
method:"get_interface",procBackground:b&&b.procBackground||void 0,error:function(a){y();Log(ERROR,"WANSettingCtrl error: "+a.status)}})},z=function(a){var b=function(a,b,c){a[b]&&(a[c]=a[b],delete a[b]);return a};a||(a={});var c,d=a.nat||{},g=a.ipv4||{},e=a.ipv6||{},k=g.address||[],h=e.address||[],l="WAN1";a.name&&a.name.match(/^WAN2/)&&(l="WAN2");var r={intf:l,isCreateSubInterface:!1,name:a.name||"",description:a.description||"",nat:{enable:void 0!==d.enable?d.enable:!0},vlan_interface_settings:{vlan_id:a["vlan-interface-settings"]&&
a["vlan-interface-settings"]["vlan-id"]||""},mac_address_clone:a["mac-address-clone"]||!1,mac_address:a["mac-address"]||"",mtuType:"auto",mtu:1500,ipv4:{connectType:"dynamic",enabled:void 0!==g.enabled?g.enabled:!0,address:{ip:k[0]&&k[0].ip||"",netmask:k[0]&&k[0].netmask||"",prefix_length:k[0]&&k[0]["prefix-length"]||""},physical:"dhcp",setting:{ifname:"WAN1",ifnames:p&&p[0]&&p[0].id||"",selectDemand:!1,demand:5,keepalive:30,username:"",password:"",orig_password:"",changed_password:!1,gateway:"",
server:"",authentication_type:"auto",service:"",wan_connection:"",mppe:!1,peerdns:!0,naming_server:{servers:["",""]}}},ipv6:{connectType:"slaac",enabled:void 0!==e.enabled?e.enabled:!1,address:{ip:h[0]&&h[0].ip||"",netmask:h[0]&&h[0].netmask||"",prefix_length:h[0]&&h[0]["prefix-length"]||""},setting:{selectDemand:!1,ifname:"WAN1",demand:5,server:"",keepalive:30,gateway:"",username:"",password:"",orig_password:"",changed_password:!1,authentication_type:"auto",dhcp_pd_enable:!1,prefix_name:"",peerdns:!0,
stp:!1,ifnames:p&&p[0]&&p[0].id||"",naming_server:{servers:["",""]},share_ipv4_pppoe_session:!1}}};a.ipv4&&a.ipv4.mtu&&(r.mtuType="manual",r.mtu=a.ipv4.mtu);a.ipv4&&a.ipv4.setting&&angular.forEach(a.ipv4.setting,function(a,d){void 0!==a.demand&&(a.selectDemand=!0);switch(d){case "static":case "dynamic":break;case "pptp":case "l2tp":r.ipv4.physical=a.origin;break;case "pppoe":break;case "trasparent-bridge":a.ifnames&&a.ifnames[0]&&(r.ipv4.setting.ifnames=a.ifnames[0].split(" ")[0],delete a.ifnames);
break;default:return}a=b(a,"authentication-type","authentication_type");a=b(a,"wan-connection","wan_connection");a["naming-server"]&&(a["naming-server"].servers&&a["naming-server"].servers[0]&&(c=a["naming-server"].servers[0].split(" "),a.naming_server={servers:["",""]},c&&c[0]&&(a.naming_server.servers[0]=c[0]),c&&c[1]&&(a.naming_server.servers[1]=c[1])),delete a["naming-server"]);r.ipv4.connectType=d;$.extend(r.ipv4.setting,a);if(r.ipv4.setting.orig_password=r.ipv4.setting.password)r.ipv4.setting.password=
"00000000";r.ipv4.setting.changed_password=!1});a.ipv6&&a.ipv6.setting&&angular.forEach(a.ipv6.setting,function(a,d){void 0!==a.demand&&(a.selectDemand=!0);switch(d){case "slaac":case "dynamic":case "static":break;case "pppoe":break;case "dhcp-pd-enable":r.ipv6.setting.dhcp_pd_enable=a;return;case "prefix-name":r.ipv6.setting.prefix_name=a;return;default:return}a=b(a,"authentication-type","authentication_type");a=b(a,"share-ipv4-pppoe-session","share_ipv4_pppoe_session");a["naming-server"]&&(a["naming-server"].servers&&
a["naming-server"].servers[0]&&(c=a["naming-server"].servers[0].split(" "),a.naming_server={servers:["",""]},c&&c[0]&&(a.naming_server.servers[0]=c[0]),c&&c[1]&&(a.naming_server.servers[1]=c[1])),delete a["naming-server"]);r.ipv6.connectType=d;$.extend(r.ipv6.setting,a);if(r.ipv6.setting.orig_password=r.ipv6.setting.password)r.ipv6.setting.password="00000000";r.ipv6.setting.changed_password=!1});r.ipv4&&(r.ipv4.address.netmask&&!r.ipv4.address.prefix_length)&&(r.ipv4.address.prefix_length=app.TOOLS.netmask.inet2Int(r.ipv4.address.netmask));
r.ipv4&&(r.ipv4.address.prefix_length&&!r.ipv4.address.netmask)&&(r.ipv4.address.netmask=app.TOOLS.netmask.int2Inet(parseInt(r.ipv4.address.prefix_length,10)));return r},y=function(a){var b=[],c,d=[],g,e,k;l=[];u=[];a&&(a.interfaces&&a.interfaces["interface"])&&(b=a.interfaces["interface"]);angular.forEach(b,function(a,b){c=a.name;"WAN1"===c&&a["igmp-proxy"]&&(void 0!==a["igmp-proxy"].enable&&(n=a["igmp-proxy"].enable),void 0!==a["igmp-proxy"].type&&(v=a["igmp-proxy"].type));if(g=c.match(/^WAN(\d+)(?:$|\.(\d+)$)/))e=
parseInt(g[1],10),k=parseInt(g[2],10)||0,e&&(d[e]||(d[e]=[]),d[e][k]=z(a))});a=d.length;for(e=0;e<a;e++)if(d[e]){b=d[e].length;for(k=0;k<b;k++)d[e][k]&&l.push(d[e][k])}angular.copy(l)},A=function(a){a||(a=[]);var b=[];a.interfaces&&a.interfaces["interface"]&&(b=a.interfaces["interface"]);p=[];angular.forEach(b,function(a){a.name.match(/^VLAN/)&&p.push({id:a.name,displayName:a.name})})},B=function(b){return a.post({url:resource_base+"data/wan_setting1.json",procBackground:b&&b.procBackground||void 0,
method:"get_dual_wan",error:function(a){C()}})},C=function(a){a||(a={});var b=[],c,g,k,h=[],l=[],r=[],p;a.interfaces&&a.interfaces["interface"]&&(b=d.filter_available_interfaces(a.interfaces["interface"]));t="percentage";q=[];e={};a=b.length+1;for(k=0;k<a;k++)e[k]=[];angular.forEach(b,function(a){c=a["redundant-wan"]||{};"WAN1"===a.name&&void 0!==c.bandwidth&&(t="bandwidth");c.enable&&(g=D(a,c),p=parseInt(g.precedence,10),r[p]||(r[p]={wans:[],usbs:[]}),a.name.match(/^WAN\d+/)&&(h.push(g),r[p].wans.push(a.name)),
a.name.match(/^USB\d+/)&&(l.push(g),r[p].usbs.push(a.name)))});angular.forEach(r,function(a,b){a&&(e[b]=r[b].wans.concat(r[b].usbs))});q=h.concat(l);w=angular.copy(q)},D=function(a,b){a||(a={});b||(b={});return{name:a.name||"",precedence:b.precedence||"",weight:b.weight||"",bandwidth:b.bandwidth||""}},E=function(a){var b,c,d;angular.forEach(a,function(a){for(b=q.length-1;0<=b;b--)if(q[b].name===a){c=e[q[b].precedence];for(d=c.length-1;0<=d;d--)c[d]===a&&c.splice(d,1);q.splice(b,1)}})},I=function(){var a=
[],b,c;if(w.length===q.length)return a;w.length<q.length&&angular.forEach(q,function(d){b=!0;angular.forEach(w,function(a){a.name===d.name&&(b=!1)});b&&(c={name:d.name,"redundant-wan":{enable:!0,precedence:d.precedence}},"percentage"===t?c["redundant-wan"].weight=100:c["redundant-wan"].bandwidth=100,a.push(c))});var d={},g=1,k,h={};w.length>q.length&&(angular.forEach(q,function(a){d[a.name]=a}),angular.forEach(u,function(a){h[a]=!0}),angular.forEach(w,function(b){d[b.name]||h[b.name]||a.push({name:b.name,
"redundant-wan":{enable:!1}})}),angular.forEach(e,function(b,e){if(k=b.length)angular.forEach(b,function(b,e){d[b].precedence=g;c={name:b};"percentage"===t?(d[b].weight=(100-100%k)/k,0===e&&(d[b].weight+=100%k),c["redundant-wan"]={precedence:g,weight:d[b].weight}):c["redundant-wan"]={precedence:g,bandwidth:d[b].bandwidth};a.push(c)}),g++}));return a},F=function(b){return a.post({url:resource_base+"data/igmp_proxy.json",procBackground:b&&b.procBackground||void 0,isPolling:b&&b.isPolling||void 0,method:"get_igmp",
error:function(a){Log(ERROR,"WANSettingEditCtrl getIGMPData error : "+a.status);H()}})},H=function(a){a||(a={});m=(a["igmp-proxy"]||{})["upstream-interface"]||"auto"},G=function(b){return a.post({url:resource_base+"data/wan_setting_state.json",params:{filter:"WAN"},procBackground:b&&b.background||void 0,isPolling:b&&b.isPolling||void 0,method:"get_interface_state",error:function(a){Log(ERROR,"WANSettingEditCtrl getWanStateData error : "+a.status);J()}})},J=function(a){a||(a={});a=(a["interfaces-state"]||
{})["interface"]||[];var b,c=RegExp(d.regexpStr.wanIntef),g={};h=[];angular.forEach(a,function(a){if(a.name){var b=a.name.match(c),d=a.name;b&&(d=b[1]+b[3]);g[d]||(g[d]={physical:{},logical:[]});b&&b[2]?g[d].logical.push(a):g[d].physical=a}});angular.forEach(g,function(a,c){var d=a.physical||{},g=d.ipv4||{},e=g.address||[],k=d.ipv6||{},l=k.address||[],r;angular.forEach(a.logical,function(a){if(a.ipv4||"l2tp"===a.type||"pptp"===a.type)g=a.ipv4||{};a.ipv6&&(k=a.ipv6||{})});e=g.address||[];l=k.address||
[];b={name:c,link_status:d["link-status"]||"",phys_address:d["phys-address"]||"",admin_status:d["admin-status"]||"down",oper_status:d["oper-status"]||"down",ipv4_ip:[],ipv6_ip:[]};angular.forEach(e,function(a){a.ip&&(r={ip:a.ip||"",prefix:void 0!==a["prefix-length"]?a["prefix-length"]:"",netmask:a.netmask||""},""===r.prefix&&""!==r.netmask&&(r.prefix=app.TOOLS.netmask.inet2Int(r.netmask)),b.ipv4_ip.push(r))});angular.forEach(l,function(a){a.ip&&"::"!==a.ip&&b.ipv6_ip.push({ip:a.ip||"",prefix:a["prefix-length"]||
"",netmask:a.netmask||""})});h.push(b)})},L=function(b,c){var d=I(),g=[];d.length&&g.push({method:"set_dual_wan",params:{interfaces:{"interface":d}}});g.push({method:"del_interface",params:b});a.post({method:"set_bulk",params:g,success:function(a){c.resolve(a)},error:function(a){c.resolve("falure")}})},N=function(a,b){var c=a&&a.intfs||[],d={};0!==c.length&&(d={interfaces:{"interface":[]}},angular.forEach(c,function(a,b){d.interfaces["interface"].push({name:a.name});u.push(a.name);E([a.name])}),L(d,
b))},M=function(a,b,c){var d=a.vlan_interface_settings,g=a.ipv4&&a.ipv4.setting||{},e=a.ipv6&&a.ipv6.setting||{},k="",h=a.ipv4.connectType,l=a.ipv6.connectType,r,p,A=k=a.mtu,z={},y="WAN1",B=!1,u=!1;p=v;r="WAN1"===b?n:"downstream"===p?!0:"auto"===m?n:!1;b.match(/^WAN2/)&&(y="WAN2");"pppoe"===h||"pppoe"===l?B=!0:c&&(c.ipv4&&"pppoe"===c.ipv4.connectType&&(u=!0),c.ipv6&&"pppoe"===c.ipv6.connectType&&(u=!0));b={name:b,nat:{enable:a.nat.enable},"igmp-proxy":{enable:r,type:p},type:"ethernetCsmacd",ipv4:{enabled:a.ipv4.enabled,
address:[],mtu:"",setting:{}},ipv6:{enabled:a.ipv6.enabled,address:[],mtu:"",setting:{}}};!0===a.isCreateSubInterface&&(z.target=[{host:"gateway"}]);B?z.enable=!1:u&&(z.enable=!0);if(!0===a.isCreateSubInterface||B||u)b["redundant-wan"]={"net-tracker":z};a.needToModifyMultiWan&&!a.isCreateSubInterface&&"trasparent-bridge"===a.ipv4.connectType&&$.extend(b["redundant-wan"],{enable:!1});_.isNumber(d.vlan_id)&&(b["vlan-interface-settings"]={"vlan-id":d.vlan_id,"base-interface":y},b.type="l2vlan");h&&(b.ipv4.setting[h]=
{ifname:g.ifname});l&&(b.ipv6.setting[l]={ifname:g.ifname});if((b["mac-address-clone"]=a.mac_address_clone)&&a.mac_address)b["mac-address"]=a.mac_address;"manual"===a.mtuType&&(b.ipv4.mtu=k);a.ipv4.address.ip&&a.ipv4.address.prefix_length&&(b.ipv4.address=[{ip:a.ipv4.address.ip,"prefix-length":a.ipv4.address.prefix_length}]);k=c="";g.naming_server.servers[0]&&g.naming_server.servers[0].length&&(k=g.naming_server.servers[0],c=" ");g.naming_server.servers[1]&&g.naming_server.servers[1].length&&(k=k+
c+g.naming_server.servers[1]);$.extend(b.ipv4.setting[h],{peerdns:g.peerdns});g.peerdns||$.extend(b.ipv4.setting[h],{"naming-server":{servers:[k]}});switch(h){case "static":delete b.ipv4.setting[h].peerdns;$.extend(b.ipv4.setting[h],{"naming-server":{servers:[k]}});b.ipv4.setting[h].gateway=g.gateway;break;case "dynamic":b.ipv4.address=[];break;case "pppoe":$.extend(b.ipv4.setting[h],{username:g.username,demand:g.selectDemand?g.demand:"",keepalive:!g.selectDemand?g.keepalive:"","authentication-type":g.authentication_type,
service:g.service});b.ipv4.address=[];break;case "pptp":$.extend(b.ipv4.setting[h],{username:g.username,gateway:"",demand:g.selectDemand?g.demand:"",origin:a.ipv4.physical,keepalive:!g.selectDemand?g.keepalive:"","authentication-type":g.authentication_type,server:g.server,mppe:g.mppe});"dhcp"===a.ipv4.physical?b.ipv4.address=[]:b.ipv4.setting[h].gateway=g.gateway;delete b.ipv4.setting[h].ifname;break;case "l2tp":$.extend(b.ipv4.setting[h],{username:g.username,demand:g.selectDemand?g.demand:"",origin:a.ipv4.physical,
keepalive:!g.selectDemand?g.keepalive:"","authentication-type":g.authentication_type,server:g.server});"dhcp"===a.ipv4.physical?b.ipv4.address=[]:b.ipv4.setting[h].gateway=g.gateway;delete b.ipv4.setting[h].ifname;break;case "trasparent-bridge":$.extend(b.ipv4.setting[h],{ifnames:[g.ifnames,a.intf+(d.vlan_id?"."+d.vlan_id:"")]}),b.ipv4.setting[h].gateway=g.gateway,delete b.ipv4.setting[h].peerdns,delete b.ipv4.setting[h].ifname,$.extend(b.ipv4.setting[h],{"naming-server":{servers:[k]}})}switch(h){case "pptp":case "l2tp":case "pppoe":b.ipv4.setting[h].password=
g.changed_password?g.password:g.orig_password}"manual"===a.mtuType&&(b.ipv6.mtu=""!==A&&1280>A?1280:A);$.extend(b.ipv6.setting,{"dhcp-pd-enable":e.dhcp_pd_enable,"prefix-name":e.prefix_name});k=c="";e.naming_server.servers[0]&&e.naming_server.servers[0].length&&(k=e.naming_server.servers[0],c=" ");e.naming_server.servers[1]&&e.naming_server.servers[1].length&&(k=k+c+e.naming_server.servers[1]);$.extend(b.ipv6.setting[l],{peerdns:e.peerdns});e.peerdns||$.extend(b.ipv6.setting[l],{"naming-server":{servers:[k]}});
switch(l){case "slaac":b.ipv6.setting[l].peerdns=!1;$.extend(b.ipv6.setting[l],{"naming-server":{servers:[k]}});break;case "static":delete b.ipv6.setting[l].peerdns;$.extend(b.ipv6.setting[l],{"naming-server":{servers:[k]}});a.ipv6.address.ip&&a.ipv6.address.prefix_length&&(b.ipv6.address=[{ip:a.ipv6.address.ip,"prefix-length":a.ipv6.address.prefix_length}]);b.ipv6.setting[l].gateway=e.gateway;break;case "pppoe":$.extend(b.ipv6.setting[l],{username:e.username,demand:e.selectDemand?e.demand:"",keepalive:!e.selectDemand?
e.keepalive:"","authentication-type":e.authentication_type,service:e.service,"share-ipv4-pppoe-session":e.share_ipv4_pppoe_session})}switch(l){case "pppoe":b.ipv6.setting[l].password=e.changed_password?e.password:e.orig_password}return b},P=function(b,c){var d=[],g,k,h,l=b&&b.edit||void 0,r=b&&b.orig||void 0;if(void 0===l)c.resolve("falure");else{g=l.vlan_interface_settings;g=l.intf+(g.vlan_id?"."+g.vlan_id:"");l.ipv4.address.netmask&&(l.ipv4.address.prefix_length=app.TOOLS.netmask.inet2Int(l.ipv4.address.netmask));
if(r&&(r.ipv4&&"trasparent-bridge"===r.ipv4.connectType)&&"trasparent-bridge"!==l.ipv4.connectType&&g.match(/^WAN\d+$/)){h=q.length+1;for(k=0;k<h;k++)if(e[k+1]||(e[k+1]=[]),!e[k+1].length){e[k+1].push(g);k=D({name:g},{precedence:k+1});q.push(k);break}}"trasparent-bridge"===l.ipv4.connectType&&(l.needToModifyMultiWan=!0,r&&(r.ipv4&&"trasparent-bridge"!==r.ipv4.connectType)&&E([g]));d.push(M(l,g,r));l=I();d={interfaces:{"interface":d}};l.length&&(d.Multi_WAN=l);a.post({method:"set_wan_interface",forcedUsingPost:!0,
params:d,procBackground:b&&b.background||void 0,success:function(a){c.resolve("success")},error:function(a){c.resolve("falure")}})}};this.delete_wan_interfaces=function(a){var c=b.defer();N(a,c);return c.promise};this.filter_available_interfaces=function(a){if(!a)return[];var b={},c=a.length,d=[],g,e,k=RegExp(this.regexpStr.bridgeIntf),h=RegExp(this.regexpStr.usbIntf);for(g=0;g<c;g++)e=a[g],(e=e.name.match(k))&&(b[e[1]+e[3]]=!0);k=RegExp(this.regexpStr.physicalIntf);for(g=0;g<c;g++)e=a[g],e.name.match(k)&&
!b[e.name]&&d.push(e),e.name.match(h)&&d.push(e);return d};this.regexpStr={logicalIntf:"^(WAN\\d+)-(PPTP|L2TP|PPPOE|BRIDGE)($|.\\d+$)",defaultIntf:"^(WAN\\d+)$",physicalIntf:"^(WAN\\d+)($|.\\d+$)",bridgeIntf:"^(WAN\\d+)-(BRIDGE)($|.\\d+$)",usbIntf:"^USB\\d+$",wanIntef:"^(WAN\\d+)(?:-(PPTP|BRIDGE|L2TP|PPPOE))?($|.\\d+$)"};this.init=function(a){var d=b.defer(),e=!1;promises=[];a&&(e=!0===a.full_configure);promises=e?[g(a),B(a),F(a),c()]:[g(a)];b.all(promises).then(function(a){e?(H(a[2].data&&a[2].data.result||
{}),A(a[0].data&&a[0].data.result||{}),y(a[0].data&&a[0].data.result||{}),C(a[1].data&&a[1].data.result||{}),k(a[3]&&a[3].data&&a[3].data.result||{}),d.resolve([l,p,{pc_mac:x,is_from_lan:r}])):(y(a[0].data&&a[0].data.result||{}),d.resolve([l]))});return d.promise};this.get_wan_state=function(a){var c=b.defer(),d=a&&a.cbk;b.all([G(a)]).then(function(a){J(a[0].data&&a[0].data.result||{});_.isFunction(d)&&d(h);c.resolve(h)});return c.promise};this.gen_wan_settings=function(a){return z(a)};this.set_wan_interface=
function(a){var c=b.defer();P(a,c);return c.promise}}]);
app.service("wan_service",["MyHttp",function(a){this.filter=function(a,s){if(!a||"array"!==$.type(a))return[];var n=!1,v=!1,t=!1,m=!1,q=!1,e=!1,w=!1,l=!1,h=[],p=[],u=[],x=[],r=[],d=[];s?(s.physical&&(n=!0),s.logical&&(v=!0),s.usb&&(m=!0),s.subinterface&&(t=!0),s.wan_port&&(q=!0),s.ipv6transition&&(e=!0),s.dmz&&(w=!0),s.gre&&(l=!0)):(w=e=q=t=m=v=n=!0,l);angular.forEach(a,function(a){a.name&&(n&&a.name.match(/^WAN\d+$/)?h.push(a):v&&a.name.match(/^WAN\d+(-PPTP($|\.\d+$)|-L2TP($|\.\d+$)|-PPPoE($|\.\d+$)|-PPPOE($|\.\d+$)|-BRIDGE($|\.\d+$))/)?h.push(a):
m&&a.name.match(/^USB\d+$/)?p.push(a):t&&a.name.match(/^WAN\d+\.\d+$/)?h.push(a):(q&&a.name.match(/^WAN_PORT\d+$/)&&d.push(a),e&&a.name.match(/^TUN\d+$/)&&u.push(a),w&&a.name.match(/^DMZ$/)&&x.push(a),l&&a.name.match(/^GRE\d+$/)&&r.push(a)))});return h.concat(p).concat(d).concat(u).concat(x).concat(r)};this.get_ifs_status=function(a){var s={};if(!a)return s;var n=function(a){var b={ipv4:[],ipv6:[]},l=a.ipv6&&a.ipv6.address||[];angular.forEach(a.ipv4&&a.ipv4.address||[],function(a){a.ip&&b.ipv4.push(a.ip)});
angular.forEach(l,function(a){a.ip&&b.ipv6.push(a.ip)});return b},v=[],t={},m={},q;a["interfaces-state"]&&a["interfaces-state"]["interface"]&&(v=a["interfaces-state"]["interface"]);angular.forEach(v,function(a){a.name&&(a.name.match(/^WAN\d+($|\.\d+$)/)&&(t[a.name]=n(a)),a.name.match(/^USB\d+$/)&&(t[a.name]=n(a)))});angular.forEach(v,function(a){a.name&&(q=a.name.match(/^(WAN\d+)-(PPTP|L2TP|PPPOE|BRIDGE)($|.\d+$)/))&&(m[q[1]+q[3]]=n(a))});angular.forEach(t,function(a,b){s[b]=m[b]?m[b]:a});return s};
this.order_ifs=function(a){a||(a=[]);var s=[],n=[],v=[],t=[],m=function(a,b,e){a=parseInt(a,10);isNaN(a)||(n[a]||(n[a]=[]),b=parseInt(b,10),isNaN(b)?(n[a][0]||(n[a][0]=[]),n[a][0].push(e)):(n[a][b]||(n[a][b]=[]),n[a][b].push(e)))};a.interfaces&&a.interfaces["interface"]&&(t=a.interfaces["interface"]);angular.forEach(t,function(a){(regRes=a.name.match(/^WAN(\d+)($|.\d+$)/))?m(regRes[1],regRes[2].replace(".",""),a):(regRes=a.name.match(/^WAN(\d+)-(?:PPTP|L2TP|PPPOE|BRIDGE)($|.\d+$)/))?m(regRes[1],regRes[2],
a):v.push(a)});var q,e=n.length;for(a=0;a<e;a++)if(n[a]){q=n[a].length;for(t=0;t<q;t++)n[a][t]&&(s=s.concat(n[a][t]))}return s=s.concat(v)}}]);app.service("modificationWarning",["$rootScope",function(a){var b=!1,s=[];this.modified=function(){b=!0};this.get=function(){return b};this.reset=function(){b=!1;angular.forEach(s,function(a){a&&a.$setPristine&&a.$setPristine()})};this.setForm=function(a){s.push(a)};this.resetForm=function(){s=[]};this.check=function(n){b?app.TOOLS.warningAlertBox({msg:a.DICT("Navigate_Msg"),title:a.DICT("Confirm"),btn_yes_str:a.DICT("Exit"),btn_no_str:a.DICT("Cancel"),cbk:function(a){_.isFunction(n)&&n(a)}}):n(!0)}}]);
app.service("goToPreviousPage",["modificationWarning",function(a){var b=!1,s=this;s.reset=function(){b=!1};s.invoke=function(){b=!0};s.isneed=function(){return b};s.goback=function(b){a.check(function(a){_.isFunction(b)&&b(a);a&&(s.reset(),history.back())})}}]);
app.service("addressPoolValidate",function(){var a=function(a){if(8!==a.length)console.log("error: ip6part.length = "+a.length);else{for(var s,n=[],v=0;7>=v;v++)s=a[v]||0,n.push(s.toString(16));return n.join(":")}};this.poolValidate=function(a,s,n,v,t,m,q){var e=!0,w=[],l=[],w=[],l=[],h=[],p=[],p=h=0,u=[],h=[],l=w="",l=!1;"ipv4"===n?u=angular.copy(v.ipv4):"ipv6"===n&&(h=angular.copy(v.ipv6));if(void 0===u||void 0===h)return!0;h=t.split(".");p=m.split(".");h=(parseInt(h[0],10)<<24|parseInt(h[1],10)<<
16|parseInt(h[2],10)<<8|parseInt(h[3],10))>>>0;p=(parseInt(p[0],10)<<24|parseInt(p[1],10)<<16|parseInt(p[2],10)<<8|parseInt(p[3],10))>>>0;for(n=0;n<u.length;n++){l=!1;if(q&&q.skipCond&&0<q.skipCond.length)for(v=0;v<q.skipCond.length;v++)u[n].type==q.skipCond[v].type&&u[n].name.match(q.skipCond[v].name)&&(l=!0);if(!l){if(u[n].type===a&&u[n].name!==s||u[n].type!==a&&u[n].name!==s){w=u[n]["range-start"]||"";l=u[n]["range-end"]||"";v=!1;s.match(/^VLAN/)&&(v=!0);if(v)if(v=void 0,u[n]["bridge-interfaces"]&&
0<u[n]["bridge-interfaces"].length&&(v=u[n]["bridge-interfaces"][0].split(" ")),v&&-1<v.indexOf(s))continue;else if(u[n].bridge)continue;if(!1===e)break;else""===w||""===l?e=!0:(w=w.split("."),l=l.split("."),w=(parseInt(w[0],10)<<24|parseInt(w[1],10)<<16|parseInt(w[2],10)<<8|parseInt(w[3],10))>>>0,l=(parseInt(l[0],10)<<24|parseInt(l[1],10)<<16|parseInt(l[2],10)<<8|parseInt(l[3],10))>>>0,h<=w&&p>=l?e=!1:h<=w&&p>=w?e=!1:h<=l&&p>=l?e=!1:h>=w&&p<=l&&(e=!1))}if(!1===e)break}}return e};this.compareIpRange=
function(a,s){var n=[],v=[],t=[],m=[],q,e=!0,n=a.split("."),v=s.split(".");for(q=0;4>q;q++)t[q]=parseInt(n[q],10),m[q]=parseInt(v[q],10);for(q=0;4>q;q++)if(m[q]>t[q]){e=!0;break}else if(m[q]<t[q]){e=!1;break}return e};this.poolMaskValidate=function(a,s,n,v,t,m){var q=!0,e=[],w=[],l=0,h=0,p=[],l=[],u=e=w=e="",w=[],h=[],x="",e="";if(void 0===t||void 0===m||""===t||""===m)return!0;e=t.split(".");u=m.split(".");for(t=0;4>t;t++)w[t]=e[t]&u[t];x=w[0]+"."+w[1]+"."+w[2]+"."+w[3];for(t=0;4>t;t++)h[t]=u[t]^
255|e[t];e=h[0]+"."+h[1]+"."+h[2]+"."+h[3];if(void 0===x||void 0===e||""===x||""===e)return!0;"ipv4"===n?p=angular.copy(v.ipv4):"ipv6"===n&&(l=angular.copy(v.ipv6));if(void 0===p||void 0===l)return!0;l=(parseInt(w[0],10)<<24|parseInt(w[1],10)<<16|parseInt(w[2],10)<<8|parseInt(w[3],10))>>>0;h=(parseInt(h[0],10)<<24|parseInt(h[1],10)<<16|parseInt(h[2],10)<<8|parseInt(h[3],10))>>>0;for(n=0;n<p.length;n++){if(p[n].type!==a&&p[n].name!==s)if(e=p[n]["range-start"]||"",w=p[n]["range-end"]||"",!1===q)break;
else""===e||""===w?q=!0:(e=e.split("."),w=w.split("."),range_startnum=(parseInt(e[0],10)<<24|parseInt(e[1],10)<<16|parseInt(e[2],10)<<8|parseInt(e[3],10))>>>0,range_endnum=(parseInt(w[0],10)<<24|parseInt(w[1],10)<<16|parseInt(w[2],10)<<8|parseInt(w[3],10))>>>0,l<=range_startnum&&h>=range_endnum?q=!1:l<=range_startnum&&h>=range_startnum?q=!1:l<=range_endnum&&h>=range_endnum?q=!1:l>=range_startnum&&h<=range_endnum&&(q=!1));if(!1===q)break}return q};this.poolValidateInRange=function(a,s,n,v,t,m){var q=
!0,e=[],w=[],l=[],h=[],q=[],p=[],u=[],q=[],w=e="";"ipv4"===n?u=angular.copy(v.ipv4):"ipv6"===n&&(q=angular.copy(v.ipv6));if(void 0===u||void 0===q)return!0;q=!0;for(n=0;2>n;n++){0===n?html_ip=t:1===n&&(html_ip=m);for(v=0;v<u.length;v++)if(u[v].type===a&&u[v].name===s)if(e=u[v]["range-start"]||"",w=u[v]["range-end"]||"",!1===q)break;else if(""===e||""===w)q=!0;else{for(var e=e.split("."),w=w.split("."),q=html_ip.split("."),x=0;4>x;x++)l[x]=parseInt(e[x],10),h[x]=parseInt(w[x],10),p[x]=parseInt(q[x],
10);if(p[0]>=l[0]&&p[0]<=h[0]&&p[1]>=l[1]&&p[1]<=h[1]&&p[2]>=l[2]&&p[2]<=h[2]&&p[3]>=l[3]&&p[3]<=h[3])q=!0;else{q=!1;break}}if(!1===q)break}return q};this.poolValidateV6=function(a,s,n,v,t,m,q){var e=!0,w="",l="",w=[],h=[],p="",u="",p=!1;"ipv4"===n?w=angular.copy(v.ipv4):"ipv6"===n&&(h=angular.copy(v.ipv6));if(void 0===w||void 0===h)return!0;w=app.TOOLS.ipv6.toFullV6Addr(t).toLowerCase();l=app.TOOLS.ipv6.toFullV6Addr(m).toLowerCase();for(n=0;n<h.length;n++){p=!1;if(q&&q.skipCond&&0<q.skipCond.length)for(v=
0;v<q.skipCond.length;v++)h[n].type==q.skipCond[v].type&&h[n].name.match(q.skipCond[v].name)&&(p=!0);if(!p){if(h[n].type===a&&h[n].name!==s||h[n].type!==a&&h[n].name!==s)if(p=h[n]["range-start"]||"",p=app.TOOLS.ipv6.toFullV6Addr(p).toLowerCase(),u=h[n]["range-end"]||"",u=app.TOOLS.ipv6.toFullV6Addr(u).toLowerCase(),!1===e)break;else""===p||""===u?e=!0:w<=p&&l>=u?e=!1:w<=p&&l>=p?e=!1:w<=u&&l>=u?e=!1:w>=p&&l<=u&&(e=!1);if(!1===e)break}}return e};this.poolValidateV6ByAddrAndPrefix=function(b,s,n,v,t,
m){n=!0;var q="",e="",w=[],l="",h="",w=angular.copy(v.ipv6);if(void 0===w)return!0;q=app.TOOLS.validation.ipv6_getNet(t,m);v=angular.copy(q);t=[0,0,0,0,0,0,0,0];m=128-m;for(e=7;0<m;)16<=m?(t[e]=65535,m-=16):(t[e]|=(1<<m)-1>>>0,m=0),e--;for(e=0;e<v.length;e++)v[e]|=t[e];q=a(q).toLowerCase();e=a(v).toLowerCase();for(m=0;m<w.length;m++){if(w[m].type===b&&w[m].name!==s||w[m].type!==b&&w[m].name!==s)if(l=w[m]["range-start"]||"",l=app.TOOLS.ipv6.toFullV6Addr(l).toLowerCase(),h=w[m]["range-end"]||"",h=app.TOOLS.ipv6.toFullV6Addr(h).toLowerCase(),
!1===n)break;else""===l||""===h?n=!0:q<=l&&e>=h?n=!1:q<=l&&e>=l?n=!1:q<=h&&e>=h?n=!1:q>=l&&e<=h&&(n=!1);if(!1===n)break}return n};this.bindBridgeModeInRangeWithMask=function(a,s,n,v,t,m,q,e){var w=!0,l=[],h=[],p=0,u=0,x=[],p=[],r=l=h=l="",h=[],u=[],d="",l="";if(void 0===q||void 0===e||""===q||""===e)return!0;l=q.split(".");r=e.split(".");for(q=0;4>q;q++)h[q]=l[q]&r[q];d=h[0]+"."+h[1]+"."+h[2]+"."+h[3];for(q=0;4>q;q++)u[q]=r[q]^255|l[q];l=u[0]+"."+u[1]+"."+u[2]+"."+u[3];if(void 0===d||void 0===l||
""===d||""===l)return!0;"ipv4"===t?x=angular.copy(m.ipv4):"ipv6"===t&&(p=angular.copy(m.ipv6));if(void 0===x||void 0===p)return!0;p=(parseInt(h[0],10)<<24|parseInt(h[1],10)<<16|parseInt(h[2],10)<<8|parseInt(h[3],10))>>>0;u=(parseInt(u[0],10)<<24|parseInt(u[1],10)<<16|parseInt(u[2],10)<<8|parseInt(u[3],10))>>>0;for(t=0;t<x.length;t++){if(x[t].type!==a&&x[t].name!==s&&x[t].name!==n&&void 0!==v&&""!==v&&x[t].name!==v)if(l=x[t]["range-start"]||"",h=x[t]["range-end"]||"",!1===w)break;else""===l||""===
h?w=!0:(l=l.split("."),h=h.split("."),range_startnum=(parseInt(l[0],10)<<24|parseInt(l[1],10)<<16|parseInt(l[2],10)<<8|parseInt(l[3],10))>>>0,range_endnum=(parseInt(h[0],10)<<24|parseInt(h[1],10)<<16|parseInt(h[2],10)<<8|parseInt(h[3],10))>>>0,p<=range_startnum&&u>=range_endnum?w=!1:p<=range_startnum&&u>=range_startnum?w=!1:p<=range_endnum&&u>=range_endnum?w=!1:p>=range_startnum&&u<=range_endnum&&(w=!1));if(!1===w)break}return w};this.compareIpRangeV6=function(a,s){var n=!0,v="",t="",v=app.TOOLS.ipv6.toFullV6ZPAddr(a).toLowerCase(),
t=app.TOOLS.ipv6.toFullV6ZPAddr(s).toLowerCase();v>t&&(n=!1);return n};this.poolValidateInRangeV6=function(a,s,n,v,t,m){n=!0;var q="",e="",w=[],l="",h="",w=angular.copy(v.ipv6);if(void 0===w)return!0;q=app.TOOLS.ipv6.toFullV6ZPAddr(t).toLowerCase();e=app.TOOLS.ipv6.toFullV6ZPAddr(m).toLowerCase();for(v=0;v<w.length;v++){if(w[v].type===a&&w[v].name===s)if(l=w[v]["range-start"]||"",l=app.TOOLS.ipv6.toFullV6ZPAddr(l).toLowerCase(),h=w[v]["range-end"]||"",h=app.TOOLS.ipv6.toFullV6ZPAddr(h).toLowerCase(),
!1===n)break;else""===l||""===h?n=!0:q<l&&e>h?n=!1:q<l&&e>l?n=!1:q<h&&e>h?n=!1:q<l&&e<l?n=!1:q>h&&e>h&&(n=!1);if(!1===n)break}return n}});app.service("DSService",["$q",function(a){this.genProxy=function(b){b||Log(ERROR,"genProxy: required: ref_arr, data_cache_path_fn, data_typical_path_fn");var s=b.ref_arr||[];if(s&&0<s.length){var n=a.defer();b=b.data_cache_path_fn(s);n.resolve(b);return n.promise}return b.data_typical_path_fn()}}]);
app.service("factory_to_default",["$cookies",function(a){this.reset=function(){a.remove("vpn_status")}}]);app.service("pgWindow",["$window",function(a){this.confirm=function(b){return a.confirm(b)};this.alert=function(b){return a.alert(b)}}]);
app.service("usb_lib",["MyHttp","$q",function(a,b){var s=function(a){a||(a={});var b={USB1:!1,USB2:!1},t=[];a.output&&a.output.usbs&&(t=a.output.usbs);angular.forEach(t,function(a){var q=a.name;q&&(void 0===b[q]&&(b[q]=!1),!0===a.attached&&"mass-storage"===a["usbs-type"]&&(b[q]=!0))});return b};this.usbs_avaiable=function(n){var v=b.defer(),t;b.all([a.post({method:"action",background:n&&void 0!==n.background?n.background:!1,params:{rpc:"usb-check-attached"}})]).then(function(a){t=s(a[0]&&a[0].data&&
a[0].data.result||{});v.resolve(t)});return v.promise}}]);
app.service("intf_service",["MyHttp","$q",function(a,b){var s={},n=function(){return a.post({url:resource_base+"data/firewall_access_rules.json",method:"get_access_rules",procBackground:!0,error:function(a){console.log("accessRulesCtrl getData error: "+JSON.stringify(a))}})},v=function(){return a.post({url:resource_base+"data/port_forwarding.json",method:"get_port_forwarding_rule",procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},t=function(){return a.post({url:resource_base+
"data/port_triggering.json",method:"get_port_triggering",procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},m="none",q=!1,e={},w;this.init=function(){s={};m="getting";var a=this;b.all([n(),v(),t()]).then(function(b){for(var p=((b&&b[0]&&b[0].data&&b[0].data.result||{})["firewall-acl-rules"]||{})["firewall-acl-rule-entry"]||[],u=p.length,u=u-1;0<=u;u--)p[u]["default"]&&p.splice(u,1);s.acls=angular.copy(p);p=b&&b[1]&&b[1].data&&b[1].data.result||
{};s.port_forward=angular.copy(p["port-forwarding-rules"]&&p["port-forwarding-rules"]["port-forwarding-entry"]||[]);b=b&&b[2]&&b[2].data&&b[2].data.result||{};s.port_trigger=angular.copy(b["port-triggering-rules"]&&b["port-triggering-rules"]["port-triggering-entry"]||[]);m="done";q&&(app.transition.Out(),q=!1,a.checkBeforeDel(e,w))})};this.checkBeforeDel=function(b,h){if(b&&b.length){switch(m){case "none":app.transition.In();this.init();q=!0;e=b;w=h;return;case "getting":app.transition.In();q=!0;
e=b;w=h;return}var p=!1,u=!1,x=!1,r=angular.copy(s.acls),d=s.port_trigger,c=s.port_forward,k=[],g=[],z=[],y=b.length,A,B=s.port_trigger.length,n=s.port_forward.length,D,t,v,F=function(a){"function"===typeof h&&h(a)},H=function(b){if(b){b={};var c={};p&&(b["firewall-acl-rules"]={"firewall-acl-rule-entry":k},c["firewall-acl-rules"]={"firewall-acl-rule-entry":r});u&&(b["port-triggering-rules"]={"port-triggering-entry":g});x&&(b["port-forwarding-rules"]={"port-forwarding-entry":z});a.post({method:"del_port_forwarding",
params:b,success:function(){F(!0);p&&a.post({method:"set_access_rules",procBackground:!0,params:c})},error:function(){F(!1)}})}else F(!1)};for(D=0;D<y;D++){v=b[D];A=r.length;for(t=A-1;0<=t;t--)r[t]["interface"]&&(r[t]["interface"]["source-interface"]===v||r[t]["interface"]["destination-interface"]===v)&&r.splice(t,1);for(A=n-1;0<=A;A--)c[A]["interface"]===v&&z.push({"external-service":c[A]["external-service"],"interface":c[A]["interface"]});for(A=B-1;0<=A;A--)d[A]["interface"]===v&&g.push({name:d[A].name})}if(r.length!==
s.acls.length){p=!0;A=r.length;for(t=0;t<A;t++)r[t]["rule-id"]=t+1;for(t=r.length+1;t<=s.acls.length;t++)k.push({"rule-id":t})}g.length&&(u=!0);z.length&&(x=!0);p||u||x?app.TOOLS.get_scope("appCtrl").openDelInftAlertPage({needToDelACL:p,needToDelPT:u,needToDelPF:x,cbk:H}):F(!0);m="none"}}}]);
app.service("device_os_type",["MyHttp","$q",function(a,b){var s=[],n={},v=function(b,q){return a.post({url:resource_base+"data/device_os_type.json",method:"get_deviceostype",procBackground:b&&b.procBackground||!1,error:function(a){console.log("get_deviceostype error status: "+a.status);t();q.resolve({device:s,os:n})}})},t=function(a){a||(a={});s=[];n={};var b=[],e,w,l,h;a["device-os-types"]&&a["device-os-types"]["device-os-type"]&&(b=a["device-os-types"]["device-os-type"]);angular.forEach(b,function(a){if(h=
a["device-type"])l=a["os-type"]&&a["os-type"][0]||"",e=l.split(" ")||[],w=[],angular.forEach(e,function(a){w.push({id:a,displayName:a})}),s.push({id:h,displayName:h}),n[h]=w})};this.get=function(a){var q=b.defer();b.all([v(a,q)]).then(function(a){t(a&&a[0]&&a[0].data&&a[0].data.result||{});q.resolve({device:s,os:n})});return q.promise};this.get_default_device_type=function(a,b){var e="";a||(a=[]);b||(b="ANY");angular.forEach(a,function(a){a.id===b&&(e=b)});e||(e=a[0]&&a[0].id||"");return e};this.get_default_os_type=
function(a,b,e){var w="";a||(a=[]);e||(e="ANY");angular.forEach(a,function(a){a.id===e&&(w=e)});w||(w=a[0]&&a[0].id||"");return w}}]);app.service("dt",["$rootScope",function(a){var b=this;a=a.DICT;var s=app.TOOLS.int2str2,n=[a("Time_Jan"),a("Time_Feb"),a("Time_Mar"),a("Time_Apr"),a("Time_May"),a("Time_Jun"),a("Time_Jul"),a("Time_Aug"),a("Time_Sep"),a("Time_Oct"),a("Time_Nov"),a("Time_Dec")],v=[a("Time_January"),a("Time_February"),a("Time_March"),a("Time_April"),a("Time_May"),a("Time_June"),a("Time_July"),a("Time_August"),a("Time_September"),a("Time_October"),a("Time_November"),a("Time_December")],t=[],m=[a("Time_Sunday"),a("Time_Monday"),
a("Time_Tuesday"),a("Time_Wednesday"),a("Time_Thursday"),a("Time_Friday"),a("Time_Saturday")],q=[a("Time_Sun"),a("Time_Mon"),a("Time_Tue"),a("Time_Wed"),a("Time_Thu"),a("Time_Fri"),a("Time_Sat")],e=[],w=void 0;b.setTimezoneName=function(a,b){w=void 0;a&&angular.forEach(Timezone,function(e){e.tz===a&&(w=angular.copy(e),w.isdst=b)})};b.parser=function(a){var b=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/,e={err_code:1,orig_str:a,year:0,month:0,day:0,day_week:0,hour:0,minute:0,second:0,tz:0};if(!a)return e;
var u=a.match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\.\d+)?(Z|[\+\-]\d{2}:\d{2})/);u||(u=a.match(b));if(!u)return e;b=new Date(u[1]+"/"+u[2]+"/"+u[3]);e={err_code:0,date:void 0,orig_str:a,year:parseInt(u[1],10),month:parseInt(u[2],10)-1,day:parseInt(u[3],10),day_week:b.getDay(),hour:parseInt(u[4],10),minute:parseInt(u[5],10),second:parseInt(u[6],10),tz:parseInt(u[8],10)};u=a.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})([\+\-]\d{2}:\d{2})$/);e.date=u?new Date(u[1].replace(/-/g,"/").replace("T",
" ")):new Date;return e};b.new_date=function(a){var b;_.isString(a)&&(a=Date.parse(a),isNaN(a)&&(a=void 0));_.isNumber(a)&&(b=new Date(a));void 0===b&&(b=new Date);return{err_code:0,date:b,orig_str:"",year:b.getYear()+1900,month:b.getMonth(),day:b.getDate(),day_week:b.getDay(),hour:b.getHours(),minute:b.getMinutes(),second:b.getSeconds(),tz:""}};b.get_time=function(a){return a.date.getTime()+0};b.generate=function(a){var b=function(a){return 10>a?"0"+a:a.toString()};if(!a)return"";var e="";return"number"!==
$.type(a.year)||"number"!==$.type(a.month)||"number"!==$.type(a.day)||"number"!==$.type(a.hour)||"number"!==$.type(a.minute)||"number"!==$.type(a.second)||"string"!==$.type(a.tz)?"":e=a.year+"-"+b(a.month+1)+"-"+b(a.day)+"T"+b(a.hour)+":"+b(a.minute)+":"+b(a.second)+a.tz};b.mon2Str=function(a,b){return"number"!==$.type(a)||12<a||1>a?"":b?v[a-1]:n[a-1]};b.dw2Str=function(a,b){return"number"!==$.type(a)||6<a||0>a?"":b?m[a]:q[a]};b.genTimeStrByTimeStamp=function(a,e,p){a=b.parser(a);e||(e="");return 1===
a.err_code?e:(p=b.timeStr(a,p))?p:e};b.timeStr=function(a,b){b||(b="YYYY-mMM-DD, hh:mm:ss ZZZ");var e=function(a,b){a||(a="");var c=a.length,d=0,e;for(e=0;e<c;e++)if(a[e]===b)d+=1;else break;return d},u="",q=b.length,r="",d,c,k;for(c=0;c<q&&!r;c++)switch(b[c]){case "Y":d=e(b.substr(c,q),"Y");2===d||4===d?u+=a.year.toString().substr(4-d,4):r="Year is not corrent ["+d+"]";c=c+d-1;break;case "M":d=e(b.substr(c,q),"M");2===d?u+=s(a.month+1):r="Month is not corrent ["+d+"]";c=c+d-1;break;case "D":d=e(b.substr(c,
q),"D");2===d?u+=s(a.day):r="Day is not corrent ["+d+"]";c=c+d-1;break;case "h":d=e(b.substr(c,q),"h");2===d?u+=s(a.hour):r="Hour is not corrent ["+d+"]";c=c+d-1;break;case "m":d=e(b.substr(c,q),"m");2===d?u+=s(a.minute):(d=e(b.substr(c+1,q),"M")+1,3===d?u+=n[a.month]:r="Miniute is not corrent ["+d+"]");c=c+d-1;break;case "s":d=e(b.substr(c,q),"s");2===d?u+=s(a.second):r="Second is not corrent ["+d+"]";c=c+d-1;break;case "Z":d=e(b.substr(c,q),"Z");3===d?w&&(k=w.abbr,k||(k="UTC"+(0>w.offset?"-":"+"),
k=k+s(Math.abs((w.offset-w.offset%60)/60))+":"+s(Math.abs(w.offset%60))),u+=k):r="Second is not corrent ["+d+"]";c=c+d-1;break;case "-":case "/":case ":":case ",":case " ":u+=b[c];break;default:r="No Defined"}return r?(Log(ERROR,"[TOOLS][dt.timeStr] "+r),""):u};t=[];angular.forEach(v,function(a,b){t.push({id:b,displayName:a})});b.monthStr=angular.copy(v);b.monthabStr=angular.copy(n);b.month=angular.copy(t);t=[];angular.forEach(n,function(a,b){t.push({id:b,displayName:a})});b.monthab=angular.copy(t);
e=[];angular.forEach(m,function(a,b){e.push({id:b,displayName:a})});b.dayWeekStr=angular.copy(m);b.dayWeekabStr=angular.copy(q);b.dayWeek=angular.copy(e);e=[];angular.forEach(q,function(a,b){e.push({id:b,displayName:a})});b.dayWeekab=angular.copy(e)}]);app.directive("ploption",function(){return{restrict:"A",replace:!0,transclude:!0,scope:{title:"@",tipinfo:"@",unit:"@",texthint:"@",forname:"@",data:"=ngModel",data2:"="},templateUrl:"pl-option.htm",link:function(a,b,s){}}});
app.directive("tree",function(a){return{restrict:"EA",transclude:!0,scope:{family:"="},template:'<ul><li ng-transclude></li><p>{{ family.name }}</p><li ng-repeat="child in family.children"><tree family="child"></tree></li></ul>',compile:function(b,s,n){var v=b.contents().remove(),t;return function(b,q,e){t||(t=a(v,n));t(b,function(a,b){q.append(a)})}}}});
app.directive("float",function(){return{require:"ngModel",link:function(a,b,s,n){a=function(a){if(/^\-?\d+(\.\d+)?$/.test(a))return n.$setValidity("float",!0),parseFloat(a);n.$setValidity("float",!1)};n.$parsers.unshift(a);n.$formatters.unshift(a)}}});app.filter("getById",function(){return function(a,b,s){for(var n=0,v=a.length;n<v;n++)if(+a[n][b]==+s)return n;return null}});
app.directive("contains",function(){return{require:"ngModel",scope:{contains:"=",itemOwner:"=?",containsOpt:"=?"},link:function(a,b,s,n){b=function(b){a.containsOpt||(a.containsOpt={});if(void 0===a.containsOpt.errorIfContains||null===a.containsOpt.errorIfContains)a.containsOpt.errorIfContains=!0;var t;a:{t=a.contains.array;var m=a.contains.name,q=!1,e;"function"==typeof m&&(q=!0,e=m);for(var w=0,l=t.length;w<l;w++)if(q&&e(t[w],b)){t=w;break a}else if(t[w][m]==b){t=w;break a}t=null}m=!1;"object"==
typeof a.itemOwner?(q=a.contains.array.indexOf(a.itemOwner),-1<q&&q==t&&(m=!0)):a.itemOwner==t&&(m=!0);if(null===t||m)if(a.containsOpt.errorIfContains)n.$setValidity("contains",!0);else{n.$setValidity("not_contains",!1);return}else{if(a.containsOpt.errorIfContains){n.$setValidity("contains",!1);return}n.$setValidity("not_contains",!0)}return b};n.$parsers.push(b);n.$formatters.push(b)}}});
app.directive("input",function(){return{require:"?ngModel",link:function(a,b,s,n){function v(){var a=/^((?:http)s?:\/\/)(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+)$/i;n.$parsers.unshift(function(b){if(""===b||void 0==b)return"";if(a.test(b))return b});n.$validators.url=function(b){return n.$isEmpty(b)||a.test(b)}}n&&"url"===s.type&&v()}}});
app.directive("indeterminateCheckbox",[function(){return{scope:!0,require:"?ngModel",link:function(a,b,s,n){var v=s.childList,t=s.property,m=function(a,b){angular.forEach(a,function(a){a[t]=b;a.child&&a[a.child]&&m(a[a.child],b)})};b.bind("change",function(){a.$apply(function(){var q=b.prop("checked");angular.forEach(a.$eval(v),function(a){a[t]=q;a.child&&a[a.child]&&m(a[a.child],q)})})});a.$watch(v,function(a){var e=!1,m=!1,l=function(a){angular.forEach(a,function(a){a[t]&&(e=!0);a.child&&a[a.child]&&
l(a[a.child])})};angular.forEach(a,function(a){a[t]?e=!0:(m=!0,a.child&&a[a.child]&&l(a[a.child]))});e&&m?(b.prop("checked",!1),b.prop("indeterminate",!0),n&&n.$setViewValue(!1)):(b.prop("checked",e),b.prop("indeterminate",!1),n&&n.$setViewValue(e))},!0)}}}]);app.directive("selectWhenFocus",[function(){return{require:"?ngModel",link:function(a,b,s,n){b&&(b[0]&&b[0].addEventListener)&&b[0].addEventListener("focus",function(){b.select()})}}}]);
app.directive("passwordStrengthMeter",["passwordComplex",function(a){var b=function(a,b,v){a*=v;return(a-a%b)/b+"%"};return{restrict:"E",replace:!0,scope:{pwd:"=ngModel",name:"=username",strengthConfig:"="},link:function(s,n,v,t){var m={pwd:s.pwd,strengthConfig:s.strengthConfig||{}};n=!1;var q=3,e=function(){s.strength=a.getStrength(m);s.strength<q?(s.layer[1].width="0%",s.layer[1].enable=!1,s.layer[2].width="0%",s.layer[2].enable=!1,s.layer[3].width="",s.layer[3].bg=""):s.strength>=q&&9>s.strength?
(s.layer[1].width=b(s.strength-q+1,9-q+1,33),s.layer[1].enable=!0,s.layer[2].width="0%",s.layer[2].enable=!1,s.layer[3].width="",s.layer[3].bg=""):9<=s.strength&&17>s.strength?(s.layer[1].width="33%",s.layer[1].enable=!0,s.layer[2].width=b(s.strength-9+1,9,34),s.layer[2].enable=!0,s.layer[3].width="",s.layer[3].bg=""):(s.layer[1].enable=!0,s.layer[1].width="33%",s.layer[2].width="34%",s.layer[2].enable=!0,s.layer[3].width="0%",s.layer[3].bg="rgb(34, 139, 34)")};void 0!==s.name&&(m.name=s.name,q=4,
n=!0);s.layer=[{bg:"red",width:"34%",enable:!0},{bg:"rgb(255, 215, 0)",width:"0%",enable:!1},{bg:"rgb(34, 139, 34)",width:"0%",enable:!1},{bg:"",width:"0%",enable:!0}];e();s.$watch("pwd",function(a){m.pwd=a;e()});n&&s.$watch("name",function(a){m.name=a;e()})},templateUrl:"pwd_strength.html"}}]);app.directive("messageBox",[function(){return{restrict:"E",templateUrl:"messageBox.html",transclude:!0}}]);
app.directive("pgBindHtml",["$compile",function(a){return function(b,s,n){b.$watch(function(a){return a.$eval(n.pgBindHtml)},function(n){s.html(n);a(s.contents())(b)})}}]);app.directive("pgtitle",[function(){return{restrict:"A",link:function(a,b,s){s.ngBind&&a.$watch(s.ngBind,function(a){b.context.title=a});s.ngModel&&a.$watch(s.ngModel,function(a){b.context.title=a})}}}]);
app.directive("pgUpload",["$rootScope",function(a){return{restrict:"E",templateUrl:"pg_upload.html",scope:{ngchange:"=",ngRequired:"=",ngDisabled:"=",isInvalid:"=",pId:"@?"},compile:function(b,s,n){return{pre:function(b,n,m,q){b.DICT=a.DICT;b.file="";b.file_name=b.DICT("No_File_Is_Selected");b.change=function(a){b.file_name=b.DICT("No_File_Is_Selected");a&&a.name?b.file_name=a.name:a=void 0;b.file=a;_.isFunction(b.ngchange)&&b.ngchange(a)};b.id=b.pId?"_"+pId:"_file_upload"+Math.floor(1E4*Math.random())}}}}}]);
app.directive("gridCntr",["$compile",function(a){return{restrict:"C",scope:{isOpened:"="},link:function(b,s,n){var v=!1,t,m=function(){b.op.isopen?s.removeClass("hidden-content"):s.addClass("hidden-content")};b.op={isopen:!0};b.toggle=function(){b.op.isopen=!b.op.isopen;v&&(b.isOpened=b.op.isopen);m()};_.isBoolean(b.isOpened)&&(b.op.isopen=b.isOpened,v=!0);s.addClass("grid-cntr-s");(n=s[0].querySelector(".grid-title-cntr"))||(n=s[0].querySelector(".grid-tb-title-cntr"));n?(n=angular.element(n),n.append(a('<div class="grid-btn-collapse" ng-class="{\'is-open\': op.isopen}" ng-click="toggle()"></div>')(b)),
m(),v&&(t=b.$watch(function(){return b.isOpened},function(a){b.isOpened!==b.op.isopen&&b.toggle()})),b.$on("$destroy",function(){v&&t()})):Log(ERROR,"[gridCntr] got error, no 'grid-title-cntr' or 'grid-tb-title-cntr' class")}}}]);app.service("subnet_lib",["ipv4_lib","ipv6_lib",function(a,b){createIpAddr();var s=function(b){if(!_.isArray(b))return b;var n,m,q=b.length,e={},w;angular.forEach(b,function(a){a.is_overlap=!1;a["bridge-interfaces"]&&angular.forEach(a["bridge-interfaces"],function(a){a.match(/^VLAN\d+/)&&(e[a]=!0)})});for(n=0;n<q;n++)if(w=!1,!e[b[n].name]){b[n].name.match(/^WAN/)&&(w=!0);for(m=n+1;m<q;m++)if(!e[b[m].name]&&(!b[m].name.match(/^WAN/)||!w)&&a.vld.is_overlap_between_ranges({start:b[n]["range-start"],
end:b[n]["range-end"]},{start:b[m]["range-start"],end:b[m]["range-end"]}))b[n].is_overlap=!0,b[m].is_overlap=!0}return b},n=function(a){if(!_.isArray(a))return a;var n,m,q=a.length,e;angular.forEach(a,function(a){a.is_overlap=!1});for(n=0;n<q;n++){e=!1;a[n].name.match(/^WAN/)&&(e=!0);for(m=n+1;m<q;m++)if((!a[m].name.match(/^WAN/)||!e)&&b.vld.is_overlap_between_ranges({start:a[n]["range-start"],end:a[n]["range-end"]},{start:a[m]["range-start"],end:a[m]["range-end"]}))a[n].is_overlap=!0,a[m].is_overlap=
!0}return a};this.check_ipv4_ranges=s;this.check_ipv6_ranges=n;this.check_ranges=function(a){if(!_.isObject(a))return a;a.ipv4&&s(a.ipv4);a.ipv6&&n(a.ipv6);return a};this.check_ipv4_range_is_overlap_with_entity=function(b,n){var m=!1,q,e={},w={is_overlap:void 0,overlap_subnet:[]};if(!b||!b.start||!b.end||!n)return w;b.name&&(q=b.name,q.match(/^WAN\d+/)&&(m=!0));angular.forEach(n,function(a){q&&a.name===q||a["bridge-interfaces"]&&angular.forEach(a["bridge-interfaces"],function(a){a.match(/^VLAN\d+/)&&
(e[a]=!0)})});w.is_overlap=!1;angular.forEach(n,function(l){if(!(q&&sub.name===q)&&(!m||!l.name.match(/^WAN\d+/))&&!e[l.name]&&a.vld.is_overlap_between_ranges({start:l["range-start"],end:l["range-end"]},b))w.is_overlap=!0,w.overlap_subnet.push({name:l.name||"",type:l.type||"",start:l["range-start"]||"",end:l["range-end"]||"",ip:l.ip||""})});return w};this.check_ipv6_range_is_overlap_with_entity=function(a,n){var m={is_overlap:void 0,overlap_subnet:[]},q=!1,e;if(!a||!a.start||!a.end||!n)return m;a.name&&
(e=a.name);a.name&&a.name.match(/^WAN\d+/)&&(q=!0);m.is_overlap=!1;angular.forEach(n,function(n){if(!(e&&n.name===e)&&(!q||!n.name.match(/^WAN\d+/))&&b.vld.is_overlap_between_ranges({start:n["range-start"],end:n["range-end"]},a))m.is_overlap=!0,m.overlap_subnet.push({name:n.name||"",type:n.type||"",start:n["range-start"]||"",end:n["range-end"]||"",ip:n.ip||""})});return m}}]);app.service("rpcFns",["MyHttp","$q",function(a,b){var s=function(a,b){if(a.data.result&&a.data.result){var m={};a.data.result.output&&(m=a.data.result.output);return b?m[b]:m}console.log("Error: CSC_get_rpc_output, data.result not exist")},n=function(b,n,m){var q={};b.input&&(q.input=b.input);q.rpc=b.rpcname||"";m=m||{};return a.post({url:b.url||"",method:"action",params:q,procBackground:m.procBackground||!1,forcedUsingPost:m.forcedUsingPost,popRPCResonsepAlert:m.popRPCResonsepAlert,success:function(a){n&&
n.success&&n.success(a)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);n&&n.error&&n.error(a)}})};this.RPC_usblist=function(a,n){var m=b.defer();this.RPC_generic_send("file-list",{source:{"location-url":"FILE://"+a+"/"+(n||"")}},function(a,b,n){m.resolve(n)},function(a,b,m){});return m.promise};this.RPC_generic=function(a,b,m,q){console.warn("RPC_generic is now deprecated. Use RPC_generic_send instead.");b=n({url:resource_base+"data/rpc_result.json",rpcname:a,
input:b},void 0,q);b.then(function(b){var q=s(b);b=q.code;q=q.errstr;b=parseInt(b,10);m&&m(b,a,q)});return b};this.RPC_custom_output=function(a,b,m,q){console.warn("RPC_custom_output is now deprecated. Use RPC_generic_send instead.");b=n({url:resource_base+"data/rpc_custom_result.json",rpcname:a,input:b},void 0,q);b.then(function(b){m(b,a)});return b};this.RPC_generic_send=function(a,b,m,q,e){return this.csc_RPC_generic_send(a,b,m,q,e)};this.csc_RPC_generic_send=function(a,b,m,q,e){b=n({url:resource_base+
"data/rpc_custom_result.json",rpcname:a,input:b},void 0,e);b.then(function(b){var e=s(b,void 0);m(b,a,e)}).catch(function(b){q&&q(b,a)});return b};this.getRPCResult=s}]);app.service("ipv4_lib",[function(){var a=createIpAddr(),b=app.TOOLS.int2BinaryMask,s=function(b){var q=!1;return!b||!a.IPv4.isValid(b)?q:q=a.IPv4.parse(b)},n=function(a,q){var e=b(q,32,"H"),n=angular.copy(a),l,h;for(l=0;4>l;l++)h=e.substr(8*l,8),n.octets[l]&=parseInt(h,2);return n},v=function(b){var q=!1;b=angular.copy(b);if(!b)return q;b=angular.copy(b);b=b.split("/");if(!b||!a.IPv4.isValid(b[0]))return q;b[0]=a.IPv4.parse(b[0]);b[1]=parseInt(b[1],10);return!_.isNumber(b[1])||0>b[1]||32<b[1]?q:b},
t=function(a){var b=-1;if(!a||!a.octets)return b;b=0;angular.forEach(a.octets,function(a,m){b+=a<<8*(3-m)>>>0});return b};this.vld={is_overlap_between_subnets:function(a,b){var e=v(a),n=v(b),l=!1,h,p,u;if(e&&n)return p=e[0],u=n[0],l=e[1],h=n[1],l=l>h?p.match(n):l<h?u.match(e):p.match(n)},is_overlap_between_ranges:function(a,b){if(a&&b){var e=s(a.start),n=s(a.end),l=s(b.start),h=s(b.end),p=!1;if(e&&(l&&n&&h)&&(e=t(e),n=t(n),l=t(l),h=t(h),!(e>n||l>h)))return e<=l&&l<=n&&(p=!0),e<=h&&h<=n&&(p=!0),l<=
e&&e<=h&&(p=!0),l<=n&&n<=h&&(p=!0),p}},range_is_valid:function(a,b){var e=s(a),n=s(b);if(e&&n)return e=t(e),n=t(n),e>n?!1:!0}};this.parse=s;this.CIDR=v;this.to_int=t;this.get_prefix=n;this.get_prefix_by_str=function(b,q){var e=!1;if(!b||(!_.isNumber(q)||0>q||32<q)||!a.IPv4.isValid(b))return e;b=a.IPv4.parse(b);return e=n(b,q)};this.get_last_ip=function(a,b){var e=s(a),w,l,h;if(e&&_.isNumber(b)&&!(0>b||32<b)){e=n(e,b);w=app.TOOLS.int2BinaryMask(32-b,32);for(l=0;4>l;l++)h=w.substr(8*l,8),e.octets[l]|=
parseInt(h,2);return e}};this.get_first_ip=function(a,b){var e=s(a);if(e&&_.isNumber(b)&&!(0>b||32<b)){if(32===b)return e;e=n(e,b);e.octets[3]|=1;return e}}}]);app.config([function(){var a=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([1-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),e=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,k=/(^[\x00-\xff]*$)/,h;c.extansionOrReg&&(h=RegExp(c.extansionOrReg));c.ngIpv4IpNonzero?a.$watch(c.ngIpv4IpNonzero,function(a,b){c.ipv4IpNonzero=a;d.$validate()}):c.ipv4IpNonzero=!0;c.ipv4IpNonzero=c.ngIpv4IpNonzero?
a.$eval(c.ngIpv4IpNonzero):!0;d.$validators.ipv4IpNonzero=function(a,b){return!c.ipv4IpNonzero||d.$isEmpty(b)?!0:b.match(g)&&!b.match(e)&&b.match(k)||h&&b.match(h)?!0:!1};c.$observe("ipv4IpNonzero",function(){d.$validate()})}}}},b=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),e=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,k=/(^[\x00-\xff]*$)/,
h;c.extansionOrReg&&(h=RegExp(c.extansionOrReg));c.ngIpv4Ip?(a.$watch(c.ngIpv4Ip,function(a,b){c.ipv4Ip=a;d.$validate()}),c.ipv4Ip=a.$eval(c.ngIpv4Ip)):c.ipv4Ip=!0;d.$validators.ipv4Ip=function(a,b){if(!c.ipv4Ip||d.$isEmpty(b)||b.match(g)&&!b.match(e)&&b.match(k)||h&&b.match(h))return delete d.$error.ipv4Ip,!0;d.$error.ipv4Ip=!0;return!1};c.$observe("ipv4Ip",function(){d.$validate()})}}}},s=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$"),
e=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,k=/(^[\x00-\xff]*$)/,h;c.extansionOrReg&&(h=RegExp(c.extansionOrReg));c.ngIpv4Ip?(a.$watch(c.ngIpv4Ip,function(a,b){c.ipv4Ip=a;d.$validate()}),c.ipv4Ip=a.$eval(c.ngIpv4Ip)):c.ipv4Ip=!0;d.$validators.ipv4Ip=function(a,b){if(!c.ipv4Ip||d.$isEmpty(b)||b.match(g)&&!b.match(e)&&b.match(k)||h&&b.match(h))return delete d.$error.ipv4Ip,!0;d.$error.ipv4Ip=!0;return!1};c.$observe("ipv4Ip",function(){d.$validate()})}}}},n=function(){return{restrict:"A",require:"?ngModel",
link:function(a,b,c,d){if(d){var g=RegExp("^(((128|192|224|240|248|252|254).0.0.0)|(255.(0|128|192|224|240|248|252|254).0.0)|(255.255.(0|128|192|224|240|248|252|254).0)|(255.255.255.(0|128|192|224|240|248|252|254))|(255.255.255.255))$"),e=/(^[\x00-\xff]*$)/,k;c.extansionOrReg&&(k=RegExp(c.extansionOrReg));c.ngIpv4Netmask?a.$watch(c.ngIpv4Netmask,function(a,b){c.ipv4Netmask=a;d.$validate()}):c.ipv4Netmask=!0;c.ipv4Netmask=c.ngIpv4Netmask?a.$eval(c.ngIpv4Netmask):!0;d.$validators.ipv4Netmask=function(a,
b){return!c.ipv4Netmask||d.$isEmpty(b)?!0:app.TOOLS.netmask.inet2Int(b)&&b.match(g)&&b.match(e)||k&&b.match(k)?!0:!1};c.$observe("ipv4Netmask",function(){d.$validate()})}}}},v=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^(((128|192|224|240|248|252|254).0.0.0)|(255.(0|128|192|224|240|248|252|254).0.0)|(255.255.(0|128|192|224|240|248|252|254).0)|(255.255.255.(0|128|192|224|240|248|252|254))|(255.255.255.255))$"),e=/(^[\x00-\xff]*$)/;c.ngIpv4NetmaskAll?
a.$watch(c.ngIpv4NetmaskAll,function(a,b){c.ipv4NetmaskAll=a;d.$validate()}):c.ipv4NetmaskAll=!0;c.ipv4NetmaskAll=c.ngIpv4NetmaskAll?a.$eval(c.ngIpv4NetmaskAll):!0;d.$validators.ipv4NetmaskAll=function(a,b){return!c.ipv4NetmaskAll||d.$isEmpty(b)?!0:app.TOOLS.netmask.inet2Int(b)&&b.match(g)&&b.match(e)?!0:!1};c.$observe("ipv4NetmaskAll",function(){d.$validate()})}}}},t=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=app.TOOLS.validation.ipv4_prefix;b=c.extansionOrReg;
var e;c.ngIpv4Prefix?a.$watch(c.ngIpv4Prefix,function(a,b){c.ipv4Prefix=a;d.$validate()}):c.ipv4Prefix=!0;b&&(e=RegExp(b));c.ipv4Prefix=c.ngIpv4Prefix?a.$eval(c.ngIpv4Prefix):!0;d.$validators.ipv4Prefix=function(a,b){return!c.ipv4Prefix||d.$isEmpty(b)?!0:g(b)||e&&b.match(e)?!0:!1};c.$observe("ipv4Prefix",function(){d.$validate()})}}}},m=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),
e=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,k=/(^[\x00-\xff]*$)/;c.ngIpv6Ip?a.$watch(c.ngIpv6Ip,function(a,b){c.ipv6Ip=a;d.$validate()}):c.ipv6Ip=!0;c.ipv6Ip=c.ngIpv6Ip?a.$eval(c.ngIpv6Ip):!0;d.$validators.ipv6Ip=function(a,b){return!c.ipv6Ip||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)&&b.match(k)?!0:!1};c.$observe("ipv6Ip",function(){d.$validate()})}}}},q=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^(([0-9a-fA-F]{0,4}))(:[0-9a-fA-F]{1,4}){0,7}(::)?(%[\p{N}\p{L}]+)?$/,
e=/(^[\x00-\xff]*$)/;c.ngIpv6IpPrefix?a.$watch(c.ngIpv6IpPrefix,function(a,b){c.ipv6IpPrefix=a;d.$validate()}):c.ipv6IpPrefix=!0;c.ipv6IpPrefix=c.ngIpv6IpPrefix?a.$eval(c.ngIpv6IpPrefix):!0;d.$validators.ipv6IpPrefix=function(a,b){return!c.ipv6IpPrefix||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("ipv6IpPrefix",function(){d.$validate()})}}}},e=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^((:|[0-9a-fA-F]{0,4}))([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),
e=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),k=/(^[\x00-\xff]*$)/;c.ngIpv6IpSuffix?a.$watch(c.ngIpv6IpSuffix,function(a,b){c.ipv6IpSuffix=a;d.$validate()}):c.ipv6IpSuffix=!0;c.ipv6IpSuffix=c.ngIpv6IpSuffix?a.$eval(c.ngIpv6IpSuffix):!0;d.$validators.ipv6IpSuffix=function(a,b){return!c.ipv6IpSuffix||d.$isEmpty(b)?!0:(b.match(g)||b.match(e))&&b.match(k)?!0:!1};c.$observe("ipv6IpSuffix",function(){d.$validate()})}}}},w=function(){return{restrict:"A",
require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),e=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,k=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),h=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,
r=/(^[\x00-\xff]*$)/;c.ngIp?a.$watch(c.ngIp,function(a,b){c.ip=a;d.$validate()}):c.ip=!0;c.ip=c.ngIp?a.$eval(c.ngIp):!0;d.$validators.ip=function(a,b){return!c.ip||d.$isEmpty(b)?!0:(b.match(g)&&!b.match(e)||b.match(k)&&b.match(h))&&b.match(r)?!0:!1};c.$observe("ip",function(){d.$validate()})}}}},l=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^((([a-zA-Z0-9]([a-zA-Z0-9\\-]){0,61})?[a-zA-Z0-9]\\.)*([a-zA-Z0-9]([a-zA-Z0-9\\-]){0,61})?[a-zA-Z0-9])$"),e=
/(^[\x00-\xff]*$)/;c.hostName=c.ngHostName?a.$eval(c.ngHostName):!0;c.ngHostName?a.$watch(c.ngHostName,function(a,b){c.hostName=a;d.$validate()}):c.hostName=!0;d.$validators.hostName=function(a,b){return!c.hostName||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("hostName",function(){d.$validate()})}}}},h=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("^((([a-zA-Z0-9]([a-zA-Z0-9\\-]){0,61})?[a-zA-Z0-9]\\.)*([a-zA-Z0-9]([a-zA-Z0-9\\-]){0,61})?[a-zA-Z0-9])$"),
e=/(^[\x00-\xff]*$)/;c.hostNameNum=c.ngHostNameNum?a.$eval(c.ngHostNameNum):!0;c.ngHostNameNum?a.$watch(c.ngHostNameNum,function(a,b){c.hostNameNum=a;d.$validate()}):c.hostNameNum=!0;d.$validators.hostNameNum=function(a,b){return!c.hostNameNum||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("hostNameNum",function(){d.$validate()})}}}},p=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^(((?!-)[a-zA-Z0-9-_]{1,63}(?!-)\.)+[a-zA-Z_]{2,63})$)/,e=/(^[\x00-\xff]*$)/;
c.domainName=c.ngDomainName?a.$eval(c.ngDomainName):!0;c.ngDomainName?a.$watch(c.ngDomainName,function(a,b){c.domainName=a;d.$validate()}):c.domainName=!0;d.$validators.domainName=function(a,b){return!c.domainName||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("domainName",function(){d.$validate()})}}}},u=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^(0[0-9]|1[0-9]|2[0-3]){1}(:[0-5][0-9]){2}$/,e=/(^[\x00-\xff]*$)/;c.time24hmsForm=c.ngTime24hmsForm?
a.$eval(c.ngTime24hmsForm):!0;c.ngTime24hmsForm?a.$watch(c.ngTime24hmsForm,function(a,b){c.time24hmsForm=a;d.$validate()}):c.time24hmsForm=!0;d.$validators.time24hmsForm=function(a,b){return!c.time24hmsForm||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("time24hmsForm",function(){d.$validate()})}}}},x=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^(0[0-9]|1[0-9]|2[0-3]){1}(:[0-5][0-9]){1}$/,e=/(^[\x00-\xff]*$)/;c.time24hmForm=c.ngTime24hmForm?a.$eval(c.ngTime24hmForm):
!0;c.ngTime24hmForm?a.$watch(c.ngTime24hmForm,function(a,b){c.time24hmForm=a;d.$validate()}):c.time24hmForm=!0;d.$validators.time24hmForm=function(a,b){return!c.time24hmForm||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("time24hmForm",function(){d.$validate()})}}}},r=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[0-9a-fA-F]{2}(:[0-9a-fA-F]{2}){5}$/,e=/(^[\x00-\xff]*$)/;c.macAddress=c.ngMacAddress?a.$eval(c.ngMacAddress):!0;c.ngMacAddress?a.$watch(c.ngMacAddress,
function(a,b){c.macAddress=a;d.$validate()}):c.macAddress=!0;d.$validators.macAddress=function(a,b){return!c.macAddress||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("macAddress",function(){d.$validate()})}}}},d=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|((?!-)[a-zA-Z0-9-]{1,63}(?!-)\.)+[a-zA-Z-]{2,63})$)/,e=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),
k=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,h=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),r=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,l=/(^[\x00-\xff]*$)/;c.fqdnIp=c.ngFqdnIp?a.$eval(c.ngFqdnIp):!0;c.ngFqdnIp?a.$watch(c.ngFqdnIp,function(a,b){c.fqdnIp=a;d.$validate()}):c.fqdnIp=!0;
d.$validators.fqdnIp=function(a,b){return!c.fqdnIp||d.$isEmpty(b)?!0:(b.match(g)||b.match(e)&&!b.match(k)||b.match(h)&&b.match(r))&&b.match(l)?!0:!1};c.$observe("fqdnIp",function(){d.$validate()})}}}},c=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^(((?!-)[a-zA-Z0-9-_]{1,63}(?!-)\.)+[a-zA-Z_]{2,63})$)/,e=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),k=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,
h=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),r=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,l=/(^[\x00-\xff]*$)/;c.domainIp=c.ngDomainIp?a.$eval(c.ngDomainIp):!0;c.ngDomainIp?a.$watch(c.ngDomainIp,function(a,b){c.domainIp=a;d.$validate()}):c.domainIp=!0;d.$validators.domainIp=function(a,b){return!c.domainIp||
d.$isEmpty(b)?!0:(b.match(g)||b.match(e)&&!b.match(k)||b.match(h)&&b.match(r))&&b.match(l)?!0:!1};c.$observe("domainIp",function(){d.$validate()})}}}},k=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|((?!-)[a-zA-Z0-9-]{1,63}(?!-)\.)+[a-zA-Z-]{2,63})$)/,e=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),k=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,
h=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),r=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,l=/^\w+([\-+\.]\w+)*@\w+([\-\.]\w+)*\.\w+([\-\.]\w+)*$/,p=/(^[\x00-\xff]*$)/;c.fqdnIpEmail=c.ngFqdnIpEmail?a.$eval(c.ngFqdnIpEmail):!0;c.ngFqdnIpEmail?a.$watch(c.ngFqdnIpEmail,function(a,b){c.fqdnIpEmail=
a;d.$validate()}):c.fqdnIpEmail=!0;d.$validators.fqdnIpEmail=function(a,b){return!c.fqdnIpEmail||d.$isEmpty(b)?!0:(b.match(g)||b.match(e)&&!b.match(k)||b.match(h)&&b.match(r)||b.match(l))&&b.match(p)?!0:!1};c.$observe("fqdnIpEmail",function(){d.$validate()})}}}},g=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("(?=.*[\\.])(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|((?!-)[a-zA-Z0-9-]{1,63}(?!-)\\.)+[a-zA-Z]{2,63})$)"),e=/(^[0-9-])/,k=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),
h=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,r=RegExp("^((:|[0-9a-fA-F]{0,4}):)([0-9a-fA-F]{0,4}:){0,5}((([0-9a-fA-F]{0,4}:)?(:|[0-9a-fA-F]{0,4}))|(((25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9]?[0-9])))(%[\\p{N}\\p{L}]+)?$"),l=/^(([^:]+:){6}(([^:]+:[^:]+)|(.*\..*)))$|^((([^:]+:)*[^:]+)?::(([^:]+:)*[^:]+)?)(%.+)?$/,p=/(^[\x00-\xff]*$)/;c.fqdnNoHostIp=c.ngFqdnNoHostIp?a.$eval(c.ngFqdnNoHostIp):!0;c.ngFqdnNoHostIp?a.$watch(c.ngFqdnNoHostIp,function(a,b){c.fqdnNoHostIp=
a;d.$validate()}):c.fqdnNoHostIp=!0;d.$validators.fqdnNoHostIp=function(a,b){return!c.fqdnNoHostIp||d.$isEmpty(b)?!0:(b.match(g)&&!b.match(e)||b.match(k)&&!b.match(h)||b.match(r)&&b.match(l))&&b.match(p)?!0:!1};c.$observe("fqdnNoHostIp",function(){d.$validate()})}}}},z=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|((?!-)[a-zA-Z0-9-]{1,63}(?!-)\.)+[a-zA-Z-]{2,63})$)/,e=RegExp("^(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-4])$"),
k=/^(^0.0.0.0|0.0.0.1|127.0.0.1|255.255.255.255)$/,h=/(^[\x00-\xff]*$)/;c.fqdnIpv4=c.ngFqdnIpv4?a.$eval(c.ngFqdnIpv4):!0;c.ngFqdnIpv4?a.$watch(c.ngFqdnIpv4,function(a,b){c.fqdnIpv4=a;d.$validate()}):c.fqdnIpv4=!0;d.$validators.fqdnIpv4=function(a,b){return!c.fqdnIpv4||d.$isEmpty(b)?!0:(b.match(g)||b.match(e)&&!b.match(k))&&b.match(h)?!0:!1};c.$observe("fqdnIpv4",function(){d.$validate()})}}}},y=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|((?!-)[a-zA-Z0-9-]{1,63}(?!-)\.)+[a-zA-Z-]{2,63})$)/,
e=/(^[\x00-\xff]*$)/;c.fqdn=c.ngFqdn?a.$eval(c.ngFqdn):!0;c.ngFqdn?a.$watch(c.ngFqdn,function(a,b){c.fqdn=a;d.$validate()}):c.fqdn=!0;d.$validators.fqdn=function(a,b){return!c.fqdn||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("fqdn",function(){d.$validate()})}}}},A=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("(?=^.{1,253}$)(^(((?!-)[a-zA-Z0-9-]{1,63}(?!-))|(((?!-)[a-zA-Z0-9-]{1,63}(?!-)\\.){2,})+[a-zA-Z-]{2,63})$)"),e=/(^[0-9-])/,k=/(^[\x00-\xff]*$)/;
c.strickFqdn=c.ngStrickFqdn?a.$eval(c.ngStrickFqdn):!0;c.ngStrickFqdn?a.$watch(c.ngStrickFqdn,function(a,b){c.strickFqdn=a;d.$validate()}):c.strickFqdn=!0;d.$validators.strickFqdn=function(a,b){return!c.strickFqdn||d.$isEmpty(b)?!0:b.match(g)&&!b.match(e)&&b.match(k)?!0:!1};c.$observe("strickFqdn",function(){d.$validate()})}}}},B=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^\w+([\-+\.]\w+)*@\w+([\-\.]\w+)*\.\w+([\-\.]\w+)*$/,e=/(^[\x00-\xff]*$)/;c.email=c.ngEmail?
a.$eval(c.ngEmail):!0;c.ngEmail?a.$watch(c.ngEmail,function(a,b){c.email=a;d.$validate()}):c.email=!0;d.$validators.email=function(a,b){return!c.email||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("email",function(){d.$validate()})}}}},C=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[0-9A-Fa-f]*$/,e=/(^[\x00-\xff]*$)/;c.bitMask=c.ngBitMask?a.$eval(c.ngBitMask):!0;c.ngBitMask?a.$watch(c.ngBitMask,function(a,b){c.bitMask=a;d.$validate()}):c.bitMask=
!0;d.$validators.bitMask=function(a,b){return!c.bitMask||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("bitMask",function(){d.$validate()})}}}},D=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[a-zA-Z0-9][#\-\d\w\s]*$/,e=/(^[\x00-\xff]*$)/;c.strName=c.ngStrName?a.$eval(c.ngStrName):!0;c.ngStrName?a.$watch(c.ngStrName,function(a,b){c.strName=a;d.$validate()}):c.strName=!0;d.$validators.strName=function(a,b){return!c.strName||d.$isEmpty(b)?!0:b.match(g)&&
b.match(e)?!0:!1};c.$observe("strName",function(){d.$validate()})}}}},E=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[a-zA-Z0-9_\-\.]*\.[a-zA-Z0-9]+$/,e=/(^[\x00-\xff]*$)/;c.fileName=c.ngFileName?a.$eval(c.ngFileName):!0;c.ngFileName?a.$watch(c.ngFileName,function(a,b){c.fileName=a;d.$validate()}):c.fileName=!0;d.$validators.fileName=function(a,b){return!c.fileName||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("fileName",function(){d.$validate()})}}}},
I=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[a-zA-Z0-9][#\-\d\w\s]*$/,e=/^\w+([\-+\.]\w+)*@\w+([\-\.]\w+)*\.\w+([\-\.]\w+)*$/,k=/(^[\x00-\xff]*$)/;c.ddnsName=c.ngDdnsName?a.$eval(c.ngDdnsName):!0;c.ngDdnsName?a.$watch(c.ngDdnsrName,function(a,b){c.ddnsName=a;d.$validate()}):c.ddnsName=!0;d.$validators.ddnsName=function(a,b){return!c.ddnsName||d.$isEmpty(b)?!0:(b.match(g)||b.match(e))&&b.match(k)?!0:!1};c.$observe("ddnsName",function(){d.$validate()})}}}},
F=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[^\s]*$/,e=/(^[\x00-\xff]*$)/;c.noSpace=c.ngNoSpace?a.$eval(c.ngNoSpace):!0;c.ngNoSpace?a.$watch(c.ngNoSpace,function(a,b){c.noSpace=a;d.$validate()}):c.noSpace=!0;d.$validators.noSpace=function(a,b){return!c.noSpace||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("noSpace",function(){d.$validate()})}}}},H=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^.*$)/,
e=/(^[^%&\\"'\s]*$)/,k=/(^[\x00-\xff]*$)/;c.password=c.ngPassword?a.$eval(c.ngPassword):!0;c.ngPassword?a.$watch(c.ngPassword,function(a,b){c.password=a;d.$validate()}):c.password=!0;d.$validators.password=function(a,b){return!c.password||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)&&b.match(k)?!0:!1};c.$observe("password",function(){d.$validate()})}}}},G=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^[^%&\\"']*$)/,e=/(^[\x00-\xff]*$)/;c.keyword=c.ngKeyword?a.$eval(c.ngKeyword):
!0;c.ngKeyword?a.$watch(c.ngKeyword,function(a,b){c.keyword=a;d.$validate()}):c.keyword=!0;d.$validators.keyword=function(a,b){return!c.keyword||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("keyword",function(){d.$validate()})}}}},J=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^[\x00-\xff]*$)/;c.legalChar=c.ngLegalChar?a.$eval(c.ngLegalChar):!0;c.ngLegalChar?a.$watch(c.ngLegalChar,function(a,b){c.legalChar=a;d.$validate()}):c.legalChar=!0;d.$validators.legalChar=
function(a,b){return!c.legalChar||d.$isEmpty(b)?!0:b.match(g)?!0:!1};c.$observe("legalChar",function(){d.$validate()})}}}},L=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[a-zA-Z0-9@\.!%^\-_=+\[\]\s]*$/,e=/(^[\x00-\xff]*$)/;c.certCommonName=c.ngCertCommonName?a.$eval(c.ngCertCommonName):!0;c.ngCertCommonName?a.$watch(c.ngCertCommonName,function(a,b){c.certCommonName=a;d.$validate()}):c.certCommonName=!0;d.$validators.certCommonName=function(a,b){return!c.certCommonName||
d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("certCommonName",function(){d.$validate()})}}}},N=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^[0-9#*+]*$)/,e=/(^[\x00-\xff]*$)/;c.dialNum=c.ngDialNumber?a.$eval(c.ngDialNumber):!0;c.ngDialNumber?a.$watch(c.ngDialNumber,function(a,b){c.dialNum=a;d.$validate()}):c.dialNum=!0;d.$validators.dialNum=function(a,b){return!c.dialNum||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("dialNum",function(){d.$validate()})}}}},
M=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^[0-9]*$)/,e=/(^[\x00-\xff]*$)/;c.number=c.ngNumber?a.$eval(c.ngNumber):!0;c.ngNumber?a.$watch(c.ngNumber,function(a,b){c.number=a;d.$validate()}):c.number=!0;d.$validators.number=function(a,b){return!c.number||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("number",function(){d.$validate()})}}}},P=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&(c.maxlength=c.ngMaxLength?
a.$eval(c.ngMaxLength):c.maxLength,c.ngMaxLength&&a.$watch(c.ngMaxLength,function(a,b){c.maxlength=a;d.$validate()}),d.$validators.maxLength=function(a,b){return 0>=c.maxlength||d.$isEmpty(b)?!0:b.length<=c.maxlength?!0:!1},c.$observe("maxLength",function(){d.$validate()}))}}},U=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&(c.minlength=c.ngMinLength?a.$eval(c.ngMinLength):c.minLength,c.ngMinLength&&a.$watch(c.ngMinLength,function(a,b){c.minlength=a;d.$validate()}),d.$validators.minLength=
function(a,b){return 0>=c.minlength||d.$isEmpty(b)?!0:b.length>=c.minlength?!0:!1},c.$observe("minLength",function(){d.$validate()}))}}},Q=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&(c.lengthequal=c.ngLengthEqual?a.$eval(c.ngLengthEqual):c.lengthEqual,c.ngLengthEqual&&a.$watch(c.ngLengthEqual,function(a,b){c.lengthequal=a;setTimeout(function(){d.$validate()},0)}),d.$validators.lengthEqual=function(a,b){return 0>c.lengthequal||d.$isEmpty(b)?!0:b.length===c.lengthequal?
!0:!1},c.$observe("lengthEqual",function(){d.$validate()}))}}},V=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^[a-zA-Z0-9_]*$)/,e=/(^[\x00-\xff]*$)/;c.uciName=c.ngUciName?a.$eval(c.ngUciName):!0;c.ngUciName?a.$watch(c.ngUciName,function(a,b){c.uciNmae=a;d.$validate()}):c.uciName=!0;d.$validators.uciName=function(a,b){return!c.uciName||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("uciName",function(){d.$validate()})}}}},R=function(){return{restrict:"A",
require:"?ngModel",link:function(a,b,c,d){if(d){var g=/(^([1-9]|[1-9][0-9]|[1][0-2][0-8])$)/,e=/(^[\x00-\xff]*$)/;c.ipv6PrefixLen=c.ngIpv6PrefixLen?a.$eval(c.ngIpv6PrefixLen):!0;c.ngIpv6PrefixLen?a.$watch(c.ngIpv6PrefixLen,function(a,b){c.ipv6PrefixLen=a;d.$validate()}):c.ipv6PrefixLen=!0;d.$validators.ipv6PrefixLen=function(a,b){return!c.ipv6PrefixLen||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("ipv6PrefixLen",function(){d.$validate()})}}}},K=function(){return{restrict:"A",require:"?ngModel",
link:function(a,b,c,d){if(d){var g=/^[0-9A-Fa-f]*$/,e=/(^[\x00-\xff]*$)/;c.psk=c.ngPsk?a.$eval(c.ngPsk):!0;c.ngPsk?a.$watch(c.ngPsk,function(a,b){c.psk=a;d.$validate()}):c.psk=!0;d.$validators.psk=function(a,b){return!c.psk||d.$isEmpty(b)?!0:64===b.length?b.match(g)&&b.match(e)?!0:!1:b.match(e)?!0:!1};c.$observe("psk",function(){d.$validate()})}}}},S=["passwordComplex",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,g){g&&(d.ngComplexity?(b.$watch(d.ngComplexity,function(a,
b){d.complexity=a;g.$validate()}),d.complexity=b.$eval(d.ngComplexity)):d.complexity=!0,b.$watch(function(){return a.get_config()},function(a){g.$validate()}),g.$validators.complexity=function(b,c){var e,k={},h;if(!d.complexity||g.$isEmpty(c))return delete g.$error.complexity,delete g.$error.complexity_length,delete g.$error.complexity_class,!0;e=a.getStrength({pwd:c,qualityIndicator:k});h="complexity_length";!0===k.length_ok&&angular.isDefined(g.$error[h])?delete g.$error[h]:!1===k.length_ok&&(g.$error[h]=
!0);h="complexity_class";!0===k.class_ok&&angular.isDefined(g.$error[h])?delete g.$error[h]:!1===k.class_ok&&(g.$error[h]=!0);if(0<e)return delete g.$error.complexity,!0;g.$error.complexity=!0;return!1},d.$observe("complexity",function(){g.$validate()}))}}}],T=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=RegExp("(\\btype\\b|\\bvalid-duration\\b|\\bsubject-alternative-type\\b|\\bcountry\\b|\\bkey-encryption-length\\b|\\bname\\b|\\bsubject-alternative-name\\b|\\blocality\\b|\\borganization\\b|\\borganization-unit\\b|\\bcommon\\b|\\bemail\\b|\\bstate-province\\b)");
c.certStr=c.ngCertStr?a.$eval(c.ngCertStr):!0;c.ngCertStr?a.$watch(c.ngCertStr,function(a,b){c.certStr=a;d.$validate()}):c.certStr=!0;d.$validators.certStr=function(a,b){return c.certStr&&!d.$isEmpty(b)&&b.match(g)?!1:!0};c.$observe("certStr",function(){d.$validate()})}}}},O=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^([0-9]{4}[\-\s][0-9]{4}$|[0-9]*$)/;c.wpsPin=c.ngWpsPin?a.$eval(c.ngWpsPin):!0;c.ngWpsPin?a.$watch(c.ngWpsPin,function(a,b){c.wpsPin=a;d.$validate()}):
c.wpsPin=!0;d.$validators.wpsPin=function(a,b){return!c.wpsPin||d.$isEmpty(b)?!0:b.match(g)?!0:!1};c.$observe("wpsPin",function(){d.$validate()})}}}},W=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[a-zA-Z0-9][a-zA-Z0-9_\-\s,']*$/,e=/(^[\x00-\xff]*$)/;c.staticDhcpName=c.ngStaticDhcpName?a.$eval(c.ngStaticDhcpName):!0;c.ngStaticDhcpName?a.$watch(c.ngStaticDhcpName,function(a,b){c.staticDhcpName=a;d.$validate()}):c.staticDhcpName=!0;d.$validators.staticDhcpName=
function(a,b){return!c.staticDhcpName||d.$isEmpty(b)?!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("staticDhcpName",function(){d.$validate()})}}}},Y=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var g=/^[^&<]*$/,e=/(^[\x00-\xff]*$)/;c.loginBanner=c.ngLoginBanner?a.$eval(c.ngLoginBanner):!0;c.ngLoginBanner?a.$watch(c.ngLoginBanner,function(a,b){c.loginBanner=a;d.$validate()}):c.loginBanner=!0;d.$validators.loginBanner=function(a,b){return!c.loginBanner||d.$isEmpty(b)?
!0:b.match(g)&&b.match(e)?!0:!1};c.$observe("loginBanner",function(){d.$validate()})}}}},X=function(){return{restrict:"A",require:["?ngModel","^form"],link:function(a,b,c,d){if(d&&d[0]){var g="customVld",e,k,h=d[0],r=d[1],l=!1,p,A=[],z={},y,B=function(){return!0};if(c.customVldRelationship&&(b=a.$eval(c.customVldRelationship),"array"===$.type(b))){for(y=b.length-1;0<=y;y--)b[y]===h.$name&&b.splice(y,1);A=b}c.customVldOps&&(b=a.$eval(c.customVldOps),"object"===$.type(b)&&(z=b));a.grid?(d=a.col,e=a.row,
k=a.colContainer.renderedColumns,b=a.grid.rows,angular.forEach(b,function(a,b){e.uid===a.uid&&(e.rowIndex=b)})):(d=a.$eval("col"),e=a.$eval("row"),k=a.$eval("renderedColumns"),b=a.$eval("renderedRows"));if(d&&d.colDef&&d.colDef.customVldGroup){p=d.colDef.customVldGroup;l=!0;for(y=k.length-1;0<=y;y--)k[y].field!==d.field&&k[y].colDef.customVldGroup===p&&A.push(k[y].field+"_"+k[y].index+"_"+e.rowIndex)}c.customVldName&&(g=c.customVldName);c.customVldCbk&&(d=a.$eval(c.customVldCbk),"function"===typeof d&&
(B=d));c.ngCustomVld?(c[g]=a.$eval(c.ngCustomVld),a.$watch(c.ngCustomVld,function(b,d){c[g]=b;!1===b&&(h&&(h.$error&&h.$error[g])&&!0===z.modifyEmptyStr)&&(h.$viewValue="",h.$commitViewValue(),h.$render());M(a.$eval(c.ngModel))})):c[g]=!0;var u=function(b,d){var e=b.invalidRows,h=b.validRows,A=!1,z=!1,B=!1,u;"array"===$.type(e)&&e.length&&(A=!0);"array"===$.type(h)&&h.length&&(z=!0);void 0===d&&(d={},B=!0);if(l&&(A||z)){var M=function(a){a=a||"";A&&angular.forEach(e,function(b){b!==d.rowIndex&&(u=
a+k[y].field+"_"+k[y].index+"_"+b,r[u]&&r[u].$setValidity(g,!1))});z&&angular.forEach(h,function(b){b!==d.rowIndex&&(u=a+k[y].field+"_"+k[y].index+"_"+b,r[u]&&r[u].$setValidity(g,!0))})},G=[""];c.customVldAffectPreifxList&&(G=a.$eval(c.customVldAffectPreifxList));for(y=k.length-1;0<=y;y--)if(k[y].colDef.customVldGroup===p||void 0!==k[y].colDef.customVldGroup&&B)for(var q=0,x;q<G.length;q++)x=G[q],M(x)}},M=function(a){if(!c[g]||""===$.type(a)||"boolean"!==$.type(a)&&h.$isEmpty(a))h.$setValidity(g,
!0);else{var b={type:"edit_row"};a=!0;var d=angular.copy(A);e&&(b.row=e);b=B(b);"object"===$.type(b)?(a=!0===b.result,u(b,e)):a="boolean"===$.type(b)?b:!0;if(r&&d.length)for(y=d.length-1;0<=y;y--)b=d[y],r[b]&&r[b].$setValidity(g,a);h.$setValidity(g,a)}};a.$watch(c.ngModel,function(a,b){M(a)});a.currRows=[];r&&(!r.nggridchklenvld&&b&&void 0!==b.length)&&(r.nggridchklenvld=a.$watch(function(){return a.grid?a.grid.rows.length:a.renderedRows.length},function(a,b){if(!(b<=a)){var c=B({type:"delete_row"});
"object"===$.type(c)&&u(c,void 0)}}))}}}};angular.forEach({ipv4Ip:b,ngIpv4Ip:b,ipv4IpFormat:s,ngIpv4IpFormat:s,ipv4Netmask:n,ngIpv4Netmask:n,ipv4NetmaskAll:v,ngIpv4NetmaskAll:v,ipv4Prefix:t,ngIpv4Prefix:t,ipv6Ip:m,ngIpv6Ip:m,ipv6IpPrefix:q,ngIpv6IpPrefix:q,ipv6IpSuffix:e,ngIpv6IpSuffix:e,ip:w,ngIp:w,hostName:l,ngHostName:l,hostNameNum:h,ngHostNameNum:h,domainName:p,ngDomainName:p,time24hmsForm:u,ngTime24hmsForm:u,time24hmForm:x,ngTime24hmForm:x,macAddress:r,ngMacAddress:r,fqdnIp:d,ngFqdnIp:d,domainIp:c,
ngDomainIp:c,fqdnIpEmail:k,ngFqdnIpEmail:k,fqdnNoHostIp:g,ngFqdnNoHostIp:g,fqdnIpv4:z,ngFqdnIpv4:z,fqdn:y,ngFqdn:y,strickFqdn:A,ngStrickFqdn:A,email:B,ngEmail:B,bitMask:C,ngBitMask:C,strName:D,ngStrName:D,ddnsName:I,ngDdnsName:I,noSpace:F,ngNoSpace:F,password:H,ngPassword:H,keyword:G,ngKeyword:G,legalChar:J,ngLegalChar:J,certCommonName:L,ngCertCommonName:L,dialNumber:N,ngDialNumber:N,ngMaxLength:P,maxLength:P,ngMinLength:U,minLength:U,lengthEqual:Q,ngLengthEqual:Q,number:M,ngNumber:M,uciName:V,ngUciName:V,
ipv6PrefixLen:R,ngIpv6PrefixLen:R,psk:K,ngPsk:K,fileName:E,ngFileName:E,ipv4IpNonzero:a,ngIpv4IpNonzero:a,complexity:S,ngComplexity:S,customVld:X,ngCustomVld:X,gridCustomVld:function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){b=a;var g,e,k=function(){return!0};a.grid&&(b=a.grid.appScope);c.gridCustomVld&&(e=a.$eval(c.gridCustomVld));e&&(e=b.$eval(e),_.isFunction(e)&&(k=e,g=a.$watch(c.ngModel,function(b,c){k(a.row,a.col,a.grid,d)}),a.$on("$destroy",function(){g&&g()})))}}}},
certStr:T,ngCertStr:T,wpsPin:O,ngWpsPin:O,staticDhcpName:W,ngStaticDhcpName:W,loginBanner:Y,ngLoginBanner:Y},function(a,b){app.directive(b,a)})}]);
app.directive("gridInvalidField",[function(){return{restrict:"A",require:"?ngModel",link:function(a,b,s,n){b={};var v=[];if(s.gridInvalidField&&a.row){o=a.$eval(s.gridInvalidField);if(_.isString(o))b[o]="gridInvalid";else if(_.isObject(o))b=o;else return;angular.forEach(b,function(b,m){v.push(a.$watch(function(){return _.get(a.row.entity,m)},function(a){n.$setValidity(b,!a)}))});a.$on("$destroy",function(){v&&v.length&&angular.forEach(v,function(a){a()})})}}}}]);
app.directive("gridValidationResultCbk",[function(){return{restrict:"A",require:"?ngModel",link:function(a,b,s,n){if(n&&s.gridValidationResultCbk){var v,t=a.$eval("grid"),m;m=t?t.appScope.$eval(s.gridValidationResultCbk):a.$eval(s.gridValidationResultCbk);if("function"===$.type(m)){var q=function(b,q,l){var h=0,p=a.$eval("row"),u=a.$eval("col");q=t?u.uid:u.index;void 0===p.invalidCols&&(p.invalidCols={});p.invalidCols[q]=b?!0:!1;angular.forEach(p.invalidCols,function(a){a&&h++});m({row:p,col:u,colInvalid:b,
rowInvalid:0<h,reason:l})};v=a.$watch(function(){return n.$invalid},function(a,b){q(a,b,"invalid_changed")});a.$on("$destroy",function(){v&&v();q(!1,void 0,"destroy")})}}}}}]);app.directive("ignoreDirty",[function(){return{restrict:"A",require:"?ngModel",link:function(a,b,s,n){n&&(n.$setPristine=function(){},n.$pristine=!1)}}}]);
app.service("sslvpn_port_vld",["MyHttp","$q","userAccessRight",function(a,b,s){var n=s.russia(),v=function(a,b){return a&&a[b]&&a[b].data&&a[b].data.result||{}},t=function(a,b){b||(b="");return void 0===a?b:a},m={enable:!1,ifname:"",gateway_port:""},q=!1,e=830,w=!1,l=443,h={enable:!1,remote:{enable:!1,port:""},lan_vpn:{https_enable:!1,https_port:"",http_enable:!1,http_port:""}},p={},u=[],x=function(a){a=a["port-forwarding-rules"]&&a["port-forwarding-rules"]["port-forwarding-entry"]||[];var b;u=[];
angular.forEach(a,function(a){b={enable:t(a.status,!1),ifname:t(a["interface"]),external_service:t(a["external-service"])};u.push(b)})},r=function(a){a=a.services&&a.services.service||[];var b;p={};angular.forEach(a,function(a){a["port-range"]&&(b={name:a.name,proto:a.protocol||"",start:t(a["port-range"].start,""),end:t(a["port-range"].end,"")},""===b.start||""===b.end||(p[b.name]=b))})},d=function(a){a||(a={});a=a["ciscosb-netconf"]||{};var b=a["netconf-zone"]||[],c=!1,d=t((a.transport&&a.transport.ssh||
{}).port,830);a.enabled&&angular.forEach(b,function(a){"wan"===a&&(c=!0)});q=c;e=d},c=function(a){a||(a={});a=a["ciscosb-restconf"]||{};var b=a["restconf-zone"]||[],c=!1,d=t((a.transport&&a.transport.https||{}).port,443);a.enabled&&angular.forEach(b,function(a){"wan"===a&&(c=!0)});w=c;l=d},k=function(a,b){var c=m,d=[];c.enable&&"number"===typeof c.gateway_port&&!n&&c.gateway_port>=a&&c.gateway_port<=b&&d.push({id:"sslvpn",service:"SSL VPN",start:c.gateway_port,end:c.gateway_port});return d},g=function(a,
b){var c=h,d=[];c.remote.enable&&"number"===typeof c.remote.port&&c.remote.port>=a&&c.remote.port<=b&&d.push({id:"firewall",service:"Remote Web Management",start:c.remote.port,end:c.remote.port});q&&_.isNumber(e)&&e>=a&&e<=b&&d.push({id:"firewall",service:"NETCONF Port",start:e,end:e});w&&_.isNumber(l)&&l>=a&&l<=b&&d.push({id:"firewall",service:"RESTCONF Port",start:l,end:l});return d},z=function(a,b){var c=p,d,g=[];angular.forEach(u,function(e){if(e.enable&&(d=c[e.external_service])){switch(d.proto){case "TCP":case "TCP_UDP":break;
default:return}(d.start<=a&&d.end>=a||d.start<=b&&d.end>=b)&&g.push({id:"portforward",service:e.external_service,start:d.start,end:d.end})}});return g};this.init=function(){var g=b.defer();b.all([a.post({url:resource_base+"data/sslvpn.json",method:"get_sslvpn"}),a.post({url:resource_base+"data/firewall_basic_settings.json",method:"get_firewall_basic_settings"}),a.post({url:resource_base+"data/port_forwarding.json",method:"get_port_forwarding"}),a.post({url:resource_base+"data/service_management.json",
method:"get_services"}),a.post({url:resource_base+"data/netconf.json",method:"get_netconf"}),a.post({url:resource_base+"data/restconf.json",method:"get_restconf"})]).then(function(a){var b=v(a,0).sslvpn||{};m={enable:t(b.enable,!1),ifname:t(b["interface"],""),gateway_port:t(b["gateway-port"],"")};var b=v(a,1).firewall||{},e=b["remote-web-management"]||{},k=b["lan-vpn-web-management"]||{};h={enable:t(b.enable,!1),remote:{enable:t(e.enable,!1),port:t(e.port||"")},lan_vpn:{https_enable:t(k.https,!1),
https_port:t(k["https-port"],443),http_enable:t(k.http,!1),http_port:t(k["http-port"],80)}};x(v(a,2));r(v(a,3));d(v(a,4));c(v(a,5));g.resolve("ok")});return g.promise};this.check_ssl_port=function(a){var b={valid:!0,err:[]},c;c=g(a,a);c.length&&(b.valid=!1,b.err=b.err.concat(c));c=h;var d=[];c.lan_vpn.https_enable&&"number"===typeof c.lan_vpn.https_port&&c.lan_vpn.https_port>=a&&c.lan_vpn.https_port<=a&&d.push({id:"firewall",service:n?"LAN Web Management (HTTPS)":"LAN/VPN Web Management (HTTPS)",
start:c.lan_vpn.https_port,end:c.lan_vpn.https_port});c.lan_vpn.http_enable&&"number"===typeof c.lan_vpn.http_port&&c.lan_vpn.http_port>=a&&c.lan_vpn.http_port<=a&&d.push({id:"firewall",service:n?"LAN Web Management (HTTP)":"LAN/VPN Web Management (HTTP)",start:c.lan_vpn.http_port,end:c.lan_vpn.http_port});c=d;c.length&&(b.valid=!1,b.err=b.err.concat(c));c=z(a,a);c.length&&(b.valid=!1,b.err=b.err.concat(c));return b};this.check_firewall_port_wan=function(a){var b={valid:!0,err:[]},c;c=k(a,a);c.length&&
(b.valid=!1,b.err=b.err.concat(c));c=z(a,a);c.length&&(b.valid=!1,b.err=b.err.concat(c));return b};this.check_firewall_port_lan=function(a){var b={valid:!0,err:[]};a=k(a,a);a.length&&(b.valid=!1,b.err=b.err.concat(a));return b};this.check_port_forwarding_service=function(a){a=p[a];var b={valid:!0,err:[]},c;if(!a)return b;switch(a.proto){case "TCP":case "TCP_UDP":break;default:return b}c=k(a.start,a.end);c.length&&(b.valid=!1,b.err=b.err.concat(c));c=g(a.start,a.end);c.length&&(b.valid=!1,b.err=b.err.concat(c));
return b};this.check_service_port=function(a,b,c){var d=!1,e={valid:!0,err:[]},h;angular.forEach(u,function(b){b.external_service===a&&(d=!0)});if(!d)return e;h=k(b,c);h.length&&(e.valid=!1,e.err=e.err.concat(h));h=g(b,c);h.length&&(e.valid=!1,e.err=e.err.concat(h));return e};this.get_err_html=function(a){var b="",c={sslvpn:"",firewall:"",portforward:""},d,g=[];angular.forEach(a,function(a){d=a.start===a.end?a.start:a.start+"-"+a.end;var b=a.service+" ("+d+")";0>g.indexOf(b)&&(g.push(b),c[a.id]=c[a.id]+
"<div>"+b+"</div>")});delete g;c.sslvpn&&(b+=c.sslvpn);c.firewall&&(b+=c.firewall);c.portforward&&(b=b+"<div>Port Forwarding:</div>"+c.portforward);b&&(b="<div>Port conflict with other services</div><br/>"+b);return b}}]);app.service("ipv6_lib",[function(){var a=createIpAddr(),b=function(a,b){var m=angular.copy(a);return 128===b?m:m=n(m,b)},s=function(a,b){var m=angular.copy(a);if(128===b)return m;var l,h,p,m=n(m,b);for(l=7;0<=l;l--){h="";for(p=0;16>p&&b;p++)0<b&&(h="1"+h,b-=1);h=parseInt(h,2);m.parts[l]|=h}return m},n=function(a,b){var m=angular.copy(a),l,h,p;for(l=0;l<m.parts.length;l++){h="";for(p=0;16>p;p++)0<b?(h+="1",b-=1):h+="0";h=parseInt(h,2);m.parts[l]&=h}return m},v=function(b){var e=!1;return!b||!a.IPv6.isValid(b)?
e:e=a.IPv6.parse(b)},t=function(b){var e;e=angular.copy(b);b=!1;if(!e)return b;e=e.split("/");if(!e||!a.IPv6.isValid(e[0]))return b;e[0]=a.IPv6.parse(e[0]);e[1]=parseInt(e[1],10);return!_.isNumber(e[1])||0>e[1]||128<e[1]?b:e},m=function(a,b){var m,l;if(!a||!b||!a.parts||!b.parts||!a.parts.length||!b.parts.length)return!1;m=!0;for(l=0;8>l;l++)if(a.parts[l]>b.parts[l]){m=!1;break}return m};this.vld={is_overlap_between_prefixs:function(a,e){var m,l,h,p,u,x,r,d=!1;m=t(a);p=t(e);if(!m||!p)return d;h=m[0];
l=m[1];x=p[0];u=p[1];if(l>u){if(r=s(h,l),u=b(h,l),r.match(p)||u.match(p))d=!0}else if(u>l){if(r=s(x,u),u=b(x,u),r.match(m)||u.match(m))d=!0}else m=n(h,l),p=n(x,u),m.toNormalizedString()===p.toNormalizedString()&&(d=!0);return d},is_overlap_between_ranges:function(a,b){if(a&&b){var n=v(a.start),l=v(a.end),h=v(b.start),p=v(b.end),u=!1;if(n&&l&&h&&p&&m(n,l)&&m(h,p))return m(n,h)&&m(h,l)&&(u=!0),m(n,p)&&m(p,l)&&(u=!0),m(h,n)&&m(n,p)&&(u=!0),m(h,l)&&m(l,p)&&(u=!0),u}},ip_range_is_valid:m};this.parse=v;
this.CIDR=t;this.combined_two_ip=function(a,b,m){a=angular.copy(a);var l=angular.copy(b);for(b=0;8>b;b++)16<m?m-=16:0<m?(l.parts[b]&=65535>>>m,a.parts[b]|=l.parts[b],m=0):a.parts[b]=l.parts[b];return a};this.get_prefix=n;this.get_suffix=function(a,b){var m=angular.copy(a),l,h,p;for(l=0;l<m.parts.length;l++){h="";for(p=0;16>p;p++)0<b?(h+="0",b-=1):h+="1";h=parseInt(h,2);m.parts[l]&=h}return m};this.get_first_ip=function(a,e){var m=v(a);return!m||!_.isNumber(e)||0>e||128<e?void 0:b(m,e)};this.get_last_ip=
function(a,b){var m=v(a);return!m||!_.isNumber(b)||0>b||128<b?void 0:s(m,b)}}]);(function(){var a=function(a){return{restrict:"E",templateUrl:a,transclude:!0,scope:{placement:"=placement",closedelay:"=closeDelay",trigger:"=trigger",context:"=context",isopen:"=isopen",openAndClose:"=openAndClose",ngIf:"=ngIf",ngShow:"=ngShow"},link:function(a,b,v){Log(DEBUG,a.context)},compile:function(){return{pre:function(a,b,v){var t,m,q,e,w=function(){t&&(clearTimeout(t),t=void 0)},l=function(){a.isopen&&(t=setTimeout(function(){t=void 0;a.isopen&&(a.isopen=!1)},a.openAndClose))};a.context||
(a.context="");_.isNumber(a.openAndClose)||(a.openAndClose=0);switch(a.placement){case "top":case "top-left":case "top-right":case "bottom":case "bottom-left":case "bottom-right":case "left":case "left-top":case "left-bottom":case "right":case "right-top":case "right-bottom":break;default:a.placement="top"}switch(a.trigger){case "mouseenter":case "click":case "outsideClick":case "focus":case "none":break;default:a.trigger="mouseenter"}_.isNumber(a.closedelay)?0>a.closedelay&&(a.closedelay=0):a.closedelay=
0;0<a.openAndClose&&(v.ngIf&&(m=a.$watch("ngIf",function(a){a?l():w()})),v.ngShow&&(q=a.$watch("ngShow",function(a){a?l():w()})),e=a.$watch("isopen",function(a){a?l():w()}));a.$on("$destroy",function(){m&&m();q&&q();e&&e()})}}}}};app.directive("helpIcon",[function(){return a("helpIcon.html")}]);app.directive("infoIcon",[function(){return a("infoIcon.html")}])})();
app.directive("gridBtnTableaction",["multiLanguageService",function(a){return{restrict:"C",templateUrl:"grid_tableaction_btn.html",replace:!0,scope:{uiGridOption:"=",ngDisabled:"=",uiGridActionCbk:"="},link:function(b,s,n){var v;b.columns=[];b.isopen=!1;b.disabled=!1;b.title=a.getString("Column_Display_Selection");b.clickaction=function(){var a=b.uiGridOption&&b.uiGridOption.columnDefs||[];b.columns=[];angular.forEach(a,function(a){!a.isChecked&&!a.isRadio&&b.columns.push({displayName:a.displayName,
field:a.field,visible:_.isBoolean(a.visible)?a.visible:!0})});b.isopen=!0};b.clickvisiable=function(a){angular.forEach(b.uiGridOption&&b.uiGridOption.columnDefs||[],function(b){a.field===b.field&&(a.visible=!a.visible,b.visible=a.visible)});b.uiGridOption&&(b.uiGridOption.gridApi&&b.uiGridOption.gridApi.core&&b.uiGridOption.gridApi.core.notifyDataChange)&&b.uiGridOption.gridApi.core.notifyDataChange("all")};v=b.$watch(function(){return b.isopen},function(a){_.isFunction(b.uiGridActionCbk)&&b.uiGridActionCbk(a,
b.uiGridOption&&b.uiGridOption.columnDefs||[])});b.$on("$destroy",function(){v()})}}}]);
app.directive("uiGridPaginationOp",["$rootScope",function(a){return{restrict:"E",templateUrl:"ui_grid_pagination_op.htm",scope:{pPageIdx:"=pageIdx",uiGridOption:"=",pagingOptions:"="},link:function(b,s,n){b.DICT=a.DICT;var v,t,m=function(){var a="";0<b.m.total?(a=(b.m.pageIdx-1)*b.m.pagingSize+1+" - "+(b.m.lastPageNum===b.m.pageIdx?b.m.total:b.m.pageIdx*b.m.pagingSize),b.m.pageStr=b.DICT("Paging_Info",{"%s1":a,"%s2":b.m.total})):b.m.pageStr=""},q=function(){b.m.pp=[];1<b.m.pageIdx&&b.m.pp.push({id:1,
isEllipsis:!1,cbk:function(){}});5<b.m.pageIdx?b.m.pp.push({id:"...",isEllipsis:!0,cbk:function(){b.goTo(b.m.pageIdx-3)}}):1<b.m.pageIdx-3&&b.m.pp.push({id:b.m.pageIdx-3,isEllipsis:!1});1<b.m.pageIdx-2&&b.m.pp.push({id:b.m.pageIdx-2,isEllipsis:!1});1<b.m.pageIdx-1&&b.m.pp.push({id:b.m.pageIdx-1,isEllipsis:!1});b.m.pp.push({id:b.m.pageIdx,isEllipsis:!1});b.m.pageIdx+1<b.m.lastPageNum&&b.m.pp.push({id:b.m.pageIdx+1,isEllipsis:!1});b.m.pageIdx+2<b.m.lastPageNum&&b.m.pp.push({id:b.m.pageIdx+2,isEllipsis:!1});
b.m.pageIdx+4<b.m.lastPageNum?b.m.pp.push({id:"...",isEllipsis:!0,cbk:function(){b.goTo(b.m.pageIdx+3)}}):b.m.pageIdx+3<b.m.lastPageNum&&b.m.pp.push({id:b.m.pageIdx+3,isEllipsis:!1});b.m.pageIdx<b.m.lastPageNum&&b.m.pp.push({id:b.m.lastPageNum,isEllipsis:!1})},e=function(){var a=b.pagingOptions;b.m.pp=[];b.m.pages=a.pages;b.m.total=a.total;b.m.pageStr="";b.m.pageIdx=angular.copy(b.pPageIdx);b.m.pagingSize=angular.copy(a.pageSize);b.m.lastPageNum=Math.floor(app.TOOLS.divide(b.m.total,b.m.pagingSize))+
(b.m.total%b.m.pagingSize?1:0);v=a.changePageSizeCbk;t=a.changePageIdxCbk;m();q();b.m.show=0<b.m.total?!0:!1};b.m={show:!1,pp:[],pages:[],total:0,pageStr:"",pageSize:0,lastPageNum:0};b.goToFirst=function(){b.goTo(1)};b.goToLast=function(){b.goTo(b.m.lastPageNum)};b.goToNext=function(){b.m.pageIdx<b.m.lastPageNum&&b.goTo(b.m.pageIdx+1)};b.goToPrevious=function(){1<b.m.pageIdx&&b.goTo(b.m.pageIdx-1)};b.goTo=function(a){t?(void 0===a&&(a=b.m.pageIdx),_.isFunction(t.pre)&&t.pre(a,function(){}),_.isFunction(t.post)&&
t.post(a,function(){b.m.pageIdx=a;Log(DEBUG,"doChangePageIdxCbk, pageIdx: "+b.m.pageIdx);b.uiGridOption&&b.uiGridOption.gridApi&&(b.uiGridOption.gridApi.pagination.seek(b.m.pageIdx),b.uiGridOption.gridApi.grid.refresh());m();q()})):Log(ERROR,"[uiGridPaginationOp] error, changePageIdxCbk is not defined")};b.changePageSize=function(){v(b.m.pagingSize,function(){b.goToFirst();b.uiGridOption.paginationPageSize=b.m.pagingSize;b.uiGridOption&&b.uiGridOption.gridApi&&b.uiGridOption.gridApi.grid.refresh();
e();m();q()})};var w;w=b.$watch(function(){return b.pPageIdx},function(a){a!==b.m.pageIdx&&b.goTo(a)});b.pagingOptions.updateOpts=function(){e()};b.pagingOptions.goTo=function(a){b.goTo(a)};e();b.$on("$destroy",function(){w()})}}}]);
(function(){var a={};angular.forEach({"grid-btn-add":["gridBtnAdd","grid-btn-add-s","Add"],"grid-btn-add-dhcp":["gridBtnAddDhcp","grid-btn-add-s","Add to Static DHCP"],"grid-btn-delete":["gridBtnDelete","grid-btn-delete-s","Delete"],"grid-btn-edit":["gridBtnEdit","grid-btn-edit-s","Edit"],"grid-btn-refresh":["gridBtnRefresh","grid-btn-refresh-s","Refresh"],"icon-btn-refresh":["iconBtnRefresh","grid-btn-refresh-s","Refresh"],"grid-btn-copy":["gridBtnCopy","grid-btn-copy-s","Copy"],"grid-btn-filter":["gridBtnFilter",
"grid-btn-filter-s","Filter"],"grid-btn-detail":["gridBtnDetail","grid-btn-detail-s","Detail"],"grid-btn-eye":["gridBtnEye","grid-btn-eye-s","Detail"],"grid-btn-look":["gridBtnLook","grid-btn-look-s","Look"],"grid-btn-connect":["gridBtnConnect","grid-btn-connect-s","Connect"],"icon-btn-connect":["iconBtnConnect","grid-btn-connect-s","Connect"],"grid-btn-connected":["gridBtnConnected","grid-btn-connect-s","Connected"],"icon-btn-connected":["iconBtnConnected","grid-btn-connect-s","Connected"],"grid-btn-disconnect":["gridBtnDisconnect",
"grid-btn-disconnect-s","Disconnect"],"icon-btn-disconnect":["iconBtnDisconnect","grid-btn-disconnect-s","Disconnect"],"grid-btn-disconnected":["gridBtnDisconnected","grid-btn-disconnect-s","Disconnected"],"icon-btn-disconnected":["iconBtnDisconnected","grid-btn-disconnect-s","Disconnected"],"grid-btn-reset":["gridBtnReset","grid-btn-reset-s","Reset"],"grid-btn-reset-counter":["gridBtnResetCounter","grid-btn-reset-s","Reset_Counter"],"icon-btn-reset":["iconBtnReset","grid-btn-reset-s","Reset"],"grid-btn-import":["gridBtnImport",
"grid-btn-import-s","Import"],"icon-btn-export":["iconBtnExport","grid-btn-reset-s","Export"],"icon-btn-show-children":["iconBtnShowChildren","icon-plus-s","Show_Children"],"icon-btn-hide-children":["iconBtnHideChildren","icon-minus-s","Hide_Children"]},function(b){b[0]&&b[1]&&(a[b[0]]&&Log(ERROR,'icon_directive.js _init_icons get error, directive name "'+b[0]+'"is repeated, please check it'),app.directive(b[0],[function(){return{restrict:"C",link:function(a,n,v){n.addClass(b[1]);b[2]&&(n.context.title=
a.DICT(b[2]))}}}]),a[b[0]]=!0)})})();app.controller("qos_wan_policing_main",["$scope","$q","$timeout","MyHttp","$templateCache","$filter","UserSession","userAccessRight","goToPreviousPage","oneTimeLocker",function(a,b,s,n,v,t,m,q,e,w){a.model=a.model||{};a.success=!1;a.dataReady=!1;a.backbtn=!1;a.comefromWanQueuing=!1;a.goback=function(){e.goback(function(b){b&&a.comefromWanQueuing&&w.put("needbackbtnbywanpolicy",!0)})};a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();w.get("comefromWanQueuing")&&
(a.comefromWanQueuing=!0);e.isneed()&&(a.backbtn=!0);var l=function(){var e=n.post({url:resource_base+"data/qos_policing.json",method:"get_qos_policing",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),l=n.post({url:resource_base+"data/interfaces_qos.json",method:"get_qos_wan_bandwidth",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),r=n.post({url:resource_base+"data/qos_class.json",method:"get_qos_class",error:function(a){Log(ERROR,
"AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,l,r]).then(function(b){for(var c=0;c<b.length;c++)angular.extend(a.model,b[c].data.result);h();a.schema=a.schema||{};a.schema.qos_queuing_type_choice=["priority","rate-control","low-latency"];a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.gridQOS_WAN2LAN._tbl_ref=a.$eval(a.gridQOS_WAN2LAN.Options.data);a.gridQOS_WAN2LAN._tbl_orig=a.$eval(a.gridQOS_WAN2LAN.Options.data.replace("model[","model_orig["));a.gridQOS_WAN2LAN._del_ref=
a.$eval(a.gridQOS_WAN2LAN.Options.data.replace("model[","model_del["));a.gridQOS_WAN2LAN._del_ref.splice(0);delete a.model_del.interfaces;delete a.model_del.classifiers;a.gridQOS_WAN2LAN.edit=!1;a.gridQOS_WAN2LAN.Selections.splice(0);a.gridQOS_WAN2LAN.edit=!0;a.dataReady=!0;s(function(){a.gridQOS_WAN2LAN.Options.selectItem(0,!0)},50)})["catch"](function(a){Log(ERROR,"=="+a)})};l();var h=function(){a.model["ciscosb-qos"]||angular.extend(a.model,{"ciscosb-qos":{"queue-model":"priority","policer-enable":!1,
"policer-policies":{"policer-policy":[]}}});a.model["ciscosb-qos"]&&!a.model["ciscosb-qos"]["policer-policies"]&&angular.extend(a.model["ciscosb-qos"],{"policer-policies":{"policer-policy":[]}});angular.forEach(a.model["ciscosb-qos"]["policer-policies"]["policer-policy"],function(a,b){a.policer||(a.policer={"class":[]})})},p=function(a,b,e){return a.name.match(/^Default$/)?!1:!0};a.collect_classifiers=function(){return t("filter")(a.model.classifiers.classifier,p)};a.selectionRefExists=function(){var b;
angular.forEach(a.gridQOS_WAN2LAN.Selections,function(a,e){a._ctx&&0<a._ctx.ref.length&&(b=!0)});return b};a.findInboundWAN=function(b,e){var h=[];a.ctx=a.ctx||{};angular.forEach(a.model.interfaces["interface"],function(a,c){a["ciscosb-qos"]&&a["ciscosb-qos"]["qos-policy"].inbound["rate-control"]==b&&h.push(a.name);e&&e.entity&&(e.entity._ctx={ref:h})});e&&(e.ctx=e.ctx||{},e.ctx.arrWAN=h);return h};a.gen_class_id_seq=function(a){var b=[0,1,2,3,4,5,6,7],e=[],d=b.length;if(a)for(var c=a.length;c--;)if(a[c]){var k=
parseInt(a[c].id-1,10);e[k]=b.splice(c,1)[0]}for(c=d;c--;)null==e[c]&&(e[c]=b.pop());return e};a.renew_array_class=function(a,b,e){var d=b[e].match;angular.forEach(b,function(a,b){b!=e&&a.match==d&&(a.match="")})};a.update_class_id=function(a,b){var e=angular.copy(b),d;for(d in b)"id"!=d&&delete b[d];b.id=a+1;angular.extend(b,e)};a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridQOS_WAN2LAN=a.gridQOS_WAN2LAN||{};a.gridQOS_WAN2LAN.totalServerItems=0;a.gridQOS_WAN2LAN.Selections=[];a.gridQOS_WAN2LAN.Options=
{data:"model['ciscosb-qos']['policer-policies']['policer-policy']",enableColumnResize:!0,enableRowSelection:!0,keepLastSelected:!1,multiSelect:!1,selectedItems:a.gridQOS_WAN2LAN.Selections,showSelectionCheckbox:!0,enableSorting:!1,enableHighlighting:!0,selectWithCheckboxOnly:!1,totalServerItems:"gridQOS_WAN2LAN.totalServerItems",enableCellEditOnFocus:!1,checkboxHeaderTemplate:v.get("T_checkboxHeader.html"),columnDefs:[{field:"name",displayName:a.DICT("WAN_Queuing_Name")},{field:"description",displayName:a.DICT("WAN_Queuing_Description")},
{field:"name",displayName:a.DICT("WAN_Queuing_Applied_To"),cellTemplate:v.get("T_applied_to.htm")}]};a.gridQOS_WAN2LAN.add_empty_cb=function(a){var b={name:"Untitle",description:"Description","class":[]};a.push(b);return b};a.gridQOS_WAN2LAN.post_remove_cb=function(b){var e=a.gridQOS_WAN2LAN._del_ref;b=e.indexOf(b);for(var h in e[b])"name"!=h&&delete e[b][h]};a.save=function(){var b=function(a,b,c){void 0===c&&(c=!0);a=angular.copy(a);angular.forEach(a,function(a,c){void 0!=a._ctx&&delete a._ctx;
b&&b(a,c)});return a}(a.model["ciscosb-qos"]["policer-policies"]["policer-policy"],function(a,b){if(a.policer&&a.policer["class"])for(var c=a.policer["class"],e=0;e<c.length;e++){var g=c[e];if(null==g.match||void 0==g.match)g.match="",Log(DEBUG,"priority "+JSON.stringify(g.match))}});angular.copy(a.model_del["ciscosb-qos"]["policer-policies"]["policer-policy"]);var e=function(){n.post({url:resource_base+"data/qos_policing.json",method:"set_qos_policing",params:{"ciscosb-qos":{"policer-enable":a.model["ciscosb-qos"]["policer-enable"],
"policer-policies":{"policer-policy":b}}},success:function(b){a.success=!0;l()},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})};(function(){n.post({url:resource_base+"data/qos_policing.json",method:"del_qos_policing",params:{"ciscosb-qos":{"policer-policies":{"policer-policy":[]}}},success:function(a){e()},error:function(a){e();Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})})();a.resetModified()};a.cancel=function(){l();a.resetModified()}}]);app.controller("switchQueuingCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,s,n){a.success=!1;a.dataReady=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var v=function(){a.LANStyle={height:20,"margin-bottom":0};a.LAGStyle={height:20,"margin-bottom":0};b.post({url:resource_base+"data/wan_setting1.json",method:"get_qos_switch_classification",success:function(b){b.data&&b.data.result?t(b.data.result):t();a.dataReady=!0},error:function(a){t()}})},
t=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var q,e,n,l,h=[];a.model.lags=[];a.model.lans=[];angular.forEach(b,function(b,u){if(-1===b.name.indexOf("WAN")){if(-1!==b.name.indexOf("LAN")&&(q=parseInt(b.name.replace("LAN",""),10),isNaN(q))||-1!==b.name.indexOf("LAG")&&(q=parseInt(b.name.replace("LAG",""),10),isNaN(q)))return;e=b["ciscosb-switch-qos"]||{};n=e["queue-weight"]&&e["queue-weight"].queue||[];l={th:q,name:b.name,lag_ref:b["lag-ref"]||b.name,send_to_queue:b["send-to-queue"]||
1,edit:!0,weight1:1,weight2:2,weight3:4,weight4:8};angular.forEach(n,function(a,b){5>a.id&&0<a.id&&(l["weight"+a.id]=a.weight)});-1!==b.name.indexOf("LAN")&&(-1!==l.lag_ref.indexOf("LAG")&&(h.push(l.lag_ref),l.edit=!1),a.LANStyle.height+=app.ngGrid.rowHeight,a.model.lans[q-1]=l);-1!==b.name.indexOf("LAG")&&(a.LAGStyle.height+=app.ngGrid.rowHeight,a.model.lags[q-1]=l)}});angular.forEach(a.model.lags,function(a){a.edit=!1;angular.forEach(h,function(b){a.name===b&&(a.edit=!0)})});a.gridLanOptions.data=
a.model.lans;a.gridLagOptions.data=a.model.lags};a.model={lans:[],lags:[]};a.LANStyle={height:20,"margin-bottom":0};a.LAGStyle={height:20,"margin-bottom":0};a.LANChkInvalid=!1;a.LAGChkInvalid=!1;a.lanErrorMsg="";a.lagErrorMsg="";a.gridLanOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"th",displayName:a.DICT("Switch_Queuing_LAN_Port"),width:100},{field:"weight1",displayName:a.DICT("Switch_Queuing_Queue1_Weight"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,
max:100,required:!0},{field:"weight2",displayName:a.DICT("Switch_Queuing_Queue2_Weight"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0},{field:"weight3",displayName:a.DICT("Switch_Queuing_Queue3_Weight"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0},{field:"weight4",displayName:a.DICT("Switch_Queuing_Queue4_Weight"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0}]});
a.gridLagOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"th",displayName:a.DICT("Switch_Queuing_LAG_Port"),width:100},{field:"weight1",displayName:a.DICT("Switch_Queuing_Queue1_Weight_G"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0},{field:"weight2",displayName:a.DICT("Switch_Queuing_Queue2_Weight_G"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0},{field:"weight3",displayName:a.DICT("Switch_Queuing_Queue3_Weight_G"),
editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0},{field:"weight4",displayName:a.DICT("Switch_Queuing_Queue4_Weight_G"),editRow:"edit",cellTemplate:"switch_queuing_inline_number_edit.html",min:0,max:100,required:!0}]});a.funs={checkWeight:function(){a.lanErrorMsg="";a.LANChkInvalid=!1;angular.forEach(a.model.lans,function(b,q){var e;e=0+(0==b.weight1?1:0);e+=0==b.weight2?1:0;e+=0==b.weight3?1:0;e+=0==b.weight4?1:0;1<e&&(a.lanErrorMsg=a.DICT("Switch_Queuing_LAN_Error"),
a.LANChkInvalid=!0)});a.lagErrorMsg="";a.LAGChkInvalid=!1;angular.forEach(a.model.lags,function(b,q){var e;e=0+(0==b.weight1?1:0);e+=0==b.weight2?1:0;e+=0==b.weight3?1:0;e+=0==b.weight4?1:0;1<e&&(a.lagErrorMsg=a.DICT("Switch_Queuing_LAG_Error"),a.LAGChkInvalid=!0)})},save:function(){var m={interfaces:{"interface":[]}};angular.forEach(a.model.lans,function(a,b){m.interfaces["interface"].push({name:a.name,"ciscosb-switch-qos":{"queue-weight":{queue:[{id:1,weight:a.weight1},{id:2,weight:a.weight2},{id:3,
weight:a.weight3},{id:4,weight:a.weight4}]}}})});angular.forEach(a.model.lags,function(a,b){m.interfaces["interface"].push({name:a.name,"ciscosb-switch-qos":{"queue-weight":{queue:[{id:1,weight:a.weight1},{id:2,weight:a.weight2},{id:3,weight:a.weight3},{id:4,weight:a.weight4}]}}})});b.post({method:"set_qos_switch_classification",params:m,success:function(b){a.success=!0;v()},error:function(a){v()}});a.resetModified()},cancel:function(){v();a.resetModified()},restore:function(){angular.forEach(a.model.lans,
function(a,b){a.weight1=1;a.weight2=2;a.weight3=4;a.weight4=8});angular.forEach(a.model.lags,function(a,b){a.weight1=1;a.weight2=2;a.weight3=4;a.weight4=8});a.LANChkInvalid=!1;a.LAGChkInvalid=!1;a.modified()}};v()}]);app.controller("qos_queuing_main",["$scope","$q","MyHttp","GridRowBasedEditingAdv","$templateCache","$filter","wan_service","Sets","UserSession","userAccessRight",function(a,b,s,n,v,t,m,q,e,w){a.model=a.model||{};a.filterWANPHY={physical:!0,usb:!0};a.success=!1;a.dataReady=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();var l=function(){var e=s.post({url:resource_base+"data/qos_lan2wan.json",method:"get_qos_queuing",error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}}),d=s.post({url:resource_base+"data/interfaces_qos.json",method:"get_qos_wan_bandwidth",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),c=s.post({url:resource_base+"data/qos_class.json",method:"get_qos_class",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,d,c]).then(function(b){for(var c=0;c<b.length;c++)angular.extend(a.model,b[c].data.result);h();p();a.model_orig=angular.copy(a.model);
a.model_del=angular.copy(a.model);a.gridQOS_LAN2WAN._tbl_ref=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"];a.gridQOS_LAN2WAN._tbl_orig=a.model_orig["ciscosb-qos"]["queue-policies"]["queue-policy"];a.gridQOS_LAN2WAN._del_ref=a.model_del["ciscosb-qos"]["queue-policies"]["queue-policy"];a.gridQOS_LAN2WAN._del_ref.splice(0);delete a.model_del.interfaces;delete a.model_del.classifiers;a.gridQOS_LAN2WAN.edit=!1;a.gridQOS_LAN2WAN.Selections=[];a.gridQOS_LAN2WAN.operations=n;a.gridQOS_LAN2WAN.operations.init({rowState:a.selected.rowEditableState,
tbl_ref:a.gridQOS_LAN2WAN._tbl_ref,tbl_orig:a.gridQOS_LAN2WAN._tbl_orig,del_ref:a.gridQOS_LAN2WAN._del_ref,gridopt_ref:a.gridQOS_LAN2WAN.Options});a.refresh_grid_display_type(a.model["ciscosb-qos"]["queue-model"]);a.gridQOS_LAN2WAN.Options.data=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"];a.dataReady=!0})["catch"](function(a){console.log("=="+a)})},h=function(){a.model["ciscosb-qos"]||angular.extend(a.model,{"ciscosb-qos":{"queue-model":"priority","policer-enable":!1,"queue-policies":{"queue-policy":[]}}});
a.model["ciscosb-qos"]&&!a.model["ciscosb-qos"]["queue-policies"]&&angular.extend(a.model["ciscosb-qos"],{"queue-policies":{"queue-policy":[]}});angular.forEach(a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],function(a,b){a.queues||(a.queues={});a.radio=!1});var b=m.filter(a.model.interfaces["interface"],a.filterWANPHY);a.model.interfaces["interface"]=b;var d={"ciscosb-qos":{"qos-policy":{outbound:{priority:"Priority_Default","rate-control":"Rate_Control_Default","low-latency":"Low_Latency_Default"}}}};
angular.forEach(b,function(a,b){q.recover_object(a,d)})},p=function(){angular.forEach(a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],function(a,b){a.type="No data";angular.forEach(a.queues,function(b,d){switch(d){case "priority":case "low-latency":case "rate-control":a.type=d}})})};a.queuing_type_page_name=function(a){var b="";"priority"===a?b="Queuing-priority.htm":"rate-control"===a?b="Queuing-rate-control.htm":"low-latency"===a?b="Queuing-low-latency.htm":Log(ERROR,"queuing_type_page_name: unknown type - "+
a);return b};a.refresh_grid_display_type=function(b){a.gridQOS_LAN2WAN.Options.gridApi.core.notifyDataChange("all")};a.update_rule_choice_type=function(b){a.gridQOS_LAN2WAN.Selections=[];a.gridQOS_LAN2WAN.edit=!1;a.gridQOS_LAN2WAN.Options.gridApi.customApi.selectedRowRadio(-1);setTimeout(function(){a.refresh_grid_display_type(b);app.TOOLS.apply(a)},50)};a.selectionReservedName=function(){var b=a.gridQOS_LAN2WAN.Selections,d=!1;a.isDefaultRule=!1;angular.forEach(b,function(b,e){if(b.name.match(/^Priority_Default$/)||
b.name.match(/^Rate_Control_Default$/)||b.name.match(/^Low_Latency_Default$/))d=a.isDefaultRule=!0});return d};a.selectionRefExists=function(){var b;angular.forEach(a.gridQOS_LAN2WAN.Selections,function(a,c){a._ctx&&a._ctx.beUsed&&(b=!0)});return b};a.findOutboundWAN=function(b,d){var c=[];a.ctx=a.ctx||{};var e=a.model["ciscosb-qos"]["queue-model"];angular.forEach(a.model.interfaces["interface"],function(a,h){a["ciscosb-qos"]&&a["ciscosb-qos"]["qos-policy"].outbound[e]==b&&c.push(a.name);d&&d.entity&&
(d.entity._ctx={ref:c,beUsed:0!==c.length})});d&&(d.ctx=d.ctx||{},d.ctx.arrWAN=c);0===c.length&&c.push("--None--");return c};a.gen_rate_id_seq=function(a){var b=[0,1,2,3,4,5,6,7],c=[],e=b.length,g;if(a)for(g=a.length;g--;)if(a[g]){var h=parseInt(a[g].id-1,10);c[h]=b.splice(g,1)[0]}for(g=e;g--;)null==c[g]&&(c[g]=b.pop());return c};var u=function(a,b,c){return!0};a.collect_classifiers=function(){return t("filter")(a.model.classifiers.classifier,u)};a.check_minimum_maximum=function(b,d){var c=function(c){a.form.rate_form&&
(a.form.rate_form["RC_txt_minrate_"+b].$setValidity("minLargeThanMax",c),a.form.rate_form["RC_txt_maxrate_"+b].$setValidity("minLargeThanMax",c))};d["min-rate"]>d["max-rate"]?c(!1):c(!0)};a.update_rate_control_item=function(b,d,c){a.update_rate_control_id(b,d[c]);a.renew_array_class(b,d,c);a.update_min_rate_accu(b,d);a.check_minimum_maximum(b,d[c])};a.update_rate_control_id=function(b,d){var c=angular.copy(d),e;for(e in d)"id"!=e&&delete d[e];d.id=b+1;angular.extend(d,c);a.check_minimum_maximum(b,
d)};a.renew_array_class=function(a,b,c){var e=b[c].match;angular.forEach(b,function(a,b){b!=c&&a.match==e&&(a.match="")})};a.update_min_rate_accu=function(a,b){for(var c,e=0,g=0;6>=g;g++)c=b[g],e+=c["min-rate"];b[7]["min-rate"]=100-e};a.renew_objects_class=function(a,b){var c=a[b],e;for(e in a)e!=b&&a[e]==c&&(a[e]="")};a.update_ll_min_rate_accu=function(a){var b;b=0+a.queue1["min-rate"];b+=a.queue2["min-rate"];a.queue3["min-rate"]=100-b};a.renew_ll_class=function(a,b){var c=a[b].match,e;for(e in a)e!=
b&&a[e].match==c&&(a[e].match="")};a.filterRowsByType=function(b){var d=a.model["ciscosb-qos"]&&a.model["ciscosb-qos"]["queue-model"]||"priority",c=[];angular.forEach(b,function(a){a.entity.type===d&&c.push(a)});return c};a.selected=a.selected||{};a.selected.rowEditableState=[];a.gridQOS_LAN2WAN=a.gridQOS_LAN2WAN||{};a.gridQOS_LAN2WAN.Selections=[];a.gridQOS_LAN2WAN.procClick=function(b){var d=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"];a.gridQOS_LAN2WAN.Selections=[];d[b]&&a.gridQOS_LAN2WAN.Selections.push(d[b]);
a.selectionReservedName();app.TOOLS.apply(a)};a.gridQOS_LAN2WAN.Options=app.uiGrid.generateGridOptions({filterOptions:{filterText:"_NoTranslate_Type:^priority"},onRegisterApi:function(b){a.gridQOS_LAN2WAN.Options.gridApi.core.registerRowsProcessor(a.filterRowsByType,200)},columnDefs:[{field:"radio",isRadio:!0,changedCbk:a.gridQOS_LAN2WAN.procClick},{field:"name",displayName:a.DICT("WAN_Queuing_Policy_Name")},{field:"description",displayName:a.DICT("WAN_Queuing_Description")},{field:"type",displayName:"_NoTranslate_Type",
visible:!1},{field:"name",displayName:a.DICT("WAN_Queuing_Applied_To"),cellTemplate:v.get("UG_applied_to.htm")}]});a.gridQOS_LAN2WAN.editFun=function(){a.gridQOS_LAN2WAN.edit=!a.gridQOS_LAN2WAN.edit};var x=function(b){b=a.model["ciscosb-qos"]["queue-model"]||"priority";return{name:a.schema.namePrefix[b]+"Untitle",description:"Description",queues:{"rate-control":{queue:[{id:1,match:"","min-rate":20,"max-rate":50},{id:2,match:"","min-rate":20,"max-rate":50},{id:3,match:"","min-rate":20,"max-rate":50},
{id:4,match:"","min-rate":10,"max-rate":50},{id:5,match:"","min-rate":10,"max-rate":50},{id:6,match:"","min-rate":10,"max-rate":50},{id:7,match:"","min-rate":9,"max-rate":50},{id:8,match:"Default","min-rate":1,"max-rate":100}]},"low-latency":{priority:{match:"","max-rate":50},queue1:{match:"","min-rate":50},queue2:{match:"","min-rate":30},queue3:{match:"Default","min-rate":20}},priority:{highest:"",high:"",medium:"",low:"Default"}},type:b}};a.gridQOS_LAN2WAN.add=function(){var b=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],
d;d=x(a.model["ciscosb-qos"]["queue-model"]);50<b.length?(d=a.DICT("WAN_Queuing_Reach_Max_Entry",{"%d":50}),app.TOOLS.criticalAlertBox({msg:d,cbk:function(a){}})):(b.push(d),setTimeout(function(){a.gridQOS_LAN2WAN.Options.gridApi.customApi.selectedRowRadio(b.length-1);a.gridQOS_LAN2WAN.Options.gridApi.customApi.scrollToLast();a.gridQOS_LAN2WAN.Selections=[b[b.length-1]];a.gridQOS_LAN2WAN.edit=!0},50),a.modified())};a.gridQOS_LAN2WAN.remove=function(b){b=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"];
var d;for(d=b.length-1;0<=d;d--)console.log(b[d]),b[d].radio&&b.splice(d,1);a.gridQOS_LAN2WAN.edit=!1;a.gridQOS_LAN2WAN.Selections=[];a.gridQOS_LAN2WAN.Options.gridApi.customApi.selectedRowRadio(-1);a.modified()};a.save=function(){var b=a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],d=a.model_orig["ciscosb-qos"]["queue-policies"]["queue-policy"],c=function(b,c){if(b.queues&&b.queues["rate-control"]){var d=!0,g=[];angular.forEach(b.queues["rate-control"].queue,function(c,e){null==c&&g.push(e);
if(c&&null==c.match){var k;a:{k=a.gridQOS_LAN2WAN._del_ref;for(var h=k.length;h--;)if(k[h].name==b.name){k=h;break a}k=-1}-1==k?k=a.gridQOS_LAN2WAN._del_ref.push({name:b.name,queues:{"rate-control":{queue:[]}}})-1:d&&a.gridQOS_LAN2WAN._del_ref[k].queues["rate-control"].queue.splice(0);a.gridQOS_LAN2WAN._del_ref[k].queues["rate-control"].queue.push({id:c.id});d=!1;c.match="";g.push(e)}})}},e=function(a,b){var c=function(a,b){if(null==a[b]||void 0==a[b])a[b]=""};if(a.queues&&a.queues.priority){var d=
a.queues.priority;c(d,"highest");c(d,"high");c(d,"medium");c(d,"low")}},g=function(a,b,c){void 0===c&&(c=!0);a=angular.copy(a);angular.forEach(a,function(a,d){if(a.type&&a.queues){var g=a.type,e;for(e in a.queues)e!=g&&delete a.queues[e]}else c&&(a.type||alert("clean_web_metadata error, 'type' not exist"),a.queues||alert("clean_web_metadata error, 'queues' not exist"));void 0!=a.type&&delete a.type;void 0!=a._ctx&&delete a._ctx;delete a.radio;b&&b(a,d)});return a}(a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],
function(a,b){e(a,b);c(a,b);if(a.queues&&a.queues["low-latency"]){var d=a.queues["low-latency"];if(null==d.priority.match||""==d.priority.match)d.priority.match="";if(null==d.queue1.match||""==d.queue1.match)d.queue1.match="";if(null==d.queue2.match||""==d.queue2.match)d.queue2.match="";if(null==d.queue3.match||""==d.queue3.match)d.queue3.match=""}}),h=angular.copy(m.filter(a.model.interfaces["interface"],a.filterWANPHY)),p=[];angular.forEach(h,function(a,b){var c={},c={name:a.name};a["ciscosb-qos"]&&
a["ciscosb-qos"]["qos-policy"]&&(c["ciscosb-qos"]={"qos-policy":a["ciscosb-qos"]["qos-policy"]});p.push(c)});var A=function(){s.post({url:resource_base+"data/qos_lan2wan.json",method:"set_qos_queuing",params:{"ciscosb-qos":{"queue-model":a.model["ciscosb-qos"]["queue-model"],"queue-policies":{"queue-policy":g}},interfaces:{"interface":p}},success:function(b){a.success=!0;l()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})};(function(){var a=[],c;angular.forEach(d,
function(d){c=!1;angular.forEach(b,function(a){a.name===d.name&&(c=!0)});c||a.push({name:d.name})});a.length?s.post({url:resource_base+"data/qos_lan2wan.json",method:"del_qos_queuing",params:{"ciscosb-qos":{"queue-policies":{"queue-policy":a}}},success:function(a){A()},error:function(a){A();console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}):A()})();a.resetModified()};a.cancel=function(){l();a.resetModified()};a.combineNote=a.DICT("WAN_Bandwidth_Management_Go_To",{"%s":"<a ng-click=\"jumpToPage('QoS_WAN_Bandwidth')\">"+
a.DICT("WAN_Bandwidth_Management")+"</a>"});(function(){a.schema=a.schema||{};a.schema.namePrefix={priority:"Priority_","rate-control":"Rate_Control_","low-latency":"Low_Latency_"};a.schema.qos_queuing_type_choice=["priority","rate-control","low-latency"];a.schema.unmatchStr=a.DICT("WAN_Queuing_Unspecified");a.schema.strLUT={priority:a.DICT("WAN_Queuing_Priority"),"rate-control":a.DICT("WAN_Queuing_Rate_Control"),"low-latency":a.DICT("WAN_Queuing_Low_Latency"),queue1:a.DICT("WAN_Queuing_Queue1"),
queue2:a.DICT("WAN_Queuing_Queue2"),queue3:a.DICT("WAN_Queuing_Queue3"),highest:a.DICT("WAN_Queuing_Highest"),high:a.DICT("WAN_Queuing_High"),medium:a.DICT("WAN_Queuing_Medium"),low:a.DICT("WAN_Queuing_Low")};a.schema.dispStr=function(b){return a.schema.strLUT[b]}})();l()}]);app.controller("switchClassificationCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,s,n){var v=void 0;a.success=!1;a.loadReady=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var t=[{id:1,displayName:1},{id:2,displayName:2},{id:3,displayName:3},{id:4,displayName:4}],m=function(){b.post({url:resource_base+"data/switch_qos.json",method:"get_qos_switch_classification",success:function(b){b.data&&b.data.result?(e(b.data.result),q(b.data.result)):
(console.log("switchClassificationCtrl getQosData response is undefined"),e(),q());a.lagStyle=app.uiGrid.computeHeight(void 0==a.model.lag?0:a.model.lag.length);a.loadReady=!0},error:function(a){console.log("switchClassificationCtrl getQosData error, status "+a.status);e();q()}})},q=function(b){b||(b={});var e=b["switch-qos-policy"]||{};b=e["dscp-mapping"]||[];var h=e["cos-mapping"]||[],e=e.model||"port",r,d,c,k;a.model.cos=[];a.model.dscp=[];a.model.qos_model=e;w();l();angular.forEach(b,function(b,
e){r=parseInt(b.dscp,10);d=parseInt(b.queue,10);isNaN(r)?console.log("switchClassificationCtrl process DSCP item "+e+"th has error Item: "+JSON.stringify(b)):63<r||0>r?console.log("switchClassificationCtrl process DSCP item "+e+'th has error dscp: "'+r+'", range (0 ~ 64)'):4<d||1>d?console.log("switchClassificationCtrl process DSCP itme "+e+'th has error queue: "'+d+'", range (1 ~ 4)'):(c=r%16,k=(r-c)/16,a.model.dscp[c].list[k].queue.select=d,b["dscp-name"]&&(a.model.dscp[c].list[k].name=r+" - "+
b["dscp-name"]))});angular.forEach(h,function(b,c){r=parseInt(b.cos,10);d=parseInt(b.queue,10);isNaN(r)?console.log("switchClassificationCtrl process COS item "+c+"th has error Item: "+JSON.stringify(b)):7<r||0>r?console.log("switchClassificationCtrl process COS item "+c+'th has error cos: "'+r+'", range (0 ~ 7)'):4<d||1>d?console.log("switchClassificationCtrl process COS itme "+c+'th has error queue: "'+d+'", range (1 ~ 4)'):(a.model.cos[r].queue.select=d,b["cos-name"]&&(a.model.cos[r].name=b["cos-name"]))});
a.gridCosOptions.data=a.model.cos;a.gridDSCPOptions.data=a.model.dscp;a.dataReady.qos=!0},e=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var e,h,l,d=[],c=!1;a.lanStyle={height:20};a.lagStyle={height:20};a.model.lan=[];a.model.lag=[];angular.forEach(b,function(b,g){l=!0;if(-1===b.name.indexOf("VLAN"))if(e=b["ciscosb-switch-qos"]&&b["ciscosb-switch-qos"]["send-to-queue"]||1,e=parseInt(e,10),isNaN(e))console.log("switchClassificationCtrl proc interface "+b.name+" has error, queue is NaN");
else if(4<e||1>e)console.log("switchClassificationCtrl proc interface "+b.name+' has error queue: "'+e+'", range (1 ~ 4)');else{if(-1!==b.name.indexOf("LAN")){h=parseInt(b.name.replace("LAN",""),10);if(isNaN(h)){console.log("switchClassificationCtrl proc LAN "+b.name+" port number is NaN");return}b["lag-ref"]&&b["lag-ref"].match(/^LAG\d+$/)&&(l=!1,d.push(b["lag-ref"]),c=!0);a.lanStyle.height+=app.uiGrid.rowHeight;a.model.lan[h-1]={name:b.name,th:h,empty:"",edit:l,disabled:c,queue:{select:e,list:t}}}-1!==
b.name.indexOf("LAG")&&(h=parseInt(b.name.replace("LAG",""),10),isNaN(h)?console.log("switchClassificationCtrl proc LAG "+b.name+" port number is NaN"):(a.lagStyle.height+=app.uiGrid.rowHeight,a.model.lag[h-1]={name:b.name,th:h,empty:"",edit:!1,queue:{select:e,list:t}}))}});angular.forEach(a.model.lag,function(a){angular.forEach(d,function(b){a.name===b&&(a.edit=!0)})});a.gridLanPortOptions.data=a.model.lan;a.gridLagPortOptions.data=a.model.lag;a.dataReady.intf=!0},w=function(){var b,e,h;for(b=0;64>
b;b++)e=b%16,h=(b-e)/16,a.model.dscp[e]||(a.model.dscp[e]={edit:!0,list:{}}),a.model.dscp[e].list[h]||(a.model.dscp[e].list[h]={dscp:b,name:b,queue:{select:0,list:t}}),a.model.dscp[e].list[h].queue.select=16>b?1:16<=b&&24>b?2:24<=b&&40>b?3:40<=b&&48>b?4:3},l=function(){var b;for(b=0;8>b;b++)switch(a.model.cos[b]||(a.model.cos[b]={cos:b,name:b,edit:!0,queue:{select:0,list:t}}),b){case 0:case 1:a.model.cos[b].queue.select=1;break;case 2:a.model.cos[b].queue.select=2;break;case 3:case 4:a.model.cos[b].queue.select=
3;break;default:a.model.cos[b].queue.select=4}},h=function(){a.model.resize_event=!0;setTimeout(function(){a.model.resize_event=!1;app.TOOLS.apply(a)},10)};a.model={resize_event:!1,qos_model:"port",lan:[],lag:[],cos:[],dscp:[]};a.dataReady={qos:!1,intf:!1};a.gridLanPortOptions=app.uiGrid.generateGridOptions({enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,maxRowsToShow:16,columnDefs:[{field:"th",displayName:a.DICT("Switch_Classification_LAN_Port"),minWidth:100},{field:"queue",displayName:a.DICT("Switch_Classification_Queue"),
minWidth:80,disabled:"disabled",editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"empty",isEmpty:!0,displayName:""}]});a.lagStyle={};a.gridLagPortOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"th",displayName:a.DICT("Switch_Classification_LAG_Port"),minWidth:100},{field:"queue",displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"empty",isEmpty:!0,displayName:""}]});
a.gridDSCPOptions=app.uiGrid.generateGridOptions({minRowsToShow:16,enableHorizontalScrollbar:app.uiGrid.scrollbars.NEVER,enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,columnDefs:[{field:"list[0].name",displayName:a.DICT("Switch_Classification_DSCP"),minWidth:120},{field:"list[0].queue",displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"list[1].name",displayName:a.DICT("Switch_Classification_DSCP"),minWidth:120},
{field:"list[1].queue",displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"list[2].name",displayName:a.DICT("Switch_Classification_DSCP"),minWidth:120},{field:"list[2].queue",displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"list[3].name",displayName:a.DICT("Switch_Classification_DSCP"),minWidth:120},{field:"list[3].queue",
displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"}]});a.gridCosOptions=app.uiGrid.generateGridOptions({enableHorizontalScrollbar:app.uiGrid.scrollbars.NEVER,columnDefs:[{field:"cos",displayName:a.DICT("Switch_Classification_CoS"),minWidth:100},{field:"name",displayName:a.DICT("Switch_Classification_Description")},{field:"queue",displayName:a.DICT("Switch_Classification_Queue"),minWidth:90,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html"}]});
a.funs={save:function(){var e={"switch-qos-policy":{model:a.model.qos_model,"dscp-mapping":[],"cos-mapping":[]}},h={interfaces:{"interface":[]}};angular.forEach(a.model.lan,function(a,b){h.interfaces["interface"].push({name:a.name,"ciscosb-switch-qos":{"send-to-queue":a.queue.select}})});angular.forEach(a.model.lag,function(a,b){h.interfaces["interface"].push({name:a.name,"ciscosb-switch-qos":{"send-to-queue":a.queue.select}})});angular.forEach(a.model.cos,function(a,b){e["switch-qos-policy"]["cos-mapping"][a.cos]=
{cos:a.cos,queue:a.queue.select}});angular.forEach(a.model.dscp,function(a,b){angular.forEach(a.list,function(a,b){e["switch-qos-policy"]["dscp-mapping"][a.dscp]={dscp:a.dscp,queue:a.queue.select}})});angular.extend(e,h);b.post({method:"set_qos_switch_classification",params:e,success:function(b){a.success=!0;m()},error:function(a){m()}});a.resetModified()},cancel:function(){m();a.resetModified()},restore_def:function(){w();a.modified()}};a.lanStyle={height:20};a.lagStyle={height:20};v=a.$watch(function(){return window.innerWidth},
function(){h()});a.$on("$destroy",function(){v&&v()});m()}]);app.controller("trafficClassesCtrl",["$scope","MyHttp","wan_service","meta_data_service","$q","$templateCache","UserSession","userAccessRight","device_os_type",function(a,b,s,n,v,t,m,q,e){a.success=!1;a.dataReady=!1;var w=a.gridFuns.getSelectDisplayNameFromList;a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var l=function(){return b.post({url:resource_base+"data/traffic_classes.json",method:"get_qos_class",error:function(a){console.log("Traffic Classes: get_qos_class error : "+
status);h()}})},h=function(b){b||(b={});b=(b.classifiers||{}).classifier||[];a.model.classes=[];angular.forEach(b,function(b,c){a.model.classes.push(p(b))});a.gridTrafficClassesOptions.data=a.model.classes},p=function(b){b||(b={});var c,d,g;c=b.rule||[];d=[];angular.forEach(c,function(b,c){g=u(b);a.prepareApp(g);d.push(g)});return{edit:!1,radio:!1,name:b.name||"",description:b.description||"",rule:d,in_use:!1,displayInUse:a.DICT("Traffic_Classes_No")}},u=function(b){b||(b={});var c=b.address||{},
d=b.service||{},g=b.application||{},e=b.dscp||{},k,h;b={name:b.name||"",invalidName:!1,checked:!1,edit:!1,disableCheckbox:!1,receive_intf:{select:b["receive-interface"]||a.model.ifs&&a.model.ifs[0]&&a.model.ifs[0].id||"",list:a.model.ifs},version:{select:b["ip-version"]||a.schema.version[0].id,list:a.schema.version},device_type:{select:b["device-type"]||a.model.devicetypes[0]&&a.model.devicetypes[0].id||"",list:a.model.devicetypes,disabled:!1},os_type:{select:b["os-type"]||"",list:[],disabled:!1},
address:{src:{ipv4:{ip:"0.0.0.0",mask:"0.0.0.0",desc_ip:"0.0.0.0 for any",desc_mask:"0.0.0.0 for any"},ipv6:{ip:"0::",mask:0,desc_ip:"0:: for any",desc_mask:"0 for any"}},dest:{ipv4:{ip:"0.0.0.0",mask:"0.0.0.0",desc_ip:"0.0.0.0 for any",desc_mask:"0.0.0.0 for any"},ipv6:{ip:"0::",mask:0,desc_ip:"0:: for any",desc_mask:"0 for any"}}},service_app:{type:"service",str:"",service_select:a.model.services[0]&&a.model.services[0].id||"",service_list:a.model.services,app_category:"any",app_name:"any",app_behaviour:"any",
apps:[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}],behaviours:[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}],start_port:"",end_port:"",start_port_any:1,end_port_any:65535},dscp:{match:{select:void 0!==e.match?e.match:a.model.dscp_match[0]&&a.model.dscp_match[0].id||"",list:a.model.dscp_match},set:{select:void 0!==e.set?e.set:a.model.dscp_set[0]&&a.model.dscp_set[0].id||"",list:a.model.dscp_set}}};b.os_type.list=a.model.ostypes[b.device_type.select]||[];b.os_type.select||(b.os_type.select=
b.os_type.list[0]&&b.os_type.list[0].id||"");c["ipv4-source"]&&(e=0===c["ipv4-source"]["prefix-length"]?"0.0.0.0":void 0!==c["ipv4-source"]["prefix-length"]?app.TOOLS.netmask.int2Inet(parseInt(c["ipv4-source"]["prefix-length"],10)):c["ipv4-source"].netmask||"",b.address.src.ipv4.ip=c["ipv4-source"].ip||"",b.address.src.ipv4.mask=e);c["ipv4-destination"]&&(e=0===c["ipv4-destination"]["prefix-length"]?"0.0.0.0":void 0!==c["ipv4-destination"]["prefix-length"]?app.TOOLS.netmask.int2Inet(parseInt(c["ipv4-destination"]["prefix-length"],
10)):c["ipv4-destination"].netmask||"",b.address.dest.ipv4.ip=c["ipv4-destination"].ip||"",b.address.dest.ipv4.mask=e);c["ipv6-source"]&&(b.address.src.ipv6.ip="::"===c["ipv6-source"].ip?"0::":c["ipv6-source"].ip||"",b.address.src.ipv6.mask=parseInt(c["ipv6-source"]["prefix-length"],10));c["ipv6-destination"]&&(b.address.dest.ipv6.ip="::"===c["ipv6-destination"].ip?"0::":c["ipv6-destination"].ip||"",b.address.dest.ipv6.mask=parseInt(c["ipv6-destination"]["prefix-length"],10));g.category&&(g.name&&
g.behaviour)&&(b.service_app.type="application",b.service_app.app_category=g.category,b.service_app.app_name=g.name,b.service_app.app_behaviour=g.behaviour);d["service-ref"]&&(b.service_app.service_select=d["service-ref"],b.service_app.type="service");d["port-range"]&&void 0!==d["port-range"].start&&(k=d["port-range"].start,b.service_app.start_port=k);d["port-range"]&&void 0!==d["port-range"].end&&(h=d["port-range"].end,b.service_app.end_port=h);if(d.protocol){switch(d.protocol){case "UDP":b.service_app.service_select=
1===k&&65535===h?"$udpAny":"$udp";break;case "TCP":b.service_app.service_select=1===k&&65535===h?"$tcpAny":"$tcp";break;default:console.log("trafficClassesCtrl procTrafficData protocol not support : "+d.protocol)}b.service_app.type="service"}return b},x=function(){return b.post({url:resource_base+"data/avc_meta_data.json",method:"get_avc",error:function(a){console.log("appControllerCtrl getAVCMetaData error "+a.status);r()}})},r=function(b){b&&b["avc-meta-data"]&&(b=n.generate(b["avc-meta-data"]),
a.model.meta={},angular.forEach(b,function(b){angular.forEach(b.categories,function(b,c){a.model.meta[c]=b})}),a.prepareCategory())},d=function(){return b.post({url:resource_base+"data/application_controller.json",method:"get_app_control",error:function(a){console.log("appControllerCtrl getAVCData error "+a.status);c()}})},c=function(b){b||(b={});b=b.avc||{};a.avcAvailable=!1;b.enable&&(a.avcAvailable=!0)},k=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",
error:function(a){console.log("trafficClassesCtrl getInterfaceData Error : "+a.status)}})},g=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var c=[],d=[],g=[{id:"any",displayName:a.DICT("Traffic_Classes_Any_VLAN")}];a.model.ifs=[];var e=s.filter(b,{physical:!0,subinterface:!0,usb:!0});angular.forEach(e,function(a){c.push({id:a.name,displayName:a.name})});angular.forEach(b,function(a,b){a.name.match(/^VLAN.*\d+$/)&&d.push({id:a.name,displayName:a.name})});a.model.ifs=g.concat(c).concat(d)},
z=function(){return b.post({url:resource_base+"data/service_management.json",method:"get_services",error:function(a){console.log("trafficClassesCtrl getServiceData error: "+a.status);y()}})},y=function(b){b||(b={});var c=[];b.services&&b.services.service&&(c=b.services.service);a.model.services=[{id:"$tcp",displayName:a.DICT("Traffic_Classes_TCP")},{id:"$tcpAny",displayName:a.DICT("Traffic_Classes_TCPAny")},{id:"$udp",displayName:a.DICT("Traffic_Classes_UDP")},{id:"$udpAny",displayName:a.DICT("Traffic_Classes_UDPAny")}];
angular.forEach(c,function(b,c){a.model.services.push({id:b.name,displayName:b.name})});a.model.services.sort(function(a,b){return a.displayName>b.displayName?1:-1})},A=function(){return b.post({url:resource_base+"data/switch_qos.json",method:"get_qos_switch_classification",error:function(a){console.log("trafficClassesCtrl getSwitchQosData error: "+a.status);B()}})},B=function(b){b||(b={});var c=[],d=[];b["switch-qos-policy"]&&b["switch-qos-policy"]["dscp-mapping"]&&(c=b["switch-qos-policy"]["dscp-mapping"]);
a.model.dscp_match=[];a.model.dscp_set=[];angular.forEach(c,function(a){d.push({id:a.dscp,displayName:a["dscp-name"]&&a.dscp+"("+a["dscp-name"]+")"||a.dscp})});a.model.dscp_match=[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}].concat(d);a.model.dscp_set=[{id:"none",displayName:a.DICT("Traffic_Classes_None")}].concat(d)},C=function(){return b.post({url:resource_base+"data/traffic_class_in_use.json",method:"get_classifiers_inuse",error:function(a){D()}})},D=function(b){b||(b={});angular.forEach(b,
function(b,c){angular.forEach(a.model.classes,function(b){c===b.name&&(b.in_use=!0,b.displayInUse=a.DICT("Traffic_Classes_Yes"))})})},E=function(){v.all([k(),l(),C()]).then(function(b){g(b[0].data&&b[0].data.result||{});h(b[1].data&&b[1].data.result||{});D(b[2].data&&b[2].data.result||{});a.resetModified()})};a.relativeWebPage={main:"traffic_classes_main.htm",edit:"traffic_classes_edit.htm"};var I=function(b){switch(b){case "main":a.currPage="main";break;case "edit":a.gridTrafficServiceOptions.data=
a.edit.rule,a.currPage="edit"}};a.currPage="main";a.edit={services:[],rule:[],version:{}};a.classIndex=-1;a.avcAvailable=!1;a.ui_data={selected_rules:[]};a.model={meta:{},categories:[],devicetypes:[],dscp_match:[],dscp_set:[],schema:{},classes:[],dels:[],services:[],ostypes:[]};a.chk_device_os=function(b){if(b){var c=b.entity,d=!0;c.os_type.list=a.model.ostypes[c.device_type.select]||[];angular.forEach(c.os_type.list,function(a){a===c.os_type.select&&(d=!1)});d&&(c.os_type.select=c.os_type.list[0]&&
c.os_type.list[0].id||"")}};var F=function(b){a.ui_data.selected_rules=[];angular.forEach(a.edit.rule,function(b){b.checked&&a.ui_data.selected_rules.push(b)})};a.gridTrafficClassesOptions=app.uiGrid.generateGridOptions({data:a.model.classes,columnDefs:[{field:"radio",changedCbk:function(b){a.classIndex=b},isRadio:!0},{field:"name",displayName:a.DICT("Traffic_Classes_Class_Name")},{field:"description",displayName:a.DICT("Traffic_Classes_Description")},{field:"in_use",displayName:a.DICT("Traffic_Classes_In_Use"),
cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});a.gridTrafficServiceOptions=app.uiGrid.generateGridOptions({rowHeight:2*app.uiGrid.rowHeight,enableHorizontalScrollbar:!0,columnDefs:[{field:"checked",changedCbk:F,headerChangedCbk:F,disableChkBoxField:"disableCheckbox",isCheckbox:!0},{field:"name",displayName:a.DICT("Traffic_Classes_Service_Name"),editRow:"edit",editTextHeight:18,required:!0,width:115,invalidField:"invalidName",change:function(){var b=a.edit.rule;angular.forEach(b,function(a){a.invalidName=
!1});for(i=0;i<b.length;i++)for(j=i+1;j<b.length;j++)b[i].name===b[j].name&&(b[i].invalidName=!0,b[j].invalidName=!0)},cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'maxlength="64" ng-uci-name="row.entity.edit === true"')},{field:"receive_intf",displayName:a.DICT("Traffic_Classes_Receive_Interface"),editRow:"edit",width:140,id:"interface",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"version",displayName:a.DICT("Traffic_Classes_IP_Version"),
editRow:"edit",width:100,id:"ip_version",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"address.src",displayName:a.DICT("Traffic_Classes_Source_IP"),editRow:"edit",minWidth:120,cellTemplate:"traffic_classes_service_ip_mask.html"},{field:"address.dest",displayName:a.DICT("Traffic_Classes_Destination_IP"),editRow:"edit",minWidth:120,cellTemplate:"traffic_classes_service_ip_mask.html"},{field:"service_app",displayName:a.DICT("Traffic_Classes_Service_Application"),editRow:"edit",changed:function(b){b&&
b.entity&&(b=b.entity,a.avcAvailable&&("service"===b.service_app.type?(b.os_type.disabled=!0,b.device_type.disabled=!0):(b.os_type.disabled=!1,b.device_type.disabled=!1)))},width:260,cellTemplate:"traffic_classes_service_service_app.html"},{field:"device_type",displayName:a.DICT("Traffic_Classes_Device_Type"),editRow:"edit",width:110,change:a.chk_device_os,id:"device",cellTemplate:t.get("UG_table_text_with_inline_select_edit.html")},{field:"os_type",displayName:a.DICT("Traffic_Classes_OS_Type"),editRow:"edit",
width:110,id:"os",cellTemplate:t.get("UG_table_text_with_inline_select_edit.html")},{field:"dscp.match",displayName:a.DICT("Traffic_Classes_Match_DSCP"),width:115,editRow:"edit",id:"dscp_match",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"dscp.set",displayName:a.DICT("Traffic_Classes_Rewrite_DSCP"),width:120,editRow:"edit",id:"dscp_set",cellTemplate:"UG_table_text_with_inline_select_edit.html"}]});var H=function(){G(-1);E();I("main")};a.getServiceStyle=function(a){var b={};switch(a){case "$udp":case "$tcp":b=
{width:"65px"};break;case "$udpAny":case "$tcpAny":b={width:"85px"};break;default:b={width:"212px"}}return b};a.prepareCategory=function(){a.model.categories=[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}];angular.forEach(a.model.meta,function(b){a.model.categories.push({id:b.id,displayName:b.name})});a.model.categories.sort(function(a,b){return a.displayName>b.displayName?1:-1})};a.prepareApp=function(b){var c=b.service_app.app_category,d=b.service_app.app_name,g=a.model.meta[c];b.service_app.apps=
[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}];"any"===c||!g?b.service_app.app_name="any":(g.applications[d]||(b.service_app.app_name="any"),angular.forEach(g.applications,function(a){b.service_app.apps.push({id:a.id,displayName:a.name})}),b.service_app.apps.sort(function(a,b){return a.displayName>b.displayName?1:-1}));a.prepareBehavior(b)};a.prepareBehavior=function(b){var c=b.service_app.app_category,d=b.service_app.app_name,g=b.service_app.app_behaviour,e=a.model.meta;b.service_app.behaviours=
[{id:"any",displayName:a.DICT("Traffic_Classes_Any")}];"any"===c||"any"===d||!e[c]||!e[c].applications[d]?b.service_app.app_behaviour="any":(e[c].applications[d].behaviors[g]||(b.service_app.app_behaviour="any"),angular.forEach(e[c].applications[d].behaviors,function(a){b.service_app.behaviours.push({id:a.id,displayName:a.name})}),b.service_app.behaviours.sort(function(a,b){return a.displayName>b.displayName?1:-1}))};a.updateRuleString=function(){a.edit&&angular.forEach(a.edit.rule,function(b){if("service"===
b.service_app.type)switch(b.service_app.str=w(b.service_app.service_select,b.service_app.service_list),b.service_app.service_select){case "$tcp":case "$udp":b.service_app.str=b.service_app.str+"("+b.service_app.start_port+"-"+b.service_app.end_port+")";break;case "$tcpAny":case "$udpAny":b.service_app.str=b.service_app.str+"("+b.service_app.start_port_any+"-"+b.service_app.end_port_any+")"}else b.service_app.str=w(b.service_app.app_category,a.model.categories)+" > "+w(b.service_app.app_name,b.service_app.apps)+
" > "+w(b.service_app.app_behaviour,b.service_app.behaviours)})};var G=function(b){a.classIndex=b;a.gridTrafficClassesOptions&&a.gridTrafficClassesOptions.$gridScope&&(a.gridTrafficClassesOptions.$gridScope.columns[0].radioSelect=b)},J=function(){return 21<=a.model.classes.length?(a.msg=a.DICT("Traffic_Classes_Msg")+a.model.classes.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.funs={addClass:function(){J()||(a.edit=p(),a.edit.editType="create",a.edit.editIndex=-1,
a.updateRuleString(),I("edit"),a.modified())},delClass:function(){a.model.dels.push(a.model.classes[a.classIndex]);a.model.classes.splice(a.classIndex,1);a.classIndex>=a.model.classes.length&&G(-1);a.modified()},editClass:function(){a.edit=angular.copy(a.model.classes[a.classIndex]);a.edit.editType="edit";a.edit.editIndex=a.classIndex;a.updateRuleString();I("edit")},addRule:function(){var b=u();a.chk_device_os({entity:b});b.edit=!0;b.checked=!0;b.os_type.disabled=!a.avcAvailable||"service"===b.service_app.type;
b.device_type.disabled=!a.avcAvailable||"service"===b.service_app.type;a.gridTrafficServiceOptions.data.push(b);F();setTimeout(function(){a.gridTrafficServiceOptions.gridApi.customApi.scrollToLast()},100);a.modified()},delRule:function(){var b=a.edit.rule,c;for(c=b.length-1;0<=c;c--)b[c].checked&&a.edit.rule.splice(c,1);a.ui_data.selected_rules=[];a.modified()},editRule:function(){angular.forEach(a.edit.rule,function(b){b.checked&&(b.edit=!0);b.os_type.disabled=!a.avcAvailable||"service"===b.service_app.type;
b.device_type.disabled=!a.avcAvailable||"service"===b.service_app.type})},save:function(){var c=[],d=a.currPage;(function(){var b=[];a.model.dels.length&&angular.forEach(a.model.dels,function(a,c){b.push({name:a.name})});if("edit"===d){var g=a.edit,e;"edit"===g.editType&&(e=a.model.classes[a.edit.editIndex],e.name!==g.name&&b.push({name:e.name}))}b.length&&c.push({method:"del_qos_class",params:{classifiers:{classifier:b}}})})();(function(){if("edit"===d){var b,g=a.edit,e=[],k=[];angular.forEach(g.rule,
function(a,c){b={name:a.name,"ip-version":a.version.select,service:{},application:{category:"",name:"",behaviour:""},"device-type":a.device_type.select,"os-type":a.os_type.select,dscp:{match:a.dscp.match.select,set:a.dscp.set.select}};"any"===a.receive_intf.select?b["any-interface"]=null:b["receive-interface"]=a.receive_intf.select;"ipv4"===a.version.select?b.address={"ipv4-source":{ip:a.address.src.ipv4.ip,"prefix-length":app.TOOLS.netmask.inet2Int(a.address.src.ipv4.mask)},"ipv4-destination":{ip:a.address.dest.ipv4.ip,
"prefix-length":app.TOOLS.netmask.inet2Int(a.address.dest.ipv4.mask)}}:"ipv6"===a.version.select&&(b.address={"ipv6-source":{ip:a.address.src.ipv6.ip,"prefix-length":a.address.src.ipv6.mask},"ipv6-destination":{ip:a.address.dest.ipv6.ip,"prefix-length":a.address.dest.ipv6.mask}});if("service"===a.service_app.type)switch(a.service_app.service_select){case "$udp":b.service={protocol:"UDP","port-range":{start:a.service_app.start_port,end:a.service_app.end_port}};break;case "$tcp":b.service={protocol:"TCP",
"port-range":{start:a.service_app.start_port,end:a.service_app.end_port}};break;case "$udpAny":b.service={protocol:"UDP","port-range":{start:1,end:65535}};break;case "$tcpAny":b.service={protocol:"TCP","port-range":{start:1,end:65535}};break;default:b.service={"service-ref":a.service_app.service_select}}else"application"===a.service_app.type&&(b.application.category=a.service_app.app_category,b.application.name=a.service_app.app_name,b.application.behaviour=a.service_app.app_behaviour);k.push(b)});
e.push({name:g.name,description:g.description,rule:k});c.push({method:"set_qos_class",params:{classifiers:{classifier:e}}})}})();c.length?b.post({method:"set_bulk",forcedUsingPost:!0,params:c,success:function(b){H();a.success=!0;a.resetModified()},error:function(b){console.log("trafficClassesCtrl del_qos_class error : "+b.status);H();a.resetModified()}}):H()},cancel:function(){"edit"===a.currPage?H():(G(-1),E());a.resetModified()}};a.check_traffic=function(){return!a.model.classes[a.classIndex]?!1:
"Default"===a.model.classes[a.classIndex].name||!0===a.model.classes[a.classIndex].in_use?!0:!1};a.is_default=function(){return!a.model.classes||!a.model.classes[a.classIndex]?!1:"Default"===a.model.classes[a.classIndex].name?!0:!1};a.checkConnName=function(){var b=function(b){a.tcform&&a.tcform&&a.tcform.cname.$setValidity("repeat_name",b)},c=!1;!a.edit||!a.edit.name?b(!0):(angular.forEach(a.model.classes,function(b){b.name===a.edit.name&&(c=!0)}),c?b(!1):b(!0))};a.schema={version:[{id:"unknown",
displayName:a.DICT("Traffic_Classes_Either")},{id:"ipv4",displayName:"IPv4"},{id:"ipv6",displayName:"IPv6"}]};(function(){v.all([e.get(),x(),z(),A(),k(),l(),C(),d()]).then(function(b){var d=b[0]||{};a.model.devicetypes=d.device;a.model.ostypes=d.os;c(b[7].data&&b[7].data.result||{});r(b[1].data&&b[1].data.result||{});y(b[2].data&&b[2].data.result||{});B(b[3].data&&b[3].data.result||{});g(b[4].data&&b[4].data.result||{});h(b[5].data&&b[5].data.result||{});D(b[6].data&&b[6].data.result||{});a.resetModified();
a.dataReady=!0})})()}]);app.controller("qos_bandwidth_management_main",["$scope","$q","MyHttp","$templateCache","wan_service","UserSession","userAccessRight","goToPreviousPage","oneTimeLocker",function(a,b,s,n,v,t,m,q,e){a.model={interfaces:[],outbound_list:[],queue_model:"priority",default_outbound:"Priority_Default"};var w={priority:"Priority_Default","rate-control":"Rate_Control_Default","low-latency":"Low_Latency_Default"};a.backbtn=!1;a.success=!1;a.dataReady=!1;a.needbackbtnbywanpolicy=!1;a.goback=q.goback;a.jumpToPage=
function(b){app.TOOLS.jumpToPage(b,void 0,function(b){b&&a.backbtn&&e.put("comefromWanQueuing",!0)})};a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var l=function(){var e=s.post({url:resource_base+"data/interfaces_qos.json",method:"get_qos_wan_bandwidth",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),l=s.post({url:resource_base+"data/qos_lan2wan.json",method:"get_qos_queuing",error:function(a){Log(ERROR,"AJAX loading error: "+
a.status+", URL: "+a.config.url)}});a.dataReady=!1;b.all([e,l]).then(function(b){u(b[1]&&b[1].data&&b[1].data.result||{});h(b[0]&&b[0].data&&b[0].data.result||{});a.gridBWManage.data=a.model.interfaces;a.resetModified();a.dataReady=!0})["catch"](function(a){Log(ERROR,"=="+a)})},h=function(b){b||(b={});b=b.interfaces&&b.interfaces["interface"]||[];b=v.filter(b,{physical:!0,usb:!0});a.model.interfaces=[];angular.forEach(b,function(b,d){a.model.interfaces.push(p(b))})},p=function(b){b||(b={});var e=
b["ciscosb-qos"]||{},d=e.bandwidth||{},e={name:b.name||"",upstream:d.upstream||0,downstream:d.downstream||0,outbound:((e["qos-policy"]||{}).outbound||{})[a.model.queue_model]||a.model.default_queuing,edit:!0,list:a.model.outbound_list,max_upstream:1048576,max_downstream:1048576};b.name.match(/^USB\d+$/)&&(e.max_upstream=524288,e.max_downstream=524288);return e},u=function(b){b||(b={});b=b["ciscosb-qos"]||{};var e=b["queue-model"]||"priority";b=b["queue-policies"]&&b["queue-policies"]["queue-policy"]||
[];var d=!1;a.model.outbound_list=[];a.model.queue_model=e;a.model.default_outbound="";angular.forEach(b,function(b){b.queues&&b.queues[e]&&(a.model.default_outbound||(a.model.default_outbound=b.name),b.name===w[e]&&(d=!0),a.model.outbound_list.push({id:b.name,displayName:b.name}))});d&&(a.model.default_outbound=w[e]);a.model.outbound_list.length||Log(ERROR,"[Qos Bandwidth] Get error for WAN Queuing list, there is not exist rule which queue-model is "+e)};a.gridBWManage=app.uiGrid.generateGridOptions({columnDefs:[{field:"name",
displayName:a.DICT("WAN_Bandwidth_Management_Interface"),headerCellTemplate:"qos_header_bandwidth_interface.html"},{field:"upstream",displayName:a.DICT("WAN_Bandwidth_Management_Upstream"),required:!0,minWidth:230,cellTemplate:n.get("UG_table_inline_number_edit.html").replace(/data-ng-expansion/,'min="8" max="{{row.entity.max_upstream}}"'),headerCellTemplate:"qos_header_bandwidth_upstream.html"},{field:"downstream",displayName:a.DICT("WAN_Bandwidth_Management_Downstream"),required:!0,minWidth:230,
cellTemplate:n.get("UG_table_inline_number_edit.html").replace(/data-ng-expansion/,'min="8" max="{{row.entity.max_downstream}}" '),headerCellTemplate:"qos_header_bandwidth_downstream.html"},{field:"outbound",displayName:a.DICT("WAN_Bandwidth_Management_Outbound_Queuing_Policy"),cellTemplate:n.get("UG_table_select1_with_inline_edit.html"),listField:"list",editRow:"edit",headerCellTemplate:"qos_header_bandwidth_outbond_queuing_policy.html"}]});a.save=function(){var b=[],e;angular.forEach(a.model.interfaces,
function(d){e={name:d.name,"ciscosb-qos":{"qos-policy":{outbound:{}},bandwidth:{upstream:d.upstream,downstream:d.downstream}}};e["ciscosb-qos"]["qos-policy"].outbound[a.model.queue_model]=d.outbound;b.push(e)});s.post({url:resource_base+"data/qos_class.json",method:"set_qos_wan_bandwidth",params:{interfaces:{"interface":b}},success:function(b){a.success=!0;l()},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})};a.cancel=function(){l()};a.combineNote=a.DICT("WAN_Bandwidth_Management_Need_To",
{"%s":"<a ng-click=\"jumpToPage('QoS_WAN_Policing')\">"+a.DICT("WAN_Bandwidth_Management_Here")+"</a>"});e.get("needbackbtnbywanpolicy")&&(a.needbackbtnbywanpolicy=!0);if(q.isneed()||a.needbackbtnbywanpolicy)a.backbtn=!0;l()}]);app.controller("routingIGMPProxyCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","wan_service",function(a,b,s,n,v,t){a.success=!1;a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var m=function(){return b.post({method:"get_igmp",url:resource_base+"data/igmp_proxy.json",success:function(a){q(a.data.result)},error:function(a){console.log("routingIGMPProxyCtrl Error status: "+a.status)}})},q=function(b){b||(b={});b=b["igmp-proxy"]||{};a.model.enable=
void 0!==b.enable?b.enable:!0;a.model.upstream_intf=b["upstream-interface"]||"auto"};a.need_one_downstream=!1;a.model={enable:!0,upstream_intf:"auto",upstream_sel:"",upstream_list:[],downstream_list:[],list:[]};a.schema={upstream_intfs:[{name:a.DICT("IGMP_Proxy_WAN_Auto"),id:"auto"},{name:a.DICT("IGMP_Proxy_Fixed_Interface"),id:"fix"}]};var e=function(b){b||(b={});a.model.downstream_list=[];a.model.upstream_list=[];var e=[],p=[],u=[],m=[],r=-1,d,c=[],k=!1;b.interfaces&&b.interfaces["interface"]&&
(e=t.order_ifs(b));angular.forEach(e,function(b){b.name&&(d=b["igmp-proxy"]||{},"upstream"===d.type&&!0===d.enable&&(a.model.upstream_sel=b.name),b.name.match(/^WAN\d+($|\.\d+$)/)&&("downstream"===d.type&&!0===d.enable&&(k=!0),p.push({name:b.name,isdown:!1,id:b.name,disable:!1,type:"wan"})),b.name.match(/^VLAN\d+$/)&&m.push({name:b.name,isdown:"downstream"===d.type&&d.enable?!0:!1,id:b.name,disable:!1,type:"vlan"}),b.name.match(/^GRE\d+$/)&&c.push({name:b.name,isdown:"downstream"===d.type&&d.enable?
!0:!1,id:b.name,disable:!1,type:"gre"}))});u=p.concat(m).concat(c);r=-1;angular.forEach(u,function(b,c){0===c%10&&(r+=1,a.model.upstream_list.push([]));a.model.upstream_list[r].push(b)});u=[{name:"WAN",isdown:k,id:"wan",disable:"auto"===a.model.upstream_intf,type:"wan",wans:angular.copy(p)}].concat(m).concat(c);r=-1;angular.forEach(u,function(b,c){0===c%10&&(r+=1,a.model.downstream_list.push([]));a.model.downstream_list[r].push(b)})},w=function(){a.model.upstream_list=[];a.model.downstream_list=[];
s.all([m()]).then(function(b){a.model.upstream_sel="";q(b[0]&&b[0].data&&b[0].data.result||{});e(b[0]&&b[0].data&&b[0].data.result||{});"auto"===a.model.upstream_intf&&(a.model.upstream_sel=a.model.upstream_list[0]&&a.model.upstream_list[0][0]&&a.model.upstream_list[0][0].id||"");a.dataReady=!0})};a.funs={save:function(){var e=a.model.enable,h=a.model.upstream_intf,p=a.model.upstream_sel,u=[],m,r,d,c,k,g,z,y=a.model.downstream_list,A=!1;a.need_one_downstream=!1;for(m=y.length-1;0<=m;m--)for(r=y[m].length-
1;0<=r;r--)if(d=y[m][r],d.isdown&&(A=!0),"WAN"===d.name){if(d.wans&&d.wans.length)for(c=d.wans.length-1;0<=c;c--)k=d.wans[c],"auto"===h?(z="upstream",g=!0):p===k.id?(z="upstream",g=!0):d.isdown?(z="downstream",g=!0):(z="upstream",g=!1),u.push({name:k.name,"igmp-proxy":{enable:g,type:z}})}else if("vlan"===d.type||"gre"===d.type)"auto"===h?d.isdown?(z="downstream",g=!0):(z="downstream",g=!1):p===d.id?(z="upstream",g=!0):d.isdown?(z="downstream",g=!0):(z="downstream",g=!1),u.push({name:d.name,"igmp-proxy":{enable:g,
type:z}});e&&!A?a.need_one_downstream=!0:b.post({method:"set_igmp",params:{"igmp-proxy":{enable:e,"upstream-interface":h},interfaces:{"interface":u}},success:function(b){a.success=!0;w();a.resetModified()},error:function(b){w();a.resetModified()}})},cancel:function(){w();a.resetModified()}};a.check=function(){var b=!1,e=a.model.downstream_list,p,u,m;"auto"===a.model.upstream_intf&&(b=!0);for(p=e.length-1;0<=p;p--)for(u=e[p].length-1;0<=u;u--)m=e[p][u],"WAN"===m.name&&(m.disable=b)};a.dataReady=!1;
w()}]);app.controller("ripCtrl",["$scope","MyHttp","UserSession","userAccessRight","$q",function(a,b,s,n,v){a.success=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var t=function(){return b.post({url:resource_base+"data/rip.json",method:"get_rip",error:function(a){Log(ERROR,"ripCtrl error status: "+a.status)}})},m=function(b){b||(b={});a.model.ripList=[];var e=function(b,e){var h=e.name||"",d=void 0!==e.enabled?e.enabled:!0,c=void 0!==e.passive?e.passive:!0,k=e.authentication||
{},g=void 0;if(h){angular.forEach(a.model.ripList,function(a,b){a.ifname===h&&(g=a)});void 0===g&&(a.model.ripList.push({ifname:h,enabled:!1,NATEnable:!1,edit:!0,ripv1:{enabled:!1,passive:!1},ripv2:{enabled:!1,passive:!1},ripng:{enabled:!1,passive:!1},authentication:{enable:!1,type:"key-chain",password:"",key_chain:{id:"",key:""},orig_type:"key-chain",orig_password:"",orig_key_chain:{id:"",key:""}},empty:""}),g=a.model.ripList[a.model.ripList.length-1]);switch(b){case "ripv1":case "ripng":break;case "ripv2":angular.forEach(k,
function(a,b){switch(b){case "enable":g.authentication.enable=a;break;case "key-chain":g.authentication.type=b;g.authentication.orig_type=b;g.authentication.key_chain.id=void 0!==a.id?parseInt(a.id,10):"";g.authentication.key_chain.key=a.key||"";g.authentication.orig_key_chain=angular.copy(g.authentication.key_chain);break;case "key":g.authentication.type=b,g.authentication.password=a,g.authentication.orig_type=b,g.authentication.orig_password=a}});break;default:return}g[b].enabled=d;g[b].passive=
c}else Log(ERROR,"ripCtrl procRIPData addRIP error no ifname")};b=(b.routing||{})["routing-instance"]||[];var p=a.model;p.v4_enabled=!1;p.v6_enabled=!1;a.key={ripv1:{name:"",type:""},ripv2:{name:"",type:""},ripng:{name:"",type:""},name:""};angular.forEach(b,function(b,l){if("local"===b.name){a.key.name=b.name;var r;angular.forEach((b["routing-protocols"]||{})["routing-protocol"]||[],function(b,c){r=b.type.replace("ciscosb-routing-rip:","");if(a.key[r]){a.key[r].name=b.name;a.key[r].type=r;var k=b.rip,
g;void 0!==k["v4-enabled"]&&(p.v4_enabled=p.v4_enabled||k["v4-enabled"]);void 0!==k["v6-enabled"]&&(p.v6_enabled=p.v6_enabled||k["v6-enabled"]);if(k.ripv1)g="ripv1",k=k.ripv1.interfaces||{};else if(k.ripv2)g="ripv2",k=k.ripv2.interfaces||{};else if(k.ripng)g="ripng",k=k.ripng.interfaces||{};else{Log(ERROR,"ripCtrl error key type is error element");return}angular.forEach(k["interface"]||[],function(a,b){e(g,a)})}else Log(ERROR,"ripCtrl error key type is error type: "+r)})}});a.gridRipOptions.data=
a.model.ripList},q=function(){return b.post({method:"get_nat",url:resource_base+"data/wan_setting1.json",error:function(a){Log(ERROR,"getInterfacesData error status: "+a.status);e()}})},e=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];a.model.ifs={};angular.forEach(b,function(b,e){if(b.name.match(/^WAN/)||b.name.match(/^USB/)||b.name.match(/^VLAN/))a.model.ifs[b.name]={nat:b.nat&&void 0!==b.nat.enable?b.nat.enable:!1}})},w=function(){a.dataReady=!1;v.all([t(),q()]).then(function(b){m(b[0]&&
b[0].data&&b[0].data.result);e(b[1]&&b[1].data&&b[1].data.result);a.checkRelation();a.dataReady=!0})};a.checkRelation=function(){angular.forEach(a.model.ripList,function(b,e){a.chkRowRelation(b)})};a.chkRowRelation=function(b){a.model.ifs[b.ifname]&&a.model.ifs[b.ifname].nat?(b.NATEnable=!0,b.enabled=a.model.v4_enabled&&(b.ripv1.enabled||b.ripv2.enabled)||a.model.v6_enabled&&(b.ripng.enabled||b.ripng.passive)):b.enabled=a.model.v4_enabled&&(b.ripv1.enabled||b.ripv1.passive||b.ripv2.enabled||b.ripv2.passive)||
a.model.v6_enabled&&(b.ripng.enabled||b.ripng.passive);!b.ripv2.enabled&&b.authentication.enable&&(b.authentication.enable=!1);b.edit=!a.model.v4_enabled&&!a.model.v6_enabled?!1:!0};a.enableCbk=function(b){a.model.v4_enabled&&(b.ifname.match(/^WAN/)||b.ifname.match(/^USB/)?b.NATEnable||(b.ripv1.passive=b.enabled,b.ripv2.passive=b.enabled):(b.ripv1.passive=b.enabled,b.ripv2.passive=b.enabled),b.ripv1.enabled=b.enabled,b.ripv2.enabled=b.enabled);a.model.v6_enabled&&(b.ripng.enabled=b.enabled,b.ripng.passive=
b.enabled)};a.model={v4_enabled:!1,v6_enabled:!1,ripList:[],ifs:[],schema:{}};a.key={};a.dataReady=!1;a.funs={save:function(){var e=[],h=[],p=[],u=[],m,r;angular.forEach(a.model.ripList,function(a,b){var k={enable:a.authentication.enable};if(a.authentication.orig_type!==a.authentication.type||a.authentication.orig_password!==a.authentication.password||a.authentication.orig_key_chain.id!==a.authentication.key_chain.id||a.authentication.orig_key_chain.key!==a.authentication.key_chain.key)switch(a.authentication.type){case "key":k.key=
a.authentication.password;break;default:k["key-chain"]={id:a.authentication.key_chain.id,key:a.authentication.key_chain.key}}r=a.ripv1.enabled;m=a.ripv1.passive;e.push({name:a.ifname,enabled:r,passive:m});r=a.ripv2.enabled;m=a.ripv2.passive;h.push({name:a.ifname,enabled:r,passive:m,authentication:k});r=a.ripng.enabled;m=a.ripng.passive;p.push({name:a.ifname,enabled:r,passive:m})});u.push({type:a.key.ripv1.type,name:a.key.ripv1.name,rip:{"v4-enabled":a.model.v4_enabled,"v6-enabled":a.model.v6_enabled,
ripv1:{interfaces:{"interface":e}}}});u.push({type:a.key.ripv2.type,name:a.key.ripv2.name,rip:{"v4-enabled":a.model.v4_enabled,"v6-enabled":a.model.v6_enabled,ripv2:{interfaces:{"interface":h}}}});u.push({type:a.key.ripng.type,name:a.key.ripng.name,rip:{"v4-enabled":a.model.v4_enabled,"v6-enabled":a.model.v6_enabled,ripng:{interfaces:{"interface":p}}}});b.post({method:"set_rip",params:{routing:{"routing-instance":[{name:a.key.name,"routing-protocols":{"routing-protocol":u}}]}},success:function(b){a.success=
!0;w();a.resetModified()},error:function(){w();a.resetModified()}})},cancel:function(){w();a.resetModified()}};a.gridRipOptions=app.uiGrid.generateGridOptions({data:a.model.ripList,headerRowHeight:60,columnDefs:[{field:"ifname",displayName:a.DICT("RIP_Interface"),cellClass:"rip-content-tb-cell",width:100,headerCellTemplate:"rip_interface_header.html"},{field:"enabled",editRow:"edit",displayName:a.DICT("RIP_Enable"),editRow:"edit",cellClass:"rip-content-tb-cell",changedCbk:function(b,e,p,u){e&&e.entity&&
a.enableCbk(e.entity)},cellTemplate:"UG_table_checkbox_with_inline_edit.html",width:80,headerCellTemplate:"rip_enable_header.html"},{field:"ripv1",headerCellTemplate:"rip_ripv1_header.html",cellTemplate:"rip_ripv1_2_content.html",minWidth:140},{field:"ripv2",headerCellTemplate:"rip_ripv2_header.html",cellTemplate:"rip_ripv1_2_content.html",minWidth:140},{field:"ripng",headerCellTemplate:"rip_ripng_header.html",cellTemplate:"rip_ripng_content.html",minWidth:140},{field:"authentication",headerCellTemplate:"rip_auth_header.html",
cellTemplate:"rip_auth_content.html",minWidth:450},{field:"empty",isEmpty:!0,displayName:"",headerCellTemplate:"rip_empty_header.html"}]});a.model.schema={authTypeList:[{id:"key-chain",displayName:a.DICT("RIP_MD5")},{id:"key",displayName:a.DICT("RIP_Plain")}]};w()}]);app.controller("staticRoutingCtrl",["$scope","MyHttp","wan_service","$q","$templateCache","UserSession","userAccessRight",function(a,b,s,n,v,t,m){a.success=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var q=function(){return b.post({url:resource_base+"data/routing_get_subnet.json",method:"get_subnet",error:function(a){Log(ERROR,"staticRoutingCtrl error status: "+a.status)}})},e=function(){return b.post({url:resource_base+"data/routing.json",method:"get_routing_protocol",
error:function(a){Log(ERROR,"staticRoutingCtrl error status: "+a.status)}})},w=function(b){b||(b={});b=(b.routing||{})["routing-instance"]||[];var c=(b[0]&&b[0]["routing-protocols"]||{})["routing-protocol"]||[];a.model.ipv4=[];a.model.ipv6=[];a.model.routingInstanceName=b.name||"local";a.model.routingInstanceType=b.type||"default-routing-instance";a.model.selects={ipv4:[],ipv6:[]};angular.forEach(c,function(b,c){if("static"===b.type){a.model.routingProtocolName=b.name||"local";a.model.routingProtocolType=
b.type||"static";var d=b["static-routes"]&&b["static-routes"].ipv6&&b["static-routes"].ipv6.route||[];angular.forEach(b["static-routes"]&&b["static-routes"].ipv4&&b["static-routes"].ipv4.route||[],function(b,c){a.model.ipv4.push(l(b))});angular.forEach(d,function(b,c){a.model.ipv6.push(h(b))});a.model.orig.ipv4=angular.copy(a.model.ipv4);a.model.orig.ipv6=angular.copy(a.model.ipv6)}});a.gridIpv4Options.data=a.model.ipv4;a.gridIpv6Options.data=a.model.ipv6;setTimeout(function(){a.gridIpv4Options.gridApi.customApi.checkSelectStatus();
a.gridIpv6Options.gridApi.customApi.checkSelectStatus()},0)},l=function(b,c){var d=b["destination-prefix"]&&b["destination-prefix"].split("/")||["",24],e=d[0],d=parseInt(d[1],10),k=b["next-hop"]&&b["next-hop"]||{};return{dest_prefix:b["destination-prefix"]||"",checked:!1,disableChk:!1,edit:c||!1,modify:c||!1,network:e,mask:0===d?"0.0.0.0":app.TOOLS.netmask.int2Inet(d),next_hop_address:k["ciscosb-routing:next-hop-address"]||k["next-hop-address"]||"",metric:void 0!==b.metric?b.metric:1,"interface":{select:k["outgoing-interface"]||
a.model.schema.intfs[0]&&a.model.schema.intfs[0].id||"",list:a.model.schema.intfs}}},h=function(b,c){var d=b["destination-prefix"]&&b["destination-prefix"].split("/")||["",64],e=d[0],d=parseInt(d[1],10),k=b["next-hop"]&&b["next-hop"]||{};return{dest_prefix:b["destination-prefix"]||"",edit:c||!1,checked:!1,disableChk:!1,modify:c||!1,prefix:e,length:d,next_hop_address:k["ciscosb-routing:next-hop-address"]||k["next-hop-address"]||"",metric:void 0!==b.metric?b.metric:1,"interface":{select:k["outgoing-interface"]||
a.model.schema.intfs[0]&&a.model.schema.intfs[0].id||"",list:a.model.schema.intfs}}};t=function(b){b=a.model.ipv4;var c=a.model.ipv6;a.model.selects.ipv4=[];angular.forEach(b,function(b,c){b.checked?a.model.selects.ipv4.push(c):(b.edit=!1,void 0==b.network&&(b.network=""),void 0==b.mask&&(b.mask="255.255.255.0"),void 0==b.next_hop_address&&(b.next_hop_address=""))});a.model.selects.ipv6=[];angular.forEach(c,function(b,c){b.checked?a.model.selects.ipv6.push(c):(b.edit=!1,void 0==b.prefix&&(b.prefix=
""),void 0==b.length&&(b.length=64),void 0==b.next_hop_address&&(b.next_hop_address=""))})};var p=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",error:function(a){Log(ERROR,"Static Routing getInterfacesData Error Status: "+a.status)}})},u=function(b){b||(b={});b=b.interfaces&&b.interfaces["interface"]||[];var c=[],d=[];a.model.schema.intfs=[];var e=s.filter(b,{gre:!0,usb:!0,physical:!0,ipv6transition:!0,subinterface:!0});angular.forEach(e,function(a){(a.name.match(/^USB\d+$/)||
a.name.match(/^TUN\d+$/))&&!1===a.enabled||c.push({id:a.name,displayName:a.name})});angular.forEach(b,function(a,b){a.name.match(/^VLAN/)&&d.push({id:a.name,displayName:a.name})});a.model.schema.intfs=c.concat(d)},x=function(){n.all([e()]).then(function(a){w(a[0]&&a[0].data&&a[0].data.result||{})})};a.dataReady=!0;a.model={routingInstanceName:"local",routingInstanceType:"default-routing-instance",routingProtocolName:"local",routingProtocolType:"static",ipv4:[],ipv6:[],selects:{ipv4:[],ipv6:[]},orig:{ipv4:[],
ipv6:[]},schema:{intfs:[],maxCnts:{ipv4:50,ipv6:50}},delItem:{ipv4:[],ipv6:[]}};var r=function(){return 100<=a.model.ipv4.length?(a.msg=a.DICT("Static_Routing_Msg_V4",{"%d":a.model.ipv4.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},d=function(){return 50<=a.model.ipv6.length?(a.msg=a.DICT("Static_Routing_Msg_V6",{"%d":a.model.ipv6.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},c=[],k={};a.ipv4RouteCbk=function(b){if(!b)return!0;var d=!0,e=[],
h=[],r=a.model.ipv4,l=r.length,p,u,m=!0,n,q=!0,G,x;"delete_row"===b.type&&(m=!1);var w=function(a,b,g,m){if(!(0>b||b>l))if(!(0>g||g>l)){q=!0;x=void 0;G=a.network+"_"+a.mask+"_"+g;c[g]&&(x=c[g].id,k[x]&&x!==G&&(k[x].cnts--,delete c[g]));for(p=b;p<l;p++)if((u=r[p])&&p!==g)app.TOOLS.validation.ipv4_getNet(u.network,u.mask).toString()==m?(Log(DEBUG,"### V4 entry "+(g+1)+" is the same with entry "+(p+1)),G=u.network+"_"+u.mask+"_"+p,c[p]||(c[p]={id:G},void 0===k[G]&&(k[G]={cnts:0}),k[G].cnts++,e.push(p)),
q=d=!1):c[p]&&(c[p].id===x&&k[x]&&1>=k[x].cnts)&&(h.push(p),delete c[p],delete k[x]);a&&(q?c[g]&&(h.push(g),delete c[g]):c[g]||(c[g]={id:G},void 0===k[G]&&(k[G]={cnts:0}),k[G].cnts++,e.push(g)))}};if(m){if(!b.row)return!0;m=app.TOOLS.validation.ipv4_getNet(b.row.entity.network,b.row.entity.mask).toString();w(b.row.entity,0,b.row.rowIndex,m)}else{b=angular.copy(c);angular.copy(k);c=[];k={};for(n=0;n<l;n++)r[n]&&(m=app.TOOLS.validation.ipv4_getNet(r[n].network,r[n].mask).toString(),w(r[n],n+1,n,m));
e=[];h=[];for(n=0;n<l;n++)b[n]&&!c[n]&&h.push(n),!b[n]&&c[n]&&e.push(n)}Log(DEBUG,"V4 valid="+d+" invalidRows="+e+" validRows="+h);return{result:d,invalidRows:e,validRows:h}};a.ipv6RouteCbk=function(b){if(!b)return!0;var d=!0,e=[],h=[],r=a.model.ipv6,l=r.length,p,u,m=!0,n,q=!0,G,x;"delete_row"===b.type&&(m=!1);var w=function(a,b,g,m){if(!(0>b||b>l))if(!(0>g||g>l)){q=!0;x=void 0;G=a.prefix+"_"+a.length+"_"+g;c[g]&&(x=c[g].id,k[x]&&x!==G&&(k[x].cnts--,delete c[g]));for(p=b;p<l;p++)if((u=r[p])&&p!==
g)b=app.TOOLS.validation.ipv6_getNet(u.prefix,u.length).toString(),Log(DEBUG,"### "+g+" rowV6Net="+b),b==m?(Log(INFO,"### V6 entry "+(g+1)+" is the same with entry "+(p+1)),G=u.prefix+"_"+u.length+"_"+p,c[p]||(c[p]={id:G},void 0===k[G]&&(k[G]={cnts:0}),k[G].cnts++,e.push(p)),q=d=!1):c[p]&&(c[p].id===x&&k[x]&&1>=k[x].cnts)&&(h.push(p),delete c[p],delete k[x]);a&&(q?c[g]&&(h.push(g),delete c[g]):c[g]||(c[g]={id:G},void 0===k[G]&&(k[G]={cnts:0}),k[G].cnts++,e.push(g)))}};if(m){if(!b.row)return!0;m=app.TOOLS.validation.ipv6_getNet(b.row.entity.prefix,
b.row.entity.length).toString();w(b.row.entity,0,b.row.rowIndex,m)}else{b=angular.copy(c);angular.copy(k);c=[];k={};for(n=0;n<l;n++)r[n]&&(m=app.TOOLS.validation.ipv6_getNet(r[n].prefix,r[n].length).toString(),w(r[n],n+1,n,m));e=[];h=[];for(n=0;n<l;n++)b[n]&&!c[n]&&h.push(n),!b[n]&&c[n]&&e.push(n)}Log(DEBUG,"V6 valid="+d+" invalidRows="+e+" validRows="+h);return{result:d,invalidRows:e,validRows:h}};a.chkIpv4SubnetIntfs=function(b){if(!b||!b.row)return!0;var c=!0,d=b.row.entity.next_hop_address;if(void 0===
d||""===d)return!0;angular.forEach(a.model.ipv4_intfs,function(a){"interfaces"==a.type&&a.ip==d&&(c=!1)});return c};a.chkIpv6SubnetIntfs=function(b){if(!b||!b.row)return!0;var c=!0;b=b.row.entity.next_hop_address;if(void 0===b||""===b)return!0;var d=app.TOOLS.ipv6.toFullV6Addr(b);angular.forEach(a.model.ipv6_intfs,function(a){var b=app.TOOLS.ipv6.toFullV6Addr(a.ip);"interfaces"==a.type&&d==b&&(c=!1)});return c};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridIpv4Options=app.uiGrid.generateGridOptions({IDPreifx:"GridIPv4",
data:a.model.ipv4,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t,disableChkBoxField:"disableChk"},{field:"network",editRow:"edit",customVldGroup:"1",displayName:a.DICT("Static_Routing_Network"),placeholder:"10.2.3.0",validationCbk:"gridInvalidCbk",required:!0,cellTemplate:v.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv4-ip extansion-or-reg="^0.0.0.0$" check-ipv4-multicast check-ipv4-bymask="row.entity[\'mask\']" custom-vld custom-vld-cbk="ipv4RouteCbk"'),
id:"GridIPv4_network"},{field:"mask",editRow:"edit",customVldGroup:"1",displayName:a.DICT("Static_Routing_Mask"),placeholder:"255.255.255.0",validationCbk:"gridInvalidCbk",required:!0,cellTemplate:v.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv4-netmask extansion-or-reg="^0.0.0.0$" check-mask-byipv4="row.entity[\'network\']" custom-vld custom-vld-cbk="ipv4RouteCbk"'),id:"GridIPv4_mask"},{field:"next_hop_address",editRow:"edit",customVldGroup:"ipv4SubnetIntfs",displayName:a.DICT("Static_Routing_Next_Hop"),
placeholder:" 10.2.3.4",required:!0,validationCbk:"gridInvalidCbk",cellTemplate:v.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv4-ip check-ipv4-multicast custom-vld custom-vld-cbk="chkIpv4SubnetIntfs"'),id:"GridIPv4_next"},{field:"metric",editRow:"edit",displayName:a.DICT("Static_Routing_Metric"),max:32766,min:0,required:!0,validationCbk:"gridInvalidCbk",cellTemplate:"UG_table_text_with_inline_number_edit.html",id:"GridIPv4_max"},{field:"interface",editRow:"edit",displayName:a.DICT("Static_Routing_Interface"),
cellTemplate:"UG_table_text_with_inline_select_edit.html",id:"GridIPv4_interface"}]});a.gridIpv6Options=app.uiGrid.generateGridOptions({IDPreifx:"GridIPv6",data:a.model.ipv6,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t,disableChkBoxField:"disableChk"},{field:"prefix",editRow:"edit",customVldGroup:"2",displayName:a.DICT("Static_Routing_Prefix"),placeholder:"2222::",validationCbk:"gridInvalidCbk",cellTemplate:v.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,
'ipv6-ip chk-ipv6-bylength="row.entity[\'length\']" custom-vld custom-vld-cbk="ipv6RouteCbk"'),id:"GridIPv6_prefix"},{field:"length",editRow:"edit",customVldGroup:"2",displayName:a.DICT("Static_Routing_Length"),min:0,max:128,required:!0,validationCbk:"gridInvalidCbk",cellTemplate:v.get("UG_table_text_with_inline_number_edit.html").replace(/data-ng-expansion/,'custom-vld chk-length-byipv6="row.entity[\'prefix\']" custom-vld-cbk="ipv6RouteCbk"'),id:"GridIPv6_length"},{field:"next_hop_address",editRow:"edit",
customVldGroup:"ipv6SubnetIntfs",displayName:a.DICT("Static_Routing_Next_Hop"),placeholder:"2222::1",required:!0,validationCbk:"gridInvalidCbk",cellTemplate:v.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv6-ip custom-vld custom-vld-cbk="chkIpv6SubnetIntfs"'),id:"GridIPv6_next"},{field:"metric",editRow:"edit",displayName:a.DICT("Static_Routing_Metric"),validationCbk:"gridInvalidCbk",max:32766,min:0,required:!0,cellTemplate:"UG_table_text_with_inline_number_edit.html",id:"GridIPv6_max"},
{field:"interface",editRow:"edit",displayName:a.DICT("Static_Routing_Interface"),cellTemplate:"UG_table_text_with_inline_select_edit.html",id:"GridIPv6_interface"}]});a.funs={add:function(b){switch(b){case "ipv4":if(r())return;break;case "ipv6":if(d())return}a.model[b].length>=a.model.schema.maxCnts[b]&&Log(INFO,"Static Routing funs.add, proto '"+b+"' reach Max count: "+a.model.schema.maxCnts[b]+". Reject Add command");switch(b){case "ipv4":b=l({},!0);b.checked=!0;a.model.ipv4.push(b);a.gridIpv4Options.gridApi.customApi.scrollToLast();
a.modified();break;case "ipv6":b=h({},!0),b.checked=!0,b.edit=!0,a.model.ipv6.push(b),a.gridIpv6Options.gridApi.customApi.scrollToLast(),a.modified()}},edit:function(b){switch(b){case "ipv4":case "ipv6":angular.forEach(a.model[b],function(a){a.checked&&(a.edit=!0,a.modify=!0)})}},del:function(b){var c=function(){var c=-1,d=-1;angular.forEach(a.model.selects[b],function(a,b){c<a&&(c=a,d=b)});a.model.selects[b].splice(d,1);return c},d,e;switch(b){case "ipv4":for(d=a.model.selects[b].length-1;0<=d;d--)e=
c(),a.model[b].splice(e,1);a.modified();break;case "ipv6":for(d=a.model.selects[b].length-1;0<=d;d--)e=c(),a.model[b].splice(e,1);a.modified()}},save:function(){var c=[],d=[],e=function(b,c){var d={},e={};b.length&&(d.ipv4={route:b});c.length&&(d.ipv6={route:c});e={routing:{"routing-instance":[{name:a.model.routingInstanceName,"routing-protocols":{"routing-protocol":[{type:a.model.routingProtocolType,name:a.model.routingProtocolName,"static-routes":d}]}}]}};b.length||delete e.routing["routing-instance"][0]["routing-protocols"]["routing-protocol"][0]["static-routes"].ipv4;
c.length||delete e.routing["routing-instance"][0]["routing-protocols"]["routing-protocol"][0]["static-routes"].ipv6;return e},k=[],h=[],r={},l={},p;angular.forEach(a.model.ipv4,function(a,b){p=a.network+"/"+app.TOOLS.netmask.inet2Int(a.mask);r[p]=!0;a.modify&&k.push({"destination-prefix":p,"next-hop":{"outgoing-interface":a["interface"].select,"ciscosb-routing:next-hop-address":a.next_hop_address},metric:a.metric})});angular.forEach(a.model.ipv6,function(a,b){p=a.prefix+"/"+a.length;l[p]=!0;a.modify&&
h.push({"destination-prefix":p,"next-hop":{"outgoing-interface":a["interface"].select,"ciscosb-routing:next-hop-address":a.next_hop_address},metric:a.metric})});var m=function(){b.post({method:"set_routing_protocol",params:e(k,h),success:function(b){a.success=!0;x();a.resetModified()},error:function(b){x();a.resetModified()}})};angular.forEach(a.model.orig.ipv4,function(a,b){a.dest_prefix&&!r[a.dest_prefix]&&c.push({"destination-prefix":a.dest_prefix})});angular.forEach(a.model.orig.ipv6,function(a,
b){a.dest_prefix&&!l[a.dest_prefix]&&d.push({"destination-prefix":a.dest_prefix})});c.length||d.length?b.post({method:"del_routing_protocol",params:e(c,d),success:function(){m()},error:function(){m()}}):m()},cancel:function(){x();a.resetModified()}};(function(){n.all([e(),p(),q()]).then(function(b){var c=b[2]&&b[2].data&&b[2].data.result||{};a.model.ipv4_intfs=c.subnets.ipv4||[];a.model.ipv6_intfs=c.subnets.ipv6||[];u(b[1]&&b[1].data&&b[1].data.result||{});w(b[0]&&b[0].data&&b[0].data.result||{})})})()}]);app.controller("antiThreatCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","Upload","dt",function(a,b,s,n,v,t,m){var q=app.TOOLS.getResponse,e=app.TOOLS.getVal;a.success=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var w=function(){return b.post({method:"get_anti_virus",url:resource_base+"data/anti_threat.json",error:function(a){l();Log(ERROR,"[AntiVirus] Error, getAntiVirus Error "+JSON.stringify(a))}})},l=
function(b){b||(b={});b=b&&b["anti-virus"]||{};var d=b.protocols||[];angular.forEach(a.model.av.proto,function(a){a.enable=!1;a.action="none"});angular.forEach(d,function(b){a.model.av.proto[b.name].enable=!1;a.model.av.proto[b.name]&&(a.model.av.proto[b.name].action=b.action,a.model.av.proto[b.name].enable=!0)});!b["file-size-threshold"]||!_.isNumber(b["file-size-threshold"])?(a.model.av.threshold_enabled=!1,a.model.av.threshold=1):(a.model.av.threshold_enabled=!0,a.model.av.threshold=b["file-size-threshold"]);
a.model.av.enabled=void 0!==b.enabled?b.enabled:!1},h=function(){return b.post({method:"get_anti_virus_state",url:resource_base+"data/anti_threat.json",error:function(a){l();Log(ERROR,"[AntiVirus] Error, getAntiVirusState Error "+JSON.stringify(a))}})},p=function(){return b.post({method:"get_signature_state",url:resource_base+"data/get_signature_state.json",error:function(a){Log(ERROR,"[AntiVirus][getSignatureStateData] Error "+JSON.stringify(a))}})},u=function(){s.all([w(),p(),h()]).then(function(b){l(q(b,
0));var d=q(b,1);d||(d={});var d=d["ciscosb-anti-virus:signature-state"]||{},c=m.parser(d["latest-update-time"]);a.model.signature_state.last_update_time=1===c.err_code?"N/A":m.timeStr(c);a.model.signature_state.version=d.version||"N/A";a.model.signature_state.available_version=d["available-version"]||"N/A";(b=q(b,2))||(b={});b=e(b.status,0);a.model.no_license=0===b;a.funs.check_protocol();a.ui_data.data_ready=!0;a.resetModified()})};a.model={no_license:!1,av:{enabled:!1,threshold_enabled:!1,threshold:1,
proto:{HTTP:{enable:!1,action:"none",list:[]},FTP:{enable:!1,action:"none",list:[]},SMTP:{enable:!1,action:"none",list:[]},POP3:{enable:!1,action:"none",list:[]},IMAP:{enable:!1,action:"none",list:[]}}},av_state:{last_reset_time:"N/A"},signature_state:{version:"N/A",last_update_time:"N/A"}};a.ui_data={data_ready:!1,disable_upgradeBtn:!0,protocols_none:[{id:"none",displayName:a.DICT("Anti_Threat_None")}],protocols:[{id:"log",displayName:a.DICT("Anti_Threat_Log")},{id:"log-destory",displayName:a.DICT("Anti_Threat_Log_Destroy")}],
pc_file:"",uploading:!1,progress:0,combineNote:a.DICT("Anti_Threat_Note",{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Here")+"</u></a>"})};var x=function(b){var d="";switch(b){case 2:d=a.DICT("Anti_Threat_Cannot_Connect_To_Cisco");break;case 3:d=a.DICT("Anti_Threat_You_Have_The_Lastest_Version");break;default:d=a.DICT("Anti_Threat_Update_Available_On_Cisco")}app.TOOLS.informationAlertBox({msg:d})};a.funs={check_update:function(){b.post({method:"check-latest-version",forcedUsingPost:!0,
success:function(a){x(3)},error:function(){x(2)}})},save:function(){var e=a.model.av,d={enabled:e.enabled};d["file-size-threshold"]=e.threshold_enabled?e.threshold:0;d.protocols=[];angular.forEach(e.proto,function(a,b){a.enable&&d.protocols.push({name:b,action:a.action})});b.post({method:"set_anti_virus",forcedUsingPost:!0,params:{"anti-virus":d},success:function(){u()},error:function(a){Log(ERROR,"[Anti Threat] Apply Error");Log(ERROR,JSON.stringify(a));u()}})},cancel:function(){u()},update:function(){var e=
function(){b.post({method:"action",params:{rpc:"file-copy",input:{fileType:"signature",source:"FILE://Signature/anti_virus_file"}},success:function(b){var d=b&&b.data&&b.data.result||{};b=d.code||-1;d=d.errstr||a.DICT("Anti_Threat_Upgrade_Fail");0===b?u():app.TOOLS.criticalAlertBox({msg:d,cbk:function(){u()}})},error:function(){app.TOOLS.criticalAlertBox({msg:a.DICT("Anti_Threat_Upgrade_Fail"),cbk:function(){u()}})}})},d=a.ui_data.pc_file;d.upload=t.upload({url:resource_base+"upload",headers:{"optional-header":"header-value"},
data:{sessionid:"EU6DJKEIWO",pathparam:"Signature",fileparam:"anti_virus_file",file:d}});a.ui_data.uploading=!0;d.upload.then(function(b){a.ui_data.uploading=!1;e()},function(b){a.ui_data.uploading=!1;app.TOOLS.criticalAlertBox({msg:a.DICT("Anti_Threat_Upload_Failure"),cbk:function(){u()}})},function(b){a.ui_data.progress=Math.min(100,parseInt(100*b.loaded/b.total,10))})},check_protocol:function(){angular.forEach(a.model.av.proto,function(b){b.enable?(b.list=a.ui_data.protocols,"none"===b.action&&
(b.action=a.ui_data.protocols[0].id)):(b.list=a.ui_data.protocols_none,b.action="none")})},chk_threshold:function(){!a.model.av.threshold_enabled&&!a.model.av.threshold&&(a.model.av.threshold=1)},pcFileFormatCheck:function(b){a.ui_data.pcfile_invalid=!1;a.ui_data.disable_upgradeBtn=!0;void 0!=b&&(b.name.toLowerCase().match(/(\.zip){1}$/)?(a.ui_data.pc_file=b,a.ui_data.disable_upgradeBtn=!1):(a.ui_data.disable_upgradeBtn=!0,app.TOOLS.criticalAlertBox({title:a.DICT("Error"),msg:a.DICT("Anti_Threat_File_Wrong_Format")})))}};
u()}]);app.controller("AppWizardCtrl",["$scope","MyHttp","pgWindow","meta_data_service","UserSession","userAccessRight","ngDialog","$location","$q",function(a,b,s,n,v,t,m,q,e){a.success=!1;a.maxAVCEntity=20;a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var w=function(b){var d=app.TOOLS.get_scope("WizardCtrl");d&&d.funs.close_application_wizard();b&&app.TOOLS.successAlertBox({title:a.DICT("Success"),msg:a.DICT("Application_Control_Wizard_Setup_Success"),cbk:function(){app.TOOLS.jumpToPage("Security_Application_Controller")}})},
l=function(){return b.post({url:resource_base+"data/avc_meta_data.json",method:"get_avc",success:function(a){a.data&&a.data.result?h(a.data.result):h()},error:function(a){console.log("AppWizardCtrl getAVCMetaData error "+a.status);h()}})},h=function(b){b&&b["avc-meta-data"]&&(a.model.meta=n.generate(b["avc-meta-data"],!0))},p=function(){return b.post({url:resource_base+"data/application_controller.json",method:"get_app_control",success:function(a){a.data&&a.data.result?u(a.data.result):u()},error:function(a){console.log("AppWizardCtrl getAppControllerData error : "+
a.status);u()}})},u=function(b){b||(b={});var d=b.avc||{},e=d.policy||[];a.model.reachMaxEntity=!1;a.model.enable=void 0!==d.enable?d.enable:!0;a.model.old_enable=a.model.enable;a.model.status=void 0!==b.status?b.status:0;a.model.orig_enable=a.model.enable;a.model.policys=[];angular.forEach(e,function(b){a.model.policys.push(x(b))});a.model.policys.length>=a.maxAVCEntity&&(a.model.reachMaxEntity=!0);a.dataReady=!0;a.resetModified()},x=function(b){b||(b={});var d=b.applications||[],e,h,l={name:b.name||
"",description:b.description||"",enable:void 0!==b.enable?b.enable:!1,ipgroup:"@none",display_ipgroup:"None",origapps:[],apps:[],display_apps:[],schedule:"#always-on",display_schedule:"Always On",exclusions:[],origexclusion:[],meta:angular.copy(a.model.meta)};angular.forEach(b,function(d,e){switch(e){case "schedule":l.schedule=b.schedule||a.model.schedules[0]&&a.model.schedules[0].id||"",l.display_schedule=l.schedule}});l.origname=l.name;angular.forEach(d,function(b){b.seq&&(b.category&&b.behaviour)&&
(b={seq:void 0!==b.seq?b.seq:l.apps.length,category:b.category||"",application:b.application||"",behaviour:b.behaviour||"",action:b.action||"log"},angular.forEach(a.model.meta,function(a){if(e=a.categories[b.category])if("-1"===b.application)angular.forEach(e.applications,function(a){angular.forEach(a.behaviors,function(b){l.display_apps.push({category:e.name,application:a.name,behaviour:b.name})})});else if(h=e.applications[b.application])"-1"===b.behaviour?angular.forEach(h.behaviors,function(a){l.display_apps.push({category:e.name,
application:h.name,behaviour:a.name})}):(be=h.behaviors[b.behaviour])&&l.display_apps.push({category:e.name,application:h.name,behaviour:be.name})}),l.apps.push(b))});l.origapps=angular.copy(l.apps);return l},r=function(){return b.post({url:resource_base+"data/schedule.json",method:"get_schedule",success:function(a){a.data&&a.data.result?d(a.data.result):d()},error:function(a){console.log("AppWizardCtrl getScheduleData error : "+a.status);d()}})},d=function(b){b||(b={});var d=[];b.schedules&&b.schedules.schedule&&
(d=b.schedules.schedule);a.model.schedules=[{id:"#always-on",displayName:"Always On"}];angular.forEach(d,function(b){a.model.schedules.push({id:b.name,displayName:b.name})})};a.dataReady=!1;a.wCurrPage="main";a.model={reachMaxEntity:!1,schema:{},enable:!0,old_enable:!0,status:0,schedules:[],policys:[],meta:[]};a.funs={submit:function(c){var d=!1;angular.forEach(a.model.policys,function(b){c.name===b.name&&(alert('Policy "'+c.name+'" has existed!'),a.edit.name="",a.edit.apps=[],a.edit.display_apps=
[],a.edit.schedule="",a.wCurrPage="main",d=!0)});d||(policy={name:c.name,description:"",applications:c.apps,enable:!0,"device-type":"ANY","os-type":"ANY","apply-ip-group":!1,"ip-groups":"","user-exclusion-entry":[]},"#always-on"===c.schedule?policy["always-on"]=null:policy.schedule=c.schedule,b.post({method:"set_app_control",forcedUsingPost:!0,params:{avc:{enable:a.model.enable,policy:[policy]}},success:function(a){app.TOOLS.get_scope("headerCtrl").enable_save_warning();w(!0)},error:function(a){w(!1)}}))}};
(function(){a.model.schema={global_action:[{id:"null",displayName:"------------------"},{id:"log",displayName:a.DICT("Application_Control_Wizard_Permit_Log")},{id:"pass",displayName:a.DICT("Application_Control_Wizard_Permit")},{id:"block",displayName:a.DICT("Application_Control_Wizard_Block")},{id:"log-block",displayName:a.DICT("Application_Control_Wizard_Block_Log")}],action:[{id:"log",displayName:a.DICT("Application_Control_Wizard_Permit_Log")},{id:"pass",displayName:a.DICT("Application_Control_Wizard_Permit")},
{id:"block",displayName:a.DICT("Application_Control_Wizard_Block")},{id:"log-block",displayName:a.DICT("Application_Control_Wizard_Block_Log")}]};e.all([l(),r(),p()]).then(function(b){h(b[0]&&b[0].data&&b[0].data.result||{});d(b[1]&&b[1].data&&b[1].data.result||{});u(b[2]&&b[2].data&&b[2].data.result||{});a.dataReady=!0;if(a.model.reachMaxEntity)app.TOOLS.criticalAlertBox({msg:a.DICT("Application_Control_Wizard_Max_Policies",{"%s0":a.maxAVCEntity,"%s1":a.maxAVCEntity}),cbk:function(){w(!1)}});else if(0===
a.model.status)app.TOOLS.criticalAlertBox({title:a.DICT("Application_Control_Wizard"),msg:a.DICT("Application_Control_Note",{"%s":'<a ng-click="no(); model.click();">'+a.DICT("Application_Control_Wizard_Smart_Licenses")+"</a>"}),cbk:function(){w(!1)},click:function(){w(!1);q.url("Admin_License/")}});else{var e={model:a.model};m.open({template:"app_control_wizard_dialog.html",closeByDocument:!1,className:"ngdialog-theme-default wizard-page",resolve:{obj:function(){return e}},controller:"app_controll_dialog",
preCloseCallback:function(b){!("$closeButton"===b||"close"===b)?a.funs.submit(b):w(!1)}})}})})()}]);
app.controller("app_controll_dialog",["$scope","obj",function(a,b){var s=function(b){a.show_skip_btn=b.canSkip?!0:!1;a.show_submit_btn=a.current_step===a.step_list.length-1?!0:!1};a.current_step=0;a.show_submit_btn=!1;a.show_skip_btn=!1;a.expandFlag=!1;a.isSubAppEdit=!1;a.model=b.model;a.title=a.DICT("Application_Control_Wizard");a.edit={name:"",display_apps:[],schedule:a.model.schedules[0]&&a.model.schedules[0].id||""};a.step_list=[{name:a.DICT("Application_Control_Wizard_Policy_Name"),templateUrl:"step1.html"},
{name:a.DICT("Application_Control_Wizard_Application_Name"),templateUrl:"step2.html"},{name:a.DICT("Application_Control_Wizard_Schedule"),templateUrl:"step3.html"},{name:a.DICT("Application_Control_Wizard_Summary"),templateUrl:"step4.html"}];a.submit=function(){a.closeThisDialog(a.edit)};a.cancel=function(){a.closeThisDialog("close")};a.next=function(){a.current_step<a.step_list.length&&(a.current_step+=1,s(a.step_list[a.current_step]))};a.back=function(){0<a.current_step&&(a.current_step-=1,s(a.step_list[a.current_step]))};
a.sub_submit=function(){a.isSubAppEdit=!1;a.editSave()};a.sub_cancel=function(){a.isSubAppEdit=!1};a.gridApplicationOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"category",displayName:a.DICT("Application_Control_Wizard_Category")},{field:"application",displayName:a.DICT("Application_Control_Wizard_Application")},{field:"behaviour",displayName:a.DICT("Application_Control_Wizard_Behavior")}]});a.expandAll=function(b){"true"===b?(angular.forEach(a.edit.meta,function(a){a.expanded=!0;angular.forEach(a.categories,
function(a){a.expanded=!0;angular.forEach(a.applications,function(a){a.expanded=!0})})}),a.expandFlag=!0):(angular.forEach(a.edit.meta,function(a){a.expanded=!1;angular.forEach(a.categories,function(a){a.expanded=!1;angular.forEach(a.applications,function(a){a.expanded=!1})})}),a.expandFlag=!1)};a.appEdit=function(){var b=angular.copy(a.model.meta),s,t,m;a.expandFlag=!1;angular.forEach(a.edit.apps,function(a){angular.forEach(b,function(b){b.categories&&b.categories[a.category]&&(s=b.categories[a.category],
"-1"===a.application?(angular.forEach(s.applications,function(b){b.checked=!0;angular.forEach(b.behaviors,function(b){b.checked=!0;b.action=a.action});b.action=a.action}),s.action=a.action):s.applications&&s.applications[a.application]&&(t=s.applications[a.application],"-1"===a.behaviour?(angular.forEach(t.behaviors,function(b){b.checked=!0;b.action=a.action}),t.action=a.action):t.behaviors&&t.behaviors[a.behaviour]&&(m=t.behaviors[a.behaviour],m.checked=!0,m.action=a.action)))})});a.edit.meta=[];
var q=0,e=[],w,l,h;angular.forEach(b,function(a){w=[];angular.forEach(a.categories,function(a){l=[];angular.forEach(a.applications,function(a){h=[];angular.forEach(a.behaviors,function(a){h.push(a)});a.behaviors=angular.copy(h);l.push(a)});a.applications=angular.copy(l);w.push(a)});a.categories=angular.copy(w);e.push(angular.copy(a))});a.edit.meta=e;var p,u,x;angular.forEach(a.edit.meta,function(a){void 0!==a.name&&(a.id="group"+q,q++);p=!1;angular.forEach(a.categories,function(a){u=!1;angular.forEach(a.applications,
function(a){x=!1;angular.forEach(a.behaviors,function(a){a.checked||(x=!0)});!1===x?a.checked=!0:u=!0});!1===u?a.checked=!0:p=!0});!1===p&&(a.checked=!0)});a.isSubAppEdit=!0};a.editSave=function(){a.edit.apps=[];a.edit.display_apps=[];var b=0,s,t,m,q,e,w,l,h,p;angular.forEach(a.edit.meta,function(u){angular.forEach(u.categories,function(u){l=!0;p=[];t=b;q=void 0;angular.forEach(u.applications,function(b){m=void 0;w=e=!0;s=t;h=[];angular.forEach(b.behaviors,function(d){d.checked?(m?m!==d.action&&(e=
!1):m=d.action,a.edit.display_apps.push({seq:s,category:u.name,application:b.name,behaviour:d.name,action:d.action}),h.push({seq:s,category:u.id,application:b.id,behaviour:d.id,action:d.action}),s+=1):w=!1});e&&w?(s=t,h=[{seq:s,category:u.id,application:b.id,behaviour:"-1",action:m}],q||(q=m),s+=1):l=!1;b.checked||(l=!1);q&&q!==m&&(l=!1);t=s;p=p.concat(h)});l?(p=[{seq:b,category:u.id,application:"-1",behaviour:"-1",action:q}],b+=1):b=t;a.edit.apps=a.edit.apps.concat(p)})});a.gridApplicationOptions.data=
a.edit.display_apps};a.change_behaviors=function(a,b){var s="",m=function(a){angular.forEach(a,function(a){a.action=s})},q=function(a){angular.forEach(a,function(a){a.action=s;m(a.behaviors)})},s=a.action;if("null"!==s)switch(b){case "group":angular.forEach(a.categories,function(a){a.action=s;q(a.applications)});break;case "category":q(a.applications);break;case "application":m(a.behaviors)}};a.checkPolicyName=function(){var b=!1;a.edit.name?(angular.forEach(a.model.policys,function(s){a.edit.name===
s.name&&(b=!0)}),b?a.wizardform.step0.name.$setValidity("repeat",!1):a.wizardform.step0.name.$setValidity("repeat",!0)):a.wizardform.step0.name.$setValidity("repeat",!0)};a.gridApplicationOptions.data=a.edit.display_apps;s(a.step_list[0])}]);app.controller("webFilteringCtrl",["$scope","MyHttp","pgWindow","meta_data_service","$q","UserSession","userAccessRight",function(a,b,s,n,v,t,m){var q=app.TOOLS.getResponse,e=app.TOOLS.getVal;a.success=!1;a.expandFlag=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var w=function(){b.post({url:resource_base+"data/webfilter_meta_data.json",method:"get_webfilter_meta",success:function(a){a.data&&a.data.result?l(a.data.result):l()},error:function(a){Log(ERROR,
"webFilteringCtrl getWebFilterMetaData error: "+a.status);l()}})},l=function(b){b||(b={});b=b["webfilter-meta-data"]||{};var c=[],d=[],e;b["filter-levels"]&&b["filter-levels"]["filter-level"]&&(c=b["filter-levels"]["filter-level"]);b.categories&&b.categories.category&&(d=b.categories.category);a.model.categories={};a.model.meta=n.generate(b);a.model.levels={};angular.forEach(d,function(b){a.model.categories[b.id]={id:b.id||"",name:b.name||"",description:b.description||""}});angular.forEach(c,function(b,
c){b.level&&(e=b.level,a.model.levels[e]={categories:b.categories&&b.categories[0]&&b.categories[0].split(" ")||[],groups:b.groups&&b.groups[0]&&b.groups[0].split(" ")||[]})})},h=function(){return b.post({url:resource_base+"data/security_content_filter.json",method:"get_content_filter",error:function(a){p()}})},p=function(b){b||(b={});a.model.content_filtering_enable=(b["content-filtering"]||{}).enable||!1},u=function(){return b.post({url:resource_base+"data/web_filtering.json",method:"get_webfilter"})},
x=function(b){b||(b={});var c=b.webfilter||{},d=c.policy||[];a.model.enable=void 0!==c.enable?c.enable:!1;a.model.block_msg=e(c["blocked-page-message"],"");a.model.ori_status=a.model.enable;a.model.status=void 0!==b.status?b.status:0;a.model.orig_enable=a.model.enable;a.model.policys=[];angular.forEach(d,function(b){a.model.policys.push(r(b))});a.gridMainOptions.data=a.model.policys},r=function(b,c){b||(b={});var e=c?"low":b["filtering-level"]||"custom",g={},k={name:b.name||"",checked:!1,description:b.description||
"",enable:void 0!==b.enable?b.enable:!1,filtering_level:e,orig_filtering_level:e,apply_ipgroup:void 0!==b["apply-ip-group"]?b["apply-ip-group"]:!1,web_reputation:void 0!==b["web-reputation"]?b["web-reputation"]:!1,ipgroup:"@none",display_ipgroup:"Any",categories:{low:[],high:[],med:[],custom:[]},block:[],white:[],user_exclusion_ip:[],schedule:"#always-on",display_schedule:"Always On",orig_block_domain:void 0,orig_block_url:void 0,orig_white_domain:void 0,orig_white_url:void 0,orig_user_exclusion:void 0,
orig_ipgroup:void 0,orig_custom_categories:void 0,orig_level_categories:[]},h,l;b["ip-groups"]&&b["ip-groups"][0]&&(k.orig_ipgroup=b["ip-groups"][0],k.ipgroup=b["ip-groups"][0],k.display_ipgroup=b["ip-groups"][0]);b.categories&&b.categories[0]&&(k.orig_custom_categories=b.categories[0],h=b.categories[0].split(" "),angular.forEach(h,function(a){k.categories.custom.push({category:a})}));switch(e){case "low":case "high":case "med":b["custom-categories"]&&angular.forEach(b["custom-categories"],function(a){g[a.category]=
a;a.checked&&(k.orig_level_categories.push({category:a.category}),k.categories[e].push({category:a.category}))}),angular.forEach(a.model.levels[e].categories,function(a){(!g[a]||g[a].checked)&&k.categories[e].push({category:a})})}l=0;b["black-domain-list"]&&b["black-domain-list"][0]&&(k.orig_block_domain=b["black-domain-list"][0],h=b["black-domain-list"][0].split(" "),angular.forEach(h,function(b){k.block.push({id:l,selected:!1,edit:!1,type:{select:"domain",list:angular.copy(a.model.schema.blockList)},
value:b});l+=1}));b["black-url-keyword-list"]&&b["black-url-keyword-list"][0]&&(k.orig_block_url=b["black-url-keyword-list"][0],h=b["black-url-keyword-list"][0].split(" "),angular.forEach(h,function(b){k.block.push({id:l,selected:!1,edit:!1,type:{select:"keyword",list:angular.copy(a.model.schema.blockList)},value:b});l+=1}));l=0;b["white-domain-list"]&&b["white-domain-list"][0]&&(k.orig_white_domain=b["white-domain-list"][0],h=b["white-domain-list"][0].split(" "),angular.forEach(h,function(b){k.white.push({id:l,
selected:!1,edit:!1,type:{select:"domain",list:angular.copy(a.model.schema.whiteList)},value:b});l+=1}));b["white-url-keyword-list"]&&b["white-url-keyword-list"][0]&&(k.orig_white_url=b["white-url-keyword-list"][0],h=b["white-url-keyword-list"][0].split(" "),angular.forEach(h,function(b){k.white.push({id:l,selected:!1,edit:!1,type:{select:"keyword",list:angular.copy(a.model.schema.whiteList)},value:b});l+=1}));b["user-exclusion-ip"]&&(h=b["user-exclusion-ip"],angular.forEach(h,function(a,b){k.user_exclusion_ip.push(d(a,
b))}),k.orig_user_exclusion=angular.copy(k.user_exclusion_ip));angular.forEach(b,function(a,b){switch(b){case "schedule":k.schedule=a,k.display_schedule=a}});return k},d=function(b,c){b||(b={});var d="ipv4-ip",e="",g="",k="",h="",l="",p="",r;b.ipv4?(r=b.ipv4,r.single?(e=r.single||"",d="ipv4-ip"):r.range&&(k=r.range.start||"",h=r.range.end||"",d="ipv4-range")):b.ipv6&&(r=b.ipv6,r.single?(g=r.single||"",d="ipv6-ip"):r.range&&(l=r.range.start||"",p=r.range.end||"",d="ipv6-range"));return{seq:void 0!==
b.seq?b.seq:"",empty:"",id:void 0!==c?c:0,selected:!1,edit:!1,ips:{select:d,list:a.model.schema.userExclusionList,v4_ip:e||"",v6_ip:g||"",v4_rangeS:k||"",v6_rangeS:l||"",v4_rangeE:h||"",v6_rangeE:p||""}}},c=function(b){b||(b={});var c=[],d,e;b["ip-groups"]&&b["ip-groups"]["ip-group"]&&(c=b["ip-groups"]["ip-group"]);a.model.ipgroups=[{id:"@none",displayName:a.DICT("Web_Filtering_Any")}];a.model.ipgroup_map={};a.model.ex_ipgroups=[];angular.forEach(c,function(b){e=b.name;a.model.ex_ipgroups.push({id:e,
displayName:e});d=[];angular.forEach(b.ips,function(b){b.ipv4?angular.forEach(b.ipv4,function(b,c){switch(c){case "single":d.push({type:a.DICT("Web_Filtering_IP_Address"),rule:b});break;case "subnet":d.push({type:a.DICT("Web_Filtering_Subnet"),rule:b.ip+"/"+app.TOOLS.netmask.inet2Int(b.netmask)});break;case "range":d.push({type:a.DICT("Web_Filtering_Range"),rule:b.start+" - "+b.end})}}):b.ipv6&&angular.forEach(b.ipv6,function(b,c){switch(c){case "single":d.push({type:a.DICT("Web_Filtering_IP_Address"),
rule:b});break;case "subnet":d.push({type:a.DICT("Web_Filtering_Subnet"),rule:b.ip+"/"+b["prefix-length"]});break;case "range":d.push({type:a.DICT("Web_Filtering_Range"),rule:b.start+" - "+b.end})}})});a.model.ipgroup_map[e]=d});a.model.ipgroups=a.model.ipgroups.concat(a.model.ex_ipgroups)},k=function(b){b||(b={});var c=[];b.schedules&&b.schedules.schedule&&(c=b.schedules.schedule);a.model.schedules=[{id:"#always-on",displayName:a.DICT("Always_On")}];angular.forEach(c,function(b){a.model.schedules.push({id:b.name,
displayName:a.DICT(b.name)})})},g=function(){a.dataReady=!1;a.del_policys=[];v.all([u(),h()]).then(function(b){x(b[0]&&b[0].data&&b[0].data.result||{});p(b[1]&&b[1].data&&b[1].data.result||{});a.dataReady=!0;a.resetModified()})};s=function(b){return function(c){c=a.edit["edit_"+b];var d=c.length,e;for(e=a.sel_cnts[b]=0;e<d;e++)c[e].selected&&(a.sel_cnts[b]+=1)}};t=function(b){a.sel_policy_cnts=0;angular.forEach(a.model.policys,function(b){b.checked&&a.sel_policy_cnts++})};var z={main:"main",policy_edit:"policy_edit",
category_edit:"category_edit",customer_rules:"customer_rules"};a.currPage=z.main;a.sel_policy_cnts=0;a.dataReady=!1;a.edit;a.orig;a.del_policys=[];a.model={content_filtering_enable:!1,enable:!1,ori_status:!1,status:0,orig_enable:!1,meta:{},levels:{},ipgroups:[],ipgroup_map:{},ex_ipgroups:[],schedules:[],categories:{},show_ipgroup:!1,ipgroupnote:!1,urllookup:{url:"",category:"--",reputation:"--",status:"--"},block_msg:""};a.sel_cnts={white:0,block:0,user_exclusion_ip:0};a.check_ip_group_detail=function(){var b=
a.edit,c=a.model.show_ipgroup;b&&(a.model.show_ipgroup=!1,"@none"!==b.ipgroup&&a.model.ipgroup_map[b.ipgroup]&&(a.gridIPGroupsOptions.data=a.model.ipgroup_map[b.ipgroup],a.model.show_ipgroup=!0,c||(a.model.ipgroupnote=!0,setTimeout(function(){a.model.ipgroupnote=!1;app.TOOLS.apply(a)},2E3)),app.TOOLS.apply(a)))};a.gridMainOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t},{field:"name",displayName:a.DICT("Web_Filtering_Policies")},{field:"display_schedule",
displayName:a.DICT("Web_Filtering_Schedule_Names")},{field:"display_ipgroup",displayName:a.DICT("Web_Filtering_IP_Group")},{field:"web_reputation",displayName:a.DICT("Web_Filtering_Web_Reputation_N"),id:"web_reputation",cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"enable",displayName:a.DICT("Web_Filtering_Enable_N"),id:"enable",cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});a.gridCategoryOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"category",displayName:a.DICT("Web_Filtering_Category")}]});
a.gridWhiteInvalidCbk=function(a){a.row.entity.disableWhiteChk=a.rowInvalid};a.gridWhiteOptions=app.uiGrid.generateGridOptions({IDPreifx:"exceptionwhite",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:s("white"),headerChangedCbk:s("white"),disableChkBoxField:"disableWhiteChk"},{field:"type",displayName:a.DICT("Web_Filtering_Type"),editRow:"edit",width:150,id:"white_type",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"value",displayName:a.DICT("Web_Filtering_Value"),editRow:"edit",
validation:"type",id:"white_value",cellTemplate:"T_table_web_filter.html",required:!0,validationCbk:"gridWhiteInvalidCbk"}]});a.gridBlackInvalidCbk=function(a){a.row.entity.disableBlackChk=a.rowInvalid};a.gridBlockOptions=app.uiGrid.generateGridOptions({IDPreifx:"exceptionblock",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:s("block"),headerChangedCbk:s("block"),disableChkBoxField:"disableBlackChk"},{field:"type",displayName:a.DICT("Web_Filtering_Type"),editRow:"edit",width:150,id:"block_type",
cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"value",displayName:a.DICT("Web_Filtering_Value"),editRow:"edit",id:"value",validation:"type",cellTemplate:"T_table_web_filter.html",required:!0,validationCbk:"gridBlackInvalidCbk"}]});a.gridIPGroupsOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"type",displayName:a.DICT("Web_Filtering_Type")},{field:"rule",displayName:a.DICT("Web_Filtering_Address")}]});a.gridExclusionInvalidCbk=function(a){a.row.entity.disableExclusionChk=
a.rowInvalid};a.gridExclusionOptions=app.uiGrid.generateGridOptions({IDPreifx:"exceptionexclusion",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:s("user_exclusion_ip"),headerChangedCbk:s("user_exclusion_ip"),disableChkBoxField:"disableExclusionChk"},{field:"ips",displayName:a.DICT("Web_Filtering_Type"),editRow:"edit",width:150,id:"exclusion",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"ips",displayName:a.DICT("Web_Filtering_IP_Addr"),editRow:"edit",autosize:!0,id:"exclusion",
validationCbk:"gridExclusionInvalidCbk",cellTemplate:"webfilter_exclusion_value.html",required:!0,minWidth:640}]});var y=function(b){if(a.edit){var c=a.edit.filtering_level;if(b||"high"!==c)a.edit.categories.high=[],angular.forEach(a.model.levels.high.categories,function(b){a.edit.categories.high.push({category:b})});if(b||"low"!==c)a.edit.categories.low=[],angular.forEach(a.model.levels.low.categories,function(b){a.edit.categories.low.push({category:b})});if(b||"med"!==c)a.edit.categories.med=[],
angular.forEach(a.model.levels.med.categories,function(b){a.edit.categories.med.push({category:b})});if(b||"custom"!==c)a.edit.categories.custom=[]}};a.changeLevel=function(){var b=a.edit.meta,c=a.edit.filtering_level;angular.forEach(b,function(a){angular.forEach(a.categories,function(a){a.checked=!1})});switch(a.edit.filtering_level){case "high":case "med":case "low":case "custom":angular.forEach(b,function(b){angular.forEach(b.categories,function(b){angular.forEach(a.edit.categories[c],function(a){a.category===
b.id&&(b.checked=!0)})})})}a.edit.meta=b};var A=function(){var b=a.edit.meta,c=a.edit.filtering_level;a.edit.categories[c]=[];a.edit.display_categories=[];angular.forEach(b,function(b){angular.forEach(b.categories,function(b){b.checked&&(a.edit.categories[c].push({category:b.id}),a.edit.display_categories.push({category:b.name}))})})},B=function(){return 50<=a.model.policys.length?(a.msg="Only allow maximum of 50 entries for Web Filtering Policies. (Current Entry Number: "+a.model.policys.length+
")",app.TOOLS.criticalAlertBox({msg:a.DICT("Web_Filtering_Max_Policy",{"%d":a.model.policys.length}),cbk:function(a){}}),!0):!1},C=function(){return 30<=a.edit.edit_white.length?(a.msg="Only allow maximum of 30 entries for White List. (Current Entry Number: "+a.edit.edit_white.length+")",app.TOOLS.criticalAlertBox({msg:a.DICT("Web_Filtering_White_List_Max",{"%d":a.edit.edit_white.length}),cbk:function(a){}}),!0):!1},D=function(){return 30<=a.edit.edit_block.length?(a.msg="Only allow maximum of 30 entries for Black List. (Current Entry Number: "+
a.edit.edit_block.length+")",app.TOOLS.criticalAlertBox({msg:a.DICT("Web_Filtering_Black_List_Max",{"%d":a.edit.edit_block.length}),cbk:function(a){}}),!0):!1},E=function(){return 30<=a.edit.edit_user_exclusion_ip.length?(a.msg="Only allow maximum of 30 entries for Exclusion List. (Current Entry Number: "+a.edit.edit_user_exclusion_ip.length+")",app.TOOLS.criticalAlertBox({msg:a.DICT("Web_Filtering_Exclusion_List_Max",{"%d":a.edit.edit_user_exclusion_ip.length}),cbk:function(a){}}),!0):!1},I=function(){var b=
{webfilter:{"blocked-page-message":a.model.block_msg}};a.model.enable!==a.model.orig_enable&&(a.model.enable&&a.model.content_filtering_enable&&(b["content-filtering"]={enable:!a.model.enable}),b.webfilter.enable=a.model.enable);return{has_modify:!0,param:b}},F=function(c){b.post({method:"del_webfilter",params:{webfilter:{policy:a.del_policys}},success:function(){"function"===$.type(c)&&c()},error:function(){"function"===$.type(c)&&c()}})},H=function(){a.gridCategoryOptions.data=a.edit.display_categories;
a.gridWhiteOptions.data=a.edit.edit_white;a.gridBlockOptions.data=a.edit.edit_block;a.gridExclusionOptions.data=a.edit.edit_user_exclusion_ip};a.funs={main:{add:function(){if(!B()){var b=0;a.edit=r({},!0);a.orig=void 0;a.edit.checked=!0;a.edit.meta=angular.copy(a.model.meta);angular.forEach(a.edit.meta,function(a){void 0!==a.name&&(a.id="group"+b,b++)});a.check_ip_group_detail();a.expandFlag=!1;a.edit.type="add";y(!0);a.changeLevel();A();H();a.currPage=z.policy_edit;a.modified()}},edit:function(){a.edit=
void 0;angular.forEach(a.model.policys,function(b){b.checked&&(a.edit=angular.copy(b),a.orig=angular.copy(b))});a.edit?(a.edit.meta=angular.copy(a.model.meta),a.check_ip_group_detail(),a.expandFlag=!1,a.edit.type="edit",y(),a.changeLevel(),A(),H(),a.currPage=z.policy_edit):Log(ERROR,"policy edit button error, checked item is not exist")},del:function(){for(var b=a.model.policys.length-1;0<=b;b--)a.model.policys[b].checked&&(a.del_policys.push({name:a.model.policys[b].name}),a.modified(),a.model.policys.splice(b,
1))},save:function(){var c=I(),d=function(){b.post({method:"set_webfilter",params:c.param,success:function(){a.success=!0;g()},error:function(){g()}})};c.has_modify?a.del_policys.length?F(d):d():a.del_policys.length&&F(function(){a.success=!0;g()})},cancel:function(){g()}},policy:{save:function(){var c,d=a.edit,e="",k="",h="",l="",p=[],r=[],A="",u={},m=!1,n=d.filtering_level,q,y,B=function(){var c=I(),p={},u={name:d.name,enable:d.enable,description:d.description,"apply-ip-group":"@none"===d.ipgroup?
!1:!0,"web-reputation":d.web_reputation,"black-domain-list":[e],"black-url-keyword-list":[k],"white-domain-list":[h],"white-url-keyword-list":[l],"user-exclusion-ip":r};"custom"===n?u.categories=[A]:(u["filtering-level"]=n,u["custom-categories"]=[],angular.forEach(d.categories[n],function(a){p[a.category]=!0;u["custom-categories"].push({category:a.category,checked:!0})}),angular.forEach(a.model.levels[n].categories,function(a){p[a]||u["custom-categories"].push({category:a,checked:!1})}));"@none"!==
d.ipgroup&&(u["ip-groups"]=[d.ipgroup]);"#always-on"===d.schedule?u["always-on"]=null:u.schedule=d.schedule;c.param.webfilter.policy=[u];b.post({method:"set_webfilter",params:c.param,success:function(){a.success=!0;g();a.currPage=z.main},error:function(){g();a.currPage=z.main}})};angular.forEach(d.block,function(a){"keyword"===a.type.select?k=k+a.value+" ":e=e+a.value+" "});angular.forEach(d.white,function(a){"keyword"===a.type.select?l=l+a.value+" ":h=h+a.value+" "});angular.forEach(d.user_exclusion_ip,
function(a,b){q={seq:b+1};switch(a.ips.select){case "ipv4-ip":angular.extend(q,{ipv4:{single:a.ips.v4_ip}});break;case "ipv4-range":angular.extend(q,{ipv4:{range:{start:a.ips.v4_rangeS,end:a.ips.v4_rangeE}}});break;case "ipv6-ip":angular.extend(q,{ipv6:{single:a.ips.v6_ip}});break;case "ipv6-range":angular.extend(q,{ipv6:{range:{start:a.ips.v6_rangeS,end:a.ips.v6_rangeE}}});break;default:return}r.push(q)});angular.forEach(d.orig_user_exclusion,function(a){y=!0;angular.forEach(r,function(b){a.seq===
b.seq&&(y=!1)});y&&p.push({seq:a.seq})});"custom"===n&&angular.forEach(d.categories.custom,function(a){A=A+a.category+" "});e=e.trim();k=k.trim();h=h.trim();l=l.trim();A=A.trim();a.orig&&(c=a.orig,m=!1,u={name:d.name},d.orig_block_domain&&d.orig_block_domain!==e&&(u["black-domain-list"]=[d.orig_block_domain],m=!0),d.orig_block_url&&d.orig_block_url!==k&&(u["black-url-keyword-list"]=[d.orig_block_url],m=!0),d.orig_white_domain&&d.orig_white_domain!==h&&(u["white-domain-list"]=[d.orig_white_domain],
m=!0),d.orig_white_url&&d.orig_white_url!==l&&(u["white-url-keyword-list"]=[d.orig_white_url],m=!0),p.length&&(u["user-exclusion-ip"]=p,m=!0),d.orig_ipgroup&&d.orig_ipgroup!==d.ipgroup&&(u["ip-groups"]=[d.orig_ipgroup],m=!0),"custom"===d.filtering_level&&("custom"===c.filtering_level&&d.orig_custom_categories&&d.orig_custom_categories!==A)&&(u.categories=[d.orig_custom_categories],m=!0),"custom"!==d.filtering_level&&c.orig_level_categories.length&&(u["custom-categories"]=c.orig_level_categories,m=
!0),c=angular.copy(a.del_policys),c.push(u),m&&b.post({method:"del_webfilter",params:{webfilter:{policy:c}},success:function(a){B()},error:function(a){B()}}));m||(a.del_policys.length?F(B):B())},cancel:function(){a.currPage=z.main;g()},goToCategoryPage:function(){a.currPage=z.category_edit},goToException:function(){a.sel_cnts.white=0;a.sel_cnts.block=0;a.sel_cnts.user_exclusion_ip=0;a.edit.edit_white=angular.copy(a.edit.white);a.edit.edit_block=angular.copy(a.edit.block);a.edit.edit_user_exclusion_ip=
angular.copy(a.edit.user_exclusion_ip);H();a.edit.white_len=a.edit.white.length;a.edit.block_len=a.edit.block.length;a.edit.user_exclusion_ip_len=a.edit.user_exclusion_ip.length;a.currPage=z.customer_rules}},filter:{save:function(){A();H();a.edit.orig_filtering_level=a.edit.filtering_level;a.currPage=z.policy_edit},cancel:function(){a.edit.filtering_level=a.edit.orig_filtering_level;a.currPage=z.main},back:function(){a.edit.filtering_level=a.edit.orig_filtering_level;a.currPage=z.policy_edit},restore:function(){a.edit.filtering_level=
"low";y(!0);a.changeLevel()}},customer:{add:function(b){switch(b){case "block":if(D())return;a.edit.edit_block.push({id:a.edit.block_len,selected:!0,edit:!0,empty:"",type:{select:a.model.schema.blockList[0]&&a.model.schema.blockList[0].id||"",list:angular.copy(a.model.schema.blockList)},value:""});a.edit.block_len+=1;a.sel_cnts.block+=1;break;case "white":if(C())return;a.edit.edit_white.push({id:a.edit.white_len,selected:!0,edit:!0,empty:"",type:{select:a.model.schema.whiteList[0]&&a.model.schema.whiteList[0].id||
"",list:angular.copy(a.model.schema.whiteList)},value:""});a.edit.white_len+=1;a.sel_cnts.white+=1;break;case "user_exclusion_ip":if(E())return;b=d();b.seq=a.edit.edit_user_exclusion_ip.length;b.id=a.edit.edit_user_exclusion_ip.length;b.edit=!0;b.selected=!0;a.edit.edit_user_exclusion_ip.push(b);a.edit.user_exclusion_ip_len+=1;a.sel_cnts.user_exclusion_ip+=1}a.modified()},del:function(b){var c=a.edit;switch(b){case "block":for(b=c.edit_block.length-1;0<=b;b--)c.edit_block[b].selected&&(c.edit_block.splice(b,
1),a.modified(),a.sel_cnts.block-=1);break;case "white":for(b=c.edit_white.length-1;0<=b;b--)c.edit_white[b].selected&&(c.edit_white.splice(b,1),a.modified(),a.sel_cnts.white-=1);break;case "user_exclusion_ip":for(b=c.edit_user_exclusion_ip.length-1;0<=b;b--)c.edit_user_exclusion_ip[b].selected&&(c.edit_user_exclusion_ip.splice(b,1),a.modified(),a.sel_cnts.user_exclusion_ip-=1)}},edit:function(b){var c=a.edit;switch(b){case "block":angular.forEach(c.edit_block,function(a){a.selected&&(a.edit=!0)});
break;case "white":angular.forEach(c.edit_white,function(a){a.selected&&(a.edit=!0)});break;case "user_exclusion_ip":angular.forEach(c.edit_user_exclusion_ip,function(a){a.selected&&(a.edit=!0)})}},save:function(){angular.forEach(a.edit.edit_block,function(a){a.selected=!1;a.edit=!1});angular.forEach(a.edit.edit_white,function(a){a.selected=!1;a.edit=!1});angular.forEach(a.edit.edit_user_exclusion_ip,function(a){a.selected=!1;a.edit=!1});a.edit.block=a.edit.edit_block;a.edit.white=a.edit.edit_white;
a.edit.user_exclusion_ip=a.edit.edit_user_exclusion_ip;a.currPage=z.policy_edit},cancel:function(){a.currPage=z.main},back:function(){a.currPage=z.policy_edit}},urllookup:function(){var c=function(b){b=b&&b.data&&b.data.result&&b.data.result.output||{};var c,d="";(c=b.category.split(","))&&angular.forEach(c,function(b){d&&(d+=", ");d=a.model.categories[b]?d+a.model.categories[b].name:d+b});d||(d="--");a.model.urllookup.category=d;a.model.urllookup.reputation=b.reputation||"--";a.model.urllookup.status=
b.status||"--"};(function(){b.post({url:resource_base+"data/urllookup.json",method:"action",params:{input:{url:a.model.urllookup.url},rpc:"url-lookup"},procBackground:!0,success:function(a){c(a)},error:function(a){Log(ERROR,"[webFilteringCtrl] urllookup() RPC error")}})})()}};a.changeEnable=function(){if(a.model.enable&&a.model.content_filtering_enable&&a.model.ori_status!==a.model.enable){var b="<div>"+a.DICT("Web_Filtering_Msg1")+"</div>",b=b+"<div>"+a.DICT("Web_Filtering_Msg2")+"</div>",b=b+"<div>"+
a.DICT("Web_Filtering_Msg3")+"</div>";app.TOOLS.warningAlertBox({msg:b,btn_yes_str:a.DICT("Web_Filtering_Apply"),btn_no_str:a.DICT("Web_Filtering_Cancel"),width:550,cbk:function(b){b||(a.model.enable=!a.model.enable)}})}};a.checkPolicyName=function(){var b=!0;if(!a.edit.name||a.orig)return b;angular.forEach(a.model.policys,function(c){a.edit.name===c.name&&(b=!1)});return b};a.expandAll=function(b){"true"===b?(angular.forEach(a.edit.meta,function(a){a.expanded=!0;angular.forEach(a.categories,function(a){a.expanded=
!0})}),a.expandFlag=!0):(angular.forEach(a.edit.meta,function(a){a.expanded=!1;angular.forEach(a.categories,function(a){a.expanded=!1})}),a.expandFlag=!1)};a.combineNote=a.DICT("Web_Filtering_Note",{"%s":'<a id="link" href="#/Admin_License"><u>'+a.DICT("Web_Filtering_Here")+"</u></a>"});a.combineMsg1=a.DICT("Web_Filtering_URL_Msg1",{"%s":'<a target="#" href="http://www.brightcloud.com/tools/change-request-url-categorization.php"><span style="text-decoration: underline;">'+a.DICT("Web_Filtering_Here")+
"</span></a>"});a.combineMsg2=a.DICT("Web_Filtering_URL_Msg2",{"%s":'<a target="#" href="http://www.brightcloud.com/tools/change-request-url-reputation.php"><span style="text-decoration: underline;">'+a.DICT("Web_Filtering_Here")+"</span></a>"});(function(){a.dataReady=!1;a.del_policys=[];a.model.schema={blockList:[{id:"domain",displayName:a.DICT("Web_Filtering_Domain_Name")},{id:"keyword",displayName:a.DICT("Web_Filtering_Keyword")}],whiteList:[{id:"domain",displayName:a.DICT("Web_Filtering_Domain_Name")},
{id:"keyword",displayName:a.DICT("Web_Filtering_Keyword")}],userExclusionList:[{id:"ipv4-ip",displayName:a.DICT("Web_Filtering_IPv4_Addr")},{id:"ipv4-range",displayName:a.DICT("Web_Filtering_IPv4_Range")},{id:"ipv6-ip",displayName:a.DICT("Web_Filtering_IPv6_Addr")},{id:"ipv6-range",displayName:a.DICT("Web_Filtering_IPv6_Range")}]};w();v.all([u(),b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup"}),b.post({url:resource_base+"data/schedule.json",method:"get_schedule"}),h()]).then(function(b){c(q(b,
1));k(q(b,2));x(q(b,0));p(q(b,3));a.dataReady=!0})})()}]);app.controller("DashboardCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","dt","$uibModal",function(a,b,s,n,v,t,m){var q=app.TOOLS.getVal,e=app.TOOLS.str2int,w=app.TOOLS.int2str2,l=app.TOOLS.getResponse,h=void 0,p=void 0;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var u=function(){return b.post({method:"get_time",url:resource_base+"data/time.json",error:function(a){Log(ERROR,"[Dashboard] getSystemState Error "+
JSON.stringify(a));x()}})},x=function(b){b||(b={});b=t.parser(((b["system-state"]||{}).clock||{})["current-datetime"]||"");0===b.err_code?(a.model.sys_timestamp=t.get_time(b),a.model.standard_timestamp=t.get_time(b)):(a.model.sys_time="-",a.model.sys_timestamp=void 0,a.model.standard_timestamp=void 0);G();H()},r=function(a,b,c){b||(b={});var d=b.summary||[];b=b["last-reset-time"]||"";var e=!1,g=!1,k=!1,h=!1,l=function(a,b){_.isNumber(a.scanned)&&a.scanned>b&&(a.scanned=b+"+");_.isNumber(a.detected)&&
a.detected>b&&(a.detected=b+"+")},p=999;"total"===c&&(p=1998);a.time="-";b&&(c=t.parser(b),0===c.err_code&&(a.time=t.timeStr(c)));angular.forEach(a,function(a,b){switch(b){case "today":case "week":case "month":case "total":a.scanned="-",a.detected="-"}});angular.forEach(d,function(b){1===b.months&&(0===b.weeks&&0===b.days&&0===b.hours)&&(a.month.scanned=q(b.scanned,"-"),a.month.detected=q(b.detected,"-"),l(a.month,p),k=!0);0===b.months&&(1===b.weeks&&0===b.days&&0===b.hours)&&(a.week.scanned=q(b.scanned,
"-"),a.week.detected=q(b.detected,"-"),l(a.week,p),g=!0);0===b.months&&(0===b.weeks&&1===b.days&&0===b.hours)&&(a.today.scanned=q(b.scanned,"-"),a.today.detected=q(b.detected,"-"),l(a.today,p),e=!0);1!==b.months+b.weeks+b.days+b.hours&&a.total&&(a.total.scanned=q(b.scanned,"-"),a.total.detected=q(b.detected,"-"),l(a.total,p),h=!0)});!h&&a.total&&(k?(a.total.scanned=a.month.scanned,a.total.detected=a.month.detected):g?(a.total.scanned=a.week.scanned,a.total.detected=a.week.detected):e&&(a.total.scanned=
a.today.scanned,a.total.detected=a.today.detected),l(a.total,p))},d=function(){return b.post({method:"get_security_state",url:resource_base+"data/get_security_state.json",error:function(a){c();Log(ERROR,"[Dashboard] getSecurityState Error "+JSON.stringify(a))}})},c=function(b){b||(b={});var c=b["security-state"]||{};b=c.events||[];var d=b.length,g,k,h,l=a.model.standard_timestamp,p={},z={},u={},A=a.model.total,m=A.today,n=A.week,y=A.month;r(a.model.total,c,"total");m.events=[];n.events=[];y.events=
[];m.labels=[];n.labels=[];y.labels=[];if(!d||!_.isNumber(l)){for(c=0;24>c;c++)m.events.push(0),m.labels.push("");for(c=0;7>c;c++)n.events.push(0),n.labels.push("");for(c=0;31>c;c++)y.events.push(0),y.labels.push("")}else{l=a.model.standard_timestamp;for(c=0;24>c;c++)d=t.new_date(l-36E5*c),m.events[c]=0,m.colors[c]="#4BBEC5",m.labels[c]=w(d.hour)+":00",p[t.timeStr(d,"YYYY-MM-DD hh")]=c;l=a.model.standard_timestamp;for(c=0;31>c;c++)d=t.new_date(l-864E5*c),7>c&&(n.events[c]=0,n.colors[c]="#4BBEC5",
n.labels[c]=t.dayWeekStr[d.day_week],z[t.timeStr(d,"YYYY-MM-DD")]=c),y.events[c]=0,y.colors[c]="#4BBEC5",y.labels[c]=t.timeStr(d,"MM/DD"),u[t.timeStr(d,"YYYY-MM-DD")]=c;angular.forEach(b,function(a){g=t.parser(a.date);0!==g.err_code?Log(DEBUG,"[DashboardCtrl] procSecurityState() Err, date is incorrect"+JSON.stringify(a)):(h=e(q(a["event-num"],0)),k=t.timeStr(g,"YYYY-MM-DD"),void 0!==u[k]&&(y.events[u[k]]+=h),void 0!==z[k]&&(n.events[z[k]]+=h),k=t.timeStr(g,"YYYY-MM-DD hh"),void 0!==p[k]&&(m.events[p[k]]+=
h))});m.events.reverse();m.labels.reverse();m.colors.reverse();n.events.reverse();n.labels.reverse();n.colors.reverse();y.events.reverse();y.labels.reverse();y.colors.reverse()}},k=function(){s.all([u(),d(),y(),g(),B("threat"),B("ips"),D(),I()]).then(function(b){x(l(b,0));var d=l(b,2);d||(d={});d=q(d.status,0);a.model.no_license=0===d;a.model.no_license?(c({}),A({}),z({}),C({},"threat"),C({},"ips"),E({},"threat"),E({},"ips")):(c(l(b,1)),A(l(b,2)),z(l(b,3)),C(l(b,4),"threat"),C(l(b,5),"ips"),E(l(b,
6),"threat"),E(l(b,7),"ips"));F();a.ui_data.data_ready=!0})},g=function(){return b.post({method:"get_ips_state",url:resource_base+"data/get_ips_state.json",error:function(a){Log(ERROR,"[Dashboard] getIPSState() error "+JSON.stringify(a))}})},z=function(b){b||(b={});r(a.model.ips,b["ips-state"]||{},"ips")},y=function(){return b.post({method:"get_anti_virus_state",url:resource_base+"data/get_anti_virus_state.json",error:function(a){Log(ERROR,"[Dashboard] getAntiVirusState() error "+JSON.stringify(a));
z()}})},A=function(b){b||(b={});r(a.model.threat,b["anti-virus-state"]||{},"virus")},B=function(c){var d=resource_base+"data/get_top_clients.json";switch(c){case "ips":c="ips";d=resource_base+"data/get_top_clients.json";break;default:c="threat",d=resource_base+"data/get_top_clients.json"}return b.post({method:"action",url:d,params:{rpc:"get-top-clients",input:{num:a.ui_data.top_cnt,type:c}},error:function(a){Log(ERROR,"[Dashboard] getTopClients() error , type "+c+" errstr "+JSON.stringify(a));C(void 0,
c)}})},C=function(b,c){b||(b={});var d=(b.output||{}).clients||[],e,g,k,h,l;switch(c){case "ips":e=a.model.ips.top_client;l="attacks-count";break;default:e=a.model.threat.top_client,l="threats-count"}e.info=[];e.labels=[];e.data=[];angular.forEach(d,function(a){k=q(a[l],1);h=q(a.hostname,"-");g={mac:a.mac||"-",ipv4_address:a["ipv4-address"]||"-",ipv6_address:a["ipv6-address"]||"-",hostname:h,device_type:a["device-type"]||"-",os_type:a["os-type"]||"-",count:k};e.info.push(g);e.data.push(k);e.labels.push(h)});
e.data.length||(e.data.push(1),e.labels.push(["empty"]))},D=function(){return b.post({method:"action",url:resource_base+"data/get_top_threats.json",params:{rpc:"get-top-threats",input:{num:a.ui_data.top_cnt}},error:function(a){Log(ERROR,"[Dashboard] getTopThreats() error "+JSON.stringify(a));E(void 0,"threat")}})},E=function(b,c){b||(b={});var d=(b.output||{}).attacks||[],e,g,k,h;switch(c){case "ips":h=a.model.ips.top_ips;break;default:h=a.model.threat.top_threats}h.info=[];h.data=[];h.labels=[];
angular.forEach(d,function(a){k=q(a["clients-count"],1);g=q(a.id,"-");e={id:g,name:a.name||"-",impact:a.impact||"-",description:a.description||"-",recommendation:a.recommendation||"-",reference:a.reference||"-",issue_date:t.genTimeStrByTimeStamp(a["issue-date"],"-"),updated_date:t.genTimeStrByTimeStamp(a["updated-date"],"-"),category:a.category||"-",severity:a.severity||"-",count:k};h.info.push(e);h.data.push(k);h.labels.push(g)});h.info.length||(h.data.push(1),h.labels.push(["empty"]))},I=function(){return b.post({method:"action",
url:resource_base+"data/get_top_attacks.json",params:{rpc:"get-top-attacks",input:{num:a.ui_data.top_cnt}},error:function(a){Log(ERROR,"[Dashboard] getTopIPS() error "+JSON.stringify(a));E(void 0,"ips")}})},F=function(){angular.forEach(a.ui_data.tabs,function(b){b.active=b.name===a.ui_data.tab_sel})},H=function(){h&&(clearInterval(h),h=void 0);h=setInterval(function(){_.isNumber(a.model.sys_timestamp)?(a.model.sys_timestamp+=1E3,G()):clearInterval()},1E3)},G=function(){var b;_.isNumber(a.model.sys_timestamp)?
(b=t.new_date(a.model.sys_timestamp),a.model.sys_time=t.timeStr(b),J()):a.model.sys_time="-"},J=function(){p&&clearTimeout(p);p=setTimeout(function(){app.TOOLS.apply(a);p=void 0},20)};a.edit=void 0;a.detail=void 0;a.ui_data={today_boundary:Number.MAX_SAFE_INTEGER,week_boundary:Number.MAX_SAFE_INTEGER,month_boundary:Number.MAX_SAFE_INTEGER,data_ready:!1,tabs:[{heading:a.DICT("Dashboard_Total"),templateUrl:"dashboard_total.htm",name:"total",active:!1},{heading:a.DICT("Dashboard_Threat"),templateUrl:"dashboard_threat.htm",
name:"threat",active:!1},{heading:a.DICT("Dashboard_IPS"),templateUrl:"dashboard_ips.htm",name:"ips",action:!1}],tab_sel:"total",evt_list:[{id:"today",displayName:a.DICT("Dashboard_Last_24_Hours")},{id:"week",displayName:a.DICT("Dashboard_Last_Week")},{id:"month",displayName:a.DICT("Dashboard_Last_Month")}],evt_serious:["number"],evt_month_labels:[],evt_week_labels:[],evt_day_labels:[],evt_sel:"today",evt_colors:app.chart.backgroundColors,evt_options:{animation:!1,maintainAspectRatio:!1,tooltips:{callbacks:{label:function(a,
b){var c=b.datasets[a.datasetIndex].data[a.index];b.labels[a.index]||(c="Empty");0===c&&(c+="");return c}}},scales:{xAxes:[{gridLines:{display:!1},categoryPercentage:0.8,barPercentage:1}],yAxes:[{min:0,ticks:{beginAtZero:!0,suggestedMin:0,suggestedMax:100}}]}},top_cnt:10,pie_options:{animation:!1,maintainAspectRatio:!1,tooltips:{callbacks:{label:function(a,b){var c=b.labels[a.index],d=": "+b.datasets[a.datasetIndex].data[a.index];return c=_.isArray(c)&&"empty"===c[0]?"Empty: 0":c+d}}}},combineNote:a.DICT("Dashboard_Note",
{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Here")+"</u></a>"})};a.model={no_license:!0,sys_time:"",sys_timestamp:void 0,standard_timestamp:void 0,total:{time:"",today:{scanned:"",detected:"",labels:[],events:[],colors:[]},week:{scanned:"",detected:"",labels:[],events:[],colors:[]},month:{scanned:"",detected:"",labels:[],events:[],colors:[]},selected_event:"today"},threat:{time:"",today:{scanned:"",detected:""},week:{scanned:"",detected:""},total:{scanned:"",detected:""},
top_client:{info:[],data:[],labels:[]},top_threats:{info:[],data:[],labels:[]}},ips:{time:"",today:{scanned:"",detected:""},week:{scanned:"",detected:""},total:{scanned:"",detected:""},top_client:{info:[],data:[],labels:[]},top_ips:{info:[],data:[],labels:[]}}};var L=function(a,b,c){var d;if(b)return angular.forEach(a,function(a){a[c]===b._model.label&&(d=a)}),angular.copy(d)},N=function(a,b){a&&m.open({templateUrl:"dashboard_modal.html",controller:"DashboardModalCtrl",backdrop:"static",size:"dashboard",
resolve:{edit:function(){return a},type:function(){return b}}}).result.then(function(){},function(){})};a.funs={change_event:function(){},click_tab:function(b){a.model.no_license||(a.ui_data.tab_sel=b.name,F())},click_threat_client:function(b,c,d){a.edit=L(a.model.threat.top_client.info,d,"hostname");N(a.edit,"threat_client")},click_threat_detect:function(b,c,d){a.edit=L(a.model.threat.top_threats.info,d,"id");N(a.edit,"threat_detect")},click_ips_client:function(b,c,d){a.edit=L(a.model.ips.top_client.info,
d,"hostname");N(a.edit,"ips_client")},click_ips_attack:function(b,c,d){a.edit=L(a.model.ips.top_ips.info,d,"id");N(a.edit,"ips_attack")},reset:function(){app.TOOLS.warningAlertBox({msg:a.DICT("Dashboard_Reset_Note"),cbk:function(a){a&&b.post({method:"action",params:{rpc:"reset-security-state"},success:function(a){k()},error:function(a){k()}})}})}};a.$on("$destroy",function(){h&&(clearInterval(h),h=void 0)});k()}]);
app.controller("DashboardModalCtrl",["$scope","$q","MyHttp","type","edit","$uibModalInstance","$uibModal","dt",function(a,b,s,n,v,t,m,q){var e=app.TOOLS.getVal;a.time_list=[{id:"today",displayName:a.DICT("Dashboard_Today")},{id:"week",displayName:a.DICT("Dashboard_Last_7_Days")},{id:"total",displayName:a.DICT("Dashboard_Since_Activated")}];a.edit=v;a.type=n;a.m={time:"total"};a.title="";var w=function(b){b||(b={});b=(b.output||{}).clients||[];var d,c;a.edit.list=[];angular.forEach(b,function(b){d=
{client_info:[],remote_ip:b["remote-ip"]||"-",port:e(b.port,"-"),date:q.genTimeStrByTimeStamp(b.date,"-"),id:e(b.id,"-"),name:b.name||"-",mac:b.mae||"-",ipv4_addr:b["ipv4-address"]||"-",ipv6_addr:b["ipv6-address"]||"-",hostname:b.hostname||"-",device_type:b["device-type"]||"-",os_type:b["os-type"]||"-",remote_file:"-",threat:"-",attack:"-"};c="";"-"!==d.ipv4_addr&&(c=d.ipv4_addr);"-"!==d.ipv6_address&&"::"!==d.ipv6_address&&(c&&(c+=", "),c+=d.ipv6_addr);c||(c="-");d.client_info.push(d.hostname);d.client_info.push(c);
d.client_info.push(d.os_type);d.client_info.push(d.device_type);a.edit.list.push(d)});"ips_attack"===n?a.gridIpsAttackOptions.data=a.edit.list:a.gridThreatDetectedOptions.data=a.edit.list},l=function(b){b||(b={});b=(b.output||{}).attacks||[];var d;a.edit.list=[];angular.forEach(b,function(b){d={remote_ip:b["remote-ip"]||"-",port:e(b.port,"-"),date:q.genTimeStrByTimeStamp(b.date,"-"),id:e(b.id,"-"),name:b.name||"-",impact:b.impact||"-",description:b.description||"-",recommendation:b.recommendation||
"-",reference:b.reference||"-",issue_date:q.genTimeStrByTimeStamp(b["issue-date"],"-"),update_date:q.genTimeStrByTimeStamp(b["update-date"],"-"),category:b.category||"-",severity:b.severity||"-",attack:"-"};a.edit.list.push(d)});a.gridIpsClientsOption.data=a.edit.list},h=function(b){b||(b={});b=(b.output||{}).threats||[];var d;a.edit.list=[];angular.forEach(b,function(b){d={remote_ip:b["remote-ip"]||"-",port:e(b.port,"-"),date:q.genTimeStrByTimeStamp(b.date,"-"),id:b.id||"-",category:b.category||
"-",name:b.name||"-",remote_file:"-",threat:"-"};a.edit.list.push(d)});a.gridThreatClientOptions.data=a.edit.list},p=function(b,d){if(d&&void 0!==b){var c=(d.output||{}).signatures||[];a.detail=void 0;angular.forEach(c,function(c){c.id===b&&(a.detail={id:e(c.id,"-"),name:c.name||"-",os_type:"-",impact:c.impact||"-",description:c.description||"-",recommendation:c.recommendation||"-",reference:c.reference||"-",issue_date:q.genTimeStrByTimeStamp(c["issue-date"],"-"),updated_date:q.genTimeStrByTimeStamp(c["updated-date"],
"-"),category:c.category||"-",severity:c.severity||"-"})})}},u=function(){var b,d={},c,e;switch(a.m.time){case "today":b={hours:0,days:1,weeks:0,months:0};break;case "week":b={hours:0,days:0,weeks:1,months:0};break;default:b={hours:1,days:1,weeks:1,months:1}}switch(n){case "ips_attack":d.rpc="get-clients-per-event";b.event=a.edit.id;b.type="ips";c=w;e="data/get_clients_per_event.json";break;case "ips_client":d.rpc="get-attacks-per-client";b.client=a.edit.mac.toLowerCase();c=l;e="data/get_attacks_per_client.json";
break;case "threat_client":d.rpc="get-threats-per-client";b.client=a.edit.mac.toLowerCase();c=h;e="data/get_threats_per_client.json";break;default:d.rpc="get-clients-per-event",b.event=a.edit.id,b.type="threat",c=w,e="data/get_clients_per_event.json"}d.input=b;s.post({url:resource_base+e,method:"action",params:d,success:function(a){c(a.data&&a.data.result)},error:function(a){Log(ERROR,"[DashboardModalCtrl] doRpc() error "+JSON.stringify(a));c()}})},x=function(){a.detail&&m.open({templateUrl:"dashboard_detail_modal.html",
controller:"DashboardDetalModalCtrl",backdrop:"static",size:"dashboard",resolve:{detail:function(){return a.detail}}})};b=function(b,d,c,e){var g=d.entity.id;a.detail=void 0;s.post({url:resource_base+"data/get_ips_signatures.json",method:"action",params:{rpc:"get-ips-signatures",input:{query:g,"page-size":1,"page-num":1}},success:function(a){p(g,a.data&&a.data.result);x()},error:function(a){p(g);Log("[Dashboard] clickSignature() error "+JSON.stringify(a))}})};a.gridThreatClientOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"remote_ip",
displayName:a.DICT("Dashboard_Remote_Ip")},{field:"port",displayName:a.DICT("Dashboard_Remote_Port")},{field:"name",displayName:a.DICT("Dashboard_Threat")},{field:"category",displayName:a.DICT("Dashboard_Action")},{field:"date",displayName:a.DICT("Dashboard_Detected_Date_Time"),minWidth:230}]});a.gridThreatDetectedOptions=app.uiGrid.generateGridOptions({rowHeight:2.5*app.uiGrid.rowHeight,columnDefs:[{field:"client_info",displayName:a.DICT("Dashboard_Client_Detail_Name"),cellTemplate:"dashboard_client_info.html"},
{field:"remote_ip",displayName:a.DICT("Dashboard_Remote_Ip")},{field:"port",displayName:a.DICT("Dashboard_Remote_Port")},{field:"name",displayName:a.DICT("Dashboard_Threat")},{field:"date",displayName:a.DICT("Dashboard_Detected_Date_Time"),minWidth:230}]});a.gridIpsClientsOption=app.uiGrid.generateGridOptions({columnDefs:[{field:"remote_ip",displayName:a.DICT("Dashboard_Remote_Ip")},{field:"port",displayName:a.DICT("Dashboard_Remote_Port")},{field:"name",displayName:a.DICT("Dashboard_Attack")},{field:"category",
displayName:a.DICT("Dashboard_Attack_Categoty")},{field:"id",displayName:a.DICT("Dashboard_Signature_Id"),cellTemplate:"UG_table_text_with_inline_href_click.html",click:b},{field:"date",displayName:a.DICT("Dashboard_Detected_Date_Time"),minWidth:230}]});a.gridIpsAttackOptions=app.uiGrid.generateGridOptions({rowHeight:2.5*app.uiGrid.rowHeight,columnDefs:[{field:"client_info",displayName:a.DICT("Dashboard_Client_Detail_Name"),cellTemplate:"dashboard_client_info.html"},{field:"remote_ip",displayName:a.DICT("Dashboard_Remote_Ip")},
{field:"port",displayName:a.DICT("Dashboard_Remote_Port")},{field:"name",displayName:a.DICT("Dashboard_Attack")},{field:"id",displayName:a.DICT("Dashboard_Signature_Id"),cellTemplate:"UG_table_text_with_inline_href_click.html",click:b},{field:"date",displayName:a.DICT("Dashboard_Detected_Date_Time"),minWidth:230}]});a.change_threat=function(){u()};a.close=function(){t.close(a.edit)};switch(n){case "threat_client":a.title=a.DICT("Dashboard_Hostname")+": "+a.edit.hostname;break;case "threat_detect":a.title=
a.DICT("Dashboard_Threat")+": "+a.edit.name;break;case "ips_client":a.title=a.DICT("Dashboard_Hostname")+": "+a.edit.hostname;break;default:a.title=a.DICT("Dashboard_IPS_Category")+": "+a.edit.category}u()}]);app.controller("DashboardDetalModalCtrl",["$scope","$uibModalInstance","detail",function(a,b,s){a.detail=s;a.close=function(){b.close()}}]);app.controller("ipSrcGuardCtrl",["$scope","MyHttp","$templateCache","UserSession","userAccessRight","modelInfo",function(a,b,s,n,v,t){var m;a.success=!1;a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var q=function(){b.post({url:resource_base+"data/ip_source_guard.json",method:"get_ip_source_guard",success:function(a){a.data&&a.data.result?e(a.data.result):e()},error:function(a){e()}})},e=function(b){b||(b={});var e=b["block-unknown-binding"]||{},h=e["static-bindings"]||
[],l=[];b["dhcp-binding-state"]&&b["dhcp-binding-state"].entry&&(l=b["dhcp-binding-state"].entry);a.model.block_unknown_mac_address=void 0!==e["block-unknown-mac-address"]?e["block-unknown-mac-address"]:!1;a.model.block_unknown_binding=void 0!==e["block-unknown-binding"]?e["block-unknown-binding"]:!1;a.model.static_bindings=[];a.model.dhcp_binding_static=[];angular.forEach(h,function(b){a.model.static_bindings.push(w(b))});angular.forEach(l,function(b,c){a.model.dhcp_binding_static.push({name:c,mac:b.mac||
"",ip:b["ip-address"]||"",action:[{cbk:function(c,e){var h=-1,l;angular.forEach(a.model.static_bindings,function(a,c){a.mac===b.mac&&(h=c)});l=w(b);-1===h?a.model.static_bindings.push(l):a.model.static_bindings[h]=l;h=-1;angular.forEach(a.model.dhcp_binding_static,function(a,c){a.mac===b.mac&&(h=c)});-1!==h&&a.model.dhcp_binding_static.splice(h,1);a.modified()},displayName:a.DICT("IP_Source_Guard_Add_To_Bind")}]})});m=angular.copy(a.model.static_bindings);a.gridDHCPLeaseOptions.data=a.model.dhcp_binding_static;
a.gridBindingOptions.data=a.model.static_bindings;a.dataReady=!0},w=function(a){a||(a={});return{checked:!1,edit:!1,isRepeat:!1,disableChk:!1,ip:a["ip-address"]||"",name:a.name||"",mac:a.mac||"",enable:void 0!==a.enable?a.enable:!0}};n=function(b){a.sel_cnts=0;angular.forEach(a.model.static_bindings,function(b,e){b.checked?a.sel_cnts+=1:(b.edit=!1,void 0==b.ip&&(b.ip=""),void 0==b.mac&&(b.mac=""))})};var l=function(){a.sel_cnts=0;q();a.updateMaxEntry();a.resetModified()};m=[];var h=function(b){var e=
a.isrv345,h=a.model.block_unknown_binding||!1,l=a.model.static_bindings.length||0,e=h^(a.model.block_unknown_mac_address||0)?h?e?100:45:e?100:90:e?100:45;return(b?l>=e:l>e)?(Log(DEBUG,"warning"),a.msg="Only allow maximum of "+e+" entries for IP & MAC Binding Table.(Current Entry Number: "+l+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.chkMac=function(b){b=a.model.static_bindings;var e=b.length,h,l;angular.forEach(b,function(a){a.isRepeat=!1});for(h=0;h<e;h++)for(l=h+1;l<
e;l++)b[h].mac===b[l].mac&&(b[h].isRepeat=!0,b[l].isRepeat=!0)};a.dataReady=!1;a.sel_cnts=0;a.rv345_flag=!1;a.rv345p_flag=!1;a.isrv345=!1;0<=t.get_pid().search("RV345")?a.rv345_flag=!0:0<=t.get_pid().search("RV345P")&&(a.rv345p_flag=!0);a.isrv345=a.rv345_flag||a.rv345p_flag;a.model={block_unknown_mac_address:!1,block_unknown_binding:!1,static_bindings:[],dhcp_binding_static:[]};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridBindingOptions=app.uiGrid.generateGridOptions({IDPreifx:"ipmacbinding",
columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:n,headerChangedCbk:n,disableChkBoxField:"disableChk"},{field:"ip",displayName:a.DICT("IP_Source_Guard_Static_IPv4_Addr"),editRow:"edit",id:"ip",validationCbk:"gridInvalidCbk",cellTemplate:s.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-ip ")},{field:"mac",displayName:a.DICT("IP_Source_Guard_MAC_Addr"),required:!0,editRow:"edit",id:"mac",validationCbk:"gridInvalidCbk",change:a.chkMac,invalidField:"isRepeat",invalidName:"isRepeat",
cellTemplate:s.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"mac-address ")}]});a.gridDHCPLeaseOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"ip",displayName:a.DICT("IP_Source_Guard_IPv4_Addr")},{field:"mac",displayName:a.DICT("IP_Source_Guard_MAC_Addr")},{field:"action",visible:!a.isrv345,displayName:a.DICT("IP_Source_Guard_Action"),cellTemplate:"UG_table_buttons.html"}]});a.funs={add:function(){if(!h(!0)){var b=w();b.edit=!0;b.checked=!0;a.model.static_bindings.push(b);
a.sel_cnts+=1;a.gridBindingOptions.gridApi.customApi.scrollToLast();a.modified()}},edit:function(){angular.forEach(a.model.static_bindings,function(a){a.checked&&(a.edit=!0)})},del:function(){for(var b=a.model.static_bindings.length-1;0<=b;b--)a.model.static_bindings[b].checked&&(a.sel_cnts-=1,a.model.static_bindings.splice(b,1))},save:function(){if(!h(!1)){var e=[],u;angular.forEach(m,function(b){u=!0;angular.forEach(a.model.static_bindings,function(a){b.mac===a.mac&&(u=!1)});u&&e.push({mac:b.mac})});
e=[];angular.forEach(a.model.static_bindings,function(a){e.push({mac:a.mac,"ip-address":a.ip,name:a.name,enable:a.enable})});b.post({method:"set_ip_source_guard",params:{"block-unknown-binding":{"static-bindings":e,"block-unknown-mac-address":a.model.block_unknown_mac_address,"block-unknown-binding":a.model.block_unknown_binding}},success:function(b){a.success=!0;l()},error:function(a){l()}})}},cancel:function(){l()}};a.updateMaxEntry=function(){var b=a.isrv345,e=a.model.block_unknown_mac_address||
!1;a.model.maxentry=(a.model.block_unknown_binding||0)^e?e?b?100:90:b?100:45:b?100:45};l()}]);app.controller("contentFilterCtrl",["$scope","MyHttp","$q","pgWindow","$templateCache","UserSession","userAccessRight",function(a,b,s,n,v,t,m){var q,e,w,l;a.success=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var h=function(){return b.post({url:resource_base+"data/security_content_filter.json",method:"get_content_filter",error:function(a){p()}})},p=function(b){b||(b={});b=b["content-filtering"]||{};var c=b.allow_rules||{},d=b.block_rules||{},g=d.block_url_rules||
[],d=d.block_keyword_rules||[],k=c.allow_url_rules||[],c=c.allow_keyword_rules||[];a.model.type="block";a.model.enable=void 0!==b.enable?b.enable:!1;a.model.ori_status=a.model.enable;switch(b["filtering-type"]){case "ALLOW_LIST":a.model.type="allow";break;default:a.model.type="block"}a.model.blockUrls=[];a.model.blockKeys=[];a.model.allowUrls=[];a.model.allowKeys=[];angular.forEach(g,function(b,c){a.model.blockUrls.push(u(b))});angular.forEach(d,function(b){a.model.blockKeys.push(x(b))});angular.forEach(k,
function(b){a.model.allowUrls.push(u(b))});angular.forEach(c,function(b){a.model.allowKeys.push(x(b))});angular.copy(a.model.type);q=angular.copy(a.model.blockUrls);e=angular.copy(a.model.blockKeys);w=angular.copy(a.model.allowUrls);l=angular.copy(a.model.allowKeys);a.gridBlockUrlOptions.data=a.model.blockUrls;a.gridBlockKeywordOptions.data=a.model.blockKeys;a.gridAllowUrlOptions.data=a.model.allowUrls;a.gridAllowKeywordOptions.data=a.model.allowKeys;a.dataReady=!0},u=function(b){var c={edit:!1,selected:!1,
invalid:!1,empty:"",disableChkBox:!1,name:"",schedule:{select:"!always",list:angular.copy(a.model.schedules)}};if(!b)return c;angular.forEach(b,function(a,b){switch(b){case "domain-name":c.name=a;break;case "schedule":c.schedule.select=a}});return c},x=function(b){var c={edit:!1,selected:!1,invalid:!1,empty:"",disableChkBox:!1,name:"",schedule:{select:"!always",list:angular.copy(a.model.schedules)}};if(!b)return c;angular.forEach(b,function(a,b){switch(b){case "keyword-name":c.name=a;break;case "schedule":c.schedule.select=
a}});return c},r=function(){return b.post({url:resource_base+"data/schedule.json",method:"get_schedule",error:function(a){d()}})},d=function(b){b||(b={});var c=[];b.schedules&&b.schedules.schedule&&(c=b.schedules.schedule);a.model.schedules=[{id:"!always",displayName:a.DICT("Always")}];angular.forEach(c,function(b,c){a.model.schedules.push({id:b.name,displayName:a.DICT(b.name)})})},c=function(){a.dataReady=!1;s.all([r(),h(),b.post({url:resource_base+"data/web_filtering.json",method:"get_webfilter"})]).then(function(b){a.reset();
d(b[0].data&&b[0].data.result);p(b[1].data&&b[1].data.result);(b=b[2].data&&b[2].data.result)||(b={});a.model.webfilter_enable=(b&&b.webfilter||{}).enable||!1;a.resetModified()})};n=function(b){return function(c){a.sel_cnts[b]=0;angular.forEach(a.model[b],function(c){c.selected?a.sel_cnts[b]+=1:c.edit=!1})}};q=[];e=[];w=[];l=[];a.dataReady=!1;a.reset=function(){a.sel_cnts={blockUrls:0,blockKeys:0,allowUrls:0,allowKeys:0}};a.sel_cnts={blockUrls:0,blockKeys:0,allowUrls:0,allowKeys:0};a.model={blockUrls:[],
blockKeys:[],allowUrls:[],allowKeys:[],schedules:[],type:"block",enable:!0,ori_status:!1,webfilter_enable:!1};a.multiValidation=function(a,b){var c,d,e;angular.forEach(a,function(a){a.invalid=!1});e=a.length;for(c=0;c<e;c++)for(d=c+1;d<e;d++)a[c].name===a[d].name&&(a[c].invalid=!0,a[d].invalid=!0)};a.blockUrlCbk=function(b,c,d){a.multiValidation(a.model.blockUrls,"blockUrls")};a.blockKeyCbk=function(b,c,d){a.multiValidation(a.model.blockKeys,"blockKeys")};a.allowUrlCbk=function(b,c,d){a.multiValidation(a.model.allowUrls,
"allowUrls")};a.allowKeyCbk=function(b,c,d){a.multiValidation(a.model.allowKeys,"allowKeys")};a.gridInvalidCbk=function(a){a.row.entity.disableChkBox=a.rowInvalid};a.gridBlockUrlOptions=app.uiGrid.generateGridOptions({IDPreifx:"blockfilterbydomain",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:n("blockUrls"),headerChangedCbk:n("blockUrls"),disableChkBoxField:"disableChkBox"},{field:"name",displayName:a.DICT("Content_Filter_Domain_Name"),editRow:"edit",required:!0,id:"block_domain",validationCbk:"gridInvalidCbk",
customVldCbk:"blockUrlCbk",invalidField:"invalid",cellTemplate:v.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'maxlength="253" domain-name')},{field:"schedule",displayName:a.DICT("Content_Filter_Schedule"),editRow:"edit",width:200,id:"block_domain_schedule",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"empty",isEmpty:!0}]});a.gridBlockKeywordOptions=app.uiGrid.generateGridOptions({IDPreifx:"blockfilterbykeyword",columnDefs:[{field:"selected",isCheckbox:!0,
changedCbk:n("blockKeys"),headerChangedCbk:n("blockKeys"),disableChkBoxField:"disableChkBox"},{field:"name",displayName:a.DICT("Content_Filter_Keyword_Name"),editRow:"edit",required:!0,id:"block_keyword",validationCbk:"gridInvalidCbk",customVldCbk:"blockKeyCbk",invalidField:"invalid",cellTemplate:v.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'maxlength="64" keyword')},{field:"schedule",displayName:a.DICT("Content_Filter_Schedule"),editRow:"edit",width:200,id:"block_keyword_schedule",
cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"empty",isEmpty:!0}]});a.gridAllowUrlOptions=app.uiGrid.generateGridOptions({IDPreifx:"allowbydomain",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:n("allowUrls"),headerChangedCbk:n("allowUrls"),disableChkBoxField:"disableChkBox"},{field:"name",displayName:a.DICT("Content_Filter_Domain_Name"),editRow:"edit",required:!0,id:"allow_domain",validationCbk:"gridInvalidCbk",customVldCbk:"allowUrlCbk",invalidField:"invalid",cellTemplate:v.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,
'maxlength="253" domain-name')},{field:"schedule",displayName:a.DICT("Content_Filter_Schedule"),editRow:"edit",width:200,id:"allow_domain_schedule",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"empty",isEmpty:!0}]});a.gridAllowKeywordOptions=app.uiGrid.generateGridOptions({IDPreifx:"allowbykeyword",columnDefs:[{field:"selected",isCheckbox:!0,changedCbk:n("allowKeys"),headerChangedCbk:n("allowKeys"),disableChkBoxField:"disableChkBox"},{field:"name",displayName:a.DICT("Content_Filter_Keyword_Name"),
editRow:"edit",customVldGroup:"4",required:!0,id:"allow_keyword",validationCbk:"gridInvalidCbk",customVldCbk:"allowKeyCbk",invalidField:"invalid",cellTemplate:v.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'maxlength="64" keyword')},{field:"schedule",displayName:a.DICT("Content_Filter_Schedule"),editRow:"edit",width:200,id:"allow_keyword_schedule",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"empty",isEmpty:!0}]});var k=function(){return 50<=a.model.blockUrls.length?
(a.msg=a.DICT("Content_Filter_Max_Filter_Domain",{"%s":a.model.blockUrls.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},g=function(){return 50<=a.model.blockKeys.length?(a.msg=a.DICT("Content_Filter_Max_Filter_Keyword",{"%s":a.model.blockKeys.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},z=function(){return 50<=a.model.allowUrls.length?(a.msg=a.DICT("Content_Filter_Max_Allow_Domain",{"%s":a.model.allowUrls.length}),app.TOOLS.criticalAlertBox({msg:a.msg,
cbk:function(a){}}),!0):!1},y=function(){return 50<=a.model.allowKeys.length?(a.msg=a.DICT("Content_Filter_Max_Allow_Keyword",{"%s":a.model.allowKeys.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.funs={add:function(b){var c,d;switch(b){case "blockUrls":if(k())return;c=u();d=a.gridBlockUrlOptions.gridApi.customApi;break;case "blockKeys":if(g())return;d=a.gridBlockKeywordOptions.gridApi.customApi;c=x();break;case "allowUrls":if(z())return;d=a.gridAllowUrlOptions.gridApi.customApi;
c=u();break;case "allowKeys":if(y())return;d=a.gridAllowKeywordOptions.gridApi.customApi;c=x();break;default:return}c.selected=!0;c.edit=!0;a.sel_cnts[b]+=1;a.model[b].push(c);d.scrollToLast();a.modified()},edit:function(b){switch(b){case "blockUrls":case "blockKeys":case "allowUrls":case "allowKeys":angular.forEach(a.model[b],function(a,b){a.selected&&(a.edit=!0)})}},save:function(d){var g={},k,h=!1,p,r={},z,m,u,n=function(){var d=[],e=[],k=[],h=[];g="block"===a.model.type?{"filtering-type":"BLOCK_LIST"}:
{"filtering-type":"ALLOW_LIST"};angular.forEach(a.model.blockUrls,function(a){p={"domain-name":a.name};"!always"===a.schedule.select?p["always-on"]=null:p.schedule=a.schedule.select;d.push(p)});angular.forEach(a.model.blockKeys,function(a){p={"keyword-name":a.name};"!always"===a.schedule.select?p["always-on"]=null:p.schedule=a.schedule.select;e.push(p)});if(d.length||e.length)g.block_rules={},d.length&&(g.block_rules.block_url_rules=d),e.length&&(g.block_rules.block_keyword_rules=e);angular.forEach(a.model.allowUrls,
function(a){p={"domain-name":a.name};"!always"===a.schedule.select?p["always-on"]=null:p.schedule=a.schedule.select;k.push(p)});angular.forEach(a.model.allowKeys,function(a){p={"keyword-name":a.name};"!always"===a.schedule.select?p["always-on"]=null:p.schedule=a.schedule.select;h.push(p)});if(h.length||k.length)g.allow_rules={},h.length&&(g.allow_rules.allow_keyword_rules=h),k.length&&(g.allow_rules.allow_url_rules=k);(g.enable=a.model.enable)&&a.model.webfilter_enable&&(r.webfilter={enable:!a.model.enable});
r["content-filtering"]=g;b.post({method:"set_content_filter",params:r,success:function(b){a.success=!0;c()},error:function(a){c()}})};m=!1;z={block_url_rules:[],block_keyword_rules:[]};angular.forEach(q,function(b){k=!0;angular.forEach(a.model.blockUrls,function(a){b.name===a.name&&(k=!1)});k&&(m=h=!0,z.block_url_rules.push({"domain-name":b.name}))});angular.forEach(e,function(b){k=!0;angular.forEach(a.model.blockKeys,function(a){b.name===a.name&&(k=!1)});k&&(m=!0,z.block_keyword_rules.push({"keyword-name":b.name}))});
m&&(h=!0,g.block_rules=z);m=!1;u={allow_url_rules:[],allow_keyword_rules:[]};angular.forEach(w,function(b){k=!0;angular.forEach(a.model.allowUrls,function(a){b.name===a.name&&(k=!1)});k&&(m=!0,u.allow_url_rules.push({"domain-name":b.name}))});angular.forEach(l,function(b){k=!0;angular.forEach(a.model.allowKeys,function(a){b.name===a.name&&(k=!1)});k&&(m=!0,u.allow_keyword_rules.push({"keyword-name":b.name}))});m&&(h=!0,g.allow_rules=u);h&&b.post({method:"del_content_filter",params:{"content-filtering":g},
success:function(a){n()},error:function(a){n()}});h||n()},del:function(b){var c;switch(b){case "blockUrls":case "blockKeys":case "allowUrls":case "allowKeys":break;default:return}for(c=a.model[b].length-1;0<=c;c--)a.model[b][c].selected&&a.model[b].splice(c,1);0===a.model[b].length&&(a.sel_cnts[b]=0);a.modified()},cancel:function(){c()}};a.changeEnable=function(){if(a.model.enable&&a.model.webfilter_enable&&a.model.ori_status!==a.model.enable){var b="<div>"+a.DICT("Content_Filter_Msg1")+"</div>",
b=b+"<div>"+a.DICT("Content_Filter_Msg2")+"</div>",b=b+"<div>"+a.DICT("Content_Filter_Msg3")+"</div>";app.TOOLS.warningAlertBox({msg:b,width:550,cbk:function(b){b||(a.model.enable=!a.model.enable)}})}};c()}]);app.controller("UmbrellaCtrl",["$scope","MyHttp","$q","$timeout","UserSession","userAccessRight","$uibModal",function(a,b,s,n,v,t,m){var q=app.TOOLS.getVal,e=function(){return b.post({method:"get_opendns_state",url:resource_base+"data/opendns_state.json",error:function(a){Log(ERROR,"[Umbrella][getOpendnsState] "+JSON.stringify(a))}})},w=function(){return b.post({method:"get_opendns",url:resource_base+"data/opendns.json",error:function(a){Log(ERROR,"[Umbrella][getOpendns] "+JSON.stringify(a))}})},
l=function(){Log(DEBUG,"[Umbrella][resetNetworkDevicePolice] do reset");a.model.key=a.model.orig_key?"000000":"";a.model.key_modified=!1;a.model.secret=a.model.orig_secret?"000000":"";a.model.secret_modified=!1;a.model.ca_certificate=I;a.model.organizations=angular.copy(a.model.orig_organizations)},h=function(a,b){a||(a={});var c=a.id;b&&(c=a["policy-id"]);return{enabled:!1,name:a.name||"",id:parseInt(c,10),action:"none"}},p=function(a){a||(a={});var b=a.device||{};return{id:a.id||"",orig_id:a.id||
"",name:a.name||"",device_id:b["device-id"]||"",device_name:b.name||"",device_tag:b.tag||"",origin_id:b["origin-id"]||"",policies_str:"N/A",policies:{},orig_policies:{}}},u=function(b){b||(b={});var c=b.opendns||{},d=c["network-policies"]||{};b=c["network-device-policies"]||{};var e=c["local-domain-bypass"]||[],g=[];a.model.enabled=q(c.enabled,!0);a.model.block_lan_dns_query=!q(c["allow-dns-query-from-lan"],!1);angular.forEach(e,function(a){g.push({domain:a})});b.enabled?(a.model.policies="network-device",
c=b["dns-crypt"]||{}):(a.model.policies="network",c=d["dns-crypt"]||{});g.length||g.push({domain:""});a.model.key_modified=!1;a.model.secret_modified=!1;a.model.local_domain_bypass=g;a.model.ca_certificate=b["ca-certificate"]||I;a.model.organizations=p(b.organizations&&b.organizations[0]);a.model.orig_organizations=angular.copy(a.model.organizations);b.key?(a.model.key="00000000",a.model.orig_key=b.key):(a.model.key="",a.model.orig_key="");b.secret?(a.model.secret="00000000",a.model.orig_secret=b.secret):
(a.model.secret="",a.model.orig_secret="");a.model.dns_crypt.enabled=q(c.enabled,!1);a.model.dns_crypt.public_key=c["public-key"]||""},x=function(b,c){var d;switch(b){case "apply_warning":d="umbrella_apply_warning.htm";break;case "new_credentials":case "edit_credentials":d="umbrella_credentials.htm";break;case "new_organization":d="umbrella_organization.htm";break;case "new_policies":case "edit_policies":d="umbrella_policies.htm";break;case "edit_device_info":case "new_device_info":d="umbrella_device_info.htm";
break;case "de_register_warning":d="umbrella_de_register_warning.htm";break;case "setup_success":case "de_register_success":case "update_device_policy_success":case "update_credentials_success":case "update_device_info_success":d="umbrella_success.htm";break;case "update_credentials_error":case "update_device_info_error":case "update_device_policy_error":case "get_organization_error":case "get_policies_error":case "new_register_error":case "new_policy_associating_error":case "de_register_error":d=
"umbrella_error.htm";break;default:Log(ERROR,"[Umbrella][open_modal] Error type:"+b);return}a.ui_data.uibModalInstance=m.open({animation:a.animationsEnabled,templateUrl:d,controller:"UmbrellaModalCtrl",size:"umbrella-modal-generate",backdrop:"static",resolve:{model:function(){return a.model},ui_data:function(){return a.ui_data},is_edit:function(){return!1},type:function(){return b},genOpendnsOrganizationPolicy:function(){return h}}});a.ui_data.uibModalInstance.result.then(function(b){a.model=b.model;
a.ui_data=b.ui_data;_.isFunction(c)&&c(!0);a.ui_data.uibModalInstance=void 0},function(){_.isFunction(c)&&c(!1);a.ui_data.uibModalInstance=void 0})},r=function(a,b){A("read_organizations",function(b,c,e){b?d(c):d({});_.isFunction(a)&&a(b,c,e)},{background:b})},d=function(b){b=b.organizations||[];var c=a.model.organizations.id,d;a.model.organizations_list=[];angular.forEach(b,function(b){d={id:b["organization-id"],name:b.name,check:!1};c===d.id&&(d.check=!0);a.model.organizations_list.push(d)})},c=
function(b,c){a.ui_data.prepare_policies_list_error=!1;A("read_policies",function(c,d,e){c?k(d):(a.ui_data.prepare_policies_list_error=!0,k({}));_.isFunction(b)&&b(c,d,e)},{background:c})},k=function(b){b=b.policies||[];var c=[],d=[],e,g,k;a.model.policies_list=[];angular.forEach(b,function(a){g="true"===a["is-default"]?!0:!1;k=parseInt(q(a.priority,"0"),10);isNaN(k)&&(k=0);e={id:a["policy-id"],organization_id:a["organization-id"],name:a.name,priority:k,is_default:g,created_at:a["created-at"],check:!1,
disable_check:!1};e.is_default?(e.check=!0,e.disable_check=!0,c.push(e)):d.push(e)});c.sort(function(a,b){return a.priority-b.priority});d.sort(function(a,b){return a.priority-b.priority});a.model.policies_list=d.concat(c)},g=function(a,b){A("read_device_policies",function(b,c,d){b?z(c):z({});_.isFunction(a)&&a(b,c,d)},{background:b})},z=function(b){b||(b={});b=b.policies||[];var c=a.model.organizations.policies,d,e=[];a.model.organizations.policies_str="";angular.forEach(c,function(a,b){a.enabled=
!1});b.sort(function(a,b){var c=parseInt(a.priority,10),d=parseInt(b.priority,10);return c-d});angular.forEach(b,function(a){d=h(a,!0);d.enabled=!0;e.push(d.name);c[d.id]=d});a.model.organizations.policies_str=e.join(", ");a.model.organizations.policies_str||(a.model.organizations.policies_str="N/A");a.model.organizations.orig_policies=angular.copy(a.model.organizations.policies);a.model.orig_organizations.policies_str=a.model.organizations.policies_str;a.model.orig_organizations.policies=angular.copy(a.model.organizations.policies);
a.model.orig_organizations.orig_policies=angular.copy(a.model.organizations.policies)},y=function(b,d){var e,k,h,p,z;switch(b){case "new_credentials":case "edit_credentials":x(b,function(a){a?d?y("get_organization",d):B():l()});break;case "get_organization":r(function(b,c,e){!b||0===a.model.organizations_list.length?y("get_organization_error",d):d?y("new_organization",d):B(function(a){})});break;case "update_credentials_success":x("update_credentials_success",function(a){B(void 0,!0)});break;case "update_credentials_error":x("update_credentials_error",
function(a){l()});break;case "get_organization_error":x("get_organization_error",function(a){l()});break;case "new_organization":x("new_organization",function(b){b?d?(angular.forEach(a.model.organizations_list,function(b){b.check&&(a.model.organizations.id=b.id,a.model.organizations.name=b.name)}),y("get_policies",d)):Log(ERROR,'[Umbrella][FSM] "new_organization" state is wrong'):l()});break;case "get_policies":c(function(b,c,e){!b||0===a.model.policies_list.length?y("get_policies_error",d):d?y("new_policies",
d):y("edit_policies",d)});break;case "get_policies_error":x("get_policies_error",function(a){l()});break;case "new_policies":case "edit_policies":k=a.model.organizations.policies;angular.forEach(a.model.policies_list,function(a){a.disable_check||(a.check=k[a.id]&&k[a.id].enabled?!0:!1)});x(b,function(b){b?d?(angular.forEach(a.model.organizations.policies,function(a,b){a.enabled=!1}),angular.forEach(a.model.policies_list,function(b,c){b.check&&(a.model.organizations.policies[b.id].enabled=!0)}),y("new_device_info",
d)):y("update_policies",d):l()});break;case "new_device_info":case "edit_device_info":x(b,function(a){a?"new_device_info"===b?y("create_device_info",d):y("update_device_info",d):l()});break;case "create_device_info":A("create_a_device",function(b,c,g){b?(e=c.device||{},a.model.organizations.device_id=e["device-id"]||"",a.model.organizations.device_name=e.name||"",a.model.organizations.origin_id=e["origin-id"]||"",y("update_policies",d)):y("create_device_info_register_error",d)});break;case "update_policies":h=
a.model.organizations.orig_policies;k=a.model.organizations.policies;if(!d&&(p="",angular.forEach(h,function(a){"posting"===a.action&&(a.action="posted");a.enabled&&(k[a.id]&&!k[a.id].enabled&&"none"===a.action)&&!p&&(a.action="posting",p=a.id)}),p)){A("delete_device_policies",function(a,b,c){a?y("update_policies",d):y("update_device_policy_error",d)},{policy_id:p});break}p="";z=0;angular.forEach(k,function(a){"posting"===a.action&&(a.action="posted");a.enabled&&"none"===a.action&&(z+=1,p||(a.action=
"posting",p=a.id))});A("update_device_policies",function(a,b,c){a?1<z?y("update_policies",d):d?g(function(){B(function(){y("setup_success",d)},!0)}):g(function(){B(function(){y("update_device_policy_success",d)},!0)}):d?y("create_device_policy_associating_error",d):y("update_device_policy_error",d)},{policy_id:p});break;case "update_device_info":A("update_a_device",function(b,c,g){b?(e=c.device||{},a.model.organizations.device_id=e["device-id"]||"",a.model.organizations.device_name=e.name||"",a.model.organizations.origin_id=
e["origin-id"]||"",B(function(){y("update_device_info_success",d)},!0)):y("update_device_info_error",d)});break;case "create_device_info_register_error":x("new_register_error",function(){l()});break;case "create_device_policy_associating_error":x("new_policy_associating_error",function(){B(void 0,!0)});break;case "setup_success":x("setup_success",function(){});break;case "update_device_info_error":x("update_device_info_error",function(){l()});break;case "update_device_info_success":x("update_device_info_success",
function(){});break;case "update_device_policy_success":x("update_device_policy_success",function(a){});break;case "update_device_policy_error":x("update_device_policy_error",function(a){l()});break;default:Log(ERROR,"[Umbrella][FSM] state is error :"+b)}},A=function(c,d,e){e||(e={});var g=q(e.background,!1),k=resource_base+"jsonrpc",h={};a.model.key_modified&&(h.key=a.model.key);a.model.secret_modified&&(h.secret=a.model.secret);switch(c){case "read_organizations":c="opendns-read-organizations";
k=resource_base+"data/umbrella_read_organization.json";break;case "read_device":c="opendns-read-devices";k=resource_base+"data/umbrella_read_device.json";$.extend(h,{"organization-id":a.model.organizations.id,"device-id":a.model.organizations.origin_id});break;case "create_a_device":c="opendns-create-a-device";k=resource_base+"data/umbrella_create_a_device.json";$.extend(h,{"organization-id":a.model.organizations.id,device:{name:a.model.organizations.device_name}});break;case "delete_a_device":c=
"opendns-delete-a-device";k=resource_base+"data/umbrella_delete_a_device.json";$.extend(h,{"organization-id":a.model.organizations.id,"origin-id":a.model.organizations.origin_id});break;case "update_a_device":c="opendns-update-merge-a-device";k=resource_base+"data/umbrella_update_a_device.json";$.extend(h,{"organization-id":a.model.organizations.id,"origin-id":a.model.organizations.origin_id,patch:{name:a.model.organizations.device_name}});break;case "read_policies":c="opendns-read-policies";k=resource_base+
"data/umbrella_read_policy.json";$.extend(h,{"organization-id":a.model.organizations.id});break;case "read_device_policies":c="opendns-read-device-policies";k=resource_base+"data/umbrella_read_device_policy.json";$.extend(h,{"organization-id":a.model.organizations.id,"origin-id":a.model.organizations.origin_id});break;case "update_device_policies":c="opendns-update-replace-a-policy";k=resource_base+"data/umbrella_update_device_policy.json";$.extend(h,{"organization-id":a.model.organizations.id,"origin-id":a.model.organizations.origin_id,
"policy-id":e.policy_id});break;case "delete_device_policies":c="opendns-delete-policy";k=resource_base+"data/umbrella_delete_device_policy.json";$.extend(h,{"organization-id":a.model.organizations.id,"origin-id":a.model.organizations.origin_id,"policy-id":e.policy_id});break;default:Log(ERROR,"[Umbrella][do_rpc] type is not support :"+c);return}b.post({url:k,method:"action",params:{rpc:c,input:h},procBackground:g,success:function(a){var b=a.data&&a.data.result&&a.data.result.output||{},c=!1;void 0!==
b["success-code"]&&(c=!0);_.isFunction(d)&&d(c,b,a)},error:function(a){Log(DEBUG,"[Umbrella][do_rpc] "+JSON.stringify(params));Log(DEBUG,"[Umbrella][do_rpc] "+JSON.stringify(a));_.isFunction(ckb)&&d(!1,{},a)}})},B=function(c,d){var e={enabled:a.model.enabled,"allow-dns-query-from-lan":!a.model.block_lan_dns_query,"local-domain-bypass":[],"network-policies":{enabled:!1},"network-device-policies":{enabled:!1,organizations:[]}},g={enabled:a.model.dns_crypt.enabled,"public-key":a.model.dns_crypt.public_key},
k=[],h=[];angular.forEach(a.model.local_domain_bypass,function(a){a.domain&&e["local-domain-bypass"].push(a.domain)});e["local-domain-bypass"].length||e["local-domain-bypass"].push("");e["network-policies"].enabled="network"===a.model.policies;e["network-policies"]["dns-crypt"]=g;$.extend(e["network-device-policies"],{enabled:"network-device"===a.model.policies,"dns-crypt":g});(a.model.key_modified||!a.model.key)&&$.extend(e["network-device-policies"],{key:a.model.key});(a.model.secret_modified||
!a.model.secret)&&$.extend(e["network-device-policies"],{secret:a.model.secret});g={id:a.model.organizations.id,name:a.model.organizations.name,device:{"origin-id":a.model.organizations.origin_id,"device-id":a.model.organizations.device_id,name:a.model.organizations.device_name,tag:a.model.organizations.tag}};angular.forEach(a.model.organizations.policies,function(a,b){a.enabled&&k.push({id:a.id,name:a.name})});g.id&&e["network-device-policies"].organizations.push(g);h.push({method:"set_opendns",
params:{opendns:e}});b.post({forcedUsingPost:!0,method:"set_bulk",params:h,success:function(){_.isFunction(c)&&c(!0);d&&C();a.resetModified()},error:function(a){_.isFunction(c)&&c(!1);d&&C()}})},C=function(){s.all([e(),w()]).then(function(b){Log(INFO,"---------- "+new Date);var c=b[0]&&b[0].data&&b[0].data.result||{},d=(c["opendns-state"]||{}).status||"UNREGISTERED";a.model.opendns_state=d;Log(INFO,"opendns-state orig: "+JSON.stringify(c));Log(INFO,"opendns-state ui: "+a.model.opendns_state);a.model.opendns_state_str=
"UNREGISTERED"===d?a.DICT("Umbrella_Unregistered"):a.DICT("Umbrella_Registered");u(b[1]&&b[1].data&&b[1].data.result||{});a.ui_data.data_ready=!0;a.ui_data.getting_at_background=!1;a.ui_data.prepare_policies_list_error=!1;a.ui_data.dp_registered=!1;a.ui_data.net_registered=!1;"network"===a.model.policies&&(a.ui_data.net_registered="REGISTERED"===a.model.opendns_state&&a.model.enabled);"network-device"===a.model.policies&&(a.ui_data.dp_registered="REGISTERED"===a.model.opendns_state&&a.model.enabled,
a.ui_data.dp_registered&&a.model.enabled&&D());a.check_apply_btn();Log(INFO,"choose: "+a.model.policies);Log(INFO,"network-device register state: "+a.ui_data.dp_registered);Log(INFO,"network register state: "+a.ui_data.net_registered)})},D=function(){var b=s.defer(),d=s.defer();a.ui_data.getting_at_background=!0;c(function(){b.resolve()});g(function(){d.resolve()});s.all([b.promise,d.promise]).then(function(){a.ui_data.getting_at_background&&(a.ui_data.getting_at_background=!1,_.isFunction(a.ui_data.padding_action)&&
(app.transition.Out(),a.ui_data.padding_action(),a.ui_data.padding_action=void 0))})},E=function(b){a.ui_data.getting_at_background?(app.transition.In(),a.ui_data.padding_action=b):_.isFunction(b)&&b()},I="";a.ui_data={data_ready:!1,dp_registered:!1,net_registered:!1,disable_apply:!1,max_domain_bypass:10,html_intro_msg2:a.DICT("Umbrella_Intro_Msg2",{"%s0":"<a href=\"https://signup.umbrella.com/\" onclick=\"window.open(this.href, 'newwindow', 'width=700, height=1000'); return false;\">"+a.DICT("Umbrella_Account")+
"</a>"}),html_intro_msg3:a.DICT("Umbrella_Intro_Msg3",{"%s0":"<a href=\"https://dashboard.umbrella.com/\" onclick=\"window.open(this.href, 'newwindow', 'width=700, height=1000'); return false;\"> "+a.DICT("Umbrella_Intro_Msg3_1")+"</a>"}),html_network_msg1:a.DICT("Umbrella_Network_Msg1"),html_network_msg2:a.DICT("Umbrella_Network_Msg2",{"%s":"<a href=\"https://support.umbrella.com/hc/en-us/articles/115004547503-Networks-with-Dynamic-IP-Addresses\"onclick=\"window.open(this.href, 'newwindow', 'width=700, height=1000'); return false;\">"+
a.DICT("Here")+"</a>"}),placeholder_publickey:"B735:1140:206F:225D:3E2B:D822:D7FD:691E:A1C3:3CC8:D666:8D0C:BE04:BFAB:CA43:FB77",html_credential_msg:a.DICT("Umbrella_Credential_Msg",{"%s0":"<a href=\"https://dashboard.umbrella.com/\" onclick=\"window.open(this.href, 'newwindow', 'width=700, height=1000'); return false;\"> "+a.DICT("Umbrella")+"</a>"}),getting_at_background:!1,padding_action:void 0,uibModalInstance:void 0,prepare_device_error:!1,prepare_policies_list_error:!1,prepare_device_policies_error:!1};
a.model={opendns_state:"UNREGISTERED",opendns_state_str:"",enabled:!0,policies:"network",block_lan_dns_query:!0,key:"",orig_key:"",key_modified:!1,secret:"",orig_secret:"",secret_modified:!1,ca_certificate:"",local_domain_bypass:[],organizations:{id:"",device_id:"",device_name:"",origin_id:"",policies:{},orig_policies:{},policies_str:""},orig_organizations:{},dns_crypt:{enabled:!0,public_key:""},certificates:[],organizations_list:[],policies_list:[]};a.funs={save:function(){var b=function(a){a&&B(void 0,
!0)};a.model.enabled?x("apply_warning",b):B(void 0,!0)},cancel:function(){C()},get_start:function(){l();a.model.key="";a.model.secret="";y("new_credentials",!0)},change_policies:function(){E(function(){y("edit_policies",!1)})},change_credentials:function(){E(function(){y("edit_credentials",!1)})},change_device_info:function(){E(function(){y("edit_device_info",!1)})},de_register:function(){var b=function(b){b&&A("delete_a_device",function(b,c,d){b?(a.model.key="",a.model.secret="",a.model.organizations.id=
"",B(function(){x("de_register_success",function(){C()})})):x("de_register_error")})};E(function(){x("de_register_warning",b)})},add_domain_bypass:function(){a.model.local_domain_bypass.push({domain:""})},delete_domain_bypass:function(b){a.model.local_domain_bypass.splice(b,1)}};a.check_public_key=function(){var b=a.model.dns_crypt.public_key;if(b&&(!b.match(/(([0-9A-Fa-f]{4}:){15})([1-9A-Fa-f]{4})$/)||79!==b.length)){if(a.model.dns_crypt.enabled&&a.model.enabled){a.umbrella_form.public_key.$setValidity("format",
!1);return}a.model.dns_crypt.public_key=""}a.umbrella_form.public_key.$setValidity("format",!0)};a.change_policy_mode=function(){"network-device"===a.model.policies&&(a.model.dns_crypt.enabled=!0);a.check_apply_btn()};a.check_apply_btn=function(){a.ui_data.disable_apply=!1;if("network-device"===a.model.policies&&a.model.enabled&&!a.ui_data.dp_registered&&(!a.model.orig_key||!a.model.orig_secret))a.ui_data.disable_apply=!0};C()}]);
app.controller("UmbrellaModalCtrl",["$uibModalInstance","$scope","ui_data","model","is_edit","type","$location","genOpendnsOrganizationPolicy",function(a,b,s,n,v,t,m,q){b.model=n;b.ui_data=s;b.is_edit=v;b.type=t;b.policy_cnt=0;s=function(){var a=b.model.organizations.policies;b.policy_cnt=0;angular.forEach(a,function(b,l){a[l].enabled=!1});angular.forEach(b.model.policies_list,function(m){a[m.id]||(a[m.id]=q(m));m.check&&(a[m.id].enabled=!0,a[m.id].name=m.name,b.policies_cnt=b.policy_cnt+1)})};b.gridOrganizationOptions=
app.uiGrid.generateGridOptions({data:b.model.organizations_list,columnDefs:[{field:"check",isRadio:!0,changedCbk:function(){b.policy_cnt=0;angular.forEach(b.model.organizations_list,function(a){a.check&&(b.model.organizations.id=a.id,b.policy_cnt+=1)})}},{field:"name"}]});b.gridPoliciesOptions=app.uiGrid.generateGridOptions({data:b.model.policies_list,columnDefs:[{field:"check",isCheckbox:!0,changedCbk:s,headerChangedCbk:s,disableChkBoxField:"disable_check"},{field:"name"}]});b.warning_msg1=b.DICT("Umbrella_Enabled_Msg2",
{"%s0":"<a ng-click=\"jump('WAN_Settings/')\">"+b.DICT("Umbrella_Enabled_Msg2_1")+"</a>"});b.warning_msg2=b.DICT("Umbrella_Enabled_Msg3",{"%s0":"<a ng-click=\"jump('LAN_DHCP_Settings/')\">"+b.DICT("Umbrella_Enabled_Msg3_1")+"</a>"});b.warning_msg3=b.DICT("Umbrella_Enabled_Msg4",{"%s0":"<a ng-click=\"jump('Firewall_Access_Rules/')\">"+b.DICT("Umbrella_Enabled_Msg4_1")+"</a>"});b.jump=function(a){m.url(a);b.cancel()};b.ok=function(){a.close({model:b.model,ui_data:b.ui_data})};b.cancel=function(){a.dismiss("cancel")}}]);app.controller("IpsCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","$uibModal","dt","Upload",function(a,b,s,n,v,t,m,q){var e=app.TOOLS.getVal,w=app.TOOLS.getResponse;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var l=function(){return b.post({method:"get_ips",url:resource_base+"data/ips.json",error:function(a){Log(ERROR,"[IPS][getIpsData] Error "+JSON.stringify(a))}})},h=function(b){b||(b={});b=b.ips||{};var c=
b.zone||[];a.model.enabled=!0===b.enabled;a.model.mode=b.mode||"prevention";a.model.level=b.level||"connectivity";angular.forEach(a.model.zone,function(b,c){a.model.zone[c]=!1});angular.forEach(c,function(b,c){void 0!==a.model.zone[c]&&(a.model.zone[c]=!0)})},p=function(){return b.post({method:"get_signature_state",url:resource_base+"data/ips.json",error:function(a){Log(ERROR,"[IPS][getSignatureStateData] Error "+JSON.stringify(a))}})},u=function(b){b||(b={});b=b["ciscosb-ips:signature-state"]||{};
a.model.signature.version=b.version||"N/A";a.model.signature.available_version=b["available-version"]||"N/A";a.model.signature.latest_update_time=m.genTimeStrByTimeStamp(b["latest-update-time"]||"","N/A");a.model.signature.last_check_time=m.genTimeStrByTimeStamp(b["last-check-time"]||"","N/A")},x=function(){return b.post({method:"get_ips_state",url:resource_base+"data/ips.json",error:function(a){Log(ERROR,"[IPS][getIpsData] Error "+JSON.stringify(a))}})},r=function(b){b||(b={});b=m.parser((b["ips-state"]||
{})["last-reset-time"]||"");b=0===b.err_code?m.timeStr(b):"N/A";a.model.ips_state.last_reset_time=b},d=function(c){return b.post({url:resource_base+"data/get_ips_signatures.json",method:"action",params:{rpc:"get-ips-signatures",input:{"page-size":a.pagingOps.pageSize,"page-num":a.ui_data.page_num,query:a.ui_data.query}},error:function(a){Log(ERROR,"[IPS][rpcForSignatures] "+JSON.stringify(a))}})},c=function(b,c){b||(b={});var d=function(a){var b="N/A",c,d;a||(a={},b="");c=a["issue-date"]?m.genTimeStrByTimeStamp(a["issue-date"],
b):b;d=a["updated-date"]?m.genTimeStrByTimeStamp(a["updated-date"],b):b;return{id:e(a.id,b),name:e(a.name,b),impact:e(a.impact,b),description:e(a.description,b),recommendation:e(a.recommendation,b),reference:e(a.reference,b),issue_date:c,updated_date:d,category:e(a.category,b),severity:e(a.severity,b)}},g=b.output||{},k=g.code,h=g.signatures||[],l=a.ui_data.page_num,p=a.pagingOps.pageSize,r,g=_.isNumber(g["total-num"])?g["total-num"]:10861;a.ui_data.grid_signatures=[];-1===k&&(g=0);h.length||(g=0);
if(c){r=Math.ceil(g/p);a.ui_data.total_signatures=g;a.ui_data.exist_page=[""];a.ui_data.grid_signatures=[];a.pagingOps.total=g;0===a.pagingOps.total&&(a.pagingOps.total=1);for(k=0;k<r;k++)a.ui_data.exist_page.push(!1);for(k=0;k<g;k++)a.ui_data.grid_signatures.push(d())}p*=l-1;r=h.length;for(k=0;k<r;k++)a.ui_data.grid_signatures[p+k]=d(h[k]);a.ui_data.exist_page[l]=!0;a.gridIpsSignatureOption.data=a.ui_data.grid_signatures;z()},k=function(){a.model.no_license||b.post({url:resource_base+"data/rpc_ips_check.json",
method:"action",params:{rpc:""},success:function(a){g(a.data&&a.data.result)},error:function(a){Log(ERROR,"[IPS][doRpcForCheckIps] "+JSON.stringify(a));g()}})},g=function(b){b||(b={});b=b.output||{};var c=b.errstr||a.DICT("Ips_Cannot_Connect_to_Cisco_Com");switch(b.code){case 0:A();break;default:app.TOOLS.criticalAlertBox({msg:c})}},z=function(){_.isFunction(a.pagingOps.updateOpts)&&a.pagingOps.updateOpts()},y=function(b,e){b&&(a.ui_data.page_num=1,z());s.all([d()]).then(function(a){c(a[0]&&a[0].data&&
a[0].data.result||{},b);_.isFunction(e)&&e()})},A=function(){var b;s.all([x()]).then(function(c){r(w(c,0));b=a.model.signature.version===a.model.signature.available_version?a.DICT("Ips_Have_Latest_Version_Already"):a.DICT("Ips_Update_Available_On_Cisco_Com",{"%s1":a.signature.available_version,"%s2":a.signature.version});app.TOOLS.informationAlertBox({msg:b})})},B=function(){a.ui_data.page_num=1;z();s.all([l(),x(),p(),d()]).then(function(b){var d=w(b,1);d||(d={});d=e(d.status,0);a.model.no_license=
0===d;a.model.no_license?(h(),r(),u(),c()):(h(w(b,0)),r(w(b,1)),u(w(b,2)),c(w(b,3),!0));a.ui_data.data_ready=!0;a.resetModified()})},C=function(b){var c=function(){_.isFunction(b)&&b()};a.ui_data.exist_page[a.ui_data.page_num]?c():y(!1,c)};a.success=!1;a.pagingOps={pages:[50,100,150],pageSize:50,total:0,changePageIdxCbk:{pre:void 0,post:function(b,c){a.ui_data.page_num=b;C(c)}},changePageSizeCbk:function(b,c){a.pagingOps.pageSize=b;y(!0,c)}};a.ui_data={pc_file:"",data_ready:!1,page_num:1,exist_page:[],
query:"",uploading:!1,upload_str:"",progress:-1,show_paging:!1,grid_signatures:[],total_signatures:0,disable_upgradeBtn:!0,combineNote:a.DICT("Ips_Note",{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Here")+"</u></a>"})};a.model={enabled:!1,mode:"prevention",level:"connectivity",zone:{LAN:!1,DMZ:!1,PRINTERS:!1,SMARTHOME:!1,VLAN100:!1,GUEST:!1},signature:{version:"",latest_update_time:"",available_version:"",last_check_time:""},ips_state:{last_reset_time:""},no_license:!0};
a.gridIpsSignatureOption=app.uiGrid.generateGridOptions({enablePaginationControls:!1,paginationPageSize:a.pagingOps.pageSize,enablePagination:!0,columnDefs:[{field:"name",displayName:a.DICT("Ips_Name")},{field:"id",displayName:a.DICT("Ips_Id"),cellTemplate:"UG_table_text_with_inline_href_click.html",click:function(a,b,c,d){t.open({animation:!0,templateUrl:"ips_detail.html",controller:"IpsDetailCtrl",size:"ips-detail",backdrop:"static",resolve:{edit:function(){return b.entity}}}).result.then(function(){})}},
{field:"severity",displayName:a.DICT("Ips_Severity")},{field:"category",displayName:a.DICT("Ips_Category")}]});a.funs={save:function(){var c=a.model;b.post({method:"set_ips",forcedUsingPost:!0,params:{ips:{enabled:c.enabled,mode:c.mode,level:c.level}},success:function(){a.success=!0;B()},error:function(){B()}})},cancel:function(){B()},check_for_update:function(){k()},search:function(){y(!0,function(){_.isFunction(a.pagingOps.goTo)?a.pagingOps.goTo(1):a.ui_data.page_num=1})},update:function(){var c=
function(){b.post({method:"action",params:{rpc:"file-copy",input:{fileType:"signature",source:"FILE://Signature/signature_file"}},success:function(b){var c=b&&b.data&&b.data.result||{};b=c.code||-1;c=c.errstr||a.DICT("Ips_Upgrade_Fail");0===b?B():app.TOOLS.criticalAlertBox({msg:c,cbk:function(){B()}})},error:function(){app.TOOLS.criticalAlertBox({msg:errstr,cbk:function(){B()}})}})},d=a.ui_data.pc_file;d.upload=q.upload({url:resource_base+"upload",headers:{"optional-header":"header-value"},data:{sessionid:"EU6DJKEIWO",
pathparam:"Signature",fileparam:"signature_file",file:d}});a.ui_data.uploading=!0;d.upload.then(function(b){a.ui_data.uploading=!1;c()},function(b){a.ui_data.uploading=!1;app.TOOLS.criticalAlertBox({msg:a.DICT("Ips_Upload_Failure"),cbk:function(){B()}})},function(b){a.ui_data.progress=Math.min(100,parseInt(100*b.loaded/b.total,10))})},pcFileFormatCheck:function(b){a.ui_data.pcfile_invalid=!1;a.ui_data.disable_upgradeBtn=!0;void 0!==b&&(b.name.toLowerCase().match(/(\.zip){1}$/)?(a.ui_data.pc_file=
b,a.ui_data.disable_upgradeBtn=!1):(app.TOOLS.criticalAlertBox({title:a.DICT("Error"),msg:a.DICT("Ips_File_Wrong_Format")}),a.ui_data.disable_upgradeBtn=!0))}};B()}]);app.controller("IpsDetailCtrl",["$scope","$uibModalInstance","edit",function(a,b,s){a.edit=s;a.cancel=function(){b.close()}}]);app.controller("appControllerCtrl",["$scope","MyHttp","pgWindow","meta_data_service","$q","UserSession","userAccessRight","device_os_type",function(a,b,s,n,v,t,m,q){a.success=!1;a.expandFlag=!1;a.maxAVCEntity=20;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var e="",w="",l=function(){return b.post({url:resource_base+"data/avc_meta_data.json",method:"get_avc",error:function(a){console.log("appControllerCtrl getAVCMetaData error "+
a.status);h()}})},h=function(b){b&&b["avc-meta-data"]&&(a.model.meta=n.generate(b["avc-meta-data"],!0))},p=function(){return b.post({url:resource_base+"data/application_controller.json",method:"get_app_control",error:function(a){console.log("appControllerCtrl getAppControllerData error : "+a.status);u()}})},u=function(b){b||(b={});var c=b.avc||{},d=c.policy||[];a.model.enable=void 0!==c.enable?c.enable:!0;a.model.status=void 0!==b.status?b.status:0;a.model.orig_enable=a.model.enable;a.model.policys=
[];angular.forEach(d,function(b){a.model.policys.push(x(b))});a.gridMainOptions.data=a.model.policys;a.dataReady=!0},x=function(b){b||(b={});var c=b.applications||[],d=b["user-exclusion-entry"]||[],g,k,h={name:b.name||"",checked:!1,description:b.description||"",enable:void 0!==b.enable?b.enable:!1,ipgroup:"@none",display_ipgroup:"Any",orig_ipgroup:"",policydevicetype:b["device-type"]||e,policydevicelist:a.model.devicetypes,policyostype:b["os-type"]||"",policyostypelist:[],origapps:[],apps:[],display_apps:[],
schedule:"#always-on",display_schedule:"Always On",exclusions:[],origexclusion:[],meta:angular.copy(a.model.meta)};h.policyostypelist=a.model.ostypes[h.policydevicetype]||[];b["apply-ip-group"]&&(b["ip-groups"]&&b["ip-groups"][0])&&(h.ipgroup=b["ip-groups"][0],h.display_ipgroup=b["ip-groups"][0]);h.orig_ipgroup=h.ipgroup;angular.forEach(b,function(c,d){switch(d){case "schedule":h.schedule=b.schedule||a.model.schedules[0]&&a.model.schedules[0].id||"",h.display_schedule=h.schedule}});h.origname=h.name;
angular.forEach(c,function(b){b.seq&&(b.category&&b.behaviour)&&(b={seq:void 0!==b.seq?b.seq:h.apps.length,category:b.category||"",application:b.application||"",behaviour:b.behaviour||"",action:b.action||"log"},angular.forEach(a.model.meta,function(a){if(g=a.categories[b.category])if("-1"===b.application)angular.forEach(g.applications,function(a){angular.forEach(a.behaviors,function(b){h.display_apps.push({category:g.name,application:a.name,behaviour:b.name})})});else if(k=g.applications[b.application])"-1"===
b.behaviour?angular.forEach(k.behaviors,function(a){h.display_apps.push({category:g.name,application:k.name,behaviour:a.name})}):(be=k.behaviors[b.behaviour])&&h.display_apps.push({category:g.name,application:k.name,behaviour:be.name})}),h.apps.push(b))});h.origapps=angular.copy(h.apps);var l;angular.forEach(d,function(a){l=r(a);l.checked=!1;h.exclusions.push(l)});h.origexclusion=angular.copy(h.exclusions);return h},r=function(b){b||(b={});var c="any",d="",g="",k="",h="",l="",p="",r;angular.forEach(b,
function(a,b){switch(b){case "mac":c="mac";break;case "user-exclusion-ip":if(!a||!a[0])break;a[0].ipv4?(r=a[0].ipv4,r.single?(d=r.single||"",c="ipv4-ip"):r.range&&(k=r.range.start||"",h=r.range.end||"",c="ipv4-range")):a[0].ipv6&&(r=a[0].ipv6,r.single?(g=r.single||"",c="ipv6-ip"):r.range&&(l=r.range.start||"",p=r.range.end||"",c="ipv6-range"))}});b={seq:void 0!==b.seq?b.seq:"",checked:!1,edit:!1,empty:"",ipmac:{select:c,list:a.model.schema.ipmacs,mac:b.mac||"",v4_ip:d||"",v6_ip:g||"",v4_rangeS:k||
"",v6_rangeS:l||"",v4_rangeE:h||"",v6_rangeE:p||""},ecdevicetype:{select:b["device-type"]||e,list:a.model.devicetypes||[]},ecostype:{select:b["os-type"]||w,list:[]}};b.ecostype.list=a.model.ostypes[b.ecdevicetype.select]||[];return b},d=function(){return b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup",error:function(a){console.log("appControllerCtrl getIpGroupData error : "+a.status);c()}})},c=function(b){b||(b={});var c=[],d,g,k,h,l;b["ip-groups"]&&b["ip-groups"]["ip-group"]&&
(c=b["ip-groups"]["ip-group"]);a.model.ipgroups=[{id:"@none",displayName:a.DICT("Application_Control_Any")}];a.model.ex_ipgroups=[];a.model.ipgroups_ips_macs={};angular.forEach(c,function(b){a.model.ex_ipgroups.push({id:b.name,displayName:b.name});d={ips:[],macs:[]};angular.forEach(b.ips,function(b){g={};k="ipv4";b.ipv6&&(k="ipv6");angular.forEach(b[k],function(b,c){switch(c){case "subnet":g="ipv4"===k?{type:a.DICT("Application_Control_Subnet"),address:b.ip+"/"+app.TOOLS.netmask.inet2Int(b.netmask)||
"-"}:{type:a.DICT("Application_Control_Subnet"),address:b.ip+"/"+b["prefix-length"]||"-"};break;case "range":g={type:a.DICT("Application_Control_Range"),address:b.start+" - "+b.end||"-"};break;default:g={type:a.DICT("Application_Control_IP_Address"),address:b}}});h=b["device-type"]||e;l=b["os-type"]||w;angular.extend(g,{seq:b.seq,edit:!0,os_type:{select:l,list:a.model.ostypes[h]||[]},device_type:{select:h,list:a.model.devicetypes}});d.ips.push(g)});angular.forEach(b.macs,function(b){h=b["device-type"]||
e;l=b["os-type"]||w;g={type:a.DICT("Application_Control_MAC_N"),mac:b.mac||"-",edit:!0,device_type:{select:h,list:a.model.devicetypes},os_type:{select:l,list:a.model.ostypes[h]}};d.macs.push(g)});a.model.ipgroups_ips_macs[b.name]=angular.copy(d)});a.model.ipgroups=a.model.ipgroups.concat(a.model.ex_ipgroups)},k=function(){return b.post({url:resource_base+"data/schedule.json",method:"get_schedule",error:function(a){console.log("appControllerCtrl getScheduleData error : "+a.status);g()}})},g=function(b){b||
(b={});var c=[];b.schedules&&b.schedules.schedule&&(c=b.schedules.schedule);a.model.schedules=[{id:"#always-on",displayName:a.DICT("Always_On")}];angular.forEach(c,function(b){a.model.schedules.push({id:b.name,displayName:a.DICT(b.name)})})};s=function(b){a.sel_cnts=0;angular.forEach(a.edit.exclusions,function(b,c){b.checked?a.sel_cnts+=1:b.edit=!1})};t=function(b){a.sel_policy_cnts=0;angular.forEach(a.model.policys,function(b){b.checked&&a.sel_policy_cnts++})};var z=function(){a.dataReady=!1;a.del_policys=
[];v.all([p()]).then(function(b){u(b[0]&&b[0].data&&b[0].data.result||{});a.resetModified()})},y={main:"main",policy_edit:"policy_edit",app_edit:"application_edit"};a.dataReady=!1;a.sel_cnts=0;a.sel_policy_cnts=0;a.currPage="main";a.del_policys=[];a.model={enable:!0,status:0,schema:{},ex_ipgroups:[],ipgroups:[],ipgroups_ips_macs:{},ostypes:{},schedules:[],policys:[],devicetypes:[],meta:[]};a.chk_device_os=function(b){if(a.edit){var c=a.edit,d;c.policyostypelist=a.model.ostypes[c.policydevicetype]||
[];b||(d=!0,angular.forEach(c.policyostypelist,function(a){a===c.policyostype&&(d=!1)}),d&&(c.policyostype=c.policyostypelist&&c.policyostypelist[0]&&c.policyostypelist[0].id||""))}};a.chk_ec_device_os=function(b,c,d,e){var g,k=c.entity;k.ecostype.list=a.model.ostypes[k.ecdevicetype.select]||[];g=!0;angular.forEach(k.ecostype.list,function(a){a===k.ecostype.select&&(g=!1)});g&&(k.ecostype.select=k.ecostype.list&&k.ecostype.list[0]&&k.ecostype.list[0].id||"")};a.change_ipgroup=function(){var b=a.edit,
c=a.model.ipgroups_ips_macs[b.ipgroup];"@none"===b.ipgroup?(a.gridIPSOptions.data=[],a.gridMACOptions.data=[]):(a.gridIPSOptions.data=c.ips,a.gridMACOptions.data=c.macs)};m=function(b,c,d,e){b=c.entity;a.model.ostypes[b.device_type.select]&&(b.os_type.list=a.model.ostypes[b.device_type.select],b.os_type.select=q.get_default_os_type(a.model.ostypes[b.device_type.select]))};a.edit={};a.gridMainOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t},
{field:"name",displayName:a.DICT("Application_Control_Policy_Name_N")},{field:"display_ipgroup",displayName:a.DICT("Application_Control_IP_Group_N")},{field:"display_schedule",displayName:a.DICT("Application_Control_Schedule_Name")},{field:"enable",displayName:a.DICT("Application_Control_Enable"),id:"appctrlpolicy_enable",cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});a.gridApplicationOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"category",displayName:a.DICT("Application_Control_Category")},
{field:"application",displayName:a.DICT("Application_Control_Application_N")},{field:"behaviour",displayName:a.DICT("Application_Control_Behavior")}]});a.gridIPSOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"type",displayName:a.DICT("Application_Control_Type")},{field:"address",displayName:a.DICT("Application_Control_Address")},{field:"device_type",displayName:a.DICT("Application_Control_Device_Type_N"),cellTemplate:"UG_table_select_with_inline_edit.html",editRow:"edit",changedCbk:m},
{field:"os_type",displayName:a.DICT("Application_Control_OS_Type_N"),cellTemplate:"UG_table_select_with_inline_edit.html",editRow:"edit"}]});a.gridMACOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"type",displayName:a.DICT("Application_Control_Type")},{field:"mac",displayName:a.DICT("Application_Control_MAC")},{field:"device_type",displayName:a.DICT("Application_Control_Device_Type_N"),cellTemplate:"UG_table_select_with_inline_edit.html",editRow:"edit",changedCbk:m},{field:"os_type",displayName:a.DICT("Application_Control_OS_Type_N"),
cellTemplate:"UG_table_select_with_inline_edit.html",editRow:"edit"}]});a.gridExclusionInvalidCbk=function(a){a.row.entity.disableExclusionChk=a.rowInvalid};a.gridExclusionOptions=app.uiGrid.generateGridOptions({IDPreifx:"exclusion",rowHeight:1.5*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:s,headerChangedCbk:s,disableChkBoxField:"disableExclusionChk"},{field:"ipmac",displayName:a.DICT("Application_Control_Type"),editRow:"edit",width:155,id:"exclusions_type",cellTemplate:"UG_table_select_with_inline_edit.html"},
{field:"ipmac",displayName:a.DICT("Application_Control_IP_MAC"),editRow:"edit",minWidth:290,validationCbk:"gridExclusionInvalidCbk",required:!0,id:"exclusions_ipgroupmac",cellTemplate:"application_ctrl_ipsel_mactxt.html"},{field:"ecdevicetype",displayName:a.DICT("Application_Control_Device_Type_N"),editRow:"edit",minWidth:200,changedCbk:a.chk_ec_device_os,id:"exclusions_devicetype",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"ecostype",displayName:a.DICT("Application_Control_OS_Type_N"),
editRow:"edit",minWidth:200,id:"exclusions_ostype",cellTemplate:"UG_table_select_with_inline_edit.html"},{field:"empty",displayName:"",isEmpty:!0}]});var A=function(){return a.model.policys.length>=a.maxAVCEntity?(a.msg=a.DICT("Application_Control_Max_Policies",{"%s0":a.maxAVCEntity,"%s1":a.model.policys.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},B=function(){return 30<=a.edit.exclusions.length?(a.msg=a.DICT("Application_Control_Max_Exclusion_List",{"%s":a.edit.exclusions.length}),
app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},C=function(c){b.post({method:"del_app_control",params:{avc:{policy:a.del_policys}},success:function(b){"function"===$.type(c)&&c();a.success=!0},error:function(a){"function"===$.type(c)&&c()}})};a.funs={mainSave:function(){var c=function(){b.post({method:"set_app_control",params:{avc:{enable:a.model.enable}},success:function(b){a.success=!0;z()},error:function(a){z()}})};a.model.enable!==a.model.orig_enable?a.del_policys.length?C(c):
c():a.del_policys.length?C(function(){z()}):z()},mainCancel:function(){z()},policyEdit:function(){a.edit=void 0;angular.forEach(a.model.policys,function(b){b.checked&&(a.edit=angular.copy(b))});a.edit?(a.edit.isEditMode=!0,a.change_ipgroup(),a.gridApplicationOptions.data=a.edit.display_apps,a.gridExclusionOptions.data=a.edit.exclusions,a.currPage=y.policy_edit):Log(ERROR,"policy edit button error, checked item is not exist")},policyAdd:function(){A()||(a.edit=x(),a.edit.checked=!0,a.edit.seq=a.model.policys.length,
a.chk_device_os(),a.change_ipgroup(),a.gridApplicationOptions.data=a.edit.display_apps,a.gridExclusionOptions.data=a.edit.exclusions,a.currPage=y.policy_edit,a.modified())},policyDel:function(){for(var b=a.model.policys.length-1;0<=b;b--)a.model.policys[b].checked&&(a.del_policys.push({name:a.model.policys[b].name}),a.model.policys.splice(b,1),a.modified())},exclusionEdit:function(){angular.forEach(a.edit.exclusions,function(b,c){b.checked&&(a.chk_ec_device_os(c,{entity:b}),b.edit=!0)})},exclusionAdd:function(){if(!B()){var b=
r(),c=a.edit.exclusions.length;b.seq=c+1;b.edit=!0;b.checked=!0;a.chk_ec_device_os(c,{entity:b});a.sel_cnts+=1;a.edit.exclusions.push(b);a.gridExclusionOptions.gridApi.customApi.scrollToLast();a.modified()}},exclusionDel:function(){for(var b=a.edit.exclusions.length-1;0<=b;b--)a.edit.exclusions[b].checked&&(a.edit.exclusions.splice(b,1),a.modified(),a.sel_cnts-=1)},policySave:function(){var c=[],d=a.edit,e,g=function(){var e={name:d.name,description:d.description,applications:d.apps,enable:d.enable,
"device-type":d.policydevicetype,"os-type":d.policyostype,"apply-ip-group":"@none"===d.ipgroup?!1:!0,"ip-groups":[],"user-exclusion-entry":c},g,k=[];"@none"!==d.ipgroup&&(e["ip-groups"]=[d.ipgroup],g={name:d.ipgroup,ips:[],macs:[]},angular.forEach(a.model.ipgroups_ips_macs[d.ipgroup].ips,function(a){g.ips.push({seq:a.seq,"device-type":a.device_type.select,"os-type":a.os_type.select})}),angular.forEach(a.model.ipgroups_ips_macs[d.ipgroup].macs,function(a){g.macs.push({mac:a.mac,"device-type":a.device_type.select,
"os-type":a.os_type.select})}),(g.ips.length||g.macs.length)&&k.push({method:"set_ipgroup",params:{"ip-groups":{"ip-group":[g]}}}));"#always-on"===d.schedule?e["always-on"]=null:e.schedule=d.schedule;k.push({method:"set_app_control",params:{avc:{enable:a.model.enable,policy:[e]}}});b.post({method:"set_bulk",params:k,success:function(b){a.success=!0;z();a.currPage=y.main},error:function(b){z();a.currPage=y.main}})};angular.forEach(d.exclusions,function(a,b){e={seq:b+1,"device-type":a.ecdevicetype.select,
"os-type":a.ecostype.select};switch(a.ipmac.select){case "mac":e.mac=a.ipmac.mac;break;case "ipv4-ip":e["user-exclusion-ip"]=[{seq:1,ipv4:{single:a.ipmac.v4_ip}}];break;case "ipv4-range":e["user-exclusion-ip"]=[{seq:1,ipv4:{range:{start:a.ipmac.v4_rangeS,end:a.ipmac.v4_rangeE}}}];break;case "ipv6-ip":e["user-exclusion-ip"]=[{seq:1,ipv6:{single:a.ipmac.v6_ip}}];break;case "ipv6-range":e["user-exclusion-ip"]=[{seq:1,ipv6:{range:{start:a.ipmac.v6_rangeS,end:a.ipmac.v6_rangeE}}}];break;case "any":break;
default:return}c.push(e)});a.del_policys.length?C(g):g()},policyCancel:function(){a.currPage=y.main;a.resetModified()},policy2AppEdit:function(){var b=angular.copy(a.model.meta),c,d,e;a.expandFlag=!1;angular.forEach(a.edit.apps,function(a){angular.forEach(b,function(b){b.categories&&b.categories[a.category]&&(c=b.categories[a.category],"-1"===a.application?(angular.forEach(c.applications,function(b){b.checked=!0;angular.forEach(b.behaviors,function(b){b.checked=!0;b.action=a.action});b.action=a.action}),
c.action=a.action):c.applications&&c.applications[a.application]&&(d=c.applications[a.application],"-1"===a.behaviour?(angular.forEach(d.behaviors,function(b){b.checked=!0;b.action=a.action}),d.action=a.action):d.behaviors&&d.behaviors[a.behaviour]&&(e=d.behaviors[a.behaviour],e.checked=!0,e.action=a.action)))})});a.edit.meta=[];var g=0,k=[],h,l,p;angular.forEach(b,function(a){h=[];angular.forEach(a.categories,function(a){l=[];angular.forEach(a.applications,function(a){p=[];angular.forEach(a.behaviors,
function(a){p.push(a)});a.behaviors=angular.copy(p);l.push(a)});a.applications=angular.copy(l);h.push(a)});a.categories=angular.copy(h);k.push(angular.copy(a))});a.edit.meta=k;var r,z,m;angular.forEach(a.edit.meta,function(a){void 0!==a.name&&(a.id="group"+g,g++);r=!1;angular.forEach(a.categories,function(a){z=!1;angular.forEach(a.applications,function(a){m=!1;angular.forEach(a.behaviors,function(a){a.checked||(m=!0)});!1===m?a.checked=!0:z=!0});!1===z?a.checked=!0:r=!0});!1===r&&(a.checked=!0)});
a.currPage=y.app_edit},policy2IpGroupEdit:function(){},policy2ScheduleEdit:function(){},appSave:function(){a.edit.apps=[];a.edit.display_apps=[];var b=0,c,d,e,g,k,h,l,p,r;angular.forEach(a.edit.meta,function(z){angular.forEach(z.categories,function(z){l=!0;r=[];d=b;g=void 0;angular.forEach(z.applications,function(b){e=void 0;h=k=!0;c=d;p=[];angular.forEach(b.behaviors,function(d){d.checked?(e?e!==d.action&&(k=!1):e=d.action,a.edit.display_apps.push({seq:c,category:z.name,application:b.name,behaviour:d.name,
action:d.action}),p.push({seq:c,category:z.id,application:b.id,behaviour:d.id,action:d.action}),c+=1):h=!1});k&&h?(c=d,p=[{seq:c,category:z.id,application:b.id,behaviour:"-1",action:e}],g||(g=e),c+=1):l=!1;b.checked||(l=!1);g&&g!==e&&(l=!1);d=c;r=r.concat(p)});l?(r=[{seq:b,category:z.id,application:"-1",behaviour:"-1",action:g}],b+=1):b=d;a.edit.apps=a.edit.apps.concat(r)})});a.gridApplicationOptions.data=a.edit.display_apps;a.currPage=y.policy_edit},appCancel:function(){a.currPage=y.main;a.resetModified()},
appBack:function(){a.currPage=y.policy_edit}};a.change_behaviors=function(a,b){var c="",d=function(a){angular.forEach(a,function(a){a.action=c})},e=function(a){angular.forEach(a,function(a){a.action=c;d(a.behaviors)})},c=a.action;if("null"!==c)switch(b){case "group":angular.forEach(a.categories,function(a){a.action=c;e(a.applications)});break;case "category":e(a.applications);break;case "application":d(a.behaviors)}};a.checkPolicyName=function(){var b=!1;a.edit.name?(angular.forEach(a.model.policys,
function(c){a.edit.name===c.name&&(b=!0)}),b?a.appform.name.$setValidity("repeat",!1):a.appform.name.$setValidity("repeat",!0)):a.appform.name.$setValidity("repeat",!0)};a.expandAll=function(b){"true"===b?(angular.forEach(a.edit.meta,function(a){a.expanded=!0;angular.forEach(a.categories,function(a){a.expanded=!0})}),a.expandFlag=!0):(angular.forEach(a.edit.meta,function(a){a.expanded=!1;angular.forEach(a.categories,function(a){a.expanded=!1;angular.forEach(a.applications,function(a){a.expanded=!1})})}),
a.expandFlag=!1)};a.combineNote=a.DICT("Application_Control_Note",{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Application_Control_Here")+"</u></a>"});a.abc;a.model.schema={global_action:[{id:"null",displayName:"------------------"},{id:"log",displayName:a.DICT("Application_Control_Permit_Log")},{id:"pass",displayName:a.DICT("Application_Control_Permit")},{id:"block",displayName:a.DICT("Application_Control_Block")},{id:"log-block",displayName:a.DICT("Application_Control_Block_Log")}],
action:[{id:"log",displayName:a.DICT("Application_Control_Permit_Log")},{id:"pass",displayName:a.DICT("Application_Control_Permit")},{id:"block",displayName:a.DICT("Application_Control_Block")},{id:"log-block",displayName:a.DICT("Application_Control_Block_Log")}],ipmacs:[{id:"any",displayName:a.DICT("Application_Control_Any")},{id:"mac",displayName:a.DICT("Application_Control_MAC_N")},{id:"ipv4-ip",displayName:a.DICT("Application_Control_IPv4_IP_Addr")},{id:"ipv4-range",displayName:a.DICT("Application_Control_IPv4_IP_Range")},
{id:"ipv6-ip",displayName:a.DICT("Application_Control_IPv6_IP_Addr")},{id:"ipv6-range",displayName:a.DICT("Application_Control_IPv6_IP_Range")}]};(function(){a.del_policys=[];v.all([l(),k(),q.get(),d(),p()]).then(function(b){var d;d=b[2]||{};a.model.devicetypes=angular.copy(d.device||[]);a.model.ostypes=angular.copy(d.os||{});e=q.get_default_device_type(a.model.devicetypes);w=q.get_default_os_type(a.model.ostypes[e]);h(b[0]&&b[0].data&&b[0].data.result||{});g(b[1]&&b[1].data&&b[1].data.result||{});
c(b[3]&&b[3].data&&b[3].data.result||{});u(b[4]&&b[4].data&&b[4].data.result||{});a.resetModified()})})();z()}]);app.controller("qos_statistics_main",["$scope","$q","MyHttp","ngGridCellBuilder","$templateCache","Sets","$filter","wan_service","userAccessRight","UserSession",function(a,b,s,n,v,t,m,q,e,w){a.model=a.model||{};a.ctx=a.ctx||{};a.userAccessFlag=e.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();a.ctx.displayresult=!1;var l,h,p=function(){var c=s.post({url:resource_base+"data/qos_state.json",method:"get_qos_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+
a.config.url)}}),d=s.post({url:resource_base+"data/qos_wan_bandwidth.json",method:"get_qos_wan_bandwidth",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),e=s.post({url:resource_base+"data/qos_queuing.json",method:"get_qos_queuing",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),g=s.post({url:resource_base+"data/qos_policing.json",method:"get_qos_policing",error:function(a){console.log("AJAX loading error: "+a.status+
", URL: "+a.config.url)}}),k=s.post({url:resource_base+"data/time.json",method:"get_time",success:function(b){a.currentTime=b.data&&b.data.result&&b.data.result["system-state"]&&b.data.result["system-state"].clock?b.data.result["system-state"].clock["current-datetime"]||0:0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,d,e,g,k]).then(function(b){for(var c=0;3>c;c++)angular.extend(a.model,b[c].data.result);b=b[3].data.result;a.model["ciscosb-qos"]||
(a.model["ciscosb-qos"]={});angular.extend(a.model["ciscosb-qos"],b["ciscosb-qos"]["policer-policies"]);a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);b=a.collect_wan_list();a.model.selected=void 0!==a.model.keepifname?a.model.keepifname:b[0].name;a.name=a.model["ciscosb-qos"]["queue-model"]||"";a.model["interfaces-state"]&&a.model["interfaces-state"]["interface"]&&(u(),x());a.gridOutboundStat.data=a.model.outbound;a.gridInboundStat.data=a.model.inbound;a.loadReady=!0})["catch"](function(a){console.log("=="+
a)})};a.model={policy:{},queuepolicy:{},policerpolicy:{},stat:{},outbound:{},inbound:{}};var u=function(){angular.forEach(a.model["ciscosb-qos"]["queue-policies"]["queue-policy"],function(b,c){a.model.queuepolicy[b.name]={description:b.description||"",outbound:b.queues||""}});angular.forEach(a.model["ciscosb-qos"]["policer-policy"],function(b,c){a.model.policerpolicy[b.name]={inbound:b.policer||""}});angular.forEach(l,function(b,c){var d=b["ciscosb-qos"]["qos-policy"].outbound[a.name]||"";a.model.policy[b.name]=
{outboundpolicyname:d||"",description:a.model.queuepolicy[d].description||"",inboundpolicyname:b["ciscosb-qos"]["qos-policy"].inbound["rate-control"]||""||""}})},x=function(){h=k();angular.forEach(h,function(b,c){a.model.stat[b.name]={outbound:void 0!==b["ciscosb-qos"]["queue-statistics"].outbound?b["ciscosb-qos"]["queue-statistics"].outbound:"",inbound:void 0!==b["ciscosb-qos"]["queue-statistics"].inbound?b["ciscosb-qos"]["queue-statistics"].inbound:"",last_reset_time:void 0!==b["ciscosb-qos"]["queue-statistics"]["last-reset-time"]?
b["ciscosb-qos"]["queue-statistics"]["last-reset-time"]:""}});r();d();c()},r=function(){a.model.outbound=[];var b=a.model["ciscosb-qos"]["queue-model"]||"",c=a.model.queuepolicy[a.model.policy[a.model.selected].outboundpolicyname||""]||"",d={};if("priority"===b){a.model.stat[a.model.selected]&&(""!==a.model.stat[a.model.selected].outbound&&void 0!==a.model.stat[a.model.selected].outbound)&&(d=a.model.stat[a.model.selected].outbound.priority||"");for(var b=["highest","high","medium","low"],e=0;e<b.length;e++)a.model.outbound.push({queue:e+
1,tclass:""!==c.outbound&&void 0!==c.outbound.priority[b[e]]?c.outbound.priority[b[e]]:"<unspecified>",sent:d[b[e]]&&void 0!==d[b[e]].packets?d[b[e]].packets:"0",drop:d[b[e]]&&void 0!==d[b[e]].discards?d[b[e]].discards:"0"})}else if("rate-control"===b){var g=[],k=[];a.model.stat[a.model.selected]&&(""!==a.model.stat[a.model.selected].outbound&&void 0!==a.model.stat[a.model.selected].outbound)&&(d=a.model.stat[a.model.selected].outbound["rate-control"]||"");angular.forEach(d.queue,function(a,b){g["id"+
a.id]={packets:a.packets||"0",discards:a.discards||"0"}});angular.forEach(c.outbound["rate-control"].queue,function(a,b){k["id"+a.id]={tclass:void 0!==a.match?a.match:"<unspecified>"}});for(e=0;8>e;e++)a.model.outbound.push({queue:e+1,tclass:void 0!==(k["id"+(e+1)]&&k["id"+(e+1)].tclass)?k["id"+(e+1)].tclass:"<unspecified>",sent:void 0!==(g["id"+(e+1)]&&g["id"+(e+1)].packets)?g["id"+(e+1)].packets:"0",drop:void 0!==(g["id"+(e+1)]&&g["id"+(e+1)].discards)?g["id"+(e+1)].discards:"0"})}else if("low-latency"===
b){a.model.stat[a.model.selected]&&(""!==a.model.stat[a.model.selected].outbound&&void 0!==a.model.stat[a.model.selected].outbound)&&(d=a.model.stat[a.model.selected].outbound["low-latency"]||"");b=["priority","queue1","queue2","queue3"];for(e=0;e<b.length;e++)a.model.outbound.push({queue:e+1,tclass:""!==c.outbound&&void 0!==c.outbound["low-latency"][b[e]].match?c.outbound["low-latency"][b[e]].match:"<unspecified>",sent:void 0!==(d[b[e]]&&d[b[e]].packets)?d[b[e]].packets:"0",drop:void 0!==(d[b[e]]&&
d[b[e]].discards)?d[b[e]].discards:"0"})}a.gridOutboundStat.data=a.model.outbound},d=function(){a.model.inbound=[];var b=[],c=[],d=a.model.policerpolicy[a.model.policy[a.model.selected].inboundpolicyname||""]||"",e={};a.model.stat[a.model.selected]&&(""!==a.model.stat[a.model.selected].inbound&&void 0!==a.model.stat[a.model.selected].inbound)&&(e=a.model.stat[a.model.selected].inbound);angular.forEach(e.queue,function(a,c){b["id"+a.id]={packets:a.packets||"0",discards:a.discards||"0"}});angular.forEach(d.inbound["class"],
function(a,b){c["id"+a.id]={tclass:void 0!==a.match?a.match:"<unspecified>"}});for(d=0;8>d;d++)a.model.inbound.push({queue:d+1,tclass:void 0!==(c["id"+(d+1)]&&c["id"+(d+1)].tclass)?c["id"+(d+1)].tclass:"<unspecified>",sent:void 0!==(b["id"+(d+1)]&&b["id"+(d+1)].packets)?b["id"+(d+1)].packets:"0",drop:void 0!==(b["id"+(d+1)]&&b["id"+(d+1)].discards)?b["id"+(d+1)].discards:"0"});a.gridInboundStat.data=a.model.inbound},c=function(){var b=a.model.stat[a.model.selected]&&""!==a.model.stat[a.model.selected].last_reset_time?
a.model.stat[a.model.selected].last_reset_time:0,c=0;0!==a.currentTime&&0!==b&&(c=Date.parse(a.currentTime)/1E3-Date.parse(b)/1E3);a.model.lastResetTime=0<c?{days:Math.floor(c/86400),hours:Math.floor(c%86400/3600),minutes:Math.floor(c%86400%3600/60)}:{days:"0",hours:"0",minutes:"0"}};a.update=function(){r();d();c()};a.collect_wan_list=function(){a.filterWAN_WANsub={physical:!0,subinterface:!1,usb:!0};var b=[];a.model.interfaces&&a.model.interfaces["interface"]&&(b=q.filter(a.model.interfaces["interface"],
a.filterWAN_WANsub));return l=b};var k=function(){a.filterWAN_WANsub={physical:!0,subinterface:!1,usb:!0};var b=[];a.model["interfaces-state"]&&a.model["interfaces-state"]["interface"]&&(b=q.filter(a.model["interfaces-state"]["interface"],a.filterWAN_WANsub));return b};a.gridOutboundStat=app.uiGrid.generateGridOptions({columnDefs:[{field:"queue",displayName:a.DICT("Switch_QoS_Statistics_Queue")},{field:"tclass",displayName:a.DICT("Switch_QoS_Statistics_Traffic_Class")},{field:"sent",displayName:a.DICT("Switch_QoS_Statistics_Packets_Sent")},
{field:"drop",displayName:a.DICT("Switch_QoS_Statistics_Packets_Dropped")}]});a.gridInboundStat=app.uiGrid.generateGridOptions({columnDefs:[{field:"queue",displayName:a.DICT("Switch_QoS_Statistics_Queue")},{field:"tclass",displayName:a.DICT("Switch_QoS_Statistics_Traffic_Class")},{field:"sent",displayName:a.DICT("Switch_QoS_Statistics_Packets_Sent")},{field:"drop",displayName:a.DICT("Switch_QoS_Statistics_Packets_Dropped")}]});var g=function(a){if(a&&a.rpc){var b={rpc:a.rpc};a.input&&(b.input=a.input);
s.post({method:"action",background:a.background||!1,params:b,success:function(b){"function"===$.type(a.success)&&a.success(b)},error:function(b){"function"===$.type(a.error)&&a.error(b)}})}};a.clear=function(){a.model.keepifname=a.model.selected;var b=function(b){if(b.data.result&&b.data.result.output)switch(a.ctx.displayresult=!0,b.data.result.output.code){case 0:a.ctx.return_code=!0;p();break;default:a.ctx.return_code=!1}else console.log("Error: getRPCResult, data.result not exist")};g({rpc:"reset-qos-statistics",
input:{"interface-name":a.model.selected},success:b,error:b})};p()}]);app.controller("tcpIPServicesCtrl",["$scope","MyHttp",function(a,b){var s={"127.0.0.1":"localhost"};a.DICT("CLOSE_WAIT");a.DICT("ESTABLISHED");var n={tcpv4:"tcp4",udpv4:"udp4",tcpv6:"tcp6",udpv6:"udp6"},v=function(b){a.model.ports=[];a.model.connections=[];b||(b={});var s=[],l=[];b["tcp-ip-services-state"]&&b["tcp-ip-services-state"].service&&(s=b["tcp-ip-services-state"].service);b["tcp-ip-services-state"]&&b["tcp-ip-services-state"].connection&&(l=b["tcp-ip-services-state"].connection);angular.forEach(s,
function(b,e){a.model.ports.push({protocol:n[b.protocol],ip_addrress:q(b["listen-ip-address"]),list_port:m(b["listen-port"],b["listen-port-alias"]),listen_port_alias:b["listen-port-alias"]})});angular.forEach(l,function(b,e){a.model.connections.push({protocol:n[b.protocol],local_ip_address:q(b["local-ip-address"]),local_port:m(b["local-port"],b["local-port-alias"]),foreign_address:q(b["foreign-address"]),foreign_port:m(b["foreign-port"],b["foreign-port-alias"]),status:b.status})});a.gridPortOptions.data=
a.model.ports;a.gridConnectionOptions.data=a.model.connections},t=function(b){a.model.services=[];angular.forEach(b.services.service,function(b,e){b["port-range"]&&a.model.services.push({name:b.name,start:b["port-range"].start,end:b["port-range"].end})})},m=function(a,b){return res=b?b+" ("+a+")":a},q=function(a){var b=s[a];return b?b+" ("+a+")":a?a:"*"};a.dataReady=!1;a.model={services:[],ports:[],connections:[]};a.gridPortOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"protocol",displayName:a.DICT("TCP-IP_Services_Protocol")},
{field:"ip_addrress",displayName:a.DICT("TCP-IP_Services_Listen_IP_Addr")},{field:"list_port",displayName:a.DICT("TCP-IP_Services_Listen_Port")}]});a.gridConnectionOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"protocol",displayName:a.DICT("TCP-IP_Services_Protocol")},{field:"local_ip_address",displayName:a.DICT("TCP-IP_Services_Local_IP_Addr")},{field:"local_port",displayName:a.DICT("TCP-IP_Services_Local_Port")},{field:"foreign_address",displayName:a.DICT("TCP-IP_Services_Foreign_Addr")},
{field:"foreign_port",displayName:a.DICT("TCP-IP_Services_Foreign_Port")},{field:"status",displayName:a.DICT("TCP-IP_Services_Status")}]});(function(){b.post({method:"get_services",url:resource_base+"data/service_management.json",success:function(a){t(a.data.result)},error:function(a){console.log("tcpIPServicesCtrl getServicesData error, status: "+a.status)}})})();(function(){b.post({method:"get_tcp_ip_services_state",url:resource_base+"data/status_tcp_ip_services.json",success:function(b){v(b.data.result);
a.dataReady=!0},error:function(b){console.log("tcpIPServicesCtrl getData error, status: "+b.status);a.dataReady=!0}})})()}]);app.controller("DhcpBindingCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,s,n){a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();a.model={bindings:[]};a.dataReady=!1;var v=function(){b.post({url:resource_base+"data/dhcp_bindings.json",method:"get_dhcp_binding_state",success:function(a){m(a.data&&a.data.result)},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},t={"provided-isp":a.DICT("DHCP_Bindings_Provided_ISP"),
dynamic:a.DICT("DHCP_Bindings_Dynamic"),"static":a.DICT("DHCP_Bindings_Static")},m=function(b){a.model.bindings=[];b||(b={});var e=[],m,l;b["dhcp-binding-state"]&&b["dhcp-binding-state"].entry&&(e=b["dhcp-binding-state"].entry);angular.forEach(e,function(b){m=parseInt(b["lease-expire-time"],10);if(!isNaN(m))if(0<m){var e=m,u=Math.floor(e/86400),n=Math.floor((e-86400*u)/3600),e=[u,n,Math.floor((e-86400*u-3600*n)/60),Math.floor(e%60)];m=e[0]+" days, "+e[1]+" hours, "+e[2]+" minutes"}else m="--";l=t[b.type];
a.model.bindings.push({hostname:b.hostname||"--",ip_address:b["ip-address"]||"--",mac:b.mac,lease_expire_time:m||"--",type:l||"--",action:[{displayName:a.DICT("DHCP_Bindings_Delete"),className:"icon-delete",cbk:a.deleteRule}]})});a.gridDHCPBindingOptions.data=a.model.bindings;a.dataReady=!0};a.gridDHCPBindingOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"hostname",displayName:a.DICT("DHCP_Bindings_Hostname")},{field:"ip_address",displayName:a.DICT("DHCP_Bindings_IPv4_v6_Addr")},{field:"mac",
displayName:a.DICT("DHCP_Bindings_MAC_Addr")},{field:"lease_expire_time",displayName:a.DICT("DHCP_Bindings_Lease_Expires")},{field:"type",displayName:a.DICT("DHCP_Bindings_Type")},{field:"action",displayName:a.DICT("DHCP_Bindings_Action"),cellTemplate:"UG_table_icons.html"}]});a.deleteRule=function(a,e){b.post({method:"action",forcedUsingGet:!0,params:{rpc:"dhcp-release-binding",input:{mac:e.entity.mac}},success:function(){v()},error:function(){v()}})};a.refresh=function(){v()};v()}]);app.controller("conn_devices_main",["$scope","MyHttp",function(a,b){var s=app.rshelper,n={"static":a.DICT("Connected_Devices_Static"),dynamic:a.DICT("Connected_Devices_Dynamic"),pppoe:a.DICT("Connected_Devices_PPPoe"),pptp:a.DICT("Connected_Devices_PPTP"),"trasparent-bridge":a.DICT("Connected_Devices_TB"),l2tp:a.DICT("Connected_Devices_L2TP")},v=function(a){a=a||{};b.post({method:"get_connect_device",url:resource_base+"data/conn_devices.json",success:function(b){t(b.data.result,a)},error:function(a){console.log("conn_devices_main Error status: "+
a.status)}})},t=function(b,e){b||(b={});var m=e.ip_type||"any",l=!1,h=!1,p=b["interfaces-state"]&&b["interfaces-state"]["interface"]||[],u,x,r;if("ipv4"===m||"any"===m)l=!0,a.model.ipv4State=[];if("ipv6"===m||"any"===m)h=!0,a.model.ipv6State=[];angular.forEach(p,function(b,c){u=b.name;x=b.ipv4&&b.ipv4.neighbor||[];r=b.ipv6&&b.ipv6.neighbor||[];l&&angular.forEach(x,function(b){a.model.ipv4State.push({hostname:b.hostname||"-",ip:b.ip||"-",mac:b["link-layer-address"]||"-",type:n[b.origin]||"-",intf:u||
"-",checked:!1,disableChk:!1})});h&&angular.forEach(r,function(b){a.model.ipv6State.push({ip:b.ip||"-",mac:b["link-layer-address"]||"-",checked:!1,disableChk:!1})})});a.gridIPv4State.Options.data=a.model.ipv4State;a.gridIPv6State.Options.data=a.model.ipv6State;a.dataReady=!0};a.forcedUsingPost=!0;a.gridIPv4State={};a.gridIPv4State.totalServerItems=0;a.gridIPv4State.Selections=[];a.gridIPv4State.procNgClick=function(b){a.gridIPv4State.Selections=[];angular.forEach(a.model.ipv4State,function(b,m){b.checked?
(a.gridIPv4State.Selections.push(b),s.rs_event_trig(b,"SEL_ITEM_EVENT")):s.rs_event_trig(b,"DESEL_ITEM_EVENT")})};a.gridIPv4State.add_to_static_dhcp=function(){var b=[],e;angular.forEach(a.gridIPv4State.Selections,function(a,l){e={name:a.mac.replace(/:/g,"_"),mac:a.mac,"ip-address":a.ip,enable:!0};a.hostname&&("*"!==a.hostname&&"-"!==a.hostname)&&(e.name=a.hostname);b.push(e)});m(b)};a.gridIPv4State.refresh=function(){v({ip_type:"ipv4"})};a.gridIPv4State.Options=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",
isCheckbox:!0,changedCbk:a.gridIPv4State.procNgClick,headerChangedCbk:a.gridIPv4State.procNgClick,disableChkBoxField:"disableChk"},{field:"hostname",displayName:a.DICT("Connected_Devices_Hostname")},{field:"ip",displayName:a.DICT("Connected_Devices_IPv4_Addr")},{field:"mac",displayName:a.DICT("Connected_Devices_MAC_Addr")},{field:"type",displayName:a.DICT("Connected_Devices_Type")},{field:"intf",displayName:a.DICT("Connected_Devices_Interface")}]});a.gridIPv6State={};a.gridIPv6State.Options=app.uiGrid.generateGridOptions({columnDefs:[{field:"ip",
displayName:a.DICT("Connected_Devices_IPv6_Addr")},{field:"mac",displayName:a.DICT("Connected_Devices_MAC_Addr")}]});a.gridIPv6State.refresh=function(){v({ip_type:"ipv6"})};a.model={ipv4State:[],ipv6State:[]};var m=function(m){m=app.modelhelper.web2dbFn({static_dhcp:{entry:m}});b.post({url:resource_base+"p_data/rpc_result.json",method:"set_dhcp_static",forcedUsingPost:a.forcedUsingPost,params:m,success:function(b){a.success=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+
a.config.url);modelinit()}})};a.dataReady=!1;v()}]);app.controller("system_summary_main",["$scope","$q","MyHttp","$templateCache","rpcFns","Sets","$filter","wan_service","wan_lib","userAccessRight","UserSession","modelInfo","dt",function(a,b,s,n,v,t,m,q,e,w,l,h,p){var u=app.TOOLS.getVal,x=!1,r=void 0;a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.usbs=a.ctx.usbs||[];a.jumpToPage=app.TOOLS.jumpToPage;a.model.vpnstatus=[];a.model.bootup_time="";a.model.current_time="";a.model.bootup_timstamp="";a.model.current_timestamp="";var d=void 0,c=a.DICT("System_Summary_Days"),
k=a.DICT("System_Summary_Hours"),g=a.DICT("System_Summary_Minutes"),z=a.DICT("System_Summary_Sec");a.spec=a.spec||{};a.forcedUsingPost=!0;var y={procBackground:!0,forcedUsingPost:a.forcedUsingPost},A={procBackground:!1,forcedUsingPost:a.forcedUsingPost};a.userAccessFlag=w.get();a.ruFlag=w.russia();a.wan1MAC="";a.wan2MAC="";a.vlanMAC="";a.cpuMemUsage="N/A";"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&l.logout();a.checkRepeat=[];0<=h.get_pid().search("RV345")?(a.checkRepeat.push("0"),a.checkRepeat.push("1")):
a.checkRepeat.push("0");a.spec.WifiSupport=h.spec_WifiSupport();a.model_wifi=a.model_wifi||{};a.model.radio24g=a.model.radio24g||{};a.model.radio5g=a.model.radio5g||{};a.model.radio24g_enable="";a.model.radio24g_mac="";a.model.radio24g_channel="";a.model.radio24g_mode="";a.model.radio24g_bw="";a.model.radio5g_enable="";a.model.radio5g_mac="";a.model.radio5g_channel="";a.model.radio5g_mode="";a.model.radio5g_bw="";var B=function(){var c=s.post({url:resource_base+"data/system_summary.json",method:"get_system_info",
procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),d=s.post({url:resource_base+"data/wlan_button_state.json",method:"get_wifi_button_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),g=s.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",procBackground:!0,error:function(a){console.log("WANSettingCtrl error: "+a.status)}}),k,h,l,p,r,u,d=b.all([c,d,g]).then(function(c){Log(DEBUG,
"phase1_promise");for(var d=0;d<c.length;d++)H(c[d]);a.use_firmware_state_sample={"firmware-state":{version:"N/A","latest-version":"N/A",images:{image:[]}}};t.recover_object(a.model,a.use_firmware_state_sample);a.schema=a.schema||{};a.schema.PortNameList={LAN1:{role:"1",alias:"LAN"},LAN2:{role:"2",alias:"LAN"},LAN3:{role:"3",alias:"LAN"},LAN4:{role:"4/DMZ",alias:"LAN"},LAN5:{role:"5",alias:"LAN"},LAN6:{role:"6",alias:"LAN"},LAN7:{role:"7",alias:"LAN"},LAN8:{role:"8",alias:"LAN"},USB1:{role:"USB",
alias:"USB1"},USB2:{role:"USB",alias:"USB2"},USB3:{role:"USB",alias:"USB3"},WAN1:{role:"Internet",alias:"WAN1"},WAN2:{role:"Internet",alias:"WAN2"},WAN_PORT1:{role:"Internet",alias:"WAN1"},WAN_PORT2:{role:"Internet",alias:"WAN2"}};a.schema.StatusMap={"true":a.DICT("System_Summary_On"),"false":a.DICT("System_Summary_Off")};a.schema.RV345PortNameList={LAN1:{role:"1",alias:"LAN"},LAN2:{role:"2",alias:"LAN"},LAN3:{role:"3",alias:"LAN"},LAN4:{role:"4",alias:"LAN"},LAN5:{role:"5",alias:"LAN"},LAN6:{role:"6",
alias:"LAN"},LAN7:{role:"7",alias:"LAN"},LAN8:{role:"8",alias:"LAN"},LAN9:{role:"9",alias:"LAN"},LAN10:{role:"10",alias:"LAN"},LAN11:{role:"11",alias:"LAN"},LAN12:{role:"12",alias:"LAN"},LAN13:{role:"13",alias:"LAN"},LAN14:{role:"14",alias:"LAN"},LAN15:{role:"15",alias:"LAN"},LAN16:{role:"16/DMZ",alias:"LAN"},USB1:{role:"USB",alias:"USB1"},USB2:{role:"USB",alias:"USB2"},WAN1:{role:"Internet",alias:"WAN1"},WAN2:{role:"Internet",alias:"WAN2"},WAN_PORT1:{role:"Internet",alias:"WAN1"},WAN_PORT2:{role:"Internet",
alias:"WAN2"}};E();G();N();D();P();k=s.post({url:resource_base+"data/system_summary.json",method:"get_interface_state",procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});var g=b.defer();h=g.promise;!0===a.spec.WifiSupport&&function(){Log(DEBUG,"=initWifiRequest");p=s.post({url:resource_base+"data/wlan_radio.json",method:"get_wifi_interfaces",params:{filter:"WLAN"},procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+
", URL: "+a.config.url)}});r=s.post({url:resource_base+"data/wlan_radio_state.json",method:"get_radio_state",procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});u=s.post({url:resource_base+"data/wlan_state.json",method:"get_wlan_state",procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})}();var n=b.defer();l=n.promise;k.then(function(b){var c=!0;if(0===(((b.data&&b.data.result||{})["interfaces-state"]||
{})["interface"]||[]).length)c=!1;c?(H(b),a.use_interfaces_state_sample={"interfaces-state":{"interface":[]}},t.recover_object(a.model,a.use_interfaces_state_sample),I(),R(),Q(),a.loadReady_port=!0,g.resolve(),Log(DEBUG,"promiseOverlay"),n.resolve()):(Log(DEBUG,"promiseOverlay Data Abnormal"),n.reject())});c=e.init();b.all([l,c]).then(function(a){Log(DEBUG,"promiseOverlay promise4");(a=a[1]&&a[1][0])&&U(a);K()});h.then(function(b){b=b||{};if((b=(b.data||{}).result||{})&&b["interfaces-state"]&&b["interfaces-state"]["interface"]&&
b["interfaces-state"]["interface"])b=b["interfaces-state"]["interface"],a.filter_WAN=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}},angular.forEach(b,function(b,c){if(b&&b.name&&b.ddns){var d="^"+b.name+"$";if((d=m("filter")(a.collect_wan_list("interfaces-state"),a.filter_WAN(d)))&&d[0])d=d[0],d.ddns=d.ddns||{},t.recover_object(d.ddns,b.ddns)}});a.loadReday_DDNS=!0});!0===a.spec.WifiSupport&&function(){Log(DEBUG,"=procWifiRequest");p.then(function(b){if((b=(b.data||{}).result||
{})&&b.interfaces&&b.interfaces["interface"]){a.model_wifi=angular.copy(b);a.model.radio24g=F(a.model_wifi,"WLAN1");a.model.radio5g=F(a.model_wifi,"WLAN2");a.model.radio24g_mode=a.model.radio24g.radio&&a.model.radio24g.radio["operating-standards"]&&a.model.radio24g.radio["operating-standards"][0]||"";for(a.model.radio24g_mode="802.11"+a.model.radio24g_mode;0<=a.model.radio24g_mode.search(" ");)a.model.radio24g_mode=a.model.radio24g_mode.replace(" ","/");a.model.radio24g_bw=a.model.radio24g.radio&&
a.model.radio24g.radio["operating-channel-bandwidth"]||"";a.model.radio5g_mode=a.model.radio5g.radio&&a.model.radio5g.radio["operating-standards"]&&a.model.radio5g.radio["operating-standards"][0]||"";for(a.model.radio5g_mode="802.11"+a.model.radio5g_mode;0<=a.model.radio5g_mode.search(" ");)a.model.radio5g_mode=a.model.radio5g_mode.replace(" ","/");a.model.radio5g_bw=a.model.radio5g.radio&&a.model.radio5g.radio["operating-channel-bandwidth"]||""}});r.then(function(b){(b=(b.data||{}).result||{})&&
(b["interfaces-state"]&&b["interfaces-state"]["interface"])&&angular.forEach(b["interfaces-state"]["interface"],function(b){b.name&&("WLAN1"===b.name?(a.model.radio24g_mac=b["phys-address"]?b["phys-address"]:"",a.model.radio24g_channel=b.radio&&b.radio["channels-in-use"]?b.radio["channels-in-use"][0]:""):"WLAN2"===b.name&&(a.model.radio5g_mac=b["phys-address"]?b["phys-address"]:"",a.model.radio5g_channel=b.radio&&b.radio["channels-in-use"]?b.radio["channels-in-use"][0]:""))})});u.then(function(b){a.model.radio24g_enable=
"Disabled";a.model.radio5g_enable="Disabled";a.model.radio24g=F(a.model_wifi,"WLAN1");a.model.radio5g=F(a.model_wifi,"WLAN2");1===a.model.wifi_button_state&&(a.model.radio24g&&!0===a.model.radio24g.radio.enable&&(a.model.radio24g_enable="Enabled"),a.model.radio5g&&!0===a.model.radio5g.radio.enable&&(a.model.radio5g_enable="Enabled"))})}();a.get_usb_object().then(function(b){a.ctx.usbs=b.usbs||[]});a.loadReady=!0;Log(DEBUG,"phase1_promise Done")})["catch"](function(a){console.log("=="+a)}),g=b.all([d,
function(){return b.all([c]).then(function(a){return s.post({url:resource_base+"data/vpn_summary.json",method:"get_vpn_summary",params:{},procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})}(),function(){return b.all([c]).then(function(a){return s.post({url:resource_base+"data/security_summary.json",method:"get_security_summary",params:{},procBackground:!0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})}()]).then(function(b){for(var c=
1;c<b.length;c++)H(b[c]);a.use_vpn_summary_sample={"ipsec-profiles":{"ipsec-profile":[]},"site-to-sites":{"site-to-site":[]},"client-to-sites":{"client-to-site":[]},l2tp:{enable:!0},"l2tp-state":{connections:{connection:[]}},pptp:{enable:!0},"pptp-state":{connections:{connection:[]}},sslvpn:{enable:!1}};t.recover_object(a.model,a.use_vpn_summary_sample);a.loadReady_p2=!0;E()});b.all([d,g]).then(function(b){a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model)})};B();var C=function(a){s.post({url:resource_base+
"data/system_summary.json",method:"get_sys_state_platform",procBackground:!0,isPolling:!0,success:function(b){H(b);N();_.isFunction(a)&&a()},error:function(b){N();_.isFunction(a)&&a()}})},D=function(){void 0!==r&&clearTimeout(r);r=void 0;r=setTimeout(function(){r=void 0;C(function(){x||D()})},5E3)},E=function(){var b=a.model["site-to-sites"]||{},c=b["site-to-site"]||[],d=a.model["client-to-sites"]||{},e=d["client-to-site"]||[],g=a.model.l2tp||{},k=a.model.pptp||{},h=a.model.sslvpn||{},l=h["group-policies"]&&
h["group-policies"]["group-policy"]||[];a.model.vpnstatus=[];a.model.vpnstatus.push({name:a.DICT("System_Summary_Ipsec"),active:1<=a.getEnabledItems(c).length?a.DICT("System_Summary_Enabled"):a.DICT("System_Summary_Disabled"),configures:c.length||0,max_entity:b["max-tunnel"]||"-",connected_cnt:a.getConnNumOf("site-to-site-state")||0});a.model.vpnstatus.push({name:a.DICT("System_Summary_Easy_Vpn"),active:1<=a.getEnabledItems(e).length?a.DICT("System_Summary_Enabled"):a.DICT("System_Summary_Disabled"),
configures:e.length||0,max_entity:d["max-group"]||"-",connected_cnt:a.getConnNumOf("client-to-site-state")||0});a.model.vpnstatus.push({name:a.DICT("System_Summary_L2TP"),active:g.enable?a.DICT("System_Summary_Enabled"):a.DICT("System_Summary_Disabled"),configures:1,max_entity:g["max-session"]||"-",connected_cnt:a.getConnNumOf("l2tp-state")||0});a.model.vpnstatus.push({name:a.DICT("System_Summary_PPTP"),active:k.enable?a.DICT("System_Summary_Enabled"):a.DICT("System_Summary_Disabled"),configures:1,
max_entity:k["max-session"]||"-",connected_cnt:a.getConnNumOf("pptp-state")||0});a.model.vpnstatus.push({name:a.DICT("System_Summary_SSLVPN"),active:h.enable?a.DICT("System_Summary_Enabled"):a.DICT("System_Summary_Disabled"),configures:l.length||0,max_entity:h["max-session"]||0,connected_cnt:a.getConnNumOf("sslvpn-state")||0});a.gridVPNStatus.data=a.model.vpnstatus},I=function(){angular.forEach(a.model["interfaces-state"]["interface"],function(b){"WAN1"===b.name?a.wan1MAC=b["phys-address"]:"WAN2"===
b.name?a.wan2MAC=b["phys-address"]:"VLAN1"===b.name&&(a.vlanMAC=b["phys-address"])})},F=function(a,b){var c={};if(!a||!a.interfaces||!a.interfaces["interface"])return c;for(var d=a.interfaces["interface"].length,e="",g=0;g<d;g++)if(e=a.interfaces["interface"][g].name,e.match(b)){c=angular.copy(a.interfaces["interface"][g]);break}return c},H=function(b){angular.extend(a.model,b.data.result)},G=function(){var b=(a.model["system-state"]||{}).clock||{},c=b["boot-datetime"]||"",b=p.parser(b["current-datetime"]||
"");0===b.err_code&&(a.model.current_timestamp=p.get_time(b));b=p.parser(c);0===b.err_code&&(a.model.bootup_timstamp=p.get_time(b));J();L();d=setInterval(function(){a.model.current_timestamp&&(a.model.current_timestamp+=1E3);L()},1E3)},J=function(){d&&(clearInterval(d),d=void 0)},L=function(){var b,d,e,h;_.isNumber(a.model.current_timestamp)?(d=p.new_date(a.model.current_timestamp),a.model.current_time=p.timeStr(d),_.isNumber(a.model.bootup_timstamp)?(b=Math.abs(a.model.current_timestamp-a.model.bootup_timstamp),
b/=1E3,d=b%60,b=(b-d)/60,e=b%60,b=(b-e)/60,h=b%24,b=(b-h)/24,a.model.bootup_time=b+" "+c+" "+h+" "+k+" "+e+" "+g+" "+d+" "+z):a.model.bootup_time="N/A",app.TOOLS.apply(a)):(a.model.current_time="N/A",a.model.bootup_time="N/A",J())},N=function(){if(!a.model["system-state"]||!a.model["system-state"].platform)a.cpuMemUsage="N/A";else{var b=a.model["system-state"].platform||{},c=b.memory||{},b=u(b["cpu-usage"],""),c=u(c["physical-memory-usage"],""),d="",d=_.isNumber(b)&&_.isNumber(c)?b+"% / "+c+"%":"N/A";
a.cpuMemUsage=d}},M=[{name:"WAN_PORT1"},{name:"WAN_PORT2"}],P=function(){a.model&&a.model["fake-interfaces-state"]&&a.model["fake-interfaces-state"]["interface"]?a.model["fake-interfaces-state"]["interface"].splice(0):a.model["fake-interfaces-state"]={"interface":[]};var b=m("filter")(a.model.interfaces["interface"],function(a,b,c){return a.name&&a.name.match(/^(LAN|WAN|WAN_PORT|USB)/)?!0:!1}),b=b.concat(M);a.model["fake-interfaces-state"]["interface"]=angular.copy(b)},U=function(b){var c=a.collect_wan_list("interfaces");
angular.forEach(c,function(a,c){angular.forEach(b,function(b,c){a.name==b.name&&(a.ipv4=a.ipv4||{},a.ipv6=a.ipv6||{},a.ipv4.connectType=b.ipv4.connectType,a.ipv6.connectType=b.ipv6.connectType)})})},Q=function(){var b=a.collect_wan_list("interfaces-state"),c=a.collect_wan_list("interfaces");angular.forEach(b,function(a,b){angular.forEach(c,function(b,c){a.name==b.name&&(a._ref=b)})})},V=function(a){var b=[],c=[],d=[];angular.forEach(a,function(a){0<=a.name.search("WAN1")?b.push(a):0<=a.name.search("WAN2")&&
c.push(a)});1<b.length&&(b=b.sort(function(a,b){var c="",d="",c=0<=a.name.search("WAN1.")?a.name.replace("WAN1.",""):"0",d=0<=b.name.search("WAN1.")?b.name.replace("WAN1.",""):"0",c=parseInt(c,10),d=parseInt(d,10);return c>d?1:-1}));1<c.length&&(c=c.sort(function(a,b){var c="",d="",c=0<=a.name.search("WAN2.")?a.name.replace("WAN2.",""):"0",d=0<=b.name.search("WAN2.")?b.name.replace("WAN2.",""):"0",c=parseInt(c,10),d=parseInt(d,10);return c>d?1:-1}));return d=angular.copy(b.concat(c))},R=function(){a.filterWAN_WANsub=
{physical:!1,subinterface:!1,usb:!0};var b=q.filter(a.model["interfaces-state"]["interface"],a.filterWAN_WANsub);a.filterWAN_WANsub={physical:!0,subinterface:!0,usb:!1};var c=q.filter(a.model["interfaces-state"]["interface"],a.filterWAN_WANsub),d=m("filter")(a.model["interfaces-state"]["interface"],function(a,b,c){return a.name&&a.name.match(/^TUN\d+/)?!0:!1}),c=V(c),c=c.concat(b),c=c.concat(d);a.ctx=a.ctx||{};a.ctx.ifs_overlay=angular.copy(c)},K=function(){a.filterWANlogic={subinterface:!0,logical:!0};
var b=q.filter(a.model["interfaces-state"]["interface"],a.filterWANlogic),c=q.filter(a.ctx.ifs_overlay,{physical:!0,subinterface:!0}),d=function(a){var c=m("filter")(b,function(b,c,d){return b.name&&b.name.match("^"+a+"$")?!0:!1});if(c&&c[0])return c[0]},e=function(a,b){var c;if(a._ref&&a._ref[b]&&a._ref[b].connectType){c=a._ref[b].connectType;var e,g=a.name.replace(/^(WAN[0-9]+).*/,"$1"),k=a.name.replace(/^(WAN[0-9]+).*(\.[0-9]+$)/,"$2");"."!=k.charAt(0)&&(k="");switch(c){case "l2tp":e=g+"-L2TP"+
k;delete a[b];break;case "pptp":e=g+"-PPTP"+k;delete a[b];break;case "pppoe":e=g+"-PPPOE"+k;delete a[b];break;case "trasparent-bridge":e=g+"-BRIDGE"+k,delete a[b]}if(c=d(e))c&&c[b]&&(a[b]=angular.extend(c[b])),c&&c.ddns&&(a.ddns=angular.extend(c.ddns))}};angular.forEach(c,function(a,b){a.name.match(/^WAN/)&&(e(a,"ipv4"),e(a,"ipv6"))})};a.gridVPNStatus=app.uiGrid.generateGridOptions({minRowsToShow:6,columnDefs:[{field:"name",minWidth:200,displayName:a.DICT("System_Summary_Type")},{field:"active",minWidth:85,
displayName:a.DICT("System_Summary_Enabled")},{field:"configures",minWidth:100,displayName:a.DICT("System_Summary_Configured")},{field:"max_entity",minWidth:185,displayName:a.DICT("System_Summary_Max_Supported_Sessions")},{field:"connected_cnt",minWidth:200,displayName:a.DICT("System_Summary_Connected_Sessions")}]});a.showMultiWanState=function(b,c){var d="isNA",e=b["redundant-wan"]||{},g={offline:a.DICT("System_Summary_Offline"),disabled:a.DICT("System_Summary_Detection_Disabled"),online:a.DICT("System_Summary_Online")};
"ipv6"===c?e["ipv6-status"]&&g[e["ipv6-status"]]&&(d=e["ipv6-status"]):e["ipv4-status"]&&g[e["ipv4-status"]]&&(d=e["ipv4-status"]);return d};a.showDdnsState=function(b,c){var d="",e;b&&(b.ddns&&(b.ddns.status&&b.ddns.status.state)&&(e=b.ddns.status.state),"ipv6"===c&&!b._ref[c].enabled&&(e="disabled"));return d=void 0==e?a.DICT("System_Summary_Disabled"):"disabled"==e?a.DICT("System_Summary_Disabled"):e};a.OnOff=function(b){return a.schema.StatusMap[b]};a.get_usb_object=function(){var a=b.defer();
v.RPC_generic_send("usb-check-attached",void 0,function(b,c,d){d=d||{};a.resolve(d)},void 0,y);return a.promise};a.showPortSpeed=function(a){return"Connected"==a["link-status"]&&a["speed-status"]?a["speed-status"]+"Mbps":"--"};a.PortNoData=function(){return a.loadReady_port?"N/A":""};a.collect_port_list=function(b){b=parseInt(b,10);var c=[],d=[];a.loadReady&&a.loadReady_port?(c=a.model["interfaces-state"]["interface"],d=a.ctx.usbs):(c=a.model["fake-interfaces-state"]["interface"],d=a.model["fake-interfaces-state"]["interface"]);
var e=app.TOOLS.sortingInterfaceFn(!1),g=m("filter")(c,function(a,b,c){return a.name.match(/^LAN\d+$/)?!0:!1}),g=g.sort(e),c=m("filter")(c,function(a,b,c){return a.name.match(/^WAN_PORT\d+$/)?!0:!1}),c=c.sort(e),e=m("filter")(d,function(a,b,c){return a.name.match(/^USB\d+$/)?!0:!1}),k=g.concat(c).concat(e),d=[];if(0<=h.get_pid().search("RV345")){d=k.slice(10*b,10*(b+1));b=10-d.length;for(b=Math.max(0,b);0<b;b--)d.push(null);return d}return g.concat(c).concat(e)};a.showUSB=function(b){b=b||{};if(angular.isDefined(b.attached))b=
b["usbs-type"]||"";else return"";return 0<=b.search("3g")?"3G":0<=b.search("4g")?"4G":0<=b.search("mass-storage")?a.DICT("System_Summary_Storage"):0<=b.search("other")?a.DICT("System_Summary_Other"):"disconnect"};a.showIF=function(a){var b="";a=a||{};b=a["link-status"]||"";"NotConnected"==b?b="disconnect":"Connected"==b&&(b="connected");return b};a.collect_wan_list=function(b){var c=[];"interfaces-state"==b?c=a.ctx.ifs_overlay||[]:(a.filterWAN_WANsub={physical:!0,subinterface:!0,usb:!0},c=q.filter(a.model[b]["interface"],
a.filterWAN_WANsub));return c};a.collect_ifstate_list=function(b){var c=[],d;d=a.loadReady&&a.loadReady_port?"interfaces-state":"fake-interfaces-state";"ipv4"==b?(c=a.collect_wan_list(d),c=m("filter")(c,function(a,b,c){return a.name&&a.name.match(/^TUN\d+/)?!1:!0})):"ipv6"==b&&(c=a.collect_wan_list(d));return c};a.collect_firmware_state=function(b){var c=[];a.model&&(a.model["image-state"]&&a.model["image-state"].firmware&&a.model["image-state"].firmware.images&&a.model["image-state"].firmware.images.image)&&
(c=a.model["image-state"].firmware.images.image);return m("filter")(c,function(a,c,d){return a.active&&a.active.match(b)?!0:!1})};a.show_firmware_value=function(b,c){var d=a.collect_firmware_state(b),e;d&&(d[0]&&d[0][c])&&(e=d[0][c]);return e};a.isGotIp=function(a,b){if(a[b]&&a[b].address&&a[b].address[0]&&a[b].address[0].ip){var c=a[b].address[0].ip;if(!(""==c||"::"==c||"0.0.0.0"==c)&&a._ref&&a._ref[b]&&a._ref[b].enabled&&"dynamic"===a._ref[b].connectType)return!0}return!1};a.dhcp_renewed=function(a,
b){var c=a._ref;if(c&&c[b]&&c[b].connectType){switch(c[b].connectType){case "dynamic":return!0}return!1}};var S=function(b,c,d,e){return(c=m("filter")(a.ctx.usbs,function(a,c,d){return b&&a.name.match("^"+b.name+"$")&&a.attached&&("3g"==a["usbs-type"]||"4g"==a["usbs-type"])?!0:!1}))&&0<c.length?"connect"==d&&!e?!0:"disconnect"==d&&e?!0:!1:"noattach"};a.WAN_connected=function(a,b,c){var d=a._ref,e=!1;a[b]&&(a[b].address&&a[b].address[0]&&a[b].address[0].ip)&&(e=a[b].address[0].ip,e=""==e||"::"==e||
"0.0.0.0"==e?!1:!0);if(a.name.match(/^USB/))a=S(a,b,c,e);else a:if(!d||!d[b]||!d[b].connectType)a=void 0;else{switch(d[b].connectType){case "pppoe":case "l2tp":case "pptp":if("connect"==c&&!e){a=!0;break a}else if("disconnect"==c&&e){a=!0;break a}}a=!1}return a};a.RPC_connection=function(a,c,d){var e=b.defer();c={"interface":c.name,"ip-version":d.substr(2)};v.RPC_generic_send(a,c,function(a,b,c){a=c.code;switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");c=c||{};e.resolve(c);break;
default:console.log(b+": RPC done. got unknown code: "+a)}},void 0,A);return e.promise};a.do_dhcp_op=function(b,c,d){a.RPC_connection(d,b,c).then(function(a){B()})};a.do_conn_op=function(b,c,d){var e=a.RPC_connection(d,b,c);"disconnect"==d&&e.then(function(a){0==a.code&&(b[c]&&b[c].address&&b[c].address.splice(0),b[c].gateway="")});e.finally(function(){B()})};var T=function(a,b,c){return a.enable?!0:!1};a.getEnabledItems=function(a){return m("filter")(a,T)};a.getConnNumOf=function(b){if(!a.loadReady_p2)return"-";
var c=function(a,b,c){return"UP"===a.status.toUpperCase()?!0:!1};if(("pptp-state"==b||"l2tp-state"==b||"site-to-site-state"==b)&&a.model[b]&&a.model[b].connections&&a.model[b].connections.connection){var d=a.model[b].connections.connection;return"site-to-site-state"==b?m("filter")(d,c).length:d.length}if("sslvpn-state"==b&&a.model[b]&&a.model[b]["group-policies"]&&a.model[b]["group-policies"]["group-policy"]){var d=a.model[b]["group-policies"]["group-policy"],e=0;angular.forEach(d,function(a,b){0<
a.sessions&&(e+=a.sessions)});return e}if("client-to-site-state"==b&&a.model[b]&&a.model[b].connection){var d=a.model[b].connection,g=0;angular.forEach(d,function(a,b){0<a.tunnels&&(g+=a.tunnels)});return g}return 0};a.selected=a.selected||{};a.$on("$destroy",function(){J();void 0!==r&&clearTimeout(r);r=void 0;x=!0})}]);app.controller("system_summary_ipv4",["$scope",function(a){a.iptype="ipv4"}]);app.controller("system_summary_ipv6",["$scope",function(a){a.iptype="ipv6"}]);app.controller("routing_status_main",["$scope","$rootScope","$log","MyHttp","$http","ngGridCellBuilder","$templateCache","Sets",function(a,b,s,n,v,t,m,q){a.model=a.model||{};a.dataReady=!1;(function(){n.post({url:resource_base+"data/routing_status.json",method:"get_routing_state",success:function(b){angular.extend(a.model,b.data.result);a.model["routing-state"]||angular.extend(a.model,{"routing-state":{"routing-instance":[{name:"default",ribs:{rib:[{name:"local","address-family":"ipv4-unicast",routes:{route:[]}},
{name:"local6","address-family":"ipv6-unicast",routes:{route:[]}}]}}]}});a.schema=a.schema||{};a.schema.sourceEnum={"static":a.DICT("Routing_Status_Static"),direct:a.DICT("Routing_Status_Direct"),rip:a.DICT("Routing_Status_RIP")};a.model_orig=angular.copy(a.model);a.gridRoutes.Options1.data=a.model["routing-state"]["routing-instance"][0].ribs.rib[0].routes.route;a.gridRoutes.Options2.data=a.model["routing-state"]["routing-instance"][0].ribs.rib[1].routes.route;a.dataReady=!0},error:function(b){a.gridRoutes.Options1.data=
[];a.gridRoutes.Options2.data=[];console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}})})();a.doDiff=function(){a.diff4=q.getDiff(a.model_orig,a.model,{mode:a.mode});var b=a.diff4;a.setOnly=q.filterNonNull(b);a.delOnly=q.getDiff(a.setOnly,b,{mode:3})};a.doDiffTest=function(){a.diffTest()};a.diffTest=function(){a.doDiff()};a.gridRoutes=a.gridRoutes||{};a.gridRoutes.Options1=app.uiGrid.generateGridOptions({columnDefs:[{field:"v4ur:destination-prefix",displayName:a.DICT("Routing_Status_Destination")},
{field:"next-hop",displayName:a.DICT("Routing_Status_Next_Hop"),cellTemplate:m.get("UG_CellText_empty_filled_dash.html").replace(/MODEL_COL_FIELD/g,"MODEL_COL_FIELD['v4ur:next-hop-address']")},{field:"metric",displayName:a.DICT("Routing_Status_Metric"),cellTemplate:m.get("UG_CellText_empty_filled_dash.html")},{field:"next-hop",displayName:a.DICT("Routing_Status_Interface"),cellTemplate:m.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"MODEL_COL_FIELD['outgoing-interface']")},{field:"source-protocol",
displayName:a.DICT("Routing_Status_Source"),cellTemplate:m.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"grid.appScope.schema.sourceEnum[MODEL_COL_FIELD]")}]});a.gridRoutes.Options2=app.uiGrid.generateGridOptions({columnDefs:[{field:"v6ur:destination-prefix",displayName:a.DICT("Routing_Status_Destination")},{field:"next-hop",displayName:a.DICT("Routing_Status_Next_Hop"),cellTemplate:m.get("UG_CellText_empty_filled_dash.html").replace(/MODEL_COL_FIELD/g,"MODEL_COL_FIELD['v6ur:next-hop-address']")},
{field:"metric",displayName:a.DICT("Routing_Status_Metric"),cellTemplate:m.get("UG_CellText_empty_filled_dash.html")},{field:"next-hop",displayName:a.DICT("Routing_Status_Interface"),cellTemplate:m.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"MODEL_COL_FIELD['outgoing-interface']")},{field:"source-protocol",displayName:a.DICT("Routing_Status_Source"),cellTemplate:m.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"grid.appScope.schema.sourceEnum[MODEL_COL_FIELD]")}]})}]);app.controller("switch_qos_statistics_main",["$scope","$q","MyHttp","ngGridCellBuilder","$templateCache","Sets","$filter","wan_service",function(a,b,s,n,v,t,m,q){a.model=a.model||{};var e=0,w=0;(function(){var e=s.post({url:resource_base+"data/qos_switch_state.json",method:"get_qos_switch_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),h=s.post({url:resource_base+"data/qos_switch_classification.json",method:"get_qos_switch_classification",error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}});b.all([e,h]).then(function(b){for(var d=0;2>d;d++)angular.extend(a.model,b[d].data.result);a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.model.lastresettime="0 days, 0, and 0 minutes";a.loadReady=!0}).catch(function(a){console.log("=="+a)})})();a.model={lanList:[],lagList:[]};var l=function(){var b=a.model.interfaces["interface"];b&&angular.forEach(b,function(a,b){a.name.match(/^LAN\d+/)&&e++;a.name.match(/^LAG\d+/)&&w++})},h=function(){var b=
a.model["interfaces-state"]["interface"],h=[];b&&angular.forEach(b,function(a,b){a.name.match(/^LAN\d+/)&&(h[a.name]={stat:a["ciscosb-switch-qos"].queues.queue||void 0})});for(b=0;b<e;b++){var l=h["LAN"+(b+1)].stat,d=[];l&&angular.forEach(l,function(a,b){d["id"+a.id]={packets:a.packets,discards:a.discards}});a.model.lanList.push({port:b+1,queue1:{sent:void 0!==(d.id1&&d.id1.packets)?d.id1.packets:"0",drop:void 0!==(d.id1&&d.id1.discards)?d.id1.discards:"0"},queue2:{sent:void 0!==(d.id2&&d.id2.packets)?
d.id2.packets:"0",drop:void 0!==(d.id2&&d.id2.discards)?d.id2.discards:"0"},queue3:{sent:void 0!==(d.id3&&d.id3.packets)?d.id3.packets:"0",drop:void 0!==(d.id3&&d.id3.discards)?d.id3.discards:"0"},queue4:{sent:void 0!==(d.id4&&d.id4.packets)?d.id4.packets:"0",drop:void 0!==(d.id4&&d.id4.discards)?d.id4.discards:"0"}})}},p=function(){var b=a.model["interfaces-state"]["interface"],e=[];b&&angular.forEach(b,function(a,b){a.name.match(/^LAG\d+/)&&(e[a.name]={stat:a["ciscosb-switch-qos"].queues.queue||
void 0})});for(b=0;b<w;b++){var h=e["LAG"+(b+1)].stat,d=[];h&&angular.forEach(h,function(a,b){d["id"+a.id]={packets:a.packets,discards:a.discards}});a.model.lagList.push({group:b+1,queue1:{sent:void 0!==(d.id1&&d.id1.packets)?d.id1.packets:"0",drop:void 0!==(d.id1&&d.id1.discards)?d.id1.discards:"0"},queue2:{sent:void 0!==(d.id2&&d.id2.packets)?d.id2.packets:"0",drop:void 0!==(d.id2&&d.id2.discards)?d.id2.discards:"0"},queue3:{sent:void 0!==(d.id3&&d.id3.packets)?d.id3.packets:"0",drop:void 0!==(d.id3&&
d.id3.discards)?d.id3.discards:"0"},queue4:{sent:void 0!==(d.id4&&d.id4.packets)?d.id4.packets:"0",drop:void 0!==(d.id4&&d.id4.discards)?d.id4.discards:"0"}})}};a.show_stat=function(){a.model["interfaces-state"]&&a.model["interfaces-state"]["interface"]&&(l(),h(),p())}}]);app.controller("port_traffic_main",["$scope","$q","MyHttp","$timeout","modelInfo","userAccessRight","UserSession",function(a,b,s,n,v,t,m){0<=v.get_pid().search("RV340W")&&(a.rv340w_flag=1);a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var q=function(){b.all({state_traffic:function(){return s.post({url:resource_base+"data/port_traffic.json",method:"get_interface_traffic",error:function(a){console.log("port_traffic_main getData Error status: "+a.status)}})}(),
port_settings:function(){return s.post({url:resource_base+"data/lan_port_settings.json",method:"get_port_settings",error:function(a){console.log("port_traffic_main getData Error status: "+a.status)}})}()}).then(function(a){var b=a.state_traffic,c=w;b.data&&b.data.result?c(b.data.result):c();a=a.port_settings;b=e;a.data&&a.data.result?b(a.data.result):b()})},e=function(b){b||(b={});b.interfaces=b.interfaces||{};b.interfaces["interface"]=b.interfaces["interface"]||[];var c=function(a,b){a=a||[];angular.forEach(a,
function(a,c){b.name===a.id&&(a.description=b.description)})};angular.forEach(b.interfaces["interface"],function(b,d){c(a.model.portTraffic,b);c(a.model.portStatus,b)})},w=function(b){b||(b={});var c;a.model.portTraffic=[];a.model.wirelessTraffic=[];a.model.portStatus=[];var d=[],e=[],h=void 0!==b["interfaces-state"]&&void 0!==b["interfaces-state"]["interface"]?b["interfaces-state"]["interface"]:{};angular.forEach(h,function(b,g){var k=b.name||"";if(k.match(/^LAN\d+$/)||!("WAN_PORT1"!==k&&"WAN_PORT2"!==
k)){"WAN_PORT1"===k&&(k="WAN1");"WAN_PORT2"===k&&(k="WAN2");var h=l(b["link-status"]||""),p=b.statistics||{},r=0,m=0,n=0,u=0,q=0,r=parseInt(p["in-unicast-pkts"],10)||0,r=r+(parseInt(p["in-broadcast-pkts"],10)||0),r=r+(parseInt(p["in-multicast-pkts"],10)||0),m=p["in-octets"]||0,n=parseInt(p["out-unicast-pkts"],10)||0,n=n+(parseInt(p["out-broadcast-pkts"],10)||0),n=n+(parseInt(p["out-multicast-pkts"],10)||0),u=p["out-octets"]||0,q=p["in-errors"]||0,q=q+(p["out-errors"]||0);c=[{className:h?"icon-up":
"icon-down",displayName:h?a.DICT("Up"):a.DICT("Down")}];if(4<=k.length&&"LAN"===k.substr(0,3))d.push({id:k,status:c,rx_packets:r,rx_bytes:m,tx_packets:n,tx_bytes:u,packet_error:q});else if(4<=k.length&&"WAN"===k.substr(0,3))e.push({id:k,status:c,rx_packets:r,rx_bytes:m,tx_packets:n,tx_bytes:u,packet_error:q});else if(4==k.length&&"USB"===k.substr(0,3)){var x=h=0,s=0,h=void 0!==p["in-multicast-pkts"]?parseInt(p["in-multicast-pkts"],10):0,x=void 0!==p["in-discards"]?parseInt(p["in-discards"],10):0,
x=x+(void 0!==p["out-discards"]?parseInt(p["out-discards"],10):0),s=void 0!==p["in-collision-pkts"]?parseInt(p["in-collision-pkts"],10):0,s=s+(void 0!==p["out-collision-pkts"]?parseInt(p["out-collision-pkts"],10):0);a.model.wirelessTraffic.push({ssid:k,radio:"",status:c,rx_packets:r,rx_bytes:m,tx_packets:n,tx_bytes:u,mcast_packets:h,packet_error:q,packet_drop:x,collisions:s})}}});d=k(d,"LAN");e=k(e,"WAN");a.model.portTraffic=angular.copy(d.concat(e));d=[];e=[];h=void 0!==b["interfaces-state"]&&void 0!==
b["interfaces-state"]["interface"]?b["interfaces-state"]["interface"]:{};angular.forEach(h,function(b){var c=void 0!==b.name?b.name:"";if(c.match(/^LAN\d+$/)||"WAN_PORT1"===c||"WAN_PORT2"===c){"WAN_PORT1"===c&&(c="WAN1");"WAN_PORT2"===c&&(c="WAN2");var g=l(b["link-status"]||""),k=[{displayName:g?a.DICT("Up"):a.DICT("Down"),className:g?"icon-up":"icon-down"}],h;switch(void 0!==b["port-activity"]?b["port-activity"]:""){case "enable":h=a.DICT("Port_Traffic_Enabled");break;case "disable":h=a.DICT("Port_Traffic_Disabled");
break;default:h=""}var p;switch(void 0!==b["duplex-status"]?b["duplex-status"]:""){case "half":p=a.DICT("Port_Traffic_Half");break;case "full":p=a.DICT("Port_Traffic_Full");break;default:p=""}var r;switch(void 0!==b["auto-negotiated"]?b["auto-negotiated"]:""){case !0:r=a.DICT("Port_Traffic_Enabled");break;default:r=a.DICT("Port_Traffic_Disabled")}c.match(/^LAN\d+$/)?d.push({id:c,type:void 0!==b.type?b.type:"",status:k,activity:h,speed:void 0!==b["speed-status"]?"Not Connected"===g?"--":b["speed-status"]:
"",duplex:"Not Connected"===g?"--":p,auto_negoti:r}):e.push({id:c,type:void 0!==b.type?b.type:"",status:k,activity:h,speed:void 0!==b["speed-status"]?"Not Connected"===g?"--":b["speed-status"]:"",duplex:"Not Connected"===g?"--":p,auto_negoti:r})}});d=k(d,"LAN");e=k(e,"WAN");a.model.portStatus=angular.copy(d.concat(e));a.rv340w_flag&&u();a.gridPortTrafficItems.data=a.model.portTraffic;a.gridWirelessTrafficItems.data=a.model.wirelessTraffic;a.gridPortStatusItems.data=a.model.portStatus;a.dataReady=
!0},l=function(a){switch(a){case "Connected":a=!0;break;default:a=!1}return a},h=function(){s.post({url:resource_base+"data/wlan_ssid.json",method:"get_wifi_settings",success:function(a){p(a.data.result)},error:function(a){console.log("getData Error status: "+a.status)}})},p=function(b){b||(b={});b=(b.wlans||{}).ssid||[];var d=0,e=0,k=a.ssid_state,h=a.ssid_statistics;a.model.showWireless=[];angular.forEach(b,function(b){var g=c(b),l=0,p=0,r=0,m=0,n=0,u=0,q=0,x=0,s=0,t="",w=function(){g=c(b);s=x=q=
u=n=m=r=p=l=0},v=function(){h["VAP1_"+d]&&(l=parseInt(h["VAP1_"+d].in_unicast,10)||0,l+=parseInt(h["VAP1_"+d].in_broadcast,10)||0,l+=parseInt(h["VAP1_"+d].in_multicast,10)||0,r=parseInt(h["VAP1_"+d].out_unicast,10)||0,r+=parseInt(h["VAP1_"+d].out_broadcast,10)||0,r+=parseInt(h["VAP1_"+d].out_multicast,10)||0,p=parseInt(h["VAP1_"+d].in_octets,10)||0,m=parseInt(h["VAP1_"+d].out_octets,10)||0,n=parseInt(h["VAP1_"+d].in_multicast,10)||0,n+=parseInt(h["VAP1_"+d].out_multicast,10)||0,u=parseInt(h["VAP1_"+
d].in_errors,10)||0,u+=parseInt(h["VAP1_"+d].out_errors,10)||0,q=parseInt(h["VAP1_"+d].in_discards,10)||0,q+=parseInt(h["VAP1_"+d].out_discards,10)||0,x=parseInt(h["VAP1_"+d].in_collision,10)||0,x+=parseInt(h["VAP1_"+d].out_collision,10)||0,s=parseInt(k["VAP1_"+d].number,10)||0)},V=function(){h["VAP2_"+e]&&(l=parseInt(h["VAP2_"+e].in_unicast,10)||0,l+=parseInt(h["VAP2_"+e].in_broadcast,10)||0,l+=parseInt(h["VAP2_"+e].in_multicast,10)||0,r=parseInt(h["VAP2_"+e].out_unicast,10)||0,r+=parseInt(h["VAP2_"+
e].out_broadcast,10)||0,r+=parseInt(h["VAP2_"+e].out_multicast,10)||0,p=parseInt(h["VAP2_"+e].in_octets,10)||0,m=parseInt(h["VAP2_"+e].out_octets,10)||0,n=parseInt(h["VAP2_"+e].in_multicast,10)||0,n+=parseInt(h["VAP2_"+e].out_multicast,10)||0,u=parseInt(h["VAP2_"+e].in_errors,10)||0,u+=parseInt(h["VAP2_"+e].out_errors,10)||0,q=parseInt(h["VAP2_"+e].in_discards,10)||0,q+=parseInt(h["VAP2_"+e].out_discards,10)||0,x=parseInt(h["VAP2_"+e].in_collision,10)||0,x+=parseInt(h["VAP2_"+e].out_collision,10)||
0,s=parseInt(k["VAP2_"+e].number,10)||0)},R=function(){a.model.showWireless.push({ssid:b.ssid,vlan:b.vlan_id||1,radio:t,status:b.enable?a.DICT("Port_Traffic_Enabled"):a.DICT("Port_Traffic_Disabled"),rx_packets:l,rx_bytes:p,tx_packets:r,tx_bytes:m,mcast_packets:n,packet_error:u,packet_drop:q,collisions:x,no_client:s})};switch(g){case "2.4G":d++;t="2.4G";w();v();R();break;case "5G":e++;t="5G";w();V();R();break;case "Both":for(var K=0;2>K;K++)K?(e++,t="5G",w(),V()):(d++,t="2.4G",w(),v()),R();break;default:console.log("Error "+
g)}});a.gridWifiTrafficItems.data=a.model.showWireless},u=function(){s.post({url:resource_base+"data/ssid_state.json",method:"get_ssid_state",params:{filter:"BRIEF"},success:function(a){x(a.data.result);r()},error:function(a){console.log("getData Error status: "+a.status)}})},x=function(b){b||(b={});a.ssid_state={};b["interfaces-state"]&&b["interfaces-state"]["interface"]&&angular.forEach(b["interfaces-state"]["interface"],function(b,c){if(b&&b.name){var d=b.ssid||"";a.ssid_state[b.name]={number:void 0!==
d["associated-device-count"]?d["associated-device-count"]:""}}})},r=function(){s.post({url:resource_base+"data/port_traffic.json",method:"get_interface_statistics",params:{filter:"SSID"},success:function(a){d(a.data.result);h()},error:function(a){console.log("getData Error status: "+a.status)}})},d=function(b){b||(b={});a.ssid_statistics={};b["interfaces-state"]&&b["interfaces-state"]["interface"]&&angular.forEach(b["interfaces-state"]["interface"],function(b,c){if(b&&b.name){var d=b.statistics||
"";a.ssid_statistics[b.name]={in_octets:void 0!==d["in-octets"]?d["in-octets"]:"",in_unicast:void 0!==d["in-unicast-pkts"]?d["in-unicast-pkts"]:"",in_broadcast:void 0!==d["in-broadcast-pkts"]?d["in-broadcast-pkts"]:"",in_multicast:void 0!==d["in-multicast-pkts"]?d["in-multicast-pkts"]:"",in_discards:void 0!==d["in-discards"]?d["in-discards"]:"",in_errors:void 0!==d["in-errors"]?d["in-errors"]:"",out_octets:void 0!==d["out-octets"]?d["out-octets"]:"",out_unicast:void 0!==d["out-unicast-pkts"]?d["out-unicast-pkts"]:
"",out_broadcast:void 0!==d["out-broadcast-pkts"]?d["out-broadcast-pkts"]:"",out_multicast:void 0!==d["out-multicast-pkts"]?d["out-multicast-pkts"]:"",out_discards:void 0!==d["out-discards"]?d["out-discards"]:"",out_errors:void 0!==d["out-errors"]?d["out-errors"]:"",in_collision:void 0!==d["in-collision-pkts"]?d["in-collision-pkts"]:"",out_collision:void 0!==d["out-collision-pkts"]?d["out-collision-pkts"]:""}}})},c=function(a){return"WLAN1"===a.radio?"2.4G":"WLAN2"===a.radio?"5G":"BOTH"===a.radio?
"Both":"None"},k=function(a,b){1<a.length&&(a=a.sort(function(a,c){var d="",e="",d=0<=a.id.search(b)?a.id.replace(b,""):"0",e=0<=c.id.search(b)?c.id.replace(b,""):"0",d=parseInt(d,10),e=parseInt(e,10);return d>e?1:-1}));return a};a.gridPortTrafficItems=app.uiGrid.generateGridOptions({columnDefs:[{field:"id",displayName:a.DICT("Port_Traffic_Port_ID")},{field:"description",displayName:a.DICT("Port_Traffic_Port_Label")},{field:"status",displayName:a.DICT("Port_Traffic_Link_Status"),cellTemplate:"UG_table_icons.html"},
{field:"rx_packets",displayName:a.DICT("Port_Traffic_Rx_Packets")},{field:"rx_bytes",displayName:a.DICT("Port_Traffic_Rx_Bytes")},{field:"tx_packets",displayName:a.DICT("Port_Traffic_Tx_Packets")},{field:"tx_bytes",displayName:a.DICT("Port_Traffic_Tx_Bytes")},{field:"packet_error",displayName:a.DICT("Port_Traffic_Packet_Error")}]});a.gridWirelessTrafficItems=app.uiGrid.generateGridOptions({columnDefs:[{field:"ssid",displayName:a.DICT("Port_Traffic_SSID_Name"),sort:{direction:"asc"}},{field:"status",
displayName:a.DICT("Port_Traffic_Status"),cellTemplate:"UG_table_icons.html"},{field:"rx_packets",displayName:a.DICT("Port_Traffic_Rx_Packets")},{field:"rx_bytes",displayName:a.DICT("Port_Traffic_Rx_Bytes")},{field:"tx_packets",displayName:a.DICT("Port_Traffic_Tx_Packets")},{field:"tx_bytes",displayName:a.DICT("Port_Traffic_Tx_Bytes")},{field:"mcast_packets",displayName:a.DICT("Port_Traffic_Multicast_Packets")},{field:"packet_error",displayName:a.DICT("Port_Traffic_Packet_Error")},{field:"packet_drop",
displayName:a.DICT("Port_Traffic_Packet_Dropped")},{field:"collisions",displayName:a.DICT("Port_Traffic_Collisions")}]});a.gridPortStatusItems=app.uiGrid.generateGridOptions({columnDefs:[{field:"id",displayName:a.DICT("Port_Traffic_Port_ID")},{field:"description",displayName:a.DICT("Port_Traffic_Port_Label")},{field:"status",displayName:a.DICT("Port_Traffic_Link_Status"),cellTemplate:"UG_table_icons.html"},{field:"activity",displayName:a.DICT("Port_Traffic_Port_Activity")},{field:"speed",displayName:a.DICT("Port_Traffic_Speed_Status")},
{field:"duplex",displayName:a.DICT("Port_Traffic_Duplex_Status")},{field:"auto_negoti",displayName:a.DICT("Port_Traffic_Auto_Negotiation")}]});a.gridWifiTrafficItems=app.uiGrid.generateGridOptions({columnDefs:[{field:"ssid",displayName:a.DICT("Port_Traffic_SSID_Name")},{field:"vlan",displayName:a.DICT("Port_Traffic_VLAN")},{field:"radio",displayName:a.DICT("Port_Traffic_Radio_Name")},{field:"status",displayName:a.DICT("Port_Traffic_Status")},{field:"rx_packets",displayName:a.DICT("Port_Traffic_Rx_Packets")},
{field:"rx_bytes",displayName:a.DICT("Port_Traffic_Rx_Bytes")},{field:"tx_packets",displayName:a.DICT("Port_Traffic_Tx_Packets")},{field:"tx_bytes",displayName:a.DICT("Port_Traffic_Tx_Bytes")},{field:"mcast_packets",displayName:a.DICT("Port_Traffic_Multicast_Packets")},{field:"packet_error",displayName:a.DICT("Port_Traffic_Packet_Error")},{field:"packet_drop",displayName:a.DICT("Port_Traffic_Packet_Dropped")},{field:"collisions",displayName:a.DICT("Port_Traffic_Collisions")},{field:"no_client",displayName:a.DICT("Port_Traffic_No_Clients")}]});
a.model={portTraffic:[],wirelessTraffic:[],portStatus:[],showWireless:[]};a.funs={refresh:function(){q()},reset:function(){s.post({method:"action",params:{rpc:"reset-counters"},success:function(a){q()},error:function(a){q()}})},freezeButton:function(b){a.ctx.btnDisabled=!0;n(function(){a.ctx.btnDisabled=!1},1E3*b)},wifiRefresh:function(){u()},wifiReset:function(){s.post({method:"action",params:{rpc:"reset-wifi-counters"},success:function(a){u()},error:function(a){u()}})}};a.ctx=a.ctx||{};a.dataReady=
!1;q()}]);app.controller("app_statistics_main",["$scope","MyHttp","userAccessRight","UserSession","$q","dt",function(a,b,s,n,v,t){var m=app.TOOLS.int2str2,q=app.TOOLS.str2int,e=app.TOOLS.getVal,w=app.TOOLS.getResponse,l=app.TOOLS.MBpkt2String,h=app.TOOLS.cpuPercentageNum,p=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.userAccessFlag=s.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var u=function(a){return b.post({method:"get_interface_statistics",procBackground:a,isPolling:a,params:{filter:"WAN"},
url:resource_base+"data/port_traffic.json",error:function(a){}})},x=function(b,c){var e=[],g,k,h,l,p,r,m,n,u,z,x,y,A,s,t,B,w,v,E=new Date,C,D=[],ca,Z=function(a){return!_.isNumber(a)||0>a?0:a};b&&(b["interfaces-state"]&&b["interfaces-state"]["interface"])&&(e=b["interfaces-state"]["interface"]);d();s=a.model.tf_last_idx;E=E.getTime();a.ui_data.def_interface="";angular.forEach(e,function(b){if(b.name.match(/^WAN_PORT\d+$/)||b.name.match(/^USB\d+$/)){x=b.statistics||{};A="WAN_PORT1"===b.name?a.ui_data.def_interface=
"WAN1":"WAN_PORT2"===b.name?"WAN2":b.name;if(void 0===a.model.traffic_data[A]){if(a.model.interfaces.push({id:A,displayName:A}),a.model.traffic_data[A]={chart_data:[[],[]],orig_data:[[],[],[]]},v=a.model.traffic_data[A],void 0!==s)for(w=0;w<=s;w++)v.chart_data[0].push(0),v.chart_data[1].push(0),v.orig_data[0].push(0),v.orig_data[1].push(0),v.orig_data[2].push(E)}else v=a.model.traffic_data[A];g=q(x["out-octets"]);k=q(x["in-octets"]);y=local_database?Math.floor(104857600*Math.random()+1):0;g+=y;y=
local_database?Math.floor(104857600*Math.random()+1):0;k+=y;r=[];p=[];D=[];n=[];m=[];if(0<=s){l=v.orig_data[0][s];h=v.orig_data[1][s];C=v.orig_data[2][s];u=v.chart_data[0][s];z=v.chart_data[1][s];ca=(E-C)/1E3;B=Math.floor(!_.isNumber(8*(k-l)/ca)?0:Math.floor(8*(k-l)/ca/1048576));t=Math.floor(8*(!_.isNumber(g-h)?0:Math.floor((g-h)/1048576))/ca);"WAN1"===A&&(Log(DEBUG,"================="+A),Log(DEBUG,"tf_last_idx:"+s),Log(DEBUG,a.model.traffic_data.WAN1),Log(DEBUG,"last_i_val: "+l+", last_o_val: "+
h),Log(DEBUG,"i_val: "+k+", o_val: "+g),Log(DEBUG,"i_change: "+B+", o_change: "+t),Log(DEBUG,"last_i_change: "+u+", last_o_change: "+z));switch(c){case 30:y=Math.floor((t-z)/2);p.push(Z(z+y));m.push(Math.floor((h+g)/2));y=Math.floor((B-u)/2);r.push(u+y);D.push(0);n.push(Math.floor((l+k)/2));break;case 60:y=Math.floor((t-z)/4),p.push(Z(z+y)),p.push(Z(z+2*y)),p.push(Z(z+3*y)),Log(DEBUG,"o_offset: "+y),m.push(Math.floor(1*(h+g)/4)),m.push(Math.floor(2*(h+g)/4)),m.push(Math.floor(3*(h+g)/4)),Log(DEBUG,
"orig_o_offset: "+y),y=Math.floor((B-u)/4),r.push(Z(u+y)),r.push(Z(u+2*y)),r.push(Z(u+3*y)),Log(DEBUG,"i_offset: "+y),n.push(Math.floor(1*(l+k)/4)),n.push(Math.floor(2*(l+k)/4)),n.push(Math.floor(3*(l+k)/4)),Log(DEBUG,"orig_i_offset: "+y),D=D.concat([0,0,0])}p.push(Z(t));r.push(Z(B))}else p.push(0),r.push(0);D.push(E);m.push(g);n.push(k);"WAN1"===A&&(Log(DEBUG,"o_d: "+JSON.stringify(p)),Log(DEBUG,"i_d: "+JSON.stringify(r)),Log(DEBUG,"o_orig: "+JSON.stringify(m)),Log(DEBUG,"i_orig: "+JSON.stringify(n)));
v.chart_data[0]=v.chart_data[0].concat(r);v.chart_data[1]=v.chart_data[1].concat(p);v.orig_data[0]=v.orig_data[0].concat(n);v.orig_data[1]=v.orig_data[1].concat(m);v.orig_data[2]=v.orig_data[2].concat(D)}});switch(c){case 30:a.model.tf_last_idx+=2;break;case 60:a.model.tf_last_idx+=4;break;default:a.model.tf_last_idx+=1}a.model.interfaces.sort(function(a,b){var c=a.id.match(/^(WAN|USB)(\d+)$/),d=b.id.match(/^(WAN|USB)(\d+)$/);return!c||!d?0:"USB"===c[1]&&"WAN"===d[1]?1:"WAN"===c[1]&&"USB"===d[1]?
-1:q(c[2])-q(d[2])});a.ui_data.def_interface||(a.ui_data.def_interface=a.model.interfaces[0]&&a.model.interfaces[0].id||"")},r=function(){return b.post({method:"get_time",url:resource_base+"data/time.json",error:function(){}})},d=function(){var b,c,d,e=a.model.tf_last_datetime;b=a.model.tf_last_idx;if(void 0!==b&&!(120>b+4)){Log(DEBUG,"del_len: 4, _tf_last_idx: "+b);a.model.traffic_labels.splice(0,4);a.model.tf_last_idx=b-4;angular.forEach(a.model.traffic_data,function(a){a.orig_data[0].splice(0,
4);a.orig_data[1].splice(0,4);a.orig_data[2].splice(0,4);a.chart_data[0].splice(0,4);a.chart_data[1].splice(0,4)});d=120-a.model.traffic_labels.length;c=e.getTime()+15E3;e=new Date(c);for(b=0;b<d;b++)c=e.getTime()+15E3*b,c=new Date(c),0===b%4?a.model.traffic_labels.push(m(c.getHours())+":"+m(c.getMinutes())):a.model.traffic_labels.push("");a.model.tf_last_datetime=c}},c=function(a){return b.post({url:resource_base+"data/avc_state_applications.json",method:"get_avc_state",procBackground:a,isPolling:a,
error:function(){}})},k=function(b){b=b&&b["avc-state"]&&b["avc-state"]||{};var c=b.applications||[],d,g,k,p,r=0,m,n,u,z,y,x,A,s;a.model.applications=[];a.model.application_reset_time_str=t.genTimeStrByTimeStamp(b["last-reset-time"],"N/A");angular.forEach(c,function(b){d={application:b.application||"-",protocol:b.protocol||"-",port:b.port||"N/A",flows:b.flows||"-",clients:[],in_pkts:0,out_pkts:0,in_pkt_str:"",out_pkt_str:"",usage_pkts:0,usage_str:0,usage_per:0,usage_per_num:0,usage_per_str:0,client_cnt:0};
u=n=0;A=b.clients||[];angular.forEach(A,function(a){s={edit:!0,mac:a.mac||"",in_pkts:q(e(a["in-pkts"],"0")),out_pkts:q(e(a["out-pkts"],"0")),in_pkt_str:"",out_pkt_str:"",usage_pkts:0,usage_str:"",usage_per:0,usage_per_num:0,usage_per_str:"",ip_address:"-",hostname:"-",device_type:"-",os_type:"-",status:"-",ip_group:"@none",orig_ip_group:"@none",ip_groups:[]};s.in_pkt_str=l(s.in_pkts);s.out_pkt_str=l(s.out_pkts);s.usage_pkts=s.in_pkts+s.out_pkts;s.usage_str=l(s.usage_pkts);n+=s.in_pkts;u+=s.out_pkts;
d.clients.push(s)});d.in_pkts=n;d.in_pkt_str=l(d.in_pkts);d.out_pkts=u;d.out_pkt_str=l(d.out_pkts);d.usage_pkts=d.in_pkts+d.out_pkts;d.usage_str=l(d.usage_pkts);d.client_cnt=d.clients.length;x=y=z=0;m=d.usage_pkts;angular.forEach(d.clients,function(a){0===m?(a.usage_per_num=0,a.usage_per=0,a.usage_per_str="0%"):(a.usage_per_num=h(a.usage_pkts,m,1),a.usage_per=Math.floor(a.usage_per_num),z+=a.usage_per,x+=1,0===a.usage_per&&0!==a.usage_pkts?(y+=1,a.usage_per_str="<1%"):a.usage_per_str=a.usage_per+
"%")});d.clients.sort(function(a,b){return b.usage_per-a.usage_per});if(100!==z&&0!==m)if(1===y&&2===x)angular.forEach(d.clients,function(a){0!==a.usage_pkts&&0!==a.usage_per&&(a.usage_per_str=">99%")});else{p=d.clients;g=100-z;0<y&&(g-=1);for(k=0;k<p.length&&g;k++)0<g&&p[k].usage_pkts&&(p[k].usage_per+=1,p[k].usage_per_str=p[k].usage_per+"%",g-=1)}r+=d.usage_pkts;a.model.applications.push(d)});x=y=z=0;angular.forEach(a.model.applications,function(a){0===r?(a.usage_per_num=0,a.usage_per=0,a.usage_per_str=
"0%"):(a.usage_per_num=h(a.usage_pkts,r,1),a.usage_per=Math.floor(a.usage_per_num),x+=1,z+=a.usage_per,0===a.usage_per&&0!==a.usage_pkts?(y+=1,a.usage_per_str="<1%"):a.usage_per_str=a.usage_per+"%")});if(100!==z&&0!==r)if(1===y&&2===x)angular.forEach(a.model.applications,function(a){0!==a.usage_pkts&&0!==a.usage_per&&(a.usage_per_str=">99%")});else{a.model.applications.sort(function(a,b){return b.usage_per-a.usage_per});p=a.model.applications;g=100-z;0<y&&(g-=1);for(k=0;k<p.length&&g;k++)0<g&&p[k].usage_pkts&&
(p[k].usage_per+=1,p[k].usage_per_str=p[k].usage_per+"%",g-=1)}a.model.applications.sort(function(a,b){return a.application<b.application?-1:1})};procClient=function(b){b=(b&&b["avc-state"]&&b["avc-state"]||{}).clients||[];var c;a.model.client_map={};angular.forEach(b,function(b){c={mac:b.mac||"",ipv4_address:b["ipv4-address"]||"",ipv6_address:b["ipv6-address"]||"",hostname:b.hostname||"",device_type:b["device-type"]||"",os_type:b["os-type"]||"",status:b.status||"",ip_group:b["ip-group"]||"@none",
orig_ip_group:""};c.orig_ip_group=c.ip_group;a.model.client_map[c.mac]=c})};var g=function(){var b;angular.forEach(a.model.applications,function(c){angular.forEach(c.clients,function(c){if(b=a.model.client_map[c.mac])c.ip_address=b.ipv4_address||b.ipv6_address||"-",c.hostname=b.hostname,c.device_type=b.device_type,c.os_type=b.os_type,c.status=b.status,c.ip_group=b.ip_group,c.orig_ip_group=b.orig_ip_group})})},z=function(){return b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup",
error:function(a){Log(ERROR,"appControllerCtrl getIpGroupData error : "+a.status);y()}})},y=function(b){var c=[],d;b&&(b["ip-groups"]&&b["ip-groups"]["ip-group"])&&(c=b["ip-groups"]["ip-group"]);a.model.ip_groups=[];a.model.mac2ipgroup={};a.model.ip_groups.push({id:"@none",displayName:a.DICT("Application_Statistics_None")});angular.forEach(c,function(b){d={id:b.name||"",displayName:b.name||"",macs:b.macs||[]};angular.forEach(d.macs,function(c){a.model.mac2ipgroup[c.mac]=b.name});a.model.ip_groups.push(d)})},
A=function(){C();v.all([r(),u(!1),c(!1),z()]).then(function(b){D();var c=w(b,0),d,h,l;c&&(c["system-state"]&&c["system-state"].clock&&c["system-state"].clock["current-datetime"])&&(d=c["system-state"].clock["current-datetime"],c=t.parser(d),0===c.err_code&&(h=t.timeStr(c),d=c.date));d||(c=t.new_date(),h=t.timeStr(c),d=c.date);a.model.tf_datetime=d;a.model.tf_datetime_str=h;for(h=0;120>h;h++)l=d.getTime()+15E3*h,l=new Date(l),0===h%4?a.model.traffic_labels[h]=m(l.getHours())+":"+m(l.getMinutes()):
a.model.traffic_labels.push("");a.model.tf_last_datetime=l;x(w(b,1),a.ui_data.update_timer);k(w(b,2));procClient(w(b,2));y(w(b,3));(b=w(b,2))||(b={});b=e(b.status,0);a.ui_data.no_license=0===b;g();a.ui_data.no_license?a.model.application_reset_time_str="N/A":(B(),a.gridApplicationOptions.data=a.model.applications);a.ui_data.sel_interface=a.ui_data.def_interface;a.ui_data.data_ready=!0;a.resetModified()},function(a){Log(ERROR,"[app_statistics_main] init() "+JSON.stringify(a));A()})},B=function(){var b=
a.ui_data.update_timer;void 0===a.ui_data.polling_timeId&&(a.ui_data.polling_timeId=setTimeout(function(){v.all([u(!0)]).then(function(c){a.ui_data.polling_timeId=void 0;x(w(c,0),b);p||B()},function(a){Log(ERROR,"[app_statistics_main] startPolling() "+JSON.stringify(a));B()})},1E3*a.ui_data.update_timer))},C=function(){void 0!==a.ui_data.polling_timeId&&(clearTimeout(a.ui_data.polling_timeId),a.ui_data.polling_timeId=void 0)};a.ui_data={no_license:!0,data_ready:!1,update_timer:15,def_interface:"",
sel_interface:"",polling_timeId:void 0,page:"main",combineNote:a.DICT("Application_Statistics_Note",{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Here")+"</u></a>"})};a.schema={update_timers:[{id:15,displayName:a.DICT("Application_Statistics_15s")},{id:30,displayName:a.DICT("Application_Statistics_30s")},{id:60,displayName:a.DICT("Application_Statistics_60s")}]};var D=function(){var b="N/A";a.model.application_reset_time_str&&(b=a.model.application_reset_time_str);a.model=
{interfaces:[],tf_datetime:"",tf_datetime_str:"",tf_last_datetime:void 0,tf_last_idx:-1,traffic_data:{},traffic_series:["Download","Upload"],traffic_labels:[],traffic_override:[{hidden:!1,id:"Download",label:"Download",pointHoverRadius:1,pointRadius:1},{hidden:!1,id:"Upload",label:"Upload",pointHoverRadius:1,pointRadius:1}],traffic_options:{animation:!1,maintainAspectRatio:!1,borderColor:["rgba(255, 0, 0, 1)","rgba(0, 255, 0, 1)","rgba(0, 0, 255, 1)","rgba(255, 255, 0, 1)"],scales:{yAxes:[{min:0,
maxTicksLimit:1E3,gridLines:{display:!0},ticks:{callback:function(a,b,c){return Math.floor(a)+" Mbps"},beginAtZero:!0,suggestedMin:0,suggestedMax:100}}],xAxes:[{gridLines:{display:!0}}]}},ip_groups:[],mac2ipgroup:{},applications:[],client_map:{},client_app_name:"",clients:[],application_reset_time_str:b}};a.model={};a.change_interface=function(){};var E=function(){angular.forEach(a.model.clients,function(b){b.ip_group||(b.ip_group="@none");b.ip_groups=a.model.ip_groups})};s=function(a){return function(b,
c,d,e,g){return d.entity[a]===e.entity[a]?0:d.entity[a]>e.entity[a]?1:-1}};a.gridApplicationOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"application",displayName:a.DICT("Application_Statistics_Application"),click:function(b,c,d,e){a.model.clients=c.entity.clients||[];a.model.client_app_name=b;E();a.gridClientOptions.data=a.model.clients;a.ui_data.page="sub"},cellTemplate:"UG_table_text_with_inline_href_click.html"},{field:"protocol",displayName:a.DICT("Application_Statistics_Protocol")},
{field:"port",displayName:a.DICT("Application_Statistics_Port"),sortingAlgorithm:s("port")},{field:"usage_per_str",displayName:a.DICT("Application_Statistics_Usage_Percentage"),sortingAlgorithm:s("usage_pkts")},{field:"usage_str",displayName:a.DICT("Application_Statistics_Usage"),sortingAlgorithm:s("usage_pkts")},{field:"out_pkt_str",displayName:a.DICT("Application_Statistics_Sent"),sortingAlgorithm:s("out_pkts")},{field:"in_pkt_str",displayName:a.DICT("Application_Statistics_Received"),sortingAlgorithm:s("in_pkts")},
{field:"client_cnt",displayName:a.DICT("Application_Statistics_Client_Counter")}]});a.gridClientOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"ip_address",displayName:a.DICT("Application_Statistics_IP_Address")},{field:"hostname",displayName:a.DICT("Application_Statistics_Hostname")},{field:"device_type",displayName:a.DICT("Application_Statistics_Device_Type")},{field:"os_type",displayName:a.DICT("Application_Statistics_OS_Type")},{field:"usage_per_str",displayName:a.DICT("Application_Statistics_Usage_Percentage"),
sortingAlgorithm:s("usage_pkts")},{field:"ip_group",displayName:a.DICT("Application_Statistics_IP_Group"),editRow:"edit",listField:"ip_groups",cellTemplate:"UG_table_select1_with_inline_edit.html"}]});a.funs={back:function(){a.ui_data.page="main"},cancel:function(){a.ui_data.data_ready=!1;a.ui_data.page="main";A()},save:function(){var c={},d=[],e,g;angular.forEach(a.model.clients,function(b){if(b.ip_group!==b.orig_ip_group){"@none"!==b.ip_group&&!c[b.ip_group]&&angular.forEach(a.model.ip_groups,function(a){a.id===
b.ip_group&&(c[b.ip_group]={name:a.id,macs:a.macs})});"@none"!==b.orig_ip_group&&!c[b.orig_ip_group]&&angular.forEach(a.model.ip_groups,function(a){a.id===b.orig_ip_group&&(c[b.orig_ip_group]={name:a.id,macs:a.macs})});if("@none"!==b.orig_ip_group){g=c[b.orig_ip_group].macs;for(e=g.length-1;0<=e;e--)g[e].mac===b.mac&&g.splice(e,1)}"@none"!==b.ip_group&&c[b.ip_group].macs.push({mac:b.mac})}});angular.forEach(c,function(a){d.push(a)});d.length?b.post({forcedUsingPost:!0,method:"set_ipgroup",params:{"ip-groups":{"ip-group":d}},
success:function(){a.ui_data.data_ready=!1;a.ui_data.page="main";A()},error:function(){a.ui_data.data_ready=!1;a.ui_data.page="main";A()}}):(a.ui_data.data_ready=!1,a.ui_data.page="main",A())},reset_state:function(){app.TOOLS.warningAlertBox({msg:a.DICT("Application_Statistics_Reset_Note"),cbk:function(a){a&&b.post({method:"action",params:{rpc:"reset-avc-state"},success:function(){A()},error:function(){A()}})}})},refresh:function(){v.all([c()]).then(function(b){k(w(b,0));procClient(w(b,0));g();a.gridApplicationOptions.data=
a.model.applications})}};a.$on("$destroy",function(){C();p=!0});A()}]);app.controller("stat_mobile_network_main",["$scope","MyHttp","$q","userAccessRight","UserSession",function(a,b,s,n,v){a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var t=function(a){return"number"!==$.type(a)?"":10>a?"0"+a:a.toString()},m=function(){return b.post({method:"get_mobile_state",url:resource_base+"data/wan_setting_state.json",error:function(a){q();console.log("getMobileStatus Error status: "+a.status)}})},q=function(b){b||(b={});var e=function(a){var b;
b=parseFloat(a);if(isNaN(b))return"";b=Math.round(100*a)/100;a=b.toString();b=a.indexOf(".");0>b&&(b=a.length,a+=".");for(;a.length<=b+2;)a+="0";return a},l=function(a){return"number"!==$.type(a)?"":1>=a?a+" Byte":1024>a?a+" Bytes":1048576>a?e(a/1024)+" KB":1073741824>a?e(a/1048576)+" MB":e(a/1073741824)+" GB"};b=b["interfaces-state"]&&b["interfaces-state"]["interface"]||[];var m={},r,d,c,k,g,n,q,A,s,w,v;a.model.usbs=[];a.model.usb_list=[];angular.forEach(b,function(b){b.name&&b.name.match(/^USB\d+$/)&&
(r=b.ipv4||{},c=r.address&&r.address[0]||{},d=b["mobile-connection"]||{},q=k="-",c&&(c.netmask?k=c.netmask:c["prefix-length"]&&(k=app.TOOLS.netmask.int2Inet(parseInt(c["prefix-length"],10)))),void 0!==d["connection-time"]&&(n=d["connection-time"],q=t(n%60),n=(n-n%60)/60,q=t(n%60)+":"+q,n=(n-n%60)/60,q=t(n%24)+":"+q,n-=n%24,0<n&&(q=n/24+" days, "+q)),w=0,d["session-usage-tx-bytes"]?(g=parseInt(d["session-usage-tx-bytes"],10)||0,w+=g,A="Tx="+l(g)+", "):A="Tx=0 bytes, ",d["session-usage-rx-bytes"]?(g=
parseInt(d["session-usage-rx-bytes"],10)||0,w+=g,A=A+"Rx="+l(g)):A+="Rx=0 byte",v=0,d["monthly-usage-tx-bytes"]?(g=parseInt(d["monthly-usage-tx-bytes"],10)||0,v+=g,s="Tx="+l(g)+", "):s="Tx: 0 bytes, ",d["monthly-usage-rx-bytes"]?(g=parseInt(d["monthly-usage-rx-bytes"],10)||0,v+=g,s=s+"Rx="+l(g)):s+="Rx=0 byte",A=a.DICT("Mobile_Network_Usage_Str",{"%s0":l(w),"%s1":A}),s=a.DICT("Mobile_Network_Usage_Str",{"%s0":l(v),"%s1":s}),m={name:b.name,v4_ip:c.ip||"-",v4_netmask:k,has_ipv4:c.ip?!0:!1,gateway:r.gateway||
"-",device_name:d["device-name"]||"",connection_time:q,service_name:d.service_name||"-",session_usage:A,monthly_usage:s,service_type:"-",manufacture:"-",firmware_version:"-",sim_status:"-",imsi:"-",carrier:"-",signal_strength:0,card_status:!1},a.model.usb_list.push({name:m.name,id:a.model.usbs.length}),a.model.usbs.push(m))})},e=function(){return b.post({url:resource_base+"data/usb_modem_state.json",method:"get_usb_modem_state",error:function(a){console.log("getUsbModemsStatus error "+a.status)}})},
w=function(b){b||(b={});var e,l;angular.forEach(b["usb-modems-state"]&&b["usb-modems-state"]["usb-modem"]||[],function(b,h){angular.forEach(a.model.usbs,function(a){switch(b["device-name"]){case "/dev/modem1":l="USB1";break;case "/dev/modem2":l="USB2";break;default:return}a.name===l&&(e="",angular.forEach(b["network-mode"],function(a){Log(DEBUG,""===e);e=e?e+", "+a:a}),b["network-mode"]&&2<b["network-mode"].length&&(e="[ "+e+" ]"),angular.extend(a,{service_type:e||"-",manufacture:b.manufacture||"-",
firmware_version:b["firmware-version"]||"-",sim_status:b["sim-status"]||"-",imsi:b.imsi||"-",carrier:b.carrier||"-",signal_strength:b["signal-strength"]||0,card_status:a.has_ipv4?!0:!1}))})})},l=function(b){var l=-1;s.all([m(),e()]).then(function(e){q(e&&e[0]&&e[0].data&&e[0].data.result||{});w(e&&e[1]&&e[1].data&&e[1].data.result||{});a.model.usb_list.length&&(angular.forEach(a.model.usbs,function(a,b){-1===l&&"-"!==a.service_type&&(l=b)}),b||(a.model.sel=-1!==l?l:0),a.change_usb());a.dataReady=
!0})};a.model={usbs:[],usb_list:[],sel:0};a.d={};a.funs={clear:function(){b.post({method:"action",params:{rpc:"reset-mobile-statistics",input:{"interface-name":a.d.name}},success:function(a){l()},error:function(a){l()}})},update:function(){l(!0)}};a.change_usb=function(){a.d=a.model.usbs[a.model.sel]};a.dataReady=!1;l()}]);app.controller("view_logs_main",["$scope","$q","$uibModal","MyHttp","$filter","usb_lib","modelInfo","userAccessRight","UserSession","dt",function(a,b,s,n,v,t,m,q,e,w){var l=app.TOOLS.getResponse;a.ctx={facility_cnt:0,severity_cnt:0,all_facility:!1,all_severity:!1,facility:{kern:!1,system:!1,firewall:!1,network:!1,vpn:!1,"ssl-vpn":!1,license:!1,"web-filter":!1,"application-control":!1,user:!1,mobile:!1,wireless:!1,pnp:!1,"anti-virus":!1,ips:!1},severity:{emergency:!1,alert:!1,critical:!1,error:!1,
warning:!1,notice:!1,info:!1,debug:!1},keyword:""};a.model={totalPages:0,totalItems:0,currPage:1,logs:[],downloaded_page:[]};a.pagingOptions={pages:[50,100,150],pageSize:50,total:0,changePageIdxCbk:{pre:void 0,post:function(b,d){a.model.currPage=b;a.grid_seak(d)}},changePageSizeCbk:function(b,e){a.pagingOptions.pageSize=b;a.init_query_logs();a.pagingOptions.goTo(1);a.gridApi.grid.options.paginationPageSize=a.pagingOptions.pageSize;d()}};a.jumpToPage=app.TOOLS.jumpToPage;a.query_once=!1;a.usbs_avaiable=
void 0;a.rv340w_flag=!1;a.grayout=!1;a.userAccessFlag=q.get();a.ruFlag=q.russia();a.dataReady=!1;a.warning_msg=a.DICT("View_Logs_Msg1",{"%s":"<a ng-click=\"jumpToPage('System_Config_Log')\">"+a.DICT("View_Logs_Here")+"</a>"});a.note_msg=a.DICT("View_Logs_Configure_Log_Settings",{"%s":"<a ng-click=\"jumpToPage('System_Config_Log')\">"+a.DICT("View_Logs_Here")+"</a>"});"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();0<=m.get_pid().search("RV340W")&&(a.rv340w_flag=!0);var h=function(b){b||
(b={});var d=b["syslog-view-stat"]||{};b=d["logging-sevirity"]||[];d=d["logging-facilities"]||[];angular.forEach(a.ctx.facility,function(b,c){a.ctx.facility[c]=!1});angular.forEach(a.ctx.severity,function(b,c){a.ctx.severity[c]=!1});angular.forEach(b,function(b){void 0!==a.ctx.severity[b.severity]?a.ctx.severity[b.severity]=!0:Log(ERROR,"[View Logs] procViewLogs() severity got error, no exist severity "+b.severity)});angular.forEach(d,function(b){void 0!==a.ctx.facility[b.facility]?a.ctx.facility[b.facility]=
!0:Log(ERROR,"[View Logs] procViewLogs() facility got error, no exist facility "+b.facility)})},p=function(){var c=n.post({url:resource_base+"data/view_logs.json",method:"get_view_logs",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),d=n.post({url:resource_base+"data/log.json",method:"get_log",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,d]).then(function(b){h(l(b,0));b=l(b,1);a.grayout=!1;b&&(b.syslog&&b.syslog["global-logging-action"])&&
null===b.syslog["global-logging-action"].none&&(a.grayout=!0);a.checkSeverityAllStatus();a.checkFacilityAllStatus();a.dataReady=!0})};a.checkSeverityAllStatus=function(){var b=!0;a.ctx.severity_cnt=0;angular.forEach(a.ctx.severity,function(d){d?a.ctx.severity_cnt+=1:b=!1});a.ctx.all_severity=b};a.checkFacilityAllStatus=function(){var b=!0;a.ctx.facility_cnt=0;angular.forEach(a.ctx.facility,function(d){d?a.ctx.facility_cnt+=1:b=!1});a.ctx.all_facility=b};a.gridviewOptions=app.uiGrid.generateGridOptions({enablePaginationControls:!1,
paginationPageSize:a.pagingOptions.pageSize,rowHeight:2*app.uiGrid.rowHeight,enablePagination:!0,columnDefs:[{field:"timestamp",displayName:a.DICT("View_Logs_Log_Time"),width:220},{field:"severity",displayName:a.DICT("View_Logs_Log_Severity"),width:130},{field:"facility",displayName:a.DICT("View_Logs_Category_N"),width:110},{field:"message",displayName:a.DICT("View_Logs_Description"),cellClass:"grid-white-space-normal",cellTooltip:function(a){return a.entity.message}}],onRegisterApi:function(b){a.pagingOptions.gridApi=
b;a.gridApi=b}});a.gridApi;var u=function(){var b=[];angular.forEach(a.ctx.severity,function(a,d){a&&b.push({severity:d})});return b},x=function(){var b=[];angular.forEach(a.ctx.facility,function(a,d){a&&b.push({facility:d})});return b};a.save=function(b,d){var e={"syslog-view-stat":{"logging-facilities":x(),"logging-sevirity":u()}},h={"logging-facilities":x(),"logging-sevirity":u(),"page-size":a.pagingOptions.pageSize};a.ctx.keyword&&angular.extend(h,{keyword:a.ctx.keyword});h=function(){n.post({url:resource_base+
"data/log.json",method:"set_view_logs",params:e,success:function(b){p();a.init_query_logs()},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})};"RO"===a.userAccessFlag?a.init_query_logs():h()};var r=function(a){if(a&&a.rpc){var b={rpc:a.rpc};a.input&&(b.input=a.input);n.post({method:"action",background:a.background||!1,popRPCResonsepAlert:a.popRPCResonsepAlert,params:b,success:function(b){"function"===$.type(a.success)&&a.success(b)},error:function(b){"function"===
$.type(a.error)&&a.error(b)}})}},d=function(){_.isFunction(a.pagingOptions.updateOpts)&&a.pagingOptions.updateOpts()};a.query_logs_by_current_page=function(b){if(a.model.totalPages){var d=a.model.currPage,e=a.pagingOptions.pageSize,h=function(){b&&"function"===$.type(b.cbk)&&b.cbk()};if(a.model.downloaded_page[d])Log(DEBUG,"logs is exist, do nothing"),h();else{var l=function(b){if(b&&b.data&&b.data.result){b=b.data.result;b=b.output&&b.output.log||[];var c=(d-1)*e,l=d*e,p=b.length,r;a.model.downloaded_page[d]=
!0;for(r=0;r<p;r++)b[r].timestamp=w.genTimeStrByTimeStamp(b[r].timestamp,"N/A"),a.model.logs[c]=angular.copy(b[r]),c+=1;d===a.model.totalPages&&a.model.logs.splice(c,l-c);h()}};r({rpc:"query-syslog-current-page",input:{"page-size":e,"page-index":d},success:l,error:l})}}};a.init_query_logs=function(){var b=a.pagingOptions.pageSize,e={"logging-facilities":x(),"logging-sevirity":u(),"page-size":b};a.ctx.keyword&&angular.extend(e,{keyword:a.ctx.keyword});a.query_once=!0;var g=function(e){if(e&&e.data&&
e.data.result){var g=e.data.result,k=0;e=0;g.output&&g.output.total&&(k=parseInt(g.output.total,10),isNaN(k)&&(k=0));2E3<k&&(k=2E3);a.model.totalItems=k;a.pagingOptions.total=k;e=(k-k%b)/b+(k%b?1:0);a.model.totalPages=e;a.model.logs=[];a.model.downloaded_page=[];if(0!==e){a.model.downloaded_page.push(!0);a.model.currPage=1;k=e*b;for(g=2;g<=e;g++)a.model.downloaded_page.push(!1);for(g=0;g<k;g++)a.model.logs.push({});a.query_logs_by_current_page({cbk:function(){_.isFunction(a.pagingOptions.goTo)?a.pagingOptions.goTo(a.model.currPage):
(a.gridApi.pagination.seek(a.model.currPage),a.gridApi.grid.refresh())}})}a.gridviewOptions.data=a.model.logs;d()}};r({popRPCResonsepAlert:!0,rpc:"query-syslog",input:e,success:g,error:g})};a.cancel=function(){};a.allFacility=function(){var b=a.ctx.all_facility,d=0;angular.forEach(a.ctx.facility,function(e,h){(a.ctx.facility[h]=b)&&(d+=1)});a.ctx.facility_cnt=d};a.allSeverity=function(){var b=a.ctx.all_severity,d=0;angular.forEach(a.ctx.severity,function(e,h){(a.ctx.severity[h]=b)&&(d+=1)});a.ctx.severity_cnt=
d};a.refresh=function(){a.init_query_logs();a.grid_seak()};a.clear=function(){var b=function(){a.model.logs=[];a.gridviewOptions.data=a.model.logs;a.query_once=!1};r({popRPCResonsepAlert:!0,rpc:"file-delete",input:{fileType:"log",source:{"location-url":"FILE://Log/syslog.log"}},success:b,error:b})};a.to_pc=function(){var a=function(a){var b=a&&a.data&&a.data.result||{},b=b.output&&b.output["download-url"]||"";if(b.length){var c=b.split("/");a=app.TOOLS.download_save_to(b,c[c.length-1],"text/plain");
var d=0,e=function(){4===a.readyState&&200===a.status?app.TOOLS.successAlertBox({msg:"Download Success",cbk:function(a){}}):3<=d?app.TOOLS.criticalAlertBox({msg:"Download Fail",cbk:function(a){}}):(d++,setTimeout(e,2E3))};e()}else app.TOOLS.criticalAlertBox({msg:"Download Fail",cbk:function(a){}})};r({popRPCResonsepAlert:!1,rpc:"file-download",input:{fileType:"log"},success:a,error:a})};a.to_usb=function(){var c=function(){s.open({animation:a.animationsEnabled,templateUrl:"export_log_to_usb.html",
controller:"usb_ctrl",size:"sm",resolve:{usbs_avaiable:function(){return a.usbs_avaiable},usb_name:function(){return""}}}).result.then(function(a){var b=function(a){return 10>parseInt(a,10)?"0"+a:a.toString()},c=new Date,b=c.getYear()+1900+b(c.getMonth()+1)+b(c.getDate())+"T"+b(c.getHours())+b(c.getMinutes())+b(c.getSeconds());r({popRPCResonsepAlert:!0,rpc:"file-copy",input:{fileType:"log",source:{"location-url":"FILE://Log/syslog.log"},destination:{"location-url":"FILE://"+a+"/rv340_syslog_"+b+".log"}},
success:function(a){Log(DEBUG,"success "+JSON.stringify(a))},error:function(a){Log(DEBUG,"error "+JSON.stringify(a))}})},function(){Log(DEBUG,"do nothing")})};b.all([t.usbs_avaiable()]).then(function(b){a.usbs_avaiable=b[0];c()})};a.grid_seak=function(b){void 0===a.model.currPage||1>a.model.currPage||a.model.currPage>a.model.totalPages?Log(DEBUG,"grid_seak do nothing "+a.model.currPage+" "+a.model.totalPages):(_.isFunction(b)||(b=function(){_.isFunction(a.pagingOptions.goTo)?a.pagingOptions.goTo(a.model.currPage):
(a.gridApi.pagination.seek(a.model.currPage),a.gridApi.grid.refresh())}),a.query_logs_by_current_page({cbk:b}))};a.schema={severity:[{id:"emergency",displayName:a.DICT("View_Logs_Emergency")},{id:"alert",displayName:a.DICT("View_Logs_Alert")},{id:"critical",displayName:a.DICT("View_Logs_Critical")},{id:"error",displayName:a.DICT("View_Logs_Error")},{id:"warning",displayName:a.DICT("View_Logs_Warning")},{id:"notice",displayName:a.DICT("View_Logs_Notification")},{id:"info",displayName:a.DICT("View_Logs_Information")},
{id:"debug",displayName:a.DICT("View_Logs_Debugging")}]};p()}]);app.controller("usb_ctrl",["$scope","$uibModalInstance","usbs_avaiable","usb_name",function(a,b,s,n){a.usbs_avaiable=s;a.usb_name=n||"";n||(s.USB1?a.usb_name="USB1":s.USB2&&(a.usb_name="USB2"));a.save=function(){b.close(a.usb_name)};a.cancel=function(){b.dismiss()}}]);app.controller("vpn_status_main",["$scope","$rootScope","$q","$location","$filter","MyHttp","oneTimeLocker","$templateCache","Sets","userAccessRight","UserSession","$cookies",function(a,b,s,n,v,t,m,q,e,w,l,h){a.model=a.model||{};a.ip_groups={};a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&l.logout();var p=function(a,b){return t.post({url:resource_base+"data/"+b,method:a,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},u=function(b,
c,d){var e,g;switch(b){case "vpn_status":e="get_vpn_state";g="vpn_status.json";a.model["pptp-state"]=void 0;a.model["l2tp-state"]=void 0;a.model["site-to-site-state"]=void 0;a.model["client-to-site-state"]=void 0;a.model["sslvpn-state"]=void 0;break;case "ipsec_s2s_state":e="get_site_to_site_state";g="ipsec_site_to_site_state.json";break;case "pptp_server":e="get_pptp_server";g="pptp_server.json";break;case "l2tp_server":e="get_l2tp_server";g="l2tp_server.json";break;case "ipsec_s2s":e="get_site_to_site";
g="ipsec_site_to_site.json";break;case "ipsec_c2s":e="get_client_to_site";g="ipsec_client_to_site.json";break;case "ipsec_profiles":e="get_ipsec_profile";g="ipsec_profiles.json";break;case "sslvpn":e="get_sslvpn";g="sslvpn.json";break;case "teleworker_vpn_state":e="get_teleworker_vpn_state";g="teleworker_vpn_state.json";break;case "teleworker_vpn":e="get_teleworker_vpn";g="telework_vpn_clients.json";break;case "ip_group":e="get_ipgroup";g="ip_group.json";break;default:console.log("prepareModelOf: unknown name: "+
b)}b=p(e,g);if(c||d)b.then(function(b){d&&d(b);angular.extend(a.model,b.data.result);r();a.gridC2SConn.viewConn=!1;a.gridSSLConn.viewConn=!1;c&&c(b)});else return b},x={number:!0,name:!0,enable:!0,status:!0,auth:!0,"local-group":!0,"remote-group":!0,"remote-gateway":!0,"wan-interface":!1,"ike-sa-time":!1,"ipsec-sa-time":!1,"tx-bytes":!1,"rx-bytes":!1,"tx-packets":!1,"rx-packets":!1,action:!0};a.visible_s2s_col=x;if(b=h.getObject("vpn_status"))angular.forEach(x,function(a,b){x[b]=!1}),angular.forEach(b,
function(a,b){void 0!==x[b]&&(x[b]=a)});var r=function(){var b=function(a,b){angular.forEach(a,function(a,c){a.number=c+1;_.isUndefined(a.checked)&&(a.checked=!1);b&&angular.forEach(a.client,function(a,b){a.number=b+1})})};e.recover_object(a.model,{"site-to-site-state":{connections:{connection:[]}}});e.recover_object(a.model,{"client-to-site-state":{connection:[]}});e.recover_object(a.model,{"l2tp-state":{connections:{connection:[]}}});e.recover_object(a.model,{"pptp-state":{connections:{connection:[]}}});
e.recover_object(a.model,{"sslvpn-state":{"group-policies":{"group-policy":[]}}});b(a.model["site-to-site-state"].connections.connection);b(a.model["client-to-site-state"].connection,!0);b(a.model["l2tp-state"].connections.connection);b(a.model["pptp-state"].connections.connection);b(a.model["sslvpn-state"]["group-policies"]["group-policy"],!0);c();a.gridS2SConn.Options.data=a.model["site-to-site-state"].connections.connection;a.gridC2SConn.Options.data=a.model["client-to-site-state"].connection;
a.gridSSLConn.Options.data=a.model["sslvpn-state"]["group-policies"]["group-policy"];a.gridL2TPConn.Options.data=a.model["l2tp-state"].connections.connection;a.gridPPTPConn.Options.data=a.model["pptp-state"].connections.connection;a.gridS2SConn.Selections=[];a.gridC2SConn.Selections=[];a.gridSSLConn.Selections=[]},d=function(){a.ip_groups={};var b,c,d;angular.forEach(a.model["ip-groups"]&&a.model["ip-groups"]["ip-group"]||[],function(e){b=e.ips||[];c={name:e.name,id:e.name,list:[],tip:""};angular.forEach(b,
function(a){angular.forEach(a.ipv4,function(a,b){switch(b){case "single":c.list.push(a);c.tip=c.tip+"<div>"+a+"</div>";break;case "subnet":d=a.ip+"/"+app.TOOLS.netmask.inet2Int(a.netmask);c.list.push(d);c.tip=c.tip+"<div>"+d+"</div>";break;case "range":d=a.start+"-"+a.end,c.list.push(d),c.tip=c.tip+"<div>"+d+"</div>"}});angular.forEach(a.ipv6,function(a,b){switch(b){case "single":c.list.push(a);c.tip=c.tip+"<div>"+a+"</div>";break;case "subnet":d=a.ip+"/"+a["prefix-length"];c.list.push(d);c.tip=c.tip+
"<div>"+d+"</div>";break;case "range":d=a.start+"-"+a.end,c.list.push(d),c.tip=c.tip+"<div>"+d+"</div>"}})});c.list.length||(c.tip=a.DICT("VPN_Status_IP_Groups_No_IP_Address",{"%s":e.name}));a.ip_groups[e.name]=c})},c=function(){var b={},c,d;angular.forEach(a.model["site-to-sites"]["site-to-site"],function(a){b[a["connection-name"]]=a});angular.forEach(a.model["site-to-site-state"].connections.connection,function(e){c=b[e.name];e.local_group={info:e["local-group"],tip:""};e.remote_group={info:e["remote-group"],
tip:""};c&&(d="",c["local-group"].group["ip-group"]&&(d=c["local-group"].group["ip-group"][0]),a.ip_groups[d]&&(e.local_group.tip=a.ip_groups[d].tip),d="",c["remote-group"].group["ip-group"]&&(d=c["remote-group"].group["ip-group"][0]),a.ip_groups[d]&&(e.remote_group.tip=a.ip_groups[d].tip));if(!e.local_group.info||"any"===!e.local_group.info)e.local_group.info="0.0.0.0/0";if(!e.remote_group.info||"any"===!e.remote_group.info)e.remote_group.info="0.0.0.0/0"})};a.getConnNumOf=function(b){var c=function(a,
b,c){return"UP"===a.status.toUpperCase()?!0:!1},d;if(("pptp-state"==b||"l2tp-state"==b||"site-to-site-state"==b)&&a.model[b]&&a.model[b].connections&&a.model[b].connections.connection)return d=a.model[b].connections.connection,"site-to-site-state"==b?v("filter")(d,c).length:d.length;if("sslvpn-state"==b&&a.model[b]&&a.model[b]["group-policies"]&&a.model[b]["group-policies"]["group-policy"]){d=a.model[b]["group-policies"]["group-policy"];var e=0;angular.forEach(d,function(a,b){0<a.sessions&&(e+=a.sessions)});
return e}if("client-to-site-state"==b&&a.model[b]&&a.model[b].connection){d=a.model[b].connection;var g=0;angular.forEach(d,function(a,b){0<a.tunnels&&(g+=a.tunnels)});return g}return 0};a.getEnabledNumOf=function(b){var c=0,d=function(a,b,c){a=a.status.toUpperCase();return"UP"===a||"DOWN"===a?!0:!1};"site-to-site-state"==b&&a.model[b]?(b=a.model[b].connections.connection,c=v("filter")(b,d).length):"client-to-site-state"==b&&a.model[b]&&(b=a.model[b].connection,c=b.reduce(function(a,b,c){return a+
(b.enable?1:0)},0));return c};a.getDefinedNumOf=function(b){return!a.model[b]?0:a.model[b].connections.connection.length};a.RPC_generic=function(a,b,c){y.doSyncRPC({url:resource_base+"data/vpn_rpc_result.json",rpcname:a,input:b}).then(function(b){y.ret_code_dispatcher(b,c,a)})};a.RPC_S2S=function(b,c){a.RPC_generic(b,c,function(a,b){switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");u("vpn_status",function(a){Log(DEBUG,"update success")});break;default:console.log(b+": RPC done. got unknown code: "+
a)}})};a.RPC_C2S=function(b,c){a.RPC_generic(b,c,function(a,b){switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");u("vpn_status",function(a){Log(DEBUG,"update success")});break;default:console.log(b+": RPC done. got unknown code: "+a)}})};a.RPC_SSL=function(b,c){a.RPC_generic(b,c,function(a,b){switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");u("vpn_status",function(a){Log(DEBUG,"update success")});break;default:console.log(b+": RPC done. got unknown code: "+a)}})};
a.RPC_PPTP=function(b,c){a.RPC_generic(b,c,function(a,b){switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");u("vpn_status",function(a){Log(DEBUG,"update success")});break;default:console.log(b+": RPC done. got unknown code: "+a)}})};a.RPC_L2TP=function(b,c){a.RPC_generic(b,c,function(a,b){switch(a){case 0:Log(DEBUG,"RPC done. Data model partial update");u("vpn_status",function(a){Log(DEBUG,"update success")});break;default:console.log(b+": RPC done. got unknown code: "+a)}})};a.S2Smethod_row=
function(a,b){t.post({url:resource_base+"data/vpn_status.json",method:a,params:{"site-to-sites":{"site-to-site":[{"connection-name":b}]}},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(a){Log(DEBUG,"POST is done. checking result if success");u("vpn_status",function(a){Log(DEBUG,"update success")})})};a.C2Smethod_row=function(a,b){t.post({url:resource_base+"data/vpn_status.json",method:a,params:{"client-to-sites":{"client-to-site":[{seq:b}]}},
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(a){Log(DEBUG,"POST is done. checking result if success");u("vpn_status",function(a){Log(DEBUG,"update success")})})};a.SSLmethod_row=function(a,b){t.post({url:resource_base+"data/sslvpn.json",method:a,params:{sslvpn:{"group-policies":{"group-policy":{"policy-name":b}}}},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(a){Log(DEBUG,"POST is done. checking result if success");
u("vpn_status",function(a){Log(DEBUG,"update success")})})};a.pageJump=function(a){var b={S2S:"VPN_Site_to_Site",C2S:"VPN_Client_to_Site",SSL:"VPN_SSL"}[a];b||alert("unknown pageId:"+a);a=document.location;document.location.href=a.protocol+"//"+a.host+a.pathname+"#/"+b};var k=function(a,b){var c;"add"==a?c="":b&&(b[0]&&b[0].name)&&(c=b[0].name);if(void 0!=c)return{action:a,key:c}},g=function(a,b){var c;"add"==a?c="":b&&(b[0]&&b[0]["group-name"])&&(c=b[0]["group-name"]);if(void 0!=c)return{action:a,
key:c}},z=function(a,b){var c;"add"==a?c="":b&&(b[0]&&b[0]["policy-name"])&&(c=b[0]["policy-name"]);if(void 0!=c)return{action:a,key:c}};a.pageActionJump=function(b,c,d){var e={S2S:{lockerID:"IPSec_S2S",prepareItem_cb:k},C2S:{lockerID:"IPSec_C2S",prepareItem_cb:g},SSL:{lockerID:"SSL_VPN",prepareItem_cb:z}},h=e[b].lockerID;c=e[b].prepareItem_cb(c,d);m.put(h,c);app.transition.In();a.pageJump(b)};a.idTrue=!0;a.idFalse=!1;a.T_cellEdit=q.get("T_editWithNoFoucs_by_rowEditableState.html");a.selected=a.selected||
{};a.selected.rowEditableState=[];a.gridS2SConn=a.gridS2SConn||{};a.gridS2SConn.toggleColumnSelect=function(a,b){var c={},d=new Date,e,g=new Date,d=d.getTime();g.setTime(d+31536E6);angular.forEach(b,function(a){e=a.field;switch(e){case "local_group":e="local-group";break;case "remote_group":e="remote-group"}a.visible&&(c[e]=a.visible)});h.putObject("vpn_status",c,{expires:g})};a.gridS2SConn.rowActionList=[{id:"connect",text:"Connect",toast:a.DICT("VPN_Status_Connect"),className:"icon-connect",stateDisplay:{"0":!0,
1:!1,2:!1},click:function(b,c){a.RPC_S2S("s2s-connect",{"connection-name":c.entity.name})}},{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),className:"icon-disconnect",stateDisplay:{"0":!1,1:!0,2:!1},click:function(b,c){a.RPC_S2S("s2s-disconnect",{"connection-name":c.entity.name})}}];a.gridS2SConn.rowActionRule=function(b,c,d){c=2;if("connect"==d.id||"disconnect"==d.id){c=b.entity["ipsec-profile"];var e="",e=c.match(/^prof_/)?c.substr(5):c;c="UP"==b.entity.status;var g=!1;
angular.forEach(a.model["ipsec-profiles"]["ipsec-profile"],function(a,b){a["profile-name"]==e&&(g=a["keying-mode"]&&a["keying-mode"]["phase1-options"]?!0:!1)});c=c?1:0;b.entity._disabled=g?!1:!0;!1==b.entity.enable&&(b.entity._disabled=!0)}return d.stateDisplay[c]};a.gridS2SConn.Selections=[];a.gridS2SConn.procClick=function(b){a.gridS2SConn.Selections=[];a.gridS2SConn.Selections.push(a.model["site-to-site-state"].connections.connection[b])};a.gridS2SConn.Options=app.uiGrid.generateGridOptions({IDPreifx:"Connection",
columnDefs:[{field:"checked",isRadio:!0,changedCbk:a.gridS2SConn.procClick},{field:"number",displayName:a.DICT("VPN_Status_No"),minWidth:55,hideInMenu:!0,visible:x.number},{field:"name",displayName:a.DICT("VPN_Status_Name_N"),visible:x.name},{field:"enable",displayName:a.DICT("VPN_Status_Enable"),cellTemplate:q.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"grid.appScope.schema.StatusMap[MODEL_COL_FIELD]"),visible:x.enable},{field:"status",displayName:a.DICT("VPN_Status_Status_N"),visible:x.status},
{field:"auth",displayName:a.DICT("VPN_Status_Phase2_Enc_Auth_Grp"),minWidth:240,visible:x.auth,cellTemplate:q.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"grid.appScope.showAuthGroup(MODEL_COL_FIELD)")},{field:"local_group",displayName:a.DICT("VPN_Status_Local_Group"),visible:x["local-group"],cellTemplate:q.get("vpnstatus_group.html")},{field:"remote_group",displayName:a.DICT("VPN_Status_Remote_Group"),minWidth:135,visible:x["remote-group"],cellTemplate:q.get("vpnstatus_group.html")},{field:"remote-gateway",
displayName:a.DICT("VPN_Status_Remote_Gateway"),minWidth:135,visible:x["remote-gateway"]},{field:"wan-interface",displayName:a.DICT("VPN_Status_WAN_Interface"),visible:x["wan-interface"]},{field:"ike-sa-time",displayName:a.DICT("VPN_Status_IKE_SA_Time_Expire"),visible:x["ike-sa-time"]},{field:"ipsec-sa-time",displayName:a.DICT("VPN_Status_IPSec_SA_Time_Expire"),visible:x["ipsec-sa-time"]},{field:"tx-bytes",displayName:a.DICT("VPN_Status_TX_Bytes"),visible:x["tx-bytes"]},{field:"rx-bytes",displayName:a.DICT("VPN_Status_RX_Bytes"),
visible:x["rx-bytes"]},{field:"tx-packets",displayName:a.DICT("VPN_Status_TX_Packets"),visible:x["tx-packets"]},{field:"rx-packets",displayName:a.DICT("VPN_Status_RX_Packets"),visible:x["rx-packets"]},{field:"action",displayName:a.DICT("VPN_Status_Action"),width:180,cellTemplate:q.get("T_VPNStatus_Action.html"),rowAction:a.gridS2SConn.rowActionList,rowActionRule:a.gridS2SConn.rowActionRule,visible:x.action,hideInMenu:!0}]});a.showAuthGroup=function(a){return a.match("modp1024")?a+"-group 2":a.match("modp1536")?
a+"-group 5":a};a.showLocalRemoteGroup=function(a){return!angular.isDefined(a)||""==a||"any"==a?"0.0.0.0/0":a};a.gridS2SConn.remove=function(){a.S2Smethod_row("del_site_to_site",a.gridS2SConn.Selections[0].name);a.gridRefresh()};a.gridS2SConn.refresh=function(){u("ipsec_s2s_state",function(){r()},function(){a.model&&(a.model["site-to-site-state"]&&a.model["site-to-site-state"].connections&&a.model["site-to-site-state"].connections.connection)&&a.model["site-to-site-state"].connections.connection.splice(0)})};
a.gridRefresh=function(){Log(DEBUG,"==Refresh==");a.gridS2SConn.refresh()};a.gridC2SConn=a.gridC2SConn||{};a.gridC2SConn.clickView=function(){a.gridC2SConn.viewConn=!a.gridC2SConn.viewConn};a.gridC2SConn.Plugin={init:function(a,b,c){}};a.gridC2SConn.rowActionList=[{id:"viewConnection",text:"View Connection",toast:a.DICT("VPN_Status_View"),className:"icon-look",stateDisplay:{"0":!0,1:!0,2:!0},click:function(b,c){a.gridC2SConn.viewConn=!a.gridC2SConn.viewConn}},{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),
className:"icon-disconnect",stateDisplay:{"0":!0,1:!1,2:!0},click:function(b,c){a.RPC_C2S("c2s-disconnect",{"group-name":c.entity["group-name"]})}},{id:"delete",text:"Delete",toast:a.DICT("VPN_Status_Delete"),stateDisplay:{"0":!0,1:!0,2:!0},className:"icon-delete",click:function(b,c){a.C2Smethod_row("del_client_to_site",c.entity.name)}}];a.gridC2SConn.rowActionRule=function(a,b,c){b=2;if("connect"==c.id||"disconnect"==c.id)b="UP"==a.entity.status?1:0;return c.stateDisplay[b]};a.gridC2SConn.Selections=
[];a.gridC2SConn.procClick=function(b){b=a.model["client-to-site-state"].connection[b];a.gridC2SConn.Selections=[];a.gridC2SConn.Selections.push(b);a.gridC2SConnDetail.Options.data=b.client;a.gridC2SConn.viewConn&&a.gridC2SConn.Options.gridApi.core.notifyDataChange("all")};a.gridC2SConn.Options=app.uiGrid.generateGridOptions({IDPreifx:"C2SConn",columnDefs:[{field:"checked",isRadio:!0,changedCbk:a.gridC2SConn.procClick},{field:"number",displayName:a.DICT("VPN_Status_No"),minWidth:55,hideInMenu:!0},
{field:"group-name",displayName:a.DICT("VPN_Status_Group_Tunnel_Name")},{field:"tunnels",displayName:a.DICT("VPN_Status_Connections")},{field:"auth",displayName:a.DICT("VPN_Status_Phase2_Enc_Auth_Grp")},{field:"local-group",displayName:a.DICT("VPN_Status_Local_Group"),cellTemplate:q.get("UG_CellText.html").replace(/MODEL_COL_FIELD/g,"grid.appScope.showLocalRemoteGroup(MODEL_COL_FIELD)")},{field:"wan-interface",displayName:a.DICT("VPN_Status_WAN_Interface"),visible:!1},{field:"ike-sa-time",displayName:a.DICT("VPN_Status_IKE_SA_Time_Expire"),
visible:!1},{field:"ipsec-sa-time",displayName:a.DICT("VPN_Status_IPSec_SA_Time_Expire"),visible:!1},{field:"tx-bytes",displayName:a.DICT("VPN_Status_TX_Bytes"),visible:!1},{field:"rx-bytes",displayName:a.DICT("VPN_Status_RX_Bytes"),visible:!1},{field:"tx-packets",displayName:a.DICT("VPN_Status_TX_Packets"),visible:!1},{field:"rx-packets",displayName:a.DICT("VPN_Status_RX_Packets"),visible:!1},{field:"action",displayName:a.DICT("VPN_Status_Action"),width:180,visible:!1,id:"C2SConnAction",cellTemplate:q.get("T_VPNStatus_Action.html"),
rowAction:a.gridC2SConn.rowActionList,rowActionRule:a.gridC2SConn.rowActionRule,hideInMenu:!0}]});a.gridC2SConn.remove=function(){a.C2Smethod_row("del_client_to_site",a.gridC2SConn.Selections[0]["group-name"]);a.gridRefresh()};a.gridC2SConnDetail=a.gridC2SConnDetail||{};a.gridC2SConnDetail.rowActionList=[{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),stateDisplay:{"0":!0,1:!1,2:!0},className:"icon-disconnect",click:function(b,c){var d=a.gridC2SConn.Selections[0],e=d.client[b];
a.RPC_C2S("c2s-disconnect",{"group-name":d["group-name"],ip:e.ip,vip:e.vip})}}];a.gridC2SConnDetail.rowActionRule=function(a,b,c){b=2;if("connect"==c.id||"disconnect"==c.id)b="UP"==a.entity.status?1:0;return c.stateDisplay[b]};a.gridC2SConnDetail.Options=app.uiGrid.generateGridOptions({IDPreifx:"C2SConnDetail",columnDefs:[{field:"number",displayName:a.DICT("VPN_Status_No"),width:55,hideInMenu:!0},{field:"ip",displayName:a.DICT("VPN_Status_Client_IP_Actual")},{field:"vip",displayName:a.DICT("VPN_Status_Client_IP_VPN")},
{field:"tx-bytes",displayName:a.DICT("VPN_Status_TX_Bytes")},{field:"rx-bytes",displayName:a.DICT("VPN_Status_RX_Bytes")},{field:"tx-packets",displayName:a.DICT("VPN_Status_TX_Packets")},{field:"rx-packets",displayName:a.DICT("VPN_Status_RX_Packets")},{field:"connect-time",displayName:a.DICT("VPN_Status_Connect_Time")},{field:"action",displayName:a.DICT("VPN_Status_Action"),width:180,id:"C2SConnDetailAction",cellTemplate:q.get("T_VPNStatus_Action.html"),rowAction:a.gridC2SConnDetail.rowActionList,
rowActionRule:a.gridC2SConnDetail.rowActionRule,hideInMenu:!0}]});a.gridSSLConn=a.gridSSLConn||{};a.gridSSLConn.clickView=function(){a.gridSSLConn.viewConn=!a.gridSSLConn.viewConn};a.gridSSLConn.Plugin={init:function(a,b,c){}};a.gridSSLConn.rowActionList=[{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),className:"icon-disconnect",stateDisplay:{"0":!1,1:!0,2:!0},click:function(b,c){a.RPC_SSL("ssl-disconnect",{"session-id":c.entity["session-id"]})}},{id:"delete",text:"Delete",
toast:"Delete",className:"icon-delete",stateDisplay:{"0":!0,1:!0,2:!0},click:function(b,c){a.SSLmethod_row("del_sslvpn",c.entity["policy-name"])}}];a.gridSSLConn.rowActionRule=function(a,b,c){b=2;if("connect"==c.id||"disconnect"==c.id)b="UP"==a.entity.status?1:0;return c.stateDisplay[b]};a.gridSSLConn.Selections=[];a.gridSSLConn.procClick=function(b){a.gridSSLConn.Selections=[];a.gridSSLConn.Selections.push(a.model["sslvpn-state"]["group-policies"]["group-policy"][b]);a.gridSSLConnDetail.Options.data=
a.gridSSLConn.Selections[0].client};a.gridSSLConn.Options=app.uiGrid.generateGridOptions({IDPreifx:"SSLConn",columnDefs:[{field:"checked",isRadio:!0,changedCbk:a.gridSSLConn.procClick},{field:"number",displayName:a.DICT("VPN_Status_No"),width:55,hideInMenu:!0},{field:"policy-name",displayName:a.DICT("VPN_Status_Policy_Name")},{field:"sessions",displayName:a.DICT("VPN_Status_Sessions")},{field:"wan-interface",displayName:a.DICT("VPN_Status_WAN_Interface"),visible:!1},{field:"ike-sa-time",displayName:a.DICT("VPN_Status_IKE_SA_Time_Expire"),
visible:!1},{field:"ipsec-sa-time",displayName:a.DICT("VPN_Status_IPSec_SA_Time_Expire"),visible:!1},{field:"tx-bytes",displayName:a.DICT("VPN_Status_TX_Bytes"),visible:!1},{field:"rx-bytes",displayName:a.DICT("VPN_Status_RX_Bytes"),visible:!1},{field:"tx-packets",displayName:a.DICT("VPN_Status_TX_Packets"),visible:!1},{field:"rx-packets",displayName:a.DICT("VPN_Status_RX_Packets"),visible:!1}]});a.gridSSLConn.remove=function(){a.SSLmethod_row("del_sslvpn",a.gridSSLConn.Selections[0]["policy-name"]);
a.gridRefresh()};a.gridSSLConnDetail=a.gridSSLConnDetail||{};a.gridSSLConnDetail.rowActionList=[{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),stateDisplay:{"0":!0,1:!1,2:!0},className:"icon-disconnect",click:function(b,c){a.RPC_SSL("ssl-disconnect",{"session-id":c.entity["session-id"]})}}];a.gridSSLConnDetail.rowActionRule=function(a,b,c){b=2;if("connect"==c.id||"disconnect"==c.id)b="UP"==a.entity.status?1:0;return c.stateDisplay[b]};a.gridSSLConnDetail.Selections=[];a.gridSSLConnDetail.Options=
app.uiGrid.generateGridOptions({IDPreifx:"SSLConnDetail",columnDefs:[{field:"number",displayName:a.DICT("VPN_Status_No"),width:55,hideInMenu:!0},{field:"ip",displayName:a.DICT("VPN_Status_Client_IP_Actual")},{field:"vip",displayName:a.DICT("VPN_Status_Client_IP_VPN")},{field:"tx-bytes",displayName:a.DICT("VPN_Status_TX_Bytes")},{field:"rx-bytes",displayName:a.DICT("VPN_Status_RX_Bytes")},{field:"tx-packets",displayName:a.DICT("VPN_Status_TX_Packets")},{field:"rx-packets",displayName:a.DICT("VPN_Status_RX_Packets")},
{field:"connect-time",displayName:a.DICT("VPN_Status_Connect_Time")},{field:"action",displayName:a.DICT("VPN_Status_Action"),width:180,id:"C2SConnDetailAction",cellTemplate:q.get("T_VPNStatus_Action.html"),rowAction:a.gridSSLConnDetail.rowActionList,rowActionRule:a.gridSSLConnDetail.rowActionRule,hideInMenu:!0}]});a.gridPPTPConn=a.gridPPTPConn||{};a.gridPPTPConn.rowActionList=[{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),className:"icon-disconnect",click:function(b,c){a.RPC_PPTP("pptp-disconnect",
{"tunnel-ip":c.entity["tunnel-ip"],"session-id":c.entity["session-id"]})}}];a.gridPPTPConn.rowActionRule=function(a,b,c){return!0};a.gridPPTPConn.Options=app.uiGrid.generateGridOptions({IDPreifx:"PPTPConn",columnDefs:[{field:"session-id",displayName:a.DICT("VPN_Status_Session_ID")},{field:"user-name",displayName:a.DICT("VPN_Status_User_Name")},{field:"remote-address",displayName:a.DICT("VPN_Status_Remote_Address")},{field:"tunnel-ip",displayName:a.DICT("VPN_Status_Tunnel_IP")},{field:"connect-time",
displayName:a.DICT("VPN_Status_Connect_Time")},{field:"action",displayName:a.DICT("VPN_Status_Action"),width:120,id:"PPTPConnAction",cellTemplate:q.get("T_VPNStatus_Action.html"),rowAction:a.gridPPTPConn.rowActionList,rowActionRule:a.gridPPTPConn.rowActionRule,hideInMenu:!0}]});a.gridL2TPConn=a.gridL2TPConn||{};a.gridL2TPConn.rowActionList=[{id:"disconnect",text:"Disconnect",toast:a.DICT("VPN_Status_Disconnect"),className:"icon-disconnect",click:function(b,c){a.RPC_L2TP("l2tp-disconnect",{"tunnel-ip":c.entity["tunnel-ip"],
"session-id":c.entity["session-id"]})}}];a.gridL2TPConn.rowActionRule=function(a,b,c){return!0};a.gridL2TPConn.Options=app.uiGrid.generateGridOptions({IDPreifx:"L2TPConn",columnDefs:[{field:"session-id",displayName:a.DICT("VPN_Status_Session_ID")},{field:"user-name",displayName:a.DICT("VPN_Status_User_Name")},{field:"remote-address",displayName:a.DICT("VPN_Status_Remote_Address")},{field:"tunnel-ip",displayName:a.DICT("VPN_Status_Tunnel_IP")},{field:"connect-time",displayName:a.DICT("VPN_Status_Connect_Time")},
{field:"action",displayName:a.DICT("VPN_Status_Action"),width:120,id:"L2TPConnAction",cellTemplate:q.get("T_VPNStatus_Action.html"),rowAction:a.gridL2TPConn.rowActionList,rowActionRule:a.gridL2TPConn.rowActionRule,hideInMenu:!0}]});a.Fns={getRPCResult:function(a,b){if(a.data.result&&a.data.result.output){var c=a.data.result.output;return b?c[b]:c}console.log("Error: getRPCResult, data.result not exist")},doSyncRPC:function(a,b){var c={};a.input&&(c.input=a.input);c.rpc=a.rpcname||"";return t.post({url:a.url||
"",method:"action",params:c,success:function(a){b&&b.success&&b.success(a)},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);b&&b.error&&b.error(a)}})},ret_code_dispatcher:function(a,b,c){a=y.getRPCResult(a,"code");b&&b(a,c)}};var y=a.Fns;(function(){var b=u("vpn_status"),c=u("pptp_server"),g=u("l2tp_server"),k=u("ipsec_s2s"),h=u("ipsec_c2s"),l=u("ipsec_profiles"),p=u("sslvpn"),m=u("teleworker_vpn_state"),n=u("teleworker_vpn"),q=u("ip_group");s.all([b,c,g,k,h,
l,p,m,n,q]).then(function(b){for(var c=0;c<b.length;c++)angular.extend(a.model,b[c].data.result);d();r();e.recover_object(a.model,{"teleworker-vpn-clients-state":{}});e.recover_object(a.model,{"teleworker-vpn-clients":{}});a.schema=a.schema||{};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.loadReady=!0})["catch"](function(a){console.log("=="+a)})})()}]);app.controller("captivePortalStatusCtrl",["$scope","MyHttp","$q","rpcFns",function(a,b,s,n){a.dataReady=!1;a.forcedUsingPost=!0;var v={procBackground:!0,forcedUsingPost:a.forcedUsingPost},t,m=function(){a.model={};a.gridCaptivePortalState=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:l,headerChangedCbk:l},{field:"name",displayName:a.DICT("Captive_Portal_Status_Username")},{field:"ssid",displayName:a.DICT("Captive_Portal_Status_SSID")},{field:"ip_address",displayName:a.DICT("Captive_Portal_Status_IP_Addr")},
{field:"mac_address",displayName:a.DICT("Captive_Portal_Status_MAC_Addr")},{field:"auth",displayName:a.DICT("Captive_Portal_Status_Auth")},{field:"tx_bytes",displayName:a.DICT("Captive_Portal_Status_Tx_Bytes")},{field:"rx_bytes",displayName:a.DICT("Captive_Portal_Status_Rx_Bytes")},{field:"connect_time",displayName:a.DICT("Captive_Portal_Status_Connected_Time")}]});s.all([e()]).then(function(b){t=b[0]&&b[0].data&&b[0].data.result||{};w();a.resetModified();a.dataReady=!0});a.model.selected=void 0!==
a.keepname?a.keepname:"All"},q=function(a){var b=Math.floor(a/3600),e=Math.floor(a%3600/60);a=a%3600%60;return(9<b?b:"0"+b)+":"+(9<e?e:"0"+e)+":"+(9<a?a:"0"+a)},e=function(){return b.post({url:resource_base+"data/captive_portal_state.json",method:"get_portal_state",error:function(a){console.log("[Err] captivePortalStatusCtrl, getCaptivePortalStatusData status: "+a.status)}})},w=function(){t||(t={});var b=(t["cp-user-state"]||{}).client||[];a.model.userList=[];var e=void 0,h=void 0,l=!0;if(a.model.selected&&
"All"!==a.model.selected){var d=/(.+)\((.+)\)/,l=!1,e=a.model.selected.replace(d,"$1"),d=a.model.selected.replace(d,"$2");"2.4G"==d?h="WLAN1":"5G"==d&&(h="WLAN2")}angular.forEach(b,function(b){if(l||e&&h&&e==b.ssid&&h==b.radio)a.model.userList.push({name:b.name||"",ssid:b.ssid||"",ip_address:b["ip-address"]||"",mac_address:b["mac-address"]||"",auth:void 0!==b.auth?b.auth?a.DICT("Captive_Portal_Status_TRUE"):a.DICT("Captive_Portal_Status_FALSE"):"",tx_bytes:b["tx-bytes"]||"",rx_bytes:b["rx-bytes"]||
"",connect_time:b["connected-time"]?q(b["connected-time"]):""})});b=a.model.userList.length||0;d=a.model.userList;if(b)for(var c=0;c<b;c++)void 0===d[c].checked&&(d[c].checked=!1);a.gridCaptivePortalState.data=a.model.userList},l=function(b){var e=!0;angular.forEach(a.model.userList,function(a){a.checked||(e=!1)});a.gridCaptivePortalState.columnDefs[0].allSelected=e;h()},h=function(){var b=a.model.userList,e=b.length,h;a.model.selects=[];for(h=0;h<e;h++)b[h].checked&&a.model.selects.push(h)};a.collect_ssid_list=
function(){var a=[];angular.forEach((t["cp-user-state"]||{}).client||[],function(b){if(b.ssid&&b.radio){var e=void 0;"WLAN1"==b.radio?e=b.ssid+"(2.4G)":"WLAN2"==b.radio&&(e=b.ssid+"(5G)");e&&a.push(e)}});a.sort(function(a,b){return a>b?1:-1});a.unshift("All");return a.filter(function(a,b,e){return e.indexOf(a)===b})};a.update=function(){w()};a.refresh=function(){a.dataReady=!1;m()};a.RPC_disconnect=function(){var b;if(a.gridCaptivePortalState.columnDefs[0].allSelected)b={all:null};else if(1==a.model.selects.length)b=
a.model.selects[0],b={one:a.model.userList[b].mac_address};else for(var e=[],h=0;h<a.model.selects.length;h++)b=a.model.selects[h],e.push(a.model.userList[b].mac_address),b={list:e};n.RPC_generic_send("terminate-cp-user",b,function(b,d,c){b&&(a.dataReady=!1,m())},void 0,v)};m()}]);app.controller("clientStatisticsCtrl",["$scope","MyHttp","userAccessRight","UserSession","$q","dt","device_os_type","$templateCache","goToPreviousPage",function(a,b,s,n,v,t,m,q,e){a.jumpToPage=app.TOOLS.jumpToPage;a.backbtn=!1;var w=app.TOOLS.getVal,l=app.TOOLS.str2int,h=app.TOOLS.getResponse,p=app.TOOLS.MBpkt2String,u=app.TOOLS.cpuPercentageNum;e.isneed()&&(a.backbtn=!0);var x=0,r=function(b){var c="",d,e;if(!_.isNumber(b))return"-";d=Math.floor(b/86400);0<d&&(e=1===d?a.DICT("Client_Statistics_Day"):
a.DICT("Client_Statistics_Days"),c=d+" "+e);d=Math.floor(b/3600)%24;if(0<d||c&&0===d)c&&(c+=", "),e=1>=d?a.DICT("Client_Statistics_Hour"):a.DICT("Client_Statistics_Hours"),c=c+d+" "+e;d=Math.floor(b/60)%60;if(0<d||c&&0===d)c&&(c+=", "),e=1>=d?a.DICT("Client_Statistics_Minute"):a.DICT("Client_Statistics_Minutes"),c=c+d+" "+e;d=b%60;c&&(c+=", ");e=1>=d?a.DICT("Client_Statistics_Second"):a.DICT("Client_Statistics_Seconds");return c+d+" "+e},d=function(){return b.post({url:resource_base+"data/ip_group.json",
method:"get_ipgroup",error:function(a){Log(ERROR,"clientStatisticsCtrl getIpGroupData error : "+a.status);c()}})},c=function(b){var c=[],d;b&&(b["ip-groups"]&&b["ip-groups"]["ip-group"])&&(c=b["ip-groups"]["ip-group"]);a.model.ip_groups=[];a.model.mac2ipgroup_map={};angular.forEach(c,function(b,c){d=k(b);d.id=c+1;angular.forEach(d.macs,function(c){a.model.mac2ipgroup_map[c.mac]=b.name;d.macsStr&&(d.macsStr+=", ");d.macsStr+=c.mac});d.macsStr||(d.macsStr="-");a.model.ip_groups.push(d)});x=a.model.ip_groups.length},
k=function(a){a||(a={});var b={type:"origin",id:0,name:a.name||"",macs:[],checked:!1,disable:!0,invalid:!1,edit:!1,macsStr:""};angular.forEach(a.macs||[],function(a){b.macs.push({mac:a.mac||"",device_type:a["device-type"]||"ANY",os_type:a["os-type"]||"ANY"})});return b},g=function(){return b.post({url:resource_base+"data/avc_state_applications.json",method:"get_avc_state",error:function(){}})},z=function(b){b=b&&b["avc-state"]&&b["avc-state"]||{};var c=b.applications||[],d;a.model.app_map={};tmp=
t.parser(b["last-reset-time"]);0===tmp.err_code&&(a.model.application_reset_time_str=r(tmp.date));angular.forEach(c,function(b){d={application:b.application||"-",protocol:b.protocol||"-",port:b.port||"N/A",flows:b.flows||"-"};a.model.app_map[d.application]=d})},y=function(b){b||(b={});b=w(b.status,0);a.model.no_license=0===b};procClientData=function(b){b=(b&&b["avc-state"]&&b["avc-state"]||{}).clients||[];var c,d=0,e,g,k,h,r,m,n,q,z,y,s;a.model.clients=[];angular.forEach(b,function(b){n=w(b["os-type"],
"ANY");q=w(b["device-type"],"ANY");"Unknown"===n&&(n="ANY");"Unknown"===q&&(q="ANY");c={checked:!1,edit:!1,mac:b.mac||"",ip_address:b["ipv4-address"]||b["ipv6-address"]||"",hostname:b.hostname||"-",device_type:q,os_type:n,status:b.status||"unknown",ip_group:b["ip-group"]||"@none",in_pkts:b["in-pkts"]||0,out_pkts:b["out-pkts"]||0,applications:[],device_type_list:[],os_type_list:[],orig_ip_group:"",orig_os_type:"",orig_device_type:"",orig_hostname:"",action:"",usage_pkts:0,usage_per_num:0,usage_per:0,
usage_per_str:"0%",ip_groups_list:[],ip_group_id:0};e=b.applications||[];m=r=0;angular.forEach(e,function(b){g={application:b["app-id"],active_time:w(b["active-time"],"N/A"),active_time_str:"",in_pkts:l(w(b["in-pkts"],0)),out_pkts:l(w(b["out-pkts"],0)),in_pkts_str:"",out_pkts_str:"",usage_pkts:0,usage_str:"",usage_per_num:0,usage_per:0,usage_per_str:"",port:"N/A",protocol:"-",flows:"-"};g.usage_pkts=g.in_pkts+g.out_pkts;g.usage_str=p(g.usage_pkts);g.in_pkts_str=p(g.in_pkts);g.out_pkts_str=p(g.out_pkts);
b=g.active_time;var d="",e,k;if(_.isNumber(b)){e=Math.floor(b/1440);0<e&&(k=1===e?a.DICT("Client_Statistics_Day"):a.DICT("Client_Statistics_Days"),d=e+" "+k);e=Math.floor(b/60)%24;if(0<e||d&&0===e)d&&(d+=", "),k=1>=e?a.DICT("Client_Statistics_Hour"):a.DICT("Client_Statistics_Hours"),d=d+e+" "+k;e=b%60;d&&(d+=", ");k=1>=e?a.DICT("Client_Statistics_Minute"):a.DICT("Client_Statistics_Minutes");b=d+e+" "+k}else b="-";g.active_time_str=b;r+=g.in_pkts;m+=g.out_pkts;c.applications.push(g)});c.in_pkts=r;
c.out_pkts=m;c.usage_pkts=c.in_pkts+c.out_pkts;c.usage_str=p(c.usage_pkts);c.orig_ip_group=c.ip_group;c.orig_os_type=c.os_type;c.orig_device_type=c.device_type;c.orig_hostname=c.hostname;d+=c.usage_pkts;sub_total=c.usage_pkts;s=z=y=0;angular.forEach(c.applications,function(a){0===sub_total?(a.usage_per_num=0,a.usage_per=0,a.usage_per_str="0%"):(a.usage_per_num=u(a.usage_pkts,sub_total,1,!1),a.usage_per=Math.floor(a.usage_per_num),z+=a.usage_per,s+=1,0===a.usage_per&&0!==a.usage_pkts?(y+=1,a.usage_per_str=
"<1%"):a.usage_per_str=a.usage_per+"%")});if(100!==z&&0!==sub_total)if(1===y&&2===s)angular.forEach(c.applications,function(a){0!==a.usage_pkts&&0!==a.usage_per&&(a.usage_per_str=">99%")});else{c.applications.sort(function(a,b){return b.usage_per_num-a.usage_per_num});h=c.applications;k=100-z;0!==y&&(k-=1);for(i=0;i<h.length&&k;i++)0<k&&0!==h[i].usage_pkts&&(h[i].usage_per+=1,h[i].usage_per_str=h[i].usage_per+"%",k-=1)}c.applications.sort(function(a,b){return a.application<b.application?-1:1});a.model.clients.push(c)});
s=y=z=0;angular.forEach(a.model.clients,function(a){0===d?(a.usage_per=0,a.usage_per_str="0%"):(a.usage_per_num=u(a.usage_pkts,d,1,!1),a.usage_per=Math.floor(a.usage_per_num),s+=1,z+=a.usage_per,0===a.usage_per&&0!==a.usage_pkts?(y+=1,a.usage_per_str="<1%"):a.usage_per_str=a.usage_per+"%")});a.model.clients.sort(function(a,b){return b.usage_per-a.usage_per});if(100!==z&&0!==d)if(1===y&&2===s)angular.forEach(a.model.clients,function(a){0!==a.usage_per&&0!==a.usage_pkts&&(a.usage_per_str=">99%")});
else{h=a.model.clients;k=100-z;0<y&&(k-=1);for(i=0;i<h.length&&k;i++)0<k&&0!==h[i].usage_pkts&&(h[i].usage_per+=1,h[i].usage_per_str=h[i].usage_per+"%",k-=1)}};var A=function(){a.model.g_ip_groups_list=[{id:0,name:"@none",displayName:a.DICT("Client_Statistics_None")}];angular.forEach(a.model.ip_groups,function(b){a.model.g_ip_groups_list.push({id:b.id,name:b.name||"",displayName:b.name||""})});angular.forEach(a.model.clients,function(b){b.ip_groups_list=a.model.g_ip_groups_list})},B=function(){var b=
{"@none":0};angular.forEach(a.model.g_ip_groups_list,function(a){b[a.name]=a.id});angular.forEach(a.model.clients,function(a){void 0===b[a.ip_group]&&(a.ip_group="@none");a.ip_group_id=b[a.ip_group]})},C=function(){setTimeout(function(){a.gridClientOptions.gridApi&&a.gridClientOptions.gridApi.customApi&&a.gridClientOptions.gridApi.customApi.checkSelectStatus()},50)},D=function(){var b;angular.forEach(a.model.clients,function(c){angular.forEach(c.applications,function(c){if(b=a.model.app_map[c.application])c.port=
b.port,c.flows=b.flows,c.protocol=b.protocol})})},E=function(){x=0;v.all([d(),g(),m.get()]).then(function(b){c(h(b,0));procClientData(h(b,1));z(h(b,1));y(h(b,1));a.model.device_types=b[2].device;a.model.os_types=b[2].os;a.ui_data.disabled_ipgroup_btns=!0;A();B();D();angular.forEach(a.model.clients,function(b){b.device_type_list=a.model.device_types;b.os_type_list=a.model.os_types[b.device_type]||[]});a.model.no_license||(a.gridIpGroupsOptions.data=a.model.ip_groups,a.gridClientOptions.data=a.model.clients);
C();a.ui_data.data_ready=!0;a.resetModified()})},I=function(){v.all([g()]).then(function(b){procClientData(h(b,0));z(h(b,0));D();angular.forEach(a.model.clients,function(b){b.device_type_list=a.model.device_types;b.os_type_list=a.model.os_types[b.device_type]||[]});a.gridClientOptions.data=a.model.clients;A();B();C()})};a.ui_data={max_ip_group_cnt:50,disabled_ipgroup_btns:!0,data_ready:!1,client_name:"",client_status:"",client_device_type:"",page:"main",ip_group_note:"",checked_clients:[],combineNote:a.DICT("Client_Statistics_Note",
{"%s":'<a id="link" ng-click="jumpToPage(\'Admin_License\')"><u>'+a.DICT("Here")+"</u></a>"})};a.ui_data.ip_group_note=a.DICT("Client_Statistics_IP_Group_Note",{"%s":"<a ng-click=\"jumpToPage('System_Config_IP_Address')\">"+a.DICT("Client_Statistics_Here")+"</a>"});a.model={no_license:!0,ip_groups:[],g_ip_groups_list:[],clients:[],device_types:[],os_types:{},def_device_type:"",mac2ipgroup_map:{},app_map:{},apps:[]};s=function(){a.ui_data.checked_clients=[];angular.forEach(a.model.clients,function(b){b.checked&&
a.ui_data.checked_clients.push(b)})};var F=function(b){var c={};angular.forEach(a.model.g_ip_groups_list,function(a){c[a.id]=a.name});angular.forEach(a.model.clients,function(a){void 0===c[a.ip_group_id]?(a.ip_group_id=0,a.ip_group="@none"):a.ip_group=c[a.ip_group_id]})};n=function(a){return function(b,c,d,e,g){return d.entity[a]===e.entity[a]?0:d.entity[a]>e.entity[a]?1:-1}};a.gridIpGroupsOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"name",displayName:a.DICT("Client_Statistics_Groupname"),
editRow:"edit",change:function(b){b=a.model.ip_groups;var c,d,e;angular.forEach(b,function(a){a.invalid=!1;"new"===a.type&&(a.disable=!1)});e=b.length;for(c=0;c<e;c++)for(d=c+1;d<e;d++)b[c].name===b[d].name&&(b[c].invalid=!0,b[d].invalid=!0,b[c].disable=!0,b[d].disable=!0);A();F()},invalidField:"invalid",required:!0,cellTemplate:q.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'uci-name maxlength="64" size="64"')},{field:"macsStr",displayName:a.DICT("Client_Statistics_Clients")}]});
a.gridClientOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:s,headerChangedCbk:s},{field:"mac",displayName:a.DICT("Client_Statistics_MAC_Address"),click:function(b,c){var d=c.entity;a.ui_data.client_title=d.ip_address||"";a.ui_data.client_name=d.hostname||"";a.ui_data.client_status=d.status||"";a.ui_data.client_device_type=d.device_type||"";a.ui_data.apps=d.applications;a.gridApplicationOptions.data=a.ui_data.apps;a.ui_data.page="sub"},cellTemplate:"UG_table_text_with_inline_href_click.html"},
{field:"ip_address",displayName:a.DICT("Client_Statistics_IPv4_IPv6_Address")},{field:"status",displayName:a.DICT("Client_Statistics_Status")},{field:"hostname",displayName:a.DICT("Client_Statistics_Hostname"),editRow:"edit",required:!0,cellTemplate:"UG_table_text_with_inline_edit.html"},{field:"device_type",displayName:a.DICT("Client_Statistics_Device_Type"),editRow:"edit",required:!0,changedCbk:function(b,c){var d=c.entity;a.model.os_types[d.device_type]&&(d.os_type_list=a.model.os_types[d.device_type],
d.os_type=m.get_default_os_type(d.os_type_list))},listField:"device_type_list",cellTemplate:"UG_table_select1_with_inline_edit.html"},{field:"os_type",displayName:a.DICT("Client_Statistics_OS_Type"),editRow:"edit",required:!0,listField:"os_type_list",cellTemplate:"UG_table_select1_with_inline_edit.html"},{field:"usage_per_str",displayName:a.DICT("Client_Statistics_Usage_Per"),sortingAlgorithm:n("usage_pkts")},{field:"ip_group_id",displayName:a.DICT("Client_Statistics_Ip_Group"),changedCbk:function(b,
c){var d=c.entity;angular.forEach(a.model.g_ip_groups_list,function(a){d.ip_group_id===a.id&&(d.ip_group=a.name)})},editRow:"edit",listField:"ip_groups_list",cellTemplate:"UG_table_select1_with_inline_edit.html"}]});a.gridApplicationOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"application",displayName:a.DICT("Client_Statistics_Destination")},{field:"protocol",displayName:a.DICT("Client_Statistics_Protocol"),width:100},{field:"port",displayName:a.DICT("Client_Statistics_Port"),width:80,
sortingAlgorithm:n("port")},{field:"usage_per_str",displayName:a.DICT("Client_Statistics_Usage_Per"),sortingAlgorithm:n("usage_pkts")},{field:"usage_str",displayName:a.DICT("Client_Statistics_Usage"),sortingAlgorithm:n("usage_pkts")},{field:"out_pkts_str",displayName:a.DICT("Client_Statistics_Sent"),sortingAlgorithm:n("out_pkts")},{field:"in_pkts_str",displayName:a.DICT("Client_Statistics_Received"),sortingAlgorithm:n("in_pkts")},{field:"active_time_str",displayName:a.DICT("Client_Statistics_Active_Time"),
sortingAlgorithm:n("active_time")}]});a.funs={addIpGroup:function(){if(a.model.ip_groups.length>=a.ui_data.max_ip_group_cnt)app.TOOLS.criticalAlertBox({msg:a.DICT("Client_Statistics_Reach_Max_Entry",{"%d":a.ui_data.max_ip_group_cnt}),cbk:function(){}});else{var b=k();x+=1;b.type="new";b.edit=!0;b.id=x;b.checked=!0;b.disable=!0;a.model.ip_groups.push(b);a.modified()}},editIpGroup:function(){angular.forEach(a.model.ip_groups,function(a){"new"===a.type&&igp.checked&&(a.edit=!0)})},delIpGroup:function(){var b=
a.model.ip_groups,c;for(c=b.length-1;0<=c;c--)"new"===b[c].type&&b[c].checked&&(angular.forEach(a.model.clients,function(a){a.ip_group_id===b[c].id&&(a.ip_group_id=0,a.ip_group="@none")}),b.splice(c,1),a.modified());A();B()},editClient:function(){angular.forEach(a.model.clients,function(a){a.checked&&(a.edit=!0)})},sub_cancel:function(){a.ui_data.page="main"},save:function(){var c,d=[],e,g,k={},h=[],l=!1,r=function(){h.length&&b.post({forcedUsingPost:!0,method:"set_ipgroup",params:{"ip-groups":{"ip-group":h}},
success:function(){E()},error:function(){E()}})};angular.forEach(a.model.ip_groups,function(a){"origin"!==a.type&&(k[a.name]||(k[a.name]=!0))});angular.forEach(a.model.clients,function(b){if(b.orig_hostname!==b.hostname||b.orig_os_type!==b.os_type||b.orig_device_type!==b.device_type)d.push({mac:b.mac,"device-type":b.device_type,"os-type":b.os_type,hostname:b.hostname}),l=!0;angular.forEach(a.model.ip_groups,function(a){g=a.macs;if(a.name===b.ip_group&&"@none"!==b.ip_group)exist=!1,angular.forEach(g,
function(a){a.mac===b.mac&&(exist=!0)}),exist||(k[a.name]=!0,a.macs.push({mac:b.mac,device_type:b.device_type,os_type:b.os_type}));else for(c=g.length-1;0<=c;c--)g[c].mac===b.mac&&(g.splice(c,1),k[a.name]=!0)})});angular.forEach(a.model.ip_groups,function(a){k[a.name]&&(e={name:a.name,macs:[]},angular.forEach(a.macs,function(a){e.macs.push({mac:a.mac,"device-type":a.device_type,"os-type":a.os_type})}),h.push(e),l=!0)});d.length?b.post({forcedUsingPost:!0,method:"action",params:{rpc:"update-clients",
input:{clients:d}},success:function(){r()},error:function(b){b=b&&b.output&&b.output.errstr||"";app.TOOLS.criticalAlertBox({msg:"<div>"+a.DICT("Client_Statistics_RPC_Error")+"</div><div>"+b+"</div>",cbk:function(){E()}})}}):r();l||E()},cancel:function(){E()},refresh_client:function(){I()},goback:e.goback};E()}]);app.controller("snmp_controller",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,s,n){a.success=!1;a.loadReady=!1;var v=a.password_flag=!1;a.trapPortFlag=!1;a.ruFlag=n.russia();a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var t=function(){return b.post({url:resource_base+"data/snmp.json",method:"get_snmp",success:function(a){m(a.data.result)},error:function(a){console.log("get snmp error")}})},m=function(b){b||(b={});var m=b.snmp||{},l=b["SNMPv2-MIB"]&&
b["SNMPv2-MIB"].system||{},h=(b["SNMP-COMMUNITY-MIB"]&&b["SNMP-COMMUNITY-MIB"].snmpCommunityTable||{}).snmpCommunityEntry||[],p=(b["SNMP-TARGET-MIB"]&&b["SNMP-TARGET-MIB"].snmpTargetAddrTable||{}).snmpTargetAddrEntry||[];b=(b["SNMP-USER-BASED-SM-MIB"]&&b["SNMP-USER-BASED-SM-MIB"].usmUserTable||{}).usmUserEntry||[];var n="v1",q={},r="",d="",c="",k="",g="",z={},y={},s="",t="",C,D=/^(\d+\.\d+\.\d+\.\d+).(\d+).(\d+)$/;C=/^(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+).(\d+)$/;
angular.forEach(m.snmpVersions,function(a,b){a&&(n=b)});"v2c"===n&&(n="v2");angular.forEach(p,function(a){a.snmpTargetAddrName===n&&(q=a)});if(q&&q.snmpTargetAddrTAddress)if(18===q.snmpTargetAddrTAddress.split(".").length){if(p=[],D="",C=C.exec(q.snmpTargetAddrTAddress)){p[0]="0";for(s=1;16>=s;s++)p[s]=parseInt(C[s],10).toString(16),1===p[s].length&&(p[s]="0"+p[s]);D=p[1]+p[2]+":"+p[3]+p[4]+":"+p[5]+p[6]+":"+p[7]+p[8]+":"+p[9]+p[10]+":"+p[11]+p[12]+":"+p[13]+p[14]+":"+p[15]+p[16];s=app.TOOLS.ipv6.toFullV6Addr(D);
s=app.TOOLS.ipv6.compress(s);t=256*parseInt(C[17],10)+parseInt(C[18],10)}}else if(C=D.exec(q.snmpTargetAddrTAddress))s=C[1],t=256*parseInt(C[2],10)+parseInt(C[3],10);angular.forEach(h,function(a,b){"private"===a.snmpCommunitySecurityName&&(d=a.snmpCommunityName||"",g=a.snmpCommunitySecurityName||"",c=a.snmpCommunityContextEngineID||"80:00:61:81:05:01");"public"===a.snmpCommunitySecurityName&&(r=a.snmpCommunityName||"",k=a.snmpCommunitySecurityName||"",c=a.snmpCommunityContextEngineID||"80:00:61:81:05:01")});
v=!1;angular.forEach(b,function(a){"admin"===a.usmUserName&&(z=a,v=!0);"guest"===a.usmUserName&&(y=a)});a.model.d={enabled:void 0!==m.enabled?m.enabled:!1,allow_access_from_wan:void 0!==m["allow-access-from-wan"]?m["allow-access-from-wan"]:!1,allow_access_from_vpn:void 0!==m["allow-access-from-vpn"]?m["allow-access-from-vpn"]:!1,version:n||"v1",system_name:l.sysName||"",system_contact:l.sysContact||"",system_location:l.sysLocation||"",get_community:r,set_community:d,engineID:c,get_securityName:k,
set_securityName:g,username:!0===v?"admin":"guest",v3:{guest:{usmUserEngineID:y.usmUserEngineID||"80:00:61:81:05:01",usmUserName:y.usmUserName||"guest",auth:y.usmUserAuthKey||"",auth_flag:!1,encryption:y.usmUserPrivKey||"",encryption_flag:!1,auth_alg:y.usmUserAuthProtocol||a.schema.auth_algs[0].id,encryption_alg:y.usmUserPrivProtocol||a.schema.ecr_algs[0].id},admin:{usmUserEngineID:z.usmUserEngineID||"80:00:61:81:05:01",usmUserName:z.usmUserName||"admin",auth:z.usmUserAuthKey||"",auth_flag:!1,encryption:z.usmUserPrivKey||
"",encryption_flag:!1,auth_alg:z.usmUserAuthProtocol||a.schema.auth_algs[0].id,encryption_alg:z.usmUserPrivProtocol||a.schema.ecr_algs[0].id}},trap_ip:s,trap_port:0===t?"":t}},q=function(){a.model=a.model||{};t();a.loadReady=!0;a.resetModified()};a.model={d:{}};a.schema={versions:[{displayName:"v1",id:"v1"},{displayName:"v2c",id:"v2"},{displayName:"v3",id:"v3"}],auth_algs:[{displayName:"None",id:"1.3.6.1.6.3.10.1.1.1"},{displayName:"MD5",id:"1.3.6.1.6.3.10.1.1.2"},{displayName:"SHA1",id:"1.3.6.1.6.3.10.1.1.3"}],
ecr_algs:[{displayName:"None",id:"1.3.6.1.6.3.10.1.2.1"},{displayName:"DES",id:"1.3.6.1.6.3.10.1.2.2"},{displayName:"AES",id:"1.3.6.1.6.3.10.1.2.4"}]};a.save=function(){var e=a.model.d,m="",l,h=[],p=0,n=[];l=[];var p="",s="1.3.6.1.6.1.1";if(""!==e.trap_ip&&0<=e.trap_ip.search(":")){p=createIpAddr().parse(e.trap_ip);s="1.3.6.1.2.1.100.1.2";for(m=0;8>m;m++)h[m]=p.parts[m].toString(16);for(m=0;8>m;m++)for(var p=h[m].length,r=0;r<4-p;r++)h[m]="0"+h[m];n[0]=h[0].substr(0,2);n[1]=h[0].substr(2,2);n[2]=
h[1].substr(0,2);n[3]=h[1].substr(2,2);n[4]=h[2].substr(0,2);n[5]=h[2].substr(2,2);n[6]=h[3].substr(0,2);n[7]=h[3].substr(2,2);n[8]=h[4].substr(0,2);n[9]=h[4].substr(2,2);n[10]=h[5].substr(0,2);n[11]=h[5].substr(2,2);n[12]=h[6].substr(0,2);n[13]=h[6].substr(2,2);n[14]=h[7].substr(0,2);n[15]=h[7].substr(2,2);for(m=0;16>m;m++)l[m]=parseInt(n[m],16).toString(10);p=l[0];for(m=1;16>m;m++)p=p+"."+l[m];if(""===e.trap_port||void 0===e.trap_port||null===e.trap_port)e.trap_port=162;l=e.trap_port%256;m=(e.trap_port-
l)/256;l=l.toString(10);m=m.toString(10);m=p+"."+m+"."+l}else if(""!==e.trap_ip){s="1.3.6.1.6.1.1";if(""===e.trap_port||void 0===e.trap_port||null===e.trap_port)e.trap_port=162;l=e.trap_port%256;m=(e.trap_port-l)/256;m=e.trap_ip+"."+m+"."+l}h="";h="guest"===e.username?"1.3.6.1.6.3.10.1.1.1"===e.v3.guest.auth_alg?"trap_target_v3_gu_noauthnopriv":"1.3.6.1.6.3.10.1.2.1"===e.v3.guest.encryption_alg?"trap_target_v3_gu_authnopriv":"trap_target_v3_gu_authpriv":"1.3.6.1.6.3.10.1.1.1"===e.v3.admin.auth_alg?
"trap_target_v3_ad_noauthnopriv":"1.3.6.1.6.3.10.1.2.1"===e.v3.admin.encryption_alg?"trap_target_v3_ad_authnopriv":"trap_target_v3_ad_authpriv";l={snmp:{enabled:e.enabled,snmpVersions:{v1:"v1"===e.version,v2c:"v2"===e.version,v3:"v3"===e.version},"allow-access-from-wan":e.allow_access_from_wan,"allow-access-from-vpn":e.allow_access_from_vpn},"SNMPv2-MIB":{system:{sysName:e.system_name,sysContact:e.system_contact,sysLocation:e.system_location}},"SNMP-TARGET-MIB":{snmpTargetAddrTable:{snmpTargetAddrEntry:[]}}};
""!==e.trap_ip&&"v1"===e.version?l["SNMP-TARGET-MIB"].snmpTargetAddrTable.snmpTargetAddrEntry.push({snmpTargetAddrName:e.version,snmpTargetAddrTAddress:m,snmpTargetAddrTDomain:s,snmpTargetAddrParams:"target_v1",snmpTargetAddrTimeout:1500,snmpTargetAddrRetryCount:3,snmpTargetAddrTagList:"std_v1_trap std_trap std_v1_inform std_inform",snmpTargetAddrStorageType:"nonVolatile",snmpTargetAddrEngineID:e.engineID,snmpTargetAddrTMask:"",snmpTargetAddrMMS:2048}):""!==e.trap_ip&&"v2"===e.version?l["SNMP-TARGET-MIB"].snmpTargetAddrTable.snmpTargetAddrEntry.push({snmpTargetAddrName:e.version,
snmpTargetAddrTAddress:m,snmpTargetAddrTDomain:s,snmpTargetAddrParams:"target_v2",snmpTargetAddrTimeout:1500,snmpTargetAddrRetryCount:3,snmpTargetAddrTagList:"std_v2_trap std_trap std_v2_inform std_inform",snmpTargetAddrStorageType:"nonVolatile",snmpTargetAddrEngineID:e.engineID,snmpTargetAddrTMask:"",snmpTargetAddrMMS:2048}):""!==e.trap_ip&&"v3"===e.version&&(l["SNMP-TARGET-MIB"].snmpTargetAddrTable.snmpTargetAddrEntry.push({snmpTargetAddrName:"v3",snmpTargetAddrTAddress:m,snmpTargetAddrTDomain:s,
snmpTargetAddrParams:h,snmpTargetAddrTimeout:1500,snmpTargetAddrRetryCount:3,snmpTargetAddrTagList:"std_v3_trap std_trap",snmpTargetAddrStorageType:"nonVolatile",snmpTargetAddrEngineID:e.engineID,snmpTargetAddrTMask:"",snmpTargetAddrMMS:2048}),l["SNMP-TARGET-MIB"].snmpTargetAddrTable.snmpTargetAddrEntry.push({snmpTargetAddrName:"v3.inform",snmpTargetAddrTAddress:m,snmpTargetAddrTDomain:s,snmpTargetAddrParams:"inform_target_v3",snmpTargetAddrTimeout:1500,snmpTargetAddrRetryCount:3,snmpTargetAddrTagList:"std_v3_inform std_inform",
snmpTargetAddrStorageType:"nonVolatile",snmpTargetAddrEngineID:e.engineID,snmpTargetAddrTMask:"",snmpTargetAddrMMS:2048}));"v3"!==e.version&&(s=[],e.set_community&&e.get_community&&(s.push({snmpCommunityIndex:"2",snmpCommunityName:e.set_community,snmpCommunitySecurityName:"private",snmpCommunityContextEngineID:e.engineID}),s.push({snmpCommunityIndex:"1",snmpCommunityName:e.get_community,snmpCommunitySecurityName:"public",snmpCommunityContextEngineID:e.engineID})),l["SNMP-COMMUNITY-MIB"]={snmpCommunityTable:{snmpCommunityEntry:s}});
s={usmUserSecurityName:"public",usmUserEngineID:e.v3.guest.usmUserEngineID,usmUserName:e.v3.guest.usmUserName,usmUserPrivProtocol:e.v3.guest.encryption_alg,usmUserAuthProtocol:e.v3.guest.auth_alg};m={usmUserSecurityName:"admin",usmUserEngineID:e.v3.admin.usmUserEngineID,usmUserName:e.v3.admin.usmUserName,usmUserPrivProtocol:e.v3.admin.encryption_alg,usmUserAuthProtocol:e.v3.admin.auth_alg};e.v3.guest.encryption_flag&&(s.usmUserPrivKey=e.v3.guest.encryption);e.v3.guest.auth_flag&&(s.usmUserAuthKey=
e.v3.guest.auth);e.v3.admin.encryption_flag&&(m.usmUserPrivKey=e.v3.admin.encryption);e.v3.admin.auth_flag&&(m.usmUserAuthKey=e.v3.admin.auth);"v3"===e.version&&!0===a.password_flag&&(l["SNMP-USER-BASED-SM-MIB"]={usmUserTable:{usmUserEntry:[]}},"guest"===e.username?l["SNMP-USER-BASED-SM-MIB"].usmUserTable.usmUserEntry.push(s):"admin"===e.username&&l["SNMP-USER-BASED-SM-MIB"].usmUserTable.usmUserEntry.push(m));b.post({method:"set_snmp",params:l,success:function(b){a.success=!0;a.password_flag=!1;q()},
error:function(a){q()}})};a.cancel=function(){q()};a.change_auth=function(){a.password_flag=!0;a.model.d.v3[a.model.d.username].auth_flag=!0};a.change_encryption=function(){a.password_flag=!0;a.model.d.v3[a.model.d.username].encryption_flag=!0};a.check_v3_password=function(){var b=a.model.d,m=b.username,l=/^([0-9A-Fa-f]{2}:)*([0-9A-Fa-f]{2})$/;"v3"!==b.version?(a.snmpform.v3_auth.$setValidity("illegal",!0),a.snmpform.v3_encryption.$setValidity("illegal",!0)):(b.v3[m].auth||a.snmpform.v3_auth.$setValidity("illegal",
!0),b.v3[m].encryption?l.exec(b.v3[m].encryption)?a.snmpform.v3_encryption.$setValidity("illegal",!0):a.snmpform.v3_encryption.$setValidity("illegal",!1):a.snmpform.v3_encryption.$setValidity("illegal",!0),b.v3[m].auth?l.exec(b.v3[m].auth)?a.snmpform.v3_auth.$setValidity("illegal",!0):a.snmpform.v3_auth.$setValidity("illegal",!1):a.snmpform.v3_auth.$setValidity("illegal",!0))};a.change_username=function(){a.password_flag=!0;a.model.d.v3[a.model.d.username].auth="";a.model.d.v3[a.model.d.username].encryption=
""};a.change_auth_method=function(){a.password_flag=!0;a.model.d.v3[a.model.d.username].auth="";!1===a.model.d.v3[a.model.d.username].encryption_flag&&(a.model.d.v3[a.model.d.username].encryption="")};a.change_encryption_method=function(){a.password_flag=!0;!1===a.model.d.v3[a.model.d.username].auth_flag&&(a.model.d.v3[a.model.d.username].auth="");a.model.d.v3[a.model.d.username].encryption=""};a.checkTrapPort=function(){a.trapPortFlag=!1;null!==a.model.d.trap_port&&void 0===a.model.d.trap_port&&
(a.trapPortFlag=!0)};q()}]);app.controller("PnPCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight",function(a,b,s,n,v){a.success=!1;a.dataReady=!1;var t=app.TOOLS.getResponse;a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var m=function(){return b.post({url:resource_base+"data/get_pnp_enabled_static.json",method:"get_pnp",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},q=function(){return b.post({url:resource_base+"data/cert2.json",procBackground:!0,
method:"get_ca_cert",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},e=function(b){b||(b={});var e=[];b["certs-state"]&&b["certs-state"].cert&&(e=b["certs-state"].cert);a.model.ca=[{id:"%default",displayName:a.DICT("PnP_Pre_Installed_CA_Bundles")}];angular.forEach(e,function(b){b.info&&b.info["is-ca-enabled"]&&a.model.ca.push({id:b.name,displayName:b.name})})},w=function(){s.all([m()]).then(function(b){(b=t(b,0))||(b={});var e={},m=!0;b.pnp&&(void 0!==b.pnp.enabled&&
(m=b.pnp.enabled),b.pnp.transport&&(e=b.pnp.transport));a.model.pnp={enabled:m,mode:"auto",type:e.type||"https",type_str:"-",address:e.address||"",port:e.port||443,ca_cert:"",orig_ca_cert:e["ca-certificate"]||"%default"};switch(a.model.pnp.type){case "https":a.model.pnp.type_str=a.DICT("PnP_HTTPS_Only")}switch(e.mode){case "static":a.model.pnp.mode="static"}l();a.resetModified();a.dataReady=!0})},l=function(){var b=!1,e=a.model.pnp.orig_ca_cert;a.getting_ca||!a.model.pnp.orig_ca_cert?a.model.pnp.ca_cert=
"":(angular.forEach(a.model.ca,function(a){a.id===e&&(b=!0)}),a.model.pnp.ca_cert=b?e:"%default")};a.schema={pnp_trans:[{id:"auto",displayName:a.DICT("PnP_Auto")},{id:"static",displayName:a.DICT("PnP_Static")}]};a.model={pnp:{},ca:[]};a.funs={save:function(){var e=a.model.pnp,l={mode:e.mode,port:e.port};switch(e.mode){case "static":$.extend(l,{type:"https",address:e.address,"ca-certificate":"%default"===e.ca_cert?"":e.ca_cert})}b.post({url:resource_base+"jsonrpc",method:"set_pnp",forcedUsingPost:!0,
params:{pnp:{enabled:e.enabled,transport:l}},success:function(b){a.success=!0;w()},error:function(a){w()}})},cancel:function(){w()}};(function(){a.getting_ca=!0;s.all([q()]).then(function(b){e(t(b,0));a.getting_ca=!1;l()})})();w()}]);app.controller("setupWizardCtrl",["$scope","MyHttp","wan_lib","$q","$cookies","UserSession","userAccessRight","$location","modelInfo","ngDialog","dt",function(a,b,s,n,v,t,m,q,e,w,l){var h=app.TOOLS.int2str2;a.board_current_date="";a.board_timezone="";a.userAccessFlag=m.get();a.destroy=!1;a.subnetObj={};a.ruFlag=m.russia();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var p=function(b){var c=app.TOOLS.get_scope("WizardCtrl");c&&c.funs.close_setup_wizard();b&&app.TOOLS.successAlertBox({title:a.DICT("Success"),
msg:a.DICT("Initial_Setup_Wizard_Setup_Success"),cbk:function(){app.TOOLS.jumpToPage("Status_System_Stats")}})},u=function(b){b||(b=[]);var c;a.model.intf_state={WAN1:{state:"down",phys_address:""},WAN2:{state:"down",phys_address:""}};var d="down";angular.forEach(b,function(b){d="down";c="";b.name&&b.name.match(/^WAN/)&&("WAN_PORT1"===b.name?c="WAN1":"WAN_PORT2"===b.name&&(c="WAN2"),c&&("Connected"===b.link_status&&(d="up"),a.model.intf_state[c].state=d),"WAN1"===b.name&&b.phys_address?a.model.intf_state.WAN1.phys_address=
b.phys_address:"WAN2"===b.name&&b.phys_address&&(a.model.intf_state.WAN2.phys_address=b.phys_address))})},x=function(){return b.post({url:resource_base+"data/aaa.json",method:"get_subnet",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},r=function(b){b.data&&(b.data.result&&b.data.result.subnets&&b.data.result.subnets.ipv4&&b.data.result.subnets.ipv6)&&(a.subnetObj=angular.copy(b.data.result.subnets))},d=function(){var b={},c=[{name:a.DICT("Initial_Setup_Wizard_Welcome"),
templateUrl:"step0.html"},{name:a.DICT("Initial_Setup_Wizard_Check_Connection_Order"),templateUrl:"step1.html"},{name:a.DICT("Initial_Setup_Wizard_Configure_Router"),templateUrl:"step2.html"},{name:a.DICT("Initial_Setup_Wizard_Configure_Router"),templateUrl:"step3.html"},{name:a.DICT("Initial_Setup_Wizard_Configure_Router"),templateUrl:"step4.html"},{name:a.DICT("Initial_Setup_Wizard_Configure_Router"),templateUrl:"step5.html"},{name:a.DICT("Initial_Setup_Wizard_Enable_Security"),templateUrl:"step6.html"},
{name:a.DICT("Initial_Setup_Wizard_Enable_Security"),templateUrl:"step7.html"}];a.model.has_wifi&&(c.push({name:a.DICT("Initial_Setup_Wizard_Enable_Security"),templateUrl:"step8.html"}),c.push({name:a.DICT("Initial_Setup_Wizard_Enable_Security"),templateUrl:"step9.html"}),c.push({name:a.DICT("Initial_Setup_Wizard_Enable_Security"),templateUrl:"step10.html"}));b={title:a.DICT("Initial_Setup_Wizard"),model:a.model,list:c,date:a.date};w.open({template:"setup_wizard_dialog.html",closeByDocument:!1,className:"ngdialog-theme-default wizard-page",
resolve:{obj:function(){return b}},controller:"setup_wizard_dialog_ctrl",preCloseCallback:function(b){!("$closeButton"===b||"close"===b)?a.funs.submit(b):p(!1)}});a.dataReady=!0},c=function(){return b.post({url:resource_base+"data/time.json",method:"get_time",error:function(a){Log(ERROR,"timeCtrl getData Error status: "+a.status)}})},k=function(){return b.post({url:resource_base+"data/time.json",method:"get_wifi_settings",error:function(a){Log(ERROR,"ssidCtrl getData Error status: "+a.status)}})},
g=function(b){b&&(b=b&&b.data&&b.data.result||{},a.board_current_date=b&&b["system-state"]&&b["system-state"].clock["current-datetime"]||"",a.board_timezone=b&&b.system&&b.system.clock["timezone-name"]||"",b=l.parser(a.board_current_date),a.model.d.current_datatime=new Date(b.year,b.month,b.day),a.model.d.hour=b.hour,a.model.d.minute=b.minute,a.model.d.second=b.second,a.model.d.timezone=a.board_timezone)},z=function(b){b&&(b=b&&b.data&&b.data.result||{},a.model.d.ssid=b.wlans&&b.wlans.ssid||{})},
y=function(){a.dataReady=!1;a.model.d=A();a.model.d.intf_status="loading";n.all([s.init({full_configure:!0}),s.get_wan_state(),c(),x(),k()]).then(function(b){u(b[1]||[]);angular.forEach(b[0][0],function(b){"WAN1"===b.name?a.model.d.orig_wan.wan1=b:"WAN2"===b.name&&(a.model.d.orig_wan.wan2=b)});a.model.pc_mac=b[0][2];g(b[2]);r(b[3]);z(b[4]);d()})},A=function(){for(var b=s.gen_wan_settings({name:"WAN1"}),c=new Date,d="1"===v.get("disable-startup"),e=c.getHours(),g=c.getMinutes(),k=c.getSeconds(),h=
a.model.schema.timezone[0]&&a.model.schema.timezone[0].tz||"",l="",m=0;8>m;m++)var r=Math.floor(68*Math.random()),l=l+"abcdefghijklmnopqrstuvwxyz!@#$%^&*()-+<>/\\ABCDEFGHIJKLMNOP1234567890".charAt(r);c={not_show_on_start_up:d,intf_status:"loading",wan:{},orig_wan:{},hour:e,minute:g,second:k,timezone:h,time_type:!0,current_datatime:c,mac_type:"default",custom_mac:"",router_password:"",confirm_router_password:"",disable_password_strength:!1,keep_current_password:!1,network_name:"",security_type:"aes",
security_key:l};b.ipv4.setting.confirm_password="";c.wan=b;return c};a.pageMap={};a.currPage=1;a.dataReady=!1;a.model={has_wifi:e.spec_WifiSupport(),intf_state:{},d:{},schema:{}};var B=function(c){var d=a.model.d;b.post({method:"set_time",params:{gui:{"disable-startup-page":d.not_show_on_start_up},system:{clock:{"timezone-name":d.timezone},ntp:{enabled:d.time_type}}},success:function(a){Log(DEBUG,"set time success");l.setTimezoneName(d.timezone);"function"===$.type(c)&&c()},error:function(a){Log(ERROR,
"set time error");Log(ERROR,a);"function"===$.type(c)&&c()}})},C=function(c){var d=a.model.d,e;!1===d.time_type?(e=d.hour,angular.forEach(Timezone,function(a){}),d=d.current_datatime.getYear()+1900+"-"+h(d.current_datatime.getMonth()+1)+"-"+h(d.current_datatime.getDate())+"T"+h(parseInt(e,10))+":"+h(parseInt(d.minute,10))+":"+h(parseInt(d.second,10)),b.post({method:"action",params:{rpc:"set-current-datetime",input:{"current-datetime":d}},success:function(a){Log(DEBUG,"set current datetime success");
"function"===$.type(c)&&c()},error:function(a){Log(INFO,"set current datetime error, should be skip");Log(INFO,a);"function"===$.type(c)&&c()}})):"function"===$.type(c)&&c()},D=function(){var c=a.model.d;c.keep_current_password?p(!0):b.post({method:"set_password_complexity",params:{"password-complexity":{enabled:!c.disable_password_strength}},success:function(a){E()},error:function(a){Log(ERROR,"set complexity error");Log(ERROR,a)}})},E=function(){var c=a.model.d,d=v.get("user");b.post({method:"change_password",
params:{name:d,password:c.router_password},success:function(b){if(b=b.data.result.code)switch(b){case 0:p(!0);break;case 1:app.TOOLS.successAlertBox({title:a.DICT("Success"),width:490,msg:a.DICT("Initial_Setup_Wizard_Setup_Success")+"<br/>"+a.DICT("Initial_Setup_Wizard_Need_Logout"),cbk:function(){t.logout();app.transition.In()}});break;default:app.TOOLS.criticalAlertBox({title:a.DICT("Failure"),msg:a.DICT("Initial_Setup_Wizard_New_Password_Incorrect"),cbk:function(b){b&&(a.currPage=8,a.resetModified())}})}},
error:function(a){Log(ERROR,"set user error");Log(ERROR,a)}})},I=function(){var c=a.model.d,d=c.ssid;app.TOOLS.get_scope("WizardCtrl");var e=!c.disable_password_strength&&""===c.router_password?!0:!1;d[0]||(d[0]={});d[0].ssid=c.network_name;d[0].enable=!0;"aes"===c.security_type?(d[0].security={"mode-enabled":"WPA2-Personal","WPA2-Personal":{"key-passphrase":c.security_key}},d[0].pmf="capable"):"no_security"===c.security_type&&(d[0].security={"mode-enabled":"None"},d[0].pmf="not-required");b.post({method:"set_wifi_settings",
params:{wlans:{ssid:d}},success:function(a){e?p(!0):D()},error:function(a){Log(ERROR,"set ssid error");Log(ERROR,a);p(!1)}})};a.funs={next:function(){switch(a.currPage){case 3:a.currPage="dynamic"===a.model.d.wan.ipv4.connectType?a.currPage+2:a.currPage+1;break;case 5:"custom"!==a.model.d.mac_type&&(a.model.d.custom_mac="");a.currPage+=1;break;default:a.currPage+=1}},back:function(){switch(a.currPage){case 5:a.currPage="dynamic"===a.model.d.wan.ipv4.connectType?a.currPage-2:a.currPage-1;break;case 3:a.currPage-=
1;break;default:a.currPage-=1}},cancel:function(){a.currPage=1;y();a.resetModified()},submit:function(b){var c=b.d.wan,d=b.d.orig_wan.wan1,e=b.d;a.model=b;Log(DEBUG,"Press submit");"WAN2"===e.wan.intf&&(d=a.model.d.orig_wan.wan2);"pc"===e.mac_type&&(c.mac_address_clone=!0,c.mac_address=a.model.pc_mac);"custom"===e.mac_type&&(c.mac_address_clone=!0,c.mac_address=a.model.d.custom_mac);switch(e.wan.ipv4.connectType){case "pptp":case "l2tp":e.wan.ipv4.physical="static"}e.wan.ipv4.setting.selectDemand=
!1;e.wan.ipv6=d.ipv6;e.wan.ipv4.setting.naming_server.servers[0].length&&(e.wan.ipv4.setting.peerdns=!1);C(function(){B(function(){n.all([s.set_wan_interface({orig:d,edit:c})]).then(function(b){v.put("disable-startup",e.not_show_on_start_up?"1":"0");app.TOOLS.get_scope("headerCtrl").enable_save_warning();a.model.has_wifi?I():D()})})})},done:function(){I()}};a.date={format:"yyyy-MM-dd",options:{formatYear:"yyyy",startingDay:0},disabled:function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},
importPCTime:function(){var b=new Date,c=b.getHours(),d=b.getMinutes();a.model.d.current_datatime=b;a.model.d.hour=c;a.model.d.minute=d;a.model.d.second=b.getSeconds()},minDate:null,opened:!1,open:function(){this.opened=!0}};(function(){var b,c,d={},e=[];a.pageMap=a.model.has_wifi?{1:"welcome",2:"check_connection",3:"connection_type",4:"setup_wan_proto",5:"date_time",6:"mac_address",7:"wan_summary",8:"set_security",9:"network_name",10:"wireless_network",11:"wireless_summary"}:{1:"welcome",2:"check_connection",
3:"connection_type",4:"setup_wan_proto",5:"date_time",6:"mac_address",7:"wan_summary",8:"set_security"};a.model.schema={intfs:[{id:"WAN1",displayName:"WAN1"},{id:"WAN2",displayName:"WAN2"}],timezone:[],hours:[],minutes:[],seconds:[]};for(b=0;24>b;b++)a.model.schema.hours.push({id:b,displayName:h(b)});for(b=0;60>b;b++)a.model.schema.minutes.push({id:b,displayName:h(b)}),a.model.schema.seconds.push({id:b,displayName:h(b)});Timezone.sort(function(a,b){return a.offset<b.offset?-1:a.offset>b.offset?1:
a.display<b.display?-1:a.display>b.display?1:0});angular.forEach(Timezone,function(a,b){a.is_cisco&&!d[a.cisco_display]&&(c=a.offset+1E3,e[c]||(e[c]=[]),d[a.cisco_display]=!0,e[c].push({tz:a.tz,display:a.cisco_display,offset:a.offset}))});a.model.schema.timezone=[];angular.forEach(e,function(b){b&&(b.sort(function(a,b){var c=a.display.match(/^\(UTC .\d+:\d+. (.*)/),d=b.display.match(/^\(UTC .\d+:\d+. (.*)/),c=c&&c[1]||"",d=d&&d[1]||"";return!c||!d?0:c<d?-1:c>d?1:0}),a.model.schema.timezone=a.model.schema.timezone.concat(b))})})();
y()}]);
app.controller("setup_wizard_dialog_ctrl",["$scope","addressPoolValidate","obj","wan_lib","userAccessRight","$q",function(a,b,s,n,v,t){var m=0;a.ruFlag=v.russia();var q=function(b){a.show_skip_btn=b.canSkip?!0:!1;a.show_submit_btn=a.current_step===a.step_list.length-1?!0:!1},e=function(){0!==m&&clearTimeout(m);app.TOOLS.get_scope("setupWizardCtrl")&&!a.destroy&&(1<a.current_step||(m=setTimeout(function(){m=0;t.all([n.get_wan_state({background:!0,isPolling:!0})]).then(function(b){w(b[0]||[]);a.change_interface();
e()})},5E3)))},w=function(b){b||(b=[]);var e;a.model.intf_state={WAN1:{state:"down",phys_address:""},WAN2:{state:"down",phys_address:""}};var m="down";angular.forEach(b,function(b){m="down";e="";b.name&&b.name.match(/^WAN/)&&("WAN_PORT1"===b.name?e="WAN1":"WAN_PORT2"===b.name&&(e="WAN2"),e&&("Connected"===b.link_status&&(m="up"),a.model.intf_state[e].state=m),"WAN1"===b.name&&b.phys_address?a.model.intf_state.WAN1.phys_address=b.phys_address:"WAN2"===b.name&&b.phys_address&&(a.model.intf_state.WAN2.phys_address=
b.phys_address))})};a.model=s.model;a.date=s.date;a.step_list=s.list||[];a.title=s.title||"";a.current_step=0;a.show_skip_btn=!1;a.show_submit_btn=!1;a.destroy=!1;a.errstr={network_name:""};a.ui_data={date_time_manually:a.DICT("Initial_Setup_Wizard_Set_Date_Time_Manually",{"%s":'<a ng-click="date.importPCTime()">'+a.DICT("Here")+"</a>"})};a.protoMap={dynamic:"DHCP","static":"Static IP Address",pppoe:"PPPoE",l2tp:"L2TP",pptp:"PPTP"};a.change_complexity=function(){a.model.d.disable_password_strength&&
app.TOOLS.warningAlertBox({msg:"Disabling password strength enforcement will increase your network security risk. Are you sure you want to disable password strength?",cbk:function(b){!1===b&&(a.model.d.disable_password_strength=!a.model.d.disable_password_strength)}})};a.ipv4Vali=function(){var e=!0,e=angular.copy(a.subnetObj.ipv4);return void 0===a.model.d.wan.ipv4.address.ip||""===a.model.d.wan.ipv4.address.ip||void 0===a.model.d.wan.ipv4.address.netmask||""===a.model.d.wan.ipv4.address.netmask||
void 0===e?!0:e=b.poolMaskValidate("wan",a.model.d.wan.intf,"ipv4",a.subnetObj,a.model.d.wan.ipv4.address.ip,a.model.d.wan.ipv4.address.netmask)};a.change_interface=function(){a.model.d.intf_status=a.model.intf_state[a.model.d.wan.intf].state;a.model.phys_address=a.model.intf_state[a.model.d.wan.intf].phys_address};a.check_password=function(){var b=a.model.d.wan.ipv4.setting;b.changed_password=!0;void 0==b.password||!b.password.length&&!b.confirm_password.length?(a.wizardform.password.$setValidity("not_same",
!0),a.wizardform.confirm_password.$setValidity("not_same",!0)):b.password!==b.confirm_password?(a.wizardform.password.$setValidity("not_same",!1),a.wizardform.confirm_password.$setValidity("not_same",!1)):(a.wizardform.password.$setValidity("not_same",!0),a.wizardform.confirm_password.$setValidity("not_same",!0))};a.chk_network_name=function(){var b=a.model.d,e=!1;angular.forEach(b.ssid,function(a){a.ssid===b.network_name&&(e=!0)});a.wizardform.step8.txt_netname.$setValidity("repeated",!e);a.errstr.network_name=
"Network Name(SSID): "+b.network_name+" already be used. Please input another name."};a.next=function(){var b=a.model.d.wan,e=0;switch(a.current_step){case 2:"dynamic"===b.ipv4.connectType&&(e=1)}a.current_step<a.step_list.length&&(a.current_step=a.current_step+1+e,q(a.step_list[a.current_step]))};a.back=function(){var b=a.model.d.wan,e=0;switch(a.current_step){case 4:"dynamic"===b.ipv4.connectType&&(e=-1)}0<a.current_step&&(a.current_step=a.current_step-1+e,q(a.step_list[a.current_step]))};a.submit=
function(){a.destroy=!0;a.closeThisDialog(a.model)};a.cancel=function(){a.destroy=!0;a.closeThisDialog("close")};a.$on("$destroy",function(){a.destroy=!0});e();a.change_interface()}]);var Timezone=[{tz:"Africa/Abidjan",display:"Africa/Abidjan",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Accra",display:"Africa/Accra",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Addis_Ababa",display:"Africa/Addis Ababa",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Algiers",display:"Africa/Algiers",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Asmara",display:"Africa/Asmara",
offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Asmera",display:"Africa/Asmera",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Bamako",display:"Africa/Bamako",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Bangui",display:"Africa/Bangui",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Banjul",display:"Africa/Banjul",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,
cisco_display:""},{tz:"Africa/Bissau",display:"Africa/Bissau",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Blantyre",display:"Africa/Blantyre",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Brazzaville",display:"Africa/Brazzaville",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Bujumbura",display:"Africa/Bujumbura",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Cairo",
display:"Africa/Cairo",offset:120,isdst:!1,abbr:"EET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Cairo"},{tz:"Africa/Casablanca",display:"Africa/Casablanca",offset:0,isdst:!0,abbr:"WET",abbr_dst:"WEST",is_cisco:!0,cisco_display:"(UTC +00:00) Casablanca"},{tz:"Africa/Ceuta",display:"Africa/Ceuta",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Conakry",display:"Africa/Conakry",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Dakar",
display:"Africa/Dakar",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Dar_es_Salaam",display:"Africa/Dar es_Salaam",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Djibouti",display:"Africa/Djibouti",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Douala",display:"Africa/Douala",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/El_Aaiun",display:"Africa/El Aaiun",offset:0,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Freetown",display:"Africa/Freetown",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Gaborone",display:"Africa/Gaborone",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Harare",display:"Africa/Harare",offset:120,isdst:!1,abbr:"CAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Harare, Pretoria"},{tz:"Africa/Johannesburg",display:"Africa/Johannesburg",offset:120,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Juba",display:"Africa/Juba",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Kampala",display:"Africa/Kampala",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Khartoum",display:"Africa/Khartoum",offset:120,isdst:!1,abbr:"CAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Khartoum"},{tz:"Africa/Kigali",display:"Africa/Kigali",offset:120,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Africa/Kinshasa",display:"Africa/Kinshasa",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Lagos",display:"Africa/Lagos",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Libreville",display:"Africa/Libreville",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Lome",display:"Africa/Lome",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Luanda",
display:"Africa/Luanda",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Lubumbashi",display:"Africa/Lubumbashi",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Lusaka",display:"Africa/Lusaka",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Malabo",display:"Africa/Malabo",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Maputo",display:"Africa/Maputo",offset:120,isdst:!1,
abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Maseru",display:"Africa/Maseru",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Mbabane",display:"Africa/Mbabane",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Mogadishu",display:"Africa/Mogadishu",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Monrovia",display:"Africa/Monrovia",offset:0,isdst:!1,abbr:"UTC",abbr_dst:"",is_cisco:!0,
cisco_display:"(UTC +00:00) Monrovia, Reykjavik"},{tz:"Africa/Nairobi",display:"Africa/Nairobi",offset:180,isdst:!1,abbr:"EAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Nairobi"},{tz:"Africa/Ndjamena",display:"Africa/Ndjamena",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Niamey",display:"Africa/Niamey",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Nouakchott",display:"Africa/Nouakchott",offset:0,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Africa/Ouagadougou",display:"Africa/Ouagadougou",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Porto-Novo",display:"Africa/Porto-Novo",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Sao_Tome",display:"Africa/Sao Tome",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Timbuktu",display:"Africa/Timbuktu",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Africa/Tripoli",display:"Africa/Tripoli",offset:120,isdst:!1,abbr:"EET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Tripoli"},{tz:"Africa/Tunis",display:"Africa/Tunis",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Africa/Windhoek",display:"Africa/Windhoek",offset:120,isdst:!0,abbr:"CAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Windhoek"},{tz:"America/Adak",display:"America/Adak",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Anchorage",display:"America/Anchorage",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Anguilla",display:"America/Anguilla",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Antigua",display:"America/Antigua",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Araguaina",display:"America/Araguaina",offset:-180,isdst:!1,abbr:"BRT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Araguaina"},
{tz:"America/Argentina/Buenos_Aires",display:"America/Argentina/Buenos Aires",offset:-180,isdst:!1,abbr:"ART",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) City of Buenos Aires"},{tz:"America/Argentina/Catamarca",display:"America/Argentina/Catamarca",offset:-180,isdst:!0,abbr:"WGT",abbr_dst:"WGST",is_cisco:!0,cisco_display:"(UTC -03:00) Greenland"},{tz:"America/Argentina/ComodRivadavia",display:"America/Argentina/ComodRivadavia",offset:-180,isdst:!1,abbr:"CLST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Punta Arenas"},
{tz:"America/Argentina/Cordoba",display:"America/Argentina/Cordoba",offset:-180,isdst:!1,abbr:"BRT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Salvador"},{tz:"America/Argentina/Jujuy",display:"America/Argentina/Jujuy",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/La_Rioja",display:"America/Argentina/La Rioja",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/Mendoza",display:"America/Argentina/Mendoza",
offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/Rio_Gallegos",display:"America/Argentina/Rio Gallegos",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/Salta",display:"America/Argentina/Salta",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/San_Juan",display:"America/Argentina/San Juan",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/San_Luis",
display:"America/Argentina/San Luis",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/Tucuman",display:"America/Argentina/Tucuman",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Argentina/Ushuaia",display:"America/Argentina/Ushuaia",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Aruba",display:"America/Aruba",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Asuncion",display:"America/Asuncion",offset:-240,isdst:!0,abbr:"PYT",abbr_dst:"PYST",is_cisco:!0,cisco_display:"(UTC -04:00) Asuncion"},{tz:"America/Atikokan",display:"America/Atikokan",offset:-300,isdst:!0,abbr:"EST",abbr_dst:"EDT",is_cisco:!0,cisco_display:"(UTC -05:00) Turks and Caicos"},{tz:"America/Atka",display:"America/Atka",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Bahia",display:"America/Bahia",offset:-180,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"America/Bahia_Banderas",display:"America/Bahia Banderas",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Barbados",display:"America/Barbados",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Belem",display:"America/Belem",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Belize",display:"America/Belize",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Blanc-Sablon",display:"America/Blanc-Sablon",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Boa_Vista",display:"America/Boa Vista",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Bogota",display:"America/Bogota",offset:-300,isdst:!1,abbr:"COT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -05:00) Bogota, Lima, Quito, Rio Branco"},{tz:"America/Boise",display:"America/Boise",offset:-420,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"America/Buenos_Aires",display:"America/Buenos Aires",offset:-180,isdst:!1,abbr:"ART",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) City of Buenos Aires"},{tz:"America/Cambridge_Bay",display:"America/Cambridge Bay",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Campo_Grande",display:"America/Campo Grande",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Cancun",display:"America/Cancun",
offset:-300,isdst:!1,abbr:"EST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -05:00) Chetumal"},{tz:"America/Caracas",display:"America/Caracas",offset:-240,isdst:!1,abbr:"VET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -04:00) Caracas"},{tz:"America/Catamarca",display:"America/Catamarca",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Cayenne",display:"America/Cayenne",offset:-180,isdst:!1,abbr:"GFT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Cayenne, Fortaleza"},
{tz:"America/Cayman",display:"America/Cayman",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Chicago",display:"America/Chicago",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Chihuahua",display:"America/Chihuahua",offset:-420,isdst:!0,abbr:"MST",abbr_dst:"MDT",is_cisco:!0,cisco_display:"(UTC -07:00) Chihuahua, La Paz, Mazatlan"},{tz:"America/Coral_Harbour",display:"America/Coral Harbour",offset:-300,isdst:!0,abbr:"EST",abbr_dst:"EDT",
is_cisco:!0,cisco_display:"(UTC -05:00) Haiti"},{tz:"America/Cordoba",display:"America/Cordoba",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Costa_Rica",display:"America/Costa Rica",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Creston",display:"America/Creston",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Cuiaba",display:"America/Cuiaba",offset:-240,isdst:!0,abbr:"AMT",abbr_dst:"AMST",
is_cisco:!0,cisco_display:"(UTC -04:00) Cuiaba"},{tz:"America/Curacao",display:"America/Curacao",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Danmarkshavn",display:"America/Danmarkshavn",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Dawson",display:"America/Dawson",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Dawson_Creek",display:"America/Dawson Creek",offset:-420,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"America/Denver",display:"America/Denver",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Detroit",display:"America/Detroit",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Dominica",display:"America/Dominica",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Edmonton",display:"America/Edmonton",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Eirunepe",display:"America/Eirunepe",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/El_Salvador",display:"America/El Salvador",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Ensenada",display:"America/Ensenada",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Fort_Nelson",display:"America/Fort Nelson",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Fort_Wayne",
display:"America/Fort Wayne",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Fortaleza",display:"America/Fortaleza",offset:-180,isdst:!1,abbr:"GFT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Cayenne, Fortaleza"},{tz:"America/Glace_Bay",display:"America/Glace Bay",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Godthab",display:"America/Godthab",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Goose_Bay",
display:"America/Goose Bay",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Grand_Turk",display:"America/Grand Turk",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Grenada",display:"America/Grenada",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Guadeloupe",display:"America/Guadeloupe",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Guatemala",display:"America/Guatemala",
offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Guayaquil",display:"America/Guayaquil",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Guyana",display:"America/Guyana",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Halifax",display:"America/Halifax",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Havana",display:"America/Havana",offset:-300,isdst:!0,abbr:"CST",
abbr_dst:"CDT",is_cisco:!0,cisco_display:"(UTC -05:00) Havana"},{tz:"America/Hermosillo",display:"America/Hermosillo",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Indianapolis",display:"America/Indiana/Indianapolis",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Knox",display:"America/Indiana/Knox",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Marengo",display:"America/Indiana/Marengo",
offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Petersburg",display:"America/Indiana/Petersburg",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Tell_City",display:"America/Indiana/Tell City",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Vevay",display:"America/Indiana/Vevay",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Vincennes",
display:"America/Indiana/Vincennes",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indiana/Winamac",display:"America/Indiana/Winamac",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Indianapolis",display:"America/Indianapolis",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Inuvik",display:"America/Inuvik",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Iqaluit",
display:"America/Iqaluit",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Jamaica",display:"America/Jamaica",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Jujuy",display:"America/Jujuy",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Juneau",display:"America/Juneau",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Kentucky/Louisville",display:"America/Kentucky/Louisville",
offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Kentucky/Monticello",display:"America/Kentucky/Monticello",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Knox_IN",display:"America/Knox IN",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Kralendijk",display:"America/Kralendijk",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/La_Paz",display:"America/La Paz",
offset:-240,isdst:!1,abbr:"GYT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -04:00) Georgetown, La Paz, Manaus, San Juan"},{tz:"America/Lima",display:"America/Lima",offset:-300,isdst:!1,abbr:"COT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -05:00) Bogota, Lima, Quito, Rio Branco"},{tz:"America/Los_Angeles",display:"America/Los Angeles",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Louisville",display:"America/Louisville",offset:-300,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"America/Lower_Princes",display:"America/Lower Princes",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Maceio",display:"America/Maceio",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Managua",display:"America/Managua",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Manaus",display:"America/Manaus",offset:-240,isdst:!1,abbr:"GYT",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Marigot",display:"America/Marigot",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Martinique",display:"America/Martinique",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Matamoros",display:"America/Matamoros",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Mazatlan",display:"America/Mazatlan",offset:-420,isdst:!0,abbr:"MST",abbr_dst:"MDT",is_cisco:!0,cisco_display:"(UTC -07:00) Chihuahua, La Paz, Mazatlan"},
{tz:"America/Mendoza",display:"America/Mendoza",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Menominee",display:"America/Menominee",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Merida",display:"America/Merida",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Metlakatla",display:"America/Metlakatla",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Mexico_City",
display:"America/Mexico City",offset:-360,isdst:!0,abbr:"CST",abbr_dst:"CDT",is_cisco:!0,cisco_display:"(UTC -06:00) Guadalajara, Mexico City, Monterrey"},{tz:"America/Miquelon",display:"America/Miquelon",offset:-180,isdst:!0,abbr:"PMST",abbr_dst:"PMDT",is_cisco:!0,cisco_display:"(UTC -03:00) Saint Pierre and Miquelon"},{tz:"America/Moncton",display:"America/Moncton",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Monterrey",display:"America/Monterrey",offset:-360,
isdst:!0,abbr:"CST",abbr_dst:"CDT",is_cisco:!0,cisco_display:"(UTC -06:00) Guadalajara, Mexico City, Monterrey"},{tz:"America/Montevideo",display:"America/Montevideo",offset:-180,isdst:!1,abbr:"UYT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -03:00) Montevideo"},{tz:"America/Montreal",display:"America/Montreal",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Montserrat",display:"America/Montserrat",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Nassau",display:"America/Nassau",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/New_York",display:"America/New York",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Nipigon",display:"America/Nipigon",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Nome",display:"America/Nome",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Noronha",display:"America/Noronha",
offset:-120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/North_Dakota/Beulah",display:"America/North Dakota/Beulah",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/North_Dakota/Center",display:"America/North Dakota/Center",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/North_Dakota/New_Salem",display:"America/North Dakota/New_Salem",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Ojinaga",display:"America/Ojinaga",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Panama",display:"America/Panama",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Pangnirtung",display:"America/Pangnirtung",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Paramaribo",display:"America/Paramaribo",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Phoenix",
display:"America/Phoenix",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Port_of_Spain",display:"America/Port of_Spain",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Port-au-Prince",display:"America/Port-au-Prince",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Porto_Acre",display:"America/Porto Acre",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Porto_Velho",
display:"America/Porto Velho",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Puerto_Rico",display:"America/Puerto Rico",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Rainy_River",display:"America/Rainy River",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Rankin_Inlet",display:"America/Rankin Inlet",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Recife",
display:"America/Recife",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Regina",display:"America/Regina",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Resolute",display:"America/Resolute",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Rio_Branco",display:"America/Rio Branco",offset:-300,isdst:!1,abbr:"COT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -05:00) Bogota, Lima, Quito, Rio Branco"},
{tz:"America/Rosario",display:"America/Rosario",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Santa_Isabel",display:"America/Santa Isabel",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Santarem",display:"America/Santarem",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Santiago",display:"America/Santiago",offset:-240,isdst:!0,abbr:"CLT",abbr_dst:"CLST",is_cisco:!0,cisco_display:"(UTC -04:00) Santiago"},
{tz:"America/Santo_Domingo",display:"America/Santo Domingo",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Sao_Paulo",display:"America/Sao Paulo",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Scoresbysund",display:"America/Scoresbysund",offset:-60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Shiprock",display:"America/Shiprock",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"America/Sitka",display:"America/Sitka",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Barthelemy",display:"America/St Barthelemy",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Johns",display:"America/St Johns",offset:-210,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Kitts",display:"America/St Kitts",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Lucia",
display:"America/St Lucia",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Thomas",display:"America/St Thomas",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/St_Vincent",display:"America/St Vincent",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Swift_Current",display:"America/Swift Current",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Tegucigalpa",
display:"America/Tegucigalpa",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Thule",display:"America/Thule",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Thunder_Bay",display:"America/Thunder Bay",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Tijuana",display:"America/Tijuana",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Toronto",display:"America/Toronto",
offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Tortola",display:"America/Tortola",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Vancouver",display:"America/Vancouver",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Virgin",display:"America/Virgin",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Whitehorse",display:"America/Whitehorse",offset:-480,isdst:!1,
abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Winnipeg",display:"America/Winnipeg",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Yakutat",display:"America/Yakutat",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"America/Yellowknife",display:"America/Yellowknife",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Casey",display:"Antarctica/Casey",offset:660,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Antarctica/Davis",display:"Antarctica/Davis",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/DumontDUrville",display:"Antarctica/DumontDUrville",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Macquarie",display:"Antarctica/Macquarie",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Mawson",display:"Antarctica/Mawson",offset:300,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Antarctica/McMurdo",display:"Antarctica/McMurdo",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Palmer",display:"Antarctica/Palmer",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Rothera",display:"Antarctica/Rothera",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/South_Pole",display:"Antarctica/South Pole",offset:720,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Antarctica/Syowa",display:"Antarctica/Syowa",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Troll",display:"Antarctica/Troll",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Antarctica/Vostok",display:"Antarctica/Vostok",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Arctic/Longyearbyen",display:"Arctic/Longyearbyen",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Asia/Aden",display:"Asia/Aden",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Pyongyang",display:"Asia/Pyongyang",offset:510,isdst:!1,abbr:"PYT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:30) Pyongyang"},{tz:"Asia/Almaty",display:"Asia/Almaty",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Amman",display:"Asia/Amman",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Amman"},{tz:"Asia/Anadyr",
display:"Asia/Anadyr",offset:720,isdst:!1,abbr:"ANAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +12:00) Anadyr, Petropavlovsk-Kamchatsky"},{tz:"Asia/Aqtau",display:"Asia/Aqtau",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Aqtobe",display:"Asia/Aqtobe",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Ashgabat",display:"Asia/Ashgabat",offset:300,isdst:!1,abbr:"TMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:00) Ashgabat, Tashkent"},
{tz:"Asia/Ashkhabad",display:"Asia/Ashkhabad",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Atyrau",display:"Asia/Atyrau",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Baghdad",display:"Asia/Baghdad",offset:180,isdst:!1,abbr:"AST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Baghdad"},{tz:"Asia/Bahrain",display:"Asia/Bahrain",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Baku",display:"Asia/Baku",
offset:240,isdst:!1,abbr:"AZT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Baku"},{tz:"Asia/Bangkok",display:"Asia/Bangkok",offset:420,isdst:!1,abbr:"ICT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Bangkok, Hanoi, Jakarta"},{tz:"Asia/Barnaul",display:"Asia/Barnaul",offset:420,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Barnaul, Gorno-Altaysk"},{tz:"Asia/Beirut",display:"Asia/Beirut",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Beirut"},
{tz:"Asia/Bishkek",display:"Asia/Bishkek",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Brunei",display:"Asia/Brunei",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Calcutta",display:"Asia/Calcutta",offset:330,isdst:!1,abbr:"IST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:30) Sri Jayawardenapura"},{tz:"Asia/Chita",display:"Asia/Chita",offset:540,isdst:!1,abbr:"YAKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:00) Chita"},
{tz:"Asia/Choibalsan",display:"Asia/Choibalsan",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Chongqing",display:"Asia/Chongqing",offset:480,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Beijing, Chongqing, Hong Kong, Urumqi"},{tz:"Asia/Chungking",display:"Asia/Chungking",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Colombo",display:"Asia/Colombo",offset:330,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Asia/Dacca",display:"Asia/Dacca",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Damascus",display:"Asia/Damascus",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Damascus"},{tz:"Asia/Dhaka",display:"Asia/Dhaka",offset:360,isdst:!1,abbr:"BST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +06:00) Dhaka"},{tz:"Asia/Dili",display:"Asia/Dili",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Dubai",
display:"Asia/Dubai",offset:240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Dushanbe",display:"Asia/Dushanbe",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Famagusta",display:"Asia/Famagusta",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Gaza",display:"Asia/Gaza",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Gaza, Hebron"},{tz:"Asia/Harbin",display:"Asia/Harbin",offset:480,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Hebron",display:"Asia/Hebron",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Gaza, Hebron"},{tz:"Asia/Ho_Chi_Minh",display:"Asia/Ho Chi_Minh",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Hong_Kong",display:"Asia/Hong Kong",offset:480,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Beijing, Chongqing, Hong Kong, Urumqi"},{tz:"Asia/Hovd",
display:"Asia/Hovd",offset:420,isdst:!0,abbr:"HOVT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Hovd"},{tz:"Asia/Irkutsk",display:"Asia/Irkutsk",offset:480,isdst:!1,abbr:"IRKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Irkutsk"},{tz:"Asia/Istanbul",display:"Asia/Istanbul",offset:180,isdst:!1,abbr:"TRT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Istanbul"},{tz:"Asia/Jakarta",display:"Asia/Jakarta",offset:420,isdst:!1,abbr:"ICT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Bangkok, Hanoi, Jakarta"},
{tz:"Asia/Jayapura",display:"Asia/Jayapura",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Jerusalem",display:"Asia/Jerusalem",offset:120,isdst:!0,abbr:"IST",abbr_dst:"IDT",is_cisco:!0,cisco_display:"(UTC +02:00) Jerusalem"},{tz:"Asia/Kabul",display:"Asia/Kabul",offset:270,isdst:!1,abbr:"AFT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:30) Kabul"},{tz:"Asia/Kamchatka",display:"Asia/Kamchatka",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Asia/Karachi",display:"Asia/Karachi",offset:300,isdst:!1,abbr:"PKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:00) Islamabad, Karachi"},{tz:"Asia/Kashgar",display:"Asia/Kashgar",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Kathmandu",display:"Asia/Kathmandu",offset:345,isdst:!1,abbr:"NPT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:45) Kathmandu"},{tz:"Asia/Katmandu",display:"Asia/Katmandu",offset:345,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Asia/Khandyga",display:"Asia/Khandyga",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Kolkata",display:"Asia/Kolkata",offset:330,isdst:!1,abbr:"IST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:30) Chennai, Kolkata, Mumbai, New Delhi"},{tz:"Asia/Krasnoyarsk",display:"Asia/Krasnoyarsk",offset:420,isdst:!1,abbr:"KRAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Krasnoyarsk"},{tz:"Asia/Kuala_Lumpur",display:"Asia/Kuala Lumpur",offset:480,isdst:!1,abbr:"SGT",
abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Kuala Lumpur, Singapore"},{tz:"Asia/Kuching",display:"Asia/Kuching",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Kuwait",display:"Asia/Kuwait",offset:180,isdst:!1,abbr:"AST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Kuwait, Riyadh"},{tz:"Asia/Macao",display:"Asia/Macao",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Macau",display:"Asia/Macau",offset:480,isdst:!1,abbr:"",
abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Magadan",display:"Asia/Magadan",offset:660,isdst:!1,abbr:"MAGT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Magadan"},{tz:"Asia/Makassar",display:"Asia/Makassar",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Manila",display:"Asia/Manila",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Muscat",display:"Asia/Muscat",offset:240,isdst:!1,abbr:"GST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Abu Dhabi, Muscat"},
{tz:"Asia/Nicosia",display:"Asia/Nicosia",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Novokuznetsk",display:"Asia/Novokuznetsk",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Novosibirsk",display:"Asia/Novosibirsk",offset:420,isdst:!1,abbr:"NOVT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Novosibirsk"},{tz:"Asia/Omsk",display:"Asia/Omsk",offset:360,isdst:!1,abbr:"OMST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +06:00) Omsk"},
{tz:"Asia/Oral",display:"Asia/Oral",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Phnom_Penh",display:"Asia/Phnom Penh",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Pontianak",display:"Asia/Pontianak",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Pyongyang",display:"Asia/Pyongyang",offset:540,isdst:!1,abbr:"PYT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:00) Pyongyang"},{tz:"Asia/Qatar",display:"Asia/Qatar",
offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Qyzylorda",display:"Asia/Qyzylorda",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Rangoon",display:"Asia/Rangoon",offset:390,isdst:!1,abbr:"MMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +06:30) Yangon (Rangoon)"},{tz:"Asia/Riyadh",display:"Asia/Riyadh",offset:180,isdst:!1,abbr:"AST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Kuwait, Riyadh"},{tz:"Asia/Saigon",display:"Asia/Saigon",
offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Sakhalin",display:"Asia/Sakhalin",offset:660,isdst:!1,abbr:"SAKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Sakhalin"},{tz:"Asia/Samarkand",display:"Asia/Samarkand",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Seoul",display:"Asia/Seoul",offset:540,isdst:!1,abbr:"KST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:00) Seoul"},{tz:"Asia/Shanghai",display:"Asia/Shanghai",offset:480,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Singapore",display:"Asia/Singapore",offset:480,isdst:!1,abbr:"SGT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Kuala Lumpur, Singapore"},{tz:"Asia/Srednekolymsk",display:"Asia/Srednekolymsk",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Taipei",display:"Asia/Taipei",offset:480,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Taipei"},{tz:"Asia/Tashkent",display:"Asia/Tashkent",
offset:300,isdst:!1,abbr:"TMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:00) Ashgabat, Tashkent"},{tz:"Asia/Tbilisi",display:"Asia/Tbilisi",offset:240,isdst:!1,abbr:"GET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Tbilisi"},{tz:"Asia/Tehran",display:"Asia/Tehran",offset:210,isdst:!0,abbr:"IRST",abbr_dst:"IRDT",is_cisco:!0,cisco_display:"(UTC +03:30) Tehran"},{tz:"Asia/Tel_Aviv",display:"Asia/Tel Aviv",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Thimbu",
display:"Asia/Thimbu",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Thimphu",display:"Asia/Thimphu",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Tokyo",display:"Asia/Tokyo",offset:540,isdst:!1,abbr:"JST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:00) Osaka, Sapporo, Tokyo"},{tz:"Asia/Tomsk",display:"Asia/Tomsk",offset:420,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +07:00) Tomsk"},{tz:"Asia/Ujung_Pandang",
display:"Asia/Ujung Pandang",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Ulaanbaatar",display:"Asia/Ulaanbaatar",offset:480,isdst:!0,abbr:"ULAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Ulaanbaatar"},{tz:"Asia/Ulan_Bator",display:"Asia/Ulan Bator",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Urumqi",display:"Asia/Urumqi",offset:360,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Ust-Nera",display:"Asia/Ust-Nera",
offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Vientiane",display:"Asia/Vientiane",offset:420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Vladivostok",display:"Asia/Vladivostok",offset:600,isdst:!1,abbr:"VLAT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +10:00) Vladivostok"},{tz:"Asia/Yakutsk",display:"Asia/Yakutsk",offset:540,isdst:!1,abbr:"YAKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:00) Yakutsk"},{tz:"Asia/Yangon",display:"Asia/Yangon",
offset:390,isdst:!1,abbr:"MMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +06:30) Yangon (Rangoon)"},{tz:"Asia/Yekaterinburg",display:"Asia/Yekaterinburg",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Asia/Yerevan",display:"Asia/Yerevan",offset:240,isdst:!1,abbr:"AMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Yerevan"},{tz:"Atlantic/Azores",display:"Atlantic/Azores",offset:-60,isdst:!0,abbr:"AZOT",abbr_dst:"AZOST",is_cisco:!0,cisco_display:"(UTC -01:00) Azores"},
{tz:"Atlantic/Bermuda",display:"Atlantic/Bermuda",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Canary",display:"Atlantic/Canary",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Cape_Verde",display:"Atlantic/Cape Verde",offset:-60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Faeroe",display:"Atlantic/Faeroe",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Faroe",display:"Atlantic/Faroe",
offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Jan_Mayen",display:"Atlantic/Jan Mayen",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Madeira",display:"Atlantic/Madeira",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Reykjavik",display:"Atlantic/Reykjavik",offset:0,isdst:!1,abbr:"UTC",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +00:00) Monrovia, Reykjavik"},{tz:"Atlantic/South_Georgia",display:"Atlantic/South Georgia",
offset:-120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/St_Helena",display:"Atlantic/St Helena",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Atlantic/Stanley",display:"Atlantic/Stanley",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/ACT",display:"Australia/ACT",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Adelaide",display:"Australia/Adelaide",offset:570,isdst:!0,
abbr:"ACST",abbr_dst:"ACDT",is_cisco:!0,cisco_display:"(UTC +09:30) Adelaide"},{tz:"Australia/Brisbane",display:"Australia/Brisbane",offset:600,isdst:!1,abbr:"AEST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +10:00) Brisbane"},{tz:"Australia/Broken_Hill",display:"Australia/Broken Hill",offset:570,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Canberra",display:"Australia/Canberra",offset:600,isdst:!0,abbr:"AEST",abbr_dst:"AEDT",is_cisco:!0,cisco_display:"(UTC +10:00) Canberra, Melbourne, Sydney"},
{tz:"Australia/Currie",display:"Australia/Currie",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Darwin",display:"Australia/Darwin",offset:570,isdst:!1,abbr:"ACST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +09:30) Darwin"},{tz:"Australia/Eucla",display:"Australia/Eucla",offset:525,isdst:!1,abbr:"ACWST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:45) Eucla"},{tz:"Australia/Hobart",display:"Australia/Hobart",offset:600,isdst:!0,abbr:"AEST",abbr_dst:"AEDT",
is_cisco:!0,cisco_display:"(UTC +10:00) Hobart"},{tz:"Australia/LHI",display:"Australia/LHI",offset:630,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Lindeman",display:"Australia/Lindeman",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Lord_Howe",display:"Australia/Lord Howe",offset:630,isdst:!0,abbr:"LHST",abbr_dst:"LHDT",is_cisco:!0,cisco_display:"(UTC +10:30) Lord Howe Island"},{tz:"Australia/Melbourne",display:"Australia/Melbourne",
offset:600,isdst:!0,abbr:"AEST",abbr_dst:"AEDT",is_cisco:!0,cisco_display:"(UTC +10:00) Canberra, Melbourne, Sydney"},{tz:"Australia/North",display:"Australia/North",offset:570,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/NSW",display:"Australia/NSW",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Perth",display:"Australia/Perth",offset:480,isdst:!1,abbr:"AWST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +08:00) Perth"},{tz:"Australia/Queensland",
display:"Australia/Queensland",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/South",display:"Australia/South",offset:570,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Sydney",display:"Australia/Sydney",offset:600,isdst:!0,abbr:"AEST",abbr_dst:"AEDT",is_cisco:!0,cisco_display:"(UTC +10:00) Canberra, Melbourne, Sydney"},{tz:"Australia/Tasmania",display:"Australia/Tasmania",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Australia/Victoria",display:"Australia/Victoria",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/West",display:"Australia/West",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Australia/Yancowinna",display:"Australia/Yancowinna",offset:570,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Brazil/Acre",display:"Brazil/Acre",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Brazil/DeNoronha",
display:"Brazil/DeNoronha",offset:-120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Brazil/East",display:"Brazil/East",offset:-180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Brazil/West",display:"Brazil/West",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Canada/Atlantic",display:"Canada/Atlantic",offset:-240,isdst:!0,abbr:"AST",abbr_dst:"AT",is_cisco:!0,cisco_display:"(UTC -04:00) Atlantic Time (Canada)"},{tz:"Canada/Central",display:"Canada/Central",
offset:-360,isdst:!0,abbr:"CST",abbr_dst:"CDT",is_cisco:!0,cisco_display:"(UTC -06:00) Central Time (US & Canada)"},{tz:"Canada/Eastern",display:"Canada/Eastern",offset:-300,isdst:!0,abbr:"EST",abbr_dst:"EDT",is_cisco:!0,cisco_display:"(UTC -05:00) Eastern Time (US & Canada)"},{tz:"Canada/East-Saskatchewan",display:"Canada/East-Saskatchewan",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Canada/Mountain",display:"Canada/Mountain",offset:-420,isdst:!0,abbr:"MST",abbr_dst:"MDT",
is_cisco:!0,cisco_display:"(UTC -07:00) Mountain Time (US & Canada)"},{tz:"Canada/Newfoundland",display:"Canada/Newfoundland",offset:-210,isdst:!0,abbr:"NST",abbr_dst:"NDT",is_cisco:!0,cisco_display:"(UTC -03:30) Newfoundland"},{tz:"Canada/Pacific",display:"Canada/Pacific",offset:-480,isdst:!0,abbr:"PST",abbr_dst:"PDT",is_cisco:!0,cisco_display:"(UTC -08:00) Pacific Time (US & Canada)"},{tz:"Canada/Saskatchewan",display:"Canada/Saskatchewan",offset:-360,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!0,
cisco_display:"(UTC -06:00) Saskatchewan"},{tz:"Canada/Yukon",display:"Canada/Yukon",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"CET",display:"CET",offset:60,isdst:!1,abbr:"CET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +01:00) West Central Africa"},{tz:"Chile/Continental",display:"Chile/Continental",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Chile/EasterIsland",display:"Chile/EasterIsland",offset:-360,isdst:!0,abbr:"EAST",abbr_dst:"EASST",
is_cisco:!0,cisco_display:"(UTC -06:00) Easter Island"},{tz:"CST6CDT",display:"CST6CDT",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Cuba",display:"Cuba",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"EET",display:"EET",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Egypt",display:"Egypt",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Eire",display:"Eire",offset:0,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"EST",display:"EST",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"EST5EDT",display:"EST5EDT",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT",display:"Etc/GMT",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+0",display:"Etc/GMT+0",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+1",display:"Etc/GMT+1",offset:-60,isdst:!1,abbr:"CVT",abbr_dst:"",
is_cisco:!0,cisco_display:"(UTC -01:00) Cabo Verde Is."},{tz:"Etc/GMT+10",display:"Etc/GMT+10",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+11",display:"Etc/GMT+11",offset:-660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -11:00) Coordinated Universal Time-11"},{tz:"Etc/GMT+12",display:"Etc/GMT+12",offset:-720,isdst:!1,abbr:"DST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -12:00) International Date Line West"},{tz:"Etc/GMT+2",display:"Etc/GMT+2",
offset:-120,isdst:!1,abbr:"FNT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -02:00) Coordinated Universal Time-02"},{tz:"Etc/GMT+3",display:"Etc/GMT+3",offset:-180,isdst:!0,abbr:"BRT",abbr_dst:"BRST",is_cisco:!0,cisco_display:"(UTC -03:00) Brasilia"},{tz:"Etc/GMT+4",display:"Etc/GMT+4",offset:-240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+5",display:"Etc/GMT+5",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+6",display:"Etc/GMT+6",
offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+7",display:"Etc/GMT+7",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT+8",display:"Etc/GMT+8",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -08:00) Coordinated Universal Time-08"},{tz:"Etc/GMT+9",display:"Etc/GMT+9",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT0",display:"Etc/GMT0",offset:0,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-0",display:"Etc/GMT-0",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-1",display:"Etc/GMT-1",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-10",display:"Etc/GMT-10",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-11",display:"Etc/GMT-11",offset:660,isdst:!1,abbr:"SRET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Chokurdakh"},{tz:"Etc/GMT-12",display:"Etc/GMT-12",
offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-13",display:"Etc/GMT-13",offset:780,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +13:00) Coordinated Universal Time+13"},{tz:"Etc/GMT-14",display:"Etc/GMT-14",offset:840,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-2",display:"Etc/GMT-2",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-3",display:"Etc/GMT-3",offset:180,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-4",display:"Etc/GMT-4",offset:240,isdst:!1,abbr:"MUT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Port Louis"},{tz:"Etc/GMT-5",display:"Etc/GMT-5",offset:300,isdst:!1,abbr:"YEKT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +05:00) Ekaterinburg"},{tz:"Etc/GMT-6",display:"Etc/GMT-6",offset:360,isdst:!1,abbr:"ALMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +06:00) Astana"},{tz:"Etc/GMT-7",display:"Etc/GMT-7",offset:420,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-8",display:"Etc/GMT-8",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/GMT-9",display:"Etc/GMT-9",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/Greenwich",display:"Etc/Greenwich",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/UCT",display:"Etc/UCT",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/Universal",display:"Etc/Universal",offset:0,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/UTC",display:"Etc/UTC",offset:0,isdst:!1,abbr:"UTC",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Etc/Zulu",display:"Etc/Zulu",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Amsterdam",display:"Europe/Amsterdam",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},{tz:"Europe/Andorra",display:"Europe/Andorra",offset:60,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Astrakhan",display:"Europe/Astrakhan",offset:240,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Astrakhan, Ulyanovsk"},{tz:"Europe/Athens",display:"Europe/Athens",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Athens, Bucharest"},{tz:"Europe/Belfast",display:"Europe/Belfast",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Belgrade",
display:"Europe/Belgrade",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague"},{tz:"Europe/Berlin",display:"Europe/Berlin",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},{tz:"Europe/Bratislava",display:"Europe/Bratislava",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague"},
{tz:"Europe/Brussels",display:"Europe/Brussels",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Brussels, Copenhagen, Madrid, Paris"},{tz:"Europe/Bucharest",display:"Europe/Bucharest",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Athens, Bucharest"},{tz:"Europe/Budapest",display:"Europe/Budapest",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague"},
{tz:"Europe/Busingen",display:"Europe/Busingen",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Chisinau",display:"Europe/Chisinau",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Chisinau"},{tz:"Europe/Copenhagen",display:"Europe/Copenhagen",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Brussels, Copenhagen, Madrid, Paris"},{tz:"Europe/Dublin",display:"Europe/Dublin",offset:0,isdst:!0,
abbr:"UTC",abbr_dst:"IST",is_cisco:!0,cisco_display:"(UTC +00:00) Dublin, Edinburgh, Lisbon, London"},{tz:"Europe/Gibraltar",display:"Europe/Gibraltar",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Guernsey",display:"Europe/Guernsey",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Helsinki",display:"Europe/Helsinki",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius"},
{tz:"Europe/Isle_of_Man",display:"Europe/Isle of_Man",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Istanbul",display:"Europe/Istanbul",offset:180,isdst:!1,abbr:"TRT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Istanbul"},{tz:"Europe/Jersey",display:"Europe/Jersey",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Kaliningrad",display:"Europe/Kaliningrad",offset:120,isdst:!1,abbr:"EET",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +02:00) Kaliningrad"},
{tz:"Europe/Kiev",display:"Europe/Kiev",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Kirov",display:"Europe/Kirov",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Lisbon",display:"Europe/Lisbon",offset:0,isdst:!0,abbr:"UTC",abbr_dst:"IST",is_cisco:!0,cisco_display:"(UTC +00:00) Dublin, Edinburgh, Lisbon, London"},{tz:"Europe/Ljubljana",display:"Europe/Ljubljana",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague"},
{tz:"Europe/London",display:"Europe/London",offset:0,isdst:!0,abbr:"UTC",abbr_dst:"IST",is_cisco:!0,cisco_display:"(UTC +00:00) Dublin, Edinburgh, Lisbon, London"},{tz:"Europe/Luxembourg",display:"Europe/Luxembourg",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Madrid",display:"Europe/Madrid",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Brussels, Copenhagen, Madrid, Paris"},{tz:"Europe/Malta",display:"Europe/Malta",offset:60,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Mariehamn",display:"Europe/Mariehamn",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Minsk",display:"Europe/Minsk",offset:180,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Minsk"},{tz:"Europe/Monaco",display:"Europe/Monaco",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Moscow",display:"Europe/Moscow",offset:180,isdst:!1,abbr:"MSK",abbr_dst:"",
is_cisco:!0,cisco_display:"(UTC +03:00) Moscow, St. Petersburg, Volgograd"},{tz:"Europe/Nicosia",display:"Europe/Nicosia",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Oslo",display:"Europe/Oslo",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Paris",display:"Europe/Paris",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Brussels, Copenhagen, Madrid, Paris"},{tz:"Europe/Podgorica",display:"Europe/Podgorica",
offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Prague",display:"Europe/Prague",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague"},{tz:"Europe/Riga",display:"Europe/Riga",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius"},{tz:"Europe/Rome",display:"Europe/Rome",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",
is_cisco:!0,cisco_display:"(UTC +01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},{tz:"Europe/Samara",display:"Europe/Samara",offset:240,isdst:!1,abbr:"SAMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Izhevsk, Samara"},{tz:"Europe/San_Marino",display:"Europe/San Marino",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Sarajevo",display:"Europe/Sarajevo",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Sarajevo, Skopje, Warsaw, Zagreb"},
{tz:"Europe/Saratov",display:"Europe/Saratov",offset:240,isdst:!0,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Saratov"},{tz:"Europe/Simferopol",display:"Europe/Simferopol",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Skopje",display:"Europe/Skopje",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Sarajevo, Skopje, Warsaw, Zagreb"},{tz:"Europe/Sofia",display:"Europe/Sofia",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",
is_cisco:!0,cisco_display:"(UTC +02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius"},{tz:"Europe/Stockholm",display:"Europe/Stockholm",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},{tz:"Europe/Tallinn",display:"Europe/Tallinn",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius"},{tz:"Europe/Tirane",display:"Europe/Tirane",offset:60,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Tiraspol",display:"Europe/Tiraspol",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Ulyanovsk",display:"Europe/Ulyanovsk",offset:240,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +04:00) Astrakhan, Ulyanovsk"},{tz:"Europe/Uzhgorod",display:"Europe/Uzhgorod",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Vaduz",display:"Europe/Vaduz",offset:60,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Vatican",display:"Europe/Vatican",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Vienna",display:"Europe/Vienna",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},{tz:"Europe/Vilnius",display:"Europe/Vilnius",offset:120,isdst:!0,abbr:"EET",abbr_dst:"EEST",is_cisco:!0,cisco_display:"(UTC +02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius"},
{tz:"Europe/Volgograd",display:"Europe/Volgograd",offset:180,isdst:!1,abbr:"MSK",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +03:00) Moscow, St. Petersburg, Volgograd"},{tz:"Europe/Warsaw",display:"Europe/Warsaw",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Sarajevo, Skopje, Warsaw, Zagreb"},{tz:"Europe/Zagreb",display:"Europe/Zagreb",offset:60,isdst:!0,abbr:"CET",abbr_dst:"CEST",is_cisco:!0,cisco_display:"(UTC +01:00) Sarajevo, Skopje, Warsaw, Zagreb"},{tz:"Europe/Zaporozhye",
display:"Europe/Zaporozhye",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Europe/Zurich",display:"Europe/Zurich",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GB",display:"GB",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GB-Eire",display:"GB-Eire",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GMT",display:"GMT",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GMT+0",
display:"GMT+0",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GMT0",display:"GMT0",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"GMT-0",display:"GMT-0",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Greenwich",display:"Greenwich",offset:0,isdst:!1,abbr:"GMT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +00:00) Greenwich"},{tz:"Hongkong",display:"Hongkong",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"HST",display:"HST",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Iceland",display:"Iceland",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Antananarivo",display:"Indian/Antananarivo",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Chagos",display:"Indian/Chagos",offset:360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Christmas",display:"Indian/Christmas",offset:420,isdst:!1,
abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Cocos",display:"Indian/Cocos",offset:390,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Comoro",display:"Indian/Comoro",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Kerguelen",display:"Indian/Kerguelen",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Mahe",display:"Indian/Mahe",offset:240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Indian/Maldives",display:"Indian/Maldives",offset:300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Mauritius",display:"Indian/Mauritius",offset:240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Mayotte",display:"Indian/Mayotte",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Indian/Reunion",display:"Indian/Reunion",offset:240,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Iran",display:"Iran",offset:210,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Israel",display:"Israel",offset:120,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Jamaica",display:"Jamaica",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Japan",display:"Japan",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Kwajalein",display:"Kwajalein",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Libya",display:"Libya",offset:120,
isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"MET",display:"MET",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Mexico/BajaNorte",display:"Mexico/BajaNorte",offset:-480,isdst:!0,abbr:"PST",abbr_dst:"PDT",is_cisco:!0,cisco_display:"(UTC -08:00) Baja California"},{tz:"Mexico/BajaSur",display:"Mexico/BajaSur",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Mexico/General",display:"Mexico/General",offset:-360,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"MST",display:"MST",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"MST7MDT",display:"MST7MDT",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Navajo",display:"Navajo",offset:-420,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"NZ",display:"NZ",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"NZ-CHAT",display:"NZ-CHAT",offset:765,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,
cisco_display:""},{tz:"Pacific/Apia",display:"Pacific/Apia",offset:780,isdst:!0,abbr:"WST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +13:00) Samoa"},{tz:"Pacific/Auckland",display:"Pacific/Auckland",offset:720,isdst:!0,abbr:"NZST",abbr_dst:"NZDT",is_cisco:!0,cisco_display:"(UTC +12:00) Auckland, Wellington"},{tz:"Pacific/Bougainville",display:"Pacific/Bougainville",offset:660,isdst:!1,abbr:"BST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Bougainville Island"},{tz:"Pacific/Chatham",display:"Pacific/Chatham",
offset:765,isdst:!0,abbr:"CHAST",abbr_dst:"CHADT",is_cisco:!0,cisco_display:"(UTC +12:45) Chatham Islands"},{tz:"Pacific/Chuuk",display:"Pacific/Chuuk",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Easter",display:"Pacific/Easter",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Efate",display:"Pacific/Efate",offset:660,isdst:!1,abbr:"SBT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Solomon Is., New Caledonia"},{tz:"Pacific/Enderbury",
display:"Pacific/Enderbury",offset:780,isdst:!1,abbr:"TOT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +13:00) Nuku'alofa"},{tz:"Pacific/Fakaofo",display:"Pacific/Fakaofo",offset:780,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Fiji",display:"Pacific/Fiji",offset:720,isdst:!0,abbr:"FJT",abbr_dst:"FJST",is_cisco:!0,cisco_display:"(UTC +12:00) Fiji"},{tz:"Pacific/Funafuti",display:"Pacific/Funafuti",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Galapagos",
display:"Pacific/Galapagos",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Gambier",display:"Pacific/Gambier",offset:-540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Guadalcanal",display:"Pacific/Guadalcanal",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Guam",display:"Pacific/Guam",offset:600,isdst:!1,abbr:"ChST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +10:00) Guam, Port Moresby"},{tz:"Pacific/Honolulu",
display:"Pacific/Honolulu",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Johnston",display:"Pacific/Johnston",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Kiritimati",display:"Pacific/Kiritimati",offset:840,isdst:!1,abbr:"LINT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +14:00) Kiritimati Island"},{tz:"Pacific/Kosrae",display:"Pacific/Kosrae",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Kwajalein",
display:"Pacific/Kwajalein",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Majuro",display:"Pacific/Majuro",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Marquesas",display:"Pacific/Marquesas",offset:-570,isdst:!1,abbr:"MART",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -09:30) Marquesas Islands"},{tz:"Pacific/Midway",display:"Pacific/Midway",offset:-660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Nauru",
display:"Pacific/Nauru",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Niue",display:"Pacific/Niue",offset:-660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Norfolk",display:"Pacific/Norfolk",offset:660,isdst:!1,abbr:"NFT",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +11:00) Norfolk Island"},{tz:"Pacific/Noumea",display:"Pacific/Noumea",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Pago_Pago",display:"Pacific/Pago Pago",
offset:-660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Palau",display:"Pacific/Palau",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Pitcairn",display:"Pacific/Pitcairn",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Pohnpei",display:"Pacific/Pohnpei",offset:660,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Ponape",display:"Pacific/Ponape",offset:660,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"Pacific/Port_Moresby",display:"Pacific/Port Moresby",offset:600,isdst:!1,abbr:"ChST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +10:00) Guam, Port Moresby"},{tz:"Pacific/Rarotonga",display:"Pacific/Rarotonga",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Saipan",display:"Pacific/Saipan",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Samoa",display:"Pacific/Samoa",offset:-660,isdst:!1,abbr:"false",
abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Tahiti",display:"Pacific/Tahiti",offset:-600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Tarawa",display:"Pacific/Tarawa",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Tongatapu",display:"Pacific/Tongatapu",offset:780,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Truk",display:"Pacific/Truk",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"Pacific/Wake",display:"Pacific/Wake",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Wallis",display:"Pacific/Wallis",offset:720,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Pacific/Yap",display:"Pacific/Yap",offset:600,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Poland",display:"Poland",offset:60,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Portugal",display:"Portugal",offset:0,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"PRC",display:"PRC",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"PST8PDT",display:"PST8PDT",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"ROC",display:"ROC",offset:480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"ROK",display:"ROK",offset:540,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Singapore",display:"Singapore",offset:480,isdst:!1,abbr:"SGT",abbr_dst:"",is_cisco:!0,
cisco_display:"(UTC +08:00) Kuala Lumpur, Singapore"},{tz:"Turkey",display:"Turkey",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"UCT",display:"UCT",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Universal",display:"Universal",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"US/Alaska",display:"US/Alaska",offset:-540,isdst:!0,abbr:"AKST",abbr_dst:"AKDT",is_cisco:!0,cisco_display:"(UTC -09:00) Alaska"},{tz:"US/Aleutian",
display:"US/Aleutian",offset:-600,isdst:!0,abbr:"HAST",abbr_dst:"HADT",is_cisco:!0,cisco_display:"(UTC -10:00) Aleutian Islands"},{tz:"US/Arizona",display:"US/Arizona",offset:-420,isdst:!1,abbr:"MST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -07:00) Arizona"},{tz:"US/Central",display:"US/Central",offset:-360,isdst:!1,abbr:"CST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -06:00) Central America"},{tz:"US/Eastern",display:"US/Eastern",offset:-300,isdst:!0,abbr:"EST",abbr_dst:"EDT",is_cisco:!0,cisco_display:"(UTC -05:00) Eastern Time (US & Canada)"},
{tz:"US/East-Indiana",display:"US/East-Indiana",offset:-300,isdst:!0,abbr:"EST",abbr_dst:"EDT",is_cisco:!0,cisco_display:"(UTC -05:00) Indiana (East)"},{tz:"US/Hawaii",display:"US/Hawaii",offset:-600,isdst:!1,abbr:"HAST",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC -10:00) Hawaii"},{tz:"US/Indiana-Starke",display:"US/Indiana-Starke",offset:-360,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"US/Michigan",display:"US/Michigan",offset:-300,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},
{tz:"US/Mountain",display:"US/Mountain",offset:-420,isdst:!0,abbr:"MST",abbr_dst:"MDT",is_cisco:!0,cisco_display:"(UTC -07:00) Mountain Time (US & Canada)"},{tz:"US/Pacific",display:"US/Pacific",offset:-480,isdst:!0,abbr:"PST",abbr_dst:"PDT",is_cisco:!0,cisco_display:"(UTC -08:00) Pacific Time (US & Canada)"},{tz:"US/Pacific-New",display:"US/Pacific-New",offset:-480,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"US/Samoa",display:"US/Samoa",offset:-660,isdst:!1,abbr:"",abbr_dst:"",
is_cisco:!1,cisco_display:""},{tz:"UTC",display:"UTC",offset:0,isdst:!1,abbr:"UTC",abbr_dst:"",is_cisco:!0,cisco_display:"(UTC +00:00) Coordinated Universal Time"},{tz:"WET",display:"WET",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"W-SU",display:"W-SU",offset:180,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""},{tz:"Zulu",display:"Zulu",offset:0,isdst:!1,abbr:"",abbr_dst:"",is_cisco:!1,cisco_display:""}];app.controller("service_management_main",["$scope","$rootScope","$q","MyHttp","$http","GridRowBasedEditingAdv","$templateCache","Sets","UserSession","userAccessRight","goToPreviousPage","sslvpn_port_vld",function(a,b,s,n,v,t,m,q,e,w,l,h){var p=app.uiGrid.sortFun;a.model={};a.backbtn=!1;l.isneed()&&(a.backbtn=!0);a.schema={protocols:[{id:"ALL",displayName:a.DICT("Service_Management_All")},{id:"TCP_UDP",displayName:a.DICT("Service_Management_TCP_UDP")},{id:"TCP",displayName:a.DICT("Service_Management_TCP")},
{id:"UDP",displayName:a.DICT("Service_Management_UDP")},{id:"IP",displayName:a.DICT("Service_Management_IP")},{id:"ICMP",displayName:a.DICT("Service_Management_ICMP")}],protocols_map:{ALL:"All",TCP_UDP:"TCP&UDP",TCP:"TCP",UDP:"UDP",IP:"IP",ICMP:"ICMP"}};a.success=!1;a.dataReady=!1;a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();var u=function(){s.all({pService:function(){return n.post({url:resource_base+"data/service_management.json",method:"get_services",error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}})}(),pPortFw:function(){return n.post({url:resource_base+"data/port_forwarding.json",method:"get_port_forwarding",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})}(),pPortTr:function(){return n.post({url:resource_base+"data/port_triggering.json",method:"get_port_triggering",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})}(),sslvpn_port_vld:h.init()}).then(function(b){var c=[],e;a.model.services=
[];b.pService.data&&(b.pService.data.result&&b.pService.data.result.services&&b.pService.data.result.services.service)&&(c=b.pService.data.result.services.service);angular.forEach(c,function(b){e=r(b);e.type="orig";a.model.services.push(e)});angular.extend(a.model,b.pPortFw.data.result);angular.extend(a.model,b.pPortTr.data.result);x();a.gridSERVICE.Options.data=a.model.services;a.orig_services=angular.copy(a.model.services);a.dataReady=!0;setTimeout(function(){a.gridSERVICE.Options.gridApi&&a.gridSERVICE.Options.gridApi.customApi.checkSelectStatus()},
50);a.resetModified()})},x=function(){var b=function(b,d){var e=[],h,l=!1;"PortFw"===d?(e=a.model["port-forwarding-rules"]&&a.model["port-forwarding-rules"]["port-forwarding-entry"]||[],h=function(a,b){return b["external-service"]===a||b["internal-service"]===a}):"PortTr"===d&&(e=a.model["port-triggering-rules"]&&a.model["port-triggering-rules"]["port-triggering-entry"]||[],h=function(a,b){return b["trigger-service"]===a||b["incoming-service"]===a});for(var m=0,r;m<e.length;m++)if(r=e[m],h(b,r)){l=
!0;break}return l};(function(){angular.forEach(a.model.services,function(a,e){a._ctx=a._ctx||{};if(b(a.name,"PortFw")){var g=a._ctx;g.inuse=g.inuse||[];g.inuse.push("Port Forwarding")}b(a.name,"PortTr")&&(g=a._ctx,g.inuse=g.inuse||[],g.inuse.push("Port Triggering"))})})()};a.gridSERVICE={};a.gridSERVICE.Selections=[];a.gridSERVICE.procNgClick=function(b){a.gridSERVICE.Selections=[];angular.forEach(a.model.services,function(b,d){b.checked?a.gridSERVICE.Selections.push(b):(b.edit=!1,b.edit_name=!1)});
a.gridSERVICE.check_remove_condition()};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.checkInuse=function(a,b){return("ICMP"===b.id||"IP"===b.id)&&a._ctx&&a._ctx.inuse&&0<a._ctx.inuse.length?!0:!1};a.checkNameIsRepeat=function(){var b=a.gridSERVICE.Options.data,c=b.length,e,g;angular.forEach(b,function(a){a.invalid_name=!1});for(e=0;e<c;e++)for(g=e+1;g<c;g++)b[e].name===b[g].name&&(b[e].invalid_name=!0,b[g].invalid_name=!0)};a.check_service=function(b){b=b.entity;var c,e,g;
b.invalid=!1;a.errstr="";switch(b.protocol){case "TCP_UDP":case "TCP":g=b.name;c=b.port.start;e=b.port.end;if(!g||!_.isNumber(c)||!_.isNumber(e))break;c=h.check_service_port(g,c,e);c.valid||(b.invalid=!0,b.errstr=c.err)}};a.gridSERVICE.Options=app.uiGrid.generateGridOptions({IDPreifx:"Service",minRowsToShow:10,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridSERVICE.procNgClick,headerChangedCbk:a.gridSERVICE.procNgClick,disableChkBoxField:"disableChk"},{field:"name",displayName:a.DICT("Service_Management_Application_Name"),
id:"ServiceAppName",validationCbk:"gridInvalidCbk",cellTemplate:m.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"str-name"),editRow:"edit_name",invalidField:"invalid_name",customVldCbk:"checkNameIsRepeat",required:!0},{field:"protocol",displayName:a.DICT("Service_Management_Protocol"),width:130,id:"ServiceProtocol",cellTemplate:m.get("UG_table_text_with_inline_select_edit_and_custom_options.html").replace(/NGOPTIONS/,"item.id as item.displayName disable when grid.appScope.checkInuse(row.entity, item) for (key, item) in grid.appScope.schema.protocols").replace(/data-ng-expansion/,
'ng-change="grid.appScope.check_service(row)"'),editRow:"edit",list:a.schema.protocols,default_str:"--"},{field:"port",displayName:a.DICT("Service_Management_Port_Start"),id:"ServicePortStart",validationCbk:"gridInvalidCbk",cellTemplate:m.get("UG_portRange_start.html"),editRow:"edit",default_str:"--",sortingAlgorithm:function(a,b,e,g,h){var l=void 0,m=void 0;switch(e.entity.protocol){case "TCP_UDP":case "TCP":case "UDP":l=a.start;break;case "IP":l=a.ip;break;case "ICMP":l=a.icmp}switch(g.entity.protocol){case "TCP_UDP":case "TCP":case "UDP":m=
b.start;break;case "IP":m=b.ip;break;case "ICMP":m=b.icmp}return p(l,m,h)}},{field:"port",displayName:a.DICT("Service_Management_Port_End"),id:"ServicePortEnd",validationCbk:"gridInvalidCbk",cellTemplate:m.get("UG_portRange_end.html"),editRow:"edit",default_str:"--",sortingAlgorithm:function(a,b,e,g,h){var l=void 0,m=void 0;switch(e.entity.protocol){case "TCP_UDP":case "TCP":case "UDP":l=a.end}switch(g.entity.protocol){case "TCP":case "UDP":case "TCP_UPD":m=b.end}return p(l,m,h)}}]});a.gridSERVICE.selRow=
function(b,c){a.gridSERVICE.operations.selRow(b,c)};var r=function(a){a||(a={});var b=a["port-range"]||{};return{name:a.name||"",protocol:a.protocol||"TCP",port:{start:_.isNumber(b.start)?b.start:1E4,end:_.isNumber(b.end)?b.end:1E4,icmp:_.isNumber(a["icmp-type"])?a["icmp-type"]:"",ip:_.isNumber(a["ip-type"])?a["ip-type"]:""},type:"orig",invalid_name:!1,checked:!1,edit_name:!1,edit:!1}};a.gridSERVICE.add=function(){var b=r();200<=a.gridSERVICE.Options.data.length?(b=a.DICT("Service_Management_Reach_Max_Entry",
{"%d":200}),app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})):(b.checked=!0,b.type="new",b.edit_name=!0,b.edit=!0,a.gridSERVICE.Options.data.push(b),a.gridSERVICE.Options.gridApi.customApi.scrollToLast(),a.modified())};a.gridSERVICE.edit=function(){angular.forEach(a.gridSERVICE.Options.data,function(a){a.checked&&(a.edit=!0,a.type="edit")})};a.gridSERVICE.remove=function(){var b=a.model.services,c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);a.checkNameIsRepeat();a.modified()};a.gridSERVICE.allTrafficExsit=
!1;a.gridSERVICE.check_remove_condition=function(){var b=a.gridSERVICE.Selections;a.gridSERVICE.allTrafficExsit=!1;angular.forEach(b,function(b,d){"All Traffic"==b.name&&(a.gridSERVICE.allTrafficExsit=!0)})};a.save=function(){var b=[],c,e=a.model.services,g=[],l=[],m=[],r,p=!1,q=function(){angular.forEach(e,function(a,b){r={name:a.name,protocol:a.protocol};switch(a.protocol){case "TCP":case "UDP":case "TCP_UDP":r["port-range"]={start:a.port.start,end:a.port.end};break;case "ICMP":r["icmp-type"]=a.port.icmp;
break;case "IP":r["ip-type"]=a.port.ip;break;case "ALL":break;default:return}l.push(r)});l.length&&(c={method:"set_services",params:{services:{service:l}}},b.push(c),p=!0)},s=function(){var g;angular.forEach(a.orig_services,function(a){g=!1;angular.forEach(e,function(b){b.name===a.name&&(g=!0)});g||m.push({name:a.name})});m.length&&(c={method:"del_services",params:{services:{service:m}}},b.push(c),p)};angular.forEach(e,function(a){a.invalid&&(g=g.concat(a.errstr))});g.length?app.TOOLS.criticalAlertBox({title:a.DICT("Error"),
msg:h.get_err_html(g)}):(s(),q(),p?n.post({url:resource_base+"data/rpc_result.json",method:"set_bulk",params:b,success:function(b){b.data.result&&b.data.result.code&&0!==b.data.result.code?(b="Can not delete, following Tables is in use:<br/>"+b.data.result.errstr+"<br/><br/>",app.TOOLS.criticalAlertBox({msg:b+"Apply failed, and reloading settings from device",cbk:function(a){u()}})):(a.success=!0,u())},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url);u()}}):u())};
a.back=l.goback;a.cancel=function(){u()};u()}]);app.controller("lldpCtrl",["$scope","MyHttp","$uibModal","wan_service","UserSession","userAccessRight",function(a,b,s,n,v,t){a.success=!1;a.dataReady=!1;a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var m=function(b){b||(b={});var e=b.interfaces&&b.interfaces["interface"]||[];b=b["interfaces-state"]&&b["interfaces-state"]["interface"]||[];var m,n=[],r=[],d=[],d=[];a.model.neighbors=[];a.skip_lldp_update_once||(a.model.ifs=[]);angular.forEach(e,function(a,b){a.name.match(/^LAN/)&&
n.push(a);a.name.match(/^WAN\d+$/)&&r.push(a)});n=l(n,"LAN");d=n.concat(r);a.skip_lldp_update_once||(angular.forEach(d,function(b,d){m=b.lldp||{};a.model.ifs.push({name:b.name,edit:!0,lldp:{enable:void 0!==m.enable?m.enable:!0,transmit:void 0!==m.transmit?m.transmit:!0,receive:void 0!==m.receive?m.receive:!0}})}),a.gridLLDPPortOptions.data=a.model.ifs);n=[];r=[];angular.forEach(b,function(a){a.name.match(/^LAN/)&&n.push(a);a.name.match(/^WAN_PORT\d+$/)&&(a.name=a.name.replace("_PORT",""),r.push(a))});
d=n.concat(r);angular.forEach(d,function(a){a.lldp&&(a.lldp.neighbors&&a.lldp.neighbors.neighbor)&&q(a.lldp.neighbors.neighbor)});a.gridNeighborOptions.data=a.model.neighbors;a.skip_lldp_update_once=!1},q=function(b){angular.forEach(b,function(b,e){a.model.neighbors.push({receiving_interface_ref:b["receiving-interface-ref"]&&b["receiving-interface-ref"].replace("_PORT","")||"",receiving_port_ref:b["receiving-port-ref"]||"",end_of_lldppdu:b["end-of-lldppdu"]||"",chasis_id_subtype:b["chasis-id-subtype"]||
"",chasis_id:b["chasis-id"]||"",port_id_subtype:b["port-id-subtype"]||"",port_vlan_id:b["prot-vlan-id"]||"",system_name:b["system-name"]||"",port_id:b["port-id"]||"",ttl:b.ttl||"",port_desc:b["port-desc"]||"",system_desc:b["system-desc"]||"",system_capabilities:b["system-capabilities"]||"",enabled_capabilities:b["enabled-capabilities"]||"",management_address:b["management-address"]||""})})},e=function(a){b.post({url:resource_base+"data/lldp.json",method:"get_lldp",success:function(b){b.data&&b.data.result?
a?a(b.data.result):(w(b.data.result),m(b.data.result)):a?a():(w(),m())},error:function(b){a?a():(w(),m());console.log("lldpCtrl getLLDPData error status: "+b.status)}})},w=function(b){b||(b={});b=b.lldp||{};a.model.lldp={enable:void 0!==b.enable?b.enable:!0,hold_time:b["hold-time"]||120,reinit:b.reinit||2,timer:b.timer||30}},l=function(a,b){1<a.length&&(a=a.sort(function(a,e){var h="",d="",h=0<=a.name.search(b)?a.name.replace(b,""):"0",d=0<=e.name.search(b)?e.name.replace(b,""):"0",h=parseInt(h,10),
d=parseInt(d,10);return h>d?1:-1}));return a};a.model={ifs:[],lldp:{},neighbors:[],select:-1,refreshInterval:!1};a.funs={save:function(){var h={interfaces:{"interface":[]}},l={lldp:{enable:a.model.lldp.enable,"hold-time":a.model.lldp.hold_time,reinit:a.model.lldp.reinit,timer:a.model.lldp.timer}};angular.forEach(a.model.ifs,function(a,b){h.interfaces["interface"].push({name:a.name,lldp:{enable:a.lldp.enable,transmit:a.lldp.transmit,receive:a.lldp.receive}})});angular.extend(l,h);b.post({method:"set_lldp",
params:l,success:function(b){a.success=!0;e();a.resetModified()},error:function(a){}})},cancel:function(){e();a.dataReady=!0;a.resetModified()},detail:function(){s.open({animation:a.animationsEnabled,templateUrl:"lldp_neighbors_detail.htm",controller:"lldpNeighborsDetailCtrl",backdrop:"static",resolve:{data:function(){return a.model.neighbors[a.model.select]}}}).result.then(function(){},function(a){})},refresh:function(){a.skip_lldp_update_once=!0;e(m)}};a.gridLLDPPortOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"name",
displayName:a.DICT("LLDP_Interface")},{field:"lldp.enable",displayName:a.DICT("LLDP_Enable_LLDP"),editRow:"edit",id:"LLDPPort",cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});a.gridNeighborOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"radio",isRadio:!0,changedCbk:function(b){a.model.select=b},id:"Neighbor"},{field:"receiving_interface_ref",displayName:a.DICT("LLDP_Local_Port")},{field:"chasis_id_subtype",displayName:a.DICT("LLDP_Chassis_ID_Subtype")},{field:"chasis_id",displayName:a.DICT("LLDP_Chassis_ID")},
{field:"port_id_subtype",displayName:a.DICT("LLDP_Port_ID_Subtype")},{field:"port_id",displayName:a.DICT("LLDP_Port_ID")},{field:"system_name",displayName:a.DICT("LLDP_System_Name")},{field:"ttl",displayName:a.DICT("LLDP_Time_To_Live")}]});e();a.dataReady=!0}]);app.controller("lldpNeighborsDetailCtrl",["$scope","$uibModalInstance","data",function(a,b,s){a.data=s;a.funs={ok:function(){b.close()}}}]);app.controller("WizardCtrl",["$scope","MyHttp","$q","UserSession","oneTimeLocker","userAccessRight",function(a,b,s,n,v,t){b=v.get("WIZARDS");a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();a.ui_data={ru_flag:t.russia(),data_ready:!0,open_vpn_wizard:!1,open_setup_wizard:!1,open_application_wizard:!1};a.funs={setup_wizard:function(){a.ui_data.open_setup_wizard=!0;app.TOOLS.apply(a)},application_wizard:function(){a.ui_data.open_application_wizard=!0;app.TOOLS.apply(a)},
vpn_wizard:function(){a.ui_data.open_vpn_wizard=!0;app.TOOLS.apply(a)},close_setup_wizard:function(){a.ui_data.open_setup_wizard=!1;app.TOOLS.apply(a)},close_application_wizard:function(){a.ui_data.open_application_wizard=!1;app.TOOLS.apply(a)},close_vpn_wizard:function(){a.ui_data.open_vpn_wizard=!1;app.TOOLS.apply(a)}};if(b)switch(b){case "setup_wizard":a.funs.setup_wizard();break;case "application_wizard":a.funs.application_wizard();break;case "vpn_wizard":a.funs.vpn_wizard()}}]);app.controller("log_main",["$scope","$q","$log","MyHttp","$filter","modelInfo","UserSession","userAccessRight","goToPreviousPage","oneTimeLocker",function(a,b,s,n,v,t,m,q,e,w){a.model=a.model||{};a.backbtn=!1;a.goback=e.goback;a.ctx=a.ctx||{};a.ctx.email=a.ctx.email||{};a.ctx.alert=a.ctx.alert||{};a.ctx.log=a.ctx.log||{};a.ctx.facility=a.ctx.facility||{};a.model["email-server"]=a.model["email-server"]||{};a.rv340w_flag=0;a.rv345p_flag=0;a.success=!1;a.loadReady=!1;a.jumpToPage=function(b){app.TOOLS.jumpToPage(b,
void 0,function(b){b&&a.backbtn&&w.put("comefromviewlog",!0)})};a.email_setting=a.DICT("Log_Link_Email_Page",{"%s":"<a ng-click=\"jumpToPage('System_Config_Email')\">"+a.DICT("Log_Here")+"</a>"});a.ruFlag=q.russia();a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();if(e.isneed()||w.get("needbackbtnbyemail"))a.backbtn=!0;0<=t.get_pid().search("RV340W")&&(a.rv340w_flag=1);0<=t.get_pid().search("RV345P")&&(a.rv345p_flag=1);var l=function(){var e=n.post({url:resource_base+
"data/log.json",method:"get_log",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),l=n.post({url:resource_base+"data/log.json",method:"action",params:{rpc:"usb-check-attached"},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,l]).then(function(b){for(var c=0;c<b.length;c++)angular.extend(a.model,b[c].data.result);p();a.schema=a.schema||{};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};a.schema={severity:[{id:"emergency",
displayName:a.DICT("Log_Emergency")},{id:"alert",displayName:a.DICT("Log_Alert")},{id:"critical",displayName:a.DICT("Log_Critical")},{id:"error",displayName:a.DICT("Log_Error")},{id:"warning",displayName:a.DICT("Log_Warning")},{id:"notice",displayName:a.DICT("Log_Notification")},{id:"info",displayName:a.DICT("Log_Information")},{id:"debug",displayName:a.DICT("Log_Debugging")}],threshold:[{id:"hourly",displayName:a.DICT("Log_Hourly")},{id:"daily",displayName:a.DICT("Log_Daily")},{id:"weekly",displayName:a.DICT("Log_Weekly")}],
email_severity:[{id:"emergency",displayName:a.DICT("Log_Emergency")},{id:"alert",displayName:a.DICT("Log_Alert")},{id:"critical",displayName:a.DICT("Log_Critical")},{id:"error",displayName:a.DICT("Log_Error")},{id:"warning",displayName:a.DICT("Log_Warning")},{id:"notice",displayName:a.DICT("Log_Notification")},{id:"info",displayName:a.DICT("Log_Information")},{id:"debug",displayName:a.DICT("Log_Debugging")}],transport:[{id:"TCP",displayName:a.DICT("Log_TCP")},{id:"UDP",displayName:a.DICT("Log_UDP")}]};
a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);h();a.updatealert();a.loadReady=!0})};l();var h=function(){a.schema.email_severity=[];switch(a.ctx.log.severity){case "emergency":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});"emergency"!==a.ctx.email.severity&&(a.ctx.email.severity="emergency");break;case "alert":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});
"emergency"!==a.ctx.email.severity&&"alert"!==a.ctx.email.severity&&(a.ctx.email.severity="alert");break;case "critical":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});a.schema.email_severity.push({id:"critical",displayName:a.DICT("Log_Critical")});"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity)&&(a.ctx.email.severity="critical");break;
case "error":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});a.schema.email_severity.push({id:"critical",displayName:a.DICT("Log_Critical")});a.schema.email_severity.push({id:"error",displayName:a.DICT("Log_Error")});"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity&&"error"!==a.ctx.email.severity)&&(a.ctx.email.severity="error");break;
case "warning":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});a.schema.email_severity.push({id:"critical",displayName:a.DICT("Log_Critical")});a.schema.email_severity.push({id:"error",displayName:a.DICT("Log_Error")});a.schema.email_severity.push({id:"warning",displayName:a.DICT("Log_Warning")});"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity&&
"error"!==a.ctx.email.severity&&"warning"!==a.ctx.email.severity)&&(a.ctx.email.severity="warning");break;case "notice":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});a.schema.email_severity.push({id:"critical",displayName:a.DICT("Log_Critical")});a.schema.email_severity.push({id:"error",displayName:a.DICT("Log_Error")});a.schema.email_severity.push({id:"warning",displayName:a.DICT("Log_Warning")});
a.schema.email_severity.push({id:"notice",displayName:a.DICT("Log_Notification")});"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity&&"error"!==a.ctx.email.severity&&"warning"!==a.ctx.email.severity&&"notice"!==a.ctx.email.severity)&&(a.ctx.email.severity="notice");break;case "info":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")});a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")});a.schema.email_severity.push({id:"critical",
displayName:a.DICT("Log_Critical")});a.schema.email_severity.push({id:"error",displayName:a.DICT("Log_Error")});a.schema.email_severity.push({id:"warning",displayName:a.DICT("Log_Warning")});a.schema.email_severity.push({id:"notice",displayName:a.DICT("Log_Notification")});a.schema.email_severity.push({id:"info",displayName:a.DICT("Log_Information")});"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity&&"error"!==a.ctx.email.severity&&"warning"!==
a.ctx.email.severity&&"notice"!==a.ctx.email.severity&&"info"!==a.ctx.email.severity)&&(a.ctx.email.severity="info");break;case "debug":a.schema.email_severity.push({id:"emergency",displayName:a.DICT("Log_Emergency")}),a.schema.email_severity.push({id:"alert",displayName:a.DICT("Log_Alert")}),a.schema.email_severity.push({id:"critical",displayName:a.DICT("Log_Critical")}),a.schema.email_severity.push({id:"error",displayName:a.DICT("Log_Error")}),a.schema.email_severity.push({id:"warning",displayName:a.DICT("Log_Warning")}),
a.schema.email_severity.push({id:"notice",displayName:a.DICT("Log_Notification")}),a.schema.email_severity.push({id:"info",displayName:a.DICT("Log_Information")}),a.schema.email_severity.push({id:"debug",displayName:a.DICT("Log_Debugging")}),"emergency"!==a.ctx.email.severity&&("alert"!==a.ctx.email.severity&&"critical"!==a.ctx.email.severity&&"error"!==a.ctx.email.severity&&"warning"!==a.ctx.email.severity&&"notice"!==a.ctx.email.severity&&"info"!==a.ctx.email.severity&&"debug"!==a.ctx.email.severity)&&
(a.ctx.email.severity="debug")}},p=function(){a.model.syslog["global-logging-action"]?null==a.model.syslog["global-logging-action"].none&&(a.ctx.log.enable=!1):a.ctx.log.enable=!0;a.model.syslog["file-logging-action"]["file-logging-archive"]?(a.ctx.log.usb=a.model.syslog["file-logging-action"]["file-logging-archive"]["file-number"],a.ctx.log.usb_enable=!0):a.ctx.log.usb_enable=!1;a.model.syslog["file-logging-action"]["file-size"]=a.model.syslog["file-logging-action"]["file-size"]||"1024";a.model.syslog["file-logging-action"]["logging-facilities"]=
a.model.syslog["file-logging-action"]["logging-facilities"]||[];a.ctx.email=a.model.syslog["email-logging-action"];a.ctx.email.severity=a.ctx.email.severity||"notice";a.ctx.log.severity=a.ctx.log.severity||"notice";a.ctx.email["queue-length"]=a.ctx.email["queue-length"]||"50";a.ctx.email["email-subject"]=a.ctx.email["email-subject"]||"";a.ctx.facility={kern:!1,system:!1,firewall:!1,network:!1,vpn:!1,"ssl-vpn":!1,license:!1,"web-filter":!1,"application-control":!1,user:!1,mobile:!1,wireless:!1,pnp:!1,
"anti-virus":!1,ips:!1};angular.forEach(a.model.alert["email-alerting-action"]["alert-facilities"],function(b,c){a.ctx.alert[b.facility]=b});angular.forEach(a.model.syslog["file-logging-action"]["logging-facilities"],function(b,c){var e=b.facility;a.ctx.log.severity=b.severity;a.ctx.facility[e]=!0});var b=0,e=a.model.syslog["remote-logging-action"]["remote-logging-destination"]||[];a.ctx.server1="";a.ctx.server2="";a.ctx.transport1="UDP";a.ctx.port1=514;a.ctx.transport2="UDP";a.ctx.port2=514;for(b=
0;b<e.length;b++)1==e[b].order&&(a.ctx.server1=e[b].destination,e[b].transport&&(a.ctx.transport1=e[b].transport||"UDP"),e[b].port&&(a.ctx.port1=e[b].port||514)),2==e[b].order&&(a.ctx.server2=e[b].destination,e[b].transport&&(a.ctx.transport2=e[b].transport||"UDP"),e[b].port&&(a.ctx.port2=e[b].port||514));u()},u=function(){var b=!1;angular.forEach(a.ctx.facility,function(a){a||(b=!0)});a.ctx.log.all=!b};a.updatefacility=function(b,e){e||u();var d=v("filter")(a.model.syslog["file-logging-action"]["logging-facilities"],
{facility:b},!0);if(a.ctx.facility[b]){var c={facility:b,severity:a.ctx.log.severity};d.length||a.model.syslog["file-logging-action"]["logging-facilities"].push(c)}else c=v("filter")(a.model.syslog["file-logging-action"]["logging-facilities"],{facility:b},!0),c=a.model.syslog["file-logging-action"]["logging-facilities"].indexOf(c[0]),d.length&&a.model.syslog["file-logging-action"]["logging-facilities"].splice(c,1)};a.updatealert=function(b){var e=!0;angular.forEach(a.ctx.alert,function(a){a.enable||
(e=!1)});a.ctx.email.all=e};a.save=function(b,e){(function(){a.model.syslog["remote-logging-action"]["remote-logging-destination"]=[];a.ctx.server1&&a.model.syslog["remote-logging-action"]["remote-logging-destination"].push({destination:a.ctx.server1,order:1,transport:a.ctx.transport1,port:a.ctx.port1});a.ctx.server2&&a.model.syslog["remote-logging-action"]["remote-logging-destination"].push({destination:a.ctx.server2,order:2,transport:a.ctx.transport2,port:a.ctx.port2});!0==a.ctx.log.usb_enable&&
(a.model.syslog["file-logging-action"]["file-logging-archive"]["file-number"]=a.ctx.log.usb);var b=[],c;for(c in a.ctx.facility)a.ctx.facility[c]&&b.push({facility:c});c=[];switch(a.ctx.log.severity){case "emergency":c.push({severity:"emergency"});break;case "alert":c.push({severity:"emergency"});c.push({severity:"alert"});break;case "critical":c.push({severity:"emergency"});c.push({severity:"alert"});c.push({severity:"critical"});break;case "error":c.push({severity:"emergency"});c.push({severity:"alert"});
c.push({severity:"critical"});c.push({severity:"error"});break;case "warning":c.push({severity:"emergency"});c.push({severity:"alert"});c.push({severity:"critical"});c.push({severity:"error"});c.push({severity:"warning"});break;case "notice":c.push({severity:"emergency"});c.push({severity:"alert"});c.push({severity:"critical"});c.push({severity:"error"});c.push({severity:"warning"});c.push({severity:"notice"});break;case "info":c.push({severity:"emergency"});c.push({severity:"alert"});c.push({severity:"critical"});
c.push({severity:"error"});c.push({severity:"warning"});c.push({severity:"notice"});c.push({severity:"info"});break;case "debug":c.push({severity:"emergency"}),c.push({severity:"alert"}),c.push({severity:"critical"}),c.push({severity:"error"}),c.push({severity:"warning"}),c.push({severity:"notice"}),c.push({severity:"info"}),c.push({severity:"debug"})}b={"syslog-view-stat":{"logging-facilities":b,"logging-sevirity":c}};c=[];c.push({method:"set_log",params:{syslog:a.model.syslog,alert:a.model.alert}});
c.push({method:"set_view_logs",params:b});n.post({method:"set_bulk",params:c,success:function(b){a.success=!0;l()},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})();a.resetModified()};a.cancel=function(){l();a.resetModified()};a.email_all=function(){if(!0==a.ctx.email.all)for(var b in a.ctx.alert)a.ctx.alert[b].enable=!0;else for(b in a.ctx.alert)a.ctx.alert[b].enable=!1};a.log_all=function(){angular.forEach(a.ctx.facility,function(b,e){a.ctx.facility[e]=
a.ctx.log.all;a.updatefacility(e,!0)})};a.log_enable=function(){!1==a.ctx.log.enable?(a.model.syslog["global-logging-action"]={},a.model.syslog["global-logging-action"].none=null,a.ctx.email.enable=!1,a.model.syslog["remote-logging-action"].enable=!1):delete a.model.syslog["global-logging-action"]};a.severity_change=function(){angular.forEach(a.model.syslog["file-logging-action"]["logging-facilities"],function(b,e){b.severity=a.ctx.log.severity});h()};a.usb=function(){var e=n.post({url:resource_base+
"data/log.json",method:"action",params:{rpc:"usb-check-attached"},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e]).then(function(b){for(var d=0;d<b.length;d++)angular.extend(a.model,b[d].data.result)});!0==a.ctx.log.usb_enable?(a.model.syslog["file-logging-action"]["file-logging-archive"]=a.model.syslog["file-logging-action"]["file-logging-archive"]||{},a.model.syslog["file-logging-action"]["file-logging-archive"]["file-number"]=a.ctx.log.usb):delete a.model.syslog["file-logging-action"]["file-logging-archive"]}}]);app.controller("emailCtrl",["$scope","MyHttp","UserSession","userAccessRight","goToPreviousPage","oneTimeLocker",function(a,b,s,n,v,t){var m=t.get("comefromviewlog");a.success=!1;a.loadReady=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var q=function(){b.post({url:resource_base+"data/config_email.json",method:"get_email",success:function(a){e(a.data.result)},error:function(a){Log(ERROR,"emailCtrl error, status: "+a.status)}})},e=function(b){b=b["email-server"]||
{};var e=parseInt(b["smtp-port"],10);isNaN(e)&&(e=25);a.model.smtp_server=b["smtp-server"]||"";a.model.orig_smtp_server=b["smtp-server"]||"";a.model.smtp_port=e;a.model.encryption=b.encryption||a.model.schema.encryption[0].id;a.model.authentication=b.authentication||a.model.schema.authentication[0].id;a.model.user_name=b["user-name"]||"";a.model.from_email_address=b["from-email-address"]||"";a.model.to_email_addresses=["",""];a.model.modified_pwd=!1;b.password&&(a.model.password="00000000");angular.forEach(b["to-email-addresses"],
function(b,e){a.model.to_email_addresses[e]=b["email-address"]});a.model.orig_email_addresses=angular.copy(a.model.to_email_addresses);a.resetModified();a.loadReady=!0},w=function(){var b={"smtp-server":a.model.smtp_server,"smtp-port":a.model.smtp_port,encryption:a.model.encryption,authentication:a.model.authentication,"user-name":a.model.user_name,"to-email-addresses":[],"from-email-address":a.model.from_email_address};a.model.modified_pwd&&(b.password=a.model.password);angular.forEach(a.model.to_email_addresses,
function(a,e){0<a.length&&b["to-email-addresses"].push({"email-address":a})});return b};a.model={smtp_server:"",smtp_port:"",encryption:"",authentication:"",user_name:"",password:"",to_email_addresses:[],from_email_address:"",schema:{},orig_email_addresses:[],back_btn:!1,comefromviewlog:!1};var l=function(a,e){b.post({method:"set_email",params:{"email-server":w()},success:function(b){_.isFunction(a)&&a()},error:function(a){_.isFunction(e)&&e()}})};a.change_pwd=function(){a.model.modified_pwd=!0};
a.funs={save:function(b){l(function(){a.success=!0;q();a.resetModified()},function(){q();a.resetModified()})},cancel:function(){q();a.resetModified()},test:function(){l(function(){b.post({method:"action",forcedUsingPost:!0,params:{rpc:"test-connectivity"},success:function(b){0===(b.data&&b.data.result&&b.data.result.output&&b.data.result.output.code)?app.TOOLS.successAlertBox({title:a.DICT("Information"),msg:a.DICT("Email_Test_SMTP_Server_Success",{"%s":a.model.smtp_server}),cbk:function(){q()}}):
app.TOOLS.criticalAlertBox({title:a.DICT("Alert"),msg:a.DICT("Email_Test_SMTP_Server_Failed",{"%s":a.model.smtp_server}),cbk:function(){q()}})},error:function(b){app.TOOLS.criticalAlertBox({title:a.DICT("Alert"),msg:a.DICT("Email_Test_SMTP_Server_Failed",{"%s":a.model.smtp_server}),cbk:function(){q()}})}})},function(){app.TOOLS.criticalAlertBox({title:a.DICT("Email_Alert"),msg:a.DICT("Email_Apply_Email_Configure_Failure"),cbk:function(){q()}})})},reset:function(){app.TOOLS.warningAlertBox({title:a.DICT("Warning"),
msg:a.DICT("Email_Confirm_Reset_Configure"),cbk:function(b){b&&(a.model.smtp_server="",a.model.smtp_port=25,a.model.encryption=a.model.schema.encryption[0].id,a.model.authentication=a.model.schema.authentication[0].id,a.model.user_name="",a.model.password="",a.model.from_email_address="",a.model.to_email_addresses=[],l(function(){q()},function(){app.TOOLS.criticalAlertBox({title:a.DICT("Email_Alert"),msg:a.DICT("Email_Reset_Email_Configure_Failure"),cbk:function(){}})}))}})},go_back:function(){v.goback(function(b){b&&
a.model.comefromviewlog&&t.put("needbackbtnbyemail",!0)})}};v.isneed()&&(a.model.back_btn=!0);m&&(a.model.comefromviewlog=!0);a.model.schema={encryption:[{id:"NONE",displayName:a.DICT("Email_NONE")},{id:"TLS",displayName:a.DICT("Email_TLS_SSL")}],authentication:[{id:"NONE",displayName:a.DICT("Email_NONE")},{id:"LOGIN",displayName:a.DICT("Email_LOGIN")},{id:"PLAINTEXT",displayName:a.DICT("Email_PLAINTEXT")},{id:"MD5",displayName:a.DICT("Email_MD5")}]};q()}]);app.controller("user_account_main",["$scope","$q","$location","rpcFns","modelInfo","MyHttp","oneTimeLocker","$templateCache","Sets","$timeout","Upload","goToPreviousPage","UserSession","userAccessRight","passwordComplex","$filter","$cookies","sessionAPI",function(a,b,s,n,v,t,m,q,e,w,l,h,p,u,x,r,d,c){var k={source:"http",getResult:function(a,b,c){return e.getResult(this,a,b,c)}};a.goBackPreviousPage=h.goback;a.model=a.model||{};a.ctx=a.ctx||{};a.success=!1;a.loadReady=!1;a.ctx.pwMeterInvalid=!1;a.backbtn=
!1;a.pcFile=void 0;a.needLogout=!1;a.spec={WIFI_CAPTIVE_PORTAL_SUPPORT:!1};h.isneed()&&(a.backbtn=!0);v.get_pid().match("^RV340W")?a.spec.WIFI_CAPTIVE_PORTAL_SUPPORT=!0:a.spec.WIFI_CAPTIVE_PORTAL_SUPPORT=!1;a.forcedUsingPost=!0;var g={procBackground:!0,forcedUsingPost:a.forcedUsingPost},z={procBackground:!1,forcedUsingPost:a.forcedUsingPost};a.pageMap={main:"UserAccountMain.html",user_edit:"LocalUsersEditSection.html",ras_edit:"RASEdit.html"};var y=a.pageMap,A=a.fop={get_groups_ref:function(){return a.model.groups},
get_nacm_user_ref:function(){a.model.nacm_users=a.model.nacm_users||[];return a.model.nacm_users},get_username:function(a){return a.user_name},get_ras_ref:function(b){a.model.ras=a.model.ras||[];return a.model.ras},get_password_complex_ref:function(b){a.model.password_complex=a.model.password_complex||{};return a.model.password_complex}};a.flagGetOutside=!1;var B=angular.copy(m.get("USER_ACCOUNT"));B&&B.username?(a.flagGetOutside=!0,a.currPage=y.user_edit):a.currPage=y.main;a.userAccessFlag=u.get();
"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&p.logout();var C={user_groups:b.defer(),ras:b.defer(),users:b.defer(),complexity:b.defer(),aging_time:b.defer(),web_session_timeout:b.defer()},D=function(){var a={};C.user_groups=b.defer();return"dproxy"==k.source?(proxy.Groups.init(function(){var b=proxy.Groups.get_config();e.recover_object(b,a);C.user_groups.resolve(b)}),C.user_groups.promise):t.post({url:resource_base+"data/aaatrans_groups.json",method:"get_groups",options:{transformResponse:app.modelhelper.db2webFn},
success:function(a){},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},E=function(){var c={};C.ras=b.defer();return"dproxy"==k.source?(proxy.RemoteAuthenticationService.init(function(){var a=proxy.RemoteAuthenticationService.get_config();e.recover_object(a,c);C.ras.resolve(a)}),C.ras.promise):t.post({url:resource_base+"data/aaatrans_ras.json",method:"get_ras",options:{transformResponse:app.modelhelper.db2webFn},success:function(b){var c={default_order:["radius",
"ldap","ad","local-db"]};e.default_result(b,{remote_authentication_services:{remote_authentication_service:[],authentication_order:{services:[]}}});var d=b.data.result.remote_authentication_services.authentication_order;if(d.default_order){if(d.default_order[0]&&-1<d.default_order[0].indexOf(":"))for(var c=0,g;c<d.default_order.length;c++)g=d.default_order[c],d.default_order[c]=g.replace(/^[a-z-]+:/,"")}else e.recover_object(d,c);var c=d.services,h,l;for(g=c.length-1;0<=g;g--){h=c[g];l=!1;if("ezvpn"===
h.service||"web-login-readonly"===h.service)l=!0;if(!a.spec.WIFI_CAPTIVE_PORTAL_SUPPORT&&("ssid"===h.service||"captive-portal"===h.service))l=!0;O.service_display(h.service)==="(_undef_) - "+h.service&&(l=!0);l&&c.splice(g,1)}l=c;c=Array.apply(null,Array(Math.max(10,l.length))).map(String.prototype.valueOf,"_");g=l.length-1;for(h;0<=g;g--){h=l[g];var m={"web-login-administration":0,"s2s-vpn":1,"anyconnect-vpn":2,ssid:3,"captive-portal":3,pptp:4,l2tp:5,dot1x:6}[h.service];angular.isDefined(m)?c[m]=
h:c.push(h)}g=c.length-1;for(h;0<=g;g--)h=c[g],"_"===h&&c.splice(g,1);g=c.length-1;for(h;0<=g;g--)h=c[g],h.order||(h.order=[]);d.services=c;b.data.result&&(d=k.getResult(b,"remote_authentication_services")||{},b.data.result=d)},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},I=function(){C.complexity=b.defer();return"dproxy"==k.source?void 0:t.post({url:resource_base+"data/aaatrans_password_complexity.json",method:"get_password_complexity",options:{transformResponse:app.modelhelper.db2webFn},
success:function(a){e.default_result(a,{password_complexity:{}});if(a.data.result){var b=k.getResult(a,"password_complexity")||{};angular.isDefined(b.enabled)&&(b.complex_enable=b.enabled,delete b.enabled);a.data.result.password_complex=b}},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},F=function(){C.aging_time=b.defer();return"dproxy"==k.source?void 0:t.post({url:resource_base+"data/aaatrans_password_aging_time.json",method:"get_password_aging_time",options:{transformResponse:app.modelhelper.db2webFn},
success:function(a){e.default_result(a,{password_aging_time:{}})},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},H=function(){C.web_session_timeout=b.defer();return"dproxy"==k.source?void 0:t.post({url:resource_base+"data/aaatrans_web_session_timeout.json",method:"get_web_session_timeout",options:{transformResponse:app.modelhelper.db2webFn},success:function(a){e.default_result(a,{web_session_timeout:{}})},error:function(a){Log(ERROR,"AJAX loading error: "+
a.status+", URL: "+a.config.url)}})},G=function(){C.users=b.defer();var a=k.source;if("dproxy"==a){var c={};proxy.Users.init(function(){c=proxy.Users.get_config();C.users.resolve(c)});return C.users.promise}return"u2d_http"==a?t.post({url:resource_base+"p_data/u2d_users.json",method:"u2d_get_users",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}):t.post({url:resource_base+"data/aaatrans_users.json",method:"get_users",options:{transformResponse:app.modelhelper.db2webFn},
error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},J=function(){a.model={};a.ctx={};a.loadReady=!1;b.all({user_groups:D(),ras:E(),complexity:I(),aging_time:F(),web_session_timeout:H(),users:G()}).then(function(b){var c=angular.copy(k.getResult(b.ras,"remote_authentication_service"));angular.forEach(c,function(a){"RADIUS"===a.name&&(a.radius_setting||(a.radius_setting={}),_.isNumber(a.radius_setting.retry_timeout)||(a.radius_setting.retry_timeout=5),_.isNumber(a.radius_setting.retry_limit)||
(a.radius_setting.retry_limit=2))});a.model.ras=c;c=angular.copy(k.getResult(b.ras,"authentication_order"));a.model.ras_ao=c;a.model.password_complex=k.getResult(b.complexity,"password_complex")||{};a.model.password_aging_time=k.getResult(b.aging_time,"password_aging_time")||{};a.model.web_session_timeout=k.getResult(b.web_session_timeout,"web_session_timeout")||{};c=k.getResult(b.user_groups,"groups").group;a.model.groups=c;a.model.users=k.getResult(b.users,"users");(b=a.model.password_complex)&&
x.update_config(b);N();a.schema=a.schema||{};a.schema.rasAuth=[{id:"radius",displayName:a.DICT("User_Accounts_RADIUS")},{id:"ad",displayName:a.DICT("User_Accounts_Active_Directory")},{id:"ldap",displayName:a.DICT("User_Accounts_LDAP")}];a.schema.rasAuthMap={radius:"Radius",ad:"Active Directory",ldap:"LDAP"};a.ctx=a.ctx||{};Q();M();P();U();L();a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.gridUserList.editState="main";a.gridRAS.editState="main";a.login_username=d.get("user");
O.prepareAOCtx();O.updateGridAuthenticationOrderOptions();a.gridUserList.Options.data=a.model.users.user;a.gridRAS.Options.data=a.model.ras;a.gridAO.Options.data=a.model.ras_ao.services;a.gridRAS.checkRASField();var e=function(b){var c=b.username;angular.forEach(a.model.users.user,function(d,e){if(d.name==c&&(a.gridUserList.selectedEditItem=d,a.gridUserList.editState="edit",a.currPage=y.user_edit,angular.isDefined(b.forceChangePW)))switch(a.ctx.forceChangePW=!1,a.ctx.pwdAging=!1,b.redirect_admin){case "1":a.ctx.forceChangePW=
!0;break;case "2":a.ctx.pwdAging=!0}})};w(function(){a.gridRAS.Selections=[];a.flagGetOutside&&(a.loadReady=!1,e(B));a.loadReady=!0},100)})["catch"](function(a){Log(ERROR,"==catch "+a)})};a.updateRASAuthInuse=function(){a.ctx.RASAuthInuse=[];var b=A.get_ras_ref();angular.forEach(b,function(b,c){a.ctx.RASAuthInuse.push(b.authenticate_mode)})};var L=function(){var b=A.get_ras_ref();angular.forEach(b,function(a,b){a.ldap_setting?a._ref=a.ldap_setting:a.radius_setting?a._ref=a.radius_setting:a.ad_setting&&
(a._ref=a.ad_setting);a.radius_setting=a.radius_setting||{};a.ldap_setting=a.ldap_setting||{};a.ad_setting=a.ad_setting||{}});a.updateRASAuthInuse()},N=function(){e.recover_object(a.model,{password_complex:{complex_enable:!1,minimum_length:8,minimum_number_character_classes:3,new_must_different_than_current:!1}});e.recover_object(a.model,{users:{user:[]}});angular.forEach(a.model.ras,function(b){a.update_ras_auth_type(b)});angular.forEach(a.model.users.user,function(a,b){a.old_name=a.name;a.checked=
!1;a.number=b+1});angular.forEach(a.model.ras_ao.services,function(b){b.ao_invalid=!1;b.service_name=a.ao.service_display(b.service);"web-login-administration"===b.service&&("local-db"!==b.order[0]&&"local-db"!==b.order[1]&&!b.use_default_order)&&(b.ao_invalid=!0)});a.users_sample={name:"admin",group:"admin"}},M=function(){var b=!1,c=a.model.users,d=A.get_nacm_user_ref();angular.forEach(d,function(a,d){angular.forEach(c.user,function(c,d){a.name==c.name&&(a._ref_aaa=c,c.$$parentNode=a,b=!0)})});b||
Log(ERROR,"Error: AAA ref not exist")},P=function(){angular.forEach(a.model.users.user,function(a,b){a.password&&(a._pw_exist=!0);delete a.password})},U=function(){var a=A.get_ras_ref();angular.forEach(a,function(a,b){a.radius_setting&&a.radius_setting.preshared_key&&(a.radius_setting._pk_exist=!0,delete a.radius_setting.preshared_key)})},Q=function(){var a=function(a){var b=A.get_nacm_user_ref(),c={_usertmp:{}};angular.forEach(a,function(a,b){var d=A.get_username(a);if(d&&d[0])for(var e=d.length,
g;e--;)g=d[e],void 0==c._usertmp[g]&&(c._usertmp[g]={group:[]}),c._usertmp[g].group[b]=a.name,c._usertmp[g].same_group_count=d.length});b&&b.splice(0);for(var d in c._usertmp)b.push({name:d,join:!1,group:c._usertmp[d].group,same_group_count:c._usertmp[d].same_group_count});delete c._usertmp},b=A.get_groups_ref();b&&a(b)},V=function(a,b,c){var d=A.get_groups_ref();angular.forEach(d,function(d,e){if(d.name==a||void 0===a){var g=A.get_username(d),k=-1;g&&g[0]&&(k=g[0].indexOf(c));b?-1==k&&(g&&g[0]?g[0]+=
(0<g[0].length?" ":"")+c:(g.splice(0),g.push(c))):-1<k&&g&&g[0]&&(g[0]=g[0].replace(c,"").replace("  "," ").replace(/^ /,"").replace(/ $/,""))}})};a.syncUserName=function(a){angular.forEach(a.group,function(b,c){V(b,!1,a._oldname)});a._oldname=a.name;angular.forEach(a.group,function(b,c){V(b,!0,a.name)});a._ref_aaa.name=a.name};a.idTrue=!0;a.idFalse=!1;a.selected=a.selected||{};var R=function(){var b=a.gridUserList.Selections,c=!1,d={admin:0};a.gridUserList.disabledDeleteBtn=!1;angular.forEach(b,
function(b,e){"cisco"===b.name&&(c=!0);b.name===a.login_username&&(c=!0);"admin"==b.group&&(d.admin+=1)});angular.forEach(b,function(a,b){"admin"==a.group&&(a.$$parentNode&&a.$$parentNode.same_group_count<=d.admin)&&(c=!0)});a.gridUserList.disabledDeleteBtn=c};s=function(b){b=a.model.users.user;a.gridUserList.Selections=[];a.gridUserList.disabledDeleteBtn=!1;angular.forEach(b,function(b){b.checked&&a.gridUserList.Selections.push(b)});R()};a.gridUserList={};a.gridUserList.Selections=[];a.gridUserList.disabledDeleteBtn=
!1;a.gridUserList.Options=app.uiGrid.generateGridOptions({IDPreifx:"localUserMembership",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:s,headerChangedCbk:s},{field:"number",displayName:"#",width:50},{field:"name",displayName:a.DICT("User_Accounts_User_Name"),width:200},{field:"group",displayName:a.DICT("User_Accounts_Group_S")}]});a.gridUserList.add=function(b){b=a.model.users.user;var c={name:"",group:A.get_groups_ref()[0].name,password:"",checked:!1,number:-1};400<=b.length?(b=a.DICT("User_Accounts_Reach_Max_Entry",
{"%d":400}),app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})):(a.ctx&&a.ctx.user&&(a.ctx.user.password="",a.ctx.user.confirm_password=""),c.checked=!0,c.number=b.length+1,b.push(c),a.gridUserList.selectedEditItem=c,a.gridUserList.editState="add",a.currPage=y.user_edit)};a.gridUserList.edit=function(){var b;angular.forEach(a.model.users.user,function(c){c.checked&&(b=a.gridUserList.selectedEditItem=c)});a.ctx.user=b&&b._pw_exist?{password:"12345678901234567890123456789012",confirm_password:"abcdefghijabcdefghijabcdefghijab"}:
{password:"",confirm_password:""};a.success=!1;a.currPage=y.user_edit;a.gridUserList.editState="edit"};a.gridUserList.remove=function(){var b=a.model.users.user,c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);a.modified()};a.gridUserList.doDownloadTmpl=function(){var a=0,b=function(d){if(d){var e=d.split("/"),e=app.TOOLS.download_save_to(d,e[e.length-1],"application/octet-stream");e.then(function(a){});e.fail(function(e){2<=a?c(2):w(function(){a++;b(d)},1E3)})}else c(3)},c=function(a){app.TOOLS.criticalAlertBox({msg:"Download Fail("+
a+")",cbk:function(a){}})};n.RPC_generic_send("file-download",{fileType:"user-template"},function(a,d,e){a=e.code;var g=e.errstr;switch(a){case 0:var k=e["download-url"]||void 0;w(function(){b(k)},1E3);break;default:c(1),Log(ERROR,d+": RPC done. got unknown code: "+a+" errstr= "+g)}},void 0,g)};a.gridUserList.doImportUserList=function(b){var c={};Log(DEBUG,"-pc-");a.formUpload=!0;b&&a.upload(b,c)};a.getAttr=function(a,b,c){if(a)return a[b];if(c)return c[b]};a.clean_backup_port=function(a,b){a&&""===
b.$viewValue&&(a.backup_server_port="")};a.update_prekey=function(b,c){b.$dirty&&b.$valid?c.preshared_key=a.ctx.ras.prekey:c.preshared_key&&delete c.preshared_key};a.update_passwd=function(b){var c=a.gridUserList.selectedEditItem,d=a.ctx.user.password;""===d&&!angular.isDefined(a.ctx.user.confirm_password)&&(a.ctx.user.confirm_password="");w(function(){b.$valid?c.password=d:c.password&&delete c.password},0)};a.select_group_disabled=function(a){return a&&a.$$parentNode&&-1<a.$$parentNode.group.indexOf("admin")&&
1>=a.$$parentNode.same_group_count?!0:!1};a.updateRASenable=function(b){for(var c=b.entity.authenticate_mode,d=A.get_ras_ref(),e=0;e<d.length;e++)d[e]!=b.entity&&d[e].authenticate_mode==c&&(d[e].enable=!1);a.gridRAS.checkRASField()};a.chunkSize=512;var K=function(b,c,d){d.fileparam="file001.csv";b.upload=l.upload({url:resource_base+"upload"+a.getReqParams(),resumeSizeUrl:c?resource_base+"upload?name22="+encodeURIComponent(b.name):null,resumeChunkSize:c?a.chunkSize:null,headers:{"optional-header":"header-value"},
data:{sessionid:"EU6DJKEIWO",pathparam:"User",fileparam:"file001.csv",file:b}});b.upload.then(function(c){w(function(){b.result=c.data;Log(DEBUG,"do rpc Upload");a.RPC_import_users(d)})},function(b){0<b.status&&(a.errorMsg=b.status+": "+b.data);Log(Error,"do upload error")},function(a){b.progress=Math.min(100,parseInt(100*a.loaded/a.total,10))});b.upload.xhr(function(a){})};a.getReqParams=function(){return a.generateErrorOnServer?"?errorCode="+a.serverErrorCode+"&errorMessage="+a.serverErrorMsg:""};
a.upload=function(b,c){a.errorMsg=null;K(b,!1,c)};a.RPC_save_to_cdb=function(){n.RPC_generic_send("file-copy",{fileType:"configuration",source:{"config-type":"config-running"},destination:{"config-type":"config-startup"}},function(b,c,d){b=d.code;var e=d.errstr;a.ctx.displayresult=!0;switch(b){case 0:p.logout();a.ctx.errstr=e;a.ctx.return_code=!0;break;default:Log(ERROR,c+": RPC done. got unknown code: "+b+" errstr= "+e),w(function(){Log(ERROR,"save_to_cdb Exception: "+e)},200),a.ctx.errstr=e,a.ctx.return_code=
!1}},void 0,z)};a.RPC_import_users=function(b){n.RPC_generic_send("import-users",{file:"FILE://AAA/"+b.fileparam},function(b,c,d){b=d.code;var e=d.errstr;a.ctx.displayresult=!0;switch(b){case 0:Log(DEBUG,"RPC done. Data model partial update");J();a.ctx.errstr=e;a.ctx.return_code=!0;break;default:Log(ERROR,c+": RPC done. got unknown code: "+b+" errstr= "+e),w(function(){Log(ERROR,"Import Exception: "+e)},200),J(),a.ctx.errstr=e,a.ctx.return_code=!1}},void 0,z)};s=function(){a.gridRAS.Selections=[];
angular.forEach(a.model.ras,function(b){b.checked&&a.gridRAS.Selections.push(b)})};a.gridRAS={};a.gridRAS.Selections=[];a.gridRAS.Options=app.uiGrid.generateGridOptions({IDPreifx:"remoteAuthService",enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:s,headerChangedCbk:s},{field:"enable",displayName:a.DICT("User_Accounts_Enable"),width:90,id:"remoteAuthEnable",cellTemplate:q.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/,'ng-change="grid.appScope.updateRASenable(row)"')},
{field:"name",displayName:a.DICT("User_Accounts_Name"),width:200},{field:"_ref.primary_server",displayName:a.DICT("User_Accounts_Primary_Server")},{field:"_ref.backup_server",displayName:a.DICT("User_Accounts_Backup_Server")}]});var S=function(){var b=a.gridRAS.collectAvailAuthmode(),c="radius";b&&(b[0]&&b[0].id)&&(c=b[0].id);b={name:"",authenticate_mode:c,enable:!1,radius_setting:{primary_server:"",primary_server_port:1645,backup_server:"",backup_server_port:"",preshared_key:"",retry_timeout:5,retry_limit:2},
ad_setting:{},ldap_setting:{}};b._ref=b[b.authenticate_mode+"_setting"];return b};a.gridRAS.remove=function(){var b=a.model.ras,c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);a.updateRASAuthInuse();a.modified()};a.update_ras_auth_type=function(a){a._ref=a[a.authenticate_mode+"_setting"]};a.gridRAS.add=function(){var b=a.model.ras,c=S();angular.forEach(b,function(a){a.checked=!1});c.checked=!0;c.number=b.length+1;b.push(c);a.gridRAS.Selections=[c];a.update_ras_auth_type(c);a.currPage=y.ras_edit;
a.gridRAS.editState="add";a.success=!1};a.gridRAS.edit=function(){var b=a.gridRAS.Selections[0];a.ctx.ras=void 0!=b&&b._ref&&b._ref._pk_exist?{prekey:"12345678901234567890123456789012",confirm_prekey:"abcdefghijabcdefghijabcdefghijab"}:{prekey:"",confirm_prekey:""};a.update_ras_auth_type(b);a.currPage=y.ras_edit;a.gridRAS.editState="edit";a.gridRAS.disableApplyBtn=!1;a.success=!1};a.gridRAS.checkRASField=function(){a.gridRAS.disableApplyBtn=!1;angular.forEach(a.model.ras,function(b){if(b.enable)switch(b.authenticate_mode){case "ad":if(!b.ad_setting||
!b.ad_setting.primary_server||!_.isNumber(b.ad_setting.primary_server_port))a.gridRAS.disableApplyBtn=!0;break;case "ldap":if(!b.ldap_setting||!b.ldap_setting.primary_server||!_.isNumber(b.ldap_setting.primary_server_port))a.gridRAS.disableApplyBtn=!0;break;case "radius":if(!b.radius_setting||!b.radius_setting.primary_server||!_.isNumber(b.radius_setting.primary_server_port))a.gridRAS.disableApplyBtn=!0}})};var T=function(b,c,d){c=a.ctx.RASAuthInuse;for(d=0;d<c.length;d++)if(b.id==c[d])return!1;return!0};
a.gridRAS.collectAvailAuthmode=function(){return r("filter")(a.schema.rasAuth,T)||[]};var O=a.ao={AOOPT_NONE:null,updateGridAuthenticationOrderOptions:function(){a.gridAO={};a.gridAO.disabledCheckbox=function(a){switch(a.entity.service){case "dot1x":case "pptp":case "l2tp":return a.entity.use_default_order=!1,!0;default:return!1}};a.gridAO.checkAUSeq=function(a){a=a.entity;a.ao_invalid=!1;"web-login-administration"===a.service&&(!a.use_default_order&&"local-db"!==a.order[0]&&"local-db"!==a.order[1])&&
(a.ao_invalid=!0)};a.gridAO.clickUseDefault=function(a){a=a.entity;if(a.use_default_order)switch(a.service){case "web-login-administration":a.ao_invalid=!1;a.order[0]="radius";a.order[1]="local-db";break;case "s2s-vpn":case "captive-portal":case "ssid":case "anyconnect-vpn":a.order[0]="radius",a.order[1]="ldap"}};a.gridAO.Options=app.uiGrid.generateGridOptions({IDPreifx:"AO_Services",enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,columnDefs:[{field:"service_name",displayName:a.DICT("User_Accounts_Service"),
minWidth:400},{field:"use_default_order",displayName:a.DICT("User_Accounts_Use_Default"),minWidth:150,id:"ao_def_order",cellTemplate:q.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/,'ng-disabled="grid.appScope.gridAO.disabledCheckbox(row, col, grid)" ng-change="grid.appScope.gridAO.clickUseDefault(row)"')},{field:"order[0]",displayName:a.DICT("User_Accounts_Customize_Primary"),minWidth:200,id:"ao_primary",cellTemplate:q.get("UG_genericSelect.html").replace(/NGOPTIONS/,"p.id as p.disaplyName for p in grid.appScope.ao.get_order_list(row.entity, 0) ").replace(/data-ng-expansion/,
'id="{{\'slct_ao_mode0_\'+grid.appScope.gridFuns.getRowIndex(row, col, grid)}}"ng-disabled="row.entity.use_default_order" required ng-change="grid.appScope.gridAO.checkAUSeq(row)" grid-invalid-field="\'ao_invalid\'"')},{field:"order[1]",displayName:a.DICT("User_Accounts_Customize_Secondary"),minWidth:200,id:"ao_backup",cellTemplate:q.get("UG_genericSelect.html").replace(/NGOPTIONS/,"p.id as p.disaplyName disable when (row.entity.order[0] === p.id) for p in grid.appScope.ao.get_order_list(row.entity, 1) ").replace(/data-ng-expansion/,
'id="{{\'slct_ao_mode1_\'+grid.appScope.gridFuns.getRowIndex(row, col, grid)}}" ng-disabled="row.entity.use_default_order || grid.appScope.ao.get_order_list(row.entity, 1).length <= 2"ng-change="grid.appScope.gridAO.checkAUSeq(row)" grid-invalid-field="\'ao_invalid\'"')}]})},service_display:function(b){var c="";switch(b){case "web-login-administration":c=a.DICT("User_Accounts_Web_Login");break;case "s2s-vpn":c=a.DICT("User_Accounts_Site_to_site_EzVPN_3rd_Party_Client_to_site_VPN");break;case "anyconnect-vpn":c=
a.DICT("User_Accounts_AnyConnect_SSL_VPN");break;case "captive-portal":case "ssid":c=a.DICT("User_Accounts_Captive_Portal");break;case "pptp":c=a.DICT("User_Accounts_PPTP_Server");break;case "l2tp":c=a.DICT("User_Accounts_L2TP_Server");break;case "dot1x":c=a.DICT("User_Accounts_802_1x");break;default:c="(_undef_) - "+b}return c},prepareAOCtx:function(){O.prepareOrderList();for(var b=a.model.ras_ao.services,c=a.orderOptions_0,d=!1,e=!1,g=0,k;g<b.length;g++){k=b[g];var d=e=!1,h=O.oopt_map(k.service),
h=c[h];k.order.splice(2);k.order.splice(h.length);for(var l=0,m;l<h.length;l++)m=h[l],k.order[0]===m.id&&(d=!0),k.order[1]===m.id&&(e=!0);d||(k.order[0]=O.AOOPT_NONE);e||(k.order[1]=O.AOOPT_NONE);k.order[0]===O.AOOPT_NONE&&k.order[1]===O.AOOPT_NONE&&(k.order[0]=(a.model.ras_ao.default_order||[O.AOOPT_NONE,O.AOOPT_NONE])[0],"web-login-administration"===k.service&&(k.order[1]="local-db"))}},prepareOrderList:function(b){if(!a.orderOptions_0){var c={id:O.AOOPT_NONE,disaplyName:a.DICT("User_Accounts_None")},
d={id:"radius",disaplyName:a.DICT("User_Accounts_RADIUS")},e={id:"ldap",disaplyName:a.DICT("User_Accounts_LDAP")},g={id:"ad",disaplyName:a.DICT("User_Accounts_Active_Directory")},k={id:"local-db",disaplyName:a.DICT("User_Accounts_Local_DB")};b=function(a){var b;0===a?b={dot1x:[d],pptp:[k,d],l2tp:[k,d],"s2s-vpn":[k,d,e,g],_default:[k,d,e,g]}:1<=a&&(b={dot1x:[c,d],pptp:[c,k,d],l2tp:[c,k,d],"s2s-vpn":[c,k,d,e,g],_default:[c,k,d,e,g]});return b};a.orderOptions_0=b(0);a.orderOptions_1=b(1)}},oopt_map:function(a){var b=
"";switch(a){case "pptp":case "l2tp":case "dot1x":b=a;break;default:b="_default"}return b},get_order_list:function(b,c){var d=O.oopt_map(b.service);if(0===c)return a.orderOptions_0[d];if(1<=c)return a.orderOptions_1[d]},gen_cleaned_ao_metadata:function(a){var b=function(a,b,c,d){b=a[b];b.service===c&&(c=angular.copy(b),c.service=d,a.push(c))};a=angular.copy(a);for(var c=a.length,d=0,e;d<c;d++){e=a[d];void 0!==a[d].ao_invalid&&delete a[d].ao_invalid;var g=e.order.indexOf(O.AOOPT_NONE);-1<g&&e.order.splice(g,
1);b(a,d,"s2s-vpn","ezvpn");b(a,d,"web-login-administration","web-login-readonly")}return a}};a.aaa_user_save=function(){var c=b.defer(),d=function(b){var c=[];if(!0===a.ctx.forceChangePW||a.ctx.pwdAging){var d=a.gridUserList.selectedEditItem;angular.isDefined(d.password)||(d.password="")}var e=void 0;angular.forEach(b,function(b,d){e=angular.isDefined(b.password)?b.password:void 0;var g={name:b.name||void 0,group:b.group||void 0,password:e,old_password:b.old_password||""};b.old_name&&b.old_name!==
b.name&&(b.old_name===a.login_username&&(a.needLogout=!0),g.old_name=b.old_name);c.push(g)});return c},e=[];a.gridUserList.selectedEditItem&&e.push(a.gridUserList.selectedEditItem);var g,k=function(){g=d(e);var b=!0,k=!1,l=function(){app.TOOLS.criticalAlertBox({msg:"Account settings failed, check if you are chosen a protected group <br/>",cbk:function(a){}})},m=function(){app.TOOLS.criticalAlertBox({msg:"Your request was rejected, maybe:\n<br/>  * Old-password is not correct"+(a.model.password_complex.new_must_different_than_current?
", or\n<br/>  * New password are same with current one":""),cbk:function(a){}})};return t.post({url:resource_base+"data/result_set_users.json",method:"set_users",params:{users:{user:g}},success:function(c){var d=h(c);-2==d.code?(b=!1,l()):-1==d.code?(b=!1,m()):1==d.code?(b=k=!0,!a.ctx.forceChangePW&&!a.ctx.pwdAging&&p.logout()):0==d.code?b=!0:Log(ERROR,"Response unknown case: "+c.status+", method: "+this.method+", URL: "+c.config.url+", ret= "+JSON.stringify(d))},error:function(a){c.reject();Log(ERROR,
"AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(d){b&&(!0==a.ctx.forceChangePW||a.ctx.pwdAging)?a.RPC_save_to_cdb():b&&!1==k&&(a.needLogout?p.logout():(a.success=!0,c.resolve()))})},h=function(a){var b={};a.data&&void 0!==a.data.result&&(a=a.data.result,"number"==typeof a?b.code=parseInt(a):"object"==typeof a&&(b=a,b.code=parseInt(b.code)));return b},l=function(b){var d=[],e=a.model.users.user,g;angular.forEach(a.model_orig.users.user,function(a){g=!1;angular.forEach(e,function(b){a.old_name===
b.old_name&&(g=!0);b.name===a.old_name&&(g=!0)});g||d.push({name:a.name})});var k=!0,l=!1,m=function(){var a="Delete user account failed";b&&(a+=", and follows User operation (Add/Set) will be canceled<br/>");app.TOOLS.criticalAlertBox({msg:a,cbk:function(a){}})};d.length?t.post({url:resource_base+"data/result_del_users.json",method:"del_users",params:{users:{user:d}},success:function(a){var b=h(a);-1==b.code?(k=!1,l=!0,m()):0==b.code?k=!0:Log(ERROR,"Response unknown case: "+a.status+", method: "+
this.method+", URL: "+a.config.url+", ret= "+JSON.stringify(b))},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(d){b&&!1==l?b():c.resolve();k&&(a.success=!0)}):b?b():c.resolve()};"add"==a.gridUserList.editState?l(function(){g=d(e);t.post({url:resource_base+"data/rpc_result.json",method:"add_users",forcedUsingPost:a.forcedUsingPost,params:{users:{user:g}},success:function(b){c.resolve();a.success=!0},error:function(a){c.reject();Log(ERROR,"AJAX loading error: "+
a.status+", URL: "+a.config.url)}})}):"edit"==a.gridUserList.editState?a.ctx.forceChangePW?k():l(k):l();return c.promise};a.aaa_save=function(){var d=b.defer(),e=[],g=function(b){return a.form[b]&&!0===a.form[b].$dirty?!0:!1},h=function(b){if(("edit"==a.gridRAS.editState||"add"==a.gridRAS.editState)&&a.gridRAS.Selections&&a.gridRAS.Selections[0])a.gridRAS.Selections[0].enable=!0;b=angular.copy(b);angular.forEach(b,function(a,b){var c=a.authenticate_mode;"radius"==c?(delete a.ad_setting,delete a.ldap_setting,
a.radius_setting&&(null==a.radius_setting.primary_server&&(a.radius_setting.primary_server=""),null==a.radius_setting.primary_server_port&&(a.radius_setting.primary_server_port=""),null==a.radius_setting.backup_server&&(a.radius_setting.backup_server=""),null==a.radius_setting.backup_server_port&&(a.radius_setting.backup_server_port=""))):"ldap"==c?(delete a.radius_setting,delete a.ad_setting):"ad"==c&&(delete a.radius_setting,delete a.ldap_setting);a._ref&&angular.isDefined(a._ref._pk_exist)&&delete a._ref._pk_exist;
a._ref&&delete a._ref;angular.isDefined(a._oldname)&&delete a._oldname;delete a.number;delete a.checked});return b}(A.get_ras_ref()),l=O.gen_cleaned_ao_metadata(a.model.ras_ao.services);(function(a){return angular.copy(a)})(A.get_groups_ref());var m=g("form_pw_complexity")||!1,r=g("form_wst")||!1,n=g("form_ras")||!1,p=g("form_ras_ao")||!1,q={};!0===n&&angular.extend(q,{"remote-authentication-service":h});!0===p&&angular.extend(q,{"authentication-order":{services:l}});!1===n&&!1===p&&(q=void 0);var l=
function(){t.post({url:resource_base+"data/result_set_bulk.json",forcedUsingPost:!0,method:"set_bulk",params:e,success:function(b){c.init();d.resolve();a.success=!0},error:function(a){d.reject();Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},z=function(){var b;b=(!a.ctx||!a.ctx.forceChangePW&&!a.ctx.pwdAging)&&"edit"!==a.gridRAS.editState&&!1===m&&!1===r&&!1===n&&!1===p?!1:!0;if(b){b=function(){var b=app.modelhelper.web2dbFn({password_aging_time:{timeout:a.model.password_aging_time.timeout}});
e.push({method:"set_password_aging_time",params:b})};var c=function(){var b=app.modelhelper.web2dbFn({web_session_timeout:angular.copy(a.model.web_session_timeout)});e.push({method:"set_web_session_timeout",params:b})},d=function(){var b=a.model.password_complex,b=app.modelhelper.web2dbFn({"password-complexity":{enabled:b.complex_enable,"minimum-length":b.minimum_length,"minimum-number-character-classes":b.minimum_number_character_classes,"new-must-different-than-current":b.new_must_different_than_current}});
e.push({method:"set_password_complexity",params:b})};q&&function(){var a=app.modelhelper.web2dbFn({"remote-authentication-services":q}),b;a["remote-authentication-services"]["authentication-order"]&&a["remote-authentication-services"]["authentication-order"].services&&angular.forEach(a["remote-authentication-services"]["authentication-order"].services,function(a){b=a.order;delete a.order;delete a["service-name"];a.order=b});e.push({method:"set_ras",params:a})}();g("form_pw_complexity")&&(d(),b());
g("form_wst")&&c()}},u=function(){var b=a.model.ras,c=[],d;angular.forEach(a.model_orig.ras,function(a){d=!1;angular.forEach(b,function(b){a.name===b.name&&(d=!0)});d||c.push({name:a.name})});c.length&&e.push({method:"del_ras",params:{"remote-authentication-services":{"remote-authentication-service":c}}})};"dproxy"==k.source?(l={},l.remote_authentication_service=h,l.password_complex=a.model.password_complex,h=execPW_RAS_SetOp(),l.$$save_option={setflag:h},proxy.RemoteAuthenticationService.set_config(l),
a.result=proxy.RemoteAuthenticationService.commit({cbk:function(){d.resolve();a.success=!0}})):(u(),z(),0<e.length?l():d.resolve());return d.promise};a.save=function(){a.aaa_save().finally(function(){return a.aaa_user_save()}).finally(function(){a.gridUserList.editState="main";a.gridRAS.editState="main";a.currPage=y.main;J()}).finally(function(){a.resetModified()})};a.selectUploadFile=function(b){a.pcFile=b};a.cancel=function(){a.currPage=y.main;a.flagGetOutside=!1;a.loadReady=!1;J();a.resetModified()};
J()}]);
app.controller("user_account_main_pw_complexity",["$scope","passwordComplex",function(a,b){a.ctx.pwcpx=a.ctx.pwcpx||{};a.ctx.pwMeterInvalid=!1;a.pwFns=a.pwFns||{};a.ctx.pwcpx.cpxScore=0;a.model.pwd_min_len=0;a.disable_pwd_complex=function(s){!s.complex_enable&&a.ctx.pwMeterInvalid&&(s.minimum_length=a.model_orig.password_complex.minimum_length,s.minimum_number_character_classes=a.model_orig.password_complex.minimum_number_character_classes,b.update_config(s),a.ctx.pwMeterInvalid=!1)};a.update_pw_meter=function(s,
n){if(n.complex_enable){a.ctx.pwMeterInvalid=n.minimum_length<n.minimum_number_character_classes?!0:!1;s=s||"";b.update_config(n);var v=b.getStrength({pwd:s})||0;a.ctx.pwcpx.raw_cpxScore=v||0;0==n.minimum_length&&0==n.minimum_number_character_classes?v=3:2>=v&&(v=0);a.ctx.pwcpx.cpxScore=v||0}};a.getAttr=function(a,b,v){if(a)return a[b];if(v)return v[b]};a.proc_password_min_len=function(){var b=0,b=a.model.password_complex||{},b=b.complex_enable?b.minimum_length||0:0;a.model.pwd_min_len=b};a.password_placeholder_msg=
function(b){var n="";return n=b.complex_enable&&0<b.minimum_length?a.DICT("User_Accounts_Pwd_Not_Left_Blank"):a.DICT("User_Accounts_Keep_Blank")};a.proc_password_min_len()}]);app.controller("scheduleCtrl",["$scope","MyHttp","pgWindow","$templateCache","UserSession","userAccessRight","oneTimeLocker",function(a,b,s,n,v,t,m){a.success=!1;a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var q=function(){b.post({url:resource_base+"data/schedule.json",method:"get_schedule",success:function(a){a.data&&a.data.result?e(a.data.result):e()},error:function(a){Log(ERROR,"scheduleCtrl getScheduleData error : "+a.status);e()}})},e=function(b){b||
(b={});var e=[];b.schedules&&b.schedules.schedule&&(e=b.schedules.schedule);a.model.schedules=[];angular.forEach(e,function(b){a.model.schedules.push(w(b))});a.model.orig=angular.copy(a.model.schedules);a.gridScheduleOptions.data=a.model.schedules;a.dataReady=!0},w=function(a){a||(a={});var b=a.duration||{},e={editName:!1,edit:!1,checked:!1,"default":"ANYTIME"===a.name||"BUSINESS"===a.name||"EVENINGHOURS"===a.name||"WORKHOURS"===a.name?!0:!1,name:a.name,name_is_repeat:!1,description:a.description,
start_time:b["start-time"]||"00:00:00",end_time:b["end-time"]||"00:00:00",days:{every_day:!1,week_day:!1,week_end:!1,sun:!1,mon:!1,tue:!1,wed:!1,thu:!1,fir:!1,sat:!1}};a=[];b["recur-on"]&&(b["recur-on"]["recur-on"]&&b["recur-on"]["recur-on"][0])&&(a=b["recur-on"]["recur-on"][0].split(" "));angular.forEach(a,function(a){e.days[a]=!0});return e};s=function(b){var e=!1;a.sel_cnts=0;angular.forEach(a.model.schedules,function(b,h){b.checked?(a.sel_cnts+=1,b["default"]&&(e=!0)):(b.editName=!1,b.edit=!1)});
a.default_schedule=e?!0:!1};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.chk_name=function(){var b=a.model.schedules,e=b.length,l,m;angular.forEach(b,function(a){a.invalid=!1});for(l=0;l<e;l++)for(m=l+1;m<e;m++)b[l].name===b[m].name&&(b[l].invalid=!0,b[m].invalid=!0)};a.gridScheduleOptions=app.uiGrid.generateGridOptions({IDPreifx:"Schedule",rowHeight:2*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:s,headerChangedCbk:s,disableChkBoxField:"disableChk"},
{field:"name",displayName:a.DICT("Schedule_Name"),required:!0,customVldCbk:"chk_name",invalidField:"invalid",minWidth:180,width:180,editRow:"editName",id:"scheduleName",validationCbk:"gridInvalidCbk",cellTemplate:n.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'uci-name maxlength="31"')},{field:"start_time",displayName:a.DICT("Schedule_Start_Time"),validationCbk:"gridInvalidCbk",isWrapHeader:!0,enableSorting:!1,minWidth:100,width:100,editRow:"edit",required:!0,id:"scheduleStartTime",
cellTemplate:"UG_table_date_with_inline_time_edit.html"},{field:"end_time",displayName:a.DICT("Schedule_End_Time"),validationCbk:"gridInvalidCbk",isWrapHeader:!0,enableSorting:!1,minWidth:100,width:100,editRow:"edit",id:"scheduleEndTime",cellTemplate:"UG_table_date_with_inline_time_edit.html"},{field:"days",displayName:a.DICT("Schedule_Days"),weekdayChange:function(a){var b=a.entity.days.week_day;a.entity.days.week_end=!1;a.entity.days.every_day=!1;a.entity.days.mon=b;a.entity.days.tue=b;a.entity.days.wed=
b;a.entity.days.thu=b;if(a.entity.days.fri=b)a.entity.days.sun=!b,a.entity.days.sat=!b},everydayChange:function(a){var b=a.entity.days.every_day;a.entity.days.week_end=!1;a.entity.days.week_day=!1;a.entity.days.sun=b;a.entity.days.mon=b;a.entity.days.tue=b;a.entity.days.wed=b;a.entity.days.thu=b;a.entity.days.fri=b;a.entity.days.sat=b},enableSorting:!1,minWidth:680,weekendChange:function(a){var b=a.entity.days.week_end;a.entity.days.every_day=!1;a.entity.days.week_day=!1;a.entity.days.sun=b;if(a.entity.days.sat=
b)a.entity.days.mon=!b,a.entity.days.tue=!b,a.entity.days.wed=!b,a.entity.days.thu=!b,a.entity.days.fri=!b},editRow:"edit",cellTemplate:"schdule_days_with_inline_edit.html"}]});a.dataReady=!1;a.fromACL=!1;a.sel_cnts=0;a.default_schedule=!1;a.policy={};a.model={schedules:[],orig:[]};var l=function(){return 30<=a.model.schedules.length?(a.msg="Only allow maximum of 30 entries for Schedule. (Current Entry Number: "+a.model.schedules.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),
!0):!1};a.funs={add:function(){if(!l()){var b=w();b.checked=!0;b.editName=!0;b.edit=!0;b["default"]=!1;a.model.schedules.push(b);a.gridScheduleOptions.gridApi.customApi.scrollToLast();a.modified()}},edit:function(){angular.forEach(a.model.schedules,function(a){a.checked&&(a.edit=!0)})},del:function(){for(var b=a.model.schedules.length-1;0<=b;b--)a.model.schedules[b].checked&&a.model.schedules.splice(b,1);a.sel_cnts=0;a.chk_name();a.modified()},save:function(){var e=a.model.schedules,l,m=!1,n=[],r=
"",d=function(){var c=[];angular.forEach(e,function(a){r="";angular.forEach(a.days,function(a,b){switch(b){case "sun":case "mon":case "tue":case "wed":case "thu":case "fri":case "sat":a&&(r=r+b+" ")}});c.push({name:a.name,duration:{"start-time":a.start_time,"end-time":a.end_time,"recur-on":{"recur-on":[r.trim()]}}})});c.length&&b.post({method:"set_schedule",params:{schedules:{schedule:c}},success:function(b){a.success=!0;q();a.resetModified()},error:function(b){q();a.resetModified()}})};angular.forEach(a.model.orig,
function(a){l=!0;angular.forEach(e,function(b){a.name===b.name&&(l=!1)});l&&(n.push({name:a.name}),m=!0)});m?b.post({method:"del_schedule",params:{schedules:{schedule:n}},success:function(){d()},error:function(){d()}}):d()},cancel:function(){q();a.resetModified()},back:function(){m.put("backFromSchedule",{});history.back()}};m.get("jumpFromACL")&&(a.fromACL=!0);q()}]);app.controller("user_group_main",["$scope","$q","$uibModal","$log","$filter","MyHttp","GridRowBasedEditingOper","oneTimeLocker","$templateCache","Sets","$timeout","modelInfo","UserSession","userAccessRight",function(a,b,s,n,v,t,m,q,e,w,l,h,p,u){var x={source:"http",getResult:function(a,b,c){return w.getResult(this,a,b,c)}};a.model=a.model||{};a.ctx=a.ctx||{};a.flags=a.flags||{};a.rv340w_flag=0;a.success=!1;a.loadReady=!1;a.flags.leaflist_sep_as_space=!1;a.flags.users_remove_joined_user=!1;a.ruFlag=
u.russia();a.userAccessFlag=u.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&p.logout();0<=h.get_pid().search("RV340W")&&(a.rv340w_flag=1);var r=a.fop={get_groups_ref:function(){return a.model.groups},get_users_ref:function(){a.model.users.user=a.model.users&&a.model.users.user||[];return a.model.users.user},get_users_join_ref:function(){a.model.users_join=a.model.users_join||[];return a.model.users_join}},d=function(a,b,c,d){return t.post({url:resource_base+"data/"+b,method:a,params:c||
void 0,procBackground:d||void 0,error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},c=function(a){var b,c,e,g;switch(a){case "groups":b="get_groups";c="aaatrans_groups.json";break;case "users":b="get_users";c="aaa_user_hi.json";break;case "vpn_summary":b="get_vpn_summary";c="vpn_summary.json";e={filter:"CONFIG"};g=!0;break;case "ssid":b="get_wifi_settings";c="wlan_ssid.json";g=!0;break;default:console.log("prepareModelOf: unknown name: "+a)}return d(b,c,e,g)},
k=function(){a.loadReady=!1;b.all({groups:c("groups"),users:c("users")}).then(function(b){a.model.users=x.getResult(b.users,"users");b=x.getResult(b.groups,"groups").group;a.model.groups=b;A();w.recover_object(a.model,{"ipsec-profiles":{"ipsec-profile":[]},"site-to-sites":{"site-to-site":[]},"client-to-sites":{"client-to-site":[]},l2tp:{enable:!0},"l2tp-state":{connections:{connection:[]}},pptp:{enable:!0},"pptp-state":{connections:{connection:[]}},sslvpn:{enable:!0,"group-policies":{"group-policy":[]}},
wlans:{ssid:[]}});a.schema=a.schema||{};a.schema.StatusMap={"true":"Enabled","false":"Disabled"};a.schema.actionMap={permit:"Enabled",deny:"Disabled"};a.schema.weblogin=["web-login-disabled","web-login-readonly","web-login-administration"];a.schema.webloginStr={"web-login-disabled":"Disabled","web-login-readonly":"Read Only","web-login-administration":"Admin"};B();C();D();a.gridUserGroup.Options.data=a.model.groups;a.model_orig=angular.copy(a.model);a.gridUserGroup.operations=new app.ngGrid.setupGridAct({oper:m,
grid:a.gridUserGroup});a.gridUserList.operations=new app.ngGrid.setupGridAct({oper:m,grid:a.gridUserList});angular.equals(a.gridUserGroup.operations,a.gridUserList.operations);a.loadReady=!0;l(function(){a.gridUserList._tbl_ref&&a.gridUserList.operations.resetState();a.gridUserGroup._tbl_ref&&a.gridUserGroup.operations.resetState()},100)});b.all({vpn_summary:c("vpn_summary"),ssid:1==a.rv340w_flag?c("ssid"):void 0}).then(function(b){var c=x.getResult(b.vpn_summary);a.model.sslvpn=c.sslvpn;a.model["site-to-sites"]=
c["site-to-sites"];a.model["client-to-sites"]=c["client-to-sites"];b.ssid&&(a.model.wlans=x.getResult(b.ssid,"wlans"));a.loadReady_p2=!0})};k();var g=function(a,b){a.operations=new app.ngGrid.setupGridAct({oper:m,grid:a})};a.find=function(a,b,c){angular.forEach(a,function(a,d){for(var e=b.length;e--;)a.service==b[e]&&c(b[e],e,d)})};var z=function(b,c){var d=!1;a.find(b["feature-rule"],[c],function(a,b,c){d=!0});if(!d){var e=angular.copy(a.use_feature_rule_sample[c]);b["feature-rule"].push(e)}},y=
function(b){w.recover_object(b,a.use_feature_rule_array_sample);z(b,"anyconnect-vpn");z(b,"ssid");z(b,"dot1x");z(b,"ezvpn");z(b,"pptp");z(b,"l2tp");z(b,"s2s-vpn");var c=!1;a.find(b["feature-rule"],["web-login-disabled","web-login-disabled","web-login-readonly","web-login-administration"],function(a,b,d){c=!0});c||z(b,"web-login-disabled")},A=function(){a.use_feature_rule_array_sample={"feature-rule":[]};a.use_feature_rule_sample={ssid:{service:"ssid",action:"permit"},dot1x:{service:"dot1x",action:"deny"},
ezvpn:{service:"ezvpn",option:[],action:"permit"},l2tp:{service:"l2tp",action:"deny"},pptp:{service:"pptp",action:"deny"},"s2s-vpn":{service:"s2s-vpn",option:[],action:"permit"},"web-login-disabled":{service:"web-login-disabled",action:"permit"},"anyconnect-vpn":{service:"anyconnect-vpn",option:[],action:"permit"}};var b=r.get_groups_ref(),c,d;for(c=b.length-1;0<=c;c--)d=b[c],y(d)},B=function(){var b=function(b,c,d){b._ctx[c]={};var e=void 0;a.find(b["feature-rule"],[c],function(a,d,g){b._ctx[c].ref=
b["feature-rule"][g];e=g});d&&d(b,c,e)},c=function(b,c,d){var e=function(){var e=[];a.flags.leaflist_sep_as_space?b["feature-rule"][d].option&&b["feature-rule"][d].option[0]&&(e=b["feature-rule"][d].option[0].split(" ")):e=angular.copy(b["feature-rule"][d].option);angular.forEach(e,function(a){b._ctx[c].member.push({name:a})})};b._ctx[c].member=[];angular.isDefined(d)&&e()},d=function(d){angular.forEach(d,function(d,e){d._ctx={};d["feature-rule"]&&0<=d["feature-rule"].length&&(d._ctx.weblogin=a.schema.weblogin[0],
a.find(d["feature-rule"],a.schema.weblogin,function(a,b){d._ctx.weblogin=a}),b(d,"pptp"),b(d,"l2tp"),b(d,"dot1x"),b(d,"ezvpn",c),b(d,"s2s-vpn",c),b(d,"anyconnect-vpn",c),b(d,"ssid",c))})},e=r.get_groups_ref();e&&d(e)},C=function(){var b=function(a){var b=[],c=r.get_groups_ref();angular.forEach(a,function(a,d){for(var e=void 0,g=c.length;g--;)c[g].name==a.group&&(e=c[g]);b.push({name:a.name||"",join:!1,invisible:!1,readonly:!1,group:[a.group],_groupref:e})});return b},c=r.get_users_ref();if(0<c.length){a.model.users_join?
a.model.users_join.splice(0):a.model.users_join=[];b=b(c)||[];for(c=0;c<b.length;c++)a.model.users_join.push(b[c]);a.gridUserList.Options.data=a.model.users_join}},D=function(){var a=r.get_groups_ref();a&&angular.forEach(a,function(a,b){"admin"==a.name&&(a._priv="reserved");"guest"==a.name&&(a._priv="adminNotAllow");a.checked=!1})};a.ifJoined=function(a,b){return-1<a.indexOf(b)?!0:!1};a.check_remove_condition=function(){var b=a.gridUserGroup.Selections,c=!1;angular.forEach(b,function(a,b){if("admin"==
a.name||"guest"==a.name)c=!0});var d=!0;b&&(0!==b.length&&0===b[0]._ctx.ezvpn.member.length&&0===b[0]._ctx["s2s-vpn"].member.length&&0===b[0]._ctx["anyconnect-vpn"].member.length)&&(1===a.rv340w_flag&&0===b[0]._ctx.ssid.member.length?d=!1:1!==a.rv340w_flag&&(d=!1));return c||d};a.collect_group_named=function(a){return v("filter")(r.get_groups_ref(),function(b,c,d){c=!1;b.name==a&&(c=!0);return c})};a.check_inuse=function(){var b=!1;0!==a.gridUserGroup.Selections.length&&angular.forEach(a.gridUserGroup.Selections,
function(c,d){var e=a.collect_group_named(c.name);e&&(e[0]&&e[0]["user-name"]&&e[0]["user-name"][0]&&0<e[0]["user-name"][0].length)&&(b=!0)});return b};a.remove_disabled_reason=function(){var b="";a.check_inuse()&&(b="Remove th users firstly to delete this group.");return b};a.idTrue=!0;a.idFalse=!1;a.gridUserList=a.gridUserList||{};a.getIndex=function(a,b){var c="";if(!a||!b)return"";angular.forEach(b,function(b,d){b.uid===a.uid&&(c=d+1)});return c};a.gridUserList.Options=app.uiGrid.generateGridOptions({columnDefs:[{field:"number",
displayName:"#",width:50,cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.getIndex(row, grid.rows)")},{field:"join",displayName:a.DICT("User_Groups_Join"),width:70,id:"localUserJoin",cellTemplate:e.get("T_gridUserList_join_checkbox.html").replace(/ARGS1/,e.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/,"ng-disabled=(row.entity['readonly']===true) ng-change='grid.appScope.gridUserList.check_join_state(row.entity)'"))},{field:"name",displayName:a.DICT("User_Groups_User_Name"),
width:220},{field:"group",displayName:a.DICT("User_Groups_Joined_Groups_S"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"MODEL_COL_FIELD.join(' ')")}]});a.gridUserList.check_join_state=function(a){var b=function(a,b){var c=0,d=[],e=r.get_users_join_ref();angular.forEach(e,function(b,e){b._groupref.name==a&&(!0===b.join?c++:!1===b.join&&d.push(b))});var g=c>=b-1;angular.forEach(d,function(a,b){a.readonly=g?!0:!1})};if(a&&a._groupref&&a._groupref["user-name"]){var c=a._groupref.name;
a=a._groupref["user-name"].length;"admin"==c&&b(c,a)}};a.gridUserGroup=a.gridUserGroup||{};q=function(){a.gridUserGroup.Selections=[];angular.forEach(a.model.groups,function(b){b.checked&&a.gridUserGroup.Selections.push(b)})};a.gridUserGroup.Selections=[];a.gridUserGroup.Options=app.uiGrid.generateGridOptions({IDPreifx:"userGroup",columnDefs:a.ruFlag?[{field:"checked",isCheckbox:!0,changedCbk:q,headerChangedCbk:q},{field:"name",displayName:a.DICT("User_Groups_Group")},{field:"_ctx.weblogin",displayName:a.DICT("User_Groups_Web_Login"),
cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.webloginStr[MODEL_COL_FIELD]")},{field:"_ctx['dot1x'].ref.action",displayName:a.DICT("User_Groups_802.1x"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.actionMap[MODEL_COL_FIELD]")},{field:"_ctx['ssid'].ref",displayName:a.DICT("User_Groups_Captive_Portal"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.showProfileList(MODEL_COL_FIELD)"),
visible:1===a.rv340w_flag?!0:!1}]:[{field:"checked",isCheckbox:!0,changedCbk:q,headerChangedCbk:q},{field:"name",displayName:a.DICT("User_Groups_Group")},{field:"_ctx.weblogin",displayName:a.DICT("User_Groups_Web_Login"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.webloginStr[MODEL_COL_FIELD]")},{field:"_ctx['s2s-vpn'].ref",displayName:a.DICT("User_Groups_S2S_VPN2"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.showProfileList(MODEL_COL_FIELD)")},
{field:"_ctx['ezvpn'].ref",displayName:a.DICT("User_Groups_EzVPN_Party"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.showProfileList(MODEL_COL_FIELD)")},{field:"_ctx['anyconnect-vpn'].ref",displayName:a.DICT("User_Groups_SSL_VPN"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.showProfileList(MODEL_COL_FIELD)")},{field:"_ctx['pptp'].ref.action",displayName:a.DICT("User_Groups_PPTP"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,
"grid.appScope.schema.actionMap[MODEL_COL_FIELD]")},{field:"_ctx['l2tp'].ref.action",displayName:a.DICT("User_Groups_L2TP"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.actionMap[MODEL_COL_FIELD]")},{field:"_ctx['dot1x'].ref.action",displayName:a.DICT("User_Groups_802.1x"),cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.actionMap[MODEL_COL_FIELD]")},{field:"_ctx['ssid'].ref",displayName:a.DICT("User_Groups_Captive_Portal"),
cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.showProfileList(MODEL_COL_FIELD)"),visible:1===a.rv340w_flag?!0:!1}]});var E=function(b){var c=r.get_users_join_ref();angular.forEach(c,function(c,d){c.join=a.ifJoined(c.group,b.name);-1<c.group.indexOf(b.name)?c.readonly=!0:c.readonly=!1;a.gridUserList.check_join_state(c)})};a.showProfileList=function(b){var c="--";return c=b&&b.option&&b.option[0]?a.flags.leaflist_sep_as_space?b.option[0]:b.option.join(", "):b?"Disabled":
"--"};a.update_sslvpn=function(a){0<a.target.length&&a.target.splice(0);a.target.push({name:a.selItem})};var I=function(){var b=r.get_groups_ref().length;return 50<=b?(a.msg="Only allow maximum of 50 entries for User Groups. (Current Entry Number: "+b+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},F=function(){var b=a.gridUserGroup.Selections[0];a.gridS2SGroup.Options.data=b._ctx["s2s-vpn"].member;a.gridEZVPNGroup.Options.data=b._ctx.ezvpn.member;g(a.gridS2SGroup);g(a.gridEZVPNGroup);
1===a.rv340w_flag&&(a.gridCaptivePortalGroup.Options.data=b._ctx.ssid.member,g(a.gridCaptivePortalGroup))};a.gridUserGroup.addItem=function(){if(!I()){var b=a.model.groups,c={checked:!0,name:"","user-name":[],"feature-rule":[]};angular.forEach(b,function(a){a.checked=!1});y(c);b.push(c);B();C();l(function(){F()},50);a.gridUserGroup.edit=!0;a.gridUserGroup.action="add";a.modified()}};a.gridUserGroup.editItem=function(){var b;angular.forEach(a.model.groups,function(a,c){a.checked&&(b=a)});E(b);F();
a.gridUserGroup.edit=!0;a.gridUserGroup.action="edit"};a.gridUserGroup.delItem=function(){var b=a.model.groups,c;for(c=b.length-1;0<=c;c--)b[c].checked&&(b.splice(c,1),a.modified())};a.syncGroupName=function(b){var c=!0;a.form.txt_groupname.$setValidity("exist",!0);angular.forEach(r.get_groups_ref(),function(a,d){b!==a&&b.name===a.name&&(c=!1)});c?a.form.txt_groupname.$setValidity("exist",!0):a.form.txt_groupname.$setValidity("exist",!1)};a.gridS2SGroup=a.gridS2SGroup||{};a.gridS2SGroup.rowActionRule=
function(a,b,c){b=2;if("connect"==c.id||"disconnect"==c.id)b=a.entity.enable?1:0;return c.stateDisplay[b]};var H=function(b){return function(){var c,d;switch(b){case "ssid":d=a.gridCaptivePortalGroup;break;case "ezvpn":d=a.gridEZVPNGroup;break;case "s2s-vpn":d=a.gridS2SGroup;break;default:return}c=d.Options.data;d.Selections=[];angular.forEach(c,function(a){a.checked&&d.Selections.push(a)})}};a.gridS2SGroup.Selections=[];a.gridS2SGroup.Options=app.uiGrid.generateGridOptions({IDPreifx:"S2SGroup",columnDefs:[{field:"checked",
isCheckbox:!0,changedCbk:H("s2s-vpn"),headerChangedCbk:H("s2s-vpn")},{field:"number",displayName:"#",width:50,cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.getIndex(row, grid.rows)")},{field:"name",displayName:a.DICT("User_Groups_Connection_Name")}]});q=function(b){return function(){var c,d;switch(b){case "ssid":c=a.gridCaptivePortalGroup.Options.data;break;case "ezvpn":c=a.gridEZVPNGroup.Options.data;break;case "s2s-vpn":c=a.gridS2SGroup.Options.data;break;default:return}for(d=
c.length-1;0<=d;d--)c[d].checked&&c.splice(d,1);H(b)}};a.gridS2SGroup.remove=q("s2s-vpn");a.gridEZVPNGroup=angular.copy(a.gridS2SGroup);a.gridEZVPNGroup.Options=app.uiGrid.generateGridOptions({IDPreifx:"EZVPN",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:H("ezvpn"),headerChangedCbk:H("ezvpn")},{field:"number",displayName:"#",width:50,cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.getIndex(row, grid.rows)")},{field:"name",displayName:a.DICT("User_Groups_Group_Name_N")}]});
a.gridEZVPNGroup.delItem=q("ezvpn");1==a.rv340w_flag&&(a.gridCaptivePortalGroup=angular.copy(a.gridS2SGroup),a.gridCaptivePortalGroup.Options=app.uiGrid.generateGridOptions({IDPreifx:"captivePortal",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:H("ssid"),headerChangedCbk:H("ssid")},{field:"number",displayName:"#",width:50,cellTemplate:e.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.getIndex(row, grid.rows)")},{field:"name",displayName:a.DICT("User_Groups_SSID")}]}),a.gridCaptivePortalGroup.delItem=
q("ssid"));a.save=function(){var b=[],c=function(b,c){if(b._ctx[c]&&b._ctx[c].ref&&b._ctx[c].member){var d=[];angular.forEach(b._ctx[c].member,function(a,b){delete a.checked;null!==a.name&&angular.isDefined(a.name)&&d.push(a.name)});b._ctx[c].ref.option=a.flags.leaflist_sep_as_space?d.join(" "):d}},d=function(b){angular.forEach(b,function(b,d){if(b["feature-rule"]){var e=b["feature-rule"],g=b._ctx.weblogin,k=[];"web-login-administration"==g?k=["web-login-readonly","web-login-disabled","web-login"]:
"web-login-readonly"==g?k=["web-login-administration","web-login-disabled","web-login"]:"web-login-disabled"==g&&(k=["web-login-administration","web-login-readonly","web-login-disabled","web-login"]);for(var h=!1,l=e.length;l--;)for(var m=k.length;m--;)void 0==e[l]&&console.log("feature[k] not defined, k="+l),void 0==e[l].service&&console.log("feature[k].service not defined, k="+l),e[l].service==k[m]?(e.splice(l,1),l=0<l?l-1:l):e[l].service==g&&(h=!0);!h&&"web-login-disabled"!==g&&e.push({service:g,
action:"permit"})}b._ctx&&(c(b,"s2s-vpn"),c(b,"ezvpn"),c(b,"anyconnect-vpn"),1==a.rv340w_flag&&c(b,"ssid"),delete b._ctx);b._groupref&&delete b._groupref;angular.isDefined(b._priv)&&delete b._priv;delete b.checked});return b},e=function(b){var c=angular.copy(b),c=d(c);if(!a.gridUserGroup.edit||0>=a.gridUserGroup.Selections.length)return c;var e=a.gridUserGroup.Selections[0].name;b=r.get_users_join_ref();var g=function(b,c,d){var g;angular.forEach(b,function(b,k){if(b.name!==e)if(g=k,Log(DEBUG,"== "+
g),b["user-name"]&&b["user-name"][0]){if(d)if(a.flags.leaflist_sep_as_space)b["user-name"][0]=b["user-name"][0].replace(c.name,"").replace("  "," ").replace(/^ /,"").replace(/ $/,"");else{var h=b["user-name"].indexOf(c.name);-1<h&&(b["user-name"].splice(h,1),0==b["user-name"].length&&(b["user-name"]=[""]))}}else b["user-name"]=[""]})},k=-1;angular.forEach(c,function(a,b){a.name==e&&(k=b)});var h=c[k];angular.forEach(b,function(b,d){var e=-1;h["user-name"]&&h["user-name"][0]&&(e=a.flags.leaflist_sep_as_space?
h["user-name"][0].indexOf(b.name):h["user-name"].indexOf(b.name));b.join?(-1==e&&(h["user-name"]&&h["user-name"][0]?a.flags.leaflist_sep_as_space?h["user-name"][0]+=(0<h["user-name"][0].length?" ":"")+b.name:h["user-name"].push(b.name):(h["user-name"]=[],h["user-name"].push(b.name))),g(c,b,!0)):(a.flags.users_remove_joined_user&&-1<e&&(h["user-name"]&&h["user-name"][0])&&(a.flags.leaflist_sep_as_space?h["user-name"][0]=h["user-name"][0].replace(b.name,"").replace("  "," ").replace(/^ /,"").replace(/ $/,
""):(e=h["user-name"].indexOf(b.name),-1<e&&(h["user-name"].splice(e,1),0==h["user-name"].length&&(h["user-name"]=[""])))),g(c,b,!1))});return c}(r.get_groups_ref()),g=[],h=a.model.groups,l;angular.forEach(a.model_orig.groups,function(a){l=!1;angular.forEach(h,function(b){a.name===b.name&&(l=!0)});l||g.push({name:a.name})});var m=function(){var c=!0,d=!1;t.post({url:resource_base+"data/result_set_bulk.json",method:"set_bulk",params:b,success:function(a){var b;b={};if(a.data&&void 0!==a.data.result){var e=
a.data.result;"number"==typeof e?b.code=parseInt(e):"object"==typeof e&&(b=e,b.code=parseInt(b.code))}1==b.code?(d=c=!0,p.logout()):0==b.code?c=!0:console.log("Response unknown case: "+a.status+", URL: "+a.config.url+", ret= "+JSON.stringify(b))},error:function(b){k();a.gridUserGroup.edit=!1;a.gridUserGroup.action="";console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}}).then(function(b){c&&!1==d&&(a.success=!0);!1==d&&(k(),a.gridUserGroup.edit=!1,a.gridUserGroup.action="")})};0<g.length&&
b.push({method:"del_groups",params:{groups:{group:g}}});b.push({method:"set_groups",params:{groups:{group:e}}});a.resetModified();0<b.length&&m()};a.cancel=function(){a.gridUserGroup.edit=!1;k();a.resetModified()};a.open=function(b){s.open({templateUrl:"feature_add.htm",controller:"user_group_main_modal_add_user",size:b[0],backdrop:"static",resolve:{model:function(){return a.model},ctx:function(){return a.ctx},gridFeatureUser:function(){return b[1]},gridUserGroup:function(){return a.gridUserGroup},
userType:function(){return b[2]}}}).result.then(function(a){},function(){n.info("Modal dismissed at: "+new Date)})}}]);
app.controller("user_group_main_modal_add_user",["$scope","$uibModalInstance","$filter","model","gridUserGroup","gridFeatureUser","userType",function(a,b,s,n,v,t,m){a.gridFeatureUser=t||{};a.gridUserGroup=v||{};a.model=n||{};a.ctx=a.ctx||{};a.ctx.profile_ref=[];var q=t.Options.data;n=function(a,b,e){b=!1;a["extended-authentication"]&&!0==a["extended-authentication"].enable&&(b=!0);return b};v=function(a,b,e){e=b=!1;if(a.mode||a["group-name"])e=!0;e?b=!0:a["extended-authentication"]&&!0==a["extended-authentication"].enable&&
(b=!0);return b};t=function(a,b,e){b=!0;!1===a["captive-portal-enable"]&&(b=!1);return b};var e=function(a,b,e){var m=!0;if(0<b)for(b-=1;0<=b;b--)a.ssid===e[b].ssid&&!0===e[b]["captive-portal-enable"]&&(m=!1);return m};"S2S"==m?(a.ctx.profile_ref=a.model["site-to-sites"]["site-to-site"],a.ctx.profile_ref=s("filter")(a.ctx.profile_ref,n),a.ctx.ref_key="connection-name",a.ctx.target=q):"ezvpn"==m?(a.ctx.profile_ref=a.model["client-to-sites"]["client-to-site"],a.ctx.profile_ref=s("filter")(a.ctx.profile_ref,
v),a.ctx.ref_key="seq",a.ctx.target=q):"anyconnect-vpn"==m?(a.ctx.profile_ref=a.model.sslvpn["group-policies"]["group-policy"],a.ctx.ref_key="policy-name",a.ctx.target=q):"ssid"==m&&(a.ctx.profile_ref=a.model.wlans.ssid,a.ctx.profile_ref=s("filter")(a.ctx.profile_ref,t),a.ctx.profile_ref=s("filter")(a.ctx.profile_ref,e),a.ctx.ref_key="ssid",a.ctx.target=q);a.getNotInUseItems=function(b,e){e=e||[];var h=s("filter")(b,function(b,h,m){b=b[a.ctx.ref_key];h=!0;for(m=0;m<e.length;m++)e[m].name==b&&(h=!1);
return h});return h=h||[]};a.add=function(){a.ctx.target=a.ctx.target||[];q.push({name:a.ctx.selItem});a.modified();a.cancel()};a.cancel=function(){b.dismiss("cancel")}}]);app.controller("timeCtrl",["$scope","MyHttp","UserSession","userAccessRight","dt","goToPreviousPage",function(a,b,s,n,v,t){var m=app.TOOLS.int2str2,q=app.TOOLS.str2int,e=app.TOOLS.getVal,w=void 0,l=void 0;angular.copy(v.dayWeek);angular.copy(v.month);var h={Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6},p="Sun Mon Tue Wed Thu Fri Sat".split(" "),u=["",a.DICT("Time_1st_Week"),a.DICT("Time_2nd_Week"),a.DICT("Time_3rd_Week"),a.DICT("Time_4th_Week"),a.DICT("Time_5th_Week"),a.DICT("Time_6th_Week")];a.months=
[];a.hours=[];a.minutes=[];a.startDays=[];a.endDays=[];a.seconds=[];a.success=!1;a.dataReady=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var x=function(a,b){if(b){var c;a.m=b.month||a.m;a.d=b.day||a.d;a.dw=b["week-day"]&&h[b["week-day"]]||a.dw;a.w=isNaN(parseInt(b.week,10))?a.w:parseInt(b.week,10);c=b.time&&b.time.split(":")||[];a.hour=isNaN(parseInt(c[0],10))?a.hour:parseInt(c[0],10);a.minute=isNaN(parseInt(c[1],10))?a.minute:parseInt(c[1],10)}},r=function(){b.post({url:resource_base+
"data/time.json",method:"get_time",success:function(b){b.data&&b.data.result?d(b.data.result):d();a.chk_date();a.chk_dst();a.daylightSavingInvalid=!1;a.dataReady=!0},error:function(b){console.log("timeCtrl getData Error status: "+b.status);d();a.daylightSavingInvalid=!1;a.chk_date();a.chk_dst()}})},d=function(b){b||(b={});var d=new Date,k=b.system||{},h=k.clock||{},m=(b["system-state"]||{}).clock||{};b=h["timezone-summer-time"]||{};k=k.ntp||{};a.model.clock={timezone_name:h["timezone-name"]||"Eastern Time (US & Canada)",
current_datatime:new Date,display_curr_datatime:"-",current_timestamp:-1,curr_time:{hour:d.getHours(),minute:d.getMinutes(),second:d.getSeconds()},summer:{enabled:void 0!==b.enabled?b.enabled:!0,start:{date:"",year:0,m:1,d:1,hour:0,minute:0,w:1,dw:0},end:{date:"",year:0,m:2,d:1,hour:0,minute:0,w:1,dw:0},offset:b["saving-offset"]||0,recurring:b.recurring||!1}};m["current-datetime"]&&(d=v.parser(m["current-datetime"]),0===d.err_code&&(h=new Date(d.year,d.month,d.day),a.model.clock.current_datatime=
h,h=12>=d.hour?d.hour:d.hour-12,0===h&&(h=12),a.model.clock.current_timestamp=v.get_time(d),c(),a.model.clock.curr_time={hour:d.hour,minute:d.minute,second:d.second},l&&(clearInterval(l),l=void 0),l=setInterval(function(){a.model.clock.current_timestamp+=1E3;c()},1E3)));a.model.clock.summer.start.year=a.model.clock.current_datatime.getYear()+1900;a.model.clock.summer.end.year=a.model.clock.current_datatime.getYear()+1900;x(a.model.clock.summer.start,b["start-date"]);x(a.model.clock.summer.end,b["end-date"]);
var r,n;a.model.ntp={enabled:void 0!==k.enabled?k.enabled:!0,ntp_default:!1,server1:{name:"0",address:"",def_address:"0.ciscosb.pool.ntp.org",port:123},server2:{name:"1",address:"",def_address:"1.ciscosb.pool.ntp.org",port:123},server3:{name:"2",address:"",def_address:"2.ciscosb.pool.ntp.org",port:123},server4:{name:"3",address:"",def_address:"3.ciscosb.pool.ntp.org",port:123}};k.server&&angular.forEach(k.server,function(b,c){r=q(b.name);switch(r){case 0:case 1:case 2:case 3:break;default:return}n=
"server"+(r+1);angular.extend(a.model.ntp[n],{name:e(b.name,b.name),address:e(b.udp&&b.udp.address,""),port:q(e(b.udp&&b.udp.port,123))})});a.model.orig_ntp=angular.copy(a.model.ntp);""===a.model.ntp.server1.address&&(""===a.model.ntp.server2.address&&""===a.model.ntp.server3.address&&""===a.model.ntp.server4.address)&&(a.model.ntp.ntp_default=!0)};a.daylightSavingInvalid=!1;a.model={clock:{},ntp:{},orig_ntp:{},schema:{},back_btn:!1};a.date={format:"yyyy-MM-dd",options:{formatYear:"yyyy",startingDay:0},
disabled:function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},minDate:null,opened:!1,open:function(){a.date.opened=a.model.ntp.enabled?!1:!0}};a.funs={go_back:t.goback,save:function(){var c=a.model.clock,d=c.summer,e=a.model.ntp,k=a.model.orig_ntp,h=c.current_datatime,l=h.getYear()+1900,n=d.start,q=d.end,u=[],s,t,h=m(l)+"-"+m(h.getMonth()+1)+"-"+m(h.getDate())+"T"+m(c.curr_time.hour)+":"+m(c.curr_time.minute)+":"+m(c.curr_time.second),x={system:{clock:{"timezone-name":c.timezone_name},
ntp:{enabled:e.enabled,server:[]}}},w={rpc:"set-current-datetime",input:{"current-datetime":h}};d.recurring?(s={month:n.m,time:m(n.hour)+":"+m(n.minute),week:n.w,"week-day":p[n.dw]},t={month:q.m,time:m(q.hour)+":"+m(q.minute),week:q.w,"week-day":p[q.dw]}):(s={month:n.m,time:m(n.hour)+":"+m(n.minute),day:n.d},t={month:q.m,time:m(q.hour)+":"+m(q.minute),day:q.d});a.daylightSavingInvalid=!1;var L=function(){e.enabled?r():b.post({method:"action",params:w,success:function(b){a.success=!0;r()},error:function(a){r()}})},
N=function(){var a=!1,b,c;if(!e.ntp_default)for(c=1;5>c;c++)b="server"+c,e[b].address&&(x.system.ntp.server.push({name:e[b].name,udp:{address:e[b].address}}),a=!0);a||delete x.system.ntp.server;x.system.clock["timezone-summer-time"]={enabled:d.enabled};!0===d.enabled&&angular.extend(x.system.clock["timezone-summer-time"],{"saving-offset":d.offset,recurring:d.recurring,"start-date":s,"end-date":t});u.push({method:"set_time",params:x})},M=function(){P();N();b.post({method:"set_bulk",params:u,success:function(b){v.setTimezoneName(c.timezone_name);
a.success=!0;L()},eorro:function(a){L()}})},P=function(){var a,b,c=[];for(b=1;5>b;b++)a="server"+b,k[a].address&&(!e[a].address||e.ntp_default)&&c.push({name:k[a].name});c.length&&u.push({method:"del_time",params:{system:{ntp:{server:c}}}})};!0===d.enabled?(l={year:l,recurring:d.recurring,"saving-offset":d.offset},angular.extend(l,{"start-date":s,"end-date":t}),b.post({method:"action",params:{rpc:"clock-check-dst",input:l},success:function(b){b=b.data||{};b.result&&b.result.output&&0===b.result.output.code?
M():a.daylightSavingInvalid=!0;a.resetModified()},error:function(b){a.daylightSavingInvalid=!0;a.resetModified()}})):(M(),a.resetModified())},cancel:function(){r();a.resetModified()}};a.checkNTPServer=function(b){k();w=setTimeout(function(){var b,c,d,e,g=a.model.ntp;w=void 0;var k={server1:!0,server2:!0,server3:!0,server4:!0};if(!a.model.ntp.ntp_default&&a.model.ntp.enabled)for(b=1;5>b;b++){d="server"+b;for(c=b+1;5>c;c++)e="server"+c,g[d].address&&(g[e].address&&g[d].address===g[e].address)&&(k[d]=
!1,k[e]=!1)}a.timeform.server1.$setValidity("repeat",k.server1);a.timeform.server2.$setValidity("repeat",k.server2);a.timeform.server3.$setValidity("repeat",k.server3);a.timeform.server4.$setValidity("repeat",k.server4);app.TOOLS.apply(a)},100)};var c=function(){var b=a.model.clock,c;-1===b.current_timestamp?b.display_curr_datatime="-":(c=v.new_date(b.current_timestamp),b.display_curr_datatime=v.timeStr(c));app.TOOLS.apply(a)},k=function(){void 0!==w&&(clearTimeout(w),w=void 0)};a.chk_date=function(){var b=
void 0,c=function(b){a.timeform.slct_date&&a.timeform.slct_date.$setValidity("invalid-year",b)};a.model.clock.current_datatime&&(b=a.model.clock.current_datatime.getFullYear());void 0===b?c(!1):2037<b||1970>b?c(!1):(c(!0),a.chk_dst())};a.chk_dst=function(){var b=a.model.clock.current_datatime,c=a.model.clock.summer,d;b&&(d=b.getFullYear());if(void 0!==d){var e,k;a.startDays=[];a.startWeeks=[];b=(new Date(d,c.start.m,0)).getDate();e=(new Date(d,c.start.m-1,1)).getDay();(new Date(d,c.start.m-1,1)).getDate();
e=1+Math.ceil((b+e-7)/7);for(k=1;k<=b;k++)a.startDays.push({id:k,displayName:m(k)});c.start.d>b&&(c.start.d=1);for(k=1;k<e;k++)a.startWeeks.push({id:k,displayName:u[k]});a.startWeeks.push({id:e,displayName:a.DICT("Time_Last_Week")});c.start.w>e&&(c.start.w=1);a.endDays=[];a.endWeeks=[];b=(new Date(d,c.end.m,0)).getDate();e=(new Date(d,c.end.m-1,1)).getDay();(new Date(d,c.end.m-1,1)).getDate();e=1+Math.ceil((b+e-7)/7);for(k=1;k<=b;k++)a.endDays.push({id:k,displayName:m(k)});c.end.d>b&&(c.end.d=1);
for(k=1;k<e;k++)a.endWeeks.push({id:k,displayName:u[k]});a.endWeeks.push({id:e,displayName:a.DICT("Time_Last_Week")});c.end.w>e&&(c.end.w=1)}};a.$on("$destroy",function(){k();l&&(clearInterval(l),l=void 0)});t.isneed()&&(a.model.back_btn=!0);(function(){a.model.schema={timezone:[],shortweek:v.dayWeekab,daylight_offset:[]};var b,c={},d=[],e;for(b=-4;4>=b;b++)a.model.schema.daylight_offset.push({id:15*b,displayName:(0>15*b?"":"+")+15*b});a.hours=[];a.minutes=[];a.seconds=[];a.months=[];for(b=1;12>=
b;b++)a.months.push({id:b,displayName:b+""});for(b=0;24>b;b++)a.hours.push({id:b,displayName:m(b)});for(b=0;60>b;b++)a.minutes.push({id:b,displayName:m(b)});for(b=0;60>b;b++)a.seconds.push({id:b,displayName:m(b)});Timezone.sort(function(a,b){return a.offset<b.offset?-1:a.offset>b.offset?1:a.display<b.display?-1:a.display>b.display?1:0});angular.forEach(Timezone,function(a,b){a.is_cisco&&!c[a.cisco_display]&&(c[a.cisco_display]=!0,e=1E3+a.offset,d[e]||(d[e]=[]),d[e].push({id:a.tz,displayName:a.cisco_display,
offset:a.offset}))});angular.forEach(d,function(b){b&&(b.sort(function(a,b){var c=a.displayName.match(/^\(UTC .\d+:\d+. (.*)/),d=b.displayName.match(/^\(UTC .\d+:\d+. (.*)/),c=c&&c[1]||"",d=d&&d[1]||"";return!c||!d?0:c<d?-1:c>d?1:0}),a.model.schema.timezone=a.model.schema.timezone.concat(b))})})();r()}]);app.controller("discovery_bonjour",["$scope","MyHttp","wan_service","UserSession","userAccessRight",function(a,b,s,n,v){a.success=!1;a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var t=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var h;a.skip_bonjour_update_once||(a.model.ifs=[]);a.filterWANphy={physical:!1,subinterface:!1};var l=s.filter(b,a.filterWANphy),d=[];angular.forEach(b,function(a,b){"VLAN"===a.name.substr(0,4)&&d.push(a)});d=d.concat(l);
angular.forEach(d,function(b,d){if(!a.skip_bonjour_update_once){h=b.bonjour||{};var e="";a.model.ifs_state[b.name]&&(e=""!==a.model.ifs_state[b.name].ip?a.model.ifs_state[b.name].ip:"");a.model.ifs.push({name:b.name,ip:e,edit:!0,bonjour:{enable:void 0!==h.enable?h.enable:!0}})}});a.gridBonjourOptions.data=a.model.ifs;a.skip_bonjour_update_once=!1;e.ifs=!0;q()},m=function(b){b||(b={});angular.forEach((b["interfaces-state"]||{})["interface"]||[],function(b,e){if(b.name){var d=b.ipv4||{};a.model.ifs_state[b.name]=
{ip:(d.address&&d.address[0]||"").ip||""}}});e.ip=!0},q=function(){e.ifs&&(e.ip&&e.nat&&e.bonjour)&&(angular.forEach(a.model.ifs,function(b,e){a.model.nat[b.name]&&!0===a.model.nat[b.name].nat&&(a.model.ifs[e].edit=!1)}),a.dataReady=!0)};a.dataReady=!1;var e={ifs:!1,ip:!1,nat:!1,bonjour:!1},w=function(){b.post({method:"get_nat",url:resource_base+"data/bonjour_nat.json",success:function(a){a.data&&a.data.result?l(a.data.result):l()},error:function(a){console.log("getInterfacesNat error status: "+a.status);
l()}})},l=function(b){b||(b={});angular.forEach((b.interfaces||{})["interface"]||[],function(b,e){if(b.name.match(/^WAN/)||b.name.match(/^VLAN/))a.model.nat[b.name]={nat:b.nat&&void 0!==b.nat.enable?b.nat.enable:!1}});e.nat=!0},h=function(a){b.post({url:resource_base+"data/bonjour.json",method:"get_bonjour",success:function(b){b.data&&b.data.result?a?a(b.data.result):(m(b.data.result),p(b.data.result),t(b.data.result)):a?a():(p(),t())},error:function(b){a?a():(p(),t());console.log("discovery_bonjour getbonjourData error status: "+
b.status)}})},p=function(b){b||(b={});b=b["bonjour-global"]||{};a.model.bonjour={enable:void 0!==b.enable?b.enable:!0};e.bonjour=!0};a.model={ifs:[],ifs_state:[],bonjour:{},nat:{},select:-1,refreshInterval:!1};a.funs={save:function(){var e={interfaces:{"interface":[]}},h={"bonjour-global":{enable:a.model.bonjour.enable}};angular.forEach(a.model.ifs,function(a,b){e.interfaces["interface"].push({name:a.name,bonjour:{enable:a.bonjour.enable}})});angular.extend(h,e);b.post({method:"set_bonjour",params:h,
success:function(b){a.success=!0;a.resetModified()},error:function(b){a.resetModified()}})},cancel:function(){w();h();a.resetModified()},refresh:function(){a.skip_bonjour_update_once=!0;h(t)}};a.gridBonjourOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"name",displayName:a.DICT("Discovery_Bonjour_Avaliable_Interface")},{field:"ip",displayName:a.DICT("Discovery_Bonjour_IP_Addr")},{field:"bonjour.enable",displayName:a.DICT("Discovery_Bonjour_Enable_Bonjour"),editRow:"edit",id:"Bonjour",
cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});w();h()}]);app.controller("systemCtrl",["$scope","MyHttp","UserSession","userAccessRight","goToPreviousPage",function(a,b,s,n,v){a.success=!1;a.loadReady=!1;a.dataReady=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var t=function(){b.post({url:resource_base+"data/sys_system.json",method:"get_sys_info",success:function(b){b.data&&b.data.result?m(b.data.result):m();a.dataReady=!0;a.loadReady=!0},error:function(a){console.log("systemCtrl getData Error status: "+a.status)}})},
m=function(b){b||(b={});b=b.system||{};a.model.hostname=void 0!==b.hostname?b.hostname:"";a.model.domainname=void 0!==b["domain-name"]?b["domain-name"]:""};a.model={hostname:"",domainname:"",back_btn:!1};a.funs={save:function(){b.post({method:"set_sys_info",params:{system:{hostname:a.model.hostname,"domain-name":a.model.domainname}},success:function(b){a.success=!0;t();a.resetModified()},eorro:function(b){t();a.resetModified()}})},cancel:function(){t();a.resetModified()},go_back:v.goback};v.isneed()&&
(a.model.back_btn=!0);t()}]);app.controller("gettingStartedCtrl",["$scope","MyHttp","$cookies","userAccessRight","oneTimeLocker","$location",function(a,b,s,n,v,t){a.disable_startup="1"===s.get("disable-startup");a.ruFlag=n.russia();a.goto_setup_wizard=function(){v.put("WIZARDS","setup_wizard");t.url("Configuration_Wizards/")};a.goto_application_wizard=function(){v.put("WIZARDS","application_wizard");t.url("Configuration_Wizards/")};a.goto_vpn_wizard=function(){v.put("WIZARDS","vpn_wizard");t.url("Configuration_Wizards/")};a.change_startup=
function(){var m=a.disable_startup?"1":"0";b.post({method:"set_gui",params:{gui:{"disable-startup-page":a.disable_startup}},success:function(a){s.put("disable-startup",m)},error:function(a){}})}}]);app.controller("ipGroupCtrl",["$scope","MyHttp","$uibModal","$templateCache","UserSession","userAccessRight","device_os_type","$q","goToPreviousPage",function(a,b,s,n,v,t,m,q,e){var w=app.TOOLS.netmask.inet2Int,l=app.TOOLS.getVal;a.success=!1;a.loadReady=!1;a.backbtn=!1;a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();e.isneed()&&(a.backbtn=!0);var h=function(){return b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup",error:function(a){console.log("ipGroupCtrl getIPGroupData error "+
a.status);p()}})},p=function(b){b||(b={});var d=[];b["ip-groups"]&&b["ip-groups"]["ip-group"]&&(d=b["ip-groups"]["ip-group"]);var e=0;a.model.ipgroups=[];angular.forEach(d,function(b,c){a.model.ipgroups.push(u(b,c))});angular.forEach(a.model.ipgroups,function(a){void 0!==a.name&&(a.id="group"+e,e++)});c();a.gridMainOptions.data=a.model.ipgroups;a.gridMainOptions.gridApi&&(a.gridMainOptions.gridApi&&_.isFunction(a.gridMainOptions.gridApi.customApi.checkSelectStatus))&&setTimeout(function(){a.gridMainOptions.gridApi.customApi.checkSelectStatus()},
50);a.model.orig=angular.copy(a.model.ipgroups)},u=function(a,b){a||(a={});var c={name:a.name||"",orig_name:a.name||"",macRepeated:!1,popover:"",edit:!1,modify:!1,checked:!1,type:"",uniqueKey:b,action:[],ips:[],macs:[]},d=a.macs||[];angular.forEach(a.ips||[],function(a){c.ips.push(x(a,void 0,c.name))});angular.forEach(d,function(a){c.macs.push(r(a,!0))});return c},x=function(b,c,d){var e,g,k,h;e=b["os-type"];g=b["device-type"];_.isUndefined(e)&&(e="ANY");_.isUndefined(g)&&(g="ANY");k={edit:!1,groupKey:d,
checked:!1,disableChk:!1,seq:void 0!==b.seq?b.seq:void 0!==c&&!isNaN(parseInt(c,10))?c:0,proto:{select:"ipv4",list:a.schema.protos},type:{select:"single",list:a.schema.types},setting:{detailStr:"",ipv4:{ip:"",subnet_ip:"",subnet_netmask:"255.255.255.0",subnet_prefix:24,start:"",end:""},ipv6:{ip:"",subnet_ip:"",subnet_netmask:"",start:"",end:""}},os_type:{select:e,list:[]},device_type:{select:g,list:[]}};angular.forEach(b.ipv4,function(a,b){switch(b){case "subnet":k.setting.ipv4.subnet_ip=a.ip||"";
k.setting.ipv4.subnet_netmask=a.netmask||"";k.setting.ipv4.sub_prefix=w(k.setting.ipv4.subnet_netmask);k.type.select="subnet";break;case "single":k.setting.ipv4.ip=a||"";k.type.select="single";break;case "range":k.setting.ipv4.start=a.start||"";k.setting.ipv4.end=a.end||"";k.type.select="range";break;default:return}k.proto.select="ipv4"});angular.forEach(b.ipv6,function(a,b){switch(b){case "subnet":h=parseInt(a["prefix-length"],10);k.setting.ipv6.subnet_ip=a.ip||"";k.setting.ipv6.subnet_netmask=isNaN(h)?
"":h;k.type.select="subnet";break;case "single":k.setting.ipv6.ip=a||"";k.type.select="single";break;case "range":k.setting.ipv6.start=a.start||"";k.setting.ipv6.end=a.end||"";k.type.select="range";break;default:return}k.proto.select="ipv6"});return k},r=function(a,b){a||(a={});var c=a["os-type"]||"",d=a["device-type"]||"";b&&(c||(c="ANY"),d||(d="ANY"));return{mac:a.mac||"",os_type:{select:c,list:[]},device_type:{select:d,list:[]},invalid:!1,repeatedWithOtherGroup:!1,repeatedWithOtherEntity:!1,edit:!1,
disableChk:!1,empty:""}},d=function(a){var b=a.proto.select,c="-";switch(a.type.select){case "single":c=a.setting[b].ip;break;case "range":c=a.setting[b].start+" - "+a.setting[b].end;break;case "subnet":prefix="ipv4"===b?w(a.setting[b].subnet_netmask):a.setting[b].subnet_netmask;prefix=parseInt(prefix,10);if(isNaN(prefix))break;c=a.setting[b].subnet_ip+"/"+prefix}return c},c=function(){var b,c,e=a.model.ipgroups,g=e.length,k=[];angular.forEach(e,function(a){a.macRepeated=!1});angular.forEach(e,function(a,
k){a.popover="";angular.forEach(a.ips,function(c,e){c.seq=e;c.setting.detailStr="-";b=d(c);"-"!==b&&(a.popover=a.popover+"<div>"+b+"</div>",c.setting.detailStr=b)});angular.forEach(a.macs,function(b){for(c=k+1;c<g;c++)angular.forEach(e[c].macs,function(d){b.mac===d.mac&&(a.macRepeated=!0,e[c].macRepeated=!0)})})});a.ui_data.mac_repeat_note="";angular.forEach(e,function(a){a.macRepeated&&k.push(a.name)});k.length&&(a.ui_data.mac_repeat_note=a.DICT("IP_Address_Group_Mac_Repeated_Note",{"%s":"<b>"+k.join(", ")+
"</b>"}))},k=function(){q.all([h(),m.get()]).then(function(b){a.sel_cnts=0;a.sel_device_cnts=0;a.model.device=b[1]&&b[1].device||[];a.model.os=b[1]&&b[1].os||[];a.model.def_device=m.get_default_device_type(a.model.device);a.model.def_os=m.get_default_os_type(a.model.os[a.model.def_device]);p(b[0]&&b[0].data.result);a.resetModified();a.loadReady=!0})};a.edit={};a.model={ipgroups:[],os:[],device:[],def_os:"",def_device:""};a.ui_data={mac_repeat_note:""};a.schema={protos:[{id:"ipv4",displayName:a.DICT("IP_Address_Group_IPv4")},
{id:"ipv6",displayName:a.DICT("IP_Address_Group_IPv6")}],types:[{id:"single",displayName:a.DICT("IP_Address_Group_IP_Addr")},{id:"subnet",displayName:a.DICT("IP_Address_Group_IP_Addr_Subnet")},{id:"range",displayName:a.DICT("IP_Address_Group_IP_Addr_Range")}]};n=function(b){a.sel_cnts=0;angular.forEach(a.model.ipgroups,function(b){b.checked&&(a.sel_cnts+=1)})};a.gridMainOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:n,headerChangedCbk:n},{field:"name",
name:"name",displayName:a.DICT("IP_Address_Group_Group_Name_N"),id:"IPGroupName"},{field:"popover",name:"popover",displayName:a.DICT("IP_Address_Group_Detail"),cellTemplate:"UG_table_icon_with_popover_html.html"}]});var g=function(){return 50<=a.model.ipgroups.length?(a.msg="Only allow maximum of 50 entries for IP Address Group. (Current Entry Number: "+a.model.ipgroups.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},z=function(b){s.open({animation:a.animationsEnabled,
templateUrl:"ipgroup_edit.html",controller:"ipgroupEditCtrl",size:"ip-address-edit",backdrop:"static",resolve:{model:function(){return a.model},edit:function(){return a.edit},genIpsAtom:function(){return x},genMacAtom:function(){return r},genDetailStr:function(){return d}}}).result.then(function(c){a.edit=c;"function"===$.type(b)&&b(!0)},function(c){a.resetModified();"function"===$.type(b)&&b(!1)})};a.funs={goback:e.goback,create:function(){if(!g()){var b=u({},a.model.ipgroups.length);b.modify=!0;
b.edit=!0;a.edit=b;a.modified();z(function(c){Log(DEBUG,"Create for modal result: "+c);c&&(a.model.ipgroups.push(b),a.funs.save())})}},editGroup:function(){var b;a.modified();angular.forEach(a.model.ipgroups,function(c){c.checked&&(b=angular.copy(c),b.modify=!0,a.edit=b)});z(function(b){Log(DEBUG,"Edit for modal result: "+b);b?(angular.forEach(a.model.ipgroups,function(b,c){a.edit.uniqueKey===b.uniqueKey&&(a.model.ipgroups[c]=a.edit)}),a.funs.save()):a.resetModified()})},delGroup:function(b,d,e){b=
a.model.ipgroups;for(d=b.length-1;0<=d;d--)b[d].checked&&b.splice(d,1);angular.forEach(a.model.ipgroups,function(a,b){a.uniqueKey=b});c();a.modified()},cancel:function(){k()},save:function(){var c=a.model.ipgroups,d=a.model.orig,e=[],g=[],h=[],m=[],n=[],r=[],p=[],q,s,u,z,t;angular.forEach(d,function(a){s=!0;angular.forEach(c,function(b){a.name===b.name&&(s=!1)});s&&m.push({name:a.name})});angular.forEach(c,function(a,b){if(!1!==a.modify){q=void 0;angular.forEach(d,function(b,c){a.name===b.name&&(q=
b)});if(q&&(h=[],angular.forEach(q.ips,function(b){s=!0;angular.forEach(a.ips,function(a){b.seq===a.seq&&(s=!1)});s&&h.push({seq:b.seq})}),r=[],angular.forEach(q.macs,function(b){s=!0;angular.forEach(a.macs,function(a){b.mac===a.mac&&(s=!1)});s&&r.push({mac:b.mac})}),h.length||r.length))t={name:a.name},h.length&&(t.ips=h),r.length&&(t.macs=r),m.push(t);g=[];angular.forEach(a.ips,function(a,b){u={seq:a.seq,"device-type":a.device_type.select,"os-type":a.os_type.select};z=a.proto.select;switch(a.type.select){case "single":u[z]=
{single:a.setting[z].ip};break;case "range":u[z]={range:{start:a.setting[z].start,end:a.setting[z].end}};break;case "subnet":u[z]="ipv4"===z?{subnet:{ip:a.setting[z].subnet_ip,netmask:a.setting[z].subnet_netmask}}:{subnet:{ip:a.setting[z].subnet_ip,"prefix-length":a.setting[z].subnet_netmask}};break;default:Log(ERROR,"type is "+a.type.select);return}g.push(u)});p=[];angular.forEach(a.macs,function(a,b){p.push({mac:a.mac,"os-type":a.os_type.select,"device-type":a.device_type.select})});e.push({name:a.name,
ips:g,macs:p})}});m.length&&n.push({method:"del_ipgroup",params:{"ip-groups":{"ip-group":m}}});e.length&&n.push({method:"set_ipgroup",params:{"ip-groups":{"ip-group":e}}});n.length?b.post({method:"set_bulk",params:n,forcedUsingPost:!0,success:function(b){var c=b.data&&b.data.result||{};b=l(c.code,0);c=l(c.errstr,"");switch(b){case 0:a.success=!0;break;default:b="",c?-1!==c.indexOf("/ciscosb-avc:avc/")?b=a.DICT("Web_Filtering_Delete_Failure_AVC_Msg"):-1!==c.indexOf("/ciscosb-vpn-ipsec:site-to-sites/")?
b=a.DICT("Web_Filtering_Delete_Failure_S2S_Msg"):-1!==c.indexOf("/ciscosb-webfilter:webfilter/")&&(b=a.DICT("Web_Filtering_Delete_Failure_Webfilter_Msg")):b="",b=b?"<div>"+a.DICT("Web_Filtering_Delete_Failure_Default_Msg")+"</div><div>"+b+"</div>":a.DICT("Web_Filtering_Delete_Failure_Default_Msg"),app.TOOLS.criticalAlertBox({msg:b})}k()},error:function(a){k()}}):k()}};k()}]);
app.controller("ipgroupEditCtrl",["$scope","$templateCache","$uibModalInstance","model","edit","UserSession","userAccessRight","genIpsAtom","genMacAtom","genDetailStr",function(a,b,s,n,v,t,m,q,e,w){a.model=n;a.edit=v;a.sel_cnts=0;a.sel_device_cnts=0;a.device=n.device;a.os=n.os;a.note=a.DICT("IP_Address_Group_Note",{"%s":"<a ng-click=\"funs.jump('client_statistics')\">"+a.DICT("Here")+"</a>"});var l=app.TOOLS.netmask.inet2Int,h=app.TOOLS.netmask.int2Inet;angular.forEach(a.edit.macs,function(b){b.device_type.list=
a.device;b.os_type.list=a.os[b.device_type.select]});angular.forEach(a.edit.ips,function(b){b.device_type.list=a.device;b.os_type.list=a.os[b.device_type.select];b.setting.detail=w(b)});var p=function(a){var b;angular.forEach(a,function(a){"ANY"===a.id&&(b=a.id)});b||(b=a[0]&&a[0].id||"");return b};v=function(){a.sel_cnts=0;angular.forEach(a.edit.ips,function(b,d){b.checked?a.sel_cnts+=1:b.edit&&(b.edit=!1,b.setting.detailStr=w(b))})};t=function(){a.sel_device_cnts=0;angular.forEach(a.edit.macs,function(b){b.checked?
a.sel_device_cnts+=1:b.edit&&(b.edit=!1)})};var u=function(){var b=a.model.ipgroups,d=a.edit,c=a.edit.macs,e=c.length,g,h=[],l,m;angular.forEach(c,function(a){a.invalid=!1;a.repeatedWithOtherGroup=!1;a.repeatedWithOtherEntity=!1;a.errstr=""});angular.forEach(b,function(b){if(!(d.orig_name&&b.orig_name===d.orig_name)){g=b.macs;for(l=0;l<e;l++){h=[];for(m=g.length-1;0<=m;m--)g[m].mac===c[l].mac&&(c[l].repeatedWithOtherGroup=!0,h.push(b.name));h.length&&(c[l].errstr="<div>"+a.DICT("IP_Address_Group_Mac_Repeated_With_Other_Group",
{"%s":h.join(",")})+"</div>")}}});for(l=0;l<e;l++){for(m=l+1;m<e;m++)c[l].mac===c[m].mac&&(c[l].repeatedWithOtherEntity=!0,c[m].repeatedWithOtherEntity=!0);c[l].repeatedWithOtherEntity&&(c[l].errstr+="<div>"+a.DICT("IP_Address_Group_Mac_Repeated_With_Other_Mac")+"</div>");c[l].invalid=c[l].repeatedWithOtherGroup||c[l].repeatedWithOtherEntity}};a.ipsValidationCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.macValidationCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridIPSOptions=
app.uiGrid.generateGridOptions({rowHeight:1.5*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:v,headerChangedCbk:v,disableChkBoxField:"disableChk"},{name:"proto",field:"proto",displayName:a.DICT("IP_Address_Group_Protocol"),editRow:"edit",width:90,id:"Protocol",cellTemplate:"UG_table_select_with_inline_edit.html"},{name:"type",field:"type",displayName:a.DICT("IP_Address_Group_Type"),editRow:"edit",width:165,id:"Type",cellTemplate:"UG_table_select_with_inline_edit.html"},
{name:"detail",field:"setting",displayName:a.DICT("IP_Address_Group_Addr_Details"),id:"detail",editRow:"edit",minWidth:255,cellTemplate:"ip_group_sub_detail_cell.html",validationCbk:"ipsValidationCbk"},{name:"device_type",field:"device_type",displayName:a.DICT("IP_Address_Group_Device_Type"),editRow:"edit",minWidth:130,cellTemplate:"UG_table_select_with_inline_edit.html",changedCbk:function(b,d,c,e){b=d.entity;b.os_type.list=a.os[b.device_type.select];b.os_type.select=p(b.os_type.list)}},{field:"os_type",
displayName:a.DICT("IP_Address_Group_Os_Type"),minWidth:130,cellTemplate:"UG_table_select_with_inline_edit.html",editRow:"edit"}]});a.gridMacOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:t,headerChangedCbk:t,disableChkBoxField:"disableChk"},{field:"mac",displayName:a.DICT("IP_Address_Group_MAC_Address"),minWidth:150,maxWidth:200,id:"mac",change:u,required:!0,editRow:"edit",invalidField:"invalid",cellTemplate:b.get("IP_Address_text_with_inline_edit.html").replace(/data-ng-expansion/,
"mac-address"),validationCbk:"macValidationCbk"},{field:"device_type.select",displayName:a.DICT("IP_Address_Group_Device_Type")},{field:"os_type.select",displayName:a.DICT("IP_Address_Group_Os_Type")},{field:"empty",isEmpty:!0}]});a.gridIPSOptions.data=a.edit.ips;a.gridMacOptions.data=a.edit.macs;a.ipGroupCbk=function(b){var d,c,e,g=a.model.ipgroups,h=a.model.ipgroups.length;c=a.edit.name;e=a.edit.uniqueKey;d=!0;for(b=0;b<h;b++)e!==g[b].uniqueKey&&c===g[b].name&&(d=!1);Log(DEBUG,"IP Address Group Name validation: "+
d);return d};var x=function(b){var d,c;switch(b){case "ip":d=a.edit.ips;c="IP Address";break;case "mac":d=a.edit.macs,c="MAC Address"}return 50<=d.length?(a.msg="Only allow maximum of 50 entries for "+c+". (Current Entry Number: "+d.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.ipv4={change_netmask:function(a){a=a.entity.setting.ipv4;a.subnet_netmask&&(a.subnet_prefix=l(a.subnet_netmask))},change_prefix:function(a){a=a.entity.setting.ipv4;_.isNumber(a.subnet_prefix)&&
(a.subnet_netmask=h(a.subnet_prefix))}};a.funs={addIps:function(){if(!x("ip")){var b=q({},a.edit.ips.length,a.edit.uniqueKey);b.edit=!0;b.checked=!0;b.device_type.list=a.device;b.device_type.select=n.def_device;b.os_type.list=a.os[b.device_type.select];b.os_type.select=p(b.os_type.list);a.edit.ips.push(b)}},editIps:function(){angular.forEach(a.edit.ips,function(a){a.checked&&(a.edit=!0)})},delIps:function(){var b;for(b=a.edit.ips.length-1;0<=b;b--)a.edit.ips[b].checked&&a.edit.ips.splice(b,1);angular.forEach(a.edit.ips,
function(a,b){a.seq=b})},addMac:function(){if(!x("mac")){var b=e();b.disableChk=!0;b.checked=!0;b.edit=!0;b.device_type.list=a.device;b.device_type.select=n.def_device;b.os_type.list=a.os[b.device_type.select];b.os_type.select=p(b.os_type.list);a.edit.macs.push(b)}},editMac:function(){angular.forEach(a.edit.macs,function(a){a.checked&&(a.edit=!0)})},deleteMac:function(){var b=a.edit.macs,d;for(d=b.length-1;0<=d;d--)b[d].checked&&b.splice(d,1);u()},save:function(){s.close(a.edit)},cancel:function(){s.dismiss("cancel")},
jump:function(a){app.TOOLS.jumpToPage(a,void 0,function(a){a&&s.dismiss("cancel")})}};u()}]);app.controller("automaticUpdateCtrl",["$scope","MyHttp","UserSession","userAccessRight","$templateCache","dt",function(a,b,s,n,v,t){a.success=!1;a.checkNowFail=!1;a.checkNowSuccess=!1;a.dataReady=!1;a.errstr="check latest version error";a.jumpToPage=app.TOOLS.jumpToPage;a.notification_msg=a.DICT("Automatic_Updates_Msg2",{"%s":"<a ng-click=\"jumpToPage('System_Config_Email')\">"+a.DICT("Automatic_Updates_Here")+"</a>"});a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();
var m=function(b){b||(b={});var h=b;h||(h={});var h=h.image&&h.image["auto-update-global"]||{},l=h.notification&&h.notification.email||{};a.model.auto_update_global={};a.model.auto_update_global={enable:h.enable||!1,check_frequency:h["check-frequency"]||a.model.schema.checkFrequencys[2].id,email:l.address||"",bEmail:l.enabled||!1,bGUI:!0};a.model.autoUpdateGridData=[];(l=b)||(l={});var h=(l.image&&l.image.firmware||{})["auto-update"]||{},l=l["image-state"]&&l["image-state"].firmware||{},d=l["latest-version"]||
"",c=l["available-version"]||"",k="",g=t.genTimeStrByTimeStamp(l["latest-update-time"],""),m={};c&&d?k="Version "+d+(g?" was applied on "+g:"")+", Version "+c+" is available on Cisco.com.":!c&&d&&(k="Version "+d+(g?" was applied on "+g:""));k||(k="-");m={type:"firmware",name:a.DICT("Automatic_Updates_System_Firmware"),edit:!0,version:d,notify:void 0!==h.notify?h.notify:!1,update_option:h["update-option"]||"never",list:a.model.schema.firewall_usb_options,update_time:h["update-time"]||0,available_version:l["available-version"]||
"",last_check_time:l["last-check-time"]||"",state:k};e(h,m);a.model.autoUpdateGridData.push(m);(l=b)||(l={});h=(l["dongle-driver"]||{})["auto-update"]||{};l=l["dongle-driver-state"]||{};d=l["available-version"]||"";c=l.version||"";k="";g=t.genTimeStrByTimeStamp(l["latest-update-time"],"");m={};d&&c?k="Version "+c+(g?" was applied on "+g:"")+", Version "+d+" is available on Cisco.com.":!d&&c&&(k="Version "+c+(g?" was applied on "+g:""));k||(k="-");m={type:"dongle",name:a.DICT("Automatic_Updates_USB_Modem_Firmware"),
edit:!0,buildin_version:c,latest_update_time:l["latest-update-time"]||"",notify:void 0!==h.notify?h.notify:!1,update_option:h["update-option"]||"never",list:a.model.schema.firewall_usb_options,update_time:h["update-time"]||0,available_version:d,last_check_time:l["last-check-time"]||"",state:k};e(h,m);a.model.autoUpdateGridData.push(m);(l=b)||(l={});b=(l.signature||{})["auto-update"]||{};(h=l["ciscosb-security:signature-state"])||(h=l["ciscosb-avc:signature-state"]);h||(h={});l=h["available-version"]||
"";d=h.version||"";c="";k=t.genTimeStrByTimeStamp(h["latest-update-time"],"");g={};l&&d?c="Version "+d+(k?" was applied on "+k:"")+", Version "+l+" is available on Cisco.com.":!l&&d&&(c="Version "+d+(k?" was applied on "+k:""));c||(c="-");g={type:"signature",name:a.DICT("Automatic_Updates_Security_Signature"),edit:!0,version:d,last_update_time:h["latest-update-time"]||"",notify:void 0!==b.notify?b.notify:!1,update_option:b["update-option"]||"never",list:a.model.schema.updateOptions,update_time:b["update-time"]||
0,available_version:l,last_check_time:h["last-check-time"]||"",state:c};e(b,g);a.model.autoUpdateGridData.push(g);a.gridAutoUpdateOptions.data=a.model.autoUpdateGridData},q=function(){b.post({url:resource_base+"data/automatic_updates.json",method:"get_auto_update",success:function(a){app.TOOLS.get_scope("headerCtrl").update_asd_notify(a);a.data&&a.data.result?m(a.data.result):m()},error:function(a){console.log("automaticUpdateCtrl getData error status: "+a.status);m()}})},e=function(a,b){var e=parseInt(a["update-time"],
10);switch(a["update-option"]){case "time":!isNaN(e)&&0<=e&&24>e?b.update=e:b.update="never";break;case "immediately":b.update="immediately";break;default:b.update="never"}},w=[{id:"never",displayName:a.DICT("Automatic_Updates_Never")},{id:"immediately",displayName:a.DICT("Automatic_Updates_Immediately")}],l=function(a){var b=!1;angular.forEach(w,function(e,d){e.id===a&&(b=!0)});return b},h=function(b){var e=a.model.auto_update_global;b.image["auto-update-global"]={enable:"none"===e.check_frequency?
!1:!0,"check-frequency":e.check_frequency,notification:{email:{enabled:e.bEmail,address:e.email},gui:e.bGUI}};return b},p=function(){q();a.dataReady=!0};a.model={autoUpdateGridData:[],schema:{checkFrequencys:[],updateOptions:[],firewall_usb_options:[]},dongle_driver:{},signature:{},auto_update_global:{},checking_status:"none",firmware:{}};a.gridAutoUpdateOptions=app.uiGrid.generateGridOptions({minRowsToShow:4,enableVerticalScrollbar:app.uiGrid.scrollbars.NEVER,enableHorizontalScrollbar:app.uiGrid.scrollbars.NEVER,
columnDefs:[{field:"name",displayName:"",enableSorting:!1,width:175},{field:"notify",displayName:a.DICT("Automatic_Updates_Notify"),width:120,editRow:"edit",cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"update",displayName:a.DICT("Automatic_Updates_Update"),editRow:"edit",width:180,cellTemplate:v.get("UG_table_text_with_inline_select_edit_and_custom_options.html").replace(/NGOPTIONS/,"m.id as m.displayName for m in row.entity.list")},{field:"state",displayName:a.DICT("Automatic_Updates_Status")}]});
a.funs={save:function(){var e={image:{}};a.checkNowFail=!1;a.checkNowSuccess=!1;e=h(e);angular.forEach(a.model.autoUpdateGridData,function(a,b){switch(a.type){case "firmware":var d=e;d.image.firmware={"auto-update":{notify:a.notify,"update-option":a.update}};l(a.update)||(d.image.firmware["auto-update"]["update-option"]="time",d.image.firmware["auto-update"]["update-time"]=a.update);e=d;break;case "dongle":d=e;d["dongle-driver"]={"auto-update":{notify:a.notify,"update-option":a.update}};l(a.update)||
(d["dongle-driver"]["auto-update"]["update-option"]="time",d["dongle-driver"]["auto-update"]["update-time"]=a.update);e=d;break;case "signature":d=e,d.signature={"auto-update":{notify:a.notify,"update-option":a.update}},l(a.update)||(d.signature["auto-update"]["update-option"]="time",d.signature["auto-update"]["update-time"]=a.update),e=d}});b.post({method:"set_auto_update",params:e,success:function(b){a.success=!0;p();a.resetModified()},error:function(b){p();a.resetModified()}})},cancel:function(){a.checkNowFail=
!1;a.checkNowSuccess=!1;p();a.resetModified()},checkNow:function(){a.checkNowSuccess=!1;a.checkNowFail=!1;var b=app.TOOLS.get_scope("backgroundAppCtrl");b&&(b.firmware_lib&&"function"===$.type(b.firmware_lib.check_firmware))&&"start"===b.firmware_lib.check_firmware()&&(a.model.checking_status="checking")}};a.hasNewVersionCbk=function(a){p();console.log("has new firmware")};a.invokeCheckingSuccessCbk=function(b,e){a.model.checking_status="finish";a.errstr=e;!0===b?(e||(e=a.DICT("Success")),app.TOOLS.successAlertBox({title:a.DICT("Information"),
msg:e,cbk:function(){p()}})):(e||(e=a.DICT("Failure")),app.TOOLS.criticalAlertBox({title:a.DICT("Alert"),msg:e,cbk:function(){p()}}))};(function(){var b;a.model.schema={checkFrequencys:[{id:"none",displayName:a.DICT("Automatic_Updates_Never")},{id:"weekly",displayName:a.DICT("Automatic_Updates_Week")},{id:"monthly",displayName:a.DICT("Automatic_Updates_Month")}],firewall_usb_options:angular.copy(w),updateOptions:angular.copy(w)};a.model.schema.firewall_usb_options.splice(1,1);for(b=0;24>b;b++)a.model.schema.updateOptions.push({id:b,
displayName:(10>b?"0":"")+b+":00"}),a.model.schema.firewall_usb_options.push({id:b,displayName:(10>b?"0":"")+b+":00"})})();p()}]);app.controller("clientToSiteCtrl",["$scope","MyHttp","oneTimeLocker","$window","$q","$templateCache","UserSession","userAccessRight","addressPoolValidate","wan_service",function(a,b,s,n,v,t,m,q,e,w){var l=!1,h=app.TOOLS.getVal,p=app.TOOLS.getResponse;a.success=!1;a.disable_add_user_group=!1;a.disable_del_user_group=!1;a.subnetObj={};a.ori_status=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.ipsecprofile_note=a.DICT("Client_to_Site_Ipsec_Profile_Note",{"%s":"<a ng-click=\"jumpToPage('VPN_IPsec_Profiles')\">"+
a.DICT("here")+"</a>"});a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var u=function(){return b.post({url:resource_base+"data/ipsec_client_to_site.json",method:"get_client_to_site",error:function(a){Log(ERROR,"clientToSIteCtrl getClientToSiteData error, status: "+a.status);x();L()}})},x=function(b){b||(b={});b=b["client-to-sites"]||{};var c=b["client-to-site"]||[];a.model.max_group=b["max-group"]||0;a.model.c2s=[];angular.forEach(c,function(b,c){a.model.c2s.push(r(b))});
a.model.orig_c2s=angular.copy(a.model.c2s)},r=function(b){var c=!1;b||(c=!0,b={});var d={},e=b.mode||{},g=b["extended-authentication"]||{},k=b["ip-pool"]||{},h=!1,l=b["remote-endpoint"]||{},m=b["split-tunnel"]||{},n=b["split-dns"]||{},p,q,r,s=function(a){var b={type:"",ip:"",fqdn:"",user_fqdn:"",der_asn1_dn:"","interface":""};if(!a)return b;angular.forEach(a,function(a,c){switch(c){case "ip":b.type=c;b.ip=a;break;case "interface":b.type=c;b["interface"]="";break;case "fqdn":b.type=c;b.fqdn=a;break;
case "user-fqdn":b.type=c;b.user_fqdn=a;break;case "der-asn1-dn":b.type=c,b.der_asn1_dn=a}});return b};r=p=void 0;h=!1;b["local-certificate"]&&b["local-certificate"].certificate&&(p=b["local-certificate"].certificate,h=!0);b["remote-certificate"]&&b["remote-certificate"].certificate&&(r=b["remote-certificate"].certificate,h=!0);void 0===r&&(r=a.model.default_ca_cert);p||(p=a.model.default_cert);b["ipsec-profile"]&&(q=b["ipsec-profile"]||"");q||(q=a.model.default_profile);d={seq:b.seq||"",type:"cisco-vpn",
editType:"new",group_name:b["group-name"]||"",group_auth:void 0!==b["group-authentication"]?b["group-authentication"]:a.model.auth_groups[0]?a.model.auth_groups[0].id:"",mode:{type:"client",start_ip:e["start-ip"]||"",end_ip:e["end-ip"]||""},backup_server_1:b["backup-server-1"]||"",backup_server_2:b["backup-server-2"]||"",backup_server_3:b["backup-server-3"]||"",ipsec_profile:b["ipsec-profile"]||a.model.default_profile,ike_mode:(a.model.profilesMap[q]||{}).ike_mode||"v2",local_identifier:{},remote_identifier:{},
extended_auth:{enable:void 0!==g.enable?g.enable:!1,group:void 0!==g.group?g.group:a.model.auth_groups[0]?a.model.auth_groups[0].id:""},ip_pool:{start_ip:k["start-ip"]||"",end_ip:k["end-ip"]||""},remote_endpoint:{type:"dynamic-ip",static_ip:"",fqdn:""},local_group:{},aggressive_mode:void 0!==b["aggressive-mode"]?b["aggressive-mode"]:!1,compress:void 0!==b.compress?b.compress:!1,enable:void 0!==b.enable?b.enable:!1,intf:b["interface"]||a.model.ifs[0]&&a.model.ifs[0].id||"",auth:{method:h?"certificate":
"preshared-key",password:b.password||"",show_key_in_plain:!1,enable_show_key_in_plain:!1,strength_meter:b["strength-meter"]||0,min_complexity:void 0!==b["minimum-complexity"]?b["minimum-complexity"]:!0,certificate:p,remote_certificate:r},primary_dns:b["primary-dns"]||"",secondary_dns:b["secondary-dns"]||"",primary_wins:b["primary-wins"]||"",secondary_wins:b["secondary-wins"]||"",default_domain:b["default-domain"]||"",split_tunnel:{enable:void 0!==m.enable?m.enable:!1,networks:[]},split_dns:{enable:void 0!==
n.enable?n.enable:!1,fqdn:[]}};void 0===b["group-name"]&&!c&&(d.type="third-party-vpn");b.mode&&angular.forEach(b.mode,function(a,b){"nem"===b&&(d.mode.type="nem")});angular.forEach(l,function(a,b){switch(b){case "static-ip":d.remote_endpoint.static_ip=a;d.remote_endpoint.type=b;break;case "fqdn":d.remote_endpoint.fqdn=a;d.remote_endpoint.type=b;break;case "dynamic-ip":d.remote_endpoint.type=b}});m.networks&&angular.forEach(m.networks,function(a,b){d.split_tunnel.networks.push(M(a))});n.fqdn&&angular.forEach(n.fqdn,
function(a,b){d.split_dns.fqdn.push(P(a))});d.local_identifier=s(b["local-identifier"]||void 0);d.local_identifier.type||(d.local_identifier.type=a.schema.local_identifier[0].id);d.local_identifier.der_asn1_dn="";d.remote_identifier=s(b["remote-identifier"]);d.remote_identifier.type||(d.remote_identifier.type=a.schema.remote_identifier[0].id);"der-asn1-dn"===d.remote_identifier.type&&"%any"===d.remote_identifier.der_asn1_dn&&(d.remote_identifier.der_asn1_dn="");d.local_group=function(a){a||(a={});
var b={type:"any",subnet_ip:"",subnet_netmask:"",ip:"",begin_ip:"",end_ip:""};if(!a)return b;angular.forEach(a,function(a,c){switch(c){case "subnet":"0.0.0.0"===a.ip&&"0.0.0.0"===a.netmask?b.type="any":(b.type="subnet",b.subnet_ip=a.ip||"",b.subnet_netmask=a.netmask||"");break;case "ip":b.type="ip";b.ip=a.ip;break;case "ip-range":b.type="ip-range",b.begin_ip=a["begin-ip"],b.end_ip=a["end-ip"]}});return b}(b["local-group"]);return d},d=function(){return b.post({url:resource_base+"data/wan_setting_state.json",
method:"get_interface_state",error:function(a){Log(ERROR,"getInterfaceState error: "+a.status);c();k()}})},c=function(b){b||(b={});var c=[];b["interfaces-state"]&&b["interfaces-state"]["interface"]&&(c=b["interfaces-state"]["interface"]);a.model.vlanIp="";angular.forEach(c,function(b){"VLAN1"===b.name&&(a.model.vlanIp=b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].ip||"")})},k=function(b){b||(b={});a.model.ifs_state=w.get_ifs_status(b)},g=function(){return b.post({url:resource_base+
"data/nacm_group.json",method:"get_groups",error:function(a){z()}})},z=function(b){b||(b={});b=b.groups&&b.groups.group||[];a.model.auth_groups=[];angular.forEach(b,function(b,c){a.model.auth_groups.push({id:b.name,displayName:b.name})});a.model.rule_list=[];a.model.nacm_grid=[];a.model.groups=[];a.model.connections=[];a.model.c2s_group_yes=[];a.model.c2s_group_no=[];b&&(a.model.rule_list=angular.copy(b));angular.forEach(a.model.rule_list,function(b){a.model.groups.push(b.name)});angular.forEach(a.model.rule_list,
function(b){b["feature-rule"]&&angular.forEach(b["feature-rule"],function(b){if("ezvpn"===b.service&&b.option){var c=[],c=angular.copy(b.option);for(b=0;b<c.length;b++)if(0===a.model.connections.length)a.model.connections.push({name:c[b],yes_group:[],no_group:[],grid_table:[]});else{f=!0;for(var d=0;d<a.model.connections.length;d++)if(c[b]===a.model.connections[d].name){f=!1;break}!0===f&&a.model.connections.push({name:c[b],yes_group:[],no_group:[],grid_table:[]})}}})});angular.forEach(a.model.connections,
function(b){angular.forEach(a.model.rule_list,function(a){a["feature-rule"]&&angular.forEach(a["feature-rule"],function(c){if("ezvpn"===c.service&&c.option){var d=[],d=angular.copy(c.option);for(c=0;c<d.length;c++)if(b.name===d[c]){b.yes_group.push({name:a.name,id:a.name,displayName:a.name});break}}})})});angular.forEach(a.model.connections,function(b){angular.forEach(a.model.rule_list,function(a){f=!0;angular.forEach(b.yes_group,function(b){a.name===b.name&&(f=!1)});!0===f&&b.no_group.push({name:a.name,
id:a.name,displayName:a.name})})});angular.forEach(a.model.connections,function(a){angular.forEach(a.yes_group,function(b){a.grid_table.push({exp:{list:a.yes_group,select:b.name},empty:"",invalid:!1,edit:!1})})})},y=function(){var b=[],c=!0;angular.forEach(a.model.c2s,function(b){for(var c=0;c<a.model.connections.length;c++)if(b.seq===a.model.connections[c].name){b.nacm=angular.copy(a.model.connections[c]);break}});angular.forEach(a.model.groups,function(a){b.push({name:a,id:a,displayName:a})});angular.forEach(a.model.c2s,
function(d){c=!0;angular.forEach(a.model.connections,function(a){d.seq===a.name&&(c=!1)});!0===c&&(a.model.connections.push({name:d.seq,yes_group:[],no_group:b,grid_table:[]}),d.nacm=angular.copy({name:d.seq,yes_group:[],no_group:b,grid_table:[]}))})},A=function(){return b.post({url:resource_base+"data/ipsec_profiles.json",method:"get_ipsec_profile",error:function(a){Log(ERROR,"siteToSiteCtrl getProfile error, status: "+a.status)}})},B=function(b){b||(b={});b=(b["ipsec-profiles"]||{})["ipsec-profile"]||
[];var c,d,e,g,k;a.model.profiles=[];a.model.profilesMap={};a.model.default_profile="";angular.forEach(b,function(b,h){c=b["keying-mode"]||{};if(g=b["profile-name"]||"")d="auto",e="",k={},b["keying-mode"]&&(c["phase1-options"]?(d="auto",angular.forEach(c["ike-version"],function(a,b){switch(b){case "v1":e="v1";break;default:e="v2"}})):e=d="manual"),k={id:g,displayName:g,mode:d,ike_mode:e},a.model.profiles.push(k),a.model.profilesMap[g]=k,"Default"===g&&(a.model.default_profile=g)});a.model.default_profile||
(a.model.default_profile=a.model.profiles[0]&&a.model.profiles[0].name||"")},C=function(b){b||(b={});b=(b["certs-state"]||{}).cert||[];var c={},d,e;a.model.certs=[];a.model.default_cert="";angular.forEach(b,function(b,g){if((d=b.name||"")&&!c[d]&&!("imported"!==b.source&&"generated"!==b.source))"Default"===d&&(e=d),a.model.certs.push({name:d,subject:app.TOOLS.cert2subject(b)}),c[d]=!0});e||(e=a.model.certs[0]&&a.model.certs[0].name||"");a.model.default_cert=e},D=function(){return b.post({url:resource_base+
"data/wan_setting1.json",method:"get_interface",error:function(a){Log(ERROR,"clientToSIteCtrl getInterfaceData error "+a.status);E()}})},E=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var c=[],d=[];a.model.ifs=[];angular.forEach(b,function(a,b){a.name&&(a.name.match(/^WAN\d+($|\.\d+$)/)&&c.push({id:a.name,displayName:a.name}),a.name.match(/^USB\d+/)&&d.push({id:a.name,displayName:a.name}))});a.model.ifs=c.concat(d)},I=function(){b.post({method:"get_all_cert",procBackground:!0,url:resource_base+
"data/get_all_cert.json",success:function(b){b=b&&b.data&&b.data.result||{};C(b);F(b);a.certReady=!0;H();a.checkASN1DNCert()},error:function(b){Log(ERROR,"[S2S] get_all_cert error "+JSON.stringify(b));C();F();a.certReady=!0;H();a.checkASN1DNCert()}})},F=function(b){b||(b={});var c=[],d;b["certs-state"]&&b["certs-state"].cert&&(c=b["certs-state"].cert);a.model.ca_certs=[];angular.forEach(c,function(b){b.info&&b.info["is-ca-enabled"]&&(d={name:b.name||"",displayName:b.name||""},d.name&&a.model.ca_certs.push(d))});
a.model.default_ca_cert=a.model.ca_certs[0]&&a.model.ca_certs[0].name||""},H=function(){if(a.edit&&a.certReady){var b=a.edit;b.auth.certificate||(b.auth.certificate=a.model.default_cert);b.auth.remote_certificate||(b.auth.remote_certificate=a.model.default_ca_cert);a.waitForCert=!1}},G=function(){return b.post({url:resource_base+"data/telework_vpn_clients.json",method:"get_teleworker_vpn",error:function(a){Log(ERROR,"teleworkerVPNCtrl getTeleworkerData error : "+a.status);J()}})},J=function(b){b||
(b={});a.model.teleworker_enable=b&&b["teleworker-vpn-clients"]&&b["teleworker-vpn-clients"].enable?!0:!1},L=function(){a.model.display=[];angular.forEach(a.model.c2s,function(b,c){a.model.display.push({checked:!1,group:b.seq,seq:b.seq,intf:b.intf,auth:"preshared-key"===b.auth.method?a.DICT("Client_to_Site_Preshared_Key"):a.DICT("Client_to_Site_Certificate"),mode:"client"===b.mode.type?"Client":"Nem",action:[{cbk:a.funs.disconnect,displayName:a.DICT("Client_to_Site_Disconnect")}]})});a.gridC2SOptions.data=
a.model.display},N=[{id:"interface",displayName:a.DICT("Client_to_Site_Local_WAN_IP")},{id:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N")},{id:"fqdn",displayName:a.DICT("Client_to_Site_FQDN")},{id:"user-fqdn",displayName:a.DICT("Client_to_Site_User_FQDN")}],M=function(a){var b=!1;a||(a={},b=!0);return{ip:a.ip||"",netmask:a.netmask||"",edit:!1,checked:b?!0:!1,invalid:!1}},P=function(a){var b=!1;a||(a={},b=!0);return{fqdn:a.fqdn||"",edit:!1,checked:b?!0:!1,invalid:!1}},U=function(){return b.post({url:resource_base+
"data/ipsec_enable.json",method:"get_ipsec_enable",error:function(a){Log(ERROR,"[C2S][getIPSecEnable] "+JSON.stringify(a));Q()}})},Q=function(b){b||(b={});b=h((b.ipsec||{}).enable,!0);a.model.ipsec_enable=b},V=function(){return b.post({url:resource_base+"data/aaa.json",method:"get_subnet",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}})},R=function(b){b.data&&(b.data.result&&b.data.result.subnets&&b.data.result.subnets.ipv4&&b.data.result.subnets.ipv6)&&(a.subnetObj=
angular.copy(b.data.result.subnets))},K=function(){v.all([g(),u(),G()]).then(function(b){z(b[0].data&&b[0].data.result||{});x(b[1].data&&b[1].data.result||{});J(b[2].data&&b[2].data.result||{});y();L();a.edit=void 0;a.procC2SClick();setTimeout(function(){a.gridC2SOptions.gridApi.customApi.checkSelectStatus()},50);a.resetModified()})};a.changeIpsecProfile=function(){var b=a.edit,c;if(b)switch(c=a.model.profilesMap[b.ipsec_profile],b.ike_mode=c&&c.ike_mode||"v2",b.ike_mode){case "manual":a.model.profileInfo=
a.DICT("Client_to_Site_Manual_Profile_Chosen");break;case "v1":a.model.profileInfo=a.DICT("Client_to_Site_IKEv1_Profile_Chosen");break;default:a.model.profileInfo=a.DICT("Client_to_Site_IKEv2_Profile_Chosen")}};var S=function(){a.tabs=angular.copy(O);a.tabUrl="ipsec_c2s_3rd_basic.html";a.currPage="edit"},T=function(){a.selectIdx=-1;a.currPage="main"},O=[{heading:a.DICT("Client_to_Site_Header_Basic"),templateUrl:"ipsec_c2s_3rd_basic.html"},{heading:a.DICT("Client_to_Site_Header_Advanced"),templateUrl:"ipsec_c2s_3rd_adv.html"}];
a.pageMap={main:"ipsec_c2s_main.html",edit:"ipsec_c2s_edit.html"};a.currPage="main";a.tabUrl="ipsec_c2s_3rd_basic.html";a.dataReady=!1;a.selectIdx=-1;a.selection=[];a.edit=void 0;a.origEdit=void 0;a.edit_split_fqdns=[];a.edit_split_tunnels=[];a.certReady=!1;a.waitForCert=!1;a.schema={};a.model={ipsec_enable:!0,c2s:[],orig_c2s:[],ifs:[],display:[],certs:[],profiles:[],profilesMap:{},profileInfo:"",default_profile:"",default_cert:"",default_ca_cert:"",ca_certs:[],auth_groups:[],max_group:0,vlanIp:"",
rule_list:[],nacm_grid:[],c2s_group_remain:[],c2s_group_yes:[],c2s_group_no:[],groups:[],connections:[],c2s_group_dels:[],ifs_state:{}};a.procC2SClick=function(b){var c=-1;a.selectIdx=-1;angular.forEach(a.model.display,function(b,d){c=-1;angular.forEach(a.selection,function(a,b){a===d&&(c=b)});b.checked?-1===c&&(a.selection.push(d),a.selectIdx=d):-1!==c&&a.selection.splice(c,1)})};a.gridC2SOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.procC2SClick,
headerChangedCbk:a.procC2SClick},{field:"group",displayName:a.DICT("Client_to_Site_Group_Tunnel_Name")},{field:"intf",displayName:a.DICT("Client_to_Site_WAN_Interface")},{field:"auth",displayName:a.DICT("Client_to_Site_Authentication_Method")}]});a.splitTunnelCbk=function(){var b=[],c=0,d,e,g;if(a.edit){var b=a.edit.split_tunnel.networks,c=b.length,k=function(a,g,k){if(!(0>a))for(d=a;d<c;d++)if((e=b[d])&&d!==g&&app.TOOLS.validation.ipv4_getNet(e.ip,e.netmask).toString()==k)e.invalid=!0,b[g].invalid=
!0};angular.forEach(b,function(a){a.invalid=!1});for(g=0;g<c;g++)if(b[g]&&b[g].ip&&b[g].netmask){var h=app.TOOLS.validation.ipv4_getNet(b[g].ip,b[g].netmask).toString();k(g,g,h)}}};a.procSplitTunnelNetworksClick=function(){a.edit_split_tunnels=[];angular.forEach(a.edit.split_tunnel.networks,function(b,c){b.checked?a.edit_split_tunnels.push(b):b.edit=!1})};a.gridSplitTunnelInvalidCbk=function(a){a.row.entity.disableSplitTunnelChk=a.rowInvalid};a.gridSplitTunnelOptions=app.uiGrid.generateGridOptions({IDPreifx:"c2sSplitTunnel",
columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.procSplitTunnelNetworksClick,headerChangedCbk:a.procSplitTunnelNetworksClick,disableChkBoxField:"disableSplitTunnelChk"},{field:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N"),editRow:"edit",id:"splittunnelip",validationCbk:"gridSplitTunnelInvalidCbk",cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-ip check-ipv4-bymask=\"row.entity['netmask']\""),customVldCbk:"splitTunnelCbk",invalidField:"invalid",
required:!0},{field:"netmask",displayName:a.DICT("Client_to_Site_Netmask"),editRow:"edit",id:"splittunnelnetmask",validationCbk:"gridSplitTunnelInvalidCbk",cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'ipv4-netmask check-mask-byipv4="row.entity[\'ip\']" custom-vld custom-vld-cbk="splitTunnelCbk"'),required:!0,invalidField:"invalid",customVldCbk:"splitTunnelCbk"}]});a.splitDnsCbk=function(b){b=a.edit.split_dns.fqdn;var c=b.length,d,e;angular.forEach(b,function(a){a.invalid=
!1});for(d=0;d<c;d++)for(e=d+1;e<c;e++)b[d].fqdn===b[e].fqdn&&(b[d].invalid=!0,b[e].invalid=!0)};a.procSplitDNSClick=function(b){a.edit_split_fqdns=[];angular.forEach(a.edit.split_dns.fqdn,function(b,c){b.checked?a.edit_split_fqdns.push(c):b.edit=!1})};a.gridSplitDNSInvalidCbk=function(a){a.row.entity.disableSplitDNSChk=a.rowInvalid};a.gridSplitDNSOptions=app.uiGrid.generateGridOptions({IDPreifx:"c2sSplitDNS",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.procSplitDNSClick,headerChangedCbk:a.procSplitDNSClick,
disableChkBoxField:"disableSplitDNSChk"},{field:"fqdn",displayName:a.DICT("Client_to_Site_Domain_Name"),editRow:"edit",id:"splittunneldomain",validationCbk:"gridSplitDNSInvalidCbk",cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,'domain-name maxlength="253"'),required:!0,customVldCbk:"splitDnsCbk",invalidField:"invalid"}]});var W=function(b){if(a.edit){var c=a.edit.seq||"",d=!0,e=[];a.model.nacm_grid=[];a.model.c2s_group_yes=[];a.model.c2s_group_no=[];l=!0;if("new"===
b)angular.forEach(a.model.groups,function(a){e.push({name:a,id:a,displayName:a})}),a.edit.nacm=angular.copy({name:"newConn",yes_group:[],no_group:e,grid_table:[]});else{d=!0;for(b=0;b<a.model.connections.length;b++)if(c===a.model.connections[b].name){d=!1;break}!0===d&&(angular.forEach(a.model.groups,function(a){e.push({name:a,id:a,displayName:a})}),a.model.connections.push({name:c,yes_group:[],no_group:e,grid_table:[]}),a.edit.nacm=angular.copy({name:c,yes_group:[],no_group:e,grid_table:[]}))}a.model.nacm_grid=
angular.copy(a.edit.nacm.grid_table);a.model.c2s_group_yes=angular.copy(a.edit.nacm.yes_group);a.model.c2s_group_no=angular.copy(a.edit.nacm.no_group);angular.forEach(a.model.nacm_grid,function(a,b){a.checked=!1});a.disable_add_user_group=0>=a.model.c2s_group_no.length?!0:!1;a.disable_del_user_group=0>=a.model.nacm_grid.length?!0:!1}},Y=function(){a.model.c2s_group_remain=angular.copy(a.model.c2s_group_no);angular.forEach(a.model.nacm_grid,function(b){if(!0===b.edit)for(var c=0;c<a.model.c2s_group_remain.length;c++)if(b.exp.select===
a.model.c2s_group_remain[c].name){a.model.c2s_group_remain.splice(c,1);break}});angular.forEach(a.model.nacm_grid,function(b){!0===b.edit&&(b.exp.list=[{name:b.exp.select,id:b.exp.select,displayName:b.exp.select}].concat(a.model.c2s_group_remain))})};a.procNgClick=function(b){a.disable_del_user_group=!0;a.model.c2s_group_dels=[];angular.forEach(a.model.nacm_grid,function(b,c){b.checked&&(a.disable_del_user_group=!1,a.model.c2s_group_dels.push(b))})};a.gridGroup=app.uiGrid.generateGridOptions({IDPreifx:"c2s",
columnDefs:[{field:"checked",isCheckbox:!0,displayName:"",changedCbk:a.procNgClick,headerChangedCbk:a.procNgClick},{field:"exp",displayName:a.DICT("Client_to_Site_Group_Name_N"),minWidth:350,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html",change:Y},{field:"empty",isEmpty:!0}]});var X=function(){var b=[],c=[],d=!1,e,g,k=[];angular.forEach(a.model.orig_c2s,function(c){e=!1;angular.forEach(a.model.c2s,function(a){c.seq===a.seq&&(e=!0)});e||b.push(c)});angular.forEach(b,function(b,
c){g=b.seq;k.push({seq:g});angular.forEach(a.model.rule_list,function(a){angular.forEach(a["feature-rule"],function(a){if("ezvpn"===a.service&&a.option)for(var b=0;b<a.option.length;b++)if(g===a.option[b]){d=!0;a.option.splice(b,1);break}})})});k.length&&(d&&c.push({method:"set_groups",params:{groups:{group:a.model.rule_list}}}),c.push({method:"del_client_to_site",params:{"client-to-sites":{"client-to-site":k}}}));return c},da=function(){var b=[],c=!1;if(!a.edit)return b;if(l){var d=a.edit.seq,e=
[],g=[],k;angular.forEach(a.model.nacm_grid,function(a){e.push(a.exp.select)});angular.forEach(a.model.c2s_group_remain,function(a){g.push(a.name)});for(k=0;k<e.length;k++)angular.forEach(a.model.rule_list,function(a){e[k]===a.name&&angular.forEach(a["feature-rule"],function(a){if("ezvpn"===a.service)if(a.option){flag=!1;for(var b=0;b<a.option.length;b++)if(d===a.option[b]){flag=!0;break}!1===flag&&(a.option.push(d),c=!0)}else option=[],option.push(d),a.option=angular.extend(option),c=!0})});for(k=
0;k<g.length;k++)angular.forEach(a.model.rule_list,function(a){g[k]===a.name&&angular.forEach(a["feature-rule"],function(a){if("ezvpn"===a.service&&a.option)for(var b=0;b<a.option.length;b++)if(d===a.option[b]){a.option.splice(b,1);c=!0;break}})})}var h=a.origEdit,m=a.edit,n;(function(){var a=!1,c;h&&(n={seq:h.seq},h.seq!==m.seq?(h=void 0,a=!0):(angular.forEach(h.split_dns.fqdn,function(b){c=!0;angular.forEach(m.split_dns.fqdn,function(a){b.fqdn===a.fqdn&&(c=!1)});c&&(n["split-dns"]||(n["split-dns"]=
{fqdn:[]}),n["split-dns"].fqdn.push({fqdn:b.fqdn}),a=!0)}),angular.forEach(h.split_tunnel.networks,function(b){c=!0;angular.forEach(m.split_tunnel.networks,function(a){b.ip===a.ip&&(c=!1)});c&&(n["split-tunnel"]||(n["split-tunnel"]={networks:[]}),n["split-tunnel"].networks.push({ip:b.ip}),a=!0)})),a&&b.push({method:"del_client_to_site",params:{"client-to-sites":{"client-to-site":[n]}}}))})();(function(){var c=function(a){var b=void 0;switch(a.type){case "ip":b={ip:a.ip};break;case "fqdn":b={fqdn:a.fqdn};
break;case "user-fqdn":b={"user-fqdn":a.user_fqdn};break;case "der-asn1-dn":b={"der-asn1-dn":a.der_asn1_dn};break;case "interface":b={"interface":m.intf}}return b};n={seq:m.seq,enable:m.enable,"interface":m.intf};if("cisco-vpn"===m.type){n["group-name"]=m.seq;n["group-authentication"]=m.group_auth;switch(m.mode.type){case "client":n.mode={"start-ip":m.mode.start_ip,"end-ip":m.mode.end_ip};break;case "nem":n.mode={nem:null}}if(!h||h.backup_server_1!==m.backup_server_1)n["backup-server-1"]=m.backup_server_1;
if(!h||h.backup_server_2!==m.backup_server_2)n["backup-server-2"]=m.backup_server_2;if(!h||h.backup_server_3!==m.backup_server_3)n["backup-server-3"]=m.backup_server_3}else if("third-party-vpn"===m.type){n["extended-authentication"]={enable:m.extended_auth.enable,group:m.extended_auth.group};n["ipsec-profile"]=m.ipsec_profile;n["ip-pool"]={enable:!0,"start-ip":m.ip_pool.start_ip,"end-ip":m.ip_pool.end_ip};switch(m.remote_endpoint.type){case "static-ip":n["remote-endpoint"]={"static-ip":m.remote_endpoint.static_ip};
break;case "fqdn":n["remote-endpoint"]={fqdn:m.remote_endpoint.fqdn};break;case "dynamic-ip":n["remote-endpoint"]={"dynamic-ip":null}}switch(m.local_group.type){case "subnet":n["local-group"]={subnet:{ip:m.local_group.subnet_ip,netmask:m.local_group.subnet_netmask}};break;case "ip":n["local-group"]={ip:{ip:m.local_group.ip}};break;case "ip-range":n["local-group"]={"ip-range":{"begin-ip":m.local_group.begin_ip,"end-ip":m.local_group.end_ip}};break;case "any":n["local-group"]={subnet:{ip:"0.0.0.0",
netmask:"0.0.0.0"}}}n["local-identifier"]=c(m.local_identifier);"der-asn1-dn"===m.local_identifier.type&&(n["local-identifier"]["der-asn1-dn"]="asn1dn");n["local-group"]||(n["local-group"]={});"der-asn1-dn"===m.remote_identifier.type&&!m.remote_identifier.der_asn1_dn&&(m.remote_identifier.der_asn1_dn="%any");n["remote-identifier"]=c(m.remote_identifier);n["aggressive-mode"]=m.aggressive_mode;n.compress=m.compress}switch(m.auth.method){case "preshared-key":if(!h||h.auth.password!==m.auth.password)n.password=
m.auth.password,n["strength-meter"]=m.auth.strength_meter;n["minimum-complexity"]=m.auth.min_complexity;break;case "certificate":n["local-certificate"]={certificate:m.auth.certificate},n["remote-certificate"]={certificate:m.auth.remote_certificate}}if(!h||h.primary_dns!==m.primary_dns)n["primary-dns"]=m.primary_dns;if(!h||h.secondary_dns!==m.secondary_dns)n["secondary-dns"]=m.secondary_dns;if(!h||h.primary_wins!==m.primary_wins)n["primary-wins"]=m.primary_wins;if(!h||h.secondary_wins!==m.secondary_wins)n["secondary-wins"]=
m.secondary_wins;if(!h||h.default_domain!==m.default_domain)n["default-domain"]=m.default_domain;n["split-tunnel"]={enable:m.split_tunnel.enable,networks:[]};angular.forEach(m.split_tunnel.networks,function(a){n["split-tunnel"].networks.push({ip:a.ip,netmask:a.netmask})});n["split-dns"]={enable:m.split_dns.enable,fqdn:[]};angular.forEach(m.split_dns.fqdn,function(a){n["split-dns"].fqdn.push({fqdn:a.fqdn})});a.edit.enable&&a.model.teleworker_enable&&b.push({method:"set_teleworker_vpn",params:{"teleworker-vpn-clients":{enable:!1}}});
b.push({method:"set_client_to_site",params:{"client-to-sites":{"client-to-site":[n]}}})})();c&&b.push({method:"set_groups",params:{groups:{group:a.model.rule_list}}});return b},aa=function(){return 10<=a.model.display.length?(a.msg="Only allow maximum of 10 entries for IPSec Client-to-Site. (Current Entry Number: "+a.model.display.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.splitTunnelCheck=function(){return 50<=a.edit.split_tunnel.networks.length?(a.msg="Only allow maximum of 50 entries for Split Tunnel. (Current Entry Number: "+
a.edit.split_tunnel.networks.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};var ba=function(){return 30<=a.edit.split_dns.fqdn.length?(a.msg="Only allow maximum of 30 entries for Split DNS. (Current Entry Number: "+a.edit.split_dns.fqdn.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.funs={save:function(){var c=[],c=c.concat(X()),c=c.concat(da());c.length?b.post({method:"set_bulk",forcedUsingPost:!0,params:c,success:function(b){a.success=
!0;a.selectIdx>=a.model.c2s.length-1&&(a.selectIdx=-1);T();K()},error:function(a){T();K()}}):(T(),K())},cancel:function(){T();K()},add:function(){aa()||(a.disable_del_user_group=!0,a.edit=r(),a.edit.editIdx=-1,a.edit.editType="new",a.edit.primary_dns=a.model.vlanIp,a.edit.auth.enable_show_key_in_plain=!0,a.edit.auth.show_key_in_plain=!1,a.origEdit=void 0,a.checkLocalIdentifier(),a.ori_status=a.edit.enable||!1,W(a.edit.editType),a.changeIpsecProfile(),a.gridSplitTunnelOptions.data=a.edit.split_tunnel.networks,
a.gridSplitDNSOptions.data=a.edit.split_dns.fqdn,a.gridGroup.data=a.model.nacm_grid,a.change_auth_method(),S(),a.modified())},edit:function(){var b=-1;angular.forEach(a.model.display,function(a,c){a.checked&&(b=c)});a.edit=angular.copy(a.model.c2s[b]);a.edit.editIdx=b;a.edit.editType="edit";a.edit.auth.enable_show_key_in_plain="preshared-key"===a.edit.auth.method?!1:!0;a.edit.auth.show_key_in_plain=!1;a.checkLocalIdentifier();a.origEdit=angular.copy(a.edit);a.ori_status=a.edit.enable||!1;W();a.changeIpsecProfile();
a.gridSplitTunnelOptions.data=a.edit.split_tunnel.networks;a.gridSplitDNSOptions.data=a.edit.split_dns.fqdn;a.gridGroup.data=a.model.nacm_grid;a.change_auth_method();S()},del:function(){var b,c,d=a.model.display,e=a.model.c2s;for(b=d.length-1;0<=b;b--)if(d[b].checked){for(c=e.length-1;0<=c;c--)if(e[c].seq===d[b].seq){e.splice(c,1);break}d.splice(b,1)}},connect:function(a){},disconnect:function(c){b.post({forcedUsingPost:!0,method:"action",params:{input:{"group-name":a.model.c2s[c].seq},rpc:"c2s-disconnect"}})},
split_dns:{add:function(){if(!ba()){var b=P();b.edit=!0;a.edit.split_dns.fqdn.push(b);a.procSplitDNSClick()}},edit:function(){angular.forEach(a.edit_split_fqdns,function(b,c){a.edit.split_dns.fqdn[b].edit=!0})},del:function(){for(var b=a.edit_split_fqdns.length-1,c,d;0<=b;b--)d=c=-1,angular.forEach(a.edit_split_fqdns,function(a,b){c<a&&(c=a,d=b)}),a.edit_split_fqdns.splice(d,1),a.edit.split_dns.fqdn.splice(c,1);a.procSplitDNSClick();a.splitDnsCbk()}},split_tunnel:{add:function(){if(!a.splitTunnelCheck()){var b=
M();b.edit=!0;a.edit.split_tunnel.networks.push(b);a.procSplitTunnelNetworksClick()}},edit:function(){angular.forEach(a.edit.split_tunnel.networks,function(a,b){a.checked&&(a.edit=!0)})},del:function(){var b,c=a.edit.split_tunnel.networks;for(b=c.length-1;0<=b;b--)c[b].checked&&c.splice(b,1);a.edit_split_tunnels=[]}},clickTab:function(b){a.tabUrl=b.templateUrl}};a.checkSeq=function(b){var c=!1;!a.edit||!a.edit.seq?(a.c2sform[b].$setValidity("special",!0),a.c2sform[b].$setValidity("repeat",!0)):(a.edit.seq.match(/^\w+$/)?
a.c2sform[b].$setValidity("special",!0):a.c2sform[b].$setValidity("special",!1),angular.forEach(a.model.c2s,function(b){b.seq===a.edit.seq&&(c=!0)}),a.c2sform[b].$setValidity("repeat",!c))};a.change_auth_method=function(){var b=a.edit;a.schema.local_identifier=angular.copy(N);"preshared-key"===b.auth.method?(a.schema.remote_identifier=[{id:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N")},{id:"fqdn",displayName:a.DICT("Client_to_Site_FQDN")},{id:"user-fqdn",displayName:a.DICT("Client_to_Site_User_FQDN")}],
"der-asn1-dn"===b.local_identifier.type&&(b.local_identifier.type=a.schema.local_identifier[0].id),"der-asn1-dn"===b.remote_identifier.type&&(b.remote_identifier.type=a.schema.remote_identifier[0].id)):(a.schema.local_identifier.push({id:"der-asn1-dn",displayName:a.DICT("Client_to_Site_ASN1DN")}),a.schema.remote_identifier=[{id:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N")},{id:"fqdn",displayName:a.DICT("Client_to_Site_FQDN")},{id:"user-fqdn",displayName:a.DICT("Client_to_Site_User_FQDN")},
{id:"der-asn1-dn",displayName:a.DICT("Client_to_Site_ASN1DN")}]);"certificate"===b.auth.method&&!a.certReady&&(a.waitForCert=!0);H();a.checkLocalIdentifier()};a.addGroup=function(){a.model.c2s_group_remain=angular.copy(a.model.c2s_group_no);angular.forEach(a.model.nacm_grid,function(b){if(!0===b.edit)for(var c=0;c<a.model.c2s_group_remain.length;c++)if(b.exp.select===a.model.c2s_group_remain[c].name){a.model.c2s_group_remain.splice(c,1);break}});a.model.nacm_grid.push({exp:{list:a.model.c2s_group_remain,
select:a.model.c2s_group_remain[0].name},empty:"",edit:!0,checked:!0});Y();a.disable_add_user_group=0>=a.model.c2s_group_remain.length?!0:!1;a.disable_del_user_group=0>=a.model.nacm_grid.length?!0:!1;a.gridGroup.gridApi.customApi.scrollToLast();a.procNgClick()};a.delGroup=function(){var b=a.model.c2s_group_dels.length,c,d;for(c=0;c<b;c++)for(d=a.model.nacm_grid.length-1;0<=d;d--)if(a.model.c2s_group_dels[c].exp.select===a.model.nacm_grid[d].exp.select){a.model.nacm_grid.splice(d,1);break}for(c=0;c<
b;c++)for(d=a.model.c2s_group_yes.length-1;0<=d;d--)if(a.model.c2s_group_dels[c].exp.select===a.model.c2s_group_yes[d].name){a.model.c2s_group_yes.splice(d,1);break}for(c=0;c<b;c++){flag=!0;for(d=0;d<a.model.c2s_group_no.length;d++)if(a.model.c2s_group_dels[c].exp.select===a.model.c2s_group_no[d].name){flag=!1;break}!0===flag&&a.model.c2s_group_no.push({name:a.model.c2s_group_dels[c].exp.select,id:a.model.c2s_group_dels[c].exp.select,displayName:a.model.c2s_group_dels[c].exp.select})}Y();a.disable_add_user_group=
0>=a.model.c2s_group_remain.length?!0:!1;a.disable_del_user_group=0>=a.model.nacm_grid.length?!0:!1;for(c=b-1;0<=c;c--)a.model.c2s_group_dels.splice(c,1);a.procNgClick()};a.poolValidation=function(){var b=!0;a.c2sform.txt_c2sstartip.$setValidity("range",!0);a.c2sform.txt_c2sendip.$setValidity("range",!0);a.c2sform.txt_c2sstartip.$setValidity("subnet",!0);a.c2sform.txt_c2sendip.$setValidity("subnet",!0);if(void 0===a.edit.mode.start_ip||void 0===a.edit.mode.end_ip||""===a.edit.mode.start_ip||""===
a.edit.mode.end_ip)return!0;if(void 0===a.edit.seq||!a.edit.seq)a.edit.seq="";b=e.compareIpRange(a.edit.mode.start_ip,a.edit.mode.end_ip);!1===b?(a.c2sform.txt_c2sstartip.$setValidity("range",!1),a.c2sform.txt_c2sendip.$setValidity("range",!1)):(b=e.poolValidate("client-to-sites",a.edit.seq,"ipv4",a.subnetObj,a.edit.mode.start_ip,a.edit.mode.end_ip),!1===b&&(a.c2sform.txt_c2sstartip.$setValidity("subnet",!1),a.c2sform.txt_c2sendip.$setValidity("subnet",!1)));return b};a.poolValidation3rd=function(){var b=
!0;a.c2sform.txt_c2s3rdstartip.$setValidity("range",!0);a.c2sform.txt_c2s3rdendip.$setValidity("range",!0);a.c2sform.txt_c2s3rdstartip.$setValidity("subnet",!0);a.c2sform.txt_c2s3rdendip.$setValidity("subnet",!0);if(void 0===a.edit.ip_pool.start_ip||void 0===a.edit.ip_pool.end_ip||""===a.edit.ip_pool.start_ip||""===a.edit.ip_pool.end_ip)return!0;if(void 0===a.edit.seq||!a.edit.seq)a.edit.seq="";b=e.compareIpRange(a.edit.ip_pool.start_ip,a.edit.ip_pool.end_ip);!1===b?(a.c2sform.txt_c2s3rdstartip.$setValidity("range",
!1),a.c2sform.txt_c2s3rdendip.$setValidity("range",!1)):(b=e.poolValidate("client-to-sites",a.edit.seq,"ipv4",a.subnetObj,a.edit.ip_pool.start_ip,a.edit.ip_pool.end_ip),!1===b&&(a.c2sform.txt_c2s3rdstartip.$setValidity("subnet",!1),a.c2sform.txt_c2s3rdendip.$setValidity("subnet",!1)));return b};a.changeEnable=function(){a.edit.enable&&a.model.teleworker_enable&&a.ori_status!==a.edit.enable&&app.TOOLS.warningAlertBox({msg:"Teleworker VPN Client will be disabled.<br>You cannot enable Client-to-Site and Teleworker VPN Client simultaneously.<br>Click Apply to proceed.",
btn_yes_str:"Apply",btn_no_str:"Cancel"})};a.checkLocalIdentifier=function(){var b=a.edit,c;b&&(b.local_identifier["interface"]="0.0.0.0","interface"===b.local_identifier.type&&(c=a.model.ifs_state[b.intf])&&(c.ipv4&&c.ipv4.length)&&(b.local_identifier["interface"]=c.ipv4[0]),a.checkASN1DNCert())};a.updateIntfState=function(){v.all([d()]).then(function(b){k(b[0].data&&b[0].data.result||{});a.checkLocalIdentifier()})};a.change_pwd=function(){a.edit.auth.enable_show_key_in_plain=!0};a.checkASN1DNCert=
function(){var b=a.edit,c;b&&(c=b.auth.certificate,angular.forEach(a.model.certs,function(a){a.name===c&&(b.local_identifier.der_asn1_dn=a.subject)}))};a.schema={local_identifier:angular.copy(N),remote_identifier:[],endpoint:[{id:"static-ip",displayName:a.DICT("Client_to_Site_Static_IP")},{id:"fqdn",displayName:a.DICT("Client_to_Site_FQDN")},{id:"dynamic-ip",displayName:a.DICT("Client_to_Site_Dynamic_IP")}],group:[{id:"subnet",displayName:a.DICT("Client_to_Site_Subnet")},{id:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N")},
{id:"any",displayName:a.DICT("Client_to_Site_Any")}]};a.schema.remote_identifier=[{id:"ip",displayName:a.DICT("Client_to_Site_IP_Addr_N")},{id:"fqdn",displayName:a.DICT("Client_to_Site_FQDN")},{id:"user-fqdn",displayName:a.DICT("Client_to_Site_U")},{id:"der-asn1-dn",displayName:a.DICT("Client_to_Site_ASN1DN")}];(function(){I();v.all([g(),A(),D(),u(),V(),d(),G(),U()]).then(function(b){a.selection=[];z(p(b,0));B(p(b,1));E(p(b,2));x(p(b,3));R(b[4]);c(p(b,5));k(p(b,5));J(p(b,6));Q(p(b,7));y();L();a.edit=
void 0;var d=s.get("IPSec_C2S");if(d)switch(Log(INFO,"Jump from VPN Status: "+JSON.stringify(d)),d.action){case "edit":angular.forEach(a.model.display,function(b,c){b.seq===d.key&&(b.checked=!0,a.selectIdx=c,a.funs.edit())});break;case "add":a.funs.add()}a.dataReady=!0;a.resetModified()})})()}]);app.controller("GreTunnelCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","wan_service","wan_lib",function(a,b,s,n,v,t,m){var q=app.TOOLS.getVal,e="";a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var w=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",params:{filter:"WAN"},error:function(a){l();Log(ERROR,"[GRE][getInterface] "+JSON.stringify(a))}})},l=function(b){b||(b={});var d=[];b.interfaces&&b.interfaces["interface"]&&
(d=b.interfaces["interface"]);d=t.filter(d,{physical:!0});a.model.ifs=[];e="";angular.forEach(d,function(b){"WAN1"===b.name&&(e=b.name);a.model.ifs.push({id:b.name,displayName:b.name})});e||(e=a.model.ifs[0]&&a.model.ifs[0].id||"")},h=function(){return b.post({method:"get_gre",url:resource_base+"data/gre_tunnel.json",error:function(a){p();Log(ERROR,"[GRE][getGreTunnel] "+JSON.stringify(a))}})},p=function(b){b||(b={});var d=[];b.interfaces&&b.interfaces["interface"]&&(d=b.interfaces["interface"]);
a.model.gres=[];angular.forEach(d,function(b){a.model.gres.push(u(b))})},u=function(b){b||(b={});var d="",g={},h=b["tunnel-configuration"]||{},l=h["tunnel-source"]||{},h=h["tunnel-destination"]||{},m=b.ipv4||{},n=m.address&&m.address[0]||{},p;if(b.name)d=b.name;else{angular.forEach(a.model.gres,function(a){g[a.name]=!0});for(p=1;;){if(!g["GRE"+p]){d="GRE"+p;break}p+=1}}b={checked:!1,edit:!1,type:"new",name:d,enabled:q(b.enabled,!1),description:b.description||"",source:{type:"interface","interface":l["interface"]||
e},destination:{type:"v4_ip",v4_ip:h["ipv4-address"]||""},ipv4:{enabled:q(m.enabled,!0),mtu:q(m.mtu,1440),ip:q(n.ip,""),prefix:q(n["prefix-length"],""),netmask:""},display:{name:"-",ipaddr:"-",source:"-",destination:"-",enabled:"-",status:a.DICT("Gre_Tunnel_Disconnected")}};_.isNumber(b.ipv4.prefix)&&(b.ipv4.netmask=app.TOOLS.netmask.int2Inet(parseInt(b.ipv4.prefix,10)));_.isNumber(b.ipv4.prefix)&&b.ipv4.ip&&(b.display.ipaddr=b.ipv4.ip+"/"+b.ipv4.prefix);b.display.name=b.name+" ("+b.description+")";
b.display.enabled=b.enabled?a.DICT("Gre_Tunnel_Enabled"):a.DICT("Gre_Tunnel_Disabled");switch(b.source.type){case "interface":b.display.source=b.source["interface"]}switch(b.destination.type){case "v4_ip":_.isNumber(b.ipv4.prefix)&&b.destination.v4_ip&&(b.display.destination=b.destination.v4_ip+"/"+b.ipv4.prefix)}return b},x=function(){var b={};a.ui_data.connected_cnt=0;angular.forEach(a.model.wan_state,function(a){b[a.name]=a});angular.forEach(a.model.gres,function(d){d.display.status=a.DICT("Gre_Tunnel_Disconnected");
d.enabled&&b[d.source["interface"]]&&b[d.source["interface"]].ipv4_ip.length&&(d.display.status=a.DICT("Gre_Tunnel_Connected"),a.ui_data.connected_cnt+=1)})},r=function(){s.all([w(),h(),m.get_wan_state()]).then(function(b){l(b[0]&&b[0].data&&b[0].data.result);p(b[1]&&b[1].data&&b[1].data.result);a.model.wan_state=b[2];x();a.gridGreTunnelOptions.data=a.model.gres;a.model.orig_gre=angular.copy(a.model.gres);a.ui_data.number_of_connect=a.DICT("Gre_Tunnel_Number_Of_Connect",{"%d1":a.ui_data.connected_cnt,
"%d2":a.model.gres.length,"%d3":a.ui_data.max_cnt});setTimeout(function(){a.gridGreTunnelOptions.gridApi.customApi.checkSelectStatus()},50);a.edit=void 0;a.resetModified();a.ui_data.page="main";a.ui_data.data_ready=!0})},d=function(b){var d,e,h={};a.ui_data.gre_names=[];angular.forEach(a.model.gres,function(a){h[a.name]=!0});for(d=1;d<=a.ui_data.max_cnt;d++)e={name:"GRE"+d,used:!1},h[e.name]&&b!==e.name&&(e.used=!0),a.ui_data.gre_names.push(e)};a.edit=void 0;a.ui_data={max_cnt:10,selected:[],data_ready:!1,
page:"main",gre_names:[],connected_cnt:0,number_of_connect:""};a.model={ifs:[],gres:[],orig_gre:[],gre_state:[],wan_state:[]};n=function(){a.ui_data.selected=[];angular.forEach(a.model.gres,function(b){b.checked&&a.ui_data.selected.push(b)})};a.gridGreTunnelOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:n,headerChangedCbk:n},{field:"display.name",displayName:a.DICT("Gre_Tunnel_Interface_Name")},{field:"display.ipaddr",displayName:a.DICT("Gre_Tunnel_Ip_Address")},
{field:"display.source",displayName:a.DICT("Gre_Tunnel_Source")},{field:"display.destination",displayName:a.DICT("Gre_Tunnel_Destination")},{field:"display.enabled",displayName:a.DICT("Gre_Tunnel_Enable")},{field:"display.status",displayName:a.DICT("Gre_Tunnel_Status")}]});a.funs={add:function(){var b=u();b.checked=!0;d();a.edit=b;a.model.gres.push(b);a.ui_data.page="edit";a.modified()},del:function(){var b=a.model.gres,d;for(d=b.length-1;0<=d;d--)b[d].checked&&(b.splice(d,1),a.modified())},edit:function(){angular.forEach(a.model.gres,
function(b){b.checked&&(b.type="edit",a.edit=b)});d(a.edit.name);a.ui_data.page="edit"},save:function(){var c=[],d=!1,e=function(){c.length?b.post({method:"set_bulk",forcedUsingPost:!0,params:c,success:function(a){r()},error:function(a){Log(ERROR,"[GRE][save] "+JSON.stringify(a));r()}}):r()};(function(){var b=[],e=!1;angular.forEach(a.model.orig_gre,function(c){e=!0;angular.forEach(a.model.gres,function(a){c.name===a.name&&(e=!1)});e&&b.push({name:c.name})});b.length&&(d=!0,c.push({method:"del_gre",
params:{interfaces:{"interface":b}}}))})();(function(){var b=a.edit;if(b){var d={},e={};switch(b.source.type){case "interface":d={"interface":b.source["interface"]}}switch(b.destination.type){case "v4_ip":e={"ipv4-address":b.destination.v4_ip}}b={name:b.name,description:b.description,enabled:b.enabled,type:"tunnel","tunnel-configuration":{"tunnel-source":d,"tunnel-destination":e},ipv4:{enabled:!0,mtu:b.ipv4.mtu,address:[{ip:b.ipv4.ip,"prefix-length":app.TOOLS.netmask.inet2Int(b.ipv4.netmask)}]}};
c.push({method:"set_gre",params:{interfaces:{"interface":[b]}}})}})();d?app.TOOLS.warningAlertBox({msg:a.DICT("Gre_Tunnel_Warning_Msg1"),title:a.DICT("Gre_Tunnel_Warning"),cbk:function(a){a&&e()}}):e()},cancel:function(){a.model.page="main";r()}};a.chk_description=function(){var b=function(b){a.gre_tunnel&&a.gre_tunnel.description&&a.gre_tunnel.description.$setValidity("repeat",b)},d=a.edit;b(!0);angular.forEach(a.model.gres,function(a){a.name!==d.name&&a.description===d.description&&b(!1)})};r()}]);app.controller("VPNSetupWizardCtrl",["$scope","MyHttp","wan_service","$q","UserSession","userAccessRight","$location",function(a,b,s,n,v,t,m){a.success=!1;a.validation={isErr:!1,repeat_conn:"",profile_name_repeat:!1,profile_name_repeat_err_str:""};var q=[],e=function(b){var c=app.TOOLS.get_scope("WizardCtrl");c&&c.funs.close_vpn_wizard();b&&app.TOOLS.successAlertBox({title:a.DICT("Success"),msg:a.DICT("VPN_Setup_Wizard_Setup_Success"),cbk:function(){app.TOOLS.jumpToPage("VPN_Site_to_Site")}})};a.userAccessFlag=
t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var w=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",error:function(a){l()}})},l=function(b){b||(b={});var c=[];b.interfaces&&b.interfaces["interface"]&&(c=s.filter(b.interfaces["interface"],{physical:!0,usb:!0,subinterface:!0}));a.model.intfs=[];angular.forEach(c,function(b){a.model.intfs.push({id:b.name,displayName:b.name})})},h=function(){return b.post({url:resource_base+"data/ipsec_profiles.json",
method:"get_ipsec_profile",error:function(a){console.log("VPNSetupWizardCtrl getIPSecProfileData error "+a.status);p()}})},p=function(b){b||(b={});var c=[],d,e,h=function(b){b||(b={});return{dh_group:b["dh-group"]||a.model.dh_group[0]&&a.model.dh_group[0].id||"",encryption:b.encryption||a.model.encryption[0]&&a.model.encryption[0].id||"",authentication:b.authentication||a.model.authentication[0]&&a.model.authentication[0].id||"",lifetime:b["sa-lifetime"]||28800}},l=function(b){b||(b={});var c={dh_group:b["dh-group"]||
a.model.dh_group[0]&&a.model.dh_group[0].id||"",protocal:"esp",encryption:b.encryption||a.model.encryption[0]&&a.model.encryption[0].id||"",authentication:b.authentication||a.model.authentication[0]&&a.model.authentication[0].id||"",lifetime:b["sa-lifetime"]||3600,pfs:void 0!==b["perfect-forward-secrecy"]?b["perfect-forward-secrecy"]:!0};angular.forEach(b,function(b,d){switch(d){case "encryption":c.protocal="esp";c.encryption=b||a.model.encryption[0]&&a.model.encryption[0].id||"";break;case "empty":c.protocal=
"ah"}});return c};b["ipsec-profiles"]&&b["ipsec-profiles"]["ipsec-profile"]&&(c=b["ipsec-profiles"]["ipsec-profile"]);a.model.profiles=[{id:"@new",displayName:"New Profile",ikeMode:"v2",phase1:h(),phase2:l()}];a.model.default_profile=void 0;angular.forEach(c,function(b){if((e=b["keying-mode"])&&e["phase1-options"]&&e["phase2-options"])d="v2",e["ike-version"]&&angular.forEach(e["ike-version"],function(a,b){switch(b){case "v1":d="v1";break;default:d="v2"}}),a.model.profiles.push({id:b["profile-name"],
displayName:b["profile-name"],ikeMode:d,phase1:h(e["phase1-options"]),phase2:l(e["phase2-options"])}),"Default"===b["profile-name"]&&(a.model.default_profile="Default")});a.model.default_profile||(a.model.default_profile=a.model.profiles[0]&&a.model.profiles[0].id||"")},u=function(){return b.post({url:resource_base+"data/ipsec_site_to_site.json",method:"get_site_to_site",error:function(a){console.log("siteToSiteCtrl getSiteToSiteData error, status: "+a.status);x()}})},x=function(b){b||(b={});var c=
(b["site-to-sites"]||{})["site-to-site"]||[];b="";q=[];a.model.s2s=[];angular.forEach(c,function(b){a.model.s2s.push(r(b))});for(c=0;c<a.model.s2s.length;c++)b=a.model.s2s[c]["interface"]+"#","static-ip"===a.model.s2s[c].remote_endpoint.type?b=b+a.model.s2s[c].remote_endpoint.type+"#"+a.model.s2s[c].remote_endpoint.ip:"fqdn"===a.model.s2s[c].remote_endpoint.type?b=b+a.model.s2s[c].remote_endpoint.type+"#"+a.model.s2s[c].remote_endpoint.fqdn:"dynamic-ip"===a.model.s2s[c].remote_endpoint.type&&(b=b+
a.model.s2s[c].remote_endpoint.type+"#dynamic-ip"),b+="#","interface"===a.model.s2s[c].local_group.identifier.type?b=b+a.model.s2s[c].local_group.identifier.type+"#0.0.0.0":"ip"===a.model.s2s[c].local_group.identifier.type?b=b+a.model.s2s[c].local_group.identifier.type+"#"+a.model.s2s[c].local_group.identifier.ip:"fqdn"===a.model.s2s[c].local_group.identifier.type?b=b+a.model.s2s[c].local_group.identifier.type+"#"+a.model.s2s[c].local_group.identifier.fqdn:"user-fqdn"===a.model.s2s[c].local_group.identifier.type?
b=b+a.model.s2s[c].local_group.identifier.type+"#"+a.model.s2s[c].local_group.identifier.user_fqdn:"der-asn1-dn"===a.model.s2s[c].local_group.identifier.type&&(b=b+a.model.s2s[c].local_group.identifier.type+"#any"),b+="#","ip"===a.model.s2s[c].remote_group.identifier.type?b=b+a.model.s2s[c].remote_group.identifier.type+"#"+a.model.s2s[c].remote_group.identifier.ip:"fqdn"===a.model.s2s[c].remote_group.identifier.type?b=b+a.model.s2s[c].remote_group.identifier.type+"#"+a.model.s2s[c].remote_group.identifier.fqdn:
"user-fqdn"===a.model.s2s[c].remote_group.identifier.type?b=b+a.model.s2s[c].remote_group.identifier.type+"#"+a.model.s2s[c].remote_group.identifier.user_fqdn:"der-asn1-dn"===a.model.s2s[c].remote_group.identifier.type&&(b=void 0===a.model.s2s[c].remote_group.identifier.asn1dn||""===a.model.s2s[c].remote_group.identifier.asn1dn?b+a.model.s2s[c].remote_group.identifier.type+"#any":b+a.model.s2s[c].remote_group.identifier.type+"#"+a.model.s2s[c].remote_group.identifier.asn1dn),b=b+"@"+a.model.s2s[c].connection_name,
q.push(b)},r=function(b){b||(b={});var c=b["remote-endpoint"]||{},d={},e=a.model.ifs,h=a.model.profile,l=function(a,b){a&&(a.identifier&&angular.forEach(a.identifier,function(a,c){switch(c){case "ip":b.identifier.type=c;b.identifier.ip=a||"";break;case "interface":b.identifier.type=c;b.identifier["interface"]="";break;case "fqdn":b.identifier.type=c;b.identifier.fqdn=a||"";break;case "user-fqdn":b.identifier.type=c;b.identifier.user_fqdn=a||"";break;case "der-asn1-dn":b.identifier.type=c,b.identifier.asn1dn=
a||""}}),a.group&&angular.forEach(a.group,function(a,c){switch(c){case "subnet":"0.0.0.0"===a.ip&&"0.0.0.0"===a.netmask?b.group.type="any":(b.group.type=c,b.group.subnet_ip=a.ip||"",b.group.subnet_netmask=a.netmask||"");break;case "ip":b.group.type=c;b.group.ip=a.ip||"";break;case "ip-range":b.group.type=c,b.group.begin_ip=a["begin-ip"]||"",b.group.end_ip=a["end-ip"]||""}}))},d={connection_name:b["connection-name"]||"",type:"s2s",ike_mode:"v2",enable:void 0!==b.enable?b.enable:!0,"interface":b["interface"]||
e[0]&&e[0].name||"",ipsec_profile:b["ipsec-profile"]||h[0]&&h[0].name||"",ipsec_profile_type:"",remote_endpoint:{type:"static-ip",ip:"",fqdn:""},local_group:{identifier:{type:"interface",ip:"","interface":"",fqdn:"",user_fqdn:"",asn1dn:""},group:{type:"subnet",subnet_ip:"",subnet_netmask:"",ip:"",begin_ip:"",end_ip:""}},remote_group:{identifier:{type:"ip",ip:"",fqdn:"",user_fqdn:"",asn1dn:""},group:{type:"subnet",subnet_ip:"",subnet_netmask:"",ip:"",begin_ip:"",end_ip:""}}};b["remote-endpoint"]&&
(d.remote_endpoint.type="dynamic-ip",angular.forEach(c,function(a,b){switch(b){case "static-ip":d.remote_endpoint.type=b;d.remote_endpoint.ip=a;break;case "fqdn":d.remote_endpoint.type=b,d.remote_endpoint.fqdn=a}}));l(b["local-group"],d.local_group);l(b["remote-group"],d.remote_group);return d},d=[{id:"subnet",displayName:a.DICT("VPN_Setup_Wizard_Subnet_N")},{id:"ip",displayName:a.DICT("VPN_Setup_Wizard_IP_Addr_N")}],c=function(){var b={intf:"",connect_name:"",remote_conn_type:a.model.conn_type_list[0].id,
remote_ip:"",remote_fqdn:"",presharekey:"",show_key_in_plain:!1,ipsec_profile:"",profile_name:"",ike_mode:"v2",symm_authentication:{presharekey:"",show_key_in_plain:!1},local_authentication:{presharekey:"",show_key_in_plain:!1},remote_authentication:{presharekey:"",show_key_in_plain:!1},local:{type:a.model.local_group[0].id,subnet_ip:"",subnet_netmask:"",ip:""},remote:{type:a.model.remote_group[0].id,subnet_ip:"",subnet_netmask:"",ip:""},phase1:{},phase2:{}};b.intf=a.model.intfs[0]&&a.model.intfs[0].id||
"";b.ipsec_profile=a.model.default_profile;return b};a.dataReady=!1;a.model={default_profile:"",profiles:[],intfs:[],d:{},s2s:[]};a.model.changeProfle=function(){var b,c;if("@new"===a.model.d.ipsec_profile)a.model.d.phase1={dh_group:a.model.dh_group[0]&&a.model.dh_group[0].id||"",encryption:a.model.encryption[0]&&a.model.encryption[0].id||"",authentication:a.model.authentication[0]&&a.model.authentication[0].id||"",lifetime:28800,pfs:!0},a.model.d.phase2={dh_group:a.model.dh_group[0]&&a.model.dh_group[0].id||
"",protocal:a.model.protocals[0]&&a.model.protocals[0].id||"",encryption:a.model.encryption[0]&&a.model.encryption[0].id||"",authentication:a.model.authentication[0]&&a.model.authentication[0].id||"",lifetime:3600},a.model.d.ike_mode="v2";else{for(c=a.model.profiles.length-1;0<=c;c--)if(a.model.profiles[c].id===a.model.d.ipsec_profile){b=a.model.profiles[c];break}a.model.d.phase1=b.phase1;a.model.d.phase2=b.phase2;a.model.d.ike_mode=b.ikeMode}};a.model.getGroupName=function(b,c){var d="",e,h;if("remote"===
c)h=a.model.remote_group;else if("local"===c)h=a.model.local_group;else return"";for(e=h.length-1;0<=e;e--)if(h[e].id===b){d=h[e].displayName;break}return d};a.model.getAuthenticationName=function(b){var c="",d;for(d=a.model.authentication.length-1;0<=d;d--)if(a.model.authentication[d].id===b){c=a.model.authentication[d].displayName;break}return c};a.model.getEncryptionName=function(b){var c="",d;for(d=a.model.encryption.length-1;0<=d;d--)if(a.model.encryption[d].id===b){c=a.model.encryption[d].displayName;
break}return c};a.model.getDHGroupName=function(b){var c="",d;for(d=a.model.dh_group.length-1;0<=d;d--)if(a.model.dh_group[d].id===b){c=a.model.dh_group[d].displayName;break}return c};a.model.change_ip_type=function(){var b=a.model.d,c=b.local,b=b.remote;c&&b&&(a.model.local_group=angular.copy(d),a.model.remote_group=angular.copy(d),"any"===c.type&&"any"!==b.type?a.model.local_group.push({id:"any",displayName:a.DICT("VPN_Setup_Wizard_Any")}):("any"!==c.type&&"any"===b.type||a.model.local_group.push({id:"any",
displayName:a.DICT("VPN_Setup_Wizard_Any")}),a.model.remote_group.push({id:"any",displayName:a.DICT("VPN_Setup_Wizard_Any")})))};a.validation.check_profile_name=function(){var b=a.model.d,c=b.profile_name||"",d=!1;a.validation.profile_name_repeat=!1;a.validation.profile_name_repeat_err_str="";if("@new"===b.ipsec_profile){for(b=0;b<a.model.profiles.length;b++)a.model.profiles[b].id===c&&(d=!0);d&&(a.validation.profile_name_repeat=!0,a.validation.profile_name_repeat_err_str=a.DICT("VPN_Setup_Wizard_Ipsec_Profile_Repeat",
{"%s":c}))}};a.funs={cancel:function(){a.model.d=c();a.model.change_ip_type();a.resetModified()},submit:function(c){var d=c.d;c=!1;var h=function(){var a={"connection-name":d.connect_name,"interface":d.intf,"ipsec-profile":d.ipsec_profile,"remote-endpoint":{},"local-group":{},"remote-group":{}};"v1"===d.ike_mode?a["symm-authentication"]={password:d.symm_authentication.presharekey,"minimum-complexity":!1}:(a["local-authentication"]={password:d.local_authentication.presharekey,"minimum-complexity":!1},
a["remote-authentication"]={password:d.remote_authentication.presharekey,"minimum-complexity":!1});switch(d.local.type){case "any":a["local-group"]={group:{subnet:{ip:"0.0.0.0",netmask:"0.0.0.0"}}};break;case "subnet":a["local-group"]={group:{subnet:{ip:d.local.subnet_ip,netmask:d.local.subnet_netmask}}};break;default:a["local-group"]={group:{ip:{ip:d.local.ip}}}}switch(d.remote.type){case "any":a["remote-group"]={group:{subnet:{ip:"0.0.0.0",netmask:"0.0.0.0"}}};break;case "subnet":a["remote-group"]=
{group:{subnet:{ip:d.remote.subnet_ip,netmask:d.remote.subnet_netmask}}};break;default:a["remote-group"]={group:{ip:{ip:d.remote.ip}}}}switch(d.remote_conn_type){case "static-ip":a["remote-endpoint"]={"static-ip":d.remote_ip};a["remote-group"].identifier={ip:d.remote_ip};break;default:a["remote-endpoint"]={fqdn:d.remote_fqdn},a["remote-group"].identifier={fqdn:d.remote_fqdn}}b.post({method:"set_site_to_site",forcedUsingPost:!0,params:{"site-to-sites":{"site-to-site":[a]}},success:function(){app.TOOLS.get_scope("headerCtrl").enable_save_warning();
e(!0)},error:function(){e(!1)}})};"@new"===d.ipsec_profile&&(d.ipsec_profile=d.profile_name,c={"profile-name":d.profile_name,"keying-mode":{"ike-version":{},"phase1-options":{"dh-group":d.phase1.dh_group,encryption:d.phase1.encryption,authentication:d.phase1.authentication,"sa-lifetime":d.phase1.lifetime},"phase2-options":{authentication:d.phase2.authentication,"sa-lifetime":d.phase2.lifetime,"perfect-forward-secrecy":d.phase2.pfs}}},"v1"===d.ike_mode?c["keying-mode"]["ike-version"].v1=null:c["keying-mode"]["ike-version"].v2=
null,"ah"===d.phase2.protocal?c["keying-mode"]["phase2-options"].empty=null:c["keying-mode"]["phase2-options"].encryption=d.phase2.encryption,d.phase1.pfs&&(c["keying-mode"]["phase2-options"]["dh-group"]=d.phase2.dh_group),b.post({method:"set_ipsec_profile",forcedUsingPost:!0,params:{"ipsec-profiles":{"ipsec-profile":[c]}},success:function(a){h()},error:function(a){e(!1)}}),c=!0);c||h();a.resetModified()}};a.validation.checkCombineUnique=function(){a.isErr=!1;var b=a.model.d.intf,c=a.model.d.remote_conn_type,
d="",e="",h="",l="",m=[];if(void 0===a.model.d.remote_ip||void 0===a.model.d.remote_fqdn)a.isErr=!1;else{"static-ip"===c?d=a.model.d.remote_ip:"fqdn"===c&&(d=a.model.d.remote_fqdn);l=b+"#"+c+"#"+d+"#";l+="interface#0.0.0.0#";"static-ip"===c?(e="ip",h=d):"fqdn"===c&&(e="fqdn",h=d);l=l+e+"#"+h;for(b=0;b<q.length;b++)if(m=q[b].split("@"),m[0]===l){a.validation.repeat_conn=m[1];a.validation.isErr=!0;break}}};a.model.conn_type_list=[{id:"static-ip",displayName:a.DICT("VPN_Setup_Wizard_IP_Addr_N")},{id:"fqdn",
displayName:a.DICT("VPN_Setup_Wizard_FQDN")}];a.model.local_identifier=[{id:"ip",displayName:a.DICT("VPN_Setup_Wizard_Local_WAN_IP")},{id:"fqdn",displayName:a.DICT("VPN_Setup_Wizard_Local_FQDN")},{id:"user-fqdn",displayName:a.DICT("VPN_Setup_Wizard_Local_User_FQDN")}];a.model.remote_identifier=[{id:"ip",displayName:a.DICT("VPN_Setup_Wizard_Remote_WAN_IP")},{id:"fqdn",displayName:a.DICT("VPN_Setup_Wizard_Remote_FQDN")},{id:"user-fqdn",displayName:a.DICT("VPN_Setup_Wizard_Remote_User_FQDN")}];a.model.local_group=
angular.copy(d);a.model.remote_group=angular.copy(d);a.model.authentication=[{id:"md5",displayName:"MD5"},{id:"sha1",displayName:"SHA1"},{id:"sha2-256",displayName:"SHA2-256"}];a.model.protocals=[{id:"esp",displayName:"ESP"},{id:"ah",displayName:"AH"}];a.model.encryption=[{id:"esp-3des",displayName:"3DES"},{id:"esp-aes-128",displayName:"AES 128"},{id:"esp-aes-192",displayName:"AES 192"},{id:"esp-aes-256",displayName:"AES 256"}];a.model.dh_group=[{id:"dh-group-2",displayName:"Group2 - 1024 bit"},{id:"dh-group-5",
displayName:"Group5 - 1536 bit"},{id:"dh-group-14",displayName:"Group14 - 2048 bit"}];(function(){a.dataReady=!1;n.all([w(),h(),u()]).then(function(b){l(b[0].data&&b[0].data.result||{});p(b[1].data&&b[1].data.result||{});x(b[2].data&&b[2].data.result||{});a.model.d=c();a.model.change_ip_type();a.model.changeProfle();app.TOOLS.wizardBox({title:a.DICT("VPN_Setup_Wizard"),className:"ngdialog-theme-default wizard-page",validation:a.validation,model:a.model,list:[{name:a.DICT("VPN_Setup_Wizard_Getting_Started"),
templateUrl:"step1.html"},{name:a.DICT("VPN_Setup_Wizard_Remote_Router_Settings"),templateUrl:"step2.html"},{name:a.DICT("VPN_Setup_Wizard_Local_Remote_Networks"),templateUrl:"step3.html"},{name:a.DICT("VPN_Setup_Wizard_Profile"),templateUrl:"step4.html"},{name:a.DICT("VPN_Setup_Wizard_Summary"),templateUrl:"step5.html"}],cbk:function(b,c){b?a.funs.submit(c):e(!1)}});a.dataReady=!0})})()}]);app.controller("ipsecProfilesCtrl",["$scope","MyHttp","$q","UserSession","userAccessRight","goToPreviousPage",function(a,b,s,n,v,t){var m=a.DICT("IP_Sec_Profiles_Yes"),q=a.DICT("IP_Sec_Profiles_No"),e=app.TOOLS.getVal,w=app.TOOLS.getResponse;a.success=!1;a.userAccessFlag=v.get();a.backbtn=!1;"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();t.isneed()&&(a.backbtn=!0);var l=function(){return b.post({url:resource_base+"data/ipsec_profiles.json",method:"get_ipsec_profile",error:function(a){Log(ERROR,
"ipsecProfilesCtrl getProfileData error, status: "+a.status)}})},h=function(b){b||(b={});b=(b["ipsec-profiles"]||{})["ipsec-profile"]||[];a.model.profile=[];angular.forEach(b,function(b,c){a.model.profile.push(p(b))});g()},p=function(a){a||(a={});var b=a["keying-mode"]||{},c=b["ike-version"]||{},d=b["phase1-options"]||{},e=b["phase2-options"]||{},g,h="auto";a["keying-mode"]&&(h=b["phase1-options"]?"auto":"manual");g={profile_name:a["profile-name"]||"",key_mode:h,ike_version:null===c.v2?"v2":"v1",
phase1:{dh_group:d["dh-group"]||"dh-group-14",encryption:d.encryption||"esp-aes-256",authentication:d.authentication||"sha2-256",sa_lifetime:d["sa-lifetime"]||28800},phase2:{protocal:"esp",encryption:"esp-aes-256",dh_group:e["dh-group"]||"dh-group-14",authentication:e.authentication||"sha2-256",sa_lifetime:e["sa-lifetime"]||3600,perfect_forward_secrecy:void 0!==e["perfect-forward-secrecy"]?e["perfect-forward-secrecy"]:!0},spi_incoming:void 0!==b["spi-incoming"]?b["spi-incoming"].toString(16).toUpperCase():
"100",spi_outgoing:void 0!==b["spi-outgoing"]?b["spi-outgoing"].toString(16).toUpperCase():"100",encryption:b.encryption||"esp-aes-256",encryption_key_in:b["encryption-key-in"]||"",encryption_key_out:b["encryption-key-out"]||"",authentication:b.authentication||"sha2-256",authentication_key_in:b["authentication-key-in"]||"",authentication_key_out:b["authentication-key-out"]||"",inUse:!1};angular.forEach(e,function(a,b){switch(b){case "encryption":g.phase2.protocal="esp";g.phase2.encryption=a||"esp-aes-256";
break;case "empty":g.phase2.protocal="ah"}});return g},u=function(){return b.post({url:resource_base+"data/ipsec_site_to_site.json",method:"get_site_to_site",error:function(a){Log(ERROR,"ipsecProfilesCtrl getSiteToSiteData error, status: "+a.status)}})},x=function(b){b||(b={});b=(b["site-to-sites"]||{})["site-to-site"]||[];a.model.site2site=[];angular.forEach(b,function(b){a.model.site2site.push({connection_name:b["connection-name"]||"",ipsec_profile:b["ipsec-profile"]||""})})},r=function(){return b.post({url:resource_base+
"data/l2tp_server.json",method:"get_l2tp_server",error:function(a){d()}})},d=function(b){b||(b={});a.model.l2tp_server_ipsec_profile=(b.l2tp||{})["ipsec-profile"]||""},c=function(){return b.post({url:resource_base+"data/ipsec_client_to_site.json",method:"get_client_to_site",error:function(a){Log(ERROR,"ipsecProfilesCtrl getClientToSiteData error "+a.status);k()}})},k=function(b){b||(b={});var c=[];a.model.client2site=[];b["client-to-sites"]&&b["client-to-sites"]["client-to-site"]&&(c=b["client-to-sites"]["client-to-site"]);
angular.forEach(c,function(b){b["ipsec-profile"]&&a.model.client2site.push({seq:b.seq,ipsec_profile:b["ipsec-profile"]})})},g=function(){var b;a.model.profileTable=[];angular.forEach(a.model.profile,function(c,d){c.inUse=!1;"Default"===c.profile_name&&(c.inUse=!0);angular.forEach(a.model.site2site,function(a){a.ipsec_profile===c.profile_name&&(c.inUse=!0)});angular.forEach(a.model.client2site,function(a){a.ipsec_profile===c.profile_name&&(c.inUse=!0)});c.profile_name===a.model.l2tp_server_ipsec_profile&&
(c.inUse=!0);b="auto"===c.key_mode?"v1"===c.ike_version?a.DICT("IP_Sec_Profiles_IKE1"):a.DICT("IP_Sec_Profiles_IKE2"):"--";a.model.profileTable.push({checked:!1,name:c.profile_name||"",policy:"auto"===c.key_mode?a.DICT("IP_Sec_Profiles_Auto"):a.DICT("IP_Sec_Profiles_Manual"),ikeVersion:b,inUseStr:c.inUse?m:q,idx:d})});a.gridProfileOptions.data=a.model.profileTable},z=function(){return b.post({url:resource_base+"data/ipsec_enable.json",method:"get_ipsec_enable",error:function(a){Log(ERROR,"[IPSec Profile][getIPSecEnable] "+
JSON.stringify(a));y()}})},y=function(b){b||(b={});b=e((b.ipsec||{}).enable,!0);a.model.ipsec_enable=b},A=function(){a.model.schema={dh_group:[{id:"dh-group-2",displayName:"Group2 - 1024 bit"},{id:"dh-group-5",displayName:"Group5 - 1536 bit"},{id:"dh-group-14",displayName:"Group14 - 2048 bit"}],encryption:[{id:"esp-3des",displayName:"3DES"},{id:"esp-aes-128",displayName:"AES-128"},{id:"esp-aes-192",displayName:"AES-192"},{id:"esp-aes-256",displayName:"AES-256"}],authentication:[{id:"md5",displayName:"MD5"},
{id:"sha1",displayName:"SHA1"},{id:"sha2-256",displayName:"SHA2-256"}],key_mode:[{id:"auto",displayName:a.DICT("IP_Sec_Profiles_Auto")},{id:"manual",displayName:a.DICT("IP_Sec_Profiles_Manual")}],key_length:{md5:32,sha1:40,"sha2-256":64,"esp-3des":48,"esp-aes-128":32,"esp-aes-192":48,"esp-aes-256":64,"dh-group-2":256,"dh-group-5":384,"dh-group-14":512},protocals:[{id:"esp",displayName:"ESP"},{id:"ah",displayName:"AH"}]};s.all([u(),c(),r(),l(),z()]).then(function(b){a.selectIdx=-1;x(w(b,0));k(w(b,
1));d(w(b,2));h(w(b,3));y(w(b,4));a.model.dels=[];B();a.resetModified();setTimeout(function(){a.gridProfileOptions.gridApi&&a.gridProfileOptions.gridApi.customApi&&a.gridProfileOptions.gridApi.customApi.checkSelectStatus()},50);a.dataReady=!0})};a.pageMap={main:"ipsec_profile_main.html",edit:"ipsec_profile_edit.html"};var B=function(b){a.ui_data.selected=[];a.ui_data.disableDelBtn=!1;angular.forEach(a.model.profileTable,function(b){if(b.checked&&(a.ui_data.selected.push(b),b.inUseStr===m||"Default"===
b.name))a.ui_data.disableDelBtn=!0})},C=function(){return 50<=a.model.profileTable.length?(a.msg=a.DICT("IP_Sec_Profiles_Max_Entry",{"%d":a.model.profileTable.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.currPage="main";a.selectIdx=-1;a.dataReady=!1;a.ui_data={selected:[]};a.model={ipsec_enable:!0,profile:[],schema:{},site2site:[],client2site:[],l2tp_server_ipsec_profile:"",profileTable:[],dels:[],selects:[]};a.edit={};a.orig=void 0;a.key_pattern=/^[0-9a-fA-F]+$/;a.funs=
{edit:function(){var b;angular.forEach(a.model.profileTable,function(c){c.checked&&angular.forEach(a.model.profile,function(a){c.name===a.profile_name&&(b=a)})});a.edit={};a.edit=angular.copy(b);a.edit.type="edit";a.orig=angular.copy(b);a.modified();a.currPage="edit"},del:function(b){var c=a.model.profile,d;angular.forEach(a.model.profileTable,function(b){if(b.checked)for(d=c.length-1;0<=d;d--)c[d].profile_name===b.name&&!c[d].inUse&&(a.model.dels.push(c[d]),c.splice(d,1))});g();a.ui_data.selected=
[];a.modified()},clone:function(){var b;angular.forEach(a.model.profileTable,function(c){c.checked&&angular.forEach(a.model.profile,function(a){c.name===a.profile_name&&(b=a)})});a.edit={};a.edit=angular.copy(b);a.edit.profile_name="";a.edit.type="clone";a.edit.inUse=!1;a.orig=void 0;a.modified();a.currPage="edit"},add:function(){C()||(a.edit={},a.edit=p(),a.edit.type="new",a.orig=void 0,a.currPage="edit",a.modified())},save:function(){var c=[],d=function(){var b=[];0<a.model.dels.length&&(angular.forEach(a.model.dels,
function(a){b.push({"profile-name":a.profile_name})}),c.push({method:"del_ipsec_profile",params:{"ipsec-profiles":{"ipsec-profile":b}}}),a.model.dels=[])},e=function(){var b=a.edit,d=a.orig,e=a.currPage,g={};c.push({method:"set_ipsec_enable",params:{ipsec:{enable:a.model.ipsec_enable}}});if("edit"===e){switch(a.edit.type){case "clone":case "new":case "edit":break;default:return}d&&d.profile_name!==b.profile_name&&c.push({method:"del_ipsec_profile",params:{"ipsec-profiles":{"ipsec-profile":[{"profile-name":d.profile_name}]}}});
g={"profile-name":b.profile_name,"keying-mode":{}};"auto"===b.key_mode?(g["keying-mode"]={"ike-version":"v1"===b.ike_version?{v1:null}:{v2:null},"phase1-options":{"dh-group":b.phase1.dh_group,encryption:b.phase1.encryption,authentication:b.phase1.authentication,"sa-lifetime":b.phase1.sa_lifetime},"phase2-options":{"dh-group":!b.phase2.perfect_forward_secrecy?b.phase1.dh_group:b.phase2.dh_group,authentication:b.phase2.authentication,"sa-lifetime":b.phase2.sa_lifetime,"perfect-forward-secrecy":b.phase2.perfect_forward_secrecy}},
"ah"===b.phase2.protocal?g["keying-mode"]["phase2-options"].empty=null:g["keying-mode"]["phase2-options"].encryption=b.phase2.encryption):g["keying-mode"]={"spi-incoming":parseInt(b.spi_incoming,16),"spi-outgoing":parseInt(b.spi_outgoing,16),encryption:b.encryption,"encryption-key-in":b.encryption_key_in,"encryption-key-out":b.encryption_key_out,authentication:b.authentication,"authentication-key-in":b.authentication_key_in,"authentication-key-out":b.authentication_key_out};c.push({method:"set_ipsec_profile",
params:{"ipsec-profiles":{"ipsec-profile":[g]}}})}},g=function(){d();e();c.length?b.post({method:"set_bulk",params:c,success:function(b){a.success=!0;A();a.currPage="main"},error:function(b){a.success=!0;A();a.currPage="main"}}):(A(),a.currPage="main")};"edit"===a.currPage&&function(){var b=a.edit,c=!1;if("auto"===b.key_mode){if("esp-3des"===b.phase1.encryption||"md5"===b.phase1.authentication)c=!0;if("esp"===b.phase2.protocal&&("esp-3des"===b.phase2.encryption||"md5"===b.phase2.authentication))c=
!0;"ah"===b.phase2.protocal&&"md5"===b.phase2.authentication&&(c=!0)}else if("esp-3des"===b.encryption||"md5"===b.authentication)c=!0;return c}()?app.TOOLS.warningAlertBox({msg:a.DICT("IP_Sec_Profiles_Week_Note"),cbk:function(a){a&&g()}}):g()},cancel:function(){a.currPage="main";A()},go_back:t.goback};a.gridProfileOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",changedCbk:B,headerChanged:B,isCheckbox:!0,id:"ipsecprofile"},{field:"name",displayName:a.DICT("IP_Sec_Profiles_Name")},
{field:"ikeVersion",displayName:a.DICT("IP_Sec_Profiles_IKE_Version_N")},{field:"policy",displayName:a.DICT("IP_Sec_Profiles_Policy")},{field:"inUseStr",displayName:a.DICT("IP_Sec_Profiles_In_Use")}]});a.checkProfileName=function(){if(!a.edit||!a.edit.profile_name)return a.profile.profile_name.$setValidity("repeat",!0),a.profile.profile_name.$setValidity("special",!0),!0;if(a.edit.profile_name.match(/^\w+$/))a.profile.profile_name.$setValidity("special",!0);else return a.profile.profile_name.$setValidity("special",
!1),!1;var b=!1;angular.forEach(a.model.profile,function(c,d){c.profile_name===a.edit.profile_name&&(b=!0)});if(b)return a.profile.profile_name.$setValidity("repeat",!1),!1;a.profile.profile_name.$setValidity("repeat",!0);return!0};a.checkSPI=function(b){var c,d=parseInt("0xFFFFFFFE",16);switch(b){case "spi_in":c=a.edit.spi_incoming;break;case "spi_out":c=a.edit.spi_outgoing;break;default:return}c=parseInt("0x"+c,16);isNaN(c)||256>c||c>d?a.profile[b].$setValidity("illegal",!1):a.profile[b].$setValidity("illegal",
!0)};A()}]);app.controller("l2tp_server_main",["$scope","$q","MyHttp","UserSession","userAccessRight","addressPoolValidate",function(a,b,s,n,v,t){var m=app.TOOLS.getResponse,q=app.TOOLS.getVal;a.loadReady=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.ipsecprofile_note=a.DICT("L2TP_Server_Ipsec_Profile_Note",{"%s":"<a ng-click=\"jumpToPage('VPN_IPsec_Profiles')\">"+a.DICT("here")+"</a>"});a.model={ipsec_enable:!0,rule_list:[],nacm_grid:[],orig_dbgroups:[],orig_groups:[],groups:[],connections:[],l2tp:{enable:!1,mtu:1400,
start_ip:"",end_ip:"",primary_dns:"",secondary_dns:"",ipsec:!1,ipsec_profile:"",psk:""}};a.ui_data={show_key_in_plain:!1,enable_show_key_in_plain:!1,pwd_changed:!1,disable_DE_btn:!1,disable_add_btn:!1};var e="";a.success=!1;a.subnetObj={};a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var w=function(b){b||(b={});var d=[],g;b["ipsec-profiles"]&&b["ipsec-profiles"]["ipsec-profile"]&&(d=b["ipsec-profiles"]["ipsec-profile"]);a.model.ipsec_profiles=[];e="";angular.forEach(d,
function(b){if((g=b["keying-mode"])&&(g["phase1-options"]&&g["phase2-options"])&&!("v2"in g["ike-version"]))"Default"===b["profile-name"]&&(e=b["profile-name"]),a.model.ipsec_profiles.push({id:b["profile-name"]||"",displayName:b["profile-name"]||""})});e||(e=a.model.ipsec_profiles[0]&&a.model.ipsec_profiles[0].id||"")},l=function(){return s.post({url:resource_base+"data/ipsec_enable.json",method:"get_ipsec_enable",error:function(a){Log(ERROR,"[S2S][getIPSecEnable] "+JSON.stringify(a));h()}})},h=function(b){b||
(b={});b=q((b.ipsec||{}).enable,!0);a.model.ipsec_enable=b},p=function(){var c=s.post({url:resource_base+"data/l2tp_server.json",method:"get_l2tp_server",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),d=s.post({url:resource_base+"data/nacm_group.json",method:"get_groups",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),g=s.post({url:resource_base+"data/ipsec_profiles.json",method:"get_ipsec_profile",error:function(a){Log(ERROR,
"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),n=s.post({url:resource_base+"data/aaa.json",method:"get_subnet",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,d,g,n,l()]).then(function(b){w(m(b,2));var c=m(b,3);a.subnetObj={};c&&(c.subnets&&c.subnets.ipv4&&c.subnets.ipv6)&&(a.subnetObj=angular.copy(c.subnets));u(m(b,1));(c=m(b,0))||(c={});c=c.l2tp||{};a.model.l2tp={enable:q(c.enable,!1),mtu:q(c.mtu,1400),start_ip:c["start-ip"]||"",end_ip:c["end-ip"]||
"",primary_dns:c["primary-dns"]||"",secondary_dns:c["secondary-dns"]||"",ipsec:q(c.ipsec,!1),ipsec_profile:c["ipsec-profile"]||e,psk:""};c["preshared-key"]?(a.model.l2tp.psk="12345678901234567890",a.ui_data.enable_show_key_in_plain=!1):a.ui_data.enable_show_key_in_plain=!0;a.ui_data.show_key_in_plain=!1;a.ui_data.pwd_changed=!1;h(m(b,4));a.gridGroup.data=a.model.selected_groups;a.loadReady=!0})},u=function(b){var d=[];b||(b={});b.groups&&b.groups.group&&(d=b.groups.group);a.model.orig_dbgroups=angular.copy(d);
a.model.orig_groups=[];a.model.selected_groups=[];angular.forEach(d,function(b){a.model.orig_groups.push({id:b.name,displayName:b.name});angular.forEach(b["feature-rule"],function(c){"l2tp"===c.service&&"permit"===c.action&&a.model.selected_groups.push({checked:!1,edit:!1,empty:"",exp:{select:b.name,list:[]}})})});r()},x=function(){var b=angular.copy(a.model.orig_groups),d;angular.forEach(a.model.selected_groups,function(a){for(d=b.length-1;0<=d;d--)b[d].id===a.exp.select&&b.splice(d,1)});return b},
r=function(){var b=x();a.ui_data.disable_add_btn=b.length?!1:!0;angular.forEach(a.model.selected_groups,function(a){a.exp.list=[{id:a.exp.select,displayName:a.exp.select}];a.exp.list=a.exp.list.concat(b)})},d=function(b){a.ui_data.disable_DE_btn=!0;angular.forEach(a.model.selected_groups,function(b,c){b.checked&&(a.ui_data.disable_DE_btn=!1)})};a.gridGroup=app.uiGrid.generateGridOptions({IDPreifx:"l2tp",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:d,headerChangedCbk:d},{field:"exp",displayName:a.DICT("L2TP_Server_Group_Name"),
minWidth:350,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html",change:r},{field:"empty",isEmpty:!0}]});a.save=function(){var b=[];(function(){var d={},e=!1,h;angular.forEach(a.model.selected_groups,function(a){d[a.exp.select]=!0});angular.forEach(a.model.orig_dbgroups,function(a){angular.forEach(a["feature-rule"],function(b){"l2tp"===b.service&&(h=d[a.name]?"permit":"deny",h!==b.action&&(b.action=h,e=!0))})});e&&b.push({method:"set_groups",params:{groups:{group:a.model.orig_dbgroups}}})})();
(function(){var d=a.model.l2tp,e={enable:d.enable,mtu:d.mtu,"start-ip":d.start_ip,"end-ip":d.end_ip,"primary-dns":d.primary_dns,"secondary-dns":d.secondary_dns,ipsec:d.ipsec,"ipsec-profile":d.ipsec_profile};a.ui_data.pwd_changed&&(e["preshared-key"]=d.psk);b.push({method:"set_l2tp_server",params:{l2tp:e}})})();s.post({method:"set_bulk",params:b,success:function(b){p();a.resetModified()},error:function(b){Log(ERROR,"[L2TP Server] set_bulk ERR");Log(ERROR,b);p();a.resetModified()}})};a.cancel=function(){p();
a.resetModified()};a.addGroup=function(){var b=x();a.model.selected_groups.push({checked:!0,empty:"",edit:!0,exp:{select:b[0].id,list:[]}});r();d();a.gridGroup.gridApi.customApi.scrollToLast();a.modified()};a.editGroup=function(){angular.forEach(a.model.selected_groups,function(a){a.checked&&(a.edit=!0)})};a.delGroup=function(){var b=a.model.selected_groups,e;for(e=b.length-1;0<=e;e--)b[e].checked&&b.splice(e,1);d();r();a.modified()};a.poolValidation=function(){var b=!0,d=a.model.l2tp.start_ip,e=
a.model.l2tp.end_ip;a.form.l2tp_start_ip.$setValidity("range",!0);a.form.l2tp_end_ip.$setValidity("range",!0);a.form.l2tp_start_ip.$setValidity("subnet",!0);a.form.l2tp_end_ip.$setValidity("subnet",!0);if(!d||!e)return!0;b=t.compareIpRange(d,e);!1===b?(a.form.l2tp_start_ip.$setValidity("range",!1),a.form.l2tp_end_ip.$setValidity("range",!1)):(b=t.poolValidate("l2tp","l2tp","ipv4",a.subnetObj,d,e),!1===b&&(a.form.l2tp_start_ip.$setValidity("subnet",!1),a.form.l2tp_end_ip.$setValidity("subnet",!1)));
return b};a.change_pwd=function(){a.ui_data.enable_show_key_in_plain=!0;a.ui_data.pwd_changed=!0};a.focus_pwd=function(){a.ui_data.pwd_changed||(a.model.l2tp.psk="")};a.blur_pwd=function(){a.ui_data.pwd_changed||(a.model.l2tp.psk="12345678901234567890")};p()}]);app.controller("pptp_server_main",["$scope","$rootScope","$q","$log","MyHttp","$http","ngGridCellBuilder","$templateCache","Sets","UserSession","userAccessRight","addressPoolValidate",function(a,b,s,n,v,t,m,q,e,w,l,h){a.model=a.model||{};a.model.rule_list=[];a.model.nacm_grid=[];a.model.groups=[];a.model.connections=[];var p=[],u=[],x=[],r=[];a.disable_add_user_group=!1;var d=a.disable_del_user_group=!1;a.success=!1;a.subnetObj={};a.dataReady=!1;a.model.proxy={groups:{group:[]}};a.userAccessFlag=
l.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&w.logout();var c=function(){var b=v.post({url:resource_base+"data/pptp_server.json",method:"get_pptp_server",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),c=v.post({url:resource_base+"data/nacm_group.json",method:"get_groups",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),d=v.post({url:resource_base+"data/aaa.json",method:"get_subnet",error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}});s.all([b,c,d]).then(function(b){angular.extend(a.model,b[0].data.result);var c=b[1];c.data&&(c.data.result&&c.data.result.groups&&c.data.result.groups.group)&&(a.model.proxy.groups=angular.copy(c.data.result.groups));b=b[2];b.data&&(b.data.result&&b.data.result.subnets&&b.data.result.subnets.ipv4&&b.data.result.subnets.ipv6)&&(a.subnetObj=angular.copy(b.data.result.subnets));a.model.pptp||angular.extend(a.model,{pptp:{enable:!1,"start-ip":"","end-ip":"","user-authentication":"Default",
"mppe-encryption":"mppe-none","max-session":10}});k();a.schema=a.schema||{};a.schema.mppeencryptionMap=[{id:"mppe-none",displayName:a.DICT("PPTPServer_None")},{id:"mppe-128",displayName:"128 bits"}];a.model_orig=angular.copy(a.model);a.gridGroup.data=a.model.nacm_grid});a.dataReady=!0};c();var k=function(){a.model.nacm_grid=[];a.model.groups=[];a.model.connections=[];a.model.connections.push({name:"pptp",yes_group:[],no_group:[],grid_table:[]});a.model.proxy&&(a.model.proxy.groups&&a.model.proxy.groups.group)&&
(a.model.rule_list=angular.copy(a.model.proxy.groups.group),angular.forEach(a.model.rule_list,function(b){a.model.groups.push(b.name)}),angular.forEach(a.model.connections,function(b){angular.forEach(a.model.rule_list,function(a){a["feature-rule"]&&angular.forEach(a["feature-rule"],function(c){"pptp"===c.service&&"permit"===c.action&&b.yes_group.push({name:a.name,id:a.name,displayName:a.name})})})}),angular.forEach(a.model.connections,function(b){angular.forEach(a.model.rule_list,function(a){a["feature-rule"]&&
angular.forEach(a["feature-rule"],function(c){"pptp"===c.service&&"deny"===c.action&&b.no_group.push({name:a.name,id:a.name,displayName:a.name})})})}),angular.forEach(a.model.connections,function(a){angular.forEach(a.yes_group,function(b){a.grid_table.push({exp:{list:a.yes_group,select:b.name},edit:!1})})}));a.model.nacm_grid=angular.copy(a.model.connections[0].grid_table);u=angular.copy(a.model.connections[0].yes_group);x=angular.copy(a.model.connections[0].no_group);angular.forEach(a.model.nacm_grid,
function(a,b){a.checked=!1});a.disable_add_user_group=0>=x.length?!0:!1;a.disable_del_user_group=0>=a.model.nacm_grid.length?!0:!1},g=function(){p=angular.copy(x);angular.forEach(a.model.nacm_grid,function(a){if(!0===a.edit)for(var b=0;b<p.length;b++)if(a.exp.select===p[b].name){p.splice(b,1);break}});angular.forEach(a.model.nacm_grid,function(a){!0===a.edit&&(a.exp.list=[{name:a.exp.select,id:a.exp.select,displayName:a.exp.select}].concat(p))})};a.procNgClick=function(b){a.disable_del_user_group=
!0;r=[];angular.forEach(a.model.nacm_grid,function(b,c){b.checked&&(a.disable_del_user_group=!1,r.push(b))})};a.gridGroup=app.uiGrid.generateGridOptions({IDPreifx:"pptp",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.procNgClick,headerChangedCbk:a.procNgClick},{field:"exp",displayName:a.DICT("Teleworker_VPN_Client_G_Name"),minWidth:300,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html",change:g},{field:"empty",isEmpty:!0}]});a.save=function(){(function(){var b,c=[];
c.push({method:"set_pptp_server",params:{pptp:a.model.pptp}});if(d){for(b=0;b<a.model.nacm_grid.length;b++)angular.forEach(a.model.rule_list,function(c){angular.forEach(c["feature-rule"],function(d){c.name===a.model.nacm_grid[b].exp.select&&"pptp"===d.service&&(d.action="permit")})}),a.model.nacm_grid[b].edit=!1;for(b=0;b<p.length;b++)angular.forEach(a.model.rule_list,function(a){angular.forEach(a["feature-rule"],function(c){a.name===p[b].name&&"pptp"===c.service&&(c.action="deny")})});c.push({method:"set_groups",
params:{groups:{group:a.model.rule_list}}});v.post({url:resource_base+"data/pptp_server.json",method:"set_bulk",params:c,success:function(b){a.success=!0;a.config_saved=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});x=angular.copy(p);u=[];angular.forEach(a.model.nacm_grid,function(a){u.push({name:a.exp.select,id:a.exp.select,displayName:a.exp.select,empty:""})});d=!1}else v.post({url:resource_base+"data/pptp_server.json",method:"set_bulk",params:c,success:function(b){a.success=
!0;a.config_saved=!0},error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})();a.resetModified()};a.cancel=function(){c();a.resetModified()};a.addGroup=function(){p=angular.copy(x);d=!0;angular.forEach(a.model.nacm_grid,function(a){if(!0===a.edit)for(var b=0;b<p.length;b++)if(a.exp.select===p[b].name){p.splice(b,1);break}});a.model.nacm_grid.push({exp:{list:p,select:p[0].name},empty:"",edit:!0,checked:!0});g();a.disable_add_user_group=0>=p.length?!0:!1;a.disable_del_user_group=
0>=a.model.nacm_grid.length?!0:!1;a.gridGroup.gridApi.customApi.scrollTo(a.gridGroup.data.length-1,1);a.procNgClick();a.modified()};a.delGroup=function(){var b=r.length,c=!1,e,h;d=!0;for(e=0;e<b;e++)for(h=a.model.nacm_grid.length-1;0<=h;h--)if(r[e].exp.select===a.model.nacm_grid[h].exp.select){a.model.nacm_grid.splice(h,1);break}for(e=0;e<b;e++)for(h=u.length-1;0<=h;h--)if(r[e].exp.select===u[h].name){u.splice(h,1);break}for(e=0;e<b;e++){c=!0;for(h=0;h<x.length;h++)if(r[e].exp.select===x[h].name){c=
!1;break}!0===c&&x.push({name:r[e].exp.select,id:r[e].exp.select,displayName:r[e].exp.select})}g();a.disable_add_user_group=0>=p.length?!0:!1;a.disable_del_user_group=0>=a.model.nacm_grid.length?!0:!1;for(e=b-1;0<=e;e--)r.splice(e,1);a.procNgClick();a.modified()};a.poolValidation=function(){var b=!0;a.form.pptp_start_ip.$setValidity("range",!0);a.form.pptp_end_ip.$setValidity("range",!0);a.form.pptp_start_ip.$setValidity("subnet",!0);a.form.pptp_end_ip.$setValidity("subnet",!0);if(void 0===a.model.pptp["start-ip"]||
void 0===a.model.pptp["end-ip"]||""===a.model.pptp["start-ip"]||""===a.model.pptp["end-ip"])return!0;b=h.compareIpRange(a.model.pptp["start-ip"],a.model.pptp["end-ip"]);!1===b?(a.form.pptp_start_ip.$setValidity("range",!1),a.form.pptp_end_ip.$setValidity("range",!1)):(b=h.poolValidate("pptp","pptp","ipv4",a.subnetObj,a.model.pptp["start-ip"],a.model.pptp["end-ip"]),!1===b&&(a.form.pptp_start_ip.$setValidity("subnet",!1),a.form.pptp_end_ip.$setValidity("subnet",!1)));return b}}]);app.controller("teleworkerVPNCtrl",["$scope","MyHttp","pgWindow","$q","UserSession","userAccessRight","ciscosb",function(a,b,s,n,v,t,m){var q=a.success=!1,e=a.DICT("Teleworker_VPN_Client_Down"),w=a.DICT("Teleworker_VPN_Client_Up"),l=a.DICT("Teleworker_VPN_Client_Connecting"),h=app.TOOLS.getResponse,p=app.TOOLS.getVal;a.jumpToPage=app.TOOLS.jumpToPage;a.ipsecprofile_note=a.DICT("Teleworker_VPN_Client_Ipsec_Profile_Note",{"%s":"<a ng-click=\"jumpToPage('VPN_IPsec_Profiles')\">"+a.DICT("here")+"</a>"});
a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var u=function(){return b.post({url:resource_base+"data/telework_vpn_clients.json",method:"get_teleworker_vpn",error:function(a){console.log("teleworkerVPNCtrl getTeleworkerData error : "+a.status);x()}})},x=function(b){b||(b={});var c=[];b=b["teleworker-vpn-clients"]||{};b["teleworker-vpn-client"]&&(c=b["teleworker-vpn-client"]);a.model.enable=void 0!==b.enable?b.enable:!1;a.model.auto_initiation_retry=void 0!==
b["auto-initiation-retry"]?b["auto-initiation-retry"]:!1;a.model.retry_interval=b["retry-interval"]||120;a.model.retry_limit=void 0===b["retry-limit"]?2:b["retry-limit"];a.model.orig_enable=a.model.enable;a.model.orig_auto=a.model.auto_initiation_retry;a.model.orig_interval=a.model.retry_interval;a.model.orig_limit=a.model.retry_limit;a.model.clients=[];angular.forEach(c,function(b){a.model.clients.push(r(b))});a.gridTeleworkerOptions.data=a.model.clients;a.dataReady=!0},r=function(b){b||(b={});var c=
function(a){a||(a={});var b={type:"ip",ip:"",fqdn:"",user_fqdn:"",der_asn1_dn:""};angular.forEach(a,function(a,c){switch(c){case "ip":b.ip=a;break;case "fqdn":b.fqdn=a;break;case "user-fqdn":b.user_fqdn=a;break;case "der-asn1-dn":b.der_asn1_dn=a;break;default:return}b.type=c});return b},d=void 0;b.certificate?d=b.certificate:angular.forEach(a.model.certs,function(a){"Default"===a.id&&(d=a.id)});void 0===d&&(d=a.model.certs[0]&&a.model.certs[0].id||"");var g={name:b.name||"",checked:!1,server:b.server||
"",startup:void 0!==b["activate-connection-on-startup"]?b["activate-connection-on-startup"]:!1,display_startup:!1,auth_type:void 0!==b.certificate?"cert":"preshare",display_auth_type:void 0!==b.certificate?"Certificate":"Preshared Key",group_name:b["group-name"]||"",password:b.password||"",password_changed:!1,certificate:d,mode:"client",display_mode:"Client",vlan:a.model.vlans[0]&&a.model.vlans[0].id,user_name:b["user-name"]||"",user_password:b["user-password"]||"",user_password_changed:!1,confirm_user_password:b["confirm-user-password"]||
"",confirm_user_password_changed:!1,backup_server_1:b["backup-server-1"]||"",backup_server_2:b["backup-server-2"]||"",backup_server_3:b["backup-server-3"]||"",display_backup_server:[],peer_timeout:b["peer-timeout"]||120,connect_status:"down",status:e};b.password&&(g.password="0000000000000");b["user-password"]&&(g.user_password="0000000000000");b["confirm-user-password"]&&(g.confirm_user_password="0000000000000");g.backup_server_1&&g.display_backup_server.push(g.backup_server_1);g.backup_server_2&&
g.display_backup_server.push(g.backup_server_2);g.backup_server_3&&g.display_backup_server.push(g.backup_server_3);g.display_backup_server.length||g.display_backup_server.push("-");g.startup&&(g.display_startup=!0);angular.forEach(b,function(a,b){"vlan"===b&&(g.vlan=a,g.mode="nem",g.display_mode="NEM")});g.local_identifier=c(b["local-identifier"]);g.remote_identifier=c(b["remote-identifier"]);return g},d=function(){return b.post({url:resource_base+"data/ipsec_client_to_site.json",method:"get_client_to_site",
error:function(a){console.log("clientToSIteCtrl getClientToSiteData error, status: "+a.status);c()}})},c=function(b){b||(b={});b=(b["client-to-sites"]||{})["client-to-site"]||[];a.model.c2s=[];angular.forEach(b,function(b){a.model.c2s.push(b)})},k=function(a){return b.post({url:resource_base+"data/teleworker_vpn_state.json",method:"get_teleworker_vpn_state",procBackground:a&&a.procBackground||void 0,error:function(a){g()}})},g=function(b){b||(b={});b=b["teleworker-vpn-clients-state"]||{};a.model.state=
{name:b.name||"",status:b.status||"",primary_dns:b["primary-dns"]||"",secondary_dns:b["secondary-dns"]||"",primary_wins:b["primary-wins"]||"",secondary_wins:b["secondary-wins"]||"",default_domain:b["default-domain"]||"",backup_server_1:b["backup-server-1"]||"",backup_server_2:b["backup-server-2"]||"",backup_server_3:b["backup-server-3"]||"",split_tunnel:b["split-tunnel"]||"",split_dns:b["split-dns"]||""}},z=function(){return b.post({url:resource_base+"data/cert2.json",method:"get_cert",error:function(a){console.log("teleworkerVPNCtrl getCertificateData error: "+
a.status);y()}})},y=function(b){b||(b={});var c=[],d={},e;b["certs-state"]&&b["certs-state"].cert&&(c=b["certs-state"].cert);a.model.certs=[];angular.forEach(c,function(b){if((e=b.name||"")&&!d[e])a.model.certs.push({id:e,displayName:b.name}),d[e]=!0})},A=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",params:{filter:"VLAN"},success:function(a){a.data&&a.data.result?B(a.data.result):B()},error:function(a){B()}})},B=function(b){b||(b={});var c=[],d;b.interfaces&&
b.interfaces["interface"]&&(c=b.interfaces["interface"]);a.model.vlans=[];angular.forEach(c,function(b){b.name.match(/^VLAN\d*$/)&&(d=b["vlan-interface-settings"]&&b["vlan-interface-settings"]["vlan-id"],void 0!==d&&a.model.vlans.push({id:d,displayName:d}))})},C=function(){return b.post({url:resource_base+"data/ipsec_enable.json",method:"get_ipsec_enable",error:function(a){Log(ERROR,"[TLKVPN][getIPSecEnable] "+JSON.stringify(a));D()}})},D=function(b){b||(b={});b=p((b.ipsec||{}).enable,!0);a.model.ipsec_enable=
b},E={main:"main",edit:"edit"},I=function(b){1===a.sel_c2s_cnt?a.connectedName?angular.forEach(a.model.clients,function(b){b.checked&&(a.selOPAble=b.name===a.connectedName?b.connect_status:"down")}):a.selOPAble="down":a.selOPAble=""},F=function(){a.model.state_step="none";a.sel_c2s_cnt=0;a.del_clients=[];n.all([u(),d()]).then(function(b){x(h(b,0));c(h(b,1));H();a.resetModified()})},H=function(){a.model.state_step="getting";angular.forEach(a.model.clients,function(a){a.status="-"});n.all([k()]).then(function(b){g(h(b,
0));G();a.model.state_step="done"})},G=function(){var b=a.model.state,c=a.model.clients;a.connectedName="";angular.forEach(c,function(c){if(c.name===b.name){switch(b.status){case "UP":c.status=w;c.connect_status="up";break;case "CONNECTING":c.status=l;c.connect_status="connecting";break;default:c.status=e,c.connect_status="down"}a.connectedName=c.name}else c.status=e});I()};s=function(){a.sel_c2s_cnt=0;angular.forEach(a.model.clients,function(b){b.checked&&a.sel_c2s_cnt++});I()};a.currPage=E.main;
a.dataReady=!1;a.currPage="main";a.sel_c2s_cnt=0;a.selOPAble="";a.connectedName="";a.gridTeleworkerOptions=app.uiGrid.generateGridOptions({rowHeight:2*app.uiGrid.rowHeight,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:s,headerChangedCbk:s},{field:"name",displayName:a.DICT("Teleworker_VPN_Client_Nm")},{field:"server",displayName:a.DICT("Teleworker_VPN_Client_Host"),width:180},{field:"display_startup",displayName:a.DICT("Teleworker_VPN_Client_Activate_Startup"),width:250,cellTemplate:"UG_table_checkbox_with_inline_edit.html"},
{field:"display_auth_type",displayName:a.DICT("Teleworker_VPN_Client_Authenication_Method")},{field:"group_name",displayName:a.DICT("Teleworker_VPN_Client_G_Name")},{field:"user_name",displayName:a.DICT("Teleworker_VPN_Client_U_Name")},{field:"display_backup_server",displayName:a.DICT("Teleworker_VPN_Client_Backup_Server"),cellTemplate:"UG_table_text_with_three_rows.html"},{field:"peer_timeout",displayName:a.DICT("Teleworker_VPN_Client_P_Timeout"),width:115},{field:"display_mode",displayName:a.DICT("Teleworker_VPN_Client_Mode_N"),
width:70},{field:"status",displayName:a.DICT("Teleworker_VPN_Client_Status"),fixWidth:!0,minWidth:95}]});a.change_pwd=function(){a.edit.password_changed=!0};a.change_user_pwd=function(){a.edit.user_password_changed=!0;a.edit.confirm_user_password_changed||(a.edit.confirm_user_password="",a.edit.confirm_user_password_changed=!0);a.checkUserPass()};a.change_confirm_user_pwd=function(){a.edit.confirm_user_password_changed=!0;a.edit.user_password_changed||(a.edit.user_password="",a.edit.user_password_changed=
!0);a.checkUserPass()};a.checkUserPass=function(){var b=a.edit;b.user_password_changed&&b.user_password!==b.confirm_user_password?a.teleworkerform.user_confirm.$setValidity("isnothesame",!1):a.teleworkerform.user_confirm.$setValidity("isnothesame",!0)};a.change_name=function(){var b=!1;a.edit.name?(a.edit.name.match(/^\w+$/)?a.teleworkerform.name.$setValidity("special",!0):a.teleworkerform.name.$setValidity("special",!1),angular.forEach(a.model.clients,function(c){c.name===a.edit.name&&(b=!0)}),a.teleworkerform.name.$setValidity("repeat",
!b)):(a.teleworkerform.name.$setValidity("repeat",!0),a.teleworkerform.name.$setValidity("special",!0))};a.del_clients=[];a.model={ipsec_enable:!0,enable:!1,orig_enable:!1,auto_initiation_retry:!1,orig_auto:!1,retry_interval:120,orig_interval:120,retry_limit:2,orig_limit:2,clients:[],certs:[],vlans:[],state:{},state_step:"none"};var J=function(){var b={},c=!1;a.model.orig_enable!==a.model.enable&&(b.enable=a.model.enable,c=!0);a.model.orig_auto!==a.model.auto_initiation_retry&&(b["auto-initiation-retry"]=
a.model.auto_initiation_retry,c=!0);a.model.orig_interval!==a.model.retry_interval&&(b["retry-interval"]=a.model.retry_interval,c=!0);a.model.orig_limit!==a.model.retry_limit&&(b["retry-limit"]=a.model.retry_limit,c=!0);return{has_modify:c,clients:b}},L=function(c){b.post({method:"del_teleworker_vpn",params:{"teleworker-vpn-clients":{"teleworker-vpn-client":a.del_clients}},success:function(b){"function"===$.type(c)&&c();a.success=!0},error:function(a){"function"===$.type(c)&&c()}})};a.funs={main:{autoInitRetry:function(){!1===
a.model.auto_initiation_retry&&(a.model.retry_interval=a.model.orig_interval,a.model.retry_limit=a.model.orig_limit)},save:function(){var c=J(),d=c.clients,c=c.has_modify,e=function(){b.post({method:"set_teleworker_vpn",params:{"teleworker-vpn-clients":d},success:function(b){a.model.enable&&q?N():(a.success=!0,F())},error:function(a){F()}})};a.del_clients.length?c?L(e):L(function(){a.success=!0;F()}):c&&e()},cancel:function(){F()},add:function(){a.edit=r();a.edit.checked=!0;a.orig=void 0;a.currPage=
E.edit;a.modified()},edit:function(){a.edit=void 0;angular.forEach(a.model.clients,function(b){b.checked&&(a.edit=angular.copy(b))});a.edit?(a.orig=angular.copy(a.edit),a.currPage=E.edit):Log(ERROR,"policy edit button error, checked item is not exist")},del:function(){for(var b=a.model.clients.length-1;0<=b;b--)a.model.clients[b].checked&&(a.del_clients.push({name:a.model.clients[b].name}),a.model.clients.splice(b,1))},connect:function(){var c="";angular.forEach(a.model.clients,function(a){a.checked&&
(c=a.name)});b.post({method:"action",forcedUsingPost:!0,params:{input:{name:c},rpc:"teleworker-vpn-client-connect"},success:function(){H()},error:function(){H()}})},disconnect:function(){var c="";angular.forEach(a.model.clients,function(a){a.checked&&(c=a.name)});b.post({method:"action",forcedUsingPost:!0,params:{input:{name:c},rpc:"teleworker-vpn-client-disconnect"},success:function(){H()},error:function(){H()}})}},edit:{save:function(){var c=a.edit,d=J().clients;app.TOOLS.warningAlertBox({msg:"Do you want to make this connection active when the settings are saved?<br/>(Only one connection can be active at a time.)",
btn_yes_str:"Activate Connection",btn_no_str:"Do Not Activate",cbk:function(e){c.startup=e;e={name:c.name,server:c.server,"activate-connection-on-startup":c.startup,"user-name":c.user_name,"backup-server-1":c.backup_server_1,"backup-server-2":c.backup_server_2,"backup-server-3":c.backup_server_3,"peer-timeout":c.peer_timeout};var g=[],h=function(){b.post({method:"set_teleworker_vpn",params:{"teleworker-vpn-clients":d},success:function(b){a.model.enable&&q?N():(a.success=!0,F(),a.currPage=E.main)},
error:function(b){F();a.currPage=E.main}})};c.startup&&angular.forEach(a.model.clients,function(b){a.orig&&b.name===a.orig.name||b.startup&&g.push({name:b.name,"activate-connection-on-startup":!1})});"preshare"===c.auth_type?(e["group-name"]=c.group_name,c.password_changed&&(e.password=c.password)):e.certificate=c.certificate;c.user_password_changed&&(e["user-password"]=c.user_password,e["confirm-user-password"]=c.confirm_user_password);"client"===c.mode?angular.extend(e,m.empty_type("client")):"nem"===
c.mode&&(e.vlan=c.vlan);g.push(e);d["teleworker-vpn-client"]=g;a.del_clients.length?L(h):h()}})},cancel:function(){F();a.currPage=E.main}}};a.changeEnable=function(){for(var b=0;b<a.model.c2s.length;b++)if(!0===a.model.c2s[b].enable){q=!0;break}else q=!1;a.model.enable&&q&&a.model.orig_enable!==a.model.enable&&app.TOOLS.warningAlertBox({msg:"Client-to-Site will be disabled.<br>You cannot enable Client-to-Site and Teleworker VPN Client simultaneously.<br>Click Apply to proceed.",btn_yes_str:"Apply",
btn_no_str:"Cancel"})};var N=function(){angular.forEach(a.model.c2s,function(a){!0===a.enable&&(a.enable=!1)});b.post({method:"set_client_to_site",params:{"client-to-sites":{"client-to-site":a.model.c2s}},success:function(b){a.success=!0;F();a.currPage=E.main},error:function(b){F();a.currPage=E.main}})};(function(){a.model.state_step="none";a.sel_c2s_cnt=0;a.del_clients=[];n.all([z(),A(),u(),d(),C()]).then(function(b){y(h(b,0));B(h(b,1));x(h(b,2));c(h(b,3));D(h(b,4));H();a.resetModified()})})()}]);app.controller("VPNPassthroughCtrl",["$scope","MyHttp","UserSession","userAccessRight",function(a,b,s,n){var v,t,m,q,e,w;a.success=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var l=function(){b.post({url:resource_base+"data/ipsec_passthrough.json",method:"get_ipsec_passthrough",success:function(a){a.data&&a.data.result?h(a.data.result):h()},error:function(a){console.log("VPNPassthroughCtrl getIPSecPassthrough error: "+a.status)}})},h=function(b){b||(b=
{});b=b["ipsec-passthrough"]||{};b=void 0!==b.enable?b.enable:!1;q=a.model.ipsec=b;v=!0;d()},p=function(){b.post({url:resource_base+"data/l2tp_passthrough.json",method:"get_l2tp_passthrough",success:function(a){a.data&&a.data.result?u(a.data.result):u()},error:function(a){console.log("VPNPassthroughCtrl getL2TPPassthrough error: "+a.status)}})},u=function(b){b||(b={});b=b["l2tp-passthrough"]||{};b=void 0!==b.enable?b.enable:!1;e=a.model.l2tp=b;t=!0;d()},x=function(){b.post({url:resource_base+"data/pptp_passthrough.json",
method:"get_pptp_passthrough",success:function(a){a.data&&a.data.result?r(a.data.result):r()},error:function(a){console.log("VPNPassthroughCtrl getPPTPPassthrough error: "+a.status)}})},r=function(b){b||(b={});b=b["pptp-passthrough"]||{};b=void 0!==b.enable?b.enable:!1;w=a.model.pptp=b;m=!0;d()};t=m=v=e=w=q=!1;var d=function(){a.dataReady=v&&t&&m};a.model={ipsec:!1,pptp:!1,l2tp:!1};a.dataReady=!1;a.funs={save:function(){var c=a.model;q!==c.ipsec&&b.post({method:"set_ipsec_passthrough",params:{"ipsec-passthrough":{enable:c.ipsec}},
success:function(b){a.success=!0;l();a.resetModified()},error:function(a){}});e!==c.l2tp&&b.post({method:"set_l2tp_passthrough",params:{"l2tp-passthrough":{enable:c.l2tp}},success:function(b){a.success=!0;p();a.resetModified()},error:function(a){}});w!==c.pptp&&b.post({method:"set_pptp_passthrough",params:{"pptp-passthrough":{enable:c.pptp}},success:function(b){a.success=!0;x();a.resetModified()},error:function(a){}})},cancel:function(){l();p();x();a.resetModified()}};l();p();x()}]);app.controller("siteToSiteCtrl",["$scope","MyHttp","oneTimeLocker","wan_service","$q","$templateCache","UserSession","userAccessRight","passwordComplex","ciscosb","wan_lib","addressPoolValidate",function(a,b,s,n,v,t,m,q,e,w,l,h){a.disable_add_user_group=!1;a.disable_del_user_group=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.isErr=!1;a.repeat_conn="";a.subnetObj={};a.userAccessFlag=q.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&m.logout();var p=app.TOOLS.getResponse,u=app.TOOLS.getVal,x=function(){return b.post({url:resource_base+
"data/ipsec_site_to_site.json",method:"get_site_to_site",error:function(a){Log(ERROR,"siteToSiteCtrl getSiteToSiteData error, status: "+a.status);r()}})},r=function(b){b||(b={});b=b["site-to-sites"]||{};var c=b["site-to-site"]||[];a.model.maxTunnel=b["max-tunnel"]||50;a.model.s2s=[];angular.forEach(c,function(b,c){a.model.s2s.push(d(b))})},d=function(b){b||(b={});var c=b["remote-endpoint"]||{},d=b["split-dns"]||{},e=b.failover||{},g=b.keepalive||{},h=b.dpd||{},k={},l=b["extended-authentication"]||
{},m=a.model.ifs,n,p,q=function(b,c){b&&(b.identifier&&angular.forEach(b.identifier,function(a,b){switch(b){case "ip":c.identifier.type=b;c.identifier.ip=a||"";break;case "interface":c.identifier.type=b;c.identifier["interface"]="";break;case "fqdn":c.identifier.type=b;c.identifier.fqdn=a||"";break;case "user-fqdn":c.identifier.type=b;c.identifier.user_fqdn=a||"";break;case "der-asn1-dn":c.identifier.type=b,c.identifier.asn1dn=a||""}}),b.group&&angular.forEach(b.group,function(b,d){switch(d){case "subnet":"0.0.0.0"===
b.ip&&"0.0.0.0"===b.netmask?c.group.type="any":(c.group.type=d,c.group.subnet_ip=b.ip||"",c.group.subnet_netmask=b.netmask||"");break;case "ip":c.group.type=d;c.group.ip=b.ip||"";break;case "ip-range":c.group.type=d;c.group.begin_ip=b["begin-ip"]||"";c.group.end_ip=b["end-ip"]||"";break;case "ip-group":c.group.type=d;c.group.ip_group=b&&b[0]||a.model.default_ip_group;break;case "tunnel":c.group.type="gre",c.group.gre_interface=b||a.model.default_gre}}))},r=function(b,c,d,e){var g="ike",h=a.model.default_cert,
k=a.model.default_ca_cert;b||(b={});e&&(h=k);d?(b["local-certificate"]&&b["local-certificate"].certificate&&(h=b["local-certificate"].certificate,g="cert"),b["remote-certificate"]&&b["remote-certificate"].certificate&&(k=b["remote-certificate"].certificate||"",g="cert"),c.remote_certificate=k):b.certificate&&(g="cert",h=b.certificate);c.method=g;c.certificate=h;c.password=u(b.password,"");c.strength_meter=u(b["strength-meter"],0);c.minimum_complexity=u(b["minimum-complexity"],!0);c.orig_password=
c.password};n=void 0;n=b["ipsec-profile"]?b["ipsec-profile"]:a.model.default_profile;p=a.model.profilesMap[n]||{};k={connection_name:u(b["connection-name"],""),editType:"",isGre:!1,type:"s2s",enable:u(b.enable,!0),"interface":u(b["interface"],m[0]&&m[0].name||""),ipsec_profile:n,ike_mode:p.ike_mode||"v2",non_rfc_compliant:u(b["non-rfc-compliant"],!1),remote_endpoint:{type:"static-ip",ip:"",fqdn:""},local_authentication:{method:"ike",show_key_in_plain:!1,enable_show_key_in_plain:!1,orig_password:"",
password:"",strength_meter:0,minimum_complexity:!0,certificate:void 0},remote_authentication:{method:"ike",show_key_in_plain:!1,enable_show_key_in_plain:!1,orig_password:"",password:"",strength_meter:0,minimum_complexity:!0,certificate:void 0},symm_authentication:{method:"ike",show_key_in_plain:!1,enable_show_key_in_plain:!1,orig_password:"",password:"",strength_meter:0,minimum_complexity:!0,certificate:void 0,remote_certificate:""},local_group:{identifier:{type:"interface",ip:"","interface":"",fqdn:"",
user_fqdn:"",asn1dn:""},group:{type:"subnet",subnet_ip:"",subnet_netmask:"",ip:"",begin_ip:"",end_ip:"",ip_group:a.model.default_ip_group,gre_interface:a.model.default_gre,gre_ip:""}},remote_group:{identifier:{type:"ip",ip:"",fqdn:"",user_fqdn:"",asn1dn:""},group:{type:"subnet",subnet_ip:"",subnet_netmask:"",ip:"",begin_ip:"",end_ip:"",ip_group:a.model.default_ip_group,gre_interface:a.model.default_gre,gre_ip:""}},aggressive_mode:u(b["aggressive-mode"],!1),compress:u(b.compress,!1),netbios_broadcast:u(b["netbios-broadcast"],
!1),multicast_passthrough:u(b["multicast-passthrough"],!1),nat_traversal:u(b["nat-traversal"],!1),keepalive:{enable:u(g.enable,!1),monitoring_interval:u(g["monitoring-interval"],10)},dpd:{enabled:u(h.enabled,!1),delay_time:u(h["delay-time"],10),detection_timeout:u(h["detection-timeout"],30),action:u(h.action,a.model.schema.dpdAction[0]&&a.model.schema.dpdAction[0].id||"")},extended_authentication:{enable:!1,type:"group",group:"",user_name:"",password:""},split_dns:{enable:u(d.enable,!1),primary_dns:u(d["primary-dns"],
""),secondary_dns:u(d["secondary-dns"],""),fqdn:[]},failover:{enable:u(e.enable,!1),remote_backup_ip:u(e["remote-backup-ip"],""),"interface":u(e["interface"],m[0]&&m[0].name||"")},selected_groups:{},grid_group_data:[],grid_group_checked:[]};a.model.auth_groups[0]&&(k.extended_authentication.group=void 0!==a.model.auth_groups[0].id?a.model.auth_groups[0].id:"");b["remote-endpoint"]&&(k.remote_endpoint.type="dynamic-ip",angular.forEach(c,function(a,b){switch(b){case "static-ip":k.remote_endpoint.type=
b;k.remote_endpoint.ip=a;break;case "fqdn":k.remote_endpoint.type=b,k.remote_endpoint.fqdn=a}}));q(b["local-group"],k.local_group);q(b["remote-group"],k.remote_group);r(b["symm-authentication"],k.symm_authentication,!0);r(b["local-authentication"],k.local_authentication);r(b["remote-authentication"],k.remote_authentication,!1,!0);"gre"===k.local_group.group.type&&(k.isGre=!0);"der-asn1-dn"===k.local_group.identifier.type&&"ASN1DN"===k.local_group.identifier.asn1dn&&(k.local_group.identifier.asn1dn=
"");"der-asn1-dn"===k.remote_group.identifier.type&&"%any"===k.remote_group.identifier.asn1dn&&(k.remote_group.identifier.asn1dn="");angular.forEach(l,function(a,b){switch(b){case "enable":k.extended_authentication.enable=void 0!==a?a:!1;break;case "group":k.extended_authentication.type=b;k.extended_authentication.group=a;break;case "user-name":k.extended_authentication.type="user";k.extended_authentication.user_name=a||"";break;case "password":k.extended_authentication.password=a||""}});for(d.fqdn&&
angular.forEach(d.fqdn,function(a,b){k.split_dns.fqdn.push({domain_name:a["domain-name"]})});6>k.split_dns.fqdn.length;)k.split_dns.fqdn.push({domain_name:""});return k},c=function(a){var b=function(b,c){switch(b.identifier.type){case "ip":c.identifier={ip:b.identifier.ip};break;case "interface":c.identifier={"interface":a["interface"]};break;case "fqdn":c.identifier={fqdn:b.identifier.fqdn};break;case "user-fqdn":c.identifier={"user-fqdn":b.identifier.user_fqdn};break;case "der-asn1-dn":c.identifier=
{"der-asn1-dn":b.identifier.asn1dn}}switch(b.group.type){case "subnet":c.group={subnet:{ip:b.group.subnet_ip,netmask:b.group.subnet_netmask}};break;case "ip":c.group={ip:{ip:b.group.ip}};break;case "ip-range":c.group={"ip-range":{"begin-ip":b.group.begin_ip,"end-ip":b.group.end_ip}};break;case "any":c.group={subnet:{ip:"0.0.0.0",netmask:"0.0.0.0"}};break;case "gre":c.group={tunnel:b.group.gre_interface};break;case "ip-group":c.group={"ip-group":[b.group.ip_group]}}},c=a&&a.split_dns||{},d={"connection-name":a.connection_name,
enable:a.enable,"interface":a["interface"],"ipsec-profile":a.ipsec_profile,"non-rfc-compliant":a.non_rfc_compliant,"remote-endpoint":{},"local-group":{},"remote-group":{},"aggressive-mode":a.aggressive_mode,compress:a.compress,"netbios-broadcast":a.netbios_broadcast,keepalive:{enable:a.keepalive.enable||!1,"monitoring-interval":a.keepalive.monitoring_interval||10},dpd:{enabled:a.dpd.enabled||!1,"delay-time":a.dpd.delay_time||10,"detection-timeout":a.dpd.detection_timeout||10,action:a.dpd.action||
"close"},"extended-authentication":{enable:a.extended_authentication.enable||!1},"split-dns":{enable:c.enable||!1,"primary-dns":c.primary_dns||"","secondary-dns":c.secondary_dns||"",fqdn:[]},failover:{enable:a.failover.enable||!1,"remote-backup-ip":a.failover.remote_backup_ip||"","interface":a.failover["interface"]||""}};!c.primary_dns&&c.secondary_dns&&(d["split-dns"]["primary-dns"]=c.secondary_dns,d["split-dns"]["secondary-dns"]="");"manual"===a.ike_mode||"v1"===a.ike_mode?(d["non-rfc-compliant"]=
!1,"ike"===a.symm_authentication.method?(d["symm-authentication"]={"minimum-complexity":a.symm_authentication.minimum_complexity},a.symm_authentication.orig_password!==a.symm_authentication.password&&angular.extend(d["symm-authentication"],{password:a.symm_authentication.password,"strength-meter":e.getStrength(a.symm_authentication.password)})):d["symm-authentication"]={"local-certificate":{certificate:a.symm_authentication.certificate},"remote-certificate":{certificate:a.symm_authentication.remote_certificate}}):
("ike"===a.local_authentication.method?(d["local-authentication"]={"minimum-complexity":a.local_authentication.minimum_complexity},a.local_authentication.orig_password!==a.local_authentication.password&&angular.extend(d["local-authentication"],{password:a.local_authentication.password,"strength-meter":e.getStrength(a.local_authentication.password)})):d["local-authentication"]={certificate:a.local_authentication.certificate},"ike"===a.remote_authentication.method?(d["remote-authentication"]={"minimum-complexity":a.remote_authentication.minimum_complexity},
a.remote_authentication.orig_password!==a.remote_authentication.password&&angular.extend(d["remote-authentication"],{password:a.remote_authentication.password,"strength-meter":e.getStrength(a.remote_authentication.password)})):d["remote-authentication"]={certificate:a.remote_authentication.certificate});if(a.remote_endpoint)switch(a.remote_endpoint.type){case "static-ip":d["remote-endpoint"]={"static-ip":a.remote_endpoint.ip};break;case "fqdn":d["remote-endpoint"]={fqdn:a.remote_endpoint.fqdn};break;
case "dynamic-ip":d["remote-endpoint"]={"dynamic-ip":null}}a.local_group.identifier.asn1dn="ASN1DN";b(a.local_group,d["local-group"]);b(a.remote_group,d["remote-group"]);"der-asn1-dn"===a.remote_group.identifier.type&&""===a.remote_group.identifier.asn1dn&&(d["remote-group"].identifier["der-asn1-dn"]="%any");if(a.extended_authentication)switch(a.extended_authentication.type){case "group":angular.extend(d["extended-authentication"],w.empty_type("group"));break;case "user":d["extended-authentication"]["user-name"]=
a.extended_authentication.user_name,a.origUserPassword!==a.extended_authentication.password&&(d["extended-authentication"].password=a.extended_authentication.password)}a.split_dns&&angular.forEach(a.split_dns.fqdn,function(a,b){a.domain_name&&d["split-dns"].fqdn.push({"domain-name":a.domain_name})});return d},k=function(){return b.post({url:resource_base+"data/gre_tunnel.json",method:"get_gre",error:function(a){g()}})},g=function(b){b||(b={});var c=[],d;b.interfaces&&b.interfaces["interface"]&&(c=
b.interfaces["interface"]||[]);a.model.greInterfaces=[];angular.forEach(c,function(b){b.name.match(/^GRE\d+$/)&&(d={id:b.name,displayName:b.name,src_ip:"",dest_ip:""},b.ipv4&&b.ipv4.address&&(d.src_ip=b.ipv4.address[0]&&b.ipv4.address[0].ip||""),b["tunnel-configuration"]&&b["tunnel-configuration"]["tunnel-destination"]&&(d.dest_ip=b["tunnel-configuration"]["tunnel-destination"]["ipv4-address"]||""),a.model.greInterfaces.push(d))});a.model.default_gre=a.model.greInterfaces[0]&&a.model.greInterfaces[0].id||
""},z=function(){return b.post({url:resource_base+"data/ipsec_enable.json",method:"get_ipsec_enable",error:function(a){Log(ERROR,"[S2S][getIPSecEnable] "+JSON.stringify(a));y()}})},y=function(b){b||(b={});b=u((b.ipsec||{}).enable,!0);a.model.ipsec_enable=b},A=function(){return b.post({url:resource_base+"data/ipsec_profiles.json",method:"get_ipsec_profile",error:function(a){Log(ERROR,"siteToSiteCtrl getProfile error, status: "+a.status)}})},B=function(b){b||(b={});b=(b["ipsec-profiles"]||{})["ipsec-profile"]||
[];var c,d,e,g,h;a.model.profiles=[];a.model.profilesMap={};a.model.default_profile="";angular.forEach(b,function(b,k){c=b["keying-mode"]||{};if(g=b["profile-name"]||"")d="auto",e="",h={},b["keying-mode"]&&(c["phase1-options"]?(d="auto",angular.forEach(c["ike-version"],function(a,b){switch(b){case "v1":e="v1";break;default:e="v2"}})):e=d="manual"),h={name:g,mode:d,ike_mode:e},a.model.profiles.push(h),a.model.profilesMap[g]=h,"Default"===g&&(a.model.default_profile=g)});a.model.default_profile||(a.model.default_profile=
a.model.profiles[0]&&a.model.profiles[0].name||"")},C=function(){return b.post({url:resource_base+"data/ip_group.json",method:"get_ipgroup",error:function(a){Log(ERROR,"siteToSiteCtrl getIPGroup error, status: "+a.status)}})},D=function(b){b||(b={});var c=[];b["ip-groups"]&&b["ip-groups"]["ip-group"]&&(c=b["ip-groups"]["ip-group"]);a.model.ipGroups=[];angular.forEach(c,function(b){a.model.ipGroups.push(E(b))});a.model.default_ip_group=a.model.ipGroups[0]&&a.model.ipGroups[0].id||""},E=function(a){var b=
{name:a.name,id:a.name,displayName:a.name,list:[]};angular.forEach(a.ips||[],function(a){angular.forEach(a.ipv4,function(a,c){switch(c){case "single":b.list.push(a);break;case "subnet":b.list.push(a.ip+"/"+app.TOOLS.netmask.inet2Int(a.netmask));break;case "range":b.list.push(a.start+" - "+a.end)}});angular.forEach(a.ipv6,function(a,c){switch(c){case "single":b.list.push(a);break;case "subnet":b.list.push(a.ip+"/"+a["prefix-length"]);break;case "range":b.list.push(a.start+" - "+a.end)}})});return b},
I=function(b){b||(b={});b=(b["certs-state"]||{}).cert||[];var c={},d;a.model.certs=[];a.model.default_cert="";angular.forEach(b,function(b,e){if((d=b.name||"")&&!c[d]&&!("imported"!==b.source&&"generated"!==b.source))a.model.certs.push({name:d,index:b.index||"",subject:app.TOOLS.cert2subject(b)}),c[d]=!0,"Default"===d&&(a.model.default_cert=d)});a.model.default_cert||(a.model.default_cert=a.model.certs[0]&&a.model.certs[0].name||"")},F=function(){return b.post({url:resource_base+"data/wan_setting1.json",
method:"get_interface",error:function(a){Log(ERROR,"siteToSiteCtrl getInterface error, status: "+a.status)}})},H=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];var c=[],d=[];a.model.ifs=[];b=n.filter(b,{physical:!0,usb:!0,subinterface:!0});angular.forEach(b,function(a){-1!==a.name.indexOf("WAN")&&c.push({name:a.name,ip:"0.0.0.0",netmask:"255.255.255.0"});-1!==a.name.indexOf("USB")&&d.push({name:a.name,ip:"0.0.0.0",netmask:"255.255.255.0"})});a.model.ifs=a.model.ifs.concat(c);a.model.ifs=
a.model.ifs.concat(d)},G=function(a){return b.post({url:resource_base+"data/wan_setting_state.json",method:"get_interface_state",error:function(a){Log(ERROR,"siteToSiteCtrl getInterfaceState error, status: "+a.status)}})},J=function(b){b||(b={});var c=(b["interfaces-state"]||{})["interface"]||[],d={},e,g,h;angular.forEach(a.model.ifs,function(a,b){a.ip="0.0.0.0";a.netmask="255.255.255.0";angular.forEach(c,function(b,c){e=b.name;g=e.match(l.regexpStr.logicalIntf);h=!1;g&&(e=g[1]+g[3],h=!0);a.name===
e&&!d[e]&&(h&&(d[e]=!0),a.ip=b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].ip||"0.0.0.0",b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].netmask?a.netmask=b.ipv4.address[0].netmask:b.ipv4&&(b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0]["prefix-length"])&&(a.netmask=app.TOOLS.netmask.int2Inet(b.ipv4.address[0]["prefix-length"])))})})},L=function(){return b.post({url:resource_base+"data/ipsec_site_to_site_state.json",method:"get_site_to_site_state",error:function(a){Log(ERROR,
"siteToSiteCtrl getSiteToSiteState error, status: "+a.status)}})},N=function(b){b||(b={});b=((b["site-to-site-state"]||{}).connections||{}).connection||[];a.model.connectedTunnel=0;a.model.configTunnel=0;a.model.s2s_state=[];angular.forEach(b,function(b,c){switch(b.status){case "UP":a.model.configTunnel+=1;a.model.connectedTunnel+=1;break;default:a.model.configTunnel+=1}a.model.s2s_state.push({name:u(b.name,""),status:u(b.status,""),number:u(b.number,""),enable:u(b.enable,!1),auth:u(b.auth,""),local_group:u(b["local-group"],
""),remote_group:u(b["remote-group"],""),remote_gateway:u(b["remote-gateway"],""),ipsec_profile:u(b["ipsec-profile"],""),wan_interface:u(b["wan-interface"],""),ike_sa_time:u(b["ike-sa-time"],""),ipsec_sa_time:u(b["ipsec-sa-time"],""),tx_bytes:u(b["tx-bytes"],""),rx_bytes:u(b["rx-bytes"],""),tx_bytes:u(b["tx-packets"],""),rx_bytes:u(b["rx-packets"],"")})});T()},M=function(){return b.post({url:resource_base+"data/get_subnet.json",method:"get_subnet",error:function(a){Log(ERROR,"[S2S][getSubnetData] "+
JSON.stringify(a))}})},P=function(b){b.subnets&&b.subnets.ipv4&&(a.subnetObj=angular.copy(b.subnets))},U=function(){return b.post({url:resource_base+"data/nacm_group.json",method:"get_groups",error:function(a){Q()}})},Q=function(b){b||(b={});b=b.groups&&b.groups.group||[];var c;a.model.auth_groups=[];a.model.vpn2gruop={};a.model.orig_groups=angular.copy(b);angular.forEach(b,function(b){a.model.auth_groups.push(b.name);c={};angular.forEach(b["feature-rule"],function(a){"s2s-vpn"===a.service&&(c=a)});
angular.forEach(c.option,function(c){a.model.vpn2gruop[c]||(a.model.vpn2gruop[c]={});a.model.vpn2gruop[c][b.name]=!0})})},V=function(){angular.forEach(a.model.s2s,function(b){a.model.vpn2gruop[b.connection_name]&&(b.selected_groups=angular.copy(a.model.vpn2gruop[b.connection_name]))})},R=function(){var b=function(b){var c={};angular.forEach(a.model.greInterfaces,function(a){a.id===b&&(c=a)});return c},c,d=a.edit;angular.forEach(a.model.s2s,function(a){"gre"===a.remote_group.group.type&&(c=b(a.remote_group.group.gre_interface),
a.local_group.group.gre_ip=c.src_ip,a.remote_group.group.gre_ip=c.dest_ip)});d&&"gre"===d.local_group.group.type&&(c=b(d.remote_group.group.gre_interface),c.src_ip&&(d.local_group.group.gre_ip=c.src_ip,d.remote_endpoint.type="static-ip",d.remote_endpoint.ip=c.dest_ip),c.dest_ip&&(d.remote_group.group.gre_ip=c.dest_ip))},K=function(){var b=a.edit;if(b){var c=[],d;angular.forEach(a.model.auth_groups,function(a){b.selected_groups[a]||c.push({id:a,displayName:a})});b.grid_group_data=[];angular.forEach(b.selected_groups,
function(a,e){d=[{id:e,displayName:e}];d=d.concat(c);b.grid_group_data.push({checked:!1,edit:!1,group:{select:e,list:d}})});a.disable_add_user_group=c.length?!1:!0;a.gridS2SGroup.data=b.grid_group_data}},S=function(){var b=a.edit;if(b){var c=[],d;b.selected_groups={};angular.forEach(b.grid_group_data,function(a){b.selected_groups[a.group.select]=!0});angular.forEach(a.model.auth_groups,function(a){b.selected_groups[a]||c.push({id:a,displayName:a})});angular.forEach(b.grid_group_data,function(a){d=
[{id:a.group.select,displayName:a.group.select}];d=d.concat(c);a.group.list=d});a.disable_add_user_group=c.length?!1:!0}},T=function(){var b=function(b){var c,d=void 0;angular.forEach(a.model.ipGroups,function(a){a.id===b&&(c=a)});c&&(d="<div>",angular.forEach(c.list,function(a){d=d+"<div>"+a+"</div>"}),d+="</div>");return d},c,d;a.model.s2s_table=[];angular.forEach(a.model.s2s,function(e,g){c={checked:!1,idx:g,type:"s2s",action:[],name:e.connection_name,remote_gateway:"-",wan_interface:"-",ipsec_profile:"-",
status:"DOWN",local_group:{group:"-",tip:void 0},remote_group:{group:"-",tip:void 0}};angular.forEach(a.model.s2s_state,function(a,b){a.name===e.connection_name&&(angular.extend(c,{name:a.name,remote_gateway:a.remote_gateway||"-",wan_interface:a.wan_interface||"-",ipsec_profile:a.ipsec_profile||"-",status:a.status||"DOWN"}),c.local_group.group=a.local_group||"-",c.remote_group.group=a.remote_group||"-")});switch(e.local_group.group.type){case "any":c.local_group.group="0.0.0.0/0";break;case "ip-group":c.local_group.tip=
b(c.local_group.group)}switch(e.remote_group.group.type){case "any":c.remote_group.group="0.0.0.0/0";break;case "ip-group":c.remote_group.tip=b(c.remote_group.group)}c.action=[];d=a.model.profilesMap[e.ipsec_profile]||{};"UP"===c.status?c.action.push({cbk:a.funs.disconnect,className:"icon-disconnect",displayName:a.DICT("Site_to_Site_Disconnect"),disabled:"manual"===d.mode||!e.enable}):c.action.push({cbk:a.funs.connect,className:"icon-connect",displayName:a.DICT("Site_to_Site_Connect"),disabled:"manual"===
d.mode||!e.enable});a.model.s2s_table.push(c)});a.gridSite2SiteOptions.data=a.model.s2s_table;setTimeout(function(){a.gridSite2SiteOptions&&(a.gridSite2SiteOptions.gridApi&&a.gridSite2SiteOptions.gridApi.customApi&&a.gridSite2SiteOptions.gridApi.customApi.checkSelectStatus)&&a.gridSite2SiteOptions.gridApi.customApi.checkSelectStatus()},50)},O=function(){b.post({method:"get_all_cert",procBackground:!0,url:resource_base+"data/get_all_cert.json",success:function(b){b=b&&b.data&&b.data.result||{};I(b);
W(b);a.certReady=!0;Y()},error:function(b){Log(ERROR,"[S2S] get_all_cert error "+JSON.stringify(b));I();W();a.certReady=!0;Y()}})},W=function(b){b||(b={});var c=[],d,e={};b["certs-state"]&&b["certs-state"].cert&&(c=b["certs-state"].cert);a.model.ca_certs=[];angular.forEach(c,function(b){b.info&&b.info["is-ca-enabled"]&&(d={name:b.name||"",displayName:b.name||""},d.name&&!e[d.name]&&(e[d.name]=!0,a.model.ca_certs.push(d)))});a.model.default_ca_cert=a.model.ca_certs[0]&&a.model.ca_certs[0].name||""},
Y=function(){if(a.edit&&a.certReady){var b=a.edit;b.local_authentication.certificate||(b.local_authentication.certificate=a.model.default_cert);b.remote_authentication.certificate||(b.remote_authentication.certificate=a.model.default_ca_cert);b.symm_authentication.certificate||(b.symm_authentication.certificate=a.model.default_cert);b.symm_authentication.remote_certificate||(b.symm_authentication.remote_certificate=a.model.default_ca_cert);a.checkASN1DNCert();a.waitForCert=!1}},X=function(){v.all([U(),
G(),L(),x(),k(),M()]).then(function(b){Q(b[0].data&&b[0].data.result||{});J(b[1].data&&b[1].data.result||{});N(b[2].data&&b[2].data.result||{});r(b[3].data&&b[3].data.result||{});g(b[4].data&&b[4].data.result||{});P(b[5].data&&b[5].data.result||{});V();R();T();a.model.dels=[];a.edit=void 0})},da=function(a){a||(a={});return{ip:a.ip||"",netmask:a.netmask||"",select:!0,edit:!1}},aa=function(){a.model.selects=[];angular.forEach(a.model.s2s_table,function(b,c){b.checked&&a.model.selects.push(b)})},ba=
{main:"ipsec_s2s_main.html",edit:"ipsec_s2s_edit.html",gre_edit:"ipsec_s2s_edit_gre.html"},ea=[{heading:a.DICT("Site_to_Site_Header_Basic"),templateUrl:"ipsec_s2s_edit_basic_setting.html",disabled:!1},{heading:a.DICT("Site_to_Site_Header_Advanced"),templateUrl:"ipsec_s2s_edit_advanced_setting.html",disabled:!0},{heading:a.DICT("Site_to_Site_Header_Failover"),templateUrl:"ipsec_s2s_edit_failover.html",disabled:!1}],ca=function(){angular.forEach(a.model.ifs,function(b,c){b.name===a.edit["interface"]&&
(a.edit.local_group.identifier["interface"]=b.ip)})},Z=function(){angular.forEach(a.model.ifs,function(b,c){b.name===a.edit.tunnel_source&&(a.edit.local_group.identifier["interface"]=b.ip)})};a.checkEditLocalIntfState=function(){v.all([G()]).then(function(a){a[0].data&&a[0].data.result?J(a[0].data.result):J();ca()})};a.checkEditLocalState=function(){v.all([G()]).then(function(a){a[0].data&&a[0].data.result?J(a[0].data.result):J();Z()})};a.tip={failover_waring:""};a.ipsecprofile_note=a.DICT("Site_to_Site_Ipsec_Profile_Note",
{"%s":"<a ng-click=\"jumpToPage('VPN_IPsec_Profiles')\">"+a.DICT("here")+"</a>"});a.success=!1;a.errForGroups=!1;a.model={ipsec_enable:!0,maxTunnel:0,connectedTunnel:0,configTunnel:0,selects:[],s2s_state:[],s2s_table:[],schema:{},profiles:[],profilesMap:{},profileInfo:"",certs:[],ca_certs:[],dels:[],ifs:[],s2s:[],greFullConfigName:"",default_profile:"",default_ip_group:"",default_cert:"",default_ca_cert:"",default_gre:"",auth_groups:[],vpn2gruop:{},orig_groups:[],ipGroups:[],greInterfaces:[],rule_list:[],
groups:[],connections:[],disable_failover:!1,show_local_ipgroup_note:!1,show_remote_ipgroup_note:!1,local_is_ipgroup:!1,remote_is_ipgroup:!1,tabUrl:"ipsec_s2s_edit_basic_setting.html"};a.tabs=[];a.edit=void 0;a.orig={};a.edit_static_routing=[];a.currPage=ba.main;a.dataReady=!1;a.certReady=!1;a.waitForCert=!1;a.gridSite2SiteOptions=app.uiGrid.generateGridOptions({IDPreifx:"s2s",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:aa,headerChangedCbk:aa},{field:"name",displayName:a.DICT("Site_to_Site_Connect_Name")},
{field:"remote_gateway",displayName:a.DICT("Site_to_Site_Remote_Endp")},{field:"wan_interface",displayName:a.DICT("Site_to_Site_Intf")},{field:"ipsec_profile",displayName:a.DICT("Site_to_Site_IPsec_Prof")},{field:"local_group",width:170,displayName:a.DICT("Site_to_Site_Local_Traffic_Selection"),cellTemplate:"s2s_group.html"},{field:"remote_group",width:185,displayName:a.DICT("Site_to_Site_Remote_Traffic_Selection"),cellTemplate:"s2s_group.html"},{field:"status",width:100,displayName:a.DICT("Site_to_Site_Status")},
{field:"action",minWidth:265,displayName:a.DICT("Site_to_Site_Actions"),cellTemplate:"UG_table_icons.html"}]});a.staticRoutingSelect=[];a.procStaticRoutingClick=function(){a.staticRoutingSelect=[];angular.forEach(a.edit.static_routing.networks,function(b,c){b.select?a.staticRoutingSelect.push(c):b.edit=!1})};a.gridInvalidCbk=function(a){a.row.entity.disableChk=a.rowInvalid};a.gridStaticRoutingOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"select",isCheckbox:!0,changedCbk:a.procStaticRoutingClick,
headerChangedCbk:a.procStaticRoutingClick,disableChkBoxField:"disableChk"},{field:"ip",displayName:a.DICT("Site_to_Site_IP_Addr"),editRow:"edit",required:!0,id:"grestaticroutingip",validationCbk:"gridInvalidCbk",cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ng-ipv4-ip=\"grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split'\" check-ipv4-bymask=\"(grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split') ? row['entity']['netmask'] : undefined\"  \"").replace(/ng-required/,
"ng-required=\"grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split'\" ")},{field:"netmask",displayName:a.DICT("Site_to_Site_Netmask"),editRow:"edit",required:!0,id:"grestaticroutingnetmask",validationCbk:"gridInvalidCbk",cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ng-ipv4-netmask=\"grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split'\" check-mask-byipv4=\"(grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split') ? row['entity']['ip'] : undefined\"  \"").replace(/ng-required/,
"ng-required=\"grid.appScope.edit.static_routing.enable && grid.appScope.edit.static_routing.type==='tunnel_split'\" ")}]});var ga=function(){return 50<=a.model.s2s_table.length?(a.msg="Only allow maximum of 50 entries for Site to Site. (Current Entry Number: "+a.model.s2s_table.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.procNgClick=function(b){var c=a.edit;c&&(c.grid_group_checked=[],angular.forEach(c.grid_group_data,function(a){a.checked?c.grid_group_checked.push(a):
a.edit=!1}),a.disable_del_user_group=c.grid_group_checked.length?!1:!0)};a.gridS2SGroup=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.procNgClick,headerChangedCbk:a.procNgClick},{field:"group",displayName:a.DICT("Site_to_Site_Group_Name"),minWidth:300,editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html",change:S},{field:"empty",isEmpty:!0}]});var fa=function(){var b=a.edit,c;b&&(c="create"===b.editType,b.symm_authentication.enable_show_key_in_plain=
"ike"!==b.symm_authentication.method||c,b.local_authentication.enable_show_key_in_plain="ike"!==b.local_authentication.method||c,b.remote_authentication.enable_show_key_in_plain="ike"!==b.remote_authentication.method||c)};a.funs={edit:function(){var b,c;a.orig={};angular.forEach(a.model.s2s_table,function(a,c){a.checked&&(b=a.name)});angular.forEach(a.model.s2s,function(a){a.connection_name===b&&(c=a)});void 0===c?Log(ERROR,"[S2S][edit] Error no search s2s rule"):(a.tabs=angular.copy(ea),a.model.tabUrl=
"ipsec_s2s_edit_basic_setting.html",a.edit={},a.edit=angular.copy(c),a.orig=angular.copy(c),a.change_identifier_list(),a.change_ipsec_profile(),a.change_ip_type(),a.edit.editType="edit",fa(),a.edit.origUserPassword=a.edit.extended_authentication.password,K(),ca(),a.check_groups(),a.currPage=ba.edit)},del:function(){var b,c;angular.forEach(a.model.s2s_table,function(d){if(d.checked){c=a.model.s2s;for(b=c.length-1;0<=b;b--)c[b].connection_name===d.name&&(a.model.dels.push(c[b]),c.splice(b,1))}});T();
aa();a.modified()},connect:function(a,c){b.post({method:"action",params:{input:{"connection-name":c.entity.name},rpc:"s2s-connect"},success:function(a){X()},error:function(a){Log(ERROR,"siteToSiteCtrl connect RPC error : "+a.state);X()}})},disconnect:function(a,c){b.post({method:"action",params:{input:{"connection-name":c.entity.name},rpc:"s2s-disconnect"},success:function(a){X()},error:function(a){Log(ERROR,"siteToSiteCtrl disconnect RPC error : "+a.state);X()}})},createS2S:function(){ga()||(a.disable_del_user_group=
!0,a.edit={},a.edit=d(),a.edit.editType="create",a.change_identifier_list(),a.change_ipsec_profile(),a.change_ip_type(),a.check_groups(),ca(),K(),fa(),a.tabs=angular.copy(ea),a.model.tabUrl="ipsec_s2s_edit_basic_setting.html",a.currPage=ba.edit,a.modified())},save:function(d){var e=[];d=function(b){var c={},d=[],g="",d=!1;if(a.edit)"edit"===a.edit.editType?(g=a.edit.connection_name,b||(d=!0)):d=!0;else if(!b)return;angular.forEach(a.model.auth_groups,function(a){c[a]=[]});angular.forEach(a.model.s2s,
function(a){g!==a.connection_name&&angular.forEach(a.selected_groups,function(b,d){c[d].push(a.connection_name)})});d&&angular.forEach(a.edit.selected_groups,function(b,d){c[d].push(a.edit.connection_name)});d=angular.copy(a.model.orig_groups);angular.forEach(d,function(a){c[a.name]?angular.forEach(a["feature-rule"],function(b){"s2s-vpn"===b.service&&(b.option=c[a.name])}):Log(ERROR,"[S2S][genGroupSet] got error for groups, group name "+a.name+" is not exist")});e.push({method:"set_groups",params:{groups:{group:d}}})};
d(!0);(function(){var b=[];a.model.dels.length&&(angular.forEach(a.model.dels,function(a){"s2s"===a.type&&b.push({"connection-name":a.connection_name})}),b.length&&e.push({method:"del_site_to_site",params:{"site-to-sites":{"site-to-site":b}}}))})();a.edit&&e.push({method:"set_site_to_site",params:{"site-to-sites":{"site-to-site":[c(a.edit)]}}});d(!1);b.post({method:"set_bulk",forcedUsingPost:!0,params:e,success:function(){a.success=!0;a.currPage=ba.main;X()},error:function(){a.success=!0;a.currPage=
ba.main;X()}});a.resetModified()},cancel:function(b){"edit"===b&&(a.currPage=ba.main);X();a.resetModified()},action:function(a){return function(a){}},getActionName:function(a){var b="Connect";switch(a){case "Connected":b="Disconnect"}return b},getActionEnabled:function(a){var b=!1;switch(a){case "Disable":b=!0}return b},clickTab:function(b){var c=a.model.profilesMap[a.edit.ipsec_profile]||{},d=a.edit;a.tip.failover_waring="";a.model.disable_failover=!1;if("manual"===c.mode||!d.keepalive.enable||"gre"===
d.local_group.group.type||"gre"===d.remote_group.group.type){a.model.disable_failover=!0;a.tip.failover_waring=a.DICT("Site_to_Site_Failover_Waring")+"<ul>";"manual"===c.mode&&(a.tip.failover_waring=a.tip.failover_waring+"<li>"+a.DICT("Site_to_Site_Failover_Waring_For_IPSec_Profile",{"%s":'<a ng-click="funs.clickTab(tabs[0])">'+a.DICT("Site_to_Site_Header_Basic")+"</a>"})+"</li>");d.keepalive.enable||(a.tip.failover_waring=a.tip.failover_waring+"<li>"+a.DICT("Site_to_Site_Failover_Waring_For_Keep_Alive",
{"%s":'<a ng-click="funs.clickTab(tabs[1])">'+a.DICT("Site_to_Site_Header_Advanced")+"</a>"})+"</li>");if("gre"===d.local_group.group.type||"gre"===d.remote_group.group.type)a.tip.failover_waring=a.tip.failover_waring+"<li>"+a.DICT("Site_to_Site_Failover_Waring_For_GRE_Interface",{"%s":'<a ng-click="funs.clickTab(tabs[0])">'+a.DICT("Site_to_Site_Header_Basic")+"</a>"})+"</li>";a.tip.failover_waring+="</ul>"}a.model.tabUrl=b.templateUrl;app.TOOLS.apply(a)},static_routing:{add:function(){var b=da();
b.edit=!0;a.edit.static_routing.networks.push(b);setTimeout(function(){a.procStaticRoutingClick()},50)},edit:function(){angular.forEach(a.edit.static_routing.networks,function(b,c){b.select&&(a.edit.static_routing.networks[c].edit=!0)})},del:function(){for(var b=a.edit.static_routing.networks.length-1;0<=b;b--)a.edit.static_routing.networks[b].select&&a.edit.static_routing.networks.splice(b,1);a.procStaticRoutingClick()}},addS2SGroup:function(){var b=a.edit,c="";angular.forEach(a.model.auth_groups,
function(a){c||b.selected_groups[a]||(c=a)});b.grid_group_data.push({checked:!0,edit:!0,empty:"",group:{select:c,list:[]}});S();a.procNgClick();a.check_groups()},delS2SGroup:function(){var b=a.edit;if(b){var b=b.grid_group_data,c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);S();a.procNgClick();a.check_groups()}},editS2SGroup:function(){angular.forEach(a.edit.grid_group_data,function(a){a.checked&&(a.edit=!0)})}};a.checkConnName=function(){var b=!1;!a.edit||!a.edit.connection_name?(a.s2sform.cname.$setValidity("special",
!0),a.s2sform.cname.$setValidity("overlength",!0),a.s2sform.cname.$setValidity("repeat_name",!0)):64>=a.edit.connection_name.length?(a.s2sform.cname.$setValidity("overlength",!0),a.edit.connection_name.match(/^\w+$/)?a.s2sform.cname.$setValidity("special",!0):a.s2sform.cname.$setValidity("special",!1),angular.forEach(a.model.s2s,function(c){c.connection_name===a.edit.connection_name&&(b=!0)}),b?a.s2sform.cname.$setValidity("repeat_name",!1):a.s2sform.cname.$setValidity("repeat_name",!0)):a.s2sform.cname.$setValidity("overlength",
!1)};a.checkInterfaceName=function(){var b=!1;!a.edit||!a.edit.connection_name?(a.s2sform.ifname.$setValidity("special",!0),a.s2sform.ifname.$setValidity("overlength",!0),a.s2sform.ifname.$setValidity("repeat_name",!0)):32>=a.edit.connection_name.length?(a.s2sform.ifname.$setValidity("overlength",!0),a.edit.connection_name.match(/^\w+$/)?a.s2sform.ifname.$setValidity("special",!0):a.s2sform.ifname.$setValidity("special",!1),angular.forEach(a.model.s2s,function(c){c.connection_name===a.edit.connection_name&&
(b=!0)}),b?a.s2sform.ifname.$setValidity("repeat_name",!1):a.s2sform.ifname.$setValidity("repeat_name",!0)):a.s2sform.ifname.$setValidity("overlength",!1)};a.change_tunnel_method=function(){a.edit.display_connection_name="";"dynamic-ip"===a.edit.tunnel_destination.type?a.edit.display_connection_name="Tunnel to Dynamic IP":"static-ip"===a.edit.tunnel_destination.type&&a.edit.tunnel_destination.ip?a.edit.display_connection_name="Tunnel to "+a.edit.tunnel_destination.ip:"fqdn"===a.edit.tunnel_destination.type&&
a.edit.tunnel_destination.fqdn&&(a.edit.display_connection_name="Tunnel to "+a.edit.tunnel_destination.fqdn)};a.change_ipsec_profile_gre=function(){a.edit.ike_mode="manual"===(a.model.profilesMap[a.edit.ipsec_profile]||{}).mode?"manual":"v1"};a.change_ipsec_profile=function(){var b=a.model.profilesMap[a.edit.ipsec_profile]||{};"manual"===b.mode?(a.edit.remote_endpoint.type="static-ip",a.edit.ike_mode="manual",a.model.schema.remote_endpoint=[{id:"static-ip",displayName:a.DICT("Site_to_Site_Static_IP")}]):
(a.edit.ike_mode=b.ike_mode||"v2",a.model.schema.remote_endpoint=[{id:"static-ip",displayName:a.DICT("Site_to_Site_Static_IP")},{id:"fqdn",displayName:a.DICT("Site_to_Site_FQDN")},{id:"dynamic-ip",displayName:a.DICT("Client_to_Site_Dynamic_IP")}]);switch(a.edit.ike_mode){case "manual":a.model.profileInfo=a.DICT("Site_to_Site_Manual_Profile_Chosen");break;case "v1":a.model.profileInfo=a.DICT("Site_to_Site_IKEv1_Profile_Chosen");break;default:a.model.profileInfo=a.DICT("Site_to_Site_IKEv2_Profile_Chosen")}a.change_identifier_list()};
a.change_identifier_list=function(){var b=a.edit,c=!1,d=function(b){b?(a.model.schema.local_identifier=[{id:"interface",displayName:a.DICT("Site_to_Site_Local_WAN_IP")},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Address")},{id:"fqdn",displayName:a.DICT("Site_to_Site_Local_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Local_User_FQDN")}],"der-asn1-dn"===a.edit.local_group.identifier.type&&(a.edit.local_group.identifier.type=a.model.schema.local_identifier[0].id)):a.model.schema.local_identifier=
[{id:"interface",displayName:a.DICT("Site_to_Site_Local_WAN_IP")},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Address")},{id:"fqdn",displayName:a.DICT("Site_to_Site_Local_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Local_User_FQDN")},{id:"der-asn1-dn",displayName:a.DICT("Site_to_Site_ASN1DN")}]},e=function(b){b?(a.model.schema.remote_identifier=[{id:"ip",displayName:a.DICT("Site_to_Site_Remote_WAN_IP")},{id:"fqdn",displayName:a.DICT("Site_to_Site_Remote_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Remote_User_FQDN")}],
"der-asn1-dn"===a.edit.remote_group.identifier.type&&(a.edit.remote_group.identifier.type=a.model.schema.remote_identifier[0].id)):a.model.schema.remote_identifier=[{id:"ip",displayName:a.DICT("Site_to_Site_Remote_WAN_IP")},{id:"fqdn",displayName:a.DICT("Site_to_Site_Remote_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Remote_User_FQDN")},{id:"der-asn1-dn",displayName:a.DICT("Site_to_Site_ASN1DN")}]};if(b){Y();switch(b.ike_mode){case "manual":case "v1":c="ike"===b.symm_authentication.method?
!0:!1;break;default:c="ike"===b.local_authentication.method?!0:!1}c?(d(!0),e(!0)):(d(!1),e(!1),a.certReady||(a.waitForCert=!0));a.checkASN1DNCert()}};a.change_ip_type=function(){var b=a.edit,c=a.model.greInterfaces.length?!1:!0;a.model.schema.local_ip_type=[{id:"subnet",displayName:a.DICT("Site_to_Site_Subnet"),disable:!1},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Address"),disable:!1},{id:"ip-group",displayName:a.DICT("Site_to_Site_IP_Group"),disable:0===a.model.ipGroups.length},{id:"gre",displayName:a.DICT("Site_to_Site_Gre_Interface"),
disable:c}];a.model.schema.remote_ip_type=[{id:"subnet",displayName:a.DICT("Site_to_Site_Subnet"),disable:!1},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Address"),disable:!1},{id:"ip-group",displayName:a.DICT("Site_to_Site_IP_Group"),disable:0===a.model.ipGroups.length}];b&&("any"!==b.local_group.group.type&&"any"!==b.remote_group.group.type?(a.model.schema.local_ip_type.push({id:"any",displayName:a.DICT("Client_to_Site_Any")}),a.model.schema.remote_ip_type.push({id:"any",displayName:a.DICT("Client_to_Site_Any")})):
"any"===b.local_group.group.type?a.model.schema.local_ip_type.push({id:"any",displayName:a.DICT("Client_to_Site_Any")}):"any"===b.remote_group.group.type&&a.model.schema.remote_ip_type.push({id:"any",displayName:a.DICT("Client_to_Site_Any")}),"gre"===b.local_group.group.type?(a.model.schema.remote_ip_type=[{id:"gre",displayName:a.DICT("Site_to_Site_Gre_Interface"),disable:!1}],b.remote_group.group.type="gre",R()):"gre"===b.remote_group.group.type&&(b.remote_group.group.type=a.model.schema.remote_ip_type[0].id),
"ip-group"===b.local_group.group.type?a.model.local_is_ipgroup||(a.model.local_is_ipgroup=!0,a.model.show_local_ipgroup_note=!0,setTimeout(function(){a.model.show_local_ipgroup_note=!1;app.TOOLS.apply(a)},3E3)):a.model.local_is_ipgroup=!1,"ip-group"===b.remote_group.group.type?a.model.remote_is_ipgroup||(a.model.remote_is_ipgroup=!0,a.model.show_remote_ipgroup_note=!0,setTimeout(function(){a.model.show_remote_ipgroup_note=!1;app.TOOLS.apply(a)},3E3)):a.model.remote_is_ipgroup=!1)};a.change_pwd=function(b){var c=
a.edit;switch(b){case "symm":c.symm_authentication.enable_show_key_in_plain=!0;break;case "local":c.local_authentication.enable_show_key_in_plain=!0;break;case "remote":c.remote_authentication.enable_show_key_in_plain=!0}};a.checkASN1DNCert=function(){var b=a.edit,c=function(b){var c="";angular.forEach(a.model.certs,function(a){a.name===b&&(c=a.subject)});return c};if(b)switch(b.ike_mode){case "v1":case "manual":"cert"===b.symm_authentication.method&&(b.local_group.identifier.asn1dn=c(b.symm_authentication.certificate));
break;default:"cert"===b.local_authentication.method&&(b.local_group.identifier.asn1dn=c(b.local_authentication.certificate))}};a.check_groups=function(){a.errForGroups=!a.edit.extended_authentication.enable||"group"!==a.edit.extended_authentication.type?!1:0>=a.edit.grid_group_data.length?!0:!1};a.change_gre_interface=function(){var b=a.edit;b&&(b.remote_group.group.gre_interface=b.local_group.group.gre_interface,R())};a.checkCombineUnique=function(){a.isErr=!1;var b=a.edit.remote_endpoint.type,
c="",d=a.edit.local_group.identifier.type,e="",g=a.edit.remote_group.identifier.type,h="",k="",l="";if(void 0===c||void 0===e||void 0===h)a.isErr=!1;else{l=a.edit["interface"]+"#";"static-ip"===b?c=a.edit.remote_endpoint.ip:"fqdn"===b?c=a.edit.remote_endpoint.fqdn:"dynamic-ip"===b&&(c="dynamic-ip");"interface"===d?e="0.0.0.0":"ip"===d?e=a.edit.local_group.identifier.ip:"fqdn"===d?e=a.edit.local_group.identifier.fqdn:"user-fqdn"===d?e=a.edit.local_group.identifier.user_fqdn:"der-asn1-dn"===d&&(e="any");
l=l+b+"#"+c+"#"+d+"#"+e+"#";"ip"===g?h=a.edit.remote_group.identifier.ip:"fqdn"===g?h=a.edit.remote_group.identifier.fqdn:"user-fqdn"===g?h=a.edit.remote_group.identifier.user_fqdn:"der-asn1-dn"===g&&(h=void 0===a.edit.remote_group.identifier.asn1dn||""===a.edit.remote_group.identifier.asn1dn?"any":a.edit.remote_group.identifier.asn1dn);l=l+g+"#"+h;for(b=0;b<a.model.s2s.length;b++)if(k="",a.model.s2s[b].connection_name!==a.edit.connection_name&&(k=a.model.s2s[b]["interface"]+"#","static-ip"===a.model.s2s[b].remote_endpoint.type?
k=k+a.model.s2s[b].remote_endpoint.type+"#"+a.model.s2s[b].remote_endpoint.ip:"fqdn"===a.model.s2s[b].remote_endpoint.type?k=k+a.model.s2s[b].remote_endpoint.type+"#"+a.model.s2s[b].remote_endpoint.fqdn:"dynamic-ip"===a.model.s2s[b].remote_endpoint.type&&(k=k+a.model.s2s[b].remote_endpoint.type+"#dynamic-ip"),k+="#","interface"===a.model.s2s[b].local_group.identifier.type?k=k+a.model.s2s[b].local_group.identifier.type+"#0.0.0.0":"ip"===a.model.s2s[b].local_group.identifier.type?k=k+a.model.s2s[b].local_group.identifier.type+
"#"+a.model.s2s[b].local_group.identifier.ip:"fqdn"===a.model.s2s[b].local_group.identifier.type?k=k+a.model.s2s[b].local_group.identifier.type+"#"+a.model.s2s[b].local_group.identifier.fqdn:"user-fqdn"===a.model.s2s[b].local_group.identifier.type?k=k+a.model.s2s[b].local_group.identifier.type+"#"+a.model.s2s[b].local_group.identifier.user_fqdn:"der-asn1-dn"===a.model.s2s[b].local_group.identifier.type&&(k=k+a.model.s2s[b].local_group.identifier.type+"#any"),k+="#","ip"===a.model.s2s[b].remote_group.identifier.type?
k=k+a.model.s2s[b].remote_group.identifier.type+"#"+a.model.s2s[b].remote_group.identifier.ip:"fqdn"===a.model.s2s[b].remote_group.identifier.type?k=k+a.model.s2s[b].remote_group.identifier.type+"#"+a.model.s2s[b].remote_group.identifier.fqdn:"user-fqdn"===a.model.s2s[b].remote_group.identifier.type?k=k+a.model.s2s[b].remote_group.identifier.type+"#"+a.model.s2s[b].remote_group.identifier.user_fqdn:"der-asn1-dn"===a.model.s2s[b].remote_group.identifier.type&&(k=void 0===a.model.s2s[b].remote_group.identifier.asn1dn||
""===a.model.s2s[b].remote_group.identifier.asn1dn?k+a.model.s2s[b].remote_group.identifier.type+"#any":k+a.model.s2s[b].remote_group.identifier.type+"#"+a.model.s2s[b].remote_group.identifier.asn1dn)),k===l){a.repeat_conn=a.model.s2s[b].connection_name;a.isErr=!0;break}}};a.handleSubnetA=function(){return!0};a.handleSubnetB=function(){var b=!0,c=[],d=[],e=[],e=0,g=a.subnetObj.ipv4,d=c="";if(void 0===a.edit.remote_group.group.ip||""===a.edit.remote_group.group.ip||void 0===g)return!0;for(var e=a.edit.remote_group.group.ip.split("."),
e=(parseInt(e[0],10)<<24|parseInt(e[1],10)<<16|parseInt(e[2],10)<<8|parseInt(e[3],10))>>>0,h=0;h<g.length;h++){if("remote_traffic"!==g[h].type&&"remote_traffic"!==g[h].name)if(c=g[h]["range-start"]||"",d=g[h]["range-end"]||"",!1===b)break;else""===c||""===d||void 0===c||void 0===d?b=!0:(c=c.split("."),d=d.split("."),range_startnum=(parseInt(c[0],10)<<24|parseInt(c[1],10)<<16|parseInt(c[2],10)<<8|parseInt(c[3],10))>>>0,range_endnum=(parseInt(d[0],10)<<24|parseInt(d[1],10)<<16|parseInt(d[2],10)<<8|
parseInt(d[3],10))>>>0,e>=range_startnum&&e<=range_endnum&&(b=!1));if(!1===b)break}return b};(function(){var b;a.model.schema={};a.model.schema={remote_endpoint:[{id:"static-ip",displayName:a.DICT("Site_to_Site_Static_IP")},{id:"fqdn",displayName:a.DICT("Site_to_Site_FQDN")}],tunnel_destination:[{id:"static-ip",displayName:a.DICT("Site_to_Site_Static_IP")}],local_identifier:[{id:"interface",displayName:a.DICT("Site_to_Site_Local_WAN_IP")},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Addr")},{id:"fqdn",
displayName:a.DICT("Site_to_Site_Local_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Local_User_FQDN")}],remote_identifier:[{id:"ip",displayName:a.DICT("Site_to_Site_Remote_WAN_IP")},{id:"fqdn",displayName:a.DICT("Site_to_Site_Remote_FQDN")},{id:"user-fqdn",displayName:a.DICT("Site_to_Site_Remote_User_FQDN")},{id:"der-asn1-dn",displayName:a.DICT("Site_to_Site_ASN1DN")}],local_ip_type:[{id:"subnet",displayName:a.DICT("Site_to_Site_Subnet")},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Addr")}],
remote_ip_type:[{id:"subnet",displayName:a.DICT("Site_to_Site_Subnet")},{id:"ip",displayName:a.DICT("Site_to_Site_IP_Addr")}],authentication:[{id:"md5",displayName:a.DICT("Site_to_Site_MD5")},{id:"sha1",displayName:a.DICT("Site_to_Site_SHA1")},{id:"sha2-256",displayName:a.DICT("Site_to_Site_SHA2_256")}],encryption:[{id:"esp-3des",displayName:a.DICT("Site_to_Site_3DES")},{id:"esp-aes-128",displayName:a.DICT("Site_to_Site_AES128")},{id:"esp-aes-192",displayName:a.DICT("Site_to_Site_AES192")},{id:"esp-aes-256",
displayName:a.DICT("Site_to_Site_AES256")}],dpdAction:[{id:"clear",displayName:a.DICT("Site_to_Site_Clear")},{id:"restart",displayName:a.DICT("Site_to_Site_Restart")}],staticRouting:[{id:"tunnel_all",displayName:a.DICT("Site_to_Site_Tunnel_All_Traffic")},{id:"tunnel_split",displayName:a.DICT("Site_to_Site_Do_Split_Tunneling")}]};O();app.transition.In();v.all([U(),A(),F(),G(),L(),x(),k(),M(),C(),z()]).then(function(c){Q(p(c,0));B(p(c,1));D(p(c,8));H(p(c,2));J(p(c,3));g(p(c,6));N(p(c,4));r(p(c,5));
P(p(c,7));y(p(c,9));V();R();T();a.model.dels=[];a.edit=void 0;var d=s.get("IPSec_S2S");if(d)switch(Log(INFO,"Jump from VPN Status: "+JSON.stringify(d)),d.action){case "edit":b=!1;angular.forEach(a.model.s2s_table,function(a,c){a.name===d.key&&(b=a.checked=!0)});b?a.funs.edit():Log(ERROR,"[S2S][oneTimeLocker] no rule with "+JSON.stringify(d));break;case "add":a.funs.createS2S()}app.transition.Out();a.dataReady=!0})})()}]);app.controller("ssl_vpn_main",["$scope","$q","$log","MyHttp","$timeout","GridRowBasedEditingOper","$templateCache","Sets","wan_service","oneTimeLocker","UserSession","userAccessRight","addressPoolValidate","sslvpn_port_vld",function(a,b,s,n,v,t,m,q,e,w,l,h,p,u){a.model=a.model||{};a.ctx=a.ctx||{};a.loadReady=!1;a.success=!1;a.subnetObj={};a.vlanIp="";a.userAccessFlag=h.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&l.logout();var x=function(){var e=n.post({url:resource_base+"data/sslvpn.json",
method:"get_sslvpn",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),h=n.post({url:resource_base+"data/sslvpn_group.json",method:"get_sslvpn_group",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),l=n.post({url:resource_base+"data/wan_setting1.json",method:"get_interface",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),m=n.post({url:resource_base+"data/cert2.json",method:"get_cert",
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),p=n.post({url:resource_base+"data/firewall_basic_settings.json",method:"get_firewall_basic_settings",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),q=n.post({url:resource_base+"data/get_subnet.json",method:"get_subnet",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([e,h,l,m,p,q,u.init()]).then(function(b){a.model={};for(var e=
0;e<b.length;e++)r(b[e]);d(b[5]);c(b[2]);k();a.schema=a.schema||{};a.schema.listClientNetmask=[{id:"255.255.255.0",displayName:"255.255.255.0"},{id:"255.255.255.128",displayName:"255.255.255.128"},{id:"255.255.255.192",displayName:"255.255.255.192"}];a.update_split_network_ctx();a.model_orig=angular.copy(a.model);a.loadReady=!0;a.gridSSLVPNGROUP.Edit=!1;v(function(){g()},100)})};x();a.resetPageVIew=function(b){"overview"==b&&(a.gridSSLVPNGROUP.Edit=!1,n.post({url:resource_base+"data/sslvpn_group.json",
method:"get_sslvpn_group",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}).then(function(b){(b=b.data.result)&&(b.sslvpn&&b.sslvpn["group-policies"]&&b.sslvpn["group-policies"]["group-policy"])&&(a.model_orig.sslvpn["group-policies"]["group-policy"]=b.sslvpn["group-policies"]["group-policy"])}))};var r=function(b){if(b=b.data){b=b.result;for(var c in b)a.model[c]?q.recover_object(a.model[c],b[c]):angular.extend(a.model,b)}},d=function(b){b.data&&(b.data.result&&
b.data.result.subnets&&b.data.result.subnets.ipv4&&b.data.result.subnets.ipv6)&&(a.subnetObj=angular.copy(b.data.result.subnets))},c=function(b){b||(b={});var c=[];b.data&&(b.data.result&&b.data.result.interfaces&&b.data.result.interfaces["interface"])&&(c=b.data.result.interfaces["interface"]);angular.forEach(c,function(b){"VLAN1"===b.name&&(a.vlanIp=b.ipv4&&b.ipv4.address&&b.ipv4.address[0]&&b.ipv4.address[0].ip||"")})},k=function(){a.use_sslvpn_sample={sslvpn:{enable:!1,"interface":"WAN1","gateway-port":443,
certificate:"Default","address-pool":"",netmask:"255.255.255.0","internal-access":!1,"domain-name":"","login-banner":"","idle-timeout":2100,"session-timeout":0,"client-dpd-timeout":300,"gateway-dpd-timeout":300,"keep-alive":30,"lease-duration":43200,"max-mtu":1406,"retry-interval":3600,"max-session":3,"group-policies":{"group-policy":[]}}};q.recover_object(a.model,a.use_sslvpn_sample);a.use_interface_sample={interfaces:{"interface":[]}};q.recover_object(a.model,a.use_interface_sample);a.use_cert_state_sample=
{"certs-state":{cert:[]}};q.recover_object(a.model,a.use_cert_state_sample);a.use_firewallsettings_sample={firewall:{}};q.recover_object(a.model,a.use_firewallsettings_sample);a.use_group_policy_sample={checked:!1,"split-tunnelling":{"split-network":[],"split-dns":[]}};a.ie_proxy_sample={ip:"",edit:!1,invalid:!1,checked:!1};var b=function(b,c){b[c]&&(q.recover_object(b[c],{"ie-proxy-exception":[]}),angular.forEach(b[c]["ie-proxy-exception"],function(b){q.recover_object(b,a.ie_proxy_sample)}))};a.network_sample=
{checked:!1,edit:!1,invalid:!1,ip:"",netmask:"255.255.255.0"};var c=function(b){b["split-tunnelling"]&&b["split-tunnelling"]["split-network"]&&angular.forEach(b["split-tunnelling"]["split-network"],function(b){q.recover_object(b,a.network_sample)})};a.dns_sample={checked:!1,edit:!1,invalid:!1,domain:""};for(var d=function(b){b["split-tunnelling"]&&b["split-tunnelling"]["split-dns"]&&angular.forEach(b["split-tunnelling"]["split-dns"],function(b){q.recover_object(b,a.dns_sample)})},e=a.model.sslvpn["group-policies"]["group-policy"],
g=e.length-1;0<=g;g--)q.recover_object(e[g],a.use_group_policy_sample),b(e[g],"auto"),b(e[g],"bypass-local"),c(e[g]),d(e[g])},g=function(){a.ctx.sslvpn_tab=a.ctx.sslvpn_tab||[{active:!1},{active:!1}];var b=w.get("SSL_VPN");if(b){Log(DEBUG,"Redirect to: "+JSON.stringify(b));var c=function(){a.ctx.sslvpn_tab[1].active=!0;switch(b.action){case "edit":angular.forEach(a.gridSSLVPNGROUP.Options.data||[],function(c,d){c.entity["policy-name"]===b.key&&(a.gridSSLVPNGROUP.Selections=[c],a.gridSSLVPNGROUP.edit())});
break;case "add":a.gridSSLVPNGROUP.add()}};v(function(){c()},0)}else a.ctx.sslvpn_tab[0].active=!0};a.update_split_network_ctx=function(){for(var b=a.model.sslvpn["group-policies"]["group-policy"],c=b.length;c--;){var d=b[c]["split-tunnelling"];d&&(d._split_type=void 0!=d["include-traffic"]?"include":void 0!=d["exclude-local-lan"]?"exclude":"include")}};a.selected=a.selected||{};a.gridSSLVPNGROUP=a.gridSSLVPNGROUP||{};a.gridIEException=a.gridIEException||{};a.gridSplitNetwork=a.gridSplitNetwork||
{};a.gridSplitDNS=a.gridSplitDNS||{};a.getItemIEType=function(a){var b;a?void 0!==a.none?b="none":void 0!==a.auto?b="auto":void 0!==a["bypass-local"]?b="bypass-local":void 0!==a.disabled&&(b="disabled"):b="disabled";return b};a.save=function(){var b=angular.copy(a.model.sslvpn);(function(a){angular.forEach(a,function(a,b){var c=a.auto,d=a["bypass-local"],e=a["split-tunnelling"];angular.isDefined(a.checked)&&delete a.checked;c&&c["ie-proxy-exception"]&&angular.forEach(c["ie-proxy-exception"],function(a,
b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableIEExceptionChk)&&delete a.disableIEExceptionChk;delete a.edit;delete a.invalid});d&&d["ie-proxy-exception"]&&angular.forEach(d["ie-proxy-exception"],function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableIEExceptionChk)&&delete a.disableIEExceptionChk;delete a.edit;delete a.invalid});e&&e._split_type&&("include"==e._split_type?(e["include-traffic"]=null,void 0!==e["exclude-local-lan"]&&delete e["exclude-local-lan"]):
"exclude"==e._split_type&&void 0!==e["include-traffic"]&&(e["exclude-local-lan"]=e["exclude-local-lan"]||!1,delete e["include-traffic"]),delete e._split_type);e&&e["split-network"]&&angular.forEach(e["split-network"],function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableSplitNetworkChk)&&delete a.disableSplitNetworkChk;delete a.edit;delete a.invalid});e&&e["split-dns"]&&angular.forEach(e["split-dns"],function(a,b){angular.isDefined(a.checked)&&delete a.checked;angular.isDefined(a.disableSplitDNSChk)&&
delete a.disableSplitDNSChk;delete a.edit;delete a.invalid});c=a.ie_proxy_path;d=function(b,c){c!=b&&void 0!==a[c]&&delete a[c]};d(c,"none");d(c,"auto");d(c,"bypass-local");d(c,"disabled");"none"==c?a.none=null:"disabled"==c&&(a.disabled=null);a.ie_proxy_path&&delete a.ie_proxy_path})})(b["group-policies"]["group-policy"]);var c=function(){n.post({url:resource_base+"data/sslvpn.json",method:"set_sslvpn",params:{sslvpn:b},success:function(b){!0===a.ctx.sslvpn_tab[1].active&&w.put("SSL_VPN",{action:"overview"});
a.loadReady=!1;x();a.config_saved=!0;a.success=!0},error:function(b){a.loadReady=!1;x();Log(ERROR,"AJAX loading error: "+b.status+", URL: "+b.config.url)}})};(function(){var b=a.model_orig.sslvpn["group-policies"]["group-policy"],d=a.model.sslvpn["group-policies"]["group-policy"],e,g,h=!1,k=[],l,m,p,q={};g=d[a.ctx.ie_index];angular.forEach(b,function(a){a["policy-name"]===g["policy-name"]&&(e=a)});g&&e&&(l=a.ctx.ie_proxy_path,q={"policy-name":g["policy-name"]},m=[],e[l]&&g[l]&&(angular.forEach(e[l]["ie-proxy-exception"],
function(a){p=!1;angular.forEach(g[l]["ie-proxy-exception"],function(b){a.ip===b.ip&&(p=!0)});p||m.push({ip:a.ip})}),m.length&&(q[l]={"ie-proxy-exception":m},h=!0)),m=[],angular.forEach(e["split-tunnelling"]["split-network"],function(a){p=!1;angular.forEach(g["split-tunnelling"]["split-network"],function(b){a.ip===b.ip&&(p=!0)});p||m.push({ip:a.ip})}),m.length&&(q["split-tunnelling"]={"split-network":m},h=!0),m=[],angular.forEach(e["split-tunnelling"]["split-dns"],function(a){p=!1;angular.forEach(g["split-tunnelling"]["split-dns"],
function(b){a.domain===b.domain&&(p=!0)});p||m.push({domain:a.domain})}),m.length&&(q["split-tunnelling"]||(q["split-tunnelling"]={}),q["split-tunnelling"]["split-dns"]=m,h=!0),h&&k.push(q));angular.forEach(b,function(a){p=!1;angular.forEach(d,function(b){a["policy-name"]===b["policy-name"]&&(p=!0)});p||k.push({"policy-name":a["policy-name"]})});k.length?n.post({url:resource_base+"data/sslvpn.json",method:"del_sslvpn",params:{sslvpn:{"group-policies":{"group-policy":k}}},success:function(a){c()},
error:function(a){c();Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}):c()})();a.resetModified()};a.certFileChange=function(){var b=a.model.sslvpn.certificate;a.form.generalform.g_certfile.$setValidity("special",!0);angular.forEach(a.model["certs-state"].cert,function(c,d){c.name==b&&512>=c.info["key-encryption-length"]&&a.form.generalform.g_certfile.$setValidity("special",!1)})};a.cancel=function(){a.loadReady=!1;a.model={};x();a.resetModified()};a.poolValidation=function(){var b=
!0;return void 0===a.model.sslvpn["address-pool"]||void 0===a.model.sslvpn.netmask||""===a.model.sslvpn["address-pool"]||""===a.model.sslvpn.netmask?!0:b=p.poolMaskValidate("sslvpn","sslvpn","ipv4",a.subnetObj,a.model.sslvpn["address-pool"],a.model.sslvpn.netmask)};a.sslvpnEnable=function(b){!1===a.model.sslvpn.enable&&(a.form.generalform.g_gateway_port.$invalid&&(a.model.sslvpn["gateway-port"]=a.model_orig.sslvpn["gateway-port"]),a.form.generalform.g_cli_addr.$invalid&&(a.model.sslvpn["address-pool"]=
a.model_orig.sslvpn["address-pool"]),a.form.generalform.txt_generalclientdomain.$invalid&&(a.model.sslvpn["domain-name"]=a.model_orig.sslvpn["domain-name"]),a.form.generalform.g_login_banner.$invalid&&(a.model.sslvpn["login-banner"]=a.model_orig.sslvpn["login-banner"]),a.form.generalform.g_opt_idle_timeout.$invalid&&(a.model.sslvpn["idle-timeout"]=a.model_orig.sslvpn["idle-timeout"]),a.form.generalform.g_opt_ses_timeout.$invalid&&(a.model.sslvpn["session-timeout"]=a.model_orig.sslvpn["session-timeout"]),
a.form.generalform.g_opt_cli_dpd_timeout.$invalid&&(a.model.sslvpn["client-dpd-timeout"]=a.model_orig.sslvpn["client-dpd-timeout"]),a.form.generalform.g_opt_gw_dpd_timeout.$invalid&&(a.model.sslvpn["gateway-dpd-timeout"]=a.model_orig.sslvpn["gateway-dpd-timeout"]),a.form.generalform.g_opt_keep_alive.$invalid&&(a.model.sslvpn["keep-alive"]=a.model_orig.sslvpn["keep-alive"]),a.form.generalform.g_opt_lease_dur.$invalid&&(a.model.sslvpn["lease-duration"]=a.model_orig.sslvpn["lease-duration"]),a.form.generalform.g_opt_mtu.$invalid&&
(a.model.sslvpn["max-mtu"]=a.model_orig.sslvpn["max-mtu"]),a.form.generalform.g_opt_retry_interval.$invalid&&(a.model.sslvpn["retry-interval"]=a.model_orig.sslvpn["retry-interval"]),a.certFileChange());a.chkGwPort()};a.chkGwPort=function(){var b;a.form.generalform.g_gateway_port.$setValidity("special",!0);!1!==a.model.sslvpn.enable&&(b=u.check_ssl_port(a.model.sslvpn["gateway-port"]),b.valid||(a.form.generalform.g_gateway_port.$setValidity("special",!1),app.TOOLS.criticalAlertBox({title:a.DICT("Error"),
msg:u.get_err_html(b.err)})))}}]);app.controller("ssl_vpn_general",["$scope","$q","$log","MyHttp","$templateCache","Sets","wan_service",function(a,b,s,n,v,t,m){a.filterWANphy={physical:!0,subinterface:!0,usb:!0};a.ctx.wans_ref=m.filter(a.model.interfaces["interface"],a.filterWANphy);a.ctx.cert_ref=a.model["certs-state"].cert}]);
app.controller("ssl_vpn_group",["$scope","$q","$log","MyHttp","GridRowBasedEditingOper","$templateCache","Sets","wan_service","$timeout",function(a,b,s,n,v,t,m,q,e){var w=function(){var b=a.model.sslvpn["group-policies"]["group-policy"];b[a.ctx.ie_index]&&(b[a.ctx.ie_index][a.ctx.ie_proxy_path]||(b[a.ctx.ie_index][a.ctx.ie_proxy_path]={}),b[a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"]||(b[a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"]=[]),a.gridIEException.Options.data=b[a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"],
a.gridIEException.Selections=[])},l=function(){var b=a.model.sslvpn["group-policies"]["group-policy"];a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]&&(b[a.ctx.ie_index]["split-tunnelling"]||(b[a.ctx.ie_index]["split-tunnelling"]={}),b[a.ctx.ie_index]["split-tunnelling"]["split-network"]||(b[a.ctx.ie_index]["split-tunnelling"]["split-network"]=[]),a.gridSplitNetwork.Options.data=b[a.ctx.ie_index]["split-tunnelling"]["split-network"],a.gridSplitNetwork.Selections=[])},h=function(){var b=
a.model.sslvpn["group-policies"]["group-policy"];b[a.ctx.ie_index]&&(b[a.ctx.ie_index]["split-tunnelling"]||(b[a.ctx.ie_index]["split-tunnelling"]={}),b[a.ctx.ie_index]["split-tunnelling"]["split-dns"]||(b[a.ctx.ie_index]["split-tunnelling"]["split-dns"]=[]),a.gridSplitDNS.Options.data=b[a.ctx.ie_index]["split-tunnelling"]["split-dns"],a.gridSplitDNS.Selections=[])};a.gridSSLVPNGROUP.edit=function(){var b=a.gridSSLVPNGROUP.Selections[0],e=a.model.sslvpn["group-policies"]["group-policy"];a.ctx.ie_index=
e.indexOf(b);a.ctx.ie_type="edit";if(b&&void 0==b.ie_proxy_path){var m=a.getItemIEType(b);a.ctx.ie_proxy_path=m;b.ie_proxy_path=m}w();l();h();a.gpref=e;a.gridSSLVPNGROUP.Edit=!0};a.gridSSLVPNGROUP.remove=function(){var b,e;void 0===a.model.sslvpn||void 0===a.model.sslvpn["group-policies"]||void 0===a.model.sslvpn["group-policies"]["group-policy"]?(b=[],e=0):(b=a.model.sslvpn["group-policies"]["group-policy"],e=b.length);for(e-=1;0<=e;e--)b[e].checked&&b.splice(e,1);a.gridSSLVPNGROUP.procNgClick();
a.modified()};a.update_proxy_type=function(){var b=a.gridSSLVPNGROUP.Selections[0],e=b.ie_proxy_path,n={address:"",port:"","ie-proxy-exception":[]};if(b){switch(e){case "auto":Log(DEBUG,"== auto");void 0==b.auto&&(b.auto={},m.recover_object(b.auto,n));break;case "bypass-local":Log(DEBUG,"== bypass");void 0==b["bypass-local"]&&(b["bypass-local"]={},m.recover_object(b["bypass-local"],n));break;case "disabled":Log(DEBUG,"== disabled");break;case "none":Log(DEBUG,"== none");break;default:Log(DEBUG,"== default")}a.ctx.ie_proxy_path=
e;w();l();h()}};a.display_ie_proxy=function(a){return"auto"==a.ie_proxy_path||"bypass-local"==a.ie_proxy_path};(function(){a.gridSSLVPNGROUP.Selections=[];a.gpref;a.gridSSLVPNGROUP.procNgClick=function(b){a.gridSSLVPNGROUP.Selections=[];angular.forEach(a.model.sslvpn["group-policies"]["group-policy"],function(b,d){b.checked&&a.gridSSLVPNGROUP.Selections.push(b)})};a.gridSSLVPNGROUP.Options=app.uiGrid.generateGridOptions({IDPreifx:"sslVPNGroup",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridSSLVPNGROUP.procNgClick},
{field:"policy-name",displayName:a.DICT("SSL_VPN_Policy_Nm")},{field:"description",displayName:a.DICT("SSL_VPN_Desc")}]});a.gridSSLVPNGROUP.Options.data=a.model.sslvpn["group-policies"]["group-policy"];a.gridSSLVPNGROUP.Selections=[];var b=function(){var b=a.model.sslvpn["group-policies"]["group-policy"];return 10<=b.length?(a.msg=a.DICT("SSL_VPN_Reach_Max_Entry_For_SSL_VPN_Group",{"%d":b.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},m=function(){var b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"];
return 20<=b.length?(a.msg=a.DICT("SSL_VPN_Reach_Max_Entry_For_IE_Proxy",{"%d":b.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},n=function(){var b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"];return 30<=b.length?(a.msg=a.DICT("SSL_VPN_Reach_Max_Entry_For_Split_DNS",{"%d":b.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},q=function(){var b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"];
return 50<=b.length?(a.msg=a.DICT("SSL_VPN_Reach_Max_Entry_For_Split_Network",{"%d":b.length}),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.gridSSLVPNGROUP.add=function(){if(!b()){var d=a.model.sslvpn["group-policies"]["group-policy"],c={"policy-name":"",enable:!1,"primary-dns-server":a.vlanIp||"","secondary-dns-server":"","primary-wins-server":"","secondary-wins-server":"",description:"description",disabled:null,"split-tunnelling":{enable:!1,"include-traffic":null,"split-network":[],
"split-dns":[]}},k;d.push(c);k=d.indexOf(c);a.gpref=d;a.gridSSLVPNGROUP.Edit=!0;e(function(){var b=a.getItemIEType(c);a.ctx.ie_proxy_path=b;c.ie_proxy_path=b;a.update_split_network_ctx();a.ctx.ie_index=k;a.ctx.ie_type="new";a.gridSSLVPNGROUP.Selections.push(c);w();l();h()},0);a.modified()}};a.ctx.ie_index=0;a.ctx.ie_type="new";a.ctx.ie_proxy_path="disabled";a.gridIEException.Selections=[];a.gridIEException.procNgClick=function(b){a.gridIEException.Selections=[];angular.forEach(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"],
function(b,d){b.checked?a.gridIEException.Selections.push(b):b.edit=!1})};a.gridIEExceptionInvalidCbk=function(a){a.row.entity.disableIEExceptionChk=a.rowInvalid};a.chkIEException=function(b,c,e){b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"];var g=b.length;angular.forEach(b,function(a){a.invalid=!1});for(c=0;c<g;c++)for(e=c+1;e<g;e++)b[c].ip===b[e].ip&&(b[c].invalid=!0,b[e].invalid=!0)};a.gridIEException.Options=app.uiGrid.generateGridOptions({IDPreifx:"ieException",
columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridIEException.procNgClick,headerChangedCbk:a.gridIEException.procNgClick,disableChkBoxField:"disableIEExceptionChk"},{field:"ip",displayName:a.DICT("SSL_VPN_IP"),id:"ieExceptionIP",validationCbk:"gridIEExceptionInvalidCbk",cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-ip"),editRow:"edit",required:!0,invalidField:"invalid",customVldCbk:"chkIEException"}]});w();a.gridIEException.add=function(){m()||
(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"].push({ip:"",edit:!1,invalid:!1,checked:!1,edit:!0,checked:!0}),a.gridIEException.Options.gridApi.customApi.scrollToLast())};a.gridIEException.edit=function(){angular.forEach(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"],function(a){a.checked&&(a.edit=!0)})};a.gridIEException.remove=function(){var b,c;void 0===a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"]?
(b=[],c=0):(b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index][a.ctx.ie_proxy_path]["ie-proxy-exception"],c=b.length);for(c-=1;0<=c;c--)b[c].checked&&b.splice(c,1);a.gridIEException.procNgClick()};a.gridSplitNetwork.Selections=[];a.splitNetworkIpv4Cbk=function(b){b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"];var c=b.length,e=[],g,h;angular.forEach(b,function(a,b){a.invalid=!1;e[b]=app.TOOLS.validation.ipv4_getNet(a.ip,a.netmask).toString()});
for(g=0;g<c;g++)for(h=g+1;h<c;h++)e[g]===e[h]&&(b[g].invalid=!0,b[h].invalid=!0)};a.gridSplitNetwork.procNgClick=function(b){a.gridSplitNetwork.Selections=[];angular.forEach(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"],function(b,d){b.checked?a.gridSplitNetwork.Selections.push(b):b.edit=!1})};a.gridSplitNetworkInvalidCbk=function(a){a.row.entity.disableSplitNetworkChk=a.rowInvalid};a.gridSplitNetwork.Options=app.uiGrid.generateGridOptions({IDPreifx:"splitNetwork",
columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridSplitNetwork.procNgClick,headerChangedCbk:a.gridSplitNetwork.procNgClick,disableChkBoxField:"disableSplitNetworkChk"},{field:"ip",displayName:a.DICT("SSL_VPN_IP"),id:"splitNetworkIP",validationCbk:"gridSplitNetworkInvalidCbk",cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-ip required check-ipv4-bymask=\"row.entity['netmask']\""),customVldCbk:"splitNetworkIpv4Cbk",invalidField:"invalid",editRow:"edit",
required:!0},{field:"netmask",displayName:a.DICT("SSL_VPN_Netmask"),id:"splitNetworkNetmask",validationCbk:"gridSplitNetworkInvalidCbk",cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-netmask required check-mask-byipv4=\"row.entity['ip']\""),customVldCbk:"splitNetworkIpv4Cbk",invalidField:"invalid",editRow:"edit",required:!0}]});l();a.gridSplitNetwork.add=function(){var b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"],
c;c={checked:!1,edit:!1,invalid:!1,ip:"",netmask:"255.255.255.0"};q()||(c.edit=!0,c.checked=!0,b.push(c),a.gridSplitNetwork.Options.gridApi.customApi.scrollToLast())};a.gridSplitNetwork.remove=function(){var b,c;void 0===a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"]?(b=[],c=0):(b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-network"],c=b.length);for(c-=1;0<=c;c--)b[c].checked&&b.splice(c,1);a.gridSplitNetwork.procNgClick()};
a.gridSplitDNS.Selections=[];a.gridSplitDNS.procNgClick=function(b){a.gridSplitDNS.Selections=[];angular.forEach(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"],function(b,d){b.checked?a.gridSplitDNS.Selections.push(b):b.edit=!1})};a.chkSplitDnsFqdn=function(){var b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"],c=b.length,e,g;angular.forEach(b,function(a){a.invalid=!1});for(e=0;e<c;e++)for(g=e+1;g<
c;g++)b[e].domain===b[g].domain&&(b[e].invalid=!0,b[g].invalid=!0)};a.gridSplitDNSInvalidCbk=function(a){a.row.entity.disableSplitDNSChk=a.rowInvalid};a.gridSplitDNS.Options=app.uiGrid.generateGridOptions({IDPreifx:"splitDNS",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridSplitDNS.procNgClick,headerChangedCbk:a.gridSplitDNS.procNgClick,disableChkBoxField:"disableSplitDNSChk"},{field:"domain",displayName:a.DICT("SSL_VPN_Domain"),id:"splitDNSDomain",customVldGroup:"2",validationCbk:"gridSplitDNSInvalidCbk",
cellTemplate:t.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"fqdn required"),required:!0,customVldCbk:"chkSplitDnsFqdn",invalidField:"invalid",editRow:"edit"}]});h();a.gridSplitDNS.add=function(){n()||(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"].push({checked:!1,edit:!1,invalid:!1,domain:"",edit:!0,checked:!0}),a.gridSplitDNS.Options.gridApi.customApi.scrollToLast())};a.gridSplitDNS.edit=function(){angular.forEach(a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"],
function(a){a.checked&&(a.edit=!0)})};a.gridSplitDNS.remove=function(){var b,c;void 0===a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"]?(b=[],c=0):(b=a.model.sslvpn["group-policies"]["group-policy"][a.ctx.ie_index]["split-tunnelling"]["split-dns"],c=b.length);for(c-=1;0<=c;c--)b[c].checked&&b.splice(c,1);a.gridSplitDNS.procNgClick()}})()}]);app.controller("ipv6TransitionCtrl",["$scope","MyHttp","wan_service","wan_lib","$q","UserSession","userAccessRight","intf_service",function(a,b,s,n,v,t,m,q){a.success=!1;a.dataReady=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var e={ip6in4:"ip6in4",ip6rd:"ip6rd"},w=function(a){var b="";angular.forEach(e,function(c,d){c===a&&(b=d)});return b},l=function(){return b.post({method:"get_ipv6_transition",url:resource_base+"data/wan_setting1.json",error:function(a){Log(ERROR,
"ipv6TransitionCtrl getData error Status: "+a.status)}})},h=function(){return b.post({method:"get_interface",url:resource_base+"data/wan_setting1.json",error:function(a){}})},p=function(b){b||(b={});b=(b.interfaces||{})["interface"]||[];a.model.tuns=[x({name:"TUN1"},1),x({name:"TUN2"},2)];angular.forEach(b,function(b,c){e[b.type]&&("TUN1"===b.name?a.model.tuns[0]=x(b,1):"TUN2"===b.name&&(a.model.tuns[1]=x(b,2)))});a.gridTunnelOptions.data=a.model.tuns},u=function(b){b||(b={});a.model.intfs=[];var c=
{},d,e,h,l,m,p,q;b=(b.interfaces||{})["interface"]||[];angular.forEach(a.model.intfs_state,function(a){});b=s.filter(b,{physical:!0,logical:!0});var r=RegExp(n.regexpStr.defaultIntf),t=RegExp(n.regexpStr.logicalIntf),u,v=function(a){c[a]||(c[a]={def:void 0,logical:void 0})};angular.forEach(b,function(a,b){d=a.name;if(u=d.match(r))v(d),c[d].def=a;if((u=d.match(t))&&isNaN(parseInt(u[3],10)))v(u[1]),c[u[1]].logical=a});angular.forEach(c,function(b,c){d=b.def.name;m=!1;q="";if(b.logical)switch(q=b.logical.name,
u=q.match(t),u[2]){case "PPTP":p="pptp";break;case "L2TP":p="l2tp";break;case "PPPOE":p="pppoe";break;case "BRIDGE":p="trasparent-bridge";break;default:return}else h=b.def.ipv4||{},l=h.setting||{},l.dynamic?(m=!0,p="dynamic"):p="static";e={id:d,isDHCP:m,displayName:d,logical:q,v4Proto:p};a.model.intfs.push(e)})},x=function(b,c){b||(b={});var d={name:b.name,proto:b.type?e[b.type]:e.ip6in4,description:b.description||"",index:c,enabled:void 0!==b.enabled?b.enabled:!1,use_as_default_route:!1,local_interface:a.model.intfs[0]&&
a.model.intfs[0].id||"",local_interface_is_dhcp:a.model.intfs[0]&&a.model.intfs[0].isDHCP||!0,edit:!1,empty:""},h,l=b.ipv6inipv4||{},m=b.ipv6rd||{};d.localaddr=m.localaddr||"";d.replay_addr=m["replay-addr"];h=m.ip6prefix&&m.ip6prefix.split("/")||["",""];d.ipv6={prefix:h[0],length:void 0!==h[1]?""===h[1]?"":parseInt(h[1],10):""};d.config_mode=m["config-mode"]||a.model.schema.configModeList[0].id;d.ip4prefixlen=void 0!==m.ip4prefixlen?""===m.ip4prefixlen?"":parseInt(m.ip4prefixlen,10):"";d.local_interface_is_dhcp||
(d.config_mode=a.model.schema.configModeList[0].id);d.localaddr=l.localaddr||"";d.peeraddr=l.peeraddr||"";h=l.localipv6prefix&&l.localipv6prefix.split("/")||["",""];d.localIpv6={ip:l.localv6addr||"",length:void 0!==h[1]?""===h[1]?"":parseInt(h[1],10):""};h=l.remoteipv6prefix&&l.remoteipv6prefix.split("/")||["",""];d.peerIpv6={ip:l.peer6addr||"",length:void 0!==h[1]?""===h[1]?"":parseInt(h[1],10):""};m["local-interface"]&&(d.local_interface=m["local-interface"]);l["local-interface"]&&(d.local_interface=
l["local-interface"]);d.action=[{cbk:a.funs.edit,className:"icon-edit",displayName:a.DICT("IPv6_Transition_Edit"),disabled:!1}];d.orig=angular.copy(d);return d},r=function(){q.init();v.all([h(),l(),n.get_wan_state()]).then(function(b){a.model.intfs_state=b[2];u(b[0].data&&b[0].data.result);p(b[1].data&&b[1].data.result);a.dataReady=!0})},d=function(){q.init();v.all([l()]).then(function(a){p(a[0].data&&a[0].data.result)})};a.hasErrCfg=!1;a.nameIsTheSameIdx=-1;a.model={intfs_state:[],intfs:[],tuns:[],
editTun:{},editIdx:-1};a.gridTunnelOptions=app.uiGrid.generateGridOptions({data:a.model.tuns,columnDefs:[{field:"index",width:130,displayName:a.DICT("IPv6_Transition_Tunnel_Number")},{field:"description",minWidth:400,displayName:a.DICT("IPv6_Transition_Description")},{field:"local_interface",width:100,displayName:a.DICT("IPv6_Transition_Interface")},{field:"enabled",width:100,displayName:a.DICT("IPv6_Transition_Enabled"),cellTemplate:"UG_table_checkbox_with_inline_edit.html"},{field:"action",width:80,
displayName:a.DICT("IPv6_Transition_Action"),cellTemplate:"UG_table_icons.html"}]});a.funs={chkIPv6Prefix:function(){!1===app.TOOLS.validation.ipv6_chkPrefixLength(a.model.editTun.ipv6.prefix,a.model.editTun.ipv6.length)?(a.form.ip6rd_ip6prefix.$setValidity("range",!1),a.form.ip6rd_ip6length.$setValidity("range",!1)):(a.form.ip6rd_ip6prefix.$setValidity("range",!0),a.form.ip6rd_ip6length.$setValidity("range",!0))},edit:function(b){a.model.editIdx!==b&&(-1!==a.model.editIdx&&(angular.extend(a.model.tuns[a.model.editIdx],
a.model.editTun),a.model.tuns[a.model.editIdx].action[0].disabled=!1),a.model.tuns[b].action[0].disabled=!0,a.model.editIdx=b,a.model.editTun=angular.copy(a.model.tuns[b]),a.model.editTun.edit=!0,c())},save:function(){var c=[],e=[],h=[],l;angular.extend(a.model.tuns[a.model.editIdx],a.model.editTun);a.model.tuns[a.model.editIdx].action[0].disabled=!1;angular.forEach(a.model.tuns,function(a,b){if(a.edit){var d={name:a.name,type:w(a.proto),description:a.description||"",enabled:a.enabled,ipv6:{setting:{"dhcp-pd-enable":!1}}};
a.orig.name!==a.name?(e.push({name:a.orig.name}),h.push(a.orig.name)):a.enabled||h.push(a.name);switch(a.proto){case "ip6in4":d.ipv6inipv4={"local-interface":a.local_interface,peeraddr:a.peeraddr,localv6addr:a.localIpv6.ip,localipv6prefix:app.TOOLS.ipv6.ipAndMask2IpPrefix(a.localIpv6.ip,a.localIpv6.length),remoteipv6prefix:app.TOOLS.ipv6.ipAndMask2IpPrefix(a.peerIpv6.ip,a.peerIpv6.length),peer6addr:a.peerIpv6.ip};break;case "ip6rd":d.ipv6rd={"local-interface":a.local_interface,"replay-addr":a.replay_addr,
ip6prefix:a.ipv6.prefix+"/"+a.ipv6.length,"config-mode":a.config_mode,ip4prefixlen:isNaN(parseInt(a.ip4prefixlen,10))?"":parseInt(a.ip4prefixlen,10)},l=a.local_interface+"_"+a.name,l=l.toLowerCase(),d.ipv6.setting["dhcp-pd-enable"]=!0,d.ipv6.setting["prefix-name"]=l}c.push(d)}});a.model.editIdx=-1;var m=function(){b.post({method:"set_ipv6_transition",params:{interfaces:{"interface":c}},success:function(b){a.success=!0;d()},error:function(a){d()}})};h.length?q.checkBeforeDel(h,function(a){a?e.length?
b.post({method:"del_ipv6_transition",params:{interfaces:{"interface":e}},success:function(a){m()},error:function(a){m()}}):m():r()}):m();a.resetModified()}};var c=function(){var b=a.model.editTun,c="";b&&b.local_interface&&(angular.forEach(a.model.intfs,function(d){d.id===b.local_interface&&(c=d.logical||d.id,b.local_interface_is_dhcp=d.isDHCP,b.local_interface_is_dhcp||(b.config_mode=a.model.schema.configModeList[0].id))}),b.localaddr="-",angular.forEach(a.model.intfs_state,function(a){c===a.name&&
a.ipv4_ip.length&&(b.localaddr=a.ipv4_ip[0].ip)}))};a.change_name=function(){v.all([n.get_wan_state()]).then(function(b){a.model.intfs_state=b[0];c()});a.hasErrCfg=!1;angular.forEach(a.model.tuns,function(b,c){c!==a.model.editIdx&&b.name===a.model.editTun.name&&(a.nameIsTheSameIdx=c,a.hasErrCfg=!0)})};a.countDiff=function(){var b=a.model.editTun.ip4prefixlen||"0",c=0;if(void 0===a.model.editTun.ip4prefixlen||void 0===a.model.editTun.ipv6.length)return!0;c=parseInt(a.model.editTun.ipv6.length||"0",
10)+32-parseInt(b,10);return 64>=c?!0:!1};a.model.schema={configModeList:[{id:"manual",displayName:a.DICT("IPv6_Transition_Manual")},{id:"auto",displayName:a.DICT("IPv6_Transition_Automatically_From_DHCP")}]};r()}]);app.controller("wan_mobile_main",["$scope","MyHttp","$q","UserSession","userAccessRight",function(a,b,s,n,v){var t=0,m=!1,q=app.TOOLS.getVal;a.destroy=!1;a.success=!1;a.jumpToPage=app.TOOLS.jumpToPage;a.email_server_enable=!1;a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();var e=function(){return b.post({url:resource_base+"data/mobile_network.json",method:"get_mobile",error:function(a){w()}})},w=function(b){var c=[],d=0;a.model.mobiles=[];b&&(b.interfaces&&b.interfaces["interface"])&&
(c=b.interfaces["interface"]);angular.forEach(c,function(b,c){b.name.match(/^USB\d+$/)&&(a.model.mobiles.push(l(b,d)),d+=1)})},l=function(b,c){var d=b.mobile||{},e=d["network-setup"]||{},g="demand",k=d["bandwidth-cap"]||{};void 0!==e.keepalive&&(g="keepalive");d={id:c,name:b.name||"USB1",enabled:q(b.enabled,!1),is_hilink:!1,need_username_pw:!0,ipv4_gw:"",ipv6_gw:"",mobile:{conn_type:g,demand:q(e["connect-on-demand"],5),keepalive:q(e.keepalive,30),device_name:d["device-name"]||"",card_status:"disconnected",
card_model:"-",configure_mode:"manual"===e["configure-mode"]?"manual":"auto",service_type_changeable:!0,service_type:d["network-mode-preferred"]||a.model.schema.serviceType[0]&&a.model.schema.serviceType[0].id||"",setup:{sim_pin:e["sim-pin"]?"00000000":"",sim_pin_modify:!1},bandwidth_cap:{enable:q(k.enable,!1),monthly_renew_date:k["monthly-renew-date"]||1,monthly_bandwidth_cap:k["monthly-bandwidth-cap"]||"",trigger_email_exceed:{enable:void 0!==k["trigger-email-exceed"]?!0:!1,bandwidth_threshhold:k["trigger-email-exceed"]&&
k["trigger-email-exceed"]["bandwidth-threshhold"]||a.model.schema.bandwidthThreshold[0]&&a.model.schema.bandwidthThreshold[0].id||"50"}}}};"USB1"===d.name&&!d.mobile.device_name?d.mobile.device_name="/dev/modem1":"USB2"===d.name&&!d.mobile.device_name&&(d.mobile.device_name="/dev/modem2");$.extend(d.mobile.setup,h(e));return d},h=function(a,b){a||(a={});return{service_name:a["service-name"]||"",authentication:a.authentication||"none",maxwait:void 0!==a.maxwait?a.maxwait:b?"":20,access_point_name:a["access-point-name"]||
"",dial_number:a["dial-number"]||"",username:a.username||"",password:a.password||"",orig_password:a.password||""}},p=function(b){b||(b={});var c=[];b.output&&b.output.usbs&&(c=b.output.usbs);a.usbs={USB1:!1,USB2:!1};angular.forEach(c,function(b){var c=b.name;if(c&&!0===b.attached)switch(b["usbs-type"]){case "3g":case "4g":a.usbs[c]=!0}})},u=function(){return b.post({url:resource_base+"data/config_email.json",method:"get_email",error:function(a){x()}})},x=function(b){a.email_server_enable=b["email-server"]&&
b["email-server"]["smtp-server"]?!0:!1},r=function(){return b.post({url:resource_base+"data/usb_modem_state.json",method:"get_usb_modem_state",error:function(a){d()}})},d=function(b){b||(b={});var c=[],d,e,g,k,l;b["usb-modems-state"]&&b["usb-modems-state"]["usb-modem"]&&(c=b["usb-modems-state"]["usb-modem"]);a.model.usb_state={};angular.forEach(c,function(b){switch(b["device-name"]){case "/dev/modem1":d="USB1";break;case "/dev/modem2":d="USB2";break;default:return}e={"4G":!1,"3G":!1};angular.forEach(b["network-mode"],
function(a){e[a]=!0});l=b["card-model"]||"-";g=!1;k=!0;switch(l){case "E3372":g=!0;k=!1;break;case "E8372":k=g=!0}a.model.usb_state[d]={is_hilink:g,need_username_pw:k,device_name:b["device-name"]||"",card_model:l,manufacture:b.manufacture||"",firmware_version:b["firmware-version"]||"",sim_status:b["sim-status"]||"",imsi:b.imsi||"",carrier:b.carrier||"",network_mode:e,signal_strength:b["signal-strength"]||"",card_status:b["card-status"]||"disconnected",auto_setup:h(b["auto-setup"],!0)}})},c=function(a){return b.post({url:resource_base+
"data/wan_setting_state.json",procBackground:a&&a.procBackground||!1,isPolling:a&&a.isPolling||void 0,method:"get_interface_state",error:function(a){Log(ERROR,"getInterfaceState error: "+a.status);k()}})},k=function(b){b||(b={});var c=[],d=[],e,g,h;b["interfaces-state"]&&b["interfaces-state"]["interface"]&&(c=b["interfaces-state"]["interface"]);angular.forEach(a.model.mobiles,function(a){a.ipv4_gw="";a.ipv6_gw=""});a.model.interface_state={};angular.forEach(c,function(b){if((g=b.name)&&g.match(/^USB\d+$/))h=
{has_ipv4_ip:!1,ipv4_gw:"",has_ipv6_ip:!1,ipv6_gw:""},d=[],b.ipv4&&(b.ipv4.gateway&&(h.ipv4_gw=b.ipv4.gateway),b.ipv4.address&&(d=b.ipv4.address)),e=!1,angular.forEach(d,function(a){if(a.ip&&("number"===$.type(a["prefix-length"])||a.netmask))e=!0}),h.has_ipv4_ip=e,d=[],b.ipv6&&(b.ipv6.gateway&&(h.ipv6_gw=b.ipv6.gateway),b.ipv4.address&&(d=b.ipv6.address)),e=!1,angular.forEach(d,function(a){a.ip&&("::"!==a.ip&&"number"===$.type(a["prefix-length"]))&&(e=!0)}),h.has_ipv6_ip=e,a.model.interface_state[g]=
h,angular.forEach(a.model.mobiles,function(a){a.name===g&&(a.ipv4_gw=h.ipv4_gw,a.ipv6_gw=h.ipv6_gw)})})},g=function(){var b="connected",c,d;angular.forEach(a.model.mobiles,function(e){e.mobile.service_type_changeable=!0;e.is_hilink=!1;e.need_username_pw=!0;d=e.name;if(a.model.usb_state[d]){c=a.model.usb_state[d];e.mobile.card_model=c.card_model;c.network_mode["4G"]?(e.mobile.service_type_changeable=!1,e.mobile.service_type=a.model.schema.serviceType[0].id):c.network_mode["3G"]&&(e.mobile.service_type_changeable=
!1,e.mobile.service_type=a.model.schema.serviceType[1].id);e.is_hilink=c.is_hilink;e.need_username_pw=c.need_username_pw;b="disconnected";if(a.model.interface_state[d]&&(a.model.interface_state[d].has_ipv4_ip||a.model.interface_state[d].has_ipv6_ip))b="connected";e.mobile.card_status=b}})},z=function(){a.dataReady=!1;s.all([e(),r(),c(),u(),b.post({method:"action",params:{rpc:"usb-check-attached"}})]).then(function(b){w(b[0]&&b[0].data&&b[0].data.result||{});d(b[1]&&b[1].data&&b[1].data.result||{});
k(b[2]&&b[2].data&&b[2].data.result||{});x(b[3]&&b[3].data&&b[3].data.result||{});p(b[4]&&b[4].data&&b[4].data.result||{});g();a.model.mobiles[a.model.selected]||(a.model.selected=0);a.changeIntf(!0);y();a.dataReady=!0;setTimeout(function(){a.chk_service_type()},100)})},y=function(){0!==t&&clearTimeout(t);!m&&app.TOOLS.get_scope("wan_mobile_main")&&(t=setTimeout(function(){t=0;m=!0;s.all([c({procBackground:!0,isPolling:!0})]).then(function(b){var c=a.edit,d=c.name,e="disconnected";k(b[0]&&b[0].data&&
b[0].data.result||{});if(a.model.interface_state[d]&&(a.model.interface_state[d].has_ipv4_ip||a.model.interface_state[d].has_ipv6_ip))e="connected";c.mobile.card_status=e;m=!1;a.destroy||y()})},1E4))},A=function(c){var d=a.model.mobiles[a.model.selected];!("connect"!==c&&"disconnect"!==c)&&d&&b.post({method:"action",params:{rpc:c,input:{"interface":d.name,"ip-version":"v4"}},success:function(a){z()},error:function(a){z()}})};a.usbs={USB1:!1,USB2:!1};a.model={mobiles:[],schema:{},usb_state:{},selected:0};
a.dataReady=!1;a.funs={save:function(){var c=[];angular.forEach(a.model.mobiles,function(b,d){if(d===a.model.selected){var e=b.mobile,g={name:b.name,enabled:!0,mobile:{"network-mode-preferred":e.service_type,"network-setup":{keepalive:"","connect-on-demand":"","configure-mode":e.configure_mode,"access-point-name":e.setup.access_point_name,"service-name":"4G"===e.service_type?"":e.setup.service_name,authentication:e.setup.authentication,maxwait:e.setup.maxwait,"dial-number":"4G"===e.service_type?"":
e.setup.dial_number,username:e.setup.username},"bandwidth-cap":{enable:e.bandwidth_cap.enable,"monthly-renew-date":e.bandwidth_cap.monthly_renew_date,"monthly-bandwidth-cap":e.bandwidth_cap.monthly_bandwidth_cap,"trigger-email-exceed":{"bandwidth-threshhold":""}}},ipv4:{enabled:!0},ipv6:{enabled:!0}};"keepalive"===e.conn_type&&(g.mobile["network-setup"].keepalive=e.keepalive);"demand"===e.conn_type&&(g.mobile["network-setup"]["connect-on-demand"]=e.demand);e.setup.password!==e.setup.orig_password&&
(g.mobile["network-setup"].password=e.setup.password);e.setup.sim_pin_modify&&(g.mobile["network-setup"]["sim-pin"]=e.setup.sim_pin);e.bandwidth_cap.trigger_email_exceed.enable&&(g.mobile["bandwidth-cap"]["trigger-email-exceed"]={"bandwidth-threshhold":e.bandwidth_cap.trigger_email_exceed.bandwidth_threshhold});c.push(g)}});b.post({method:"set_mobile",params:{interfaces:{"interface":c}},success:function(b){a.success=!0;z();a.resetModified()},error:function(b){z();a.resetModified()}})},cancel:function(){z();
a.model.selected=0;a.resetModified()},changeList:function(){},connect:function(){A("connect")},disconnect:function(){A("disconnect")},oper:function(c){var d=a.model.mobiles[a.model.selected],e=!0;switch(c){case "disconnect":e=!1;break;case "connect":e=!0;break;default:return}b.post({method:"set_mobile",params:{interfaces:{"interface":[{name:d.name,enabled:e}]}},success:function(b){a.success=!0;z()},error:function(a){Log(ERROR,"wan_mobile_main oper action: "+c+" error");z()}})},open_hilink_page:function(){var b=
a.edit;b&&window.open("http://"+b.ipv4_gw)}};a.changeIntf=function(b){a.edit=a.model.mobiles[a.model.selected];var c=a.edit,d;0===a.model.selected?(d=a.model.usb_state.USB1,c.usbattached=a.usbs.USB1):(d=a.model.usb_state.USB2,c.usbattached=a.usbs.USB2);d&&d.is_hilink&&(c.mobile.configure_mode="auto");b||a.chk_service_type();a.chk_authenticate()};a.changeMode=function(){var b=a.edit,c=a.model.usb_state[b.mobile.device_name];if(b){switch(b.mobile.configure_mode){case "auto":b.mobile.setup=c?angular.copy(c.auto_setup):
h({},!0);break;case "manual":b.mobile.setup=h({},!1);break;default:return}$.extend(b.mobile.setup,{sim_pin:"",sim_pin_modify:!0});a.chk_authenticate()}};a.modifySIMPIN=function(){a.edit.mobile.setup.sim_pin_modify=!0};a.chk_service_type=function(){a.form.servicetype.$setValidity("noselect",!0);if(a.edit){var b=!0;angular.forEach(a.model.schema.serviceType,function(c,d){c.id===a.edit.mobile.service_type&&(b=!1)});b&&a.form.servicetype.$setValidity("noselect",!1)}};a.chk_authenticate=function(){var b=
a.edit;b&&"auto"===b.mobile.configure_mode&&(b.mobile.setup.authentication="none")};a.template_config_email_setting=a.DICT("Mobile_Network_Configure_Email_Setting",{"%s1":'<a ng-click="jumpToPage(\'System_Config_Email\')" class="text-underline">'+a.DICT("Mobile_Network_Here")+"</a>"});(function(){var b;a.model.schema={bandwidthThreshold:[],serviceType:[{id:"4G",displayName:a.DICT("Mobile_Network_4G_LTE")},{id:"3G",displayName:a.DICT("Mobile_Network_HSDPA_3G_UMTS")}],authentication:[{id:"none",displayName:a.DICT("Mobile_Network_None")},
{id:"auto",displayName:a.DICT("Mobile_Network_Both")},{id:"PAP",displayName:a.DICT("Mobile_Network_PAP")},{id:"CHAP",displayName:a.DICT("Mobile_Network_CHAP")}],date:[]};for(b=50;100>=b;b+=10)a.model.schema.bandwidthThreshold.push({id:b,displayName:b+""});for(b=1;31>=b;b++)a.model.schema.date.push({id:b,displayName:10>b?"0"+b:b+""})})();a.model.selected=0;a.$on("$destroy",function(){a.destroy=!0});z()}]);app.controller("dynamicDNSCtrl",["$scope","MyHttp","$uibModal","wan_service","$q","UserSession","userAccessRight","wan_lib",function(a,b,s,n,v,t,m,q){a.success=!1;a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var e=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_ddns",error:function(a){l();Log(ERROR,"dynamic_dns error: "+a.status)}})},w=function(){a.model.display=[];angular.forEach(a.model.ddnses,function(b,c){a.model.display.push({provider:b.provider||
"-",hostname:b.hostname||"-",name:b.name||"",update:b.hostname&&(b.reg_time?"Yes":"No")||"-",status:b.status||"-",enable:b.enable?!0:!1})});a.gridDymDNSOptions.data=a.model.display},l=function(b){var c=[],d=[],e;b&&(b.interfaces&&b.interfaces["interface"])&&(c=b.interfaces["interface"]);a.model.ddnses=[];b=n.filter(c,{usb:!0,physical:!0,subinterface:!0});angular.forEach(b,function(a,b){e=p(a);d.push(e)});a.model.ddnses=d.concat([])},h=function(){a.model.schema={providerList:[],providerPeriodically:[{id:30,
displayName:a.DICT("Dynamic_DNS_Every_30mins")},{id:1440,displayName:a.DICT("Dynamic_DNS_Every_Day")},{id:10080,displayName:a.DICT("Dynamic_DNS_Every_Week")},{id:40320,displayName:a.DICT("Dynamic_DNS_Every_Month")}]}},p=function(a){var b=a&&a.ddns||{},c=a.name||"",d=(a.ipv4||{}).setting||{},e="",h="",l="";c||Log(ERROR,"[DDNS][ERR] genDDNS error, no ifname");if(c=c.match(/^(WAN\d+)($|.\d+$)/))e=c[1],h=c[2],angular.forEach(d,function(a,b){switch(b){case "pptp":l=e+"-PPTP"+h;break;case "l2tp":l=e+"-L2TP"+
h;break;case "pppoe":l=e+"-PPPOE"+h;break;case "trasparent-bridge":l=e+"-BRIDGE"+h;break;default:l=""}});"dnsomatic.com"===b.provider&&(b.hostname="");return{name:a.name||"",logicalIfname:l,enable:b.enable||!1,provider:b.provider||"",hostname:b.hostname||"",username:b.username||"",password:b.password?"00000000":"",changed_password:!1,periodic_update_interval:b["periodic-update-interval"]||"",status:"",reg_time:"",periodic:0===b["periodic-update-interval"]?!1:!0}},u=function(b){b||(b={});var c=[],
d,e;b["interfaces-state"]&&b["interfaces-state"]["interface"]&&(c=b["interfaces-state"]["interface"]);angular.forEach(c,function(b,c){d=b.ddns&&b.ddns.status||{};e=b.name;angular.forEach(a.model.ddnses,function(a){if(!(a.logicalIfname&&a.logicalIfname!==e)&&(a.logicalIfname||a.name===e))a.status=d.state||"",a.reg_time=d["registration-time"]||""})})},x=function(b){b||(b={});var c;b.providers&&b.providers.provider&&(c=b.providers.provider[0]||"",c=c.split(" ")||[]);a.model.schema.providerList=[];angular.forEach(c,
function(b){a.model.schema.providerList.push({id:b,displayName:b})})},r=function(){s.open({animation:a.animationsEnabled,templateUrl:"edit_dynamic_dns.htm",controller:"editDynamicDNSCtrl",size:"700",backdrop:"static",resolve:{model:function(){return a.model},edit:function(){return a.edit}}}).result.then(function(b){a.edit=b;a.edit.provider||(a.edit.provider=a.model.schema.providerList[0].id);a.fun.save("edit")},function(a){})},d=function(){var b=a.edit;angular.forEach(a.model.ddnses[a.model.selectIdx],
function(c,d){switch(d){case "update":case "enable":b[d]=c||!1;break;case "status":b[d]=c||"inactive";break;case "provider":b[d]=c||a.model.schema.providerList[0].id;break;case "periodic_update_interval":b[d]=c||a.model.schema.providerPeriodically[0].id;break;case "periodic":b[d]=c||!1;break;default:b[d]=c}})},c=function(){a.dataReady=!1;v.all([b.post({url:resource_base+"data/ddns_provider.json",method:"get_ddns_provider"}),e(),b.post({url:resource_base+"data/ddns_state.json",method:"get_ddns_state"})]).then(function(b){x(b[0]&&
b[0].data&&b[0].data.result||{});l(b[1]&&b[1].data&&b[1].data.result||{});u(b[2]&&b[2].data&&b[2].data.result||{});w();a.model.selectIdx=-1;a.dataReady=!0})};a.dataReady=!1;a.model={display:[],schema:{},ddnses:[],del:[],selectIdx:-1};a.edit={};a.fun={edit:function(){d();r()},refresh:function(){h();c()},save:function(d){var e=a.edit,h={interfaces:{"interface":[]}};"edit"===d&&(d={name:e.name,ddns:{provider:e.provider,hostname:e.hostname,username:e.username,"periodic-update-interval":e.periodic?e.periodic_update_interval:
0,enable:e.enable}},"dnsomatic.com"===e.provider&&(d.ddns.hostname="all.dnsomatic.com"),e.changed_password&&(d.ddns.password=e.password),h.interfaces["interface"].push(d),b.post({method:"set_ddns",forcedUsingPost:!0,params:h,success:function(b){a.success=!0;c();a.resetModified()},error:function(b){a.resetModified()}}))},cancel:function(){c();a.resetModified()}};a.gridDymDNSOptions=app.uiGrid.generateGridOptions({columnDefs:[{name:"radio",isRadio:!0,changedCbk:function(b){a.model.selectIdx=b}},{field:"name",
displayName:a.DICT("Dynamic_DNS_Interface")},{field:"hostname",displayName:a.DICT("Dynamic_DNS_Fully_Qualified_Domain_Name")},{field:"provider",displayName:a.DICT("Dynamic_DNS_Provider")},{field:"update",displayName:a.DICT("Dynamic_DNS_Update")},{field:"status",displayName:a.DICT("Dynamic_DNS_Status")},{field:"enable",displayName:a.DICT("Dynamic_DNS_Enable"),cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});h();c()}]);
app.controller("editDynamicDNSCtrl",["$scope","$uibModalInstance","model","edit","UserSession","userAccessRight",function(a,b,s,n,v,t){a.model=s;a.edit=n;a.repeat_name="";a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();a.change_pwd=function(){a.edit.changed_password=!0};a.chk_valid=function(){var b=a.edit,n=!0;a.repeat_name="";angular.forEach(a.model.ddnses,function(e){if(!(e.name===b.name||!b.enable||!e.enable)&&e.provider===b.provider&&"dnsomatic.com"!==b.provider&&
e.hostname===b.hostname)n=!1,a.repeat_name=e.name});a.ddnseditform.ddns_provider.$setValidity("repeat",n);a.ddnseditform.ddns_fqdn&&a.ddnseditform.ddns_fqdn.$setValidity("repeat",n);a.template_note=a.DICT("Dynamic_DNS_Repeat_Name_Warning",{"%s0":"<b>"+a.DICT("Dynamic_DNS_Provider")+"</b>","%s1":"<b>"+a.DICT("Dynamic_DNS_Fully_Qualified_Domain_Name")+"</b>","%s2":"<b>"+a.repeat_name+"</b>"})};a.fun={save:function(){b.close(a.edit);a.resetModified()},cancel:function(){b.dismiss("cancel");a.resetModified()}};
a.template_note=a.DICT("Dynamic_DNS_Repeat_Name_Warning",{"%s0":"<b>"+a.DICT("Dynamic_DNS_Provider")+"</b>","%s1":"<b>"+a.DICT("Dynamic_DNS_Fully_Qualified_Domain_Name")+"</b>","%s2":"<b>"+a.repeat_name+"</b>"})}]);app.controller("hardwareDMZCtrl",["$scope","MyHttp","UserSession","userAccessRight","intf_service","modelInfo","$templateCache","subnet_lib","ipv4_lib","$q",function(a,b,s,n,v,t,m,q,e,w){var l=app.TOOLS.getResponse;a.ctx=a.ctx||{};a.ctx.HWDMZport=t.get_HWDMZport()||"LAN4";a.success=!1;a.userAccessFlag=n.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&s.logout();var h=function(b){b||(b={});b=(b.subnets||{}).ipv4||[];a.model.remain_subnets=[];a.model.lan_subnets=[];angular.forEach(b,function(b){b.name&&
b.name.match(/VLAN\d+/)?a.model.lan_subnets.push(b):a.model.remain_subnets.push(b)})},p=function(){return b.post({url:resource_base+"data/hardware_dmz.json",method:"get_dmz",error:function(a){console.log("hardwareDMZCtrl getHardwareDMZData error : "+a.status);u()}})},u=function(b){b||(b={});var d={},c=[];angular.forEach(b.interfaces&&b.interfaces["interface"]||[],function(b){b.name&&b.name.match("^"+a.ctx.HWDMZport+"$")&&(d=b.dmz||{})});a.model.dmz={enable:void 0!==d.enable?d.enable:!1,type:void 0!==
d.range?"range":"subnet",dmz_ip:d["dmz-ip"]||"",netmask:"",start:d.range&&d.range.start||"",end:d.range&&d.range.end||""};d.netmask&&(c=d.netmask.split("/"),2===c.length&&(a.model.dmz.netmask=app.TOOLS.netmask.int2Inet(parseInt(c[1],10))));a.checkIpAndSubnet();a.checkRange()},x=function(){v.init();w.all([p(),b.post({url:resource_base+"data/aaa.json",method:"get_subnet"})]).then(function(b){u(l(b,0));h(l(b,1));a.dataReady=!0})};a.model={dmz:{},remain_subnets:[],lan_subnets:[]};a.ui_data={range_errstr:"",
subnet_errstr:"",dmz_msg:a.DICT("Hardware_DMZ_Msg",{"%s":a.ctx.HWDMZport})};a.dataReady=!1;a.$watch(function(){return a.model.dmz.type},function(b,d){a.checkIpAndSubnet();a.checkRange()});a.checkIpAndSubnet=function(b){var d=a.model.dmz,c,h,g;b=function(b,c){a.hddmz_form.hddmz_ip.$setValidity(b,c);a.hddmz_form.hddmz_netmask.$setValidity(b,c)};if(a.hddmz_form&&(a.hddmz_form.hddmz_ip&&a.hddmz_form.hddmz_netmask)&&(b("overlap",!0),d.enable&&!("subnet"!==d.type||!d.dmz_ip||!d.netmask)))h=app.TOOLS.netmask.inet2Int(d.netmask),
c=e.get_first_ip(d.dmz_ip,h).toString(),d=e.get_last_ip(d.dmz_ip,h).toString(),c=q.check_ipv4_range_is_overlap_with_entity({start:c,end:d},a.model.lan_subnets),c.is_overlap&&(b("overlap",!1),g="",angular.forEach(c.overlap_subnet,function(a){g&&(g+=", ");g+=a.name}),a.ui_data.subnet_errstr=g?a.DICT("Hardware_DMZ_Subnet_Is_Overlap",{"%s":g}):"")};a.checkRange=function(){var b=a.model.dmz,d,c,e,g,h=function(b,c){a.hddmz_form.hddmz_end.$setValidity(b,c);a.hddmz_form.hddmz_start.$setValidity(b,c)};a.ui_data.range_errstr=
"";a.ui_data.subnet_errstr="";if(a.hddmz_form&&(a.hddmz_form.hddmz_start&&a.hddmz_form.hddmz_end)&&(h("overlap",!0),h("out_range",!0),b.enable&&!("range"!==b.type||!b.start||!b.end))){if(b.start!==b.end){d=b.start.split(".");c=b.end.split(".");for(e=0;3>e;e++)if(d[e]!==c[e]){h("out_range",!1);return}if(parseInt(d[3],10)>=parseInt(c[3],10)){h("out_range",!1);return}}res=q.check_ipv4_range_is_overlap_with_entity({start:b.start,end:b.end},a.model.lan_subnets);res.is_overlap&&(h("overlap",!1),g="",angular.forEach(res.overlap_subnet,
function(a){g&&(g+=", ");g+=a.name}),a.ui_data.range_errstr=g?a.DICT("Hardware_DMZ_Range_Is_Overlap",{"%s":g}):"")}};a.updateViewValue=function(b){var d=function(a){b[a].$invalid&&(b[a].$setViewValue(b[a].$modelValue),b[a].$render())};d("hddmz_ip");d("hddmz_netmask");d("hddmz_start");d("hddmz_end");!0===a.model.dmz.enable?app.TOOLS.warningAlertBox({str1:a.DICT("Hardware_DMZ_Msg1",{"%s1":a.ctx.HWDMZport}),templateUrl:"hardwareDmzWarningMsg.html",title:a.DICT("Hardware_DMZ_Warning"),btn_yes_str:a.DICT("Hardware_DMZ_Yes"),
btn_no_str:a.DICT("Hardware_DMZ_No"),cbk:function(b,d){b?(a.checkRange(),a.checkIpAndSubnet()):a.model.dmz.enable=!1}}):(a.checkRange(),a.checkIpAndSubnet())};a.funs={save:function(){var e=a.model.dmz,d={enable:e.enable},c=function(){b.post({method:"set_dmz",params:{interfaces:{"interface":[{name:a.ctx.HWDMZport,dmz:d}]}},success:function(b){a.success=!0;x()},error:function(a){x()}})};switch(e.type){case "subnet":d["dmz-ip"]=e.dmz_ip;d.netmask=app.TOOLS.ipv4.ipAndMask2IpPrefix(e.dmz_ip,e.netmask);
break;case "range":d.range={start:e.start,end:e.end};break;default:console.log("Save funs error, type = "+e.type);return}!1===e.enable?v.checkBeforeDel(["DMZ"],function(b){b?c():x();a.resetModified()}):(c(),a.resetModified())},cancel:function(){x();a.resetModified()}};x()}]);app.controller("dualWANCtrl",["$scope","MyHttp","wan_service","$q","$templateCache","UserSession","userAccessRight","wan_lib",function(a,b,s,n,v,t,m,q){a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var e=function(){return b.post({url:resource_base+"data/wan_setting1.json",method:"get_dual_wan",error:function(a){w();h();Log(ERROR,"dualWANCtrl getDualWanData error: "+a.status)}})},w=function(b){var c=[],d=[],e=[],g,h;a.model.ifs=[];a.model.noDWIntfList=[];b&&
(b.interfaces&&b.interfaces["interface"])&&(c=q.filter_available_interfaces(b.interfaces["interface"]),angular.forEach(c,function(b,c){if(b.name){h=b["redundant-wan"]||{};g=l(b);"WAN1"===b.name&&(a.model.weight_type=void 0!==h.weight?"percentage":"bandwidth",a.model.orig_weight_type=a.model.weight_type);if(b.name.match(/^WAN\d+/)){if(!1===g.enable){a.model.noDWIntfList.push(b.name);return}d.push(g)}b.name.match(/^USB\d+/)&&(!1===g.enable?a.model.noDWIntfList.push(b.name):e.push(g))}}),a.model.ifs=
d.concat(e),a.model.ifs.sort(function(a,b){return a.precedence-b.precedence}),a.model.origIfs=angular.copy(a.model.ifs),a.gridLoadBalanceOptions.data=a.model.ifs,a.initIntfWeightStatus(),B(),setTimeout(function(){E()},500))},l=function(a){a||(a={});var b=a["redundant-wan"]||{},c=b["net-tracker"]||{},d=c.target&&c.target[0]||{};a={"interface":{select:a.name||"",list:[{id:a.name||"",displayName:a.name||""}]},enable:void 0!==b.enable?b.enable:!0,editIntfName:!1,checked:!1,isDisable:!1,precedence:b.precedence||
1,old_precedence:b.precedence||1,weight:{percentage:b.weight||100,bandwidth:b.bandwidth||100},net_tracker:{enable:void 0!==c.enable?c.enable:!0,target:{detectDestSelect:"gateway",count:d.count||3,interval:d.interval||10,timeout:d.timeout||5,remote_host:"",dns_lookup_host:""}}};a.weight.old_percentage=a.weight.percentage;a.weight.old_bandwidth=a.weight.bandwidth;"dns-query"===d.type?(a.net_tracker.target.detectDestSelect="dns",a.net_tracker.target.dns_lookup_host=d.host||""):"gateway"===d.host?a.net_tracker.target.detectDestSelect=
"gateway":d.host&&(a.net_tracker.target.detectDestSelect="host",a.net_tracker.target.remote_host=d.host||"");return a},h=function(b){b||(b={});var c=[],d=[],e=[];b&&(b.interfaces&&b.interfaces["interface"])&&(c=q.filter_available_interfaces(b.interfaces["interface"]));a.model.outgoingIfs=[];angular.forEach(c,function(a,b){a.name&&(a.name.match(/^WAN\d+($|\.\d+$)/)&&d.push({id:a.name,displayName:a.name}),a.name.match(/^USB\d+($|\.\d+$)/)&&e.push({id:a.name,displayName:a.name}))});a.model.outgoingIfs=
d.concat(e)},p=function(){return b.post({url:resource_base+"data/services.json",method:"get_services",error:function(a){u();Log(ERROR,"dualWANCtrl getServices Error: "+a.status)}})},u=function(b){var c=[];a.model.services=[];b&&(b.services&&b.services.service)&&(c=b.services.service);angular.forEach(c,function(b,c){var d=b.name+"("+b.protocol,d=b.port_range?d+"/"+b.port_range.start+"-"+b.port_range.end+")":b.ip_type?d+"/"+b.ip_type+")":b.icmp_type?d+"/"+b.icmp_type+")":d+")";a.model.services.push({id:b.name,
displayName:d})})},x=function(){return b.post({url:resource_base+"data/policy_routing.json",method:"get_policy_routing",error:function(a){Log(ERROR,"dualWANCtrl getPolicys Error: "+a.status);d()}})},r=function(b,c){var d=b["source-ip-address"]||"",e=b["destination-ip-address"]||"";"any"===d&&(d="Any");"any"===e&&(e="Any");d={name:b.name||"rule"+(parseInt(c,10)+1),checked:!1,disableChkBox:!1,priority:c+1,idx:c,source_ip:d,dest_ip:e,outgoing_if:{select:b["interface"]||a.model.outgoingIfs[0]&&a.model.outgoingIfs[0].id||
"",list:a.model.outgoingIfs},failover:{select:void 0!==b.failover?b.failover:!0,list:a.schema.policyFail,disabled:!1},enable:void 0!==b.enable?b.enable:!0,services:{select:b.service||a.model.services[0]&&a.model.services[0].id||"",list:a.model.services},edit:!1};I({entity:d});return d},d=function(b){var c=[];b=b&&b["policy-routing"]||{};a.model.policys=[];z={"policy-routing":{entry:[]}};b.entry&&(c=b.entry);a.model.policy_basic_route=!1;void 0!==b.enable&&(a.model.policy_basic_route=b.enable);angular.forEach(c,
function(b,c){a.model.policys.push(r(b,c));z["policy-routing"].entry.push({name:b.name})});a.gridPolicyOptions.data=a.model.policys;C()};(function(){return{get:function(b){var c=void 0;angular.forEach(a.model.services,function(a,d){c||a.id===b&&(c=a)});return c}}})();s=function(b){b=a.model.policys;var c=b.length,d;for(d=a.model.policySelCnt=0;d<c;d++)b[d].checked?a.model.policySelCnt+=1:b[d].edit=!1};var c=function(b){var c=a.model.ifs,d={},e=[],g=0,h,k=!1;a.disable_add_dual=!1;a.disable_del_dual=
!0;a.disable_adv_dual=!0;angular.forEach(c,function(a){d[a["interface"].select]=!0;a.checked&&(g+=1);a.checked&&a["interface"].select.match(/^(WAN1|WAN2|USB\d+)$/)&&(k=!0)});angular.forEach(a.model.noDWIntfList,function(a){d[a]||e.push({id:a,displayName:a})});e.length||(a.disable_add_dual=!0);b&&b.entity&&(h=b.entity);angular.forEach(c,function(a){a.editIntfName&&(h&&h["interface"]&&a["interface"].select===h["interface"].select&&(a["interface"].select.match(/^USB\d+$/)?a.net_tracker.enable=!1:a.net_tracker.enable=
!0),a["interface"].list=[{id:a["interface"].select,displayName:a["interface"].select}].concat(e))});1===g&&(a.disable_adv_dual=!1);0<g&&(2<=a.model.ifs.length-g&&!k)&&(a.disable_del_dual=!1)},k={main:"dualWan_loadBalance.html",advanced:"dualWan_advanced.html"},g=function(b){a.currPage===b?Log(INFO,"changePage current page is the same, do nothing"):k[b]?a.currPage=k[b]:Log(INFO,"changePage don't have this page\""+b+'", do nothing')};a.selectIdx=-1;a.balanceErr=!1;a.success=!1;a.currPage="dualWan_loadBalance.html";
a.schema={};a.model={ifs:[],outgoingIfs:[],services:[],policys:[],policySelCnt:0,advItem:{},origItem:{},delItems:[],noDWIntfList:[],policy_basic_route:!1,weight_type:"percentage"};var z={},y=function(){a.dataReady=!1;n.all([e(),x()]).then(function(b){w(b[0].data&&b[0].data.result||{});h(b[0].data&&b[0].data.result||{});d(b[1].data&&b[1].data.result||{});c();a.dataReady=!0});a.modify_policy=!1;a.model.policySelCnt=0},A=function(b,c){var d=b.net_tracker.target,e={enable:b.enable,precedence:b.precedence};
"percentage"===a.model.weight_type?e.weight=b.weight.percentage:e.bandwidth=b.weight.bandwidth;if(c){e["net-tracker"]={enable:b.net_tracker.enable,target:[{host:"",type:"icmp-echo",count:d.count,timeout:d.timeout}]};switch(d.detectDestSelect){case "gateway":e["net-tracker"].target[0].host="gateway";break;case "host":e["net-tracker"].target[0].host=d.remote_host;break;case "dns":e["net-tracker"].target[0].host=d.dns_lookup_host,e["net-tracker"].target[0].type="dns-query"}e["net-tracker"].target[0].host||
delete e["net-tracker"].target}return e},B=function(){a.intfStyle=app.ngGrid.computeHeight(a.model.ifs.length)},C=function(){a.policyStyle=app.ngGrid.computeHeight(a.model.policys.length)},D=function(){return 100<=a.model.policys.length?(a.msg=a.DICT("Multi_WAN_Msg")+a.model.policys.length+")",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1};a.intfStyle={};a.policy={};a.dataReady=!1;a.modify_policy=!1;a.disable_add_dual=!1;a.disable_del_dual=!0;a.disable_adv_dual=!0;a.gridCpuHeight=
function(){return app.uiGrid.computeHeight(a.gridLoadBalanceOptions)};a.funs={addDualWan:function(){var b={},d={},e,g,h=a.model.noDWIntfList,k=99,m;angular.forEach(a.model.ifs,function(a){b[a.precedence]=!0;d[a["interface"].select]=!0});for(e=1;100>=e;e++)if(!b[e]){k=e;break}m=l();g=h.length;for(e=0;e<g;e++)if(!d[h[e]]){m["interface"].select=h[e];break}m.editIntfName=!0;m.checked=!0;m.isDisable=!0;m.precedence=k;m.old_precedence=k;a.model.ifs.push(m);E();c({entity:m});B();setTimeout(function(){a.gridLoadBalanceOptions.gridApi.core.scrollTo(a.gridLoadBalanceOptions.data[a.gridLoadBalanceOptions.data.length-
1],a.gridLoadBalanceOptions.columnDefs[1])},50);a.modified()},delDualWan:function(){var b,d=a.model.ifs;for(b=d.length-1;0<=b;b--)d[b].checked&&(exist=!1,angular.forEach(a.model.noDWIntfList,function(a){d[b]["interface"].select===a&&(exist=!0)}),exist||a.model.noDWIntfList.push(d[b]["interface"].select),d.splice(b,1));for(b=d.length-1;0<=b;b--)a.checkIntfWeightStatus({entity:d[b]},!0);E();c();B();a.modified()},save:function(c){var d=!1,e,h=[],k=[],l=a.model.advItem;angular.forEach(a.model.origIfs,
function(b){d=!0;angular.forEach(a.model.ifs,function(a){a["interface"].select===b["interface"].select&&(d=!1)});!0===d&&h.push({name:b["interface"].select,"redundant-wan":{enable:!1}})});angular.forEach(a.model.ifs,function(a){e={name:a["interface"].select};e["redundant-wan"]="advanced"===c&&l["interface"].select===a["interface"].select?A(l,!0):A(a,!1);h.push(e)});policy_routing={enable:a.model.policy_basic_route};a.modify_policy&&(angular.forEach(a.model.policys,function(a,b){a.priority=b+1;k.push({name:"rule"+
parseInt(b+1,10),"source-ip-address":"Any"===a.source_ip?"any":a.source_ip,"destination-ip-address":"Any"===a.dest_ip?"any":a.dest_ip,service:a.services.select,"interface":a.outgoing_if.select,failover:a.failover.select,enable:a.enable})}),policy_routing.entry=k);b.post({method:"set_dual_wan",params:{interfaces:{"interface":h},"policy-routing":policy_routing},success:function(b){a.success=!0;y();g("main");a.resetModified()},error:function(b){y();g("main");a.resetModified()}})},cancel:function(b){"advanced"===
b?g("main"):y();a.resetModified()},edit:function(){if(!(0>=a.model.policySelCnt)){var b=a.model.policys,c=a.model.oriPolicy,d=b.length,e,g;for(e=0;e<d;e++)g=b[e],g.checked&&(g.edit=!0,c&&c[e]&&(g.priority=c[e].priority));c||(a.model.oriPolicy=angular.copy(a.model.policys));a.modify_policy=!0}},del:function(){var b=a.model.policys,c;for(c=a.model.policys.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);angular.forEach(a.model.policys,function(a,b){a.priority=b+1});C();a.modify_policy=!0;a.model.oriPolicy=
void 0;a.modified()},add:function(){if(!D()){var b=r({},a.model.policys.length);b.checked=!0;b.edit=!0;b.disableChkBox=!0;a.modify_policy=!0;a.model.policys.push(b);a.model.policySelCnt+=1;setTimeout(function(){a.gridPolicyOptions.gridApi.core.scrollTo(a.gridPolicyOptions.data[a.gridPolicyOptions.data.length-1],a.gridPolicyOptions.columnDefs[1])},50);angular.forEach(a.model.policys,function(b,c){a.model.oriPolicy&&a.model.oriPolicy[c]&&(b.priority=a.model.oriPolicy[c].priority)});C();a.modified()}},
adv:function(){var b;angular.forEach(a.model.policys,function(a,b){a.edit=!1});angular.forEach(a.model.ifs,function(a){a.checked&&(b=a)});a.model.advItem=angular.copy(b);a.model.origItem=angular.copy(b);g("advanced")}};a.initIntfWeightStatus=function(){var b=0,c,d,e={};angular.forEach(a.model.ifs,function(g){b=0;angular.forEach(a.model.ifs,function(a,c){g["interface"].select!==a["interface"].select&&g.precedence===a.precedence&&(b+=1)});0===b?(g.isDisable=!0,"bandwidth"===a.model.weight_type&&(g.weight.percentage=
100)):(d=0,b+=1,e[g.precedence]||(e[g.precedence]=!0,d=100%b),g.isDisable=!1,c=100-100%b,"bandwidth"===a.model.weight_type&&(g.weight.percentage=c/b+d))})};a.checkIntfWeightStatus=function(b,c){var d=b.entity.precedence,e=b.entity.old_precedence,g=[],h=[],k,l=!1,m,n=0,p=0,q=!1;if(d===e&&(p=0,angular.forEach(a.model.ifs,function(a){a.precedence===d&&(n+=a.weight.percentage,p+=1)}),angular.forEach(a.model.ifs,function(a){a.precedence===d&&(100===n||1===p?a.isErr=!1:(a.isErr=!0,a.errTxt="Precedence "+
d+". Summary of weight should be 100"))}),angular.forEach(a.model.ifs,function(a){!0===a.isErr&&(q=!0)}),a.balanceErr=q,!c))return;angular.forEach(a.model.ifs,function(a,c){a["interface"].select===b.entity["interface"].select?b.entity.old_precedence===b.entity.precedence&&h.push(c):(a.precedence===d&&(a.isErr=!1,g.push(c)),a.old_precedence===e&&(a.isErr=!1,h.push(c)))});k=h.length;1===k?(a.model.ifs[h[0]].isDisable=!0,a.model.ifs[h[0]].weight.percentage=100,a.model.ifs[h[0]].weight.bandwidth=100,
a.model.ifs[h[0]].isErr=!1):1<k&&(m=(100-100%k)/k,angular.forEach(h,function(b){a.model.ifs[b].isDisable=!1;a.model.ifs[b].weight.percentage=m;a.model.ifs[b].isErr=!1}));k=g.length+1;1===k?(b.entity.isDisable=!0,b.entity.weight.percentage=100,b.entity.weight.bandwidth=100):1<k&&(m=(100-100%k)/k,b.entity.isDisable=!1,b.entity.weight.percentage=m+100%k,angular.forEach(g,function(b){a.model.ifs[b].isDisable=!1;a.model.ifs[b].weight.percentage=m;a.model.ifs[b].isErr=!1}));b.entity.isErr=!1;b.entity.old_precedence=
b.entity.precedence;angular.forEach(a.model.ifs,function(a){!0===a.isErr&&(l=!0)});a.balanceErr=l};a.selectall=!1;var E=function(){a.gridLoadBalanceOptions.$gridScope&&a.gridLoadBalanceOptions.$gridScope.columns&&(a.gridLoadBalanceOptions.$gridScope.columns[2].colDef.max=a.model.ifs.length)};a.gridLoadBalanceOptions=app.uiGrid.generateGridOptions({data:a.model.ifs,columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:function(a){c()}},{field:"interface",width:100,displayName:a.DICT("Multi_WAN_Interface"),
change:c,minWidth:100,editRow:"editIntfName",cellTemplate:"UG_table_text_with_inline_select_edit.html"},{field:"precedence",displayName:a.DICT("Multi_WAN_Precedence"),change:a.checkIntfWeightStatus,min:1,max:99,ngStyle:{width:"50px"},width:210,required:!0,cellTemplate:"UGDualWanLoadBalanceInlineText.html"},{field:"weight",displayName:a.DICT("Multi_WAN_Weight"),disableRow:"isDisable",change:a.checkIntfWeightStatus,min:1,max:100,ngStyle:{width:"50px"},hasErrorTxt:!0,minWidth:600,cellTemplate:"UGDualWanLoadBalanceWeight.html",
headerCellTemplate:"UGDualWanLoadBalanceHeader.html"}]});var I=function(a){a=a.entity||{};a.failover.disabled=!1;a.outgoing_if.select.match(/WAN\d+.\d+$/)&&(a.failover.select=!1,a.failover.disabled=!0)},F=[],H={};a.policyCbk=function(b){if(!b)return!0;var c=!0,d=[],e=[],g=a.model.policys,h=g.length,k,l,m=!0,n=!0,p,q;"delete_row"===b.type&&(m=!1);var r=function(a,b,m){if(!(0>b||b>h))if(!(0>m||m>h)){var r=a.source_ip,s=a.dest_ip;if(r&&s){r=r.toLowerCase();s=s.toLowerCase();n=!0;q=void 0;p=r+"_"+s+"_"+
a.services.select;F[m]&&(q=F[m].id,q!==p&&H[q]&&(H[q].cnts--,delete F[m]));for(k=b;k<h;k++)if((l=g[k])&&l.name!==a.name&&l.source_ip&&l.dest_ip&&l.source_ip.toLowerCase()===r&&l.dest_ip.toLowerCase()===s&&l.services.select===a.services.select)F[k]||(F[k]={id:p},void 0===H[p]&&(H[p]={cnts:0}),H[p].cnts++,d.push(k)),n=c=!1;a&&(n?F[m]&&(e.push(m),a=F[m].id,delete F[m],H[a]&&0>=H[a].cnts&&delete H[a]):F[m]||(F[m]={id:p},void 0===H[p]&&(H[p]={cnts:0}),H[p].cnts++,d.push(m)));for(k=b;k<h;k++)F[k]&&(a=F[k].id,
H[a]&&1>=H[a].cnts&&(e.push(k),delete F[k],delete H[a]))}}};if(m){if(!b.row)return!0;r(b.row.entity,0,b.row.rowIndex)}else{b=angular.copy(F);angular.copy(H);F=[];H={};for(m=0;m<h;m++)g[m]&&r(g[m],m+1,m);d=[];e=[];for(m=0;m<h;m++)b[m]&&!F[m]&&e.push(m),!b[m]&&F[m]&&d.push(m)}return{result:c,invalidRows:d,validRows:e}};a.gridInvalidCbk=function(a){a.row.entity.disableChkBox=a.rowInvalid};a.gridPolicyOptions=app.uiGrid.generateGridOptions({data:a.model.policys,columnDefs:[{field:"checked",isCheckbox:!0,
changedCbk:s,headerChangedCbk:s},{field:"priority",displayName:a.DICT("Multi_WAN_Priority"),editRow:"edit",width:80,changed:function(b,c){var d=b.entity.priority,e=b.entity.idx,g=angular.copy(a.model.policys),h=g.length,k,d=parseInt(d,10);if(isNaN(d))Log(INFO,"changePriority: priority is not a number");else{d-=1;0>d&&(Log(INFO,"changePriority: priority is out of the range (1~"+h+"), current priority is "+d+1),d=0);d>=h&&(Log(INFO,"changePriority: priority is out of the range (1~"+h+"), current priority is "+
d+1),d=h-1);k=g[e];g.splice(e,1);g.splice(d,0,k);a.model.policys=[];for(e=0;e<h;e++)g[e].priority=e+1,g[e].idx=e,a.model.policys.push(g[e]);setTimeout(function(){var a=document.getElementById("txt_priority_"+d);a?a.focus():Log(ERROR,"element txt_priority_"+d+" is not exist")},100)}},id:"priority",cellTemplate:"UG_table_text_with_inline_edit.html"},{field:"source_ip",displayName:a.DICT("Multi_WAN_Source_IP"),editRow:"edit",placeholder:"10.2.3.0/24 or Any",customVldGroup:"1",required:!0,validationCbk:"gridInvalidCbk",
cellTemplate:v.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-prefix extansion-or-reg=\"^Any$|^any$\" custom-vld custom-vld-cbk='policyCbk'")},{field:"dest_ip",displayName:a.DICT("Multi_WAN_Destination_IP"),editRow:"edit",placeholder:"10.2.3.0/24 or Any",customVldGroup:"1",required:!0,validationCbk:"gridInvalidCbk",cellTemplate:v.get("UG_table_text_with_inline_edit.html").replace(/data-ng-expansion/,"ipv4-prefix extansion-or-reg=\"^Any$|^any$\" custom-vld custom-vld-cbk='policyCbk'")},
{field:"services",displayName:a.DICT("Multi_WAN_Services"),editRow:"edit",customVldGroup:"1",cellTemplate:v.get("UG_table_text_with_inline_select_edit.html").replace(/data-ng-expansion/,"custom-vld custom-vld-cbk='policyCbk'")},{field:"outgoing_if",displayName:a.DICT("Multi_WAN_Outgoing_Interface"),editRow:"edit",change:I,cellTemplate:"UG_table_text_with_inline_select_edit.html",width:150},{field:"failover",displayName:a.DICT("Multi_WAN_Failover_Backup_WAN"),editRow:"edit",cellTemplate:"UG_table_text_with_inline_select_edit.html",
width:185},{field:"enable",displayName:a.DICT("Multi_WAN_Status"),width:70,editRow:"edit",cellTemplate:"UG_table_checkbox_with_inline_edit.html"}]});B();C();a.schema.onFail=[{id:"failover",displayName:a.DICT("Multi_WAN_Generate_System_Log_Remove")},{id:"log",displayName:a.DICT("Multi_WAN_Generate_System_Log")}];a.schema.policyFail=[{id:!0,displayName:a.DICT("Multi_WAN_On")},{id:!1,displayName:a.DICT("Multi_WAN_Off")}];(function(){a.dataReady=!1;n.all([e(),p(),x()]).then(function(b){w(b[0].data&&b[0].data.result||
{});h(b[0].data&&b[0].data.result||{});u(b[1].data&&b[1].data.result||{});d(b[2].data&&b[2].data.result||{});c();a.dataReady=!0});a.modify_policy=!1;a.model.policySelCnt=0})()}]);app.controller("WANSettingCtrl",["$scope","MyHttp","$uibModal","$q","wan_lib","UserSession","userAccessRight","intf_service",function(a,b,s,n,v,t,m,q){var e=0,w=10,l=!0,h=app.TOOLS.getResponse;a.success=!1;a.dataReady=!1;a.subnetObj={};a.reptIntf="";var p=app.TOOLS.computeWidth;a.ruFlag=m.russia();a.userAccessFlag=m.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&t.logout();var u=function(){var b={},c={dynamic:{id:"dynamic",displayName:a.DICT("WAN_Settings_DHCP"),origin:"dhcp",type:"ethernetCsmacd"},
"static":{id:"static",displayName:a.DICT("WAN_Settings_Static_IP"),origin:"static",type:"ethernetCsmacd"},pppoe:{id:"pppoe",displayName:a.DICT("WAN_Settings_PPPoE"),origin:"other",type:"pppoe"},pptp:{id:"pptp",displayName:a.DICT("WAN_Settings_PPTP"),origin:"other",type:"pptp"},l2tp:{id:"l2tp",displayName:a.DICT("WAN_Settings_L2TP"),origin:"other",type:"l2tp"},slaac:{id:"slaac",displayName:a.DICT("WAN_Settings_SLAAC"),origin:"link-layer",type:"ethernetCsmacd"},"trasparent-bridge":{id:"trasparent-bridge",
displayName:a.DICT("WAN_Settings_Bridge"),origin:"other",type:"bridge"},disabled:{id:"disabled",displayName:a.DICT("WAN_Settings_Disabled"),origin:"other",type:"disabled"}};b.get=function(a){return c[a]||c.dynamic};return b}(),x={up:"Up",down:"Down",connected:"Connected",testing:"Testing",unknown:"Unknow",dormant:"Dormant","not-present":"Not-Present","lower-layer-down":"Lower-Layer-Down"},r=function(){var b=function(b){var c=void 0;angular.forEach(a.model.ifs_state,function(a,d){a.name===b&&(c=a)});
return c},c=angular.copy(a.model.display),d=c.length,e,g,h=220,k={},l;a.model.display=[];var m={};l=b("WAN_PORT1");k.WAN1=l&&"Connected"===l.link_status||!1;l=b("WAN_PORT2");k.WAN2=l&&"Connected"===l.link_status||!1;angular.forEach(a.model.ifs,function(n,q){var r={checked:!1,name:n.name,ipv4Type:u.get(n.ipv4.connectType).displayName,ipv4Status:"",ipv4AddrMask:{ipAddrMask:"",list:[],templateUrl:""},ipv6Type:u.get(n.ipv6.connectType).displayName,ipv6Status:"",ipv6AddrMask:{ipAddrMask:"",list:[],templateUrl:""},
empty:""},s=n.name;m=void 0;for(e=0;e<d;e++)if(c[e].name===r.name){r.checked=c[e].checked;break}s&&(m=b(s));m&&(r.ipv4Status=!k[n.intf]||!m.ipv4_ip.length?x.down:x.up,m.ipv4_ip.length?(angular.forEach(m.ipv4_ip,function(a,b){r.ipv4AddrMask.list.push(a.ip+"/"+a.prefix)}),r.ipv4AddrMask.list.length&&(r.ipv4AddrMask.ipAddrMask=r.ipv4AddrMask.list[0]),2<=m.ipv4_ip.length&&(r.ipv4AddrMask.ipAddrMask+=" ...",r.ipv4AddrMask.templateUrl="popover_ip_perfixs.htm")):(r.ipv4AddrMask.list.push("-"),r.ipv4AddrMask.ipAddrMask=
"-"),r.ipv6Status=!k[n.intf]||1>=m.ipv6_ip.length?x.down:x.up,m.ipv6_ip.length?(angular.forEach(m.ipv6_ip,function(a,b){l=a.ip+"/"+a.prefix;r.ipv6AddrMask.list.push(l);g=p(l)+16;h<g&&(h=g)}),r.ipv6AddrMask.list.length&&(r.ipv6AddrMask.ipAddrMask=r.ipv6AddrMask.list[0]),2<=m.ipv6_ip.length&&(r.ipv6AddrMask.ipAddrMask+=" ...",r.ipv6AddrMask.templateUrl="popover_ip_perfixs.htm")):(r.ipv6AddrMask.list.push("-"),r.ipv6AddrMask.ipAddrMask="-"));a.model.display.push(r)});h!==a.gridDualWanOptoins.columnDefs[5]&&
(a.gridDualWanOptoins.columnDefs[5].minWidth=h,setTimeout(function(){a.gridDualWanOptoins.gridApi&&a.gridDualWanOptoins.gridApi.core.notifyDataChange&&a.gridDualWanOptoins.gridApi.core.notifyDataChange("all")},0));I();a.gridDualWanOptoins.data=a.model.display},d=function(b){a.edit={};a.edit=angular.copy(b);a.edit.ipv4.connectTypeList=new app.RadioList({radioList:{data:a.model.schema.ipv4ConnectType,style:"width: 100px"},selected:b.ipv4.connectType,provious_selected:b.ipv4.connectType,title:{str:a.DICT("connection_type"),
style:"width: 195px"}});a.edit.ipv6.connectTypeList=new app.RadioList({radioList:{data:a.model.schema.ipv6ConnectType,style:"width: 100px"},selected:b.ipv6.connectType,provious_selected:b.ipv6.connectType,title:{str:a.DICT("connection_type"),style:"width: 195px"}});"dhcp"!==a.edit.ipv4.physical&&"static"!==a.edit.ipv4.physical&&(a.edit.ipv4.physical="dhcp");a.model.opendns&&(a.edit.ipv4.setting.orig_naming_server=angular.copy(a.edit.ipv4.setting.naming_server),a.edit.ipv4.setting.orig_peerdns=angular.forEach(a.edit.ipv4.setting.peerdns),
a.edit.ipv4.setting.peerdns="opendns",a.edit.ipv4.setting.naming_server.servers=["208.67.222.222","208.67.220.220"])},c=function(){return b.post({url:resource_base+"data/aaa.json",method:"get_subnet",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})},k=function(b){b||(b={});var c=b.subnets||{};b=c.ipv4||[];var c=c.ipv6||[],d;a.subnetObj={ipv4:angular.copy(b),ipv6:angular.copy(c)};for(d=b.length-1;0<=d;d--)b[d].name&&b[d].name.match(/^WAN\d+/)&&b.splice(d,1);
for(d=c.length-1;0<=d;d--)c[d].name&&c[d].name.match(/^WAN\d+/)&&c.splice(d,1);a.model.subnets={ipv4:angular.copy(b),ipv6:angular.copy(c)}},g=function(){angular.forEach(a.model.ifs_state,function(b){"WAN1"===b.name?a.model.wan1mac=b.phys_address:"WAN2"===b.name&&(a.model.wan2mac=b.phys_address)})},z=function(){return b.post({url:resource_base+"data/opendns.json",method:"get_opendns",error:function(a){console.log("umbrellaCtrl getOpendnsData error : "+a.status);y()}})},y=function(b){b=b&&b.data&&b.data.result||
{};a.model.opendns=b.opendns&&b.opendns.enabled?!0:!1},A=function(){var b;q.init();n.all([v.init({full_configure:!0}),c(),z()]).then(function(c){b=c[0][0];a.model.orig_vlans=c[0][1];a.model.mac=c[0][2].pc_mac;a.model.is_from_lan=c[0][2].is_from_lan;angular.forEach(b,function(a){a.ipv6.enabled||(a.ipv6.connectType="disabled")});a.model.ifs=b;r();k(h(c,1));y(c[2]);l=!0;E(!0);a.resetModified();a.dataReady=!0})},B=function(){0!==e&&(clearTimeout(e),e=0)},C=!1,D=!1,E=function(b){var c=5E3;if(!C||!l)B(),
app.TOOLS.get_scope("WANSettingCtrl")&&(b&&(c=0),e=setTimeout(function(){C=!0;n.all([v.get_wan_state({background:!0,isPolling:!0})]).then(function(b){C=!1;a.model.ifs_state=b[0];r();g();e=0;l&&10>w&&(w++,D?D=!1:E())})},c))},I=function(){var b=a.model.display,c=b.length,d;a.model.selects=[];for(d=0;d<c;d++)b[d].checked&&a.model.selects.push(d)};a.dataReady=!1;a.gridApi=void 0;a.model={ifs:[],orig_vlans:[],vlans:[],display:[],selects:[],delIfs:[],schema:{},ifs_state:[],addEditIdx:-1,mac:"",dmac:"",
wan1mac:"",wan2mac:"",opendns:!1,subnets:[]};a.gridDualWanOptoins=app.uiGrid.generateGridOptions({data:a.model.display,rowHeight:2*app.uiGrid.rowHeight,onRegisterApi:function(b){a.gridApi=b},columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:function(a,b){I()},headerChangedCbk:function(a){I()}},{field:"name",displayName:a.DICT("WAN_Settings_Name"),minWidth:100},{field:"ipv4AddrMask",minWidth:180,displayName:a.DICT("WAN_Settings_IPv4_Addr_Netmask"),cellTemplate:"UG_wan_settings_ip_perfix1.htm"},
{field:"ipv4Type",width:140,displayName:a.DICT("WAN_Settings_IPv4_Connection")},{field:"ipv4Status",width:110,displayName:a.DICT("WAN_Settings_IPv4_Status")},{field:"ipv6AddrMask",minWidth:220,displayName:a.DICT("WAN_Settings_IPv6_Addr_Prefix_Length"),cellTemplate:"UG_wan_settings_ip_perfix1.htm"},{field:"ipv6Type",width:140,displayName:a.DICT("WAN_Settings_IPv6_Connection")},{field:"ipv6Status",width:100,displayName:a.DICT("WAN_Settings_IPv6_Status")},{field:"empty",isEmpty:!0}]});var F=function(){s.open({animation:a.animationsEnabled,
templateUrl:"wan_settings_add_edit.htm",controller:"WANSettingEditCtrl",size:"wan-setting-edit",backdrop:"static",resolve:{model:function(){return a.model},edit:function(){return a.edit},subnetObj:function(){return a.subnetObj}}}).result.then(function(b){a.edit=b;a.funs.save("addEdit")},function(a){l=!0;E(!0)})},H=function(){var b,c;b=a.edit;-1!==a.model.addEditIdx&&(c=a.model.ifs[a.model.addEditIdx]);a.model.opendns&&(b.ipv4.setting.peerdns=b.ipv4.setting.orig_peerdns,b.ipv4.setting.naming_server=
b.ipv4.setting.orig_naming_server,delete b.ipv4.setting.orig_peerdns,delete b.ipv4.setting.orig_naming_server);b.ipv4.setting.ifname=b.intf;b.ipv6.setting.ifname=b.intf;b.ipv4.connectType=b.ipv4.connectTypeList.selected;"disabled"===b.ipv6.connectTypeList.selected?(b.ipv6.connectType="slaac",b.ipv6.enabled=!1):(b.ipv6.connectType=b.ipv6.connectTypeList.selected,b.ipv6.enabled=!0);delete b.ipv4.connectTypeList;delete b.ipv6.connectTypeList;n.all([v.set_wan_interface({orig:c,edit:b})]).then(function(b){a.success=
!0;w=1;A()})},G=function(){return 18<=(a.model.display.length||0)?(a.msg="Only allow maximum of 16 entries for wan subinterface.",app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}),!0):!1},J=function(){a.model.dmac="WAN1"===a.edit.intf?a.model.wan1mac:a.model.wan2mac};a.funs={add:function(){if(!G()){l=!1;B();var b=v.gen_wan_settings({});b.isCreateSubInterface=!0;b.ipv6.enabled||(b.ipv6.connectType="disabled");d(b);J();L();a.model.addEditIdx=-1;F();a.modified()}},edit:function(){l=!1;B();a.model.addEditIdx=
a.model.selects[0];d(a.model.ifs[a.model.addEditIdx]);J();L();F()},del:function(){var b,c=function(){var b=-1,c=-1;angular.forEach(a.model.selects,function(a,d){c<a&&(c=a,b=d)});a.model.selects.splice(b,1);return c},d,e;for(d=a.model.selects.length-1;0<=d;d--)e=c(),b=a.model.ifs[e],a.model.ifs.splice(e,1),a.model.delIfs.push(b);r();a.modified()},save:function(b){var c=[],d;angular.forEach(a.model.delIfs,function(a){c.push(a.name)});c.length?q.checkBeforeDel(c,function(c){c?n.all([v.delete_wan_interfaces({intfs:a.model.delIfs})]).then(function(c){c[0].data.result&&
c[0].data.result.code?0!==c[0].data.result.code&&(d="<div>"+a.DICT("WAN_Settings_Delete_Warning_Msg")+"</div><div>"+c[0].data.result.errstr+"</div>",app.TOOLS.criticalAlertBox({msg:d})):a.success=!0;a.model.delIfs=[];"addEdit"===b?H():A()}):(a.model.delIfs=[],A())}):"addEdit"===b&&H()},cancel:function(b){a.resetModified()},delDisable:function(){var b=!1;if(0===a.model.selects.length)return!0;angular.forEach(a.model.selects,function(c,d){switch(a.model.ifs[c].name){case "WAN1":case "WAN2":b=!0}});
return b}};var L=function(){var b="",c={};angular.forEach(a.model.ifs,function(a){"trasparent-bridge"===a.ipv4.connectType&&(c[a.ipv4.setting.ifnames]=!0)});"trasparent-bridge"===a.edit.ipv4.connectType&&(b=a.edit.ipv4.setting.ifnames);a.model.vlans=[];angular.forEach(a.model.orig_vlans,function(d){c[d.id]&&d.id!==b||a.model.vlans.push(d)});b||(a.edit.ipv4.setting.ifnames=a.model.vlans.length?a.model.vlans[0].id:void 0)};a.$on("$destroy",function(){D=!0});(function(){a.model.schema={dhcppeerdns:[{id:!0,
displayName:a.DICT("WAN_Settings_Use_DHCP_Provided_DNS_Server")},{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],staticpeerdns:[{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],l2tppeerdns:[{id:!0,displayName:a.DICT("WAN_Settings_Use_L2TP_Provided_DNS_Server")},{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],pptppeerdns:[{id:!0,displayName:a.DICT("WAN_Settings_Use_PPTP_Provided_DNS_Server")},{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],pppoepeerdns:[{id:!0,
displayName:a.DICT("WAN_Settings_Use_PPPoE_Provided_DNS_Server")},{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],bridgepeerdns:[{id:!1,displayName:a.DICT("WAN_Settings_Use_DNS_As_Below")}],opendnspeerdns:[{id:"opendns",displayName:a.DICT("WAN_Settings_Use_Opendns_Provided_DNS_Server")}],auth_type:[{id:"auto",displayName:a.DICT("WAN_Settings_Auto_Negotiation")},{id:"PAP",displayName:a.DICT("WAN_Settings_PAP")},{id:"CHAP",displayName:a.DICT("WAN_Settings_CHAP")},{id:"MSCHAP",displayName:a.DICT("WAN_Settings_MS_CHAP")},
{id:"MSCHAP2",displayName:a.DICT("WAN_Settings_MS_CHAPv2")}],ipAssignList:[{id:"dhcp",displayName:a.DICT("WAN_Settings_DHCP")},{id:"static",displayName:a.DICT("WAN_Settings_Static_IP")}]};var b={ipv4ConnectType:[[{id:"dynamic",displayName:a.DICT("WAN_Settings_DHCP"),objid:"rdo_ipv4_dhcp"}],[{id:"static",displayName:a.DICT("WAN_Settings_Static_IP"),objid:"rdo_ipv4_static"}],[{id:"pppoe",displayName:a.DICT("WAN_Settings_PPPoE"),objid:"rdo_ipv4_pppoe"}],[{id:"trasparent-bridge",displayName:a.DICT("WAN_Settings_Bridge"),
objid:"rdo_ipv4_br"}]],ipv6ConnectType:[[{id:"slaac",displayName:a.DICT("WAN_Settings_SLAAC"),objid:"rdo_ipv6_slaac"}],[{id:"dynamic",displayName:a.DICT("WAN_Settings_DHCP"),objid:"rdo_ipv6_dhcp"}],[{id:"static",displayName:a.DICT("WAN_Settings_Static_IP"),objid:"rdo_ipv6_static"}],[{id:"pppoe",displayName:a.DICT("WAN_Settings_PPPoE"),objid:"rdo_ipv6_pppoe"}],[{id:"disabled",displayName:a.DICT("WAN_Settings_Disabled"),objid:"rdo_ipv4_disabled"}]]},c={ipv4ConnectType:[[{id:"dynamic",displayName:a.DICT("WAN_Settings_DHCP"),
objid:"rdo_ipv4_dhcp"}],[{id:"static",displayName:a.DICT("WAN_Settings_Static_IP"),objid:"rdo_ipv4_static"}],[{id:"pppoe",displayName:a.DICT("WAN_Settings_PPPoE"),objid:"rdo_ipv4_pppoe"}],[{id:"pptp",displayName:a.DICT("WAN_Settings_PPTP"),objid:"rdo_ipv4_pptp"}],[{id:"l2tp",displayName:a.DICT("WAN_Settings_L2TP"),objid:"rdo_ipv4_l2tp"}],[{id:"trasparent-bridge",displayName:a.DICT("WAN_Settings_Bridge"),objid:"rdo_ipv4_br"}]],ipv6ConnectType:[[{id:"slaac",displayName:a.DICT("WAN_Settings_SLAAC"),
objid:"rdo_ipv6_slaac"}],[{id:"dynamic",displayName:a.DICT("WAN_Settings_DHCP"),objid:"rdo_ipv6_dhcp"}],[{id:"static",displayName:a.DICT("WAN_Settings_Static_IP"),objid:"rdo_ipv6_static"}],[{id:"pppoe",displayName:a.DICT("WAN_Settings_PPPoE"),objid:"rdo_ipv6_pppoe"}],[{id:"disabled",displayName:a.DICT("WAN_Settings_Disabled"),objid:"rdo_ipv4_disabled"}]]};a.ruFlag?angular.extend(a.model.schema,b):angular.extend(a.model.schema,c)})();A()}]);
app.controller("WANSettingEditCtrl",["$scope","$uibModalInstance","model","edit","UserSession","userAccessRight","subnetObj","addressPoolValidate","ipv4_lib","ipv6_lib","subnet_lib",function(a,b,s,n,v,t,m,q,e,w,l){a.userAccessFlag=t.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&v.logout();var h={dynamic:1500,"static":1500,slaac:1500,"trasparent-bridge":1500,pppoe:1492,l2tp:1460,pptp:1460},p=function(b){var d,e;b&&(d=h[b.ipv4.connectTypeList.selected],e=h[b.ipv6.connectTypeList.selected],
d="disabled"===b.ipv6.connectTypeList.selected?d:d<=e?d:e,b.mtu>d&&(b.mtu=d),"auto"===b.mtuType&&(b.mtu=d),a.max_mtu=d,a.mtu_note=a.DICT("WAN_Settings_MTU_Note",{"%d1":d,"%d2":d}))},u=function(){var b=a.edit;"pppoe"!==b.ipv4.connectTypeList.selected&&b.ipv6.setting.share_ipv4_pppoe_session&&(b.ipv6.setting.share_ipv4_pppoe_session=!1,b.ipv6.setting.username="",b.ipv6.setting.password="",b.ipv6.setting.changed_password=!0)},x=function(){var b=a.edit,d;if(a.model.opendns&&"ipv4"===a.tabSelect)b.ipv4.setting.peerdns=
"opendns";else{if("ipv4"===a.tabSelect)switch(d=b.ipv4.connectTypeList,d.selected){case "static":case "trasparent-bridge":b.ipv4.setting.peerdns=!1;break;default:switch(d.provious_selected){case "static":case "trasparent-bridge":b.ipv4.setting.peerdns=!0,b.ipv4.setting.naming_server.servers=["",""]}}else switch(d=b.ipv6.connectTypeList,d.selected){case "static":case "slaac":b.ipv6.setting.peerdns=!1;break;default:switch(d.provious_selected){case "static":case "slaac":b.ipv6.setting.peerdns=!0,b.ipv6.setting.naming_server.servers=
["",""]}}d.provious_selected=d.selected}};a.max_mtu=1500;a.model=s;a.edit=n;a.mtu_note="";a.jumpToPage=function(b){app.TOOLS.jumpToPage(b,!1,function(b){b&&a.funs.cancel()})};a.note2=a.DICT("WAN_Settings_Note2",{"%s":"<a ng-click=\"jumpToPage('WAN_Multi_WAN')\">"+a.DICT("WAN_Settings_Multi_WAN")+"</a>"});a.note3=a.DICT("WAN_Settings_Note3",{"%s":"<a ng-click=\"jumpToPage('WAN_Multi_WAN')\">"+a.DICT("WAN_Settings_Multi_WAN")+"</a>"});a.edit.ipv4.connectTypeList.change=function(){p(a.edit);x();u();
setTimeout(function(){a.chkV4GW()},200)};a.edit.ipv6.connectTypeList.change=function(){p(a.edit);x();setTimeout(function(){a.chkIPv6StaticIPGw()},100)};a.tabUrl="wan_settings_ipv4_settings.htm";a.tabSelect="ipv4";a.tabs=[{heading:a.DICT("WAN_Settings_IPv4"),templateUrl:"wan_settings_ipv4_settings.htm",name:"ipv4"},{heading:a.DICT("WAN_Settings_IPv6"),templateUrl:"wan_settings_ipv6_settings.htm",name:"ipv6"},{heading:a.DICT("WAN_Settings_Advanced"),templateUrl:"wan_settings_other_settings.htm",name:"other"}];
""===s.dmac&&setTimeout(function(){a.model.dmac="WAN1"===n.intf?s.wan1mac:s.wan2mac;a.model.dmac||(a.model.dmac="-")},1E3);a.isDefInterface=function(){return a.edit.name.match(/^WAN1$/)||a.edit.name.match(/^WAN2$/)?!0:!1};a.change_pwd=function(b){"ipv4"===b?a.edit.ipv4.setting.changed_password=!0:a.edit.ipv6.setting.changed_password=!0};a.checkEdit=function(){if(a.isDefInterface())a.vlanIdNoRepeat=!0;else{var b=a.edit.vlan_interface_settings.vlan_id,d=a.edit;a.vlanIdNoRepeat=!0;b&&(angular.forEach(a.model.ifs,
function(e,h){h!==a.model.addEditIdx&&(e.vlan_interface_settings.vlan_id===b&&d.intf===e.intf)&&(a.vlanIdNoRepeat=!1)}),a.model.dmac="WAN1"===a.edit.intf?a.model.wan1mac:a.model.wan2mac)}};a.chkAuthType=function(){if(a.edit){var b=a.edit,d=a.model.schema;b.ipv4.setting.mppe?(d.auth_type=[{id:"MSCHAP2",displayName:"MS-CHAPv2"}],b.ipv4.setting.authentication_type=d.auth_type[0].id):d.auth_type=[{id:"auto",displayName:a.DICT("WAN_Settings_Auto_Negotiation")},{id:"PAP",displayName:a.DICT("WAN_Settings_PAP")},
{id:"CHAP",displayName:a.DICT("WAN_Settings_CHAP")},{id:"MSCHAP",displayName:a.DICT("WAN_Settings_MS_CHAP")},{id:"MSCHAP2",displayName:a.DICT("WAN_Settings_MS_CHAPv2")}]}};a.chkPDName=function(){var b=a.edit,d=a.model.addEditIdx,e=!0;angular.forEach(a.model.ifs,function(a,h){h!==d&&a.ipv6.setting.dhcp_pd_enable&&a.ipv6.setting.prefix_name===b.ipv6.setting.prefix_name&&(e=!1)});return e};a.chkV4GW=function(){var b=a.edit,d=b.ipv4.address.ip||"",e=b.ipv4.address.netmask||"",h=b.ipv4.setting.gateway||
"",l=d.split("."),e=e.split("."),m=h.split("."),n=!0,p=function(b){a.wanform&&(a.wanform.v4_static_gw&&a.wanform.v4_static_gw.$setValidity("gwOutRange",b),a.wanform.txt_ipv4pptp_gw&&a.wanform.txt_ipv4pptp_gw.$setValidity("gwOutRange",b),a.wanform.txt_ipv4l2tp_gw&&a.wanform.txt_ipv4l2tp_gw.$setValidity("gwOutRange",b),a.wanform.txt_ipv4br_gw&&a.wanform.txt_ipv4br_gw.$setValidity("gwOutRange",b))},q=function(b){a.wanform&&(a.wanform.v4_static_gw&&a.wanform.v4_static_gw.$setValidity("ipGwIsTheSame",
b),a.wanform.txt_ipv4static_ipaddr&&a.wanform.txt_ipv4static_ipaddr.$setValidity("ipGwIsTheSame",b),a.wanform.txt_ipv4pptp_ipaddr&&a.wanform.txt_ipv4pptp_ipaddr.$setValidity("ipGwIsTheSame",b),a.wanform.txt_ipv4pptp_gw&&a.wanform.txt_ipv4pptp_gw.$setValidity("ipGwIsTheSame",b),a.wanform.txt_ipv4l2tp_ipaddr&&a.wanform.txt_ipv4l2tp_ipaddr.$setValidity("ipGwIsTheSame",b),a.wanform.txt_ipv4l2tp_gw&&a.wanform.txt_ipv4l2tp_gw.$setValidity("ipGwIsTheSame",b),a.wanform.txt_ipv4br_ipaddr&&a.wanform.txt_ipv4br_ipaddr.$setValidity("ipGwIsTheSame",
b),a.wanform.txt_ipv4br_gw&&a.wanform.txt_ipv4br_gw.$setValidity("ipGwIsTheSame",b))},r=function(a){angular.forEach(a,function(a){parseInt(a,10)})};p(!0);q(!0);switch(b.ipv4.connectTypeList.selected){case "static":case "trasparent-bridge":break;case "pptp":if("static"!==b.ipv4.physical)return;break;case "l2tp":if("static"!==b.ipv4.physical)return;break;default:return}4!==l.length||(4!==e.length||4!==m.length)||(d===h?q(!1):(r(l),r(e),r(m),(l[0]&e[0])!==(m[0]&e[0])&&(n=!1),(l[1]&e[1])!==(m[1]&e[1])&&
(n=!1),(l[2]&e[2])!==(m[2]&e[2])&&(n=!1),(l[3]&e[3])!==(m[3]&e[3])&&(n=!1),p(n),app.TOOLS.apply(a)))};var r=a.$watch(function(){return a.edit.intf},function(b){a.checkEdit()});a.funs={cloneMAC:function(){a.edit.mac_address=a.model.mac},save:function(){r();b.close(a.edit)},cancel:function(){r();b.dismiss("cancel");a.resetModified()},clickTab:function(b){a.tabUrl=b.templateUrl;a.tabSelect=b.name;x()}};var d=function(b,d){var e=-1,h={};"ipv6"===d?(h={flag:!1,subnetObj:{ipv4:b.ipv4||[],ipv6:[]}},angular.forEach(b.ipv6,
function(b){if(0<=b.name.search("WAN")){for(var c=0;c<a.model.ifs.length;c++)if(b.name===a.model.ifs[c].name){e=0;break}-1===e?h.flag=!0:0===e&&(h.subnetObj.ipv6.push(b),e=-1)}else h.subnetObj.ipv6.push(b)})):(h={flag:!1,subnetObj:{ipv4:[],ipv6:b.ipv6||[]}},angular.forEach(b.ipv4,function(b){if(0<=b.name.search("WAN")){for(var c=0;c<a.model.ifs.length;c++)if(b.name===a.model.ifs[c].name){e=0;break}-1===e?h.flag=!0:0===e&&(h.subnetObj.ipv4.push(b),e=-1)}else h.subnetObj.ipv4.push(b)}));return h};a.chkL2tpPptpServerVali=
function(){var b=a.edit,d=!1;if(!b)return!0;switch(b.ipv4.connectTypeList.selected){case "l2tp":case "pptp":break;default:return!0}angular.forEach(a.model.ifs,function(e,h){h!==a.model.addEditIdx&&b.ipv4.connectTypeList.selected===e.ipv4.connectType&&b.ipv4.setting.server===e.ipv4.setting.server&&(d=!0)});return!d};a.chkIPv6StaticIPGw=function(){var b=a.edit,d,e,h=!0,l,m,n,p,q=function(b){a.wanform&&(a.wanform.txt_ipv6static_ipaddr&&a.wanform.txt_ipv6static_ipaddr.$setValidity("gwOutRange",b),a.wanform.txt_ipv6static_prefixlen&&
a.wanform.txt_ipv6static_prefixlen.$setValidity("gwOutRange",b),a.wanform.txt_ipv6static_gw&&a.wanform.txt_ipv6static_gw.$setValidity("gwOutRange",b))};l=function(b){a.wanform.txt_ipv6static_ipaddr&&a.wanform.txt_ipv6static_ipaddr.$setValidity("ipGwIsTheSame",b);a.wanform.txt_ipv6static_gw&&a.wanform.txt_ipv6static_gw.$setValidity("ipGwIsTheSame",b)};q(!0);l(!0);if(b&&"static"===b.ipv6.connectTypeList.selected&&(d=app.TOOLS.ipv6.toFullV6ZPAddr(b.ipv6.address.ip),e=app.TOOLS.ipv6.prefixLen2FullAddr(b.ipv6.address.prefix_length),
b=app.TOOLS.ipv6.toFullV6ZPAddr(b.ipv6.setting.gateway),d&&e&&b))if(d===b)l(!1);else if(39!==d.length||39!==b.length)Log(DEBUG,"chkIPv6StaticIPGw Error:"),Log(DEBUG,"IP Address is : "+d),Log(DEBUG,"Gateway is : "+b),q(!0);else{for(l=0;l<e.length;l++)"0"===e[l]||":"===e[l]||(m=parseInt(d[l],16),p=parseInt(e[l],16),n=parseInt(b[l],16),(m&p)!==n&&(h=!1));q(h)}};a.ipv4Vali=function(){var b=angular.copy(a.model.subnets).ipv4,d=a.edit,g=a.model.ifs,h=!0,m,n;if(!d||!d.ipv4.address.ip||!d.ipv4.address.netmask)return h;
switch(d.ipv4.connectTypeList.selected){case "trasparent-bridge":if(!d.ipv4.setting.ifnames)return h;for(m=b.length-1;0<=m;m--)b[m].name===d.ipv4.setting.ifnames&&b.splice(m,1);break;case "static":break;case "pptp":case "l2tp":if("dhcp"===d.ipv4.physical)return h;break;default:return h}angular.forEach(g,function(a){if(d.name!==a.name){switch(a.ipv4.connectType){case "trasparent-bridge":if(!a.ipv4.setting.ifnames)break;for(m=b.length-1;0<=m;m--)b[m].name===a.ipv4.setting.ifnames&&b.splice(m,1);break;
case "static":break;case "pptp":case "l2tp":if("dhcp"===a.ipv4.physical)return;break;default:return}d.ipv4.address.ip===a.ipv4.address.ip&&(h=!1)}});if(!h)return h;n=app.TOOLS.netmask.inet2Int(d.ipv4.address.netmask);g=e.get_first_ip(d.ipv4.address.ip,n);n=e.get_last_ip(d.ipv4.address.ip,n);g&&(g=g.toString());n&&(n=n.toString());return h=!l.check_ipv4_range_is_overlap_with_entity({start:g,end:n},b).is_overlap};a.ipv6Vali=function(){var b=!0,b=angular.copy(m.ipv6),e=a.edit.intf,g="";if(void 0===a.edit.ipv6.address.ip||
""===a.edit.ipv6.address.ip||void 0===a.edit.ipv6.address.prefix_length||""===a.edit.ipv6.address.prefix_length||void 0===b)return!0;g=void 0===a.edit.vlan_interface_settings.vlan_id||""===a.edit.vlan_interface_settings.vlan_id?e:e+"."+a.edit.vlan_interface_settings.vlan_id;gapObj=d(m,"ipv6");return b=!0===gapObj.flag?q.poolValidateV6ByAddrAndPrefix("interfaces",g,"ipv6",gapObj.subnetObj,a.edit.ipv6.address.ip,a.edit.ipv6.address.prefix_length):q.poolValidateV6ByAddrAndPrefix("interfaces",g,"ipv6",
m,a.edit.ipv6.address.ip,a.edit.ipv6.address.prefix_length)};a.changeShareIPv4Session=function(){var b=a.edit;b.ipv6.setting.share_ipv4_pppoe_session?a.syncPPPoESession():(b.ipv6.setting.username="",b.ipv6.setting.password="")};a.syncPPPoESession=function(){var b=a.edit;"pppoe"===!b.ipv4.connectTypeList.selected||("pppoe"===!b.ipv6.connectTypeList.selected||!b.ipv6.setting.share_ipv4_pppoe_session)||(b.ipv6.setting.username=b.ipv4.setting.username,b.ipv6.setting.changed_password=!0,b.ipv6.setting.password=
b.ipv4.setting.changed_password?b.ipv4.setting.password:b.ipv4.setting.orig_password)};a.vlanIdNoRepeat=!0;a.checkEdit();a.chkAuthType();p(a.edit);x()}]);app.controller("wlan_wps_main",["$scope","$q","$log","MyHttp","rpcFns","$timeout","Sets","$filter","UserSession","userAccessRight","$uibModal",function(a,b,s,n,v,t,m,q,e,w,l){a.jumpToPage=app.TOOLS.jumpToPage;a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.wps=a.ctx.wps||{};a.loadReady=!1;a.forcedUsingPost=!0;var h={procBackground:!1,forcedUsingPost:a.forcedUsingPost},p=("https:"===document.location.protocol?"wss:":"ws:")+"//"+document.location.host+"/websocket",u;s=function(){u=new WebSocket(p);u.onopen=
function(a){u.send('{"type":"wps","interval":3,"timeout":1800}')};u.onclose=function(a){};u.onmessage=function(a){r(a)};u.onerror=function(a){}};var x=function(b){var c=a.DICT("WPS_Msg"),d=[],e,h,k,l,m;if(a.model_orig.wlans&&a.model_orig.wlans.ssid){for(var n=0;n<b.length;n++)l=k=0,e=b[n].substr(0,3),h=""===b[n].substr(4,1)?0:parseInt(b[n].substr(4,1)),m=!0,angular.forEach(a.model_orig.wlans.ssid,function(a,b){if(m&&("BOTH"===a.radio?(k++,l++):"WLAN1"===a.radio?k++:"WLAN2"===a.radio&&l++,"wl0"===
e&&k>h||"wl1"===e&&l>h))d.push(b),m=!1});b=d.filter(function(a,b,c){return c.indexOf(a)===b});for(n=0;n<b.length;n++){var p,q=a.model_orig.wlans.ssid,r=b[n];"BOTH"===q[r].radio?p="Both":"WLAN1"===q[r].radio?p="2.4G":"WLAN2"===q[r].radio&&(p="5G");c+=a.DICT("WPS_Msg_SSID",{"%s0":q[r].ssid,"%s1":p})}}return c},r=function(a){a=JSON.parse(a.data);a.wps_lock_status&&(a=x(a.wps_lock_status),app.TOOLS.criticalAlertBox({msg:a,cbk:function(a){if(a)return!0}}))};a.$on("$locationChangeStart",function(b,c,d){void 0===
a.wps&&u.close()});a.userAccessFlag=w.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&e.logout();var d=function(){a.model={};var d=n.post({url:resource_base+"data/wlan_ssid.json",method:"get_wifi_settings",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),e=n.post({url:resource_base+"data/wlan_button_state.json",method:"get_wifi_button_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([d,e]).then(function(b){for(var d=
0;d<b.length;d++){var e=b[d].data.result,g=void 0;for(g in e)a.model[g]?m.recover_object(a.model[g],e[g]):angular.extend(a.model,e)}if((!a.wps||1!==a.wps.flag)&&a.model.wlans.ssid){b=a.model.wlans.ssid;for(d=b.length-1;0<=d;d--)(!b[d].enable||!b[d].wps.enable)&&b.splice(d,1);a.model.len=b.length}a.schema=a.schema||{};a.schema.enableStatus={"true":a.DICT("WPS_Enable"),"false":a.DICT("WPS_Disable")};c();a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.ctx.wps.ssididx=a.wps&&1===
a.wps.flag?a.wps.idx.toString():"0";a.resetModified();a.loadReady=!0})};d();void 0===a.wps&&s();a.resetPageVIew=function(b){"overview"==b&&(a.changeCurrPageTo("main"),t(function(){},100))};var c=function(){var b=a.model.wlans.ssid;b&&angular.forEach(b,function(a,b){a.radio&&(a.radio_rpc="BOTH"===a.radio?"WLAN1":a.radio)})};a.selected=a.selected||{};a.currPage="main";a.ctx.pageNav=[a.currPage];a.getCurrPage=function(){return a.currPage};a.pageMap=function(b){var c=!1;a.currPage==b&&(c=!0);return c};
a.ssid_radio_owner=function(){var b=a.model.wlans.ssid[a.ctx.wps.ssididx];if(b){var b=b.radio,c="";"BOTH"===b?c="both":"WLAN1"==b?c="2g":"WLAN2"==b?c="5g":Log(DEBUG,"Unknown Radio:"+b);return c}};a.ssid_radio_owner_rpc=function(b){var c=a.model.wlans.ssid[a.ctx.wps.ssididx];if(c)if(angular.isDefined(b))"2g"==b?c.radio_rpc="WLAN1":"5g"==b?c.radio_rpc="WLAN2":"both"==b?c.radio_rpc="WLAN1":Log(DEBUG,"Unknown newVal:"+b);else return b=c.radio_rpc,c="","BOTH"==b?c="2g":"WLAN1"==b?c="2g":"WLAN2"==b?c="5g":
Log(DEBUG,"Unknown Radio:"+b),c};a.ssid_radio_wps=function(){if(a.wps&&1===a.wps.flag)return a.wps.wps.enable;var b=a.ctx.wps.ssididx|0,b=""!==b&&a.model.wlans&&a.model.wlans.ssid?a.model.wlans.ssid[b]||"":"";return""!==b&&b.wps.enable?b.wps.enable:!1};a.ssid_radio_enable=function(){if(a.wps&&1===a.wps.flag)return a.wps.enable;var b=a.ctx.wps.ssididx|0,b=""!==b&&a.model.wlans&&a.model.wlans.ssid?a.model.wlans.ssid[b]||"":"";return""!==b&&b.enable?b.enable:!1};a.chkSecurity=function(){if(a.wps&&1===
a.wps.flag)return a.wps.security&&a.wps.security["mode-enabled"]&&("None"===a.wps.security["mode-enabled"]||"WPA2-Personal"===a.wps.security["mode-enabled"]||"WPA-WPA2-Personal"===a.wps.security["mode-enabled"])?!0:!1;var b=a.ctx.wps.ssididx|0,b=""!==b&&a.model.wlans&&a.model.wlans.ssid?a.model.wlans.ssid[b]||"":"";if(""!==b&&b.security)return b.security["mode-enabled"]&&("None"===b.security["mode-enabled"]||"WPA2-Personal"===b.security["mode-enabled"]||"WPA-WPA2-Personal"===b.security["mode-enabled"])?
!0:!1};a.getSecurity=function(){if(a.wps&&1===a.wps.flag)return a.wps.security&&a.wps.security["mode-enabled"]?a.wps.security["mode-enabled"]:"N/A";var b=a.ctx.wps.ssididx|0,b=a.model.wlans&&a.model.wlans.ssid&&a.model.wlans.ssid[b]||"";return b.security&&b.security["mode-enabled"]?b.security["mode-enabled"]:"N/A"};a.changeCurrPageTo=function(b){b!=a.currPage&&(a.ctx.pageNav.push(b),a.currPage=b);k(b)};a.changeCurrPageBack=function(){var b;1<a.ctx.pageNav.length&&(a.ctx.pageNav.pop(),b=a.ctx.pageNav[a.ctx.pageNav.length-
1],a.currPage=b,k(b));return b};var k=function(a){"main"!=a&&alert("unknown id:"+a)};a.filter_WLAN_Radio=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};a.collect_wlan_radio=function(b){return q("filter")(a.model.interfaces["interface"],a.filter_WLAN_Radio(b))};a.collect_orig_wlan_radio=function(b){return q("filter")(a.model_orig.interfaces["interface"],a.filter_WLAN_Radio(b))};a.RPC_PBC=function(a){alert("No action, RPC not defined")};a.RPC_gen_wps_pin=function(b,c){if(void 0==
b){var d=a.model.wlans.ssid[a.ctx.wps.ssididx];if(!d)return;b=d.ssid;d=d.radio_rpc}v.RPC_generic_send("generate-wps-pin",{ssid:b,radio:d,"pin-timeout":"0"===c?86401:60*c},function(b,c,d){a.ctx.wps.device_pin=d.pin?d.pin:"";a.RPC_ret_wps_pin()},void 0,h)};a.RPC_ret_wps_pin=function(){var b=a.model.wlans.ssid[a.ctx.wps.ssididx];b&&(b={ssid:b.ssid,radio:b.radio_rpc},a.resetModified(),v.RPC_generic_send("retrieve-wps-pin",b,function(b,c,d){d=d||{};a.ctx.wps.device_pin=d.pin?d.pin:"";a.ctx.wps.device_pin_status=
void 0!==d["pin-timeout"]?0<d["pin-timeout"]?"Valid":0===d["pin-timeout"]?"Expired":"N/A":d.errstr&&"Didn't set ap pin"===d.errstr?"Unconfigured":"N/A"},void 0,h))};$(function(){function a(){var b=$(this),c=b.find(".modal-dialog");b.css("display","block");c.css("margin-top",Math.max(0,($(window).height()-c.height())/2))}$(".modal").on("show.bs.modal",a);$(window).on("resize",function(){$(".modal:visible").each(a)})});a.press_wps=function(){l.open({animation:a.animationsEnabled,templateUrl:"wlan_wps_modal.htm",
controller:"presswps",size:"600",backdrop:"static",windowClass:"wps-modal",resolve:{model:function(){return a.model},ctx:function(){return a.ctx}}}).result.then(function(){})};a.register_wps_pin=function(b){l.open({animation:a.animationsEnabled,templateUrl:"wlan_wps_modal.htm",controller:"registerwps",size:"600",backdrop:"static",windowClass:"wps-modal",resolve:{model:function(){return a.model},ctx:function(){return a.ctx},pincode:function(){return b}}}).result.then(function(){})};a.save=function(){var b=
function(a){return angular.copy(a)}(a.collect_wlan_radio("^WLAN"));(function(){n.post({url:resource_base+"data/wlan_radio.json",method:"set_wifi_interfaces",params:{interfaces:{"interface":b}},success:function(b){a.resetPageVIew("overview")},error:function(b){a.resetPageVIew("overview");console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}})})();a.resetModified()};a.back=function(){a.changeCurrPageBack()};a.cancel=function(){a.loadReady=!1;a.model={};a.resetPageVIew("overview");d();
a.resetModified()};a.lifetimechk=function(){a.resetModified();if("0"===a.ctx.wps.lifetime){var b=a.DICT("WPS_Static_Pins_Security_Risk");app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){}})}};a.combineStr=a.DICT("WPS_Link",{"%s":"<a ng-click=\"jumpToPage('wlan_settings')\">"+a.DICT("Here")+"</a>"})}]);
app.controller("presswps",["$scope","$q","$uibModalInstance","rpcFns","model","ctx",function(a,b,s,n,v,t){a.model=v;a.ctx=t;a.funs={close:function(){s.close()}};var m={procBackground:!0,forcedUsingPost:!0};(function(){a.page=1;a.progress=0;a.response=-1;var b=100,e=setInterval(function(){b--;0<=b&&100>a.progress?a.progress++:(clearTimeout(e),a.page=0===a.response?5:1===a.response?2:3)},1200);(function(){var b=a.model.wlans.ssid[a.ctx.wps.ssididx],e=b.ssid;b&&n.RPC_generic_send("press-wps",{ssid:e,
radio:b.radio_rpc},function(b,e,l){l=l||{};Log(DEBUG,"RPC press-wps invoked");a.response=l.code;a.progress=100},void 0,m)})()})()}]);
app.controller("registerwps",["$scope","$q","$uibModalInstance","rpcFns","model","ctx","pincode",function(a,b,s,n,v,t,m){a.model=v;a.ctx=t;a.pincode=m;a.funs={close:function(){s.close()}};var q={procBackground:!0,forcedUsingPost:!0};(function(){a.page=1;a.progress=0;a.response=-1;var b=100,m=setInterval(function(){b--;0<=b&&100>a.progress?a.progress++:(clearTimeout(m),a.page=0===a.response?5:1===a.response?2:3===a.response?4:3)},1200);(function(){var b=a.model.wlans.ssid[a.ctx.wps.ssididx];b&&(b=
{ssid:b.ssid,radio:b.radio_rpc,pin:a.pincode.replace(" ","-")},n.RPC_generic_send("register-wps-device-pin",b,function(b,e,l){Log(DEBUG,"RPC register-wps-device-pin invoked");a.response=l.code;2===l.code&&""===l.errstr&&(a.response=3);a.progress=100},void 0,q))})()})()}]);var cp_delete_items=[];
app.controller("captive_portal_main",["$scope","$q","$log","MyHttp","oneTimeLocker","$timeout","GridRowBasedEditingAdv","$templateCache","Sets","wan_service","$filter","UserSession","userAccessRight",function(a,b,s,n,v,t,m,q,e,w,l,h,p){a.model=a.model||{};a.ctx=a.ctx||{};a.success=!1;a.loadReady=!1;a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&h.logout();var u=function(){cp_delete_items=[];var d=n.post({url:resource_base+"data/portal_profiles.json",method:"get_portal_profile",
error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),c=n.post({url:resource_base+"data/wlan_button_state.json",method:"get_wifi_button_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([d,c]).then(function(b){a.model={};for(var c=0;c<b.length;c++)x(b[c]);e.recover_object(a.model,{"portal-profiles":{"portal-profile":[]}});a.schema=a.schema||{};a.schema.enableStatus={"true":"Enable","false":"Disable"};a.schema.cpp_auth=
[{id:"auth",displayName:a.DICT("Captive_Portal_Auth")},{id:"noauth",displayName:a.DICT("Captive_Portal_No_Auth")}];a.schema.ux_font_color=[{id:"white",displayName:a.DICT("Captive_Portal_White")},{id:"red",displayName:a.DICT("Captive_Portal_Red")},{id:"green",displayName:a.DICT("Captive_Portal_Green")},{id:"gray",displayName:a.DICT("Captive_Portal_Gray")},{id:"blue",displayName:a.DICT("Captive_Portal_Blue")},{id:"magenta",displayName:a.DICT("Captive_Portal_Magenta")},{id:"cyan",displayName:a.DICT("Captive_Portal_Cyan")},
{id:"black",displayName:a.DICT("Captive_Portal_Black")}];a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.gridCPP.Options.data=a.model["portal-profiles"]["portal-profile"];a.loadReady=!0;t(function(){var b=v.get("WLAN_CP");if(b)switch(console.log("Jump from Wireless Basic Settings: "+JSON.stringify(b)),b.action){case "add":a.gridCPP.add()}},100)})};u();a.resetPageVIew=function(b){"overview"==b&&a.changeCurrPageTo("main")};var x=function(b){b=b.data.result;for(var c in b)a.model[c]?
e.recover_object(a.model[c],b[c]):angular.extend(a.model,b)};a.gridCPP={};a.currPage="main";a.ctx.pageNav=[a.currPage];a.getCurrPage=function(){return a.currPage};a.pageMap=function(b){var c=!1;a.currPage==b&&(c=!0);return c};a.changeCurrPageTo=function(b){b!=a.currPage&&(a.ctx.pageNav.push(b),a.currPage=b);r(b)};a.changeCurrPageBack=function(){var b;1<a.ctx.pageNav.length&&(a.ctx.pageNav.pop(),b=a.ctx.pageNav[a.ctx.pageNav.length-1],a.currPage=b,r(b));return b};a.redirectModeChoice=function(b){var c=
a.gridCPP.Selections[0];if(angular.isDefined(b))"redirect-auto"==b?(c["redirect-auto"]=null,c["original-url"]=void 0,c["redirect-url"]=void 0):"original-url"==b?(c["redirect-auto"]=void 0,c["original-url"]=null,c["redirect-url"]=void 0):"redirect-url"==b&&(c["redirect-auto"]=void 0,c["original-url"]=void 0,c["redirect-url"]=c["redirect-url-tmp"]);else if(c){b="";var e=c["redirect-auto"],g=c["original-url"],h=c["redirect-url"]||"";angular.isDefined(e)&&""!==e?b="redirect-auto":angular.isDefined(g)&&
""!==g?b="original-url":angular.isDefined(h)&&(b="redirect-url",c["redirect-url-tmp"]=h);return b}};a.chkDefProfile=function(b){b=a.gridCPP.Selections||"";for(var c=!1,e=0;e<b.length;e++)"Default_Portal_Profile"===b[e].name&&(c=!0);return c};a.modelRedirectUrlTmp=function(b){var c=a.gridCPP.Selections[0];if(angular.isDefined(b))c["redirect-url-tmp"]=b,c["redirect-url"]=b;else if(c)return b="",c["redirect-url-tmp"]&&(b=c["redirect-url-tmp"]),""!==c["redirect-url"]&&(b=c["redirect-url"]),b};var r=function(b){"main"==
b?a.gridCPP.Edit=!1:"ssidadd"==b?a.gridCPP.Edit=!0:"ssidedit"==b?a.gridCPP.Edit=!0:alert("unknown id:"+b)};a.save=function(){var b=function(a){a=angular.copy(a);angular.forEach(a,function(a,b){angular.isDefined(a["redirect-url-tmp"])&&delete a["redirect-url-tmp"]});return a}(a.gridCPP.Selections),c=function(){1<a.gridCPP.Selections.length||n.post({url:resource_base+"data/portal_profiles.json",method:"set_portal_profile",params:{"portal-profiles":{"portal-profile":b}},success:function(b){a.success=
!0;a.resetPageVIew("overview");u()},error:function(b){a.resetPageVIew("overview");u();console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}})};(function(){for(var a=[],b=0;b<cp_delete_items.length;b++){var d={};d.name=cp_delete_items[b];a.push(d)}b={};0<a.length&&(b["portal-profiles"]={"portal-profile":a});angular.equals(b,{})?c():n.post({url:resource_base+"data/portal_profiles.json",method:"del_portal_profile",params:b,success:function(a){a.data&&(a.data.result&&a.data.result.code&&
0!==a.data.result.code)&&alert("Can not delete, following Tables is in use:\n"+a.data.result.errstr+"\n\n");c()},error:function(a){c();console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}})})();a.resetModified()};a.back=function(){a.changeCurrPageBack()};a.cancel=function(){a.loadReady=!1;a.model={};a.resetPageVIew("overview");u();a.resetModified()}}]);
app.controller("portal_profile_table",["$scope","$q","$log","MyHttp","$timeout","GridRowBasedEditingAdv","$templateCache","Sets","wan_service","$filter",function(a,b,s,n,v,t,m,q,e,w){a.gridCPP.edit=function(){a.ctx.ie_index=a.model["portal-profiles"]["portal-profile"].indexOf(a.gridCPP.Selections[0]);a.changeCurrPageTo("ssidedit")};a.gridCPP.openPortalPreview=function(a){window.open("portal/"+(a.entity.name||"")+"/login.html")};(function(){a.gridCPP.Selections=[];var b=function(){var b=a.model["portal-profiles"]["portal-profile"];
a.gridCPP.Selections=[];angular.forEach(b,function(b){b.checked&&a.gridCPP.Selections.push(b)})};a.gridCPP.Options=app.uiGrid.generateGridOptions({IDPreifx:"sslVPNGroup",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:b,headerChangedCbk:b},{field:"name",displayName:a.DICT("Captive_Portal_Porfile_Name")},{field:"redirect-url",displayName:a.DICT("Captive_Portal_Redirect_URL")},{field:"preview",displayName:"",enableSorting:!1,cellTemplate:m.get("UG_Portal_preview_button.html")}]});a.model["portal-profiles"]&&
a.model["portal-profiles"]["portal-profile"]&&(a.gridCPP.Options.data=a.model["portal-profiles"]["portal-profile"]);var e=function(a,b,e){e=e||"profile";for(var h=RegExp("^"+e+"(\\d+)"),d=0,c=a.length;c--;){var k,g;a&&(a[c]&&a[c][b])&&(k=a[c][b].match(h));k&&k[1]&&(g=parseInt(k[1]),d<g&&(d=g))}return e+(d+1)};a.gridCPP.add=function(){var b=a.model["portal-profiles"]["portal-profile"],l=e(b,"name","profile"),m={name:"",checked:!1,authentication:"auth","redirect-url":"","idle-timeout":1200,"portal-ux":{"font-color":"black",
"company-name":"","welcome-message":"","username-field":"","password-field":"","login-button-title":"",copyright:"","login-error-msg":"","login-error-msg2":"",agreement:{enable:!1,"agreement-text":"","agreement-title":"","acceptance-use-policy":""}}};angular.forEach(b,function(a){a.checked=!1});m.name=l;m.checked=!0;b.push(m);a.ctx.ie_index=b.length-1;a.gridCPP.Selections.splice(0,0,m);a.modified();v(function(){a.changeCurrPageTo("ssidadd")},45)};a.gridCPP.remove=function(){var b=a.model["portal-profiles"]["portal-profile"],
e;for(e=b.length-1;0<=e;e--)b[e].checked&&(cp_delete_items.push(b[e].name),b.splice(e,1));a.modified()};a.ctx.ie_index=0})()}]);
app.controller("portal_profile_edit",["$scope","MyHttp","Upload","$timeout",function(a,b,s,n){a.showShortName=function(a){var b="";angular.isDefined(a)&&(b=a.lastIndexOf("/"),b=0>b?a:a.substr(b+1));return b};a.bg_invalid=!1;a.logo_invalid=!1;a.chunkSize=512;var v=function(b,q,e){b.upload=s.upload({url:resource_base+"upload"+a.getReqParams(),resumeSizeUrl:q?resource_base+"upload?name22="+encodeURIComponent(b.name):null,resumeChunkSize:q?a.chunkSize:null,headers:{"optional-header":"header-value"},data:{sessionid:"EU6DJKEIWO",
pathparam:"Portal",profileparam:e.profileName||"",fileparam:e.filename,file:b}});b.upload.then(function(a){n(function(){b.result=a.data;Log(DEBUG,"web Upload done")})},function(b){0<b.status&&(a.errorMsg=b.status+": "+b.data);Log(ERROR,"do upload error")},function(a){b.progress=Math.min(100,parseInt(100*a.loaded/a.total))});b.upload.xhr(function(a){})};a.getReqParams=function(){return a.generateErrorOnServer?"?errorCode="+a.serverErrorCode+"&errorMessage="+a.serverErrorMsg:""};a.upload=function(b,
n){a.errorMsg=null;v(b,!1,n)};a.doFileUpload=function(){var b={},n=a.gridCPP.Selections[0],e=n.name;a.formUpload=!0;var s=function(h,l,n){var q=!0;null!=h&&(h.type.match(/^image\/(png|jpeg|gif|bmp)$/)?(b.filename=l+".png",b.profileName=e,a.upload(h,b),n&&n(h,b)):(alert("Unknown file type: "+h.name),q=!1));return q},l=s(a.ctx.bgPic,"bg",function(a,b){n["portal-ux"].background=n["portal-ux"].background||{};n["portal-ux"].background.uri=a.name}),s=s(a.ctx.logoPic,"logo",function(a,b){n["portal-ux"].logo=
n["portal-ux"].logo||{};n["portal-ux"].logo.uri=a.name});a.ctx.bgPic&&delete a.ctx.bgPic;a.ctx.logoPic&&delete a.ctx.logoPic;return l&&s};var t="<div>"+a.DICT("Captive_Portal_File_Format_Errstr1")+"</div><div>"+a.DICT("Captive_Portal_File_Format_Errstr2")+"</div><div>"+a.DICT("Captive_Portal_File_Format_Errstr3")+"</div>";a.bgFileFormatCheck=function(b){a.bg_invalid=!1;void 0!=b&&(a.ctx.bgPic=b,131072<parseInt(b.size)?(a.bg_invalid=!0,app.TOOLS.criticalAlertBox({msg:a.DICT("Captive_Portal_File_Size_Errstr",
{"%s":"128 kbytes"}),cbk:function(){}})):null==b.name.match(/^[0-9a-zA-Z\-\._]+(\.png|\.PNG|\.jpg|\.JPG|\.bmp|\.BMP|\.gif|\.GIF){1}$/)&&(a.bg_invalid=!0,app.TOOLS.criticalAlertBox({msg:t,cbk:function(){}})))};a.logoFileFormatCheck=function(b){a.logo_invalid=!1;void 0!=b&&(a.ctx.logoPic=b,10240<parseInt(b.size)?(a.logo_invalid=!0,app.TOOLS.criticalAlertBox({msg:a.DICT("Captive_Portal_File_Size_Errstr",{"%s":"10 kbytes"}),cbk:function(){}})):null==b.name.match(/^[0-9a-zA-Z\-\._]+(\.png|\.PNG|\.jpg|\.JPG|\.bmp|\.BMP|\.gif|\.GIF){1}$/)&&
(a.logo_invalid=!0,app.TOOLS.criticalAlertBox({msg:t,cbk:function(){}})))};a.save=function(){a.doFileUpload()?a.$parent.save():alert("File Upload fail, aborted")}}]);app.controller("wlan_adv_main",["$scope","$q","$log","MyHttp","$timeout","GridRowBasedEditingAdv","$templateCache","Sets","wan_service","$filter","UserSession","userAccessRight",function(a,b,s,n,v,t,m,q,e,w,l,h){a.model=a.model||{};a.ctx=a.ctx||{};a.model_wifi=a.model_wifi||{};a.model.radio24g=a.model.radio24g||{};a.model.radio5g=a.model.radio5g||{};a.model.transmission_rate_24G=a.model.transmission_rate_24G||{};a.model.transmission_rate_5G=a.model.transmission_rate_5G||{};a.model.rateBasic24G=[!1,
!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];a.model.rate24G=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];a.model.rateBasic5G=[!1,!1,!1,!1,!1,!1,!1,!1];a.model.rate5G=[!1,!1,!1,!1,!1,!1,!1,!1];a.model.htMCS24G=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];a.model.htMCS5G=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];a.model.trmAC1_enable=!1;a.model.trmAC2_enable=!1;a.model.trmAC3_enable=!1;a.model.trmAC4_enable=!1;a.model.trmAC1_value=
"";a.model.trmAC2_value="";a.model.trmAC3_value="";a.model.trmAC4_value="";a.success=!1;a.loadReady=!1;a.userAccessFlag=h.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&l.logout();var p=function(){var c=n.post({url:resource_base+"data/wlan_radio.json",method:"get_wifi_interfaces",params:{filter:"WLAN"},success:function(b){a.model_wifi=angular.copy(b.data.result);a.model.radio24g=d(a.model_wifi,"WLAN1");a.model.radio5g=d(a.model_wifi,"WLAN2");var c=a.model.radio24g.radio["transmission-rate"]["ht-mcs"]||
"",e=a.model.radio5g.radio["transmission-rate"]["ht-mcs"]||"";b=a.model.radio5g.radio["transmission-rate"]["vht-mcs"]||"";for(var g="",g="",h=0,g=a.model.radio24g.radio["transmission-rate"].rate?a.model.radio24g.radio["transmission-rate"].rate[0]||[]:[],k=a.model.radio5g.radio["transmission-rate"]["rate-basic"]?a.model.radio5g.radio["transmission-rate"]["rate-basic"][0]||[]:[],l=a.model.radio5g.radio["transmission-rate"].rate[0]?a.model.radio5g.radio["transmission-rate"].rate[0]||[]:[],m=(a.model.radio24g.radio["transmission-rate"]["rate-basic"]?
a.model.radio24g.radio["transmission-rate"]["rate-basic"][0]||[]:[]).split(" "),h=m.length,n=0;n<h;n++)switch(m[n]){case "1.0":a.model.rateBasic24G[0]=!0;break;case "2.0":a.model.rateBasic24G[1]=!0;break;case "5.5":a.model.rateBasic24G[2]=!0;break;case "6.0":a.model.rateBasic24G[3]=!0;break;case "9.0":a.model.rateBasic24G[4]=!0;break;case "11.0":a.model.rateBasic24G[5]=!0;break;case "12.0":a.model.rateBasic24G[6]=!0;break;case "18.0":a.model.rateBasic24G[7]=!0;break;case "24.0":a.model.rateBasic24G[8]=
!0;break;case "36.0":a.model.rateBasic24G[9]=!0;break;case "48.0":a.model.rateBasic24G[10]=!0;break;case "54.0":a.model.rateBasic24G[11]=!0}g=g.split(" ");h=g.length;for(n=0;n<h;n++)switch(g[n]){case "1.0":a.model.rate24G[0]=!0;break;case "2.0":a.model.rate24G[1]=!0;break;case "5.5":a.model.rate24G[2]=!0;break;case "6.0":a.model.rate24G[3]=!0;break;case "9.0":a.model.rate24G[4]=!0;break;case "11.0":a.model.rate24G[5]=!0;break;case "12.0":a.model.rate24G[6]=!0;break;case "18.0":a.model.rate24G[7]=
!0;break;case "24.0":a.model.rate24G[8]=!0;break;case "36.0":a.model.rate24G[9]=!0;break;case "48.0":a.model.rate24G[10]=!0;break;case "54.0":a.model.rate24G[11]=!0}g=parseInt(c,16).toString(2);if(24>g.length){h=24-g.length;for(n=0;n<h;n++)g="0"+g}for(n=0;24>n;n++)a.model.htMCS24G[n]="1"===g[n]?!0:!1;g=parseInt(e,16).toString(2);if(32>g.length){h=32-g.length;for(n=0;n<h;n++)g="0"+g}for(n=0;32>n;n++)a.model.htMCS5G[n]="1"===g[n]?!0:!1;c=k.split(" ");h=c.length;for(n=0;n<h;n++)switch(c[n]){case "6.0":a.model.rateBasic5G[0]=
!0;break;case "9.0":a.model.rateBasic5G[1]=!0;break;case "12.0":a.model.rateBasic5G[2]=!0;break;case "18.0":a.model.rateBasic5G[3]=!0;break;case "24.0":a.model.rateBasic5G[4]=!0;break;case "36.0":a.model.rateBasic5G[5]=!0;break;case "48.0":a.model.rateBasic5G[6]=!0;break;case "54.0":a.model.rateBasic5G[7]=!0}l=l.split(" ");h=l.length;for(n=0;n<h;n++)switch(l[n]){case "6.0":a.model.rate5G[0]=!0;break;case "9.0":a.model.rate5G[1]=!0;break;case "12.0":a.model.rate5G[2]=!0;break;case "18.0":a.model.rate5G[3]=
!0;break;case "24.0":a.model.rate5G[4]=!0;break;case "36.0":a.model.rate5G[5]=!0;break;case "48.0":a.model.rate5G[6]=!0;break;case "54.0":a.model.rate5G[7]=!0}a.model.trmAC1_value=b.s1;a.model.trmAC2_value=b.s2;a.model.trmAC3_value=b.s3;a.model.trmAC4_value=b.s4;a.model.trmAC1_enable=""===b.s1||"0"===b.s1?!1:!0;a.model.trmAC2_enable=""===b.s2||"0"===b.s2?!1:!0;a.model.trmAC3_enable=""===b.s3||"0"===b.s3?!1:!0;a.model.trmAC4_enable=""===b.s4||"0"===b.s4?!1:!0},error:function(a){console.log("AJAX loading error: "+
a.status+", URL: "+a.config.url)}}),e=n.post({url:resource_base+"data/wlan_ssid.json",method:"get_wifi_settings",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}}),g=n.post({url:resource_base+"data/wlan_button_state.json",method:"get_wifi_button_state",error:function(a){console.log("AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([c,e,g]).then(function(b){for(var c=0;c<b.length;c++)u(b[c]);x();a.schema=a.schema||{};a.schema.enableStatus={"true":"Enable",
"false":"Disable"};a.schema.basicRate_2g=[{id:"1",displayName:"1 Mbps"},{id:"5",displayName:"5.5 Mbps"},{id:"11",displayName:"11 Mbps"}];a.schema.basicRate_5g=[{id:"6",displayName:"6 Mbps"},{id:"12",displayName:"12 Mbps"},{id:"24",displayName:"24 Mbps"}];a.schema.transmitRate_2g=[{id:"1",displayName:"1 Mbps"},{id:"2",displayName:"2 Mbps"},{id:"5",displayName:"5.5 Mbps"},{id:"6",displayName:"6 Mbps"},{id:"9",displayName:"9 Mbps"},{id:"11",displayName:"11 Mbps"},{id:"12",displayName:"12 Mbps"},{id:"18",
displayName:"18 Mbps"},{id:"24",displayName:"24 Mbps"},{id:"36",displayName:"36 Mbps"},{id:"48",displayName:"48 Mbps"},{id:"54",displayName:"54 Mbps"}];a.schema.transmitRate_5g=[{id:"6",displayName:"6 Mbps"},{id:"9",displayName:"9 Mbps"},{id:"12",displayName:"12 Mbps"},{id:"18",displayName:"18 Mbps"},{id:"24",displayName:"24 Mbps"},{id:"36",displayName:"36 Mbps"},{id:"48",displayName:"48 Mbps"},{id:"54",displayName:"54 Mbps"}];a.schema.txpower=[{id:100,displayName:a.DICT("Advance_Settings_Full")},
{id:50,displayName:a.DICT("Advance_Settings_High")},{id:25,displayName:a.DICT("Advance_Settings_Medium")},{id:12,displayName:a.DICT("Advance_Settings_Low")}];a.schema.extChannel=[{id:"AboveControlChannel",displayName:a.DICT("Advance_Settings_Above_Control_Channel")},{id:"BelowControlChannel",displayName:a.DICT("Advance_Settings_Below_Control_Channel")}];a.schema.wlan2g_mode=[{name:"g",displayName:a.DICT("Advance_Settings_G_Only")},{name:"b g",displayName:a.DICT("Advance_Settings_B_G_Mixed")},{name:"g n",
displayName:a.DICT("Advance_Settings_G_N_Mixed")},{name:"b g n",displayName:a.DICT("Advance_Settings_B_G_N_Mixed")}];a.schema.wlan5g_mode=[{name:"a",displayName:a.DICT("Advance_Settings_A_Only")},{name:"n ac",displayName:a.DICT("Advance_Settings_N_AC_Mixed")},{name:"a n ac",displayName:a.DICT("Advance_Settings_A_N_AC_Mixed")}];a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.loadReady=!0;v(function(){},100)})};p();a.resetPageVIew=function(b){"overview"==b&&(a.changeCurrPageTo("main"),
v(function(){},100))};var u=function(b){b=b.data.result;for(var d in b)a.model[d]?q.recover_object(a.model[d],b[d]):angular.extend(a.model,b)},x=function(){a.use_ssid_sample={wlans:{ssid:[]}};q.recover_object(a.model,a.use_ssid_sample);a.use_wlanif_sample={radio:{enable:!0,"operating-standards":["b g n"],"operating-channel-bandwidth":"20MHz","extension-channel":"AboveControlChannel",channel:1,"uapsd-enable":!0,"beamforming-enable":!1,"frame-burst-enable":!1,"wmm-no-acknowledgement-enable":!1,"cts-protection-mode":"auto",
"beacon-interval":100,"dtim-period":1,"fragmentation-threshold":2346,"rts-threshold":2347}};var b=a.collect_wlan_radio("^WLAN");angular.forEach(b,function(b,c){q.recover_object(b,a.use_wlanif_sample)})};a.selected=a.selected||{};a.currPage="main";a.ctx.pageNav=[a.currPage];a.getCurrPage=function(){return a.currPage};a.pageMap=function(b){var d=!1;a.currPage==b&&(d=!0);return d};a.changeCurrPageTo=function(b){b!=a.currPage&&(a.ctx.pageNav.push(b),a.currPage=b);r(b)};a.changeCurrPageBack=function(){var b;
1<a.ctx.pageNav.length&&(a.ctx.pageNav.pop(),b=a.ctx.pageNav[a.ctx.pageNav.length-1],a.currPage=b,r(b));return b};var r=function(a){"main"!=a&&alert("unknown id:"+a)};a.filter_WLAN_Radio=function(a){return function(b,d,e){return b.name.match(a)?!0:!1}};a.collect_wlan_radio=function(b){return w("filter")(a.model.interfaces["interface"],a.filter_WLAN_Radio(b))};a.collect_orig_wlan_radio=function(b){return w("filter")(a.model_orig.interfaces["interface"],a.filter_WLAN_Radio(b))};var d=function(a,b){for(var d=
a.interfaces["interface"].length,e="",h={},l=0;l<d;l++)if(e=a.interfaces["interface"][l].name,e.match(b)){h=angular.copy(a.interfaces["interface"][l]);break}return h};a.getBasicRate24G=function(a){var b=[],d=0,e=0,h=0,l=0;if(""===a)return"bgn";b=a.split(" ");for(l=0;l<b.length;l++)"b"===b[l]&&(d=1),"g"===b[l]&&(e=1),"n"===b[l]&&(h=1);return 1===d&&0===e&&0===h?"b":"bgn"};a.getTrmRate24G=function(a){var b=[],d=0,e=0,h=0,l=0;if(""===a)return"bgn";b=a.split(" ");for(l=0;l<b.length;l++)"b"===b[l]&&(d=
1),"g"===b[l]&&(e=1),"n"===b[l]&&(h=1);return 1===d&&0===e&&0===h?"b":0===d&&1===e&&0===h||1===d&&1===e&&0===h?"bg":"bgn"};a.setToDefault24g=function(){var b="";a.model.radio24g=d(a.model_wifi,"WLAN1");a.model.radio24g&&(a.model.radio24g.radio&&a.model.radio24g.radio["operating-standards"])&&(b=a.model.radio24g.radio["operating-standards"].toString());a.model.rateBasic24G="g"===b||"g n"===b?[!0,!0,!0,!0,!1,!0,!0,!1,!0,!1,!1,!1]:[!0,!0,!0,!1,!1,!0,!1,!1,!1,!1,!1,!1];a.model.rate24G=[!0,!0,!0,!0,!0,
!0,!0,!0,!0,!0,!0,!0];a.model.htMCS24G=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0];a.modified()};a.setToDefault5g=function(){a.model.rateBasic5G=[!0,!1,!0,!1,!0,!1,!1,!1];a.model.rate5G=[!0,!0,!0,!0,!0,!0,!0,!0];a.model.htMCS5G=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0];a.model.trmAC1_enable=!0;a.model.trmAC2_enable=!0;a.model.trmAC3_enable=!0;a.model.trmAC4_enable=!0;a.model.trmAC1_value="fff";a.model.trmAC2_value=
"fff";a.model.trmAC3_value="fff";a.model.trmAC4_value="fff";a.modified()};a.pressGroup=function(b){switch(b){case "antenna1":!1===a.model.trmAC1_enable?(a.model.trmAC2_enable=!1,a.model.trmAC3_enable=!1,a.model.trmAC4_enable=!1,a.model.trmAC1_value="0",a.model.trmAC2_value="0",a.model.trmAC3_value="0",a.model.trmAC4_value="0"):"0"===a.model.trmAC1_value&&(a.model.trmAC1_value="fff");break;case "antenna2":!1===a.model.trmAC2_enable?(a.model.trmAC3_enable=!1,a.model.trmAC4_enable=!1,a.model.trmAC2_value=
"0",a.model.trmAC3_value="0",a.model.trmAC4_value="0"):"0"===a.model.trmAC2_value&&(a.model.trmAC2_value="fff");break;case "antenna3":!1===a.model.trmAC3_enable?(a.model.trmAC4_enable=!1,a.model.trmAC3_value="0",a.model.trmAC4_value="0"):"0"===a.model.trmAC3_value&&(a.model.trmAC3_value="fff");break;case "antenna4":!1===a.model.trmAC4_enable?a.model.trmAC4_value="0":"0"===a.model.trmAC4_value&&(a.model.trmAC4_value="fff")}};a.save=function(){for(var b="",b="",d=0,e=b="",e=[],h=[],l=[],m=[],p=function(a){return angular.copy(a)}(a.collect_wlan_radio("^WLAN")),
q=0;q<p.length;q++)if("WLAN1"===p[q].name){!0===a.model.rateBasic24G[0]&&e.push(1);!0===a.model.rateBasic24G[1]&&e.push(2);!0===a.model.rateBasic24G[2]&&e.push(5.5);!0===a.model.rateBasic24G[3]&&e.push(6);!0===a.model.rateBasic24G[4]&&e.push(9);!0===a.model.rateBasic24G[5]&&e.push(11);!0===a.model.rateBasic24G[6]&&e.push(12);!0===a.model.rateBasic24G[7]&&e.push(18);!0===a.model.rateBasic24G[8]&&e.push(24);!0===a.model.rateBasic24G[9]&&e.push(36);!0===a.model.rateBasic24G[10]&&e.push(48);!0===a.model.rateBasic24G[11]&&
e.push(54);!0===a.model.rate24G[0]&&h.push(1);!0===a.model.rate24G[1]&&h.push(2);!0===a.model.rate24G[2]&&h.push(5.5);!0===a.model.rate24G[3]&&h.push(6);!0===a.model.rate24G[4]&&h.push(9);!0===a.model.rate24G[5]&&h.push(11);!0===a.model.rate24G[6]&&h.push(12);!0===a.model.rate24G[7]&&h.push(18);!0===a.model.rate24G[8]&&h.push(24);!0===a.model.rate24G[9]&&h.push(36);!0===a.model.rate24G[10]&&h.push(48);!0===a.model.rate24G[11]&&h.push(54);b="";for(d=0;24>d;d++)b=!0===a.model.htMCS24G[d]?"1"+b:"0"+
b;b=parseInt(b,2);b=b.toString(16);e={mode:"Manual","rate-basic":e,rate:h,"ht-mcs":b};p[q].radio["transmission-rate"]=e;break}for(q=0;q<p.length;q++)if("WLAN2"===p[q].name){!0===a.model.rateBasic5G[0]&&l.push(6);!0===a.model.rateBasic5G[1]&&l.push(9);!0===a.model.rateBasic5G[2]&&l.push(12);!0===a.model.rateBasic5G[3]&&l.push(18);!0===a.model.rateBasic5G[4]&&l.push(24);!0===a.model.rateBasic5G[5]&&l.push(36);!0===a.model.rateBasic5G[6]&&l.push(48);!0===a.model.rateBasic5G[7]&&l.push(54);!0===a.model.rate5G[0]&&
m.push(6);!0===a.model.rate5G[1]&&m.push(9);!0===a.model.rate5G[2]&&m.push(12);!0===a.model.rate5G[3]&&m.push(18);!0===a.model.rate5G[4]&&m.push(24);!0===a.model.rate5G[5]&&m.push(36);!0===a.model.rate5G[6]&&m.push(48);!0===a.model.rate5G[7]&&m.push(54);b="";for(d=0;32>d;d++)b=!0===a.model.htMCS5G[d]?"1"+b:"0"+b;b=parseInt(b,2);e=b.toString(16);e={mode:"Manual","rate-basic":l,rate:m,"ht-mcs":e,"vht-mcs":{s1:a.model.trmAC1_value,s2:a.model.trmAC2_value,s3:a.model.trmAC3_value,s4:a.model.trmAC4_value}};
p[q].radio["transmission-rate"]=e;break}(function(){n.post({url:resource_base+"data/wlan_radio.json",method:"set_wifi_interfaces",params:{interfaces:{"interface":p}},success:function(b){a.success=!0;a.resetPageVIew("overview")},error:function(b){a.resetPageVIew("overview");console.log("AJAX loading error: "+b.status+", URL: "+b.config.url)}})})();a.resetModified()};a.back=function(){a.changeCurrPageBack()};a.cancel=function(){a.loadReady=!1;a.model={};a.resetPageVIew("overview");p();a.resetModified()}}]);
app.controller("wlan_radio",["$scope","$q","$log","MyHttp","$templateCache","Sets","wan_service",function(a,b,s,n,v,t,m){}]);app.controller("wlan_settings_main",["$scope","$q","$uibModal","MyHttp","oneTimeLocker","$timeout","GridRowBasedEditingOper","$templateCache","Sets","wan_service","$filter","UserSession","userAccessRight","$uibModalStack","goToPreviousPage",function(a,b,s,n,v,t,m,q,e,w,l,h,p,u,x){var r=app.TOOLS.getResponse;a.goback=x.goback;a.backbtn=!1;a.model=a.model||{};a.ctx=a.ctx||{};a.ctx.wlanOpt=a.ctx.wlanOpt||{};a.ctx.spec=a.ctx.spec||{};a.success=!1;a.loadReady=!1;a.bulk=[];a.flags=a.flags||{};a.flags.leaflist_sep_as_space=
!1;a.show_pwd=!1;a.model.orig_groups=[];a.model.ssid2gruop={};a.model.auth_groups=[];a.model.nacm_groups=[];a.userAccessFlag=p.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&h.logout();x.isneed()&&(a.backbtn=!0);a.ctx.spec.maxVAPprofiles=4;a.ctx.spec.maxMACAddrs=66;a.ctx.wlanOpt.showExtCh=!1;a.ctx.wlanOpt.showPriCh=!0;var d=("https:"===document.location.protocol?"wss:":"ws:")+"//"+document.location.host+"/websocket",c,k=function(b){var c=a.DICT("Wlan_Basic_Settings_WPS_Lock_Msg1"),d=[],e,
g,h,k,l,m;if(a.model_orig.wlans&&a.model_orig.wlans.ssid){for(m=0;m<b.length;m++)k=h=0,e=b[m].substr(0,3),g=""===b[m].substr(4,1)?0:parseInt(b[m].substr(4,1),10),l=!0,angular.forEach(a.model_orig.wlans.ssid,function(a,b){if(l&&("BOTH"===a.radio?(h++,k++):"WLAN1"===a.radio?h++:"WLAN2"===a.radio&&k++,"wl0"===e&&h>g||"wl1"===e&&k>g))d.push(b),l=!1});b=d.filter(function(a,b,c){return c.indexOf(a)===b});for(m=0;m<b.length;m++){var n,p=a.model_orig.wlans.ssid,q=b[m];"BOTH"===p[q].radio?n=a.DICT("Wlan_Basic_Settings_Both"):
"WLAN1"===p[q].radio?n=a.DICT("Wlan_Basic_Settings_24G"):"WLAN2"===p[q].radio&&(n=a.DICT("Wlan_Basic_Settings_5G"));c+=a.DICT("Wlan_Basic_Settings_WPS_Lock_Msg2",{"%s0":p[q].ssid,"%s1":n})}}return c},g=function(b){b=JSON.parse(b.data);b.wps_ssid_status&&app.TOOLS.criticalAlertBox({msg:a.DICT("Wlan_Basic_Settings_Refreshed_Msg"),cbk:function(b){u.dismissAll();a.cancel()}});b.wps_lock_status&&(b=k(b.wps_lock_status),app.TOOLS.criticalAlertBox({msg:b,cbk:function(a){if(a)return!0}}))};a.$on("$locationChangeStart",
function(a,b,d){c.close()});var z=function(b){b||(b={});b=b.groups&&b.groups.group||[];var c;a.model.auth_groups=[];a.model.ssid2gruop={};a.model.orig_groups=angular.copy(b);angular.forEach(b,function(b){a.model.auth_groups.push({id:b.name,displayName:b.name});c={};angular.forEach(b["feature-rule"],function(a){"ssid"===a.service&&(c=a)});angular.forEach(c.option,function(c){a.model.ssid2gruop[c]||(a.model.ssid2gruop[c]={});a.model.ssid2gruop[c][b.name]=!0})})},y=function(){a.model={};a.bulk=[];var c=
n.post({url:resource_base+"data/wlan_radio.json",method:"get_wifi_interfaces",params:{filter:"WLAN"},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),d=n.post({url:resource_base+"data/wlan_ssid.json",method:"get_wifi_settings",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),e=n.post({url:resource_base+"data/schedule.json",method:"get_schedule",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),
g=n.post({url:resource_base+"data/portal_profiles.json",method:"get_portal_profile",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),h=n.post({url:resource_base+"data/wlan_radio_state.json",method:"get_radio_state",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),k=n.post({url:resource_base+"data/wlan_vlan_list.json",method:"get_interface_list",params:{filter:"VLAN"},success:function(b){b.data&&(b.data.result&&b.data.result.interfaces&&
b.data.result.interfaces["interface"])&&(a.model.vlanlist=angular.copy(b.data.result.interfaces["interface"]))},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),l=n.post({url:resource_base+"data/wlan_button_state.json",method:"get_wifi_button_state",error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}}),m=n.post({url:resource_base+"data/nacm_group.json",method:"get_groups",error:function(a){z()}});b.all([c,d,e,g,h,k,l,m]).then(function(b){a.model.wlans&&
(a.model.wlans.ssid=[]);a.model.interfaces&&(a.model.interfaces["interface"]=[]);C(b[0]);C(b[1]);C(b[2]);C(b[3]);C(b[4]);C(b[6]);z(r(b,7));D();I();B();a.model_orig=angular.copy(a.model);a.model_del=angular.copy(a.model);a.model["interfaces-state"]&&a.model["interfaces-state"]["interface"]&&E();a.vld.check_radio_mode();a.vld.check_ssid_wmm();a.gridWLANSSID.Options.data=a.model.wlans.ssid;a.loadReady=!0})};y();(function(){c=new WebSocket(d);c.onopen=function(a){c.send('{"type":"wps","interval":3,"timeout":1800}')};
c.onclose=function(a){};c.onmessage=function(a){g(a)};c.onerror=function(a){}})();var A=function(b){var c=angular.copy(a.use_macfilter_sample);e.recover_object(b,c);b=b["mac-filter"]["filtered-macs"];for(var c=a.ctx.spec.maxMACAddrs,d=b.length;d<c;d++)b.push(angular.copy(a.use_macaddr_sample))};a.genVapWithBlankAddr=function(){var b=angular.copy(a.use_vap_sample);A(b);return b};var B=function(){angular.forEach(a.model.interfaces["interface"],function(a,b){"WLAN1"===a.name&&void 0===a.radio["max-associated-clients"]?
a.radio["max-associated-clients"]=50:"WLAN2"===a.name&&void 0===a.radio["max-associated-clients"]&&(a.radio["max-associated-clients"]=124)})};a.resetPageVIew=function(b){"overview"==b&&a.changeCurrPageTo("main")};var C=function(b){b=b||{};b=(b.data||{}).result||{};for(var c in b)a.model[c]?e.recover_object(a.model[c],b[c]):angular.extend(a.model,b)},D=function(){a.use_ssid_sample={wlans:{ssid:[]}};e.recover_object(a.model,a.use_ssid_sample);a.use_schedule_sample={schedules:{schedule:[]}};e.recover_object(a.model,
a.use_schedule_sample);a.use_macfilter_sample={"mac-filter":{enable:!1,"filtered-macs":[]}};a.use_macaddr_sample={"mac-address":"",action:"block"};a.use_vap_sample=angular.extend({},{name:"VAP",type:"ieee80211"},a.use_macfilter_sample);a.use_wlanif_sample={radio:{enable:!0,"operating-standards":["b g n"],"operating-channel-bandwidth":"20MHz","extension-channel":"BelowControlChannel",channel:1,"uapsd-enable":!0,"beamforming-enable":!1,"frame-burst-enable":!1,"wmm-no-acknowledgement-enable":!1,"cts-protection-mode":"auto",
"beacon-interval":100,"dtim-period":1,"fragmentation-threshold":2346,"rts-threshold":2347}};var b=a.collect_wlan_radio("^WLAN");angular.forEach(b,function(b,c){e.recover_object(b,a.use_wlanif_sample)});a.use_portal_profiles_sample={"portal-profiles":{"portal-profile":[]}};e.recover_object(a.model,a.use_portal_profiles_sample)},E=function(){function b(a,c){return parseInt(a.ch)-parseInt(c.ch)}var c=[],d=[],e=/(^[0-9]+$)/,g=/(u$)/,h=/(l$)/,k=/(\/80$)/;a.schema.wlan2g_ch_dyn=[];a.schema.wlan5g_ch_dyn=
[];angular.forEach(a.model["interfaces-state"]["interface"],function(a,b){"WLAN1"===a.name&&a.radio["possible-channel"]&&a.radio["possible-channel"][0]?c=a.radio["possible-channel"][0].split(" "):"WLAN2"===a.name&&(a.radio["possible-channel"]&&a.radio["possible-channel"][0])&&(d=a.radio["possible-channel"][0].split(" "))});if(c.length){var l=[],m=[],n=[],p,q,r,s,t={ch:p,ext:q,band:r,displayName:s};p="auto";q="AB";r="20/40";s="Auto";t={ch:p,ext:q,band:r,displayName:s};a.schema.wlan2g_ch_dyn.push(t);
for(var u=0;u<c.length;u++)c[u].match(e)?(p=c[u],p=parseInt(p),q="",r="20",s="Channel "+p,t={ch:p,ext:q,band:r,displayName:s},l.push(t)):c[u].match(g)?(p=c[u].replace(/u/g,""),p=parseInt(p),q="B",r="40",s="Channel "+p,t={ch:p,ext:q,band:r,displayName:s},m.push(t)):c[u].match(h)&&(p=c[u].replace(/l/g,""),p=parseInt(p),q="A",r="40",s="Channel "+p,t={ch:p,ext:q,band:r,displayName:s},n.push(t));l.sort(b);m.sort(b);n.sort(b);Array.prototype.push.apply(a.schema.wlan2g_ch_dyn,l);Array.prototype.push.apply(a.schema.wlan2g_ch_dyn,
m);Array.prototype.push.apply(a.schema.wlan2g_ch_dyn,n)}if(d.length){l=[];m=[];n=[];t=[];p={ch:p,ext:q,band:r,displayName:s};p={ch:"auto",ext:"AB",band:"20/40/80",displayName:"Auto"};a.schema.wlan5g_ch_dyn.push(p);for(u=0;u<d.length;u++)d[u].match(e)?(p=d[u],p=parseInt(p),q="",r="20",s="Channel "+p,p={ch:p,ext:q,band:r,displayName:s},l.push(p)):d[u].match(g)?(p=d[u].replace(/u/g,""),p=parseInt(p),q="B",r="40",s="Channel "+p,p={ch:p,ext:q,band:r,displayName:s},m.push(p)):d[u].match(h)?(p=d[u].replace(/l/g,
""),p=parseInt(p),q="A",r="40",s="Channel "+p,p={ch:p,ext:q,band:r,displayName:s},n.push(p)):d[u].match(k)&&(p=d[u].replace(/\/80/g,""),p=parseInt(p),q="",r="80",s="Channel "+p,p={ch:p,ext:q,band:r,displayName:s},t.push(p));l.sort(b);m.sort(b);n.sort(b);t.sort(b);Array.prototype.push.apply(a.schema.wlan5g_ch_dyn,l);Array.prototype.push.apply(a.schema.wlan5g_ch_dyn,m);Array.prototype.push.apply(a.schema.wlan5g_ch_dyn,n);Array.prototype.push.apply(a.schema.wlan5g_ch_dyn,t)}},I=function(){a.schema=a.schema||
{};a.schema.enableStatus={"true":a.DICT("Wlan_Basic_Settings_Enable"),"false":a.DICT("Wlan_Basic_Settings_Disable")};"Always On"!==a.model.schedules.schedule[0].name&&a.model.schedules.schedule.unshift({name:"Always On"});"New ..."!==a.model["portal-profiles"]["portal-profile"][0].name&&a.model["portal-profiles"]["portal-profile"].unshift({name:"New ..."});a.schema.extChannel=[{id:"AboveControlChannel",displayName:a.DICT("Wlan_Basic_Settings_Above_Control_Channel")},{id:"BelowControlChannel",displayName:a.DICT("Wlan_Basic_Settings_Below_Control_Channel")}];
a.schema.priChannel=[{id:"AboveControlChannel",displayName:a.DICT("Wlan_Basic_Settings_Lower")},{id:"BelowControlChannel",displayName:a.DICT("Wlan_Basic_Settings_Upper")}];a.schema.wlan2g_mode=[{name:"b",displayName:a.DICT("Wlan_Basic_Settings_B_Only")},{name:"g",displayName:a.DICT("Wlan_Basic_Settings_G_Only")},{name:"n",displayName:a.DICT("Wlan_Basic_Settings_N_Only")},{name:"b g",displayName:a.DICT("Wlan_Basic_Settings_B_G_Mixed")},{name:"g n",displayName:a.DICT("Wlan_Basic_Settings_G_N_Mixed")},
{name:"b g n",displayName:a.DICT("Wlan_Basic_Settings_B_G_N_Mixed")}];a.schema.wlan5g_mode=[{name:"a",displayName:a.DICT("Wlan_Basic_Settings_A_Only")},{name:"n ac",displayName:a.DICT("Wlan_Basic_Settings_N_AC_Mixed")},{name:"a n ac",displayName:a.DICT("Wlan_Basic_Settings_A_N_AC_Mixed")}];a.schema.wlan2g_ch=[{ch:"auto",ext:"AB",band:"20/40",displayName:a.DICT("Wlan_Basic_Settings_Auto")},{ch:1,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel1")},{ch:2,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel2")},
{ch:3,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel3")},{ch:4,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel4")},{ch:5,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel5")},{ch:6,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel6")},{ch:7,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel7")},{ch:8,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel8")},{ch:9,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel9")},
{ch:10,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel10")},{ch:11,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel2")},{ch:1,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel1")},{ch:2,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel2")},{ch:3,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel3")},{ch:4,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel4")},{ch:5,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel5")},
{ch:6,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel6")},{ch:7,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel7")},{ch:5,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel5")},{ch:6,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel6")},{ch:7,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel7")},{ch:8,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel8")},{ch:9,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel9")},
{ch:10,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel10")},{ch:11,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel11")}];a.schema.wlan5g_ch=[{ch:"auto",ext:"AB",band:"20/40/80",displayName:a.DICT("Wlan_Basic_Settings_Auto")},{ch:36,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel36")},{ch:40,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel40")},{ch:44,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel44")},{ch:48,ext:"",
band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel48")},{ch:52,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel52")},{ch:56,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel56")},{ch:60,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel60")},{ch:64,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel64")},{ch:100,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel100")},{ch:104,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel104")},
{ch:108,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel108")},{ch:112,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel112")},{ch:116,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel116")},{ch:132,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel132")},{ch:136,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel136")},{ch:140,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel140")},{ch:149,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel149")},
{ch:153,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel153")},{ch:157,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel157")},{ch:161,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel161")},{ch:165,ext:"",band:"20",displayName:a.DICT("Wlan_Basic_Settings_Channel165")},{ch:36,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel36")},{ch:40,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel40")},{ch:44,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel44")},
{ch:48,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel48")},{ch:52,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel52")},{ch:56,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel56")},{ch:60,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel60")},{ch:64,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel64")},{ch:100,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel100")},{ch:104,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel104")},
{ch:108,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel108")},{ch:112,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel112")},{ch:132,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel132")},{ch:136,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel136")},{ch:149,ext:"A",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel149")},{ch:153,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel153")},{ch:157,ext:"A",band:"40",
displayName:a.DICT("Wlan_Basic_Settings_Channel157")},{ch:161,ext:"B",band:"40",displayName:a.DICT("Wlan_Basic_Settings_Channel161")},{ch:42,ext:"",band:"80",displayName:a.DICT("Wlan_Basic_Settings_Channel42")},{ch:58,ext:"",band:"80",displayName:a.DICT("Wlan_Basic_Settings_Channel58")},{ch:106,ext:"",band:"80",displayName:a.DICT("Wlan_Basic_Settings_Channel106")},{ch:155,ext:"",band:"80",displayName:a.DICT("Wlan_Basic_Settings_Channel155")}];a.schema.ssid_secumode=[{id:"None",displayName:a.DICT("Wlan_Basic_Settings_None")},
{id:"WEP-64",displayName:a.DICT("Wlan_Basic_Settings_WEP64")},{id:"WEP-128",displayName:a.DICT("Wlan_Basic_Settings_WEP128")},{id:"WPA2-Personal",displayName:a.DICT("Wlan_Basic_Settings_WPA2_Personal")},{id:"WPA-WPA2-Personal",displayName:a.DICT("Wlan_Basic_Settings_WPA_WPA2_Personal")},{id:"WPA2-Enterprise",displayName:a.DICT("Wlan_Basic_Settings_WPA2_Enterprise")},{id:"WPA-WPA2-Enterprise",displayName:a.DICT("Wlan_Basic_Settings_WPA_WPA2_Enterprise")}];a.schema.vlanids=[];a.model.vlanlist?(angular.forEach(a.model.vlanlist,
function(b,c){b.name&&b.name.match(/^VLAN/)&&a.schema.vlanids.push(parseInt(b.name.replace(/VLAN/g,"")))}),a.schema.vlanids.sort(function(a,b){return a-b})):a.schema.vlanids.push(1)};a.vld={editable_2G_wmm:!0,editable_5G_wmm:!0,limit_2G_mode:!1,limit_5G_mode:!1,check_radio_mode:function(){var b=a.collect_wlan_radio("WLAN1")[0].radio,c=a.collect_wlan_radio("WLAN2")[0].radio,d=a.model.wlans.ssid||[],e;a.vld.editable_2G_wmm=!0;a.vld.editable_5G_wmm=!0;angular.forEach(d,function(a){a.editableWMM=!0});
b.enable&&"n"===b["operating-standards"][0]&&(a.vld.editable_2G_wmm=!1,angular.forEach(d,function(b){e=a.radioGetterRule(b);if(b.enable&&("2g"===e||"both"===e))b["wmm-enable"]=!0,b.editableWMM=!1}));c.enable&&"n ac"===c["operating-standards"][0]&&(a.vld.editable_5G_wmm=!1,angular.forEach(d,function(b){e=a.radioGetterRule(b);if(b.enable&&("5g"===e||"both"===e))b["wmm-enable"]=!0,b.editableWMM=!1}))},check_ssid_wmm:function(){var b=a.model.wlans.ssid||[];a.collect_wlan_radio("WLAN1");a.collect_wlan_radio("WLAN2");
var c;a.vld.limit_2G_mode=!0;a.vld.limit_5G_mode=!0;angular.forEach(b,function(b){b.editableWMM=!0;if(b.enable)switch(c=a.radioGetterRule(b),c){case "2g":a.vld.editable_2G_wmm?b["wmm-enable"]&&(a.vld.limit_2G_mode=!1):(b["wmm-enable"]=!0,b.editableWMM=!1,a.vld.limit_2G_mode=!1);break;case "5g":a.vld.editable_5G_wmm?b["wmm-enable"]&&(a.vld.limit_5G_mode=!1):(b["wmm-enable"]=!0,b.editableWMM=!1,a.vld.limit_5G_mode=!1);break;case "both":a.vld.editable_2G_wmm&&a.vld.editable_5G_wmm?b["wmm-enable"]&&(a.vld.limit_2G_mode=
!1,a.vld.limit_5G_mode=!1):(b["wmm-enable"]=!0,b.editableWMM=!1,a.vld.limit_2G_mode=!1,a.vld.limit_5G_mode=!1)}})}};a.selected=a.selected||{};a.gridWLANSSID=a.gridWLANSSID||{};a.currPage="main";a.ctx.pageNav=[a.currPage];a.getCurrPage=function(){return a.currPage};a.pageMap=function(b){var c=!1;a.currPage==b&&(c=!0);return c};a.getWorkingVapBy=function(a,b){var c;(c=a._tbl_mac2g)||Log(ERROR,"error: getWorkingVapBy() vapref not exist");return c};a.getVAPUsage=function(b){var c=0,d=0,e=0;if(a.model.wlans&&
a.model.wlans.ssid)for(var g=0;g<a.model.wlans.ssid.length;g++)"WLAN1"===a.model.wlans.ssid[g].radio?c++:"WLAN2"===a.model.wlans.ssid[g].radio?d++:"BOTH"===a.model.wlans.ssid[g].radio&&(c++,d++,e++);if("2g"==b)return c;if("5g"==b)return d;if("both"==b)return e};a.isAddMaxExceed=function(){var b=!1,c=a.getVAPUsage("2g"),d=a.getVAPUsage("5g"),e=a.ctx.spec.maxVAPprofiles;c>=e&&d>=e&&(b=!0);return b};a.filter_isKeyInused=function(b,c){return function(d,e,g){return d!==c&&d.ssid==c.ssid&&(d=a.radioGetterRule(d),
Log(DEBUG,"itemtype "+d),d==b||"both"==d&&("2g"==b||"5g"==b)||"both"==b&&("2g"==d||"5g"==d))?!0:!1}};a.radioApplyRule=function(b,c){var d=!1,e=l("filter")(a.model.wlans.ssid,a.filter_isKeyInused(c,b)),g=a.getVAPUsage(c),h=a.ctx.spec.maxVAPprofiles,k=a.radioGetterRule(b);c==k&&"both"!=k?g--:"both"==k&&g--;var m=!1;if(("2g"==c||"5g"==c)&&g>=h)m=!0;else{var g=a.getVAPUsage("2g"),n=a.getVAPUsage("5g");"2g"==k?g--:"5g"==k?n--:"both"==k&&(g--,n--);if("both"==c&&(g>=h||n>=h))m=!0}0>=e.length&&!1==m&&(d=
!0);return d};a.changeCurrPageTo=function(b){if("maclist"===b){var c=a.gridWLANSSID.Selections[0];c["mac-filter"]&&(a.macfilter_backup=angular.copy(c["mac-filter"]["filtered-macs"]))}b!=a.currPage&&(a.ctx.pageNav.push(b),a.currPage=b);F(b)};a.changeCurrPageBack=function(){var b;1<a.ctx.pageNav.length&&(a.ctx.pageNav.pop(),b=a.ctx.pageNav[a.ctx.pageNav.length-1],a.currPage=b,F(b));return b};var F=function(b){"maclist"!=b&&"wps"!=b&&("main"==b?a.gridWLANSSID.Edit=!1:"ssidedit"==b?a.gridWLANSSID.Edit=
!0:alert("unknown id:"+b))};a.filter_WLAN_Radio=function(a){return function(b,c,d){return b.name.match(a)?!0:!1}};a.collect_wlan_radio=function(b){if(a.model.interfaces&&a.model.interfaces["interface"])return l("filter")(a.model.interfaces["interface"],a.filter_WLAN_Radio(b))};a.collect_orig_wlan_radio=function(b){return l("filter")(a.model_orig.interfaces["interface"],a.filter_WLAN_Radio(b))};a.filter_w2g_channel=function(a,b,c){var d=c.replace(/^([0-9]+)[^0-9]+/,"$1");return function(a,e,g){return(e=
a.band.match(d))&&"40MHz"==c&&a.ext.match(b)||e&&"40MHz"!==c?!0:!1}};a.filter_w5g_channel=function(a,b,c){var d=c.replace(/^([0-9]+)[^0-9]+/,"$1");return function(a,e,g){return(e=a.band.match(d))&&"40MHz"==c&&a.ext.match(b)||e&&"40MHz"!==c?!0:!1}};a.getCurrChannelList=function(b,c){if(b){var d=[],d=b.radio["operating-channel-bandwidth"],e;switch(b.radio["extension-channel"]){case "BelowControlChannel":e="B";break;case "AboveControlChannel":e="A"}"w2g"==c?("20/40MHz"===d&&(d="40MHz"),d=void 0===a.schema.wlan2g_ch_dyn||
void 0===a.schema.wlan2g_ch_dyn[0]?l("filter")(a.schema.wlan2g_ch,a.filter_w2g_channel(c,e,d)):l("filter")(a.schema.wlan2g_ch_dyn,a.filter_w2g_channel(c,e,d))):d=void 0===a.schema.wlan5g_ch_dyn||void 0===a.schema.wlan5g_ch_dyn[0]?l("filter")(a.schema.wlan5g_ch,a.filter_w5g_channel(c,e,d)):l("filter")(a.schema.wlan5g_ch_dyn,a.filter_w5g_channel(c,e,d));return d}};a.updateChannel=function(a,b,c){for(var d=!0,e=100,g={},h,k=0,l=0;l<b.length;l++)if(h=b[l],k=Math.abs(h.ch-c),0==k){d=!1;break}else k<e&&
(e=k,g=h);d&&(a.radio.channel=g.ch)};a.channelGetterSetter=function(a,b){if(angular.isDefined(a))"auto"===a?(b.radio["autoChannel-enable"]=!0,b.radio.channel=""):(b.radio["autoChannel-enable"]=!1,b.radio.channel=a);else{var c;c=b.radio["autoChannel-enable"]?"auto":b.radio.channel;""==c&&(c="auto");return c}};a.w2gChannelGetterSetter=function(b){if(a.collect_wlan_radio("WLAN1")){var c=a.collect_wlan_radio("WLAN1")[0];return a.channelGetterSetter(b,c)}};a.w5gChannelGetterSetter=function(b){if(a.collect_wlan_radio("WLAN2")){var c=
a.collect_wlan_radio("WLAN2")[0];return a.channelGetterSetter(b,c)}};a.getExtChannelList=function(b){b=[];return b=a.schema.extChannel};a.isChannelBandWidthEquals=function(a,b){if(b&&b.radio&&b.radio["operating-channel-bandwidth"])return null!=b.radio["operating-channel-bandwidth"].match(a)};a.getPriChannelList=function(b){b=[];return b=a.schema.priChannel};a.radioGetterRule=function(a){a=a.radio;var b="";"BOTH"==a?b="both":"WLAN1"==a?b="2g":"WLAN2"==a?b="5g":Log(ERROR,"Unknown Radio Combination:"+
radio1+", "+radio2);return b};a.showRadioState=function(b){return{"2g":"2.4G","5g":"5G",both:"Both"}[a.radioGetterRule(b)]};a.ssid_radio_owner=function(b){var c=a.gridWLANSSID.Selections[0];if(arguments.length)"2g"==b?c.radio="WLAN1":"5g"==b?c.radio="WLAN2":"both"==b?c.radio="BOTH":Log(DEBUG,"Unknown newVal:"+b),a.vld.check_ssid_wmm();else return a.radioGetterRule(c)};a.scheduleChoice=function(b){var c=a.gridWLANSSID.Selections[0];if(angular.isDefined(b))"Always On"==b?(c["always-on"]=null,c.schedule=
void 0):(c["always-on"]=void 0,c.schedule=b);else if(c)return b="",b=c.schedule,angular.isDefined(b)&&""!==b||(c["always-on"]=null,b="Always On"),b};a.filter_mac_by_column=function(a,b){return function(c,d,e){c=Math.ceil(e.length/b);return Math.floor(d/c)==a?!0:!1}};a.collect_mac_list=function(b,c){var d=a.gridWLANSSID.Selections[0];A(d);return l("filter")(d["mac-filter"]["filtered-macs"],a.filter_mac_by_column(b,c))};a.getColLen=function(b){return Math.ceil(a.gridWLANSSID.Selections[0]["mac-filter"]["filtered-macs"].length/
b)};var H=function(c){var d,e=[];if(a.ctx.orig_ssid){var g=n.post({url:resource_base+"data/ssid_state.json",method:"get_ssid_state",params:{filter:a.ctx.orig_ssid},error:function(a){Log(ERROR,"AJAX loading error: "+a.status+", URL: "+a.config.url)}});b.all([g]).then(function(a){d=r(a,0);intfs=d["interfaces-state"]&&d["interfaces-state"]["interface"]||[];e=J(intfs);c(e)}).catch(function(a){Log(ERROR,"=="+a);c(e)})}else e=[],c(e)},G=function(){for(var b=0,c=0,d=a.gridWLANSSID.Selections[0],e=a.model.wlans.ssid,
g=a.model.wlans.ssid.indexOf(d),h=0;h<g;h++)"WLAN1"===e[h].radio?b++:"WLAN2"===e[h].radio?c++:"BOTH"===e[h].radio&&(b++,c++);"WLAN1"===d.radio?(b++,c=0):"WLAN2"===d.radio?(b=0,c++):"BOTH"===d.radio?(b++,c++):c=b=0;return{"2g":0===b?"":"VAP1_"+b,"5g":0===c?"":"VAP2_"+c}},J=function(b){var c=[],d=0,e=G(),g=e["2g"]||"",h=e["5g"]||"";b||(b=[]);angular.forEach(b,function(b,e){if(""!==g&&b.name.match(g)||""!==h&&b.name.match(h))angular.forEach(b.ssid["associated-device"]||[],function(e,g){d+=1;c.push({count:d,
mac:void 0!==e["link-layer-address"]?e["link-layer-address"]:"",ip:void 0!==e.ip?e.ip:"",radio:b.ssid&&b.ssid["radio-ref"]?"WLAN1"===b.ssid["radio-ref"]?a.DICT("Wlan_Basic_Settings_24G"):a.DICT("Wlan_Basic_Settings_5G"):"",mode:void 0!==e["operating-standard"]?e["operating-standard"].toUpperCase():"",auth:void 0!==e["authentication-state"]?e["authentication-state"]?a.DICT("Wlan_Basic_Settings_TRUE"):a.DICT("Wlan_Basic_Settings_FALSE"):"",signal:void 0!==e["signal-strength"]?e["signal-strength"]:"",
noise:void 0!==e.noise?e.noise:"",time:void 0!==e["connect-time"]?e["connect-time"]:""})})});return c};a.showClientList=function(){H(function(b){s.open({animation:a.animationsEnabled,templateUrl:"show_client_list.html",controller:"showClientList",size:"wlan-client-list",backdrop:"static",resolve:{clientlist:function(){return b}}}).result.then(function(){})})};a.openWPS=function(){s.open({animation:a.animationsEnabled,templateUrl:"wlan_wps.html",controller:"openWPS",size:"lg",backdrop:"static",resolve:{wps:function(){var b=
{},b=angular.copy(a.gridWLANSSID.Selections[0]);b.flag=1;b.idx=a.ctx.ie_index;return b}}}).result.then(function(){})};a.updateUserMacAddr=function(a){var b=function(a){var b=[];if(a["mac-filter"]&&a["mac-filter"]["filtered-macs"]){b=a["mac-filter"]["filtered-macs"];for(a=b.length-1;0<=a;a--)""==b[a]["mac-address"]&&b.splice(a,1)}};a._tbl_mac2g&&b(a._tbl_mac2g);a._tbl_mac5g&&b(a._tbl_mac5g)};a.getMacFilterList=function(b){var c=[],d=[],e=0,g=0,h=function(b,c,d,e){b=b["mac-filter"]["filtered-macs"];
c[e]=angular.copy(a.use_vap_sample);c[e].name=d+(e+1);var g=c[e]["mac-filter"]["filtered-macs"],h="";angular.forEach(b,function(a,b){0===b&&(h=a.action);g.push({"mac-address":a["mac-address"],action:h})})};angular.forEach(b,function(b,k){a.updateUserMacAddr(b);var l=a.radioGetterRule(b);if("2g"==l||"both"==l){var m=b._tbl_mac2g;h(m,c,"VAP1_",e);"both"==l&&(d[g]=angular.copy(c[e]),d[g].name="VAP2_"+(g+1),g++);e++}else"5g"==l&&(m=b._tbl_mac5g,h(m,d,"VAP2_",g),g++)});return c.concat(d)};a.updateBeamforming=
function(a){a.radio.mimo&&(a.radio["beamforming-enable"]=!0)};a.chkWpsSecurity=function(){if("ssidedit"===a.currPage){var b=a.gridWLANSSID.Selections[0]||"",c=b.security["mode-enabled"]||"";!0===(b.wps.enable||"")&&("WEP-64"===c||"WEP-128"===c||"WPA-Personal"===c||"WPA-Enterprise"===c||"WPA2-Enterprise"===c||"WPA-WPA2-Enterprise"===c)?app.TOOLS.warningAlertBox({msg:"WPS will be disabled due to WPS only supports WPA2-Personal, WPA2-Personal Mixed and non-security. Are you sure you want to continue?",
cbk:function(b){b&&(a.gridWLANSSID.Selections[0].wps.enable=!1,a.chkBroadcast())}}):"None"===c?app.TOOLS.warningAlertBox({msg:"None security is a security risk. Are you sure you want to continue?",cbk:function(b){b&&a.chkBroadcast()}}):a.chkBroadcast()}else a.chkBroadcast()};a.chkBroadcast=function(){if("ssidedit"===a.currPage){var b=a.gridWLANSSID.Selections[0]||"",c=b["ssid-advertisment-enable"];!0===(b.wps.enable||"")&&!1===c?app.TOOLS.warningAlertBox({msg:"WPS will be disabled due to SSID Broadcast is disabled. Are you sure you want to continue?",
cbk:function(b){b&&(a.gridWLANSSID.Selections[0].wps.enable=!1,a.chkCpVlan())}}):a.chkCpVlan()}else if("main"===a.currPage){var d=0;angular.forEach(a.model.wlans.ssid,function(a,b){!1===a["ssid-advertisment-enable"]&&!0===a.wps.enable&&(d=1)});d?app.TOOLS.warningAlertBox({msg:"WPS will be disabled due to SSID Broadcast is disabled. Are you sure you want to continue?",cbk:function(b){b&&(angular.forEach(a.model.wlans.ssid,function(a,b){!1===a["ssid-advertisment-enable"]&&!0===a.wps.enable&&(a.wps.enable=
!1)}),a.chkCpVlan())}}):a.chkCpVlan()}else a.chkCpVlan()};a.chkCpVlan=function(){if("ssidedit"===a.currPage){var b=a.gridWLANSSID.Selections[0]||"",c=b["captive-portal"]||"",d=b.vlan_id||"",e=0,g=0,h=0;angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===d&&(e++,a["captive-portal"]!==c&&(g=1),!0===a["captive-portal-enable"]&&h++)});if(1<h&&1<e&&1===g)b=a.DICT("Wlan_Basic_Settings_SSID_Same_VLAN_Msg",{"%s0":d,"%s1":c}),app.TOOLS.warningAlertBox({msg:b,cbk:function(b){b&&(angular.forEach(a.model.wlans.ssid,
function(a,b){a.vlan_id===d&&(a["captive-portal"]=c)}),a.save())}});else{if(!0===b["captive-portal-enable"]||0===h)angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===d&&(a["captive-portal"]=c)});else{var b=a.model.wlans.ssid.indexOf(b),k=a.model_orig.wlans.ssid[b];angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===d&&(a["captive-portal"]=k["captive-portal"])})}a.save()}}else a.save()};a.chkSave=function(){a.chkWpsSecurity()};a.save=function(){for(var b=function(a){a=angular.copy(a);
angular.forEach(a,function(a,b){if(a["mac-filter"]&&a["mac-filter"]["filtered-macs"])for(var c=a["mac-filter"]["filtered-macs"],d=c.length-1;0<=d;d--)""==c[d]["mac-address"]&&c.splice(d,1)});return a}(a.collect_wlan_radio("^WLAN")),c=["1.0 2.0 5.5 6.0 11.0 12.0 24.0"],d=["1.0 2.0 5.5 11.0"],e=["1.0 2.0 5.5 6.0 9.0 11.0 12.0 18.0 24.0 36.0 48.0 54.0"],g=["6.0 12.0 24.0"],h=["6.0 9.0 12.0 18.0 24.0 36.0 48.0 54.0"],k={s1:"fff",s2:"fff",s3:"fff",s4:"fff"},l=0;l<b.length;l++)if(b[l].name&&"WLAN1"===b[l].name){if(b[l].radio&&
b[l].radio["operating-standards"]){var m=b[l].radio["operating-standards"][0]||"";if(""!==m&&a.model_orig&&a.model_orig.interfaces&&a.model_orig.interfaces["interface"]){var p=a.model_orig.interfaces["interface"];angular.forEach(p,function(a){a.name&&("WLAN1"===a.name&&a.radio&&a.radio["operating-standards"]&&m!==a.radio["operating-standards"][0])&&(b[l].radio["transmission-rate"]["rate-basic"]="g"===m||"g n"===m?angular.copy(c):angular.copy(d),b[l].radio["transmission-rate"].rate=angular.copy(e),
b[l].radio["transmission-rate"]["ht-mcs"]=angular.copy("ffffff"))})}}}else b[l].name&&"WLAN2"===b[l].name&&(b[l].radio&&b[l].radio["operating-standards"])&&(m=b[l].radio["operating-standards"][0]||"",""!==m&&(a.model_orig&&a.model_orig.interfaces&&a.model_orig.interfaces["interface"])&&(p=a.model_orig.interfaces["interface"],angular.forEach(p,function(a){a.name&&("WLAN2"===a.name&&a.radio&&a.radio["operating-standards"]&&m!==a.radio["operating-standards"][0])&&(b[l].radio["transmission-rate"]["rate-basic"]=
angular.copy(g),b[l].radio["transmission-rate"].rate=angular.copy(h),b[l].radio["transmission-rate"]["ht-mcs"]=angular.copy("ffffffff"),b[l].radio["transmission-rate"]["vht-mcs"]=angular.copy(k))})));(function(){var b=[],c,d=a.model.wlans.ssid;angular.forEach(a.model_orig.wlans.ssid,function(e){c=!1;angular.forEach(d,function(a){e.ssid===a.ssid&&(c=!0)});c||(b.push(e),a.model.ssid2gruop[e.ssid]=void 0)})})();(function(){var b=[],c,d;"ssidedit"===a.currPage&&(b=a.gridWLANSSID.Selections[0],a.model.ssid2gruop[b.ssid]||
(a.model.ssid2gruop[b.ssid]={}),c=a.model.ssid2gruop[b.ssid],angular.forEach(c,function(a,b){c[b]=!1}),angular.forEach(a.model.nacm_groups,function(a){a.group.select&&(c[a.group.select]=!0)}));b=angular.copy(a.model.orig_groups);d={};angular.forEach(a.model.auth_groups,function(a){d[a.id]=[]});angular.forEach(a.model.ssid2gruop,function(a,b){angular.forEach(a,function(a,c){d[c]&&a&&d[c].push(b)})});angular.forEach(b,function(a){angular.forEach(a["feature-rule"],function(b){"ssid"===b.service&&(b.option=
d[a.name]?d[a.name]:[])})});a.bulk.push({method:"set_groups",params:{groups:{group:b}}})})();(function(){var c=function(a){var b=function(a,b,c){c!=b&&angular.isDefined(a.security[c])&&delete a.security[c]};angular.forEach(a,function(a,c){if(a.security&&a.security["mode-enabled"]){var d=a.security["mode-enabled"];b(a,d,"None");b(a,d,"WEP-64");b(a,d,"WEP-128");b(a,d,"WPA-Personal");b(a,d,"WPA-WPA2-Personal");b(a,d,"WPA2-Personal");b(a,d,"WPA-Enterprise");b(a,d,"WPA2-Enterprise");b(a,d,"WPA-WPA2-Enterprise")}angular.isDefined(a.checked)&&
delete a.checked;angular.isDefined(a.disableChk)&&delete a.disableChk})},d=function(a){angular.forEach(a,function(a,b){a._tbl_mac2g&&delete a._tbl_mac2g;a._tbl_mac5g&&delete a._tbl_mac5g})},e=function(a){a=angular.copy(a);c(a);d(a);return a}(a.model.wlans.ssid);a.bulk.push({method:"set_wifi_interfaces",params:{interfaces:{"interface":b}}});a.bulk.push({method:"set_wifi_settings",params:{wlans:{ssid:e}}});n.post({method:"set_bulk",params:a.bulk,success:function(b){a.success=!0;a.loadReady=!1;a.resetPageVIew("overview");
y()},error:function(b){a.loadReady=!1;y()}})})();a.resetModified()};a.back=function(){a.changeCurrPageBack()};a.cancel=function(){a.loadReady=!1;a.model={};a.resetPageVIew("overview");y();a.resetModified()};a.macfilter_cancel=function(){a.gridWLANSSID.Selections[0]["mac-filter"]["filtered-macs"]=angular.copy(a.macfilter_backup);a.changeCurrPageBack()};a.set_2g_bandwidth=function(b){a.vld.check_radio_mode();if("b"===b.radio["operating-standards"][0]||"g"===b.radio["operating-standards"][0]||"b g"===
b.radio["operating-standards"][0])b.radio["operating-channel-bandwidth"]="20MHz"};a.set_5g_bandwidth=function(b){a.vld.check_radio_mode();"a"===b.radio["operating-standards"][0]&&(b.radio["operating-channel-bandwidth"]="20MHz")};a.captive_portal_chk=function(b){if(!b["captive-portal-enable"]){b=a.model.nacm_groups;var c;for(c=b.length-1;0<=c;c--)b.splice(c,1);a.checkNacmGroupList()}};a.chkJump=function(b,c){if(b&&"New ..."===b["captive-portal"])10<a.model["portal-profiles"]["portal-profile"].length?
app.TOOLS.criticalAlertBox({msg:"Maximum limit of 10 Captive Portal entries is reached.",cbk:function(a){a&&(b["captive-portal"]=c)}}):app.TOOLS.warningAlertBox({msg:'Would you like to redirect this page to "Add Captive Portal Profile"?',cbk:function(d){d?a.pageActionJump("CP","add"):b["captive-portal"]=c}});else if(b&&"main"===a.currPage){var d=b["captive-portal"]||"",e=b.vlan_id||"",g=0,h=0,k=0;angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===e&&(g++,a["captive-portal"]!==d&&(h=1),!0===
a["captive-portal-enable"]&&k++)});1<k&&1<g&&1===h?app.TOOLS.warningAlertBox({msg:"SSIDs associated with the same VLAN("+e+") must be associated with the same Captive Protal profile("+d+"). Are you sure you want to continue?",cbk:function(g){g?angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===e&&(a["captive-portal"]=d)}):b["captive-portal"]=c}}):angular.forEach(a.model.wlans.ssid,function(a,b){a.vlan_id===e&&(a["captive-portal"]=d)})}};a.model.nacm_groups=[];a.disableNacmGroupAddBtn=!1;
var L=function(){var b=angular.copy(a.model.auth_groups),c;angular.forEach(a.model.nacm_groups,function(a){for(c=b.length-1;0<=c;c--)b[c].id===a.group.select&&b.splice(c,1)});return b};a.checkNacmGroupList=function(){var b=L();a.disableNacmGroupAddBtn=0===b.length;angular.forEach(a.model.nacm_groups,function(a){a.group.list=[{id:a.group.select,displayName:a.group.select}];a.group.list=a.group.list.concat(b)})};a.nacmGroupSelectedCnt=0;a.nacmGroupCheckboxCbk=function(){a.nacmGroupSelectedCnt=0;angular.forEach(a.model.nacm_groups,
function(b){b.checked?a.nacmGroupSelectedCnt+=1:b.edit=!1})};a.editNacmGroup=function(){angular.forEach(a.model.nacm_groups,function(a){a.checked&&(a.edit=!0)})};a.addNacmGroup=function(){var b=L();a.model.nacm_groups.push({checked:!0,edit:!0,group:{select:b[0].id,list:[]}});a.checkNacmGroupList()};a.deleteNacmGroup=function(){var b=a.model.nacm_groups,c;for(c=b.length-1;0<=c;c--)b[c].checked&&b.splice(c,1);a.checkNacmGroupList()};a.gridNacmGroupOptions=app.uiGrid.generateGridOptions({columnDefs:[{field:"checked",
isCheckbox:!0,headerChangedCbk:a.nacmGroupCheckboxCbk,changedCbk:a.nacmGroupCheckboxCbk},{field:"group",editRow:"edit",cellTemplate:"UG_table_select_with_inline_edit.html",changedCbk:a.checkNacmGroupList}]});a.pageJump=function(a){var b={CP:"captive_portal"}[a];b||alert("unknown pageId:"+a);a=document.location;document.location.href=a.protocol+"//"+a.host+a.pathname+"#/"+b};var N=function(a){return{action:a}};a.pageActionJump=function(b,c){var d={CP:{lockerID:"WLAN_CP",prepareItem_cb:N}},e=d[b].lockerID,
d=d[b].prepareItem_cb(c);v.put(e,d);a.pageJump(b)}}]);app.controller("wlan_radio",["$scope",function(a){}]);
app.controller("wlan_ssid",["$scope","$q","$uibModal","MyHttp","$timeout","GridRowBasedEditingOper","$templateCache","Sets","wan_service","$filter",function(a,b,s,n,v,t,m,q,e,w){a.gridWLANSSID.remove=function(){var b,e=a.model.wlans.ssid;for(b=e.length-1;0<=b;b--)e[b].checked&&e.splice(b,1);a.ctx.orig_ssid="";a.modified()};a.gridWLANSSID.editItem=function(){var b=a.gridWLANSSID.Selections[0];a.show_pwd=!1;a.ctx.ie_index=a.model.wlans.ssid.indexOf(b);a.ctx.orig_ssid=b.ssid;a.model.nacm_groups=[];angular.forEach(a.model.ssid2gruop[b.ssid],
function(b,e){a.model.nacm_groups.push({checked:!1,edit:!1,group:{select:e,list:[]}})});a.checkNacmGroupList();a.gridNacmGroupOptions.data=a.model.nacm_groups;a.changeCurrPageTo("ssidedit")};(function(){a.T_cellEdit=m.get("T_editWithNoFoucs_by_rowEditableState_objs.html");a.gridWLANSSID.rowEditableState=[];a.gridWLANSSID.Selections=[];a.gridWLANSSID.procNgClick=function(b){b=a.model.wlans.ssid.length||0;var e=a.model.wlans.ssid;if(b)for(var m=0;m<b;m++)void 0===a.model.wlans.ssid[m].checked&&(a.model.wlans.ssid[m].checked=
!1);a.gridWLANSSID.Selections=[];angular.forEach(e,function(b,e){b.checked&&a.gridWLANSSID.Selections.push(b)})};a.gridWLANSSID.Options=app.uiGrid.generateGridOptions({IDPreifx:"WLANSSID",columnDefs:[{field:"checked",isCheckbox:!0,changedCbk:a.gridWLANSSID.procNgClick,headerChangedCbk:a.gridWLANSSID.procNgClick,disableChkBoxField:"disableChk"},{field:"enable",displayName:a.DICT("Wlan_Basic_Settings_Enable"),width:80,cellTemplate:m.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/g,"ng-change='grid.appScope.vld.check_ssid_wmm()'")},
{field:"ssid",displayName:a.DICT("Wlan_Basic_Settings_SSID_Name"),minWidth:170},{field:"radio1",displayName:a.DICT("Wlan_Basic_Settings_Radio"),width:80,cellTemplate:m.get("UG_CellText_WL_radio_state.html")},{field:"ssid-advertisment-enable",displayName:a.DICT("Wlan_Basic_Settings_SSID_Broadcast"),width:130,cellTemplate:m.get("UG_table_checkbox_2.html")},{field:"security.mode-enabled",displayName:a.DICT("Wlan_Basic_Settings_Security_Mode"),width:160},{field:"mac-filter.enable",displayName:a.DICT("Wlan_Basic_Settings_MAC_Filter"),
width:130,cellTemplate:m.get("UG_CellText.html").replace(/MODEL_COL_FIELD/,"grid.appScope.schema.enableStatus[MODEL_COL_FIELD]")},{field:"vlan_id",displayName:a.DICT("Wlan_Basic_Settings_VLAN"),width:80},{field:"isolation-with-ssid",displayName:a.DICT("Wlan_Basic_Settings_Wireless_Isolation_Within_SSID"),width:220,cellTemplate:m.get("UG_table_checkbox_2.html")},{field:"wmm-enable",displayName:a.DICT("Wlan_Basic_Settings_WMM"),width:80,cellTemplate:m.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/g,
"ng-change='grid.appScope.vld.check_ssid_wmm()'; ng-disabled='!row.entity.editableWMM'")},{field:"wps.enable",displayName:a.DICT("Wlan_Basic_Settings_WPS"),width:80,cellTemplate:m.get("UG_table_checkbox_2.html").replace(/data-ng-expansion/g,"ng-disabled=\"row['entity']['security']['mode-enabled'] === 'WEP-64' \t\t\t\t\t\t|| row['entity']['security']['mode-enabled'] === 'WEP-128' \t\t\t\t\t\t|| row['entity']['security']['mode-enabled'] === 'WPA-Personal' \t\t\t\t\t\t|| row['entity']['security']['mode-enabled'] === 'WPA-Enterprise' \t\t\t\t\t\t|| row['entity']['security']['mode-enabled'] === 'WPA2-Enterprise' \t\t\t\t\t\t|| row['entity']['security']['mode-enabled'] === 'WPA-WPA2-Enterprise'\"")},
{field:"captive-portal-enable",displayName:a.DICT("Wlan_Basic_Settings_Captive_Portal"),width:215,cellTemplate:m.get("UG_WL_CaptivePortal.html")}]});a.gridWLANSSID.add=function(){var b={ssid:"",radio:"BOTH",enable:!0,"ssid-advertisment-enable":!0,security:{"mode-enabled":"None"},"wmm-enable":!0,"isolation-with-ssid":!1,pmf:"not-required",vlan_id:1,"mac-filter":{enable:!0},wps:{enable:!1},"captive-portal":"Default_Portal_Profile"};a.model.wlans.ssid.push(b);v(function(){b&&(a.gridWLANSSID.Selections=
[],a.gridWLANSSID.Selections.push(b),a.ctx.orig_ssid="",a.model.nacm_groups=[],a.checkNacmGroupList(),a.gridNacmGroupOptions.data=a.model.nacm_groups,a.changeCurrPageTo("ssidedit"))},45);a.modified()}})()}]);
app.controller("wlan_ssid_edit",["$scope",function(a){a.input_type="password";a.showSecuMode=function(a,s){var n=!1;"wpa-psk"==s?n="WPA-Personal"==a||"WPA2-Personal"==a||"WPA-WPA2-Personal"==a:"wpa"==s?n="WPA-Enterprise"==a||"WPA2-Enterprise"==a||"WPA-WPA2-Enterprise"==a:"wep"==s&&(n="WEP-64"==a||"WEP-128"==a);return n};a.securityWarning=function(){var b=a.gridWLANSSID.Selections[0];"None"===b.security["mode-enabled"]?b.pmf="not-required":"WEP-64"===b.security["mode-enabled"]||"WEP-128"===b.security["mode-enabled"]?
(b.pmf="not-required",a.msg=a.DICT("Wlan_Basic_Settings_WEP_Authentication_Msg"),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}})):(b.pmf="capable",a.msg=a.DICT("Wlan_Basic_Settings_Msg"),app.TOOLS.criticalAlertBox({msg:a.msg,cbk:function(a){}}))};a.show_pwd=function(){a.input_type="password"==a.input_type?"text":"password"}}]);
app.controller("showClientList",["$scope","clientlist","$uibModalInstance","UserSession","userAccessRight",function(a,b,s,n,v){a.userAccessFlag=v.get();"RW"!==a.userAccessFlag&&"RO"!==a.userAccessFlag&&n.logout();a.loadReady=!1;a.clientlist=b;a.funs={close:function(){s.close()}};a.gridClientList=app.uiGrid.generateGridOptions({data:a.clientlist,columnDefs:[{field:"count",displayName:a.DICT("Wlan_Basic_Settings_No"),resizable:!0,minWidth:65},{field:"mac",displayName:a.DICT("Wlan_Basic_Settings_MAC_Addr"),
resizable:!0,minWidth:145},{field:"ip",displayName:a.DICT("Wlan_Basic_Settings_IP_Addr"),resizable:!0,minWidth:145},{field:"radio",displayName:a.DICT("Wlan_Basic_Settings_Radio"),resizable:!0,minWidth:80},{field:"mode",displayName:a.DICT("Wlan_Basic_Settings_Mode"),resizable:!0,minWidth:80},{field:"auth",displayName:a.DICT("Wlan_Basic_Settings_Authentication"),resizable:!0,minWidth:120},{field:"signal",displayName:a.DICT("Wlan_Basic_Settings_Signal_Strength"),resizable:!0,minWidth:120},{field:"noise",
displayName:a.DICT("Wlan_Basic_Settings_Noise_Level"),resizable:!0,minWidth:120},{field:"time",displayName:a.DICT("Wlan_Basic_Settings_Time_Connected"),resizable:!0,minWidth:130}]});a.loadReady=!0}]);app.controller("openWPS",["$scope","$uibModalInstance","wps",function(a,b,s){a.wps=s;a.funs={close:function(){b.close()}}}]);
